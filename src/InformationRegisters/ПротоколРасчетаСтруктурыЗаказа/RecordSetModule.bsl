
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПередЗаписью(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	ПериодРегистрации= ТекущаяУниверсальнаяДата();
	ДеньРегистрации = Цел((ПериодРегистрации - '20000101000000') / 86400);
	
	Для каждого Запись Из ЭтотОбъект Цикл
		
		ЕстьОшибки = ЕстьОшибкиЗаполненияЗаписиПротокола(Запись, Отказ);
		
		Если ЕстьОшибки Тогда
			Продолжить;
		КонецЕсли;
		
		Запись.ПериодРегистрации = ПериодРегистрации;
		Запись.ДеньРегистрации = ДеньРегистрации;

	КонецЦикла;
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ЕстьОшибкиЗаполненияЗаписиПротокола(Запись, Отказ)
	
	ЕстьОшибки = Ложь;
	
	Если Не ЗначениеЗаполнено(Запись.ЗаказНаПроизводство)
		И Не Запись.ТипОшибки = Перечисления.ТипыОшибокРасчетаСтруктурыЗаказаНаПроизводство.ОшибкаРаспределенияЗапасов Тогда
		ЕстьОшибки = Истина;
		ТекстОшибки = НСтр("ru = 'Поле ""Заказ на производство"" обязательно к заполнению.';
							|en = 'Fill the ""Production order"" field.'");
		ОбщегоНазначения.СообщитьПользователю(ТекстОшибки,,,,Отказ)
	КонецЕсли;
	
	Возврат ЕстьОшибки;
	
КонецФункции

#КонецОбласти

#КонецЕсли
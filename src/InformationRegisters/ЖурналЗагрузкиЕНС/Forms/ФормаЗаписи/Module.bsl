
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	МассивЗаписейЖурнала = ДанныеИзJSON();
	Для Каждого ЗаписьЖурнала Из МассивЗаписейЖурнала Цикл
		НоваяСтрока = ЖурналЗагрузки.Добавить();
		НоваяСтрока.ДатаВремя   = XMLЗначение(Тип("Дата"), ЗаписьЖурнала["time"]);
		НоваяСтрока.Событие     = ЗаписьЖурнала["message"]["description"];
		НоваяСтрока.Комментарий = ЗаписьЖурнала["message"]["data"];
		НоваяСтрока.ТипЗаписи   = ЗаписьЖурнала["type"];
		НоваяСтрока.Тип         = ?(НоваяСтрока.ТипЗаписи = "error", 1, 3);
	КонецЦикла;
	
КонецПроцедуры


&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	
	// СтандартныеПодсистемы.УправлениеДоступом
	Если ОбщегоНазначения.ПодсистемаСуществует("СтандартныеПодсистемы.УправлениеДоступом") Тогда
		МодульУправлениеДоступом = ОбщегоНазначения.ОбщийМодуль("УправлениеДоступом");
		МодульУправлениеДоступом.ПриЧтенииНаСервере(ЭтотОбъект, ТекущийОбъект);
	КонецЕсли;
	// Конец СтандартныеПодсистемы.УправлениеДоступом
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	// СтандартныеПодсистемы.УправлениеДоступом
	Если ОбщегоНазначения.ПодсистемаСуществует("СтандартныеПодсистемы.УправлениеДоступом") Тогда
		МодульУправлениеДоступом = ОбщегоНазначения.ОбщийМодуль("УправлениеДоступом");
		МодульУправлениеДоступом.ПослеЗаписиНаСервере(ЭтотОбъект, ТекущийОбъект, ПараметрыЗаписи);
	КонецЕсли;
	// Конец СтандартныеПодсистемы.УправлениеДоступом
	
КонецПроцедуры

&НаСервере
Функция ДанныеИзJSON()
	
	Строка = Запись.ЖурналЗагрузки;
	
	Если ПустаяСтрока(Строка) Тогда
		Строка = "{}";
	КонецЕсли;
	
	ЧтениеJSON = Новый ЧтениеJSON;
	ЧтениеJSON.УстановитьСтроку(Строка);
	Возврат ПрочитатьJSON(ЧтениеJSON);
	
КонецФункции


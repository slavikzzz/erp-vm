
#Область СлужебныйПрограммныйИнтерфейс

Функция СодержаниеТиповогоОтвета(Ссылка) Экспорт
	
	Возврат ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Ссылка, "ТекстОтвета");
	
КонецФункции

Функция ТребуетсяПодписьПриВыполненииЗаявки(Заявка) Экспорт
	
	Возврат ЗаявкиСотрудников.ТребуетсяПодписьПриВыполненииЗаявки(Заявка);

КонецФункции

Процедура УдалитьФайлСправки(ФайлСправки) Экспорт

	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ЭлектронныйДокумент", ФайлСправки);
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументКадровогоЭДО.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.ДокументКадровогоЭДО КАК ДокументКадровогоЭДО
	|ГДЕ
	|	ДокументКадровогоЭДО.ЭлектронныйДокумент = &ЭлектронныйДокумент
	|	И НЕ ДокументКадровогоЭДО.ПометкаУдаления";
	
	УстановитьПривилегированныйРежим(Истина);
	
	ДокументыКЭДО = Запрос.Выполнить().Выгрузить();
	
	НачатьТранзакцию();
	Попытка
		
		Блокировка = Новый БлокировкаДанных;
		ЭлементБлокировки = Блокировка.Добавить("Документ.ДокументКадровогоЭДО");
		ЭлементБлокировки.ИсточникДанных = ДокументыКЭДО;
		ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Ссылка", "Ссылка");
		ЭлементБлокировки = Блокировка.Добавить(ОбщегоНазначения.ИмяТаблицыПоСсылке(ФайлСправки));
		ЭлементБлокировки.УстановитьЗначение("Ссылка", ФайлСправки);
		Блокировка.Заблокировать();
		
		ФайлСправкиОбъект = ФайлСправки.ПолучитьОбъект();
		ФайлСправкиОбъект.ДополнительныеСвойства.Вставить("УдалениеПечатныхФорм");
		ФайлСправкиОбъект.УстановитьПометкуУдаления(Истина);
		
		Для каждого СтрокаТЗ Из ДокументыКЭДО Цикл
			ДокументОбъект = СтрокаТЗ.Ссылка.ПолучитьОбъект();
			ДокументОбъект.ПометкаУдаления = Истина;
			ДокументОбъект.ДополнительныеСвойства.Вставить("РазрешенаПометкаУдаления", Истина);
			ДокументОбъект.Записать();
		КонецЦикла;
		
		ЗафиксироватьТранзакцию();
		
	Исключение
		ОтменитьТранзакцию();
		ТекстСообщения = НСтр("ru = 'Ошибка удаления файла справки.';
								|en = 'Ошибка удаления файла справки.'");
		ПодробноеПредставлениеОшибки = ОбработкаОшибок.ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
		Комментарий = СтрШаблон("%1%2%3", ТекстСообщения, Символы.ПС, ПодробноеПредставлениеОшибки);
		ЗаписьЖурналаРегистрации(ИнтеграцияКабинетСотрудника.ИменаСобытийЖР().ПрочиеСобытия, УровеньЖурналаРегистрации.Ошибка,,, Комментарий);
		ВызватьИсключение;
	КонецПопытки;

КонецПроцедуры

#КонецОбласти
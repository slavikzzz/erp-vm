////////////////////////////////////////////////////////////////////////////////
// Процедуры и функции планирования производства и расчета графика производства
//
////////////////////////////////////////////////////////////////////////////////

//++ Устарело_Производство21

//++ НЕ УТКА

#Область ПрограммныйИнтерфейс

// Возвращает очередь заказов для планирования по указанный заказ
//
// Параметры:
//  Заказ				 - ДокументСсылка.ЗаказНаПроизводство	 - ссылка на заказ, по который нужно планировать
//  ПоВсемДиспетчерам	 - Булево								 - признак, планировать по всем диспетчерам.
// 
// Возвращаемое значение:
//   - Массив - очередь планирования.
//
Функция ОчередьПланирования(Заказ, ПоВсемДиспетчерам = Истина) Экспорт
	
	Возврат Документы.ЗаказНаПроизводство.ОчередьПланирования(Заказ, ПоВсемДиспетчерам);
	
КонецФункции

// Рассчитывает график производства по заказу
//
// Параметры:
//  Заказ	 - ДокументСсылка.ЗаказНаПроизводство	 - заказ для расчета графика производства.
// 
// Возвращаемое значение:
//   - Структура - результат расчета графика.
//
Функция РассчитатьГрафикВыпуска(Заказ) Экспорт
	
	Если Документы.ЗаказНаПроизводство.ТребуетсяПланировать(Заказ).Количество() = 0 Тогда
		
		Возврат Новый Структура("Запланирован", Истина);
		
	КонецЕсли;
	
	ЗаказОбъект = Заказ.ПолучитьОбъект();
	ЗаказОбъект.Заблокировать();
	
	РезультатРасчета = ЗаказОбъект.РассчитатьГрафикВыпуска();
	
	Если РезультатРасчета.Запланирован Тогда
		
		ЗаказОбъект.ИнициализироватьПараметрыАктуализацииМаршрутныхЛистов();
		
		ЗаказОбъект.Записать(РежимЗаписиДокумента.Проведение);
		
		Возврат Новый Структура("Запланирован", Истина);
		
	Иначе
		
		Возврат Новый Структура("Запланирован, Ошибки", Ложь, РезультатРасчета.Ошибки);
		
	КонецЕсли;
	
КонецФункции

// Возвращает фиксированные настройки для отчета ОтклонениеЗаказаФактаОтКалькуляции
//
// Параметры:
//   Параметры - Структура - структура устанавливаемых параметров.
//
// Возвращаемое значение:
//	НастройкиКомпоновкиДанных - фиксированные настройки.
//
Функция ПараметрыРасшифровкиОтклонениеЗаказаФактаОтКалькуляции(Параметры) Экспорт
	
	ОтчетОбъект = Отчеты.ОтклонениеЗаказаФактаОтКалькуляции.Создать();
	
	ФиксированныеНастройки = ОтчетОбъект.КомпоновщикНастроек.ФиксированныеНастройки;
	УстанавливаемыеПараметры = Новый Соответствие;
	УстанавливаемыеПараметры.Вставить("ЗаказРасшифровка",            Параметры.ЗаказНаПроизводство);
	УстанавливаемыеПараметры.Вставить("КодСтрокиРасшифровка",        Параметры.КодСтрокиЗаказаНаПроизводство);
	КомпоновкаДанныхКлиентСервер.УстановитьКоллекциюПараметров(ФиксированныеНастройки, УстанавливаемыеПараметры);
	
	Возврат ФиксированныеНастройки;
	
КонецФункции

#Область РедактированиеСпецификацииСтрокиЗаказа

// Функция возвращает пустую структуру данных по продукции
//
// Параметры:
//  ДанныеЗаполнения - Структура - структура данных строки продукции заказа на производство:
//  * КлючСвязи - УникальныйИдентификатор - Идентификатор строки продукции в заказе на производство
//  * Номенклатура - СправочникСсылка.Номенклатура - номенклатура продукции
//  * Характеристика - СправочникСсылка.ХарактеристикиНоменклатуры - характеристика продукции
//  * Подразделение - СправочникСсылка.СтруктураПредприятия - подразделение-получатель для работ
//  * Склад - СправочникСсылка.Склады - склад для продукции
//  * Назначение - СправочникСсылка.Назначения - назначение продукции заказа на производство
//  * НазначениеЗаказа - СправочникСсылка.Назначения - назначение заказа на производство.
// 
// Возвращаемое значение:
//   - Структура - данные по продукции.
//
Функция СтруктураДанныхПродукции(Знач ДанныеЗаполнения = Неопределено) Экспорт
	
	Возврат ПланированиеПроизводства.СтруктураДанныхПродукции(ДанныеЗаполнения);
	
КонецФункции

#КонецОбласти

#КонецОбласти

//-- НЕ УТКА

//-- Устарело_Производство21
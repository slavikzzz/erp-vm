
#Область СлужебныеПроцедурыИФункции

Процедура РегистрацияПерерасчетов() Экспорт
	
	// Регламентные задания блокируются на время служебных операций с информационной базой.
	ОбщегоНазначения.ПриНачалеВыполненияРегламентногоЗадания(Метаданные.РегламентныеЗадания.РегистрацияПерерасчетов);
	
	ПерерасчетЗарплаты.РегистрацияПерерасчетовПоПредварительнымДанным();
	
КонецПроцедуры

Процедура ИнициализироватьИсточникиПредварительныхПерерасчетовПередЗаписьюДокументаОбработчик(ДокументОбъект, Отказ, РежимЗаписи) Экспорт
	
	Если ЗарплатаКадры.ОтключитьБизнесЛогикуПриЗаписи(ДокументОбъект) Тогда
		Возврат;
	КонецЕсли;
	
	ПерерасчетЗарплаты.ИнициализироватьНаборыИсточникиПредварительныхПерерасчетов(ДокументОбъект, РежимЗаписи);
	
КонецПроцедуры

Процедура ЗаписатьПредварительныеПерерасчетыПриЗаписиНабораПриЗаписи(Источник, Отказ, Замещение) Экспорт
	
	Если ЗарплатаКадры.ОтключитьБизнесЛогикуПриЗаписи(Источник) Тогда
		Возврат;
	КонецЕсли;
	
	ПерерасчетЗарплаты.ЗарегистрироватьПредварительныеПерерасчетыПриЗаписиНабора(Источник);
	
КонецПроцедуры

Процедура ЗаписатьПредварительныеПерерасчетыПриПроведенииДокументаОбработчик(ДокументОбъект) Экспорт
	
	Если ЗарплатаКадры.ОтключитьБизнесЛогикуПриЗаписи(ДокументОбъект) Тогда
		Возврат;
	КонецЕсли;
	
	ПерерасчетЗарплаты.ЗарегистрироватьПредварительныеПерерасчетыПриПроведенииДокумента(ДокументОбъект);
	
КонецПроцедуры

Процедура ЗаписатьПредварительныеПерерасчетыПриОтменеПроведенияДокументаОбработчик(ДокументОбъект) Экспорт
	
	Если ЗарплатаКадры.ОтключитьБизнесЛогикуПриЗаписи(ДокументОбъект) Тогда
		Возврат;
	КонецЕсли;
	
	РегистрыИсточникиПредварительныхПерерасчетов = ПерерасчетЗарплаты.РегистрыИсточникиПредварительныхПерерасчетов();
	
	Для Каждого Набор Из ДокументОбъект.Движения Цикл
		Если РегистрыИсточникиПредварительныхПерерасчетов[Набор.Метаданные().Имя] = Истина 
			И Не Набор.ТаблицаИзменившихсяДанныхНабораСформирована() Тогда		
			Набор.Записывать = Истина
		КонецЕсли;	
	КонецЦикла;
	
	ПерерасчетЗарплаты.ЗарегистрироватьПредварительныеПерерасчетыПриПроведенииДокумента(ДокументОбъект);
	
КонецПроцедуры

#КонецОбласти
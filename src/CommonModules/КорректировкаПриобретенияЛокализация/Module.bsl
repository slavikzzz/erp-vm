#Область ПрограммныйИнтерфейс

#Область Проведение

// Описывает учетные механизмы используемые в документе для регистрации в механизме проведения.
//
// Параметры:
//  МеханизмыДокумента - Массив - список имен учетных механизмов, для которых будет выполнена
//              регистрация в механизме проведения.
//
Процедура ЗарегистрироватьУчетныеМеханизмы(МеханизмыДокумента) Экспорт
	
	//++ Локализация

	//++ НЕ УТ
	МеханизмыДокумента.Добавить("РегламентированныйУчет");
	МеханизмыДокумента.Добавить("ПрослеживаемостьИмпортныхТоваров");
	//-- НЕ УТ

	//-- Локализация
	
КонецПроцедуры

// Дополняет параметры выбора статей и аналитик в документе.
//
// Параметры:
// 	МассивПаметровВыбора - Массив из См. ДоходыИРасходыСервер.ПараметрыВыбораСтатьиИАналитики - 
// 	ПараметрыОпределенияДоступности - Структура:
// 	* ХозяйственнаяОперация - ПеречислениеСсылка.ХозяйственныеОперации -
//	* ДокументОснование - ДокументСсылка - 
//	* ДатаДокумента - Дата - 
//	* ОтразитьНаПрочихДоходах - Булево -
//	* СписатьНаРасходы - Булево -
Процедура ДополнитьПараметрыВыбораСтатейИАналитик(МассивПаметровВыбора, ПараметрыОпределенияДоступности) Экспорт
	
	//++ Локализация
	Для каждого ЭлементМассива Из МассивПаметровВыбора Цикл
		
		Если (ЭлементМассива.ПутьКДанным = "Объект.Товары" И ЭлементМассива.Статья = "СтатьяРасходов") 
			ИЛИ (ЭлементМассива.ПутьКДанным = "Объект.Расхождения" И ЭлементМассива.Статья = "СтатьяРасходов")
			Или (ЭлементМассива.ПутьКДанным = "ТаблицаКорректировки" И ЭлементМассива.Статья = "СтатьяРасходов") Тогда
			ЭлементМассива.ВыборСтатьиДоходов = Ложь;
		КонецЕсли;
		
	КонецЦикла;
	//-- Локализация
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытий

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый документ.
//  Отказ - Булево - Признак проведения документа.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то проведение документа выполнено не будет.
//  РежимПроведения - РежимПроведенияДокумента - В данный параметр передается текущий режим проведения.
//
Процедура ОбработкаПроведения(Объект, Отказ, РежимПроведения) Экспорт
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то будет выполнен отказ от продолжения работы после выполнения проверки заполнения.
//  ПроверяемыеРеквизиты - Массив - Массив путей к реквизитам, для которых будет выполнена проверка заполнения.
//
Процедура ОбработкаПроверкиЗаполнения(Объект, Отказ, ПроверяемыеРеквизиты) Экспорт
	
	//++ Локализация
	ДокументОснование = Объект.ДокументОснование;
	Если ТипЗнч(ДокументОснование) <> Тип("ДокументСсылка.ПервичныйДокумент") Тогда
		УчетПрослеживаемыхТоваровЛокализация.ПроверитьЗаполнениеКоличестваПоРНПТ(Объект, Отказ, Неопределено);
	КонецЕсли;
	
	//++ НЕ УТ
	
	Если ТипЗнч(ДокументОснование) = Тип("ДокументСсылка.ПриобретениеУслугПрочихАктивов") Тогда
		ПроверитьЗаполнениеКоличестваПоРНПТ(Объект, Отказ);
	КонецЕсли;
	
	//-- НЕ УТ
	
	Если ТипЗнч(ДокументОснование) = Тип("ДокументСсылка.ПриобретениеТоваровУслуг") И ЗначениеЗаполнено(ДокументОснование)
		И ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ДокументОснование, "ХозяйственнаяОперация") <> Перечисления.ХозяйственныеОперации.ЗакупкаПоИмпорту Тогда
		
		УчетПрослеживаемыхТоваровЛокализация.ПроверитьДанныеПрослеживаемостиНомеровГТД(Объект, Объект.Товары, Объект.Дата);
		
	КонецЕсли;
	//-- Локализация
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект.
//  ДанныеЗаполнения - Произвольный - Значение, которое используется как основание для заполнения.
//  СтандартнаяОбработка - Булево - В данный параметр передается признак выполнения стандартной (системной) обработки события.
//
Процедура ОбработкаЗаполнения(Объект, ДанныеЗаполнения, СтандартнаяОбработка) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Признак отказа от записи.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то запись выполнена не будет и будет вызвано исключение.
//
Процедура ОбработкаУдаленияПроведения(Объект, Отказ) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Признак отказа от записи.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то запись выполнена не будет и будет вызвано исключение.
//  РежимЗаписи - РежимЗаписиДокумента - В параметр передается текущий режим записи документа. Позволяет определить в теле процедуры режим записи.
//  РежимПроведения - РежимПроведенияДокумента - В данный параметр передается текущий режим проведения.
//
Процедура ПередЗаписью(Объект, Отказ, РежимЗаписи, РежимПроведения) Экспорт
	
	//++ Локализация
	
	//++ НЕ УТ
	
	Если Объект.ВидКорректировки = Перечисления.ХозяйственныеОперации.ИсправлениеОшибок Тогда
		
		ПрослеживаемостьУП.ДобавитьСвойствоЗаписыватьВРасширенныйРегистр(Объект);
		
	КонецЕсли;
	
	//-- НЕ УТ

	//-- Локализация
			
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  Отказ - Булево - Признак отказа от записи.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина, то запись выполнена не будет и будет вызвано исключение.
//
Процедура ПриЗаписи(Объект, Отказ) Экспорт
	
	
КонецПроцедуры

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый объект
//  ОбъектКопирования - ДокументОбъект - Исходный документ, который является источником копирования.
//
Процедура ПриКопировании(Объект, ОбъектКопирования) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

#Область ПодключаемыеКоманды

// Определяет список команд создания на основании.
//
// Параметры:
//  КомандыСозданияНаОсновании - см. СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании.КомандыСозданияНаОсновании
//  Параметры - см. СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании.Параметры
//
Процедура ДобавитьКомандыСозданияНаОсновании(КомандыСозданияНаОсновании, Параметры) Экспорт
	
	
КонецПроцедуры

// Добавляет команду создания документа "Авансовый отчет".
//
// Параметры:
//  КомандыСозданияНаОсновании - см. СозданиеНаОснованииПереопределяемый.ПередДобавлениемКомандСозданияНаОсновании.КомандыСозданияНаОсновании
//
Процедура ДобавитьКомандуСоздатьНаОсновании(КомандыСозданияНаОсновании) Экспорт


КонецПроцедуры

// Определяет список команд отчетов.
//
// Параметры:
//   КомандыОтчетов - См. ВариантыОтчетовПереопределяемый.ПередДобавлениемКомандОтчетов.КомандыОтчетов
//   Параметры - См. ВариантыОтчетовПереопределяемый.ПередДобавлениемКомандОтчетов.Параметры
//
Процедура ДобавитьКомандыОтчетов(КомандыОтчетов, Параметры) Экспорт
	
	
КонецПроцедуры

// Заполняет список команд печати.
//
// Параметры:
//   КомандыПечати - см. УправлениеПечатью.СоздатьКоллекциюКомандПечати
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	//++ Локализация
	Если ПолучитьФункциональнуюОпцию("ИспользоватьОтветственноеХранение") Тогда
		// МХ-1
		КомандаПечати = КомандыПечати.Добавить();
		КомандаПечати.МенеджерПечати = "Обработка.ПечатьОбщихФорм";
		КомандаПечати.Идентификатор = "МХ1";
		КомандаПечати.Представление = НСтр("ru = 'Акт о приеме-передаче ТМЦ на хранение (МХ-1)';
											|en = 'Certificate of inventory handover for storage (MH-1)'");
		КомандаПечати.ПроверкаПроведенияПередПечатью = Истина;
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьОтветственноеХранение") Тогда
		// МХ-3
		КомандаПечати = КомандыПечати.Добавить();
		КомандаПечати.МенеджерПечати = "Обработка.ПечатьОбщихФорм";
		КомандаПечати.Идентификатор = "МХ3";
		КомандаПечати.Представление = НСтр("ru = 'Акт о возврате ТМЦ, сданных на хранение (МХ-3)';
											|en = 'Certificate of stored inventory return (MH-3)'");
		КомандаПечати.ПроверкаПроведенияПередПечатью = Истина;
	КонецЕсли;
	//-- Локализация
КонецПроцедуры

#КонецОбласти

#Область Печать

// Формирует печатные формы.
//
// Параметры:
//  МассивОбъектов  - Массив    - ссылки на объекты, которые нужно распечатать;
//  ПараметрыПечати - Структура - дополнительные настройки печати;
//  КоллекцияПечатныхФорм - ТаблицаЗначений - сформированные табличные документы (выходной параметр)
//  ОбъектыПечати         - СписокЗначений  - значение - ссылка на объект;
//                                            представление - имя области в которой был выведен объект (выходной параметр);
//  ПараметрыВывода       - Структура       - дополнительные параметры сформированных табличных документов (выходной параметр).
//
Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	//++ Локализация
	//-- Локализация
КонецПроцедуры

//++ Локализация

// Возвращает данные для формирования печатной формы МХ - 1.
//
// Параметры:
//	ПараметрыПечати	- Структура -дополнительные настройки печати.
//	МассивОбъектов	- Массив из ДокументСсылка.КорректировкаПриобретения - коллекция значений ссылок на документы,
//																			по которым необходимо получить данные.
//
// Возвращаемое значение:
//	Структура - коллекция данных, используемых для печати, содержащая следующие следующие свойства:
//		* РезультатПоШапке			- РезультатЗапроса - данные шапки документа.
//		* РезультатПоСкладам		- РезультатЗапроса - данные о складе ответственного хранения.
//		* РезультатПоТабличнойЧасти	- РезультатЗапроса - данные табличной части документа.
//		* РезультатПоОшибкам		- РезультатЗапроса - данные об ошибках, возникающих при печати документа.
//
Функция ПолучитьДанныеДляПечатнойФормыМХ1(ПараметрыПечати, МассивОбъектов) Экспорт
	
	КолонкаКодов = ФормированиеПечатныхФорм.ДополнительнаяКолонкаПечатныхФормДокументов().ИмяКолонки;
	
	Если Не ЗначениеЗаполнено(КолонкаКодов) Тогда
		КолонкаКодов = "Код";
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеДокумента.Ссылка									КАК Ссылка,
	|	ДанныеДокумента.Номер									КАК Номер,
	|	ДанныеДокумента.Дата									КАК Дата,
	|	ДанныеДокумента.Дата									КАК ДатаДокумента,
	|	ДанныеДокумента.Организация								КАК Организация,
	|	ДанныеДокумента.Организация.Префикс						КАК Префикс,
	|	ТоварыДокумента.Склад									КАК Склад,
	|	ЕСТЬNULL(Склады.СкладОтветственногоХранения, ЛОЖЬ)		КАК СкладОтветственногоХранения,
	|	ДанныеДокумента.Организация = Склады.Поклажедержатель	КАК ОрганизацияПоклажедержатель,
	|	Склады.ИсточникИнформацииОЦенахДляПечати				КАК ИсточникИнформацииОЦенахДляПечати,
	|	Склады.УчетныйВидЦены									КАК ВидЦены,
	|	Склады.УчетныйВидЦены.ВалютаЦены						КАК ВалютаЦены,
	|	РасчетСебестоимостиТоваровОрганизации.Ссылка.ПредварительныйРасчет	КАК ПредварительныйРасчет,
	|	ДанныеДокумента.Дата									КАК ДатаПолученияСебестоимости
	|ПОМЕСТИТЬ ДанныеДокумента
	|ИЗ
	|	Документ.КорректировкаПриобретения.Товары КАК ТоварыДокумента
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК ДанныеДокумента
	|		ПО ТоварыДокумента.Ссылка = ДанныеДокумента.Ссылка
	|		
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РасчетСебестоимостиТоваров.Организации КАК РасчетСебестоимостиТоваровОрганизации
	|		ПО РасчетСебестоимостиТоваровОрганизации.Ссылка.Дата МЕЖДУ НАЧАЛОПЕРИОДА(ДанныеДокумента.Дата, МЕСЯЦ) И КОНЕЦПЕРИОДА(ДанныеДокумента.Дата, МЕСЯЦ)
	|			И РасчетСебестоимостиТоваровОрганизации.Ссылка.Проведен
	|			И ДанныеДокумента.Организация = РасчетСебестоимостиТоваровОрганизации.Организация
	|		
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
	|		ПО ТоварыДокумента.Склад = Склады.Ссылка
	|ГДЕ
	|	ДанныеДокумента.Проведен
	|	И ДанныеДокумента.Ссылка В(&МассивДокументов)
	|;
	|
	|//////////////////////////////////////////////////////////////////////////////// 1
	|ВЫБРАТЬ
	|	ДанныеДокумента.Ссылка								КАК Ссылка,
	|	ДанныеДокумента.Номер								КАК Номер,
	|	ДанныеДокумента.Дата								КАК Дата,
	|	ДанныеДокумента.ДатаДокумента						КАК ДатаДокумента,
	|	ДанныеДокумента.Организация							КАК Организация,
	|	ДанныеДокумента.Префикс								КАК Префикс,
	|	ДанныеДокумента.Склад								КАК Склад,
	|	ДанныеДокумента.ИсточникИнформацииОЦенахДляПечати	КАК ИсточникИнформацииОЦенахДляПечати,
	|	ДанныеДокумента.ВидЦены								КАК ВидЦены,
	|	ДанныеДокумента.ВалютаЦены							КАК ВалютаЦены,
	|	ДанныеДокумента.ПредварительныйРасчет				КАК ПредварительныйРасчет,
	|	ДанныеДокумента.ДатаПолученияСебестоимости			КАК ДатаПолученияСебестоимости
	|ПОМЕСТИТЬ ВтШапка
	|ИЗ
	|	ДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.СкладОтветственногоХранения
	|	И НЕ ДанныеДокумента.ОрганизацияПоклажедержатель
	|;
	|
	|//////////////////////////////////////////////////////////////////////////////// 2
	|ВЫБРАТЬ
	|	Товары.Ссылка КАК Ссылка,
	|	Товары.Склад КАК Склад,
	|	Товары.Упаковка КАК Упаковка,
	|	Товары.Серия КАК Серия,
	|	Товары.НомерСтроки КАК НомерСтроки,
	|	Товары.Номенклатура КАК Номенклатура,
	|	Товары.Характеристика КАК Характеристика,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения1 КАК ЕдиницаИзмеренияНаименование,
	|	&ТекстЗапросаКодЕдиницыИзмерения1 КАК ЕдиницаИзмеренияКод,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения1 КАК ВидУпаковки,
	|	Товары.КоличествоУпаковок КАК КоличествоУпаковок,
	|	Товары.Количество КАК Количество,
	|	КОНЕЦПЕРИОДА(Товары.Ссылка.Дата, ДЕНЬ) КАК ДатаПолученияЦены,
	|	Шапка.ВидЦены КАК ВидЦены,
	|	Шапка.ВалютаЦены КАК ВалютаЦены
	|ПОМЕСТИТЬ ВтТовары
	|ИЗ
	|	Документ.КорректировкаПриобретения.Расхождения КАК Товары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтШапка КАК Шапка
	|		ПО Товары.Склад = Шапка.Склад
	|			И Товары.Ссылка = Шапка.Ссылка
	|ГДЕ
	|	Товары.Номенклатура.ТипНоменклатуры В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар), ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|	И (Шапка.ИсточникИнформацииОЦенахДляПечати = ЗНАЧЕНИЕ(Перечисление.ИсточникиИнформацииОЦенахДляПечати.ПоВидуЦен)
	|		ИЛИ (Шапка.ИсточникИнформацииОЦенахДляПечати = ЗНАЧЕНИЕ(Перечисление.ИсточникиИнформацииОЦенахДляПечати.ПоСебестоимости)
	|			И Шапка.ПредварительныйРасчет ЕСТЬ NULL))
	|	И (Товары.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УвеличитьЗакупкуУвеличитьСкладскиеОстатки)
	|		ИЛИ Товары.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УвеличитьЗакупкуУчестьПриИнвентаризации))
	|;
	|
	|//////////////////////////////////////////////////////////////////////////////// 3
	|ВЫБРАТЬ
	|	ВидыЗапасов.Ссылка КАК Ссылка,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ВидыЗапасов.ВидЗапасов КАК ВидЗапасов,
	|	Шапка.Организация КАК Организация,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория КАК Склад,
	|	ВидыЗапасов.Упаковка КАК Упаковка,
	|	ВидыЗапасов.НомерСтроки КАК НомерСтроки,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения2 КАК ЕдиницаИзмеренияНаименование,
	|	&ТекстЗапросаКодЕдиницыИзмерения2 КАК ЕдиницаИзмеренияКод,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения2 КАК ВидУпаковки,
	|	ВидыЗапасов.КоличествоУпаковок КАК КоличествоУпаковок,
	|	ВидыЗапасов.Количество КАК Количество,
	|	КОНЕЦПЕРИОДА(ВидыЗапасов.Ссылка.Дата, ДЕНЬ) КАК ДатаПолученияЦены,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория.УчетныйВидЦены КАК ВидЦены,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория.УчетныйВидЦены.ВалютаЦены КАК ВалютаЦены,
	|	Шапка.ПредварительныйРасчет КАК ПредварительныйРасчет
	|ПОМЕСТИТЬ ВтВидыЗапасов
	|ИЗ
	|	Документ.КорректировкаПриобретения.Расхождения КАК ВидыЗапасов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтШапка КАК Шапка
	|		ПО ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория = Шапка.Склад
	|			И ВидыЗапасов.Ссылка = Шапка.Ссылка
	|ГДЕ
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар), ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|	И ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ИсточникИнформацииОЦенахДляПечати = ЗНАЧЕНИЕ(Перечисление.ИсточникиИнформацииОЦенахДляПечати.ПоСебестоимости)
	|	И (ВидыЗапасов.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УвеличитьЗакупкуУвеличитьСкладскиеОстатки)
	|		ИЛИ ВидыЗапасов.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УвеличитьЗакупкуУчестьПриИнвентаризации))
	|;
	|";
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаНаименованиеЕдиницыИзмерения1",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Наименование", "Товары.Упаковка", "Товары.Номенклатура"));
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаКодЕдиницыИзмерения1",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Код", "Товары.Упаковка", "Товары.Номенклатура"));
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаНаименованиеЕдиницыИзмерения2",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Наименование", "ВидыЗапасов.Упаковка", "ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура"));
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаКодЕдиницыИзмерения2",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Код", "ВидыЗапасов.Упаковка", "ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура"));
	
	СкладыСервер.ДополнитьТекстЗапросаДляПечатныхФормМХ1Х3(Запрос);
	
	Запрос.УстановитьПараметр("МассивДокументов", МассивОбъектов);
	Запрос.УстановитьПараметр("КолонкаКодов", КолонкаКодов);
	
	МассивРезультатов = Запрос.ВыполнитьПакет();
	РезультатПоШапке			= МассивРезультатов[МассивРезультатов.ВГраница() - 3];
	РезультатПоСкладам			= МассивРезультатов[МассивРезультатов.ВГраница() - 2];
	РезультатПоТабличнойЧасти	= МассивРезультатов[МассивРезультатов.ВГраница() - 1];
	РезультатПоОшибкам			= МассивРезультатов[МассивРезультатов.ВГраница()];
	
	СтруктураДанныхДляПечати = Новый Структура;
	СтруктураДанныхДляПечати.Вставить("РезультатПоШапке",			РезультатПоШапке);
	СтруктураДанныхДляПечати.Вставить("РезультатПоСкладам",			РезультатПоСкладам);
	СтруктураДанныхДляПечати.Вставить("РезультатПоТабличнойЧасти",	РезультатПоТабличнойЧасти);
	СтруктураДанныхДляПечати.Вставить("РезультатПоОшибкам",			РезультатПоОшибкам);
	
	Возврат СтруктураДанныхДляПечати;
	
КонецФункции

// Возвращает данные для формирования печатной формы МХ - 3.
//
// Параметры:
//	ПараметрыПечати	- Структура -дополнительные настройки печати.
//	МассивОбъектов	- Массив из ДокументСсылка.КорректировкаПриобретения - коллекция значений ссылок на документы,
//																			по которым необходимо получить данные.
//
// Возвращаемое значение:
//	Структура - коллекция данных, используемых для печати, содержащая следующие следующие свойства:
//		* РезультатПоШапке			- РезультатЗапроса - данные шапки документа.
//		* РезультатПоСкладам		- РезультатЗапроса - данные о складе ответственного хранения.
//		* РезультатПоТабличнойЧасти	- РезультатЗапроса - данные табличной части документа.
//		* РезультатПоОшибкам		- РезультатЗапроса - данные об ошибках, возникающих при печати документа.
//
Функция ПолучитьДанныеДляПечатнойФормыМХ3(ПараметрыПечати, МассивОбъектов) Экспорт
	
	КолонкаКодов = ФормированиеПечатныхФорм.ДополнительнаяКолонкаПечатныхФормДокументов().ИмяКолонки;
	
	Если Не ЗначениеЗаполнено(КолонкаКодов) Тогда
		КолонкаКодов = "Код";
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеДокумента.Ссылка									КАК Ссылка,
	|	ДанныеДокумента.Номер									КАК Номер,
	|	ДанныеДокумента.Дата									КАК Дата,
	|	ДанныеДокумента.Дата									КАК ДатаДокумента,
	|	ДанныеДокумента.Организация								КАК Организация,
	|	ДанныеДокумента.Организация.Префикс						КАК Префикс,
	|	ТоварыДокумента.Склад									КАК Склад,
	|	ЕСТЬNULL(Склады.СкладОтветственногоХранения, ЛОЖЬ)		КАК СкладОтветственногоХранения,
	|	ДанныеДокумента.Организация = Склады.Поклажедержатель	КАК ОрганизацияПоклажедержатель,
	|	Склады.ИсточникИнформацииОЦенахДляПечати				КАК ИсточникИнформацииОЦенахДляПечати,
	|	Склады.УчетныйВидЦены									КАК ВидЦены,
	|	Склады.УчетныйВидЦены.ВалютаЦены						КАК ВалютаЦены,
	|	РасчетСебестоимостиТоваровОрганизации.Ссылка.ПредварительныйРасчет	КАК ПредварительныйРасчет,
	|	ДанныеДокумента.Дата									КАК ДатаПолученияСебестоимости
	|ПОМЕСТИТЬ ДанныеДокумента
	|ИЗ
	|	Документ.КорректировкаПриобретения.Товары КАК ТоварыДокумента
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК ДанныеДокумента
	|		ПО ТоварыДокумента.Ссылка = ДанныеДокумента.Ссылка
	|		
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РасчетСебестоимостиТоваров.Организации КАК РасчетСебестоимостиТоваровОрганизации
	|		ПО РасчетСебестоимостиТоваровОрганизации.Ссылка.Дата МЕЖДУ НАЧАЛОПЕРИОДА(ДанныеДокумента.Дата, МЕСЯЦ) И КОНЕЦПЕРИОДА(ДанныеДокумента.Дата, МЕСЯЦ)
	|			И РасчетСебестоимостиТоваровОрганизации.Ссылка.Проведен
	|			И ДанныеДокумента.Организация = РасчетСебестоимостиТоваровОрганизации.Организация
	|		
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
	|		ПО ТоварыДокумента.Склад = Склады.Ссылка
	|ГДЕ
	|	ДанныеДокумента.Проведен
	|	И ДанныеДокумента.Ссылка В(&МассивДокументов)
	|;
	|
	|//////////////////////////////////////////////////////////////////////////////// 1
	|ВЫБРАТЬ
	|	ДанныеДокумента.Ссылка								КАК Ссылка,
	|	ДанныеДокумента.Номер								КАК Номер,
	|	ДанныеДокумента.Дата								КАК Дата,
	|	ДанныеДокумента.ДатаДокумента						КАК ДатаДокумента,
	|	ДанныеДокумента.Организация							КАК Организация,
	|	ДанныеДокумента.Префикс								КАК Префикс,
	|	ДанныеДокумента.Склад								КАК Склад,
	|	ДанныеДокумента.ИсточникИнформацииОЦенахДляПечати	КАК ИсточникИнформацииОЦенахДляПечати,
	|	ДанныеДокумента.ВидЦены								КАК ВидЦены,
	|	ДанныеДокумента.ВалютаЦены							КАК ВалютаЦены,
	|	ДанныеДокумента.ПредварительныйРасчет				КАК ПредварительныйРасчет,
	|	ДанныеДокумента.ДатаПолученияСебестоимости			КАК ДатаПолученияСебестоимости
	|ПОМЕСТИТЬ ВтШапка
	|ИЗ
	|	ДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.СкладОтветственногоХранения
	|	И НЕ ДанныеДокумента.ОрганизацияПоклажедержатель
	|;
	|
	|//////////////////////////////////////////////////////////////////////////////// 2
	|ВЫБРАТЬ
	|	Товары.Ссылка КАК Ссылка,
	|	Товары.Склад КАК Склад,
	|	Товары.Упаковка КАК Упаковка,
	|	Товары.Серия КАК Серия,
	|	Товары.НомерСтроки КАК НомерСтроки,
	|	Товары.Номенклатура КАК Номенклатура,
	|	Товары.Характеристика КАК Характеристика,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения1 КАК ЕдиницаИзмеренияНаименование,
	|	&ТекстЗапросаКодЕдиницыИзмерения1 КАК ЕдиницаИзмеренияКод,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения1 КАК ВидУпаковки,
	|	-Товары.КоличествоУпаковок КАК КоличествоУпаковок,
	|	-Товары.Количество КАК Количество,
	|	КОНЕЦПЕРИОДА(Товары.Ссылка.Дата, ДЕНЬ) КАК ДатаПолученияЦены,
	|	Шапка.ВидЦены КАК ВидЦены,
	|	Шапка.ВалютаЦены КАК ВалютаЦены
	|ПОМЕСТИТЬ ВтТовары
	|ИЗ
	|	Документ.КорректировкаПриобретения.Расхождения КАК Товары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтШапка КАК Шапка
	|		ПО Товары.Склад = Шапка.Склад
	|			И Товары.Ссылка = Шапка.Ссылка
	|ГДЕ
	|	Товары.Номенклатура.ТипНоменклатуры В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар), ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|	И (Шапка.ИсточникИнформацииОЦенахДляПечати = ЗНАЧЕНИЕ(Перечисление.ИсточникиИнформацииОЦенахДляПечати.ПоВидуЦен)
	|		ИЛИ (Шапка.ИсточникИнформацииОЦенахДляПечати = ЗНАЧЕНИЕ(Перечисление.ИсточникиИнформацииОЦенахДляПечати.ПоСебестоимости)
	|			И Шапка.ПредварительныйРасчет ЕСТЬ NULL))
	|	И (Товары.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УменьшитьЗакупкуУменьшитьСкладскиеОстатки)
	|		ИЛИ Товары.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УменьшитьЗакупкуУчестьПриИнвентаризации))
	|;
	|
	|//////////////////////////////////////////////////////////////////////////////// 3
	|ВЫБРАТЬ
	|	ВидыЗапасов.Ссылка КАК Ссылка,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ВидыЗапасов.ВидЗапасов КАК ВидЗапасов,
	|	Шапка.Организация КАК Организация,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория КАК Склад,
	|	ВидыЗапасов.Упаковка КАК Упаковка,
	|	ВидыЗапасов.НомерСтроки КАК НомерСтроки,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения2 КАК ЕдиницаИзмеренияНаименование,
	|	&ТекстЗапросаКодЕдиницыИзмерения2 КАК ЕдиницаИзмеренияКод,
	|	&ТекстЗапросаНаименованиеЕдиницыИзмерения2 КАК ВидУпаковки,
	|	ВидыЗапасов.КоличествоУпаковок КАК КоличествоУпаковок,
	|	ВидыЗапасов.Количество КАК Количество,
	|	КОНЕЦПЕРИОДА(ВидыЗапасов.Ссылка.Дата, ДЕНЬ) КАК ДатаПолученияЦены,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория.УчетныйВидЦены КАК ВидЦены,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория.УчетныйВидЦены.ВалютаЦены КАК ВалютаЦены,
	|	Шапка.ПредварительныйРасчет КАК ПредварительныйРасчет
	|ПОМЕСТИТЬ ВтВидыЗапасов
	|ИЗ
	|	Документ.КорректировкаПриобретения.Расхождения КАК ВидыЗапасов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтШапка КАК Шапка
	|		ПО ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория = Шапка.Склад
	|			И ВидыЗапасов.Ссылка = Шапка.Ссылка
	|ГДЕ
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар), ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|	И ВидыЗапасов.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ИсточникИнформацииОЦенахДляПечати = ЗНАЧЕНИЕ(Перечисление.ИсточникиИнформацииОЦенахДляПечати.ПоСебестоимости)
	|	И (ВидыЗапасов.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УменьшитьЗакупкуУменьшитьСкладскиеОстатки)
	|		ИЛИ ВидыЗапасов.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УменьшитьЗакупкуУчестьПриИнвентаризации))
	|;
	|";
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаНаименованиеЕдиницыИзмерения1",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Наименование", "Товары.Упаковка", "Товары.Номенклатура"));
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаКодЕдиницыИзмерения1",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Код", "Товары.Упаковка", "Товары.Номенклатура"));
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаНаименованиеЕдиницыИзмерения2",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Наименование", "ВидыЗапасов.Упаковка", "ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура"));
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ТекстЗапросаКодЕдиницыИзмерения2",
		Справочники.УпаковкиЕдиницыИзмерения.ТекстЗапросаЗначениеРеквизитаЕдиницыИзмерения(
			"Код", "ВидыЗапасов.Упаковка", "ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура"));
	
	СкладыСервер.ДополнитьТекстЗапросаДляПечатныхФормМХ1Х3(Запрос);
	
	Запрос.УстановитьПараметр("МассивДокументов", МассивОбъектов);
	Запрос.УстановитьПараметр("КолонкаКодов", КолонкаКодов);
	
	МассивРезультатов = Запрос.ВыполнитьПакет();
	РезультатПоШапке			= МассивРезультатов[МассивРезультатов.ВГраница() - 3];
	РезультатПоСкладам			= МассивРезультатов[МассивРезультатов.ВГраница() - 2];
	РезультатПоТабличнойЧасти	= МассивРезультатов[МассивРезультатов.ВГраница() - 1];
	РезультатПоОшибкам			= МассивРезультатов[МассивРезультатов.ВГраница()];
	
	СтруктураДанныхДляПечати = Новый Структура;
	СтруктураДанныхДляПечати.Вставить("РезультатПоШапке",			РезультатПоШапке);
	СтруктураДанныхДляПечати.Вставить("РезультатПоСкладам",			РезультатПоСкладам);
	СтруктураДанныхДляПечати.Вставить("РезультатПоТабличнойЧасти",	РезультатПоТабличнойЧасти);
	СтруктураДанныхДляПечати.Вставить("РезультатПоОшибкам",			РезультатПоОшибкам);
	
	Возврат СтруктураДанныхДляПечати;
	
КонецФункции
//-- Локализация
#КонецОбласти

//++ НЕ УТ
#Область ПроводкиРегУчета

// Функция возвращает текст запроса для отражения документа в регламентированном учете.
//
// Возвращаемое значение:
//	Строка - Текст запроса
//
Функция ТекстОтраженияВРеглУчете() Экспорт
	
	ТекстыОтражения = Новый Массив;
	
	//++ Локализация
	
	ТекстыОтражения.Добавить(КорректировкаТоваров());
	ТекстыОтражения.Добавить(КорректировкаНаДоходыПоДокументу());
	ТекстыОтражения.Добавить(КорректировкаТоваровДвухходовка());
	ТекстыОтражения.Добавить(КорректировкаРаботУслугДвухходовка());
	ТекстыОтражения.Добавить(КорректировкаТоваровДвухходовкаДоходы());
	ТекстыОтражения.Добавить(ОтклоненияВСтоимостиПриФактуровке());
	ТекстыОтражения.Добавить(КорректировкаУслугНаРасходы());
	ТекстыОтражения.Добавить(КорректировкаУслугНаРасходыНоваяПереработка());
	ТекстыОтражения.Добавить(КорректировкаНаДоходыПоСтрокам());
	ТекстыОтражения.Добавить(ЗакупкаНДС());
	ТекстыОтражения.Добавить(КорректировкаНДС());
	ТекстыОтражения.Добавить(ЗачетАванса());
	ТекстыОтражения.Добавить(ВыделениеАванса());
	ТекстыОтражения.Добавить(ТекстОтклонениеВСтоимостиРасходы()); // Отклонение в стоимости возвращенных товаров (расходы) (Дт 44.01 :: Кт 41.01, 20, 76.ОК)
	ТекстыОтражения.Добавить(ТекстОтклонениеВСтоимостиДоходы()); // Отклонение в стоимости возвращенных товаров (доходы) (Дт 41.01, 20, 76.ОК :: Кт 91.01)
	ТекстыОтражения.Добавить(ТекстКорректировкаНеСобственногоТовара()); // Приход товаров за балансом (Дт 002, 003, 004 :: Кт)
	ТекстыОтражения.Добавить(ТекстПроцентыПоДисконтированию());
	ТекстыОтражения.Добавить(ТекстВключениеНДСпоПриобретеннымЦенностям());

	ТекстыОтражения.Добавить(РеглУчетВыборкиСерверПовтИсп.ТекстВключениеНДСпоПриобретеннымЦенностям());
	
	//-- Локализация
	
	Возврат СтрСоединить(ТекстыОтражения, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());
	
КонецФункции

// Функция возвращает текст запроса дополнительных временных таблиц,
// необходимых для отражения в регламентированном учете
//
// Возвращаемое значение:
//   Строка - сформированный текст запроса.
//
Функция ТекстЗапросаВТОтраженияВРеглУчете() Экспорт
	
	ТекстыЗапроса = Новый Массив;
	
	//++ Локализация
	
	#Область РасчетыСПоставщиками
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	КорректировкаПриобретения.Ссылка КАК Ссылка,
	|	ЕСТЬNULL(ДоговорыНеотфактуровки.Подразделение, ЕСТЬNULL(ОбъектыРасчетов.Подразделение,
	|		КорректировкаПриобретения.Подразделение)) КАК Подразделение,
	|	ЕСТЬNULL(ДоговорыНеотфактуровки.ГруппаФинансовогоУчета, ЕСТЬNULL(ОбъектыРасчетов.ГруппаФинансовогоУчета,
	|		ЕСТЬNULL(Договоры.ГруппаФинансовогоУчета, ПриобретениеТоваровУслуг.ГруппаФинансовогоУчета))) КАК ГруппаФинансовогоУчета,
	|	ЕСТЬNULL(ДоговорыНеотфактуровки.НаправлениеДеятельности, ЕСТЬNULL(ОбъектыРасчетов.НаправлениеДеятельности,
	|		ЕСТЬNULL(Договоры.НаправлениеДеятельности, ПриобретениеТоваровУслуг.НаправлениеДеятельности))) КАК НаправлениеДеятельности,
	|	КорректировкаПриобретения.ЗакупкаПодДеятельность КАК ЗакупкаПодДеятельность,
	|	ЕСТЬNULL(ОбъектыРасчетов.Контрагент, КорректировкаПриобретения.Контрагент) КАК Контрагент,
	|	ЕСТЬNULL(ОбъектыРасчетов.Договор, КорректировкаПриобретения.Договор) КАК Договор,
	|	ЕСТЬNULL(ПриобретениеТоваровУслуг.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) В
	|		(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки)) КАК КорректировкаФактуровкиПоставки,
	|	ЕСТЬNULL(ПриобретениеТоваровУслуг.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) В
	|		(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути)) КАК КорректировкаТоваровВПути,
	|	ЕСТЬNULL(ПриобретениеТоваровУслуг.ВернутьМногооборотнуюТару, ЛОЖЬ) КАК ВернутьМногооборотнуюТару,
	|	НЕ Расчеты.Регистратор ЕСТЬ NULL КАК ЕстьВзаиморасчеты
	|	
	|ПОМЕСТИТЬ Расчеты
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК КорректировкаПриобретения
	|		ПО ДокументыКОтражению.Ссылка = КорректировкаПриобретения.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПриобретениеТоваровУслуг
	|		ПО КорректировкаПриобретения.ДокументОснование = ПриобретениеТоваровУслуг.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСПоставщиками КАК Расчеты
	|		ПО КорректировкаПриобретения.Ссылка = Расчеты.Регистратор
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
	|	ПО (Расчеты.ОбъектРасчетов = ОбъектыРасчетов.Ссылка)
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК Договоры
	|	ПО (КорректировкаПриобретения.Договор = Договоры.Ссылка)
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыНеотфактуровки
	|	ПО КорректировкаПриобретения.Договор = ДоговорыНеотфактуровки.Ссылка
	|		И ЕСТЬNULL(ПриобретениеТоваровУслуг.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) В
	|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки))
	|ГДЕ
	|	ЕСТЬNULL(ОбъектыРасчетов.Организация, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Справочник.Организации.УправленческаяОрганизация)
	|	И НЕ ЕСТЬNULL(Расчеты.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПереносАванса),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВзаимозачетЗадолженности))
	|	
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса);
	
	#КонецОбласти
	
	#Область СтрокиНДС
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	КорректировкаПриобретенияРасхождения.Ссылка 				КАК Ссылка,
	|	КорректировкаПриобретенияРасхождения.ИдентификаторСтроки 	КАК ИдентификаторСтроки,
	|	КорректировкаПриобретенияРасхождения.Количество 			КАК Количество,
	|	КорректировкаПриобретенияРасхождения.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов
	|ПОМЕСТИТЬ СтрокиНДС
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения.Расхождения КАК КорректировкаПриобретенияРасхождения
	|		ПО ДокументыКОтражению.Ссылка = КорректировкаПриобретенияРасхождения.Ссылка
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	КорректировкаПриобретенияВидыЗапасов.Ссылка                	КАК Ссылка,
	|	КорректировкаПриобретенияВидыЗапасов.ИдентификаторСтроки   	КАК ИдентификаторСтроки,
	|	КорректировкаПриобретенияВидыЗапасов.Количество            	КАК Количество,
	|	КорректировкаПриобретенияВидыЗапасов.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения.ВидыЗапасов КАК КорректировкаПриобретенияВидыЗапасов
	|		ПО ДокументыКОтражению.Ссылка = КорректировкаПриобретенияВидыЗапасов.Ссылка";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса);
	
	#КонецОбласти
	
	#Область РасчетыСПоставщикамиПоДокументам
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Расчеты.Регистратор КАК Ссылка,
	|	ОбъектыРасчетов.Организация КАК Организация,
	|	ОбъектыРасчетов.Контрагент КАК Контрагент,
	|	ОбъектыРасчетов.Договор КАК Договор,
	|	ОбъектыРасчетов.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	Расчеты.ЗаказПоставщику КАК ОбъектРасчетов,
	|	ОбъектыРасчетов.ГруппаФинансовогоУчета КАК ГруппаФинансовогоУчета,
	|	ОбъектыРасчетов.Подразделение КАК Подразделение,
	|	Расчеты.Валюта КАК Валюта,
	|	СУММА(ВЫБОР КОГДА Расчеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА Расчеты.Предоплата ИНАЧЕ -Расчеты.Предоплата КОНЕЦ) КАК Предоплата,
	|	СУММА(ВЫБОР КОГДА Расчеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА Расчеты.ПредоплатаУпр ИНАЧЕ -Расчеты.ПредоплатаУпр КОНЕЦ) КАК ПредоплатаУпр,
	|	СУММА(ВЫБОР КОГДА Расчеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА Расчеты.ПредоплатаРегл ИНАЧЕ -Расчеты.ПредоплатаРегл КОНЕЦ) КАК ПредоплатаРегл,
	|	СУММА(ВЫБОР КОГДА Расчеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА Расчеты.Долг ИНАЧЕ -Расчеты.Долг КОНЕЦ) КАК Долг,
	|	СУММА(ВЫБОР КОГДА Расчеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА Расчеты.ДолгУпр ИНАЧЕ -Расчеты.ДолгУпр КОНЕЦ) КАК ДолгУпр,
	|	СУММА(ВЫБОР КОГДА Расчеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА Расчеты.ДолгРегл ИНАЧЕ -Расчеты.ДолгРегл КОНЕЦ) КАК ДолгРегл
	|ПОМЕСТИТЬ РасчетыСПоставщикамиПоДокументам
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.РасчетыСПоставщикамиПоДокументам КАК Расчеты
	|	ПО
	|		ДокументыКОтражению.Ссылка = Расчеты.Регистратор
	|		И НЕ &НоваяАрхитектураВзаиморасчетов
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
	|	ПО (Расчеты.ЗаказПоставщику = ОбъектыРасчетов.Ссылка)
	|
	|ГДЕ
	|	Расчеты.ПредоплатаРегл > 0
	|
	|СГРУППИРОВАТЬ ПО
	|	Расчеты.Регистратор,
	|	ОбъектыРасчетов.Организация,
	|	ОбъектыРасчетов.Контрагент,
	|	ОбъектыРасчетов.Договор,
	|	ОбъектыРасчетов.НаправлениеДеятельности,
	|	Расчеты.ЗаказПоставщику,
	|	ОбъектыРасчетов.ГруппаФинансовогоУчета,
	|	ОбъектыРасчетов.Подразделение,
	|	Расчеты.Валюта
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Расчеты.Ссылка КАК Ссылка,
	|	Расчеты.Организация КАК Организация,
	|	Расчеты.Контрагент КАК Контрагент,
	|	Расчеты.Договор КАК Договор,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	Расчеты.ОбъектРасчетов КАК ОбъектРасчетов,
	|	Расчеты.ГруппаФинансовогоУчета КАК ГруппаФинансовогоУчета,
	|	Расчеты.Подразделение КАК Подразделение,
	|	Расчеты.Валюта КАК Валюта,
	|	СУММА(Расчеты.Предоплата) КАК Предоплата,
	|	СУММА(Расчеты.ПредоплатаУпр) КАК ПредоплатаУпр,
	|	СУММА(Расчеты.ПредоплатаРегл) КАК ПредоплатаРегл,
	|	СУММА(-Расчеты.Долг) КАК Долг,
	|	СУММА(-Расчеты.ДолгУпр) КАК ДолгУпр,
	|	СУММА(-Расчеты.ДолгРегл) КАК ДолгРегл
	|ИЗ
	|	РасчетыСПоставщикамиНоваяАрхитектура КАК Расчеты
	|ГДЕ
	|	Расчеты.ПредоплатаРегл <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	Расчеты.Ссылка,
	|	Расчеты.Организация,
	|	Расчеты.Контрагент,
	|	Расчеты.Договор,
	|	Расчеты.НаправлениеДеятельности,
	|	Расчеты.ОбъектРасчетов,
	|	Расчеты.ГруппаФинансовогоУчета,
	|	Расчеты.Подразделение,
	|	Расчеты.Валюта
	|	
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса);
	
	#КонецОбласти
	
	#Область СуммыДокументовВВалютахУчета
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Суммы.Регистратор КАК Регистратор,
	|	Суммы.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|	
	|	ВЫБОР
	|		КОГДА Суммы.СуммаПриведеннаяРегл = 0
	|		ТОГДА Суммы.СуммаБезНДСРегл
	|		ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|	КОНЕЦ КАК СуммаПриведеннаяРегл,
	|	ВЫБОР
	|		КОГДА Суммы.СуммаПриведеннаяУпр = 0
	|		ТОГДА Суммы.СуммаБезНДСУпр
	|		ИНАЧЕ Суммы.СуммаПриведеннаяУпр
	|	КОНЕЦ КАК СуммаПриведеннаяУпр,
	|	ВЫБОР
	|		КОГДА Суммы.СуммаПриведенная = 0
	|		ТОГДА Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов
	|		ИНАЧЕ Суммы.СуммаПриведенная
	|	КОНЕЦ КАК СуммаПриведенная,
	|	
	|	Суммы.СуммаБезНДСРегл КАК СуммаБезНДСРегл,
	|	Суммы.СуммаБезНДСУпр КАК СуммаБезНДСУпр,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	
	|	Суммы.СуммаНДСРегл КАК СуммаНДСРегл,
	|	Суммы.СуммаНДСУпр КАК СуммаНДСУпр,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДС
	|	
	|ПОМЕСТИТЬ СуммыДокументовВВалютахУчета
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ПО Суммы.Регистратор = ДокументыКОтражению.Ссылка
	|	
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор";
	ТекстыЗапроса.Добавить(ТекстЗапроса);
	#КонецОбласти
	
	ТекстыЗапроса.Добавить("");
	
	//-- Локализация
	
	Возврат СтрСоединить(ТекстыЗапроса, ОбщегоНазначения.РазделительПакетаЗапросов());
	
КонецФункции

#КонецОбласти
//-- НЕ УТ

// Заполняет массив допустимых наименований входящих документов.
//
// Параметры:
//  МассивНаименований	 - Массив - массив наименования входящих документов.
//
Процедура ДополнитьНаименованияВходящихДокументов(МассивНаименований) Экспорт
	//++ Локализация
	МассивНаименований.Добавить(НСтр("ru = 'УПД';
									|en = 'UTD'"));
	//-- Локализация
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область Проведение

// Процедура дополняет тексты запросов проведения документа.
//
// Параметры:
//  Запрос - Запрос - Общий запрос проведения документа.
//  ТекстыЗапроса - СписокЗначений - Список текстов запроса проведения.
//  Регистры - Строка, Структура - Список регистров проведения документа через запятую или в ключах структуры.
//
Процедура ДополнитьТекстыЗапросовПроведения(Запрос, ТекстыЗапроса, Регистры) Экспорт
	
	//++ Локализация

	//++ НЕ УТ
	ТекстЗапросаТаблицаОтражениеДокументовВРеглУчете(Запрос, ТекстыЗапроса, Регистры);
	ТекстЗапросаТаблицаОперацииСПрослеживаемымиТоварамиРасширенный(Запрос, ТекстыЗапроса, Регистры);
	ТекстЗапросаТаблицаПрослеживаемыеТоварыВСоставеОС(Запрос, ТекстыЗапроса, Регистры);
	//-- НЕ УТ

	//-- Локализация
	
КонецПроцедуры
//++ Локализация

//++ НЕ УТ

Функция ТекстЗапросаТаблицаОперацииСПрослеживаемымиТоварамиРасширенный(Запрос, ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ОперацииСПрослеживаемымиТоварамиРасширенный";
	
	Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли; 

	Если НЕ ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтТоварыОрганизаций", ТекстыЗапроса) Тогда
		Документы.КорректировкаПриобретения.ТекстЗапросаВтТоварыОрганизаций(Запрос, ТекстыЗапроса);
	КонецЕсли;
	
	Если НЕ ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтТаблицаРасхожденияТоваров", ТекстыЗапроса) Тогда
		Документы.КорректировкаПриобретения.ТекстЗапросаВтТаблицаРасхожденияТоваров(Запрос, ТекстыЗапроса);
	КонецЕсли; 

	Если НЕ ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтТаблицаИсправленияДокументов", ТекстыЗапроса) Тогда
		Документы.КорректировкаПриобретения.ТекстЗапросаВтТаблицаИсправленияДокументов(Запрос, ТекстыЗапроса);
	КонецЕсли;

	Если НЕ ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтЕстьДвиженияПоРасширенномуРегиструПрослеживаемости", ТекстыЗапроса) Тогда
		УчетПрослеживаемыхТоваровЛокализация.ТекстЗапросаВтЕстьДвиженияПоРасширенномуРегиструПрослеживаемости(Запрос, ТекстыЗапроса);
	КонецЕсли;
	
	ОтражатьВОтчетеОбОперациях =УчетНДСЛокализация.ПрименяетсяЛьготноеНалогообложениеНДС(Запрос.Параметры.Организация,Запрос.Параметры.Период);
	Запрос.УстановитьПараметр("ОтражатьВОтчетеОбОперациях", ОтражатьВОтчетеОбОперациях);
	ПрослеживаемостьУП.УстановитьПараметрыЗапросаТипыСобственныхТоваров(Запрос);
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА СУММА(СуммыДокументовВВалютахУчета.СуммаБезНДС) = 0
	|			ИЛИ СУММА(СуммыДокументовВВалютахУчета.СуммаБезНДСРегл) = 0
	|			ТОГДА 1
	|		ИНАЧЕ СУММА(СуммыДокументовВВалютахУчета.СуммаБезНДСРегл) / СУММА(СуммыДокументовВВалютахУчета.СуммаБезНДС)
	|	КОНЕЦ КАК Курс
	|ПОМЕСТИТЬ ВТ_СреднийКурсИсправляемогоДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК СуммыДокументовВВалютахУчета
	|ГДЕ
	|	СуммыДокументовВВалютахУчета.Регистратор В
	|			(ВЫБРАТЬ
	|				ВтТаблицаИсправленияДокументов.ИсправляемыйДокумент
	|			ИЗ
	|				ВтТаблицаИсправленияДокументов)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втТоварыОрганизаций.Период КАК Период,
	|	втТоварыОрганизаций.Организация КАК Организация,
	|	втТоварыОрганизаций.ВидЗапасов КАК ВидЗапасов,
	|	втТоварыОрганизаций.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	втТоварыОрганизаций.НомерГТД КАК РНПТ,
	|	СУММА(ВЫБОР
	|			КОГДА втТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА -втТоварыОрганизаций.КоличествоПоРНПТ
	|			ИНАЧЕ втТоварыОрганизаций.КоличествоПоРНПТ
	|		КОНЕЦ) КАК КоличествоПоРНПТ,
	|	ВЫБОР
	|		КОГДА втТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУменьшениеПолученный)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУвеличениеПолученный)
	|	КОНЕЦ КАК КодОперации,
	|	&Контрагент КАК Контрагент,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ втТоварыОрганизаций.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ КАК ТипДокументаВПрослеживаемости,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ втТоварыОрганизаций.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА втТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ КАК ОтражениеВОтчетности,
	|	втТоварыОрганизаций.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|	СУММА(Суммы.СуммаБезНДСРегл) КАК СтоимостьПоРНПТ
	|ИЗ
	|	втТоварыОрганизаций КАК втТоварыОрганизаций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.НомераГТД КАК НомераГТД
	|		ПО втТоварыОрганизаций.НомерГТД = НомераГТД.Ссылка
	|			И (НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТ)
	|				ИЛИ НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТКомплекта))
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВтСуммыДокументовВВалютахУчета КАК Суммы
	|		ПО Суммы.Ссылка = &Ссылка
	|			И Суммы.ИдентификаторСтроки = втТоварыОрганизаций.ИдентификаторСтроки
	|
	|ГДЕ
	|	&ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)
	|
	|СГРУППИРОВАТЬ ПО
	|	втТоварыОрганизаций.Период,
	|	втТоварыОрганизаций.Организация,
	|	втТоварыОрганизаций.ВидЗапасов,
	|	втТоварыОрганизаций.АналитикаУчетаНоменклатуры,
	|	втТоварыОрганизаций.НомерГТД,
	|	ВЫБОР
	|		КОГДА втТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУменьшениеПолученный)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУвеличениеПолученный)
	|	КОНЕЦ,
	|	втТоварыОрганизаций.ИдентификаторСтроки,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ втТоварыОрганизаций.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ втТоварыОрганизаций.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА втТоварыОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ
	|
	|ИМЕЮЩИЕ
	|	СУММА(втТоварыОрганизаций.КоличествоПоРНПТ) <> 0
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Период,
	|	&Организация,
	|	ТаблицаРасхождения.ВидЗапасов,
	|	ТаблицаРасхождения.АналитикаУчетаНоменклатуры,
	|	ТаблицаРасхождения.НомерГТД,
	|	СУММА(ТаблицаРасхождения.КоличествоПоРНПТ),
	|	ВЫБОР
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУменьшениеПолученный)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУвеличениеПолученный)
	|	КОНЕЦ,
	|	&Контрагент,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ,
	|	ТаблицаРасхождения.ИдентификаторСтроки,
	|	СУММА(ТаблицаРасхождения.СуммаБезНДСРегл)
	|ИЗ
	|	ВтТаблицаРасхожденияТоваров КАК ТаблицаРасхождения
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.НомераГТД КАК НомераГТД
	|		ПО ТаблицаРасхождения.НомерГТД = НомераГТД.Ссылка
	|			И (НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТ)
	|				ИЛИ НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТКомплекта))
	|ГДЕ
	|	&ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)	
	|	И ТаблицаРасхождения.СписатьНаРасходы
	|	И (ТаблицаРасхождения.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|			ИЛИ ТаблицаРасхождения.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ &ИспользуетсяДокументПоступлениеТоваров
	|				И (ТаблицаРасхождения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|					ИЛИ НЕ ТаблицаРасхождения.Назначение.ТипНазначения = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)))
	|
	|СГРУППИРОВАТЬ ПО
	|	ТаблицаРасхождения.ВидЗапасов,
	|	ТаблицаРасхождения.АналитикаУчетаНоменклатуры,
	|	ТаблицаРасхождения.НомерГТД,
	|	ВЫБОР
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУменьшениеПолученный)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУвеличениеПолученный)
	|	КОНЕЦ,
	|	ТаблицаРасхождения.ИдентификаторСтроки,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС) 
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Период,
	|	&Организация,
	|	ТаблицаРасхождения.ВидЗапасов,
	|	ТаблицаРасхождения.АналитикаУчетаНоменклатуры,
	|	ТаблицаРасхождения.НомерГТД,
	|	0,
	|	ВЫБОР
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУменьшениеПолученный)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУвеличениеПолученный)
	|	КОНЕЦ,
	|	&Контрагент,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС) 
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ,
	|	ТаблицаРасхождения.ИдентификаторСтроки,
	|	0	
	|ИЗ
	|	ВтТаблицаРасхожденияТоваров КАК ТаблицаРасхождения
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.НомераГТД КАК НомераГТД
	|		ПО ТаблицаРасхождения.НомерГТД = НомераГТД.Ссылка
	|			И (НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТ)
	|				ИЛИ НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТКомплекта))
	|ГДЕ
	|	ТаблицаРасхождения.Количество = 0
	|	И &ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)	
	|	И ТаблицаРасхождения.КоличествоПоРНПТ = 0
	|	И (ТаблицаРасхождения.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УвеличитьСтоимостьТовара)
	|			ИЛИ ТаблицаРасхождения.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УменьшитьСтоимостьТовара))
	|	И НЕ ТаблицаРасхождения.СписатьНаРасходы
	|	И (ТаблицаРасхождения.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|			ИЛИ ТаблицаРасхождения.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ &ИспользуетсяДокументПоступлениеТоваров
	|				И (ТаблицаРасхождения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|					ИЛИ НЕ ТаблицаРасхождения.Назначение.ТипНазначения = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)))
	|
	|СГРУППИРОВАТЬ ПО
	|	ТаблицаРасхождения.ВидЗапасов,
	|	ТаблицаРасхождения.АналитикаУчетаНоменклатуры,
	|	ТаблицаРасхождения.НомерГТД,
	|	ВЫБОР
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУменьшениеПолученный)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.УКДНаУвеличениеПолученный)
	|	КОНЕЦ,
	|	ТаблицаРасхождения.ИдентификаторСтроки,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС) 
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ ТаблицаРасхождения.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА ТаблицаРасхождения.СуммаБезНДСРегл < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Период,
	|	&Организация,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка),
	|	Аналитика.КлючАналитики,
	|	КорректировкаПриобретенияТовары.НомерГТД,
	|	СУММА(КорректировкаПриобретенияТовары.КоличествоПоРНПТ),
	|	ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.Приобретение),
	|	&Контрагент,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ КорректировкаПриобретенияТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС) 
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|				ИЛИ КорректировкаПриобретенияТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС) 
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА (КорректировкаПриобретенияТовары.СуммаСНДС - КорректировкаПриобретенияТовары.СуммаНДС) < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ,
	|	"""",
	|	(СУММА((КорректировкаПриобретенияТовары.СуммаСНДС - КорректировкаПриобретенияТовары.СуммаНДС) *
	|		ЕСТЬNULL(ВТ_СреднийКурсИсправляемогоДокумента.Курс, 1)))
	|ИЗ
	|	Документ.КорректировкаПриобретения.Товары КАК КорректировкаПриобретенияТовары
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.НомераГТД КАК НомераГТД
	|		ПО КорректировкаПриобретенияТовары.НомерГТД = НомераГТД.Ссылка
	|			И (НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТ)
	|				ИЛИ НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТКомплекта))
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО (КорректировкаПриобретенияТовары.Номенклатура = Аналитика.Номенклатура)
	|			И (КорректировкаПриобретенияТовары.Характеристика = Аналитика.Характеристика)
	|			И (ВЫБОР
	|				КОГДА ИСТИНА
	|					ТОГДА ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)
	|				КОГДА ИСТИНА
	|					ТОГДА КорректировкаПриобретенияТовары.СтатьяКалькуляции
	|			КОНЕЦ = Аналитика.СтатьяКалькуляции)
	|			И (КорректировкаПриобретенияТовары.Серия = Аналитика.Серия)
	|			И (КорректировкаПриобретенияТовары.Склад = Аналитика.МестоХранения)
	|			И (ВЫБОР
	|				КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|					ТОГДА КорректировкаПриобретенияТовары.Назначение
	|				ИНАЧЕ &ПустоеНазначение
	|			КОНЕЦ = Аналитика.Назначение)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СреднийКурсИсправляемогоДокумента КАК ВТ_СреднийКурсИсправляемогоДокумента
	|		ПО (ИСТИНА)
	|ГДЕ
	|	КорректировкаПриобретенияТовары.Ссылка = &Ссылка
	|			И НЕ &ИспользуетсяДокументПоступлениеТоваров
	|			И НЕ КорректировкаПриобретенияТовары.Ссылка.ДокументОснование ССЫЛКА Документ.ПриобретениеУслугПрочихАктивов
	|			И НЕ &ТипКорректировки = ЗНАЧЕНИЕ(Перечисление.ТипыКорректировки.КорректировкаДоВводаОстатковУслугИПрочихАктивов)
	|			И &ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеОшибок)
	|СГРУППИРОВАТЬ ПО
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка),
	|	Аналитика.КлючАналитики,
	|	КорректировкаПриобретенияТовары.НомерГТД,
	|	ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.Приобретение),
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИЛИ КорректировкаПриобретенияТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|				ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИЛИ КорректировкаПриобретенияТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС) 
	|		ИЛИ &ОтражатьВОтчетеОбОперациях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)
	|		КОГДА КорректировкаПриобретенияТовары.СуммаСНДС - КорректировкаПриобретенияТовары.СуммаНДС < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПродаж)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.КнигаПокупок)
	|	КОНЕЦ
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Период,
	|	&Организация,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка),
	|	Аналитика.КлючАналитики,
	|	КорректировкаПриобретенияТовары.НомерГТД,
	|	СУММА(КорректировкаПриобретенияТовары.КоличествоПоРНПТ),
	|	ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.ПередачаВПроизводство),
	|	&Контрагент,
	|	ЗНАЧЕНИЕ(Справочник.ТипыДокументов.ПустаяССылка),
	|	ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях),
	|	"""",
	|	(СУММА((КорректировкаПриобретенияТовары.СуммаСНДС) *
	|		ЕСТЬNULL(ВТ_СреднийКурсИсправляемогоДокумента.Курс, 1)))
	|ИЗ
	|	Документ.КорректировкаПриобретения.Товары КАК КорректировкаПриобретенияТовары
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.НомераГТД КАК НомераГТД
	|		ПО КорректировкаПриобретенияТовары.НомерГТД = НомераГТД.Ссылка
	|			И (НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТ)
	|				ИЛИ НомераГТД.ТипНомераГТД = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТКомплекта))
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
	|		ПО (КорректировкаПриобретенияТовары.Номенклатура = Аналитика.Номенклатура)
	|			И (КорректировкаПриобретенияТовары.Характеристика = Аналитика.Характеристика)
	|			И (ВЫБОР
	|				КОГДА ИСТИНА
	|					ТОГДА ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)
	|				КОГДА ИСТИНА
	|					ТОГДА КорректировкаПриобретенияТовары.СтатьяКалькуляции
	|			КОНЕЦ = Аналитика.СтатьяКалькуляции)
	|			И (КорректировкаПриобретенияТовары.Серия = Аналитика.Серия)
	|			И (КорректировкаПриобретенияТовары.Склад = Аналитика.МестоХранения)
	|			И (ВЫБОР
	|				КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|					ТОГДА КорректировкаПриобретенияТовары.Назначение
	|				ИНАЧЕ &ПустоеНазначение
	|			КОНЕЦ = Аналитика.Назначение)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СреднийКурсИсправляемогоДокумента КАК ВТ_СреднийКурсИсправляемогоДокумента
	|		ПО (ИСТИНА)
	|ГДЕ
	|	КорректировкаПриобретенияТовары.Ссылка = &Ссылка
	|			И КорректировкаПриобретенияТовары.СписатьНаРасходы
	|			И НЕ &ИспользуетсяДокументПоступлениеТоваров
	|			И НЕ КорректировкаПриобретенияТовары.Ссылка.ДокументОснование ССЫЛКА Документ.ПриобретениеУслугПрочихАктивов
	|			И НЕ &ТипКорректировки = ЗНАЧЕНИЕ(Перечисление.ТипыКорректировки.КорректировкаДоВводаОстатковУслугИПрочихАктивов)
	|			И &ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеОшибок)
	|СГРУППИРОВАТЬ ПО
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка),
	|	Аналитика.КлючАналитики,
	|	КорректировкаПриобретенияТовары.НомерГТД,
	|	ЗНАЧЕНИЕ(Справочник.КодыОперацийПрослеживаемости.ПередачаВПроизводство),
	|	ВЫБОР
	|		КОГДА &НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИЛИ &НалогообложениеОрганизации = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|		ИЛИ КорректировкаПриобретенияТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.УКД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.КорректировочныйСчетФактура)
	|	КОНЕЦ,
	|	ЗНАЧЕНИЕ(Перечисление.ПорядокОтраженияВОтчетностиПоПрослеживаемости.ОтчетОбОперациях)";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаПрослеживаемыеТоварыВСоставеОС(Запрос, ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ПрослеживаемыеТоварыВСоставеОС";
	
	Если Не ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	ТекстЗапроса = "ВЫБРАТЬ
	|	Расходы.НомерСтроки КАК НомерСтроки,
	|	ВЫБОР
	|		КОГДА Расходы.КоличествоПоРНПТ > 0
	|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	КОНЕЦ КАК ВидДвижения,
	|	&Период КАК Период,
	|	&Организация КАК Организация,
	|	Расходы.НомерГТД КАК РНПТ,
	|	Расходы.АналитикаРасходов КАК ОсновноеСредство,
	|	Расходы.КодТНВЭД КАК КодТНВЭД,
	|	ЕСТЬNULL(Расходы.КодТНВЭД.ПрослеживаемыйТовар, ЛОЖЬ) КАК ПрослеживаемыйТовар,
	|	ЕСТЬNULL(Расходы.НомерГТД.ТипНомераГТД, ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.ПустаяСсылка)) КАК ТипНомераРНПТ,
	|	ВЫБОР
	|		КОГДА Расходы.КоличествоПоРНПТ > 0
	|			ТОГДА Расходы.КоличествоПоРНПТ
	|		ИНАЧЕ -Расходы.КоличествоПоРНПТ
	|	КОНЕЦ КАК КоличествоПоРНПТ
	|ПОМЕСТИТЬ ВТ_РасходыПромежуточные
	|ИЗ
	|	Документ.КорректировкаПриобретения.Расхождения КАК Расходы
	|ГДЕ
	|	Расходы.Ссылка = &Ссылка
	|	И Расходы.АналитикаРасходов ССЫЛКА Справочник.ОбъектыЭксплуатации
	|;
	|
	|ВЫБРАТЬ
	|	Расходы.НомерСтроки КАК НомерСтроки,
	|	Расходы.ВидДвижения КАК ВидДвижения,
	|	Расходы.Период КАК Период,
	|	Расходы.Организация КАК Организация,
	|	Расходы.РНПТ КАК РНПТ,
	|	Расходы.ОсновноеСредство КАК ОсновноеСредство,
	|	Расходы.КодТНВЭД КАК КодТНВЭД,
	|	Расходы.КоличествоПоРНПТ КАК КоличествоПоРНПТ
	|
	|ИЗ
	|	ВТ_РасходыПромежуточные КАК Расходы
	|ГДЕ
	|   Расходы.ПрослеживаемыйТовар
	|	И Расходы.ТипНомераРНПТ = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТ)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Расходы.НомерСтроки КАК НомерСтроки,
	|	Расходы.ВидДвижения КАК ВидДвижения,
	|	Расходы.Период КАК Период,
	|	Расходы.Организация КАК Организация,
	|	ПрослеживаемыеКомплектующие.НомерРНПТ КАК РНПТ,
	|	Расходы.ОсновноеСредство КАК ОсновноеСредство,
	|	Расходы.КодТНВЭД КАК КодТНВЭД,
	|	Расходы.КоличествоПоРНПТ * ПрослеживаемыеКомплектующие.КоличествоПоРНПТ КАК КоличествоПоРНПТ
	|ИЗ
	|	    ВТ_РасходыПромежуточные КАК Расходы
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.НомераГТД.ПрослеживаемыеКомплектующие КАК ПрослеживаемыеКомплектующие
	|		ПО Расходы.РНПТ = ПрослеживаемыеКомплектующие.Ссылка
	|ГДЕ
	|   Расходы.ПрослеживаемыйТовар
	|	И Расходы.ТипНомераРНПТ = ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТКомплекта)
	|
	|УПОРЯДОЧИТЬ ПО
	|	Расходы.НомерСтроки
	|
	|";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	
	Возврат ТекстЗапроса;
	
КонецФункции


Функция ТекстЗапросаТаблицаОтражениеДокументовВРеглУчете(Запрос, ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ОтражениеДокументовВРеглУчете";
	
	Если Не ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли; 
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтПрочиеРасходы", ТекстыЗапроса) Тогда
		Документы.КорректировкаПриобретения.ТекстЗапросаТаблицаВтПрочиеРасходы(Запрос, ТекстыЗапроса);
	КонецЕсли;
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтПартииПрочихРасходов", ТекстыЗапроса) Тогда
		Документы.КорректировкаПриобретения.ТекстЗапросаТаблицаВтПартииПрочихРасходов(Запрос, ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	&Период                      КАК Период,
	|	&Организация                 КАК Организация,
	|	НАЧАЛОПЕРИОДА(&Период, ДЕНЬ) КАК ДатаОтражения
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Период                      КАК Период,
	|	&ГоловнаяОрганизация         КАК Организация,
	|	НАЧАЛОПЕРИОДА(&Период, ДЕНЬ) КАК ДатаОтражения
	|ГДЕ
	|	&ГоловнаяОрганизация <> &Организация
	|";
	
	ТекстыЗапросаОтражения = Новый Массив;
	ТекстыЗапросаОтражения.Добавить(ТекстЗапроса);
	ТекстыЗапросаОтражения.Добавить(ДоходыИРасходыСервер.ДополнитьТекстЗапросаТаблицаОтражениеДокументовВРеглУчете());
	
	ТекстЗапроса = РеглУчетПроведениеСервер.ТекстЗапросаОтраженияПоОбъектамРасчетов("Документ.КорректировкаПриобретения.КорректировкаЗадолженности");
	ТекстыЗапросаОтражения.Добавить(ТекстЗапроса);
	
	ТекстЗапроса = РеглУчетПроведениеСервер.ТекстЗапросаОтраженияПоДоговору("&Договор");
	ТекстыЗапросаОтражения.Добавить(ТекстЗапроса);
	
	ТекстЗапроса = СтрСоединить(ТекстыЗапросаОтражения, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении(Истина));
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	
	Возврат ТекстЗапроса;
	
КонецФункции
//-- НЕ УТ

//-- Локализация

#КонецОбласти

#Область Прочее

//++ Локализация

//++ НЕ УТ

Функция КорректировкаТоваров()
	
	КорректировкаТоваров = "
	|ВЫБРАТЬ //// Корректировка поступления товаров (Дт 10, 20, 41, ХХ.ХХ :: Кт 60, 71, 76)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС) 
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведеннаяРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА Суммы.СуммаПриведеннаяУпр
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы)
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПрочиеАктивыПассивы)
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ТоварыКомитентовКОформлениюПоЗакупке)
	|		КОГДА ЕСТЬNULL(Склады.ЦеховаяКладовая, ЛОЖЬ)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НаСкладе)
	|	КОНЕЦ КАК ВидСчетаДт,
	|
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА Операция.СтатьяРасходов
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Назначения.Договор.ГруппаФинансовогоУчета
	|		КОГДА ЕСТЬNULL(Склады.ЦеховаяКладовая, ЛОЖЬ)
	|		ТОГДА Строки.ВидЗапасов.ГруппаПродукции
	|		ИНАЧЕ
	|			ВЫБОР
	|			КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			ТОГДА Строки.ВидЗапасов.ГруппаФинансовогоУчета
	|			ИНАЧЕ Строки.Номенклатура.ГруппаФинансовогоУчета
	|		КОНЕЦ
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА Операция.Подразделение
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ЕСТЬNULL(Склады.ЦеховаяКладовая, ЛОЖЬ)
	|		ТОГДА ЕСТЬNULL(Склады.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
	|		ИНАЧЕ Строки.Склад
	|	КОНЕЦ КАК МестоУчетаДт,
	|
	|	ЕСТЬNULL(ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.Валюта, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)) КАК ВалютаДт,
	|	ВЫБОР
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА Операция.Подразделение
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Назначения.Договор.Подразделение
	|		ИНАЧЕ Склады.Подразделение
	|	КОНЕЦ КАК ПодразделениеДт,
	|	ВЫБОР
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА Расчеты.НаправлениеДеятельности
	|		КОГДА Строки.НаправлениеДеятельности <> ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|		ТОГДА Строки.НаправлениеДеятельности
	|		ИНАЧЕ ЕстьNULL(Назначения.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
	|	КОНЕЦ КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|			И Операция.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.СчетУчета
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.СчетУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|	КОНЕЦ КАК СчетДт,
	|
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА Операция.СтатьяРасходов
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто1
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто1
	|		ИНАЧЕ Строки.Номенклатура
	|	КОНЕЦ КАК СубконтоДт1,
	|
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА Операция.АналитикаРасходов
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто2
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто2
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Строки.ВидЗапасов.Контрагент
	|		КОГДА ЕСТЬNULL(Склады.ЦеховаяКладовая, ЛОЖЬ)
	|		ТОГДА Строки.ВидЗапасов.ГруппаПродукции
	|		ИНАЧЕ Строки.Склад
	|	КОНЕЦ КАК СубконтоДт2,
	|	
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходов.ВариантРаспределенияРасходовРегл, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		ТОГДА ЕСТЬNULL(ОбъектыСтроительства.СпособСтроительства, ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный))
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|			И Операция.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто3
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто3
	|		КОГДА ЕСТЬNULL(Склады.ЦеховаяКладовая, ЛОЖЬ)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.МатериальныеЗатраты)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее)
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	ЕСТЬNULL(ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.СуммаСНДС, 0) КАК ВалютнаяСуммаДт,
	|	Строки.Количество КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходов.ПринятиеКНалоговомуУчету, ИСТИНА) = ИСТИНА
	|		ТОГДА (ВЫБОР
	|				КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|				ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыОблагаемыеНДС)
	|					ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|				ТОГДА Суммы.СуммаБезНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|				ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходов.ПринятиеКНалоговомуУчету, ИСТИНА) = ЛОЖЬ
	|		ТОГДА (ВЫБОР
	|				КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|				ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыОблагаемыеНДС)
	|					ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|				ТОГДА Суммы.СуммаПриведеннаяРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|				ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаПРДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходов.ПринятиеКНалоговомуУчету, ИСТИНА) = ИСТИНА
	|		ТОГДА Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаВРДт,
	|	
	|	ВЫБОР КОГДА Расчеты.ВернутьМногооборотнуюТару
	|		И Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|	ТОГДА
	|		ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщикамиТара)
	|	ИНАЧЕ
	|		ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|	КОНЕЦ КАК ВидСчетаКт,
	|
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	(ВЫБОР КОГДА ВЫБОР КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС) 
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА Суммы.СуммаПриведенная
	|		КОГДА ВЫБОР КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА Суммы.СуммаПриведенная + Суммы.СуммаНДС
	|	КОНЕЦ) КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА Суммы.СуммаБезНДСРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|	КОНЕЦ КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл КАК СуммаВРКт,
	|	""Корректировка поступления товаров"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.Расхождения КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.Назначение
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках КАК ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках
	|	ПО
	|		Строки.Ссылка = ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.Регистратор
	|		И Строки.ИдентификаторСтроки = ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.ИдентификаторСтроки
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.Склады КАК Склады
	|	ПО
	|		Склады.Ссылка = Строки.Склад
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|	ПО
	|		Операция.СтатьяРасходов = СтатьиРасходов.Ссылка
	|		И Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО 
	|		ОбъектыСтроительства.Ссылка = Операция.АналитикаРасходов
	|		И СтатьиРасходов.Ссылка ЕСТЬ НЕ NULL
	|		И СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		И ОбъектыСтроительства.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения
	|ГДЕ
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|	И НЕ ЕСТЬNULL(Расчеты.КорректировкаТоваровВПути, ЛОЖЬ)
	|	И НЕ ЕСТЬNULL(Расчеты.КорректировкаФактуровкиПоставки, ЛОЖЬ)
	|	И Строки.Номенклатура.ТипНоменклатуры В (
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар),
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|	И НЕ Строки.СписатьНаРасходы
	|	И НЕ (Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиДоходов)
	|";
	Возврат КорректировкаТоваров;
	
КонецФункции

Функция ТекстКорректировкаНеСобственногоТовара()

	ТекстЗапроса = ПроизводствоБезЗаказаЛокализация.ТекстПриходТоваровЗаБалансом(Ложь, Ложь);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Содержание", "ВЫБОР
	|		КОГДА Строки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|		ТОГДА ""Корректировка приобретения материалов давальца""
	|		КОГДА Строки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|		ТОГДА ""Корректировка приобретения полуфабрикатов давальца""
	|		КОГДА Строки.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|		ТОГДА ""Корректировка приобретения продукции давальца""
	|		КОГДА Строки.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|		ТОГДА ""Корректировка приобретения материалов, принятых в переработку""
	|		КОГДА Строки.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		ТОГДА ""Корректировка приобретения товаров, принятых на ответственное хранение""
	|		КОГДА Строки.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		ТОГДА ""Корректировка приобретения товаров на хранении с правом продажи""
	|		КОГДА Строки.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		ТОГДА ""Корректировка приобретения товаров принятых на комиссию""
	|		КОГДА Строки.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуКОформлениюСписания),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам))
	|		ТОГДА ""Корректировка приобретения материалов, принятых в переработку""
	|		ИНАЧЕ ""Корректировка приобретения товаров, принятых на хранение""
	|	КОНЕЦ");
	Возврат ТекстЗапроса;
	
КонецФункции

Функция КорректировкаНаДоходыПоДокументу()
	
	КорректировкаНаДоходыПоДокументу = "
	|ВЫБРАТЬ //// Корректировка поступления товаров на прочие доходы (Дт 60, 71, 76 :: Кт 91.01)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА -Суммы.СуммаПриведеннаяРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА -Суммы.СуммаПриведеннаяРегл - Суммы.СуммаНДСРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА -Суммы.СуммаПриведеннаяУпр
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА -Суммы.СуммаПриведеннаяУпр - Суммы.СуммаНДСУпр
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	ВЫБОР КОГДА Расчеты.ВернутьМногооборотнуюТару
	|		И Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|	ТОГДА
	|		ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщикамиТара)
	|	ИНАЧЕ
	|		ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|	КОНЕЦ КАК ВидСчетаДт,
	|
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаДт,
	|	Расчеты.Подразделение КАК ПодразделениеДт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|	Расчеты.Контрагент КАК СубконтоДт1,
	|	Расчеты.Договор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	(ВЫБОР КОГДА ВЫБОР КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Строки.Назначение.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС) 
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА - Суммы.СуммаПриведенная
	|		КОГДА ВЫБОР КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Строки.Назначение.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА - Суммы.СуммаПриведенная - Суммы.СуммаНДС
	|	КОНЕЦ) КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА -Суммы.СуммаБезНДСРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА -Суммы.СуммаБезНДСРегл - Суммы.СуммаНДСРегл
	|	КОНЕЦ КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	Суммы.СуммаБезНДСРегл - Суммы.СуммаПриведеннаяРегл КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Доходы) КАК ВидСчетаКт,
	|	Операция.СтатьяДоходов КАК АналитикаУчетаКт,
	|	Операция.Подразделение КАК МестоУчетаКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Операция.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|
	|	Операция.СтатьяДоходов КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	ВЫБОР КОГДА Расчеты.КорректировкаФактуровкиПоставки 
	|		ТОГДА 0
	|	ИНАЧЕ -Строки.Количество
	|	КОНЕЦ КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА (ВЫБОР
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыОблагаемыеНДС)
	|						ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|				ТОГДА -Суммы.СуммаБезНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|				ТОГДА -Суммы.СуммаБезНДСРегл - Суммы.СуммаНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУКт,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА (ВЫБОР
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыОблагаемыеНДС)
	|						ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|				ТОГДА -Суммы.СуммаПриведеннаяРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|				ТОГДА -Суммы.СуммаПриведеннаяРегл - Суммы.СуммаНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаПРКт,
	|	Суммы.СуммаБезНДСРегл - Суммы.СуммаПриведеннаяРегл КАК СуммаВРКт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Строки.Номенклатура.ТипНоменклатуры, ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.ПустаяСсылка)) В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|			ТОГДА ""Корректировка поступления товаров""
	|		ИНАЧЕ
	|			""Корректировка приобретения услуг""
	|	КОНЕЦ КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.Расхождения КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.Назначение
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиДоходов КАК СтатьиДоходов
	|	ПО
	|		Операция.СтатьяДоходов = СтатьиДоходов.Ссылка
	|		И Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения
	|
	|ГДЕ
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|";
	Возврат КорректировкаНаДоходыПоДокументу;
	
КонецФункции

Функция КорректировкаТоваровДвухходовка()
	
	КорректировкаТоваров = "
	|ВЫБРАТЬ //// Корректировка поступления товаров при двухходовке (Дт 15, 60.НП, ХХ.ХХ :: Кт 60, 71, 76)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				 И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|		ИНАЧЕ Суммы.СуммаПриведеннаяУпр
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	ВЫБОР
	|		КОГДА НЕ (СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL И СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы)
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы), ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПрочиеАктивыПассивы)
	|		КОГДА Расчеты.КорректировкаТоваровВПути
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ЗатратыНаПриобретениеТМЦ)
	|		КОГДА Расчеты.КорректировкаФактуровкиПоставки
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НеотфактурованныеПоставки)
	|	КОНЕЦ КАК ВидСчетаДт,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходовДокумента.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Операция.СтатьяРасходов
	|		КОГДА СтатьиРасходовСтроки.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Строки.СтатьяРасходов
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы), ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА Расчеты.КорректировкаФактуровкиПоставки
	|		ТОГДА Расчеты.ГруппаФинансовогоУчета
	|		КОГДА Расчеты.КорректировкаТоваровВПути И &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|		ТОГДА Строки.ВидЗапасов.ГруппаФинансовогоУчета
	|		КОГДА Расчеты.КорректировкаТоваровВПути И НЕ &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|		ТОГДА Строки.АналитикаУчетаНоменклатуры.Номенклатура.ГруппаФинансовогоУчета
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|
	|	ВЫБОР
	|		КОГДА НЕ (СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL И СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL)
	|		ТОГДА Операция.Подразделение
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК МестоУчетаДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ВЫБОР
	|		КОГДА СтатьиРасходовДокумента.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Операция.Подразделение
	|		КОГДА СтатьиРасходовСтроки.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Строки.Подразделение
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА Операция.Подразделение
	|		ИНАЧЕ Расчеты.Подразделение
	|	КОНЕЦ КАК ПодразделениеДт,
	|	ВЫБОР
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы), ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА Операция.НаправлениеДеятельности
	|		КОГДА Расчеты.КорректировкаФактуровкиПоставки
	|		ТОГДА Расчеты.НаправлениеДеятельности
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям И Операция.Дата >= &ДатаВключенияСебестоимостиПоНазначениям
	|		ТОГДА ЕСТЬNULL(Назначения.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|	КОНЕЦ КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|			И Операция.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.СчетУчета
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.СчетУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|	КОНЕЦ КАК СчетДт,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходовДокумента.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Операция.СтатьяРасходов
	|		КОГДА СтатьиРасходовСтроки.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Строки.СтатьяРасходов
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто1
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто1
	|		ИНАЧЕ Строки.АналитикаУчетаНоменклатуры.Номенклатура
	|	КОНЕЦ КАК СубконтоДт1,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходовДокумента.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Операция.АналитикаРасходов
	|		КОГДА СтатьиРасходовСтроки.Ссылка ЕСТЬ НЕ NULL
	|		ТОГДА Строки.АналитикаРасходов
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто2
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто2
	|		ИНАЧЕ Расчеты.Контрагент
	|	КОНЕЦ КАК СубконтоДт2,
	|	
	|	ВЫБОР
	|		КОГДА СтатьиРасходовДокумента.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		ТОГДА ЕСТЬNULL(ОбъектыСтроительства.СпособСтроительства, ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный))
	|		КОГДА НЕ (СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL И СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее)
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто3
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто3
	|		ИНАЧЕ Расчеты.Договор
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	ВЫБОР
	|		КОГДА Расчеты.КорректировкаФактуровкиПоставки
	|		ТОГДА 0
	|		ИНАЧЕ Строки.Количество
	|	КОНЕЦ КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ЕСТЬNULL(СтатьиРасходовДокумента.ПринятиеКНалоговомуУчету, ИСТИНА)) = ИСТИНА
	|		ТОГДА (ВЫБОР
	|					КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|						ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|						И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|					ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|					ИНАЧЕ Суммы.СуммаБезНДСРегл
	|				КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ЕСТЬNULL(СтатьиРасходовДокумента.ПринятиеКНалоговомуУчету, ИСТИНА)) = ЛОЖЬ
	|		ТОГДА (ВЫБОР
	|					КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|						ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|						И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|					ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|					ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|				КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаПРДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ЕСТЬNULL(СтатьиРасходовДокумента.ПринятиеКНалоговомуУчету, ИСТИНА))= ИСТИНА
	|		ТОГДА Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаВРДт,
	|	
	|	ВЫБОР
	|		КОГДА Расчеты.ВернутьМногооборотнуюТару
	|			И Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщикамиТара)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|	КОНЕЦ КАК ВидСчетаКт,
	|
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведенная + Суммы.СуммаНДС
	|		ИНАЧЕ Суммы.СуммаПриведенная
	|	КОНЕЦ КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаБезНДСРегл
	|	КОНЕЦ КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл КАК СуммаВРКт,
	|	ВЫБОР
	|		КОГДА НЕ (СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL И СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL)
	|		ТОГДА ""Отражение корректировки поступления товаров на расходы""
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы), ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА ""Отражение корректировки поступления товаров на прочие активы/пассивы""
	|		ИНАЧЕ ""Корректировка поступления товаров""
	|		КОНЕЦ КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.ВидыЗапасов КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.АналитикаУчетаНоменклатуры.Назначение
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходовДокумента
	|	ПО
	|		Операция.СтатьяРасходов = СтатьиРасходовДокумента.Ссылка
	|		И Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходовСтроки
	|	ПО
	|		Строки.СтатьяРасходов = СтатьиРасходовСтроки.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО
	|		ОбъектыСтроительства.Ссылка = Операция.АналитикаРасходов
	|		И СтатьиРасходовДокумента.Ссылка ЕСТЬ НЕ NULL
	|		И СтатьиРасходовДокумента.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		И ОбъектыСтроительства.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО
	|		Операция.Ссылка = Расчеты.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения
	|
	|ГДЕ
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|	И (Расчеты.КорректировкаТоваровВПути ИЛИ Расчеты.КорректировкаФактуровкиПоставки)
	|	И Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры В (
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар),
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|	И НЕ (Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиДоходов)";
	Возврат КорректировкаТоваров;
	
КонецФункции

Функция КорректировкаРаботУслугДвухходовка()
	
	КорректировкаТоваров = "
	|ВЫБРАТЬ // Фактуровка поставки работ и услуг (Дт 60.НП :: Кт 60, 76)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата			КАК Период,
	|	Операция.Организация	КАК Организация,
	|	НЕОПРЕДЕЛЕНО			КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|					ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				 И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|			ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|					ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|			ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|		ИНАЧЕ Суммы.СуммаПриведеннаяУпр
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НеотфактурованныеПоставки) КАК ВидСчетаДт,
	|	Операция.Договор.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	НЕОПРЕДЕЛЕНО								КАК ВалютаДт,
	|	Операция.Договор.Подразделение				КАК ПодразделениеДт,
	|	Операция.Договор.НаправлениеДеятельности 	КАК НаправлениеДеятельностиДт,
	|
	|	НЕОПРЕДЕЛЕНО			КАК СчетДт,
	|	
	|	Операция.Контрагент		КАК СубконтоДт1,
	|	Операция.Договор		КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО			КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	Строки.Количество КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|					ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|			ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаБезНДСРегл
	|	КОНЕЦ КАК СуммаНУДт,
	|	0  КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками) КАК ВидСчетаКт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведенная + Суммы.СуммаНДС
	|		ИНАЧЕ Суммы.СуммаПриведенная
	|	КОНЕЦ КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|				И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаБезНДСРегл
	|	КОНЕЦ КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Корректировка фактуровки услуг (работ)"" КАК Содержание
	|
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		Документ.КорректировкаПриобретения.Расхождения КАК Строки
	|	ПО 
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО 
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения  
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.Назначение
	|
	|ГДЕ 
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|	И Расчеты.КорректировкаФактуровкиПоставки
	|	И Расчеты.Договор.ВариантОформленияЗакупок = ЗНАЧЕНИЕ(Перечисление.ВариантыОформленияЗакупок.НеотфактурованныеПоставкиТоваровИУслуг)
	|	И Строки.Номенклатура.ТипНоменклатуры  В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа),
	|											  ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)) 
	|	И НЕ Строки.ВариантОтражения В (
	|			ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах),
	|			ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы))
	|";
	
	Возврат КорректировкаТоваров;
	
КонецФункции

Функция КорректировкаТоваровДвухходовкаДоходы()
	
	КорректировкаТоваров = "
	|ВЫБРАТЬ //// Корректировка поступления товаров при двухходовке на доходы (Дт 60, 71, 76 :: Кт 91.01)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС)) И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА -Суммы.СуммаПриведеннаяРегл - Суммы.СуммаНДСРегл
	|		ИНАЧЕ -Суммы.СуммаПриведеннаяРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС)) И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА -Суммы.СуммаПриведеннаяУпр - Суммы.СуммаНДСУпр
	|		ИНАЧЕ -Суммы.СуммаПриведеннаяУпр
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	ВЫБОР
	|		КОГДА Расчеты.ВернутьМногооборотнуюТару
	|			И Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщикамиТара)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|	КОНЕЦ КАК ВидСчетаДт,
	|
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаДт,
	|	Расчеты.Подразделение КАК ПодразделениеДт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|	Расчеты.Контрагент КАК СубконтоДт1,
	|	Расчеты.Договор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС)) И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА - Суммы.СуммаПриведенная - Суммы.СуммаНДС
	|		ИНАЧЕ -Суммы.СуммаПриведенная
	|	КОНЕЦ КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|			ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС)) И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА -Суммы.СуммаБезНДСРегл - Суммы.СуммаНДСРегл
	|		ИНАЧЕ -Суммы.СуммаБезНДСРегл
	|	КОНЕЦ КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	Суммы.СуммаБезНДСРегл - Суммы.СуммаПриведеннаяРегл КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Доходы) КАК ВидСчетаКт,
	|	Операция.СтатьяДоходов КАК АналитикаУчетаКт,
	|	Операция.Подразделение КАК МестоУчетаКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Операция.Подразделение КАК ПодразделениеКт,
	|	Операция.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|
	|	Операция.СтатьяДоходов КАК СубконтоКт1,
	|	Операция.АналитикаДоходов КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	ВЫБОР КОГДА Расчеты.КорректировкаФактуровкиПоставки 
	|		ТОГДА 0
	|	ИНАЧЕ -Строки.Количество
	|	КОНЕЦ КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА (ВЫБОР
	|					КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|						ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|						И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|					ТОГДА -Суммы.СуммаБезНДСРегл - Суммы.СуммаНДСРегл
	|					ИНАЧЕ -Суммы.СуммаБезНДСРегл
	|				КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУКт,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА (ВЫБОР
	|					КОГДА (ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) В (&ТипыНеОблагаемыеНДС)
	|						ИЛИ Расчеты.ЗакупкаПодДеятельность В (&ТипыНеОблагаемыеНДС))
	|							И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|					ТОГДА -Суммы.СуммаБезНДСРегл - Суммы.СуммаНДСРегл
	|					ИНАЧЕ -Суммы.СуммаБезНДСРегл
	|				КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаПРКт,
	|	Суммы.СуммаБезНДСРегл - Суммы.СуммаПриведеннаяРегл КАК СуммаВРКт,
	|	""Отражение корректировки поступления товаров на доходы"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.ВидыЗапасов КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.АналитикаУчетаНоменклатуры.Назначение
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиДоходов КАК СтатьиДоходов
	|	ПО
	|		Операция.СтатьяДоходов = СтатьиДоходов.Ссылка
	|		И Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения
	|
	|ГДЕ
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|	И (Расчеты.КорректировкаТоваровВПути ИЛИ Расчеты.КорректировкаФактуровкиПоставки)
	|	И Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры В (
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар),
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))";
	Возврат КорректировкаТоваров;
	
КонецФункции

Функция ОтклоненияВСтоимостиПриФактуровке()
	
	ТекстыЗапросов = Новый Массив();
	
	ТекстОтклонениеПриФактуровкеТоваровРабот =
	"ВЫБРАТЬ //// Отклонения В стоимости при фактуровке (Дт 10, 20, 41 :: Кт 60.НП)
	|	Операция.Ссылка КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	Строки.СтоимостьРегл + Строки.ДопРасходыРегл КАК Сумма,
	|	Строки.СтоимостьУпр + Строки.ДопРасходыУпр КАК СуммаУУ,
	|
	|	ВЫБОР
	|		КОГДА Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ИЛИ Строки.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НаСкладе)
	|	КОНЕЦ КАК ВидСчетаДт,
	|	
	|	ВЫБОР
	|		КОГДА Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ИЛИ Строки.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ТОГДА НЕОПРЕДЕЛЕНО 
	|		КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			ТОГДА Строки.КорВидЗапасов.ГруппаФинансовогоУчета
	|		ИНАЧЕ Аналитика.Номенклатура.ГруппаФинансовогоУчета
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|	ВЫБОР
	|		КОГДА (Аналитика.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ИЛИ Строки.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|			И Строки.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|			ТОГДА Строки.КорАналитикаУчетаНоменклатуры.СкладскаяТерритория.Подразделение
	|		ИНАЧЕ Аналитика.МестоХранения
	|	КОНЕЦ КАК МестоУчетаДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ВЫБОР
	|		КОГДА Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА Строки.КорАналитикаУчетаНоменклатуры.МестоХранения
	|		ИНАЧЕ Строки.КорАналитикаУчетаНоменклатуры.СкладскаяТерритория.Подразделение 
	|	КОНЕЦ КАК ПодразделениеДт,
	|	ЕСТЬNULL(Назначения.НаправлениеДеятельности,
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиДт,
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|
	|	Строки.АналитикаУчетаНоменклатуры.Номенклатура КАК СубконтоДт1,
	|	Строки.КорАналитикаУчетаНоменклатуры.МестоХранения КАК СубконтоДт2,
	|	ВЫБОР
	|		КОГДА НЕ Строки.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			И Строки.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.МатериальныеЗатраты)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Работы)
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Строки.СтоимостьРегл + Строки.ДопРасходыРегл
	|		- Строки.ПостояннаяРазница 
	|		- Строки.ВременнаяРазница КАК СуммаНУДт,
	|	Строки.ПостояннаяРазница КАК СуммаПРДт,
	|	Строки.ВременнаяРазница КАК СуммаВРДт,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НеотфактурованныеПоставки) 	КАК ВидСчетаКт,
	|	Расчеты.ГруппаФинансовогоУчета											КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО		 													КАК МестоУчетаКт,
	|
	|	НЕОПРЕДЕЛЕНО 								КАК ВалютаКт,
	|	Расчеты.Подразделение  						КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности 			КАК НаправлениеДеятельностиКт,
	|	НЕОПРЕДЕЛЕНО 								КАК СчетКт,
	|
	|	Расчеты.Контрагент 		КАК СубконтоКт1,
	|	Расчеты.Договор 		КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО 					КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Строки.СтоимостьРегл + Строки.ДопРасходыРегл
	|		- Строки.ПостояннаяРазница 
	|		- Строки.ВременнаяРазница КАК СуммаНУКт,
	|	Строки.ПостояннаяРазница КАК СуммаПРКт,
	|	Строки.ВременнаяРазница КАК СуммаВРКт,
	|	
	|	""Отклонения в стоимости товаров"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.СебестоимостьТоваров КАК Строки
	|	ПО
	|		Операция.Ссылка = Строки.Регистратор
	|		И Строки.Количество = 0
	|		И НЕ Строки.РасчетСебестоимости
	|		И Строки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Строки.РасчетПартий
	|		И Строки.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
	|		И Строки.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|	ПО
	|		Строки.КорАналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка
	|		И Расчеты.КорректировкаФактуровкиПоставки
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Назначения КАК Назначения
	|		ПО Строки.КорАналитикаУчетаНоменклатуры.Назначение = Назначения.Ссылка
	|";
	ТекстыЗапросов.Добавить(ТекстОтклонениеПриФактуровкеТоваровРабот);
	
	ТекстОтклонениеПриФактуровкеУслуг = "
	|ВЫБРАТЬ // Отклонение по услугам (Дт 25, 26, 20 :: Кт 60.НП)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата			КАК Период,
	|	Операция.Организация	КАК Организация,
	|	НЕОПРЕДЕЛЕНО			КАК ИдентификаторСтроки,
	|
	|	ДвиженияПрочиеРасходы.СуммаРегл КАК Сумма,
	|	ДвиженияПрочиеРасходы.СуммаУпр КАК СуммаУУ,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	ДвиженияПрочиеРасходы.СтатьяРасходов КАК АналитикаУчетаДт,
	|	ДвиженияПрочиеРасходы.Подразделение КАК МестоУчетаДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ДвиженияПрочиеРасходы.Подразделение КАК ПодразделениеДт,
	|	ДвиженияПрочиеРасходы.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|	ДвиженияПрочиеРасходы.СтатьяРасходов КАК СубконтоДт1,
	|	ДвиженияПрочиеРасходы.АналитикаРасходов КАК СубконтоДт2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходов.ВариантРаспределенияРасходовРегл, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|			И ЕСТЬNULL(ОбъектыСтроительства.СпособСтроительства, ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)) <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)
	|		ТОГДА ОбъектыСтроительства.СпособСтроительства
	|		КОГДА ЕСТЬNULL(СтатьиРасходов.ВариантРаспределенияРасходовРегл, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|			И ЕСТЬNULL(ОбъектыСтроительства.СпособСтроительства, ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)) = ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее)
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	ДвиженияПрочиеРасходы.СуммаРегл
	|		- ДвиженияПрочиеРасходы.ПостояннаяРазница 
	|		- ДвиженияПрочиеРасходы.ВременнаяРазница	КАК СуммаНУДт,
	|	ДвиженияПрочиеРасходы.ПостояннаяРазница КАК СуммаПРДт,
	|	ДвиженияПрочиеРасходы.ВременнаяРазница КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НеотфактурованныеПоставки) КАК ВидСчетаКт,
	|	Операция.Договор.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	&ВалютаРеглУчета КАК ВалютаКт,
	|	Операция.Договор.Подразделение КАК ПодразделениеКт,
	|	Операция.Договор.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|
	|	НеотфактурованныеПоставки.АналитикаУчетаНоменклатуры.Номенклатура КАК СубконтоКт1,
	|	Операция.Контрагент 				КАК СубконтоКт2,
	|	Операция.Договор 					КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	НеотфактурованныеПоставки.Количество КАК КоличествоКт,
	|	НеотфактурованныеПоставки.СтоимостьРегл 
	|		+ НеотфактурованныеПоставки.ДопРасходыРегл 
	|		- НеотфактурованныеПоставки.ПостояннаяРазница 
	|		- НеотфактурованныеПоставки.ВременнаяРазница	КАК СуммаНУКт,
	|	НеотфактурованныеПоставки.ПостояннаяРазница КАК СуммаПРКт,
	|	НеотфактурованныеПоставки.ВременнаяРазница КАК СуммаВРКт,
	|
	|	""Отклонения в стоимости услуг"" КАК Содержание
	|
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрНакопления.СебестоимостьТоваров КАК НеотфактурованныеПоставки
	|	ПО 
	|		НеотфактурованныеПоставки.Регистратор = Операция.Ссылка
	|		И НеотфактурованныеПоставки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И НеотфактурованныеПоставки.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрНакопления.ПрочиеРасходы КАК ДвиженияПрочиеРасходы
	|	ПО 
	|		ДвиженияПрочиеРасходы.Регистратор = Операция.Ссылка
	|		И ДвиженияПрочиеРасходы.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И ДвиженияПрочиеРасходы.ИдентификаторФинЗаписи = НеотфактурованныеПоставки.ИдентификаторФинЗаписи
	|		И ДвиженияПрочиеРасходы.НастройкаХозяйственнойОперации = НеотфактурованныеПоставки.НастройкаХозяйственнойОперации
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|	ПО
	|		ДвиженияПрочиеРасходы.СтатьяРасходов = СтатьиРасходов.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО
	|		ДвиженияПрочиеРасходы.АналитикаРасходов = ОбъектыСтроительства.Ссылка
	|";
	ТекстыЗапросов.Добавить(ТекстОтклонениеПриФактуровкеУслуг);

	Возврат СтрСоединить(ТекстыЗапросов, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());
	
КонецФункции

Функция КорректировкаУслугНаРасходы()
	
	КорректировкаУслугНаРасходы = "
	|ВЫБРАТЬ //// Корректировка приобретения услуг (Дт 08, 2Х, 44, 91, ХХ :: Кт 60, 71, 76)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|		ТОГДА Строки.НомерСтроки
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, ЕСТЬNULL(СтатьиРасходовДокумента.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО)) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, ЕСТЬNULL(СтатьиРасходовДокумента.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО)) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|		ИНАЧЕ Суммы.СуммаПриведеннаяУпр
	|	КОНЕЦ КАК СуммаУУ,
	|		
	|	ВЫБОР
	|		КОГДА НЕ (СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL И СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы)
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|				ИЛИ НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПрочиеАктивыПассивы)
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ТоварыКомитентовКОформлениюПоЗакупке)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство)
	|	КОНЕЦ КАК ВидСчетаДт,
	|
	|	ВЫБОР
	|		КОГДА НЕ (СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL И СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL)
	|		ТОГДА ЕСТЬNULL(СтатьиРасходовСтроки.Ссылка, ЕСТЬNULL(СтатьиРасходовДокумента.Ссылка, НЕОПРЕДЕЛЕНО))
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|				ИЛИ НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Назначения.Договор.ГруппаФинансовогоУчета
	|		ИНАЧЕ Строки.ВидЗапасов.ГруппаПродукции
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|
	|	ВЫБОР 
	|		КОГДА НЕ СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL
	|		ТОГДА Операция.Подразделение
	|		КОГДА НЕ СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL
	|		ТОГДА Строки.Подразделение
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|				ИЛИ НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА Операция.ДокументОснование ССЫЛКА Документ.ОтчетПереработчика2_5
	|		ТОГДА Операция.Партнер
	|		ИНАЧЕ Строки.Подразделение
	|	КОНЕЦ КАК МестоУчетаДт,
	|
	|	ЕСТЬNULL(ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.Валюта, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)) КАК ВалютаДт,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL
	|		ТОГДА Операция.Подразделение
	|		КОГДА НЕ (СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL И НастройкиСчетовУчета.Ссылка ЕСТЬ NULL)
	|		ТОГДА Строки.Подразделение
	|		КОГДА Строки.ВариантОтражения В (ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|										ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|		ТОГДА Операция.Подразделение
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Назначения.Договор.Подразделение
	|		КОГДА Операция.ДокументОснование ССЫЛКА Документ.ОтчетПереработчика2_5
	|		ТОГДА Операция.Договор.Подразделение
	|		ИНАЧЕ Строки.Подразделение
	|	КОНЕЦ КАК ПодразделениеДт,
	|	ВЫБОР
	|		КОГДА Строки.СписатьНаРасходы И Строки.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	|			ТОГДА Строки.НаправлениеДеятельности
	|		КОГДА Строки.СписатьНаРасходы
	|			ТОГДА Операция.НаправлениеДеятельности
	|		КОГДА СпрПартииПроизводстваОтчета.НаправлениеДеятельности ЕСТЬ НЕ NULL
	|		ТОГДА СпрПартииПроизводстваОтчета.НаправлениеДеятельности
	//++ НЕ УТКА
	|		КОГДА СпрПартииПроизводстваЭтапа.НаправлениеДеятельности ЕСТЬ НЕ NULL
	|		ТОГДА СпрПартииПроизводстваЭтапа.НаправлениеДеятельности
	//-- НЕ УТКА
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			И &УчитыватьСебестоимостьТоваровПоНазначениям И НЕ Строки.СписатьНаРасходы
	|			И Операция.Дата >= &ДатаВключенияСебестоимостиПоНазначениям
	|		ТОГДА ЕСТЬNULL(Строки.Назначение.НаправлениеДеятельности, Строки.НаправлениеДеятельности)
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			И НЕ Строки.СписатьНаРасходы
	|		ТОГДА ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|		ИНАЧЕ Расчеты.НаправлениеДеятельности
	|	КОНЕЦ КАК НаправлениеДеятельностиДт,
	|
	|	ВЫБОР
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|			И Операция.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.СчетУчета
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.СчетУчета
	|		ИНАЧЕ ЕСТЬNULL(НастройкиСчетовУчета.СчетУчета, ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка))
	|	КОНЕЦ КАК СчетДт,
	|	ВЫБОР
	|		КОГДА НЕ (СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL И СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL)
	|		ТОГДА ЕСТЬNULL(СтатьиРасходовСтроки.Ссылка, ЕСТЬNULL(СтатьиРасходовДокумента.Ссылка, НЕОПРЕДЕЛЕНО))
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|		ТОГДА НастройкиСчетовУчета.Субконто1
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|			И Операция.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто1
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто1
	|		ИНАЧЕ Строки.Номенклатура
	|	КОНЕЦ КАК СубконтоДт1,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходовДокумента.Ссылка ЕСТЬ NULL
	|		ТОГДА Операция.АналитикаРасходов
	|		КОГДА НЕ СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL
	|		ТОГДА Строки.АналитикаРасходов
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|		ТОГДА НастройкиСчетовУчета.Субконто2
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|			И Операция.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто2
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто2
	|		КОГДА ЕстьNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Назначения.Договор.Контрагент
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа) И НЕ Строки.СписатьНаРасходы
	|		ТОГДА Строки.ВидЗапасов.ГруппаПродукции
	|		ИНАЧЕ Строки.Склад
	|	КОНЕЦ КАК СубконтоДт2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаспределенияРасходовРегл, ЕСТЬNULL(СтатьиРасходовДокумента.ВариантРаспределенияРасходовРегл, НЕОПРЕДЕЛЕНО)) = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		ТОГДА ЕСТЬNULL(ОбъектыСтроительстваСтроки.СпособСтроительства, ЕСТЬNULL(ОбъектыСтроительстваДокумента.СпособСтроительства, ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный)))
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|		ТОГДА НастройкиСчетовУчета.Субконто3
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|			И Операция.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаАктивов.Субконто3
	|		КОГДА Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|			И Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|		ТОГДА Операция.НастройкаСчетовУчетаПассивов.Субконто3
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа) И НЕ Строки.СписатьНаРасходы
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Работы)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее)
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	ЕСТЬNULL(ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.СуммаСНДС, 0)  КАК ВалютнаяСуммаДт,
	|	Строки.Количество КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ЕСТЬNULL(СтатьиРасходовДокумента.ПринятиеКНалоговомуУчету, ИСТИНА)) = ИСТИНА
	|		ТОГДА (ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|					ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|					И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, ЕСТЬNULL(СтатьиРасходовДокумента.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО)) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|					И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|				ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|				ИНАЧЕ Суммы.СуммаБезНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ЕСТЬNULL(СтатьиРасходовДокумента.ПринятиеКНалоговомуУчету, ИСТИНА)) = ЛОЖЬ
	|		ТОГДА (ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|					ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|					И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, ЕСТЬNULL(СтатьиРасходовДокумента.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО)) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|					И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|				ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|				ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаПРДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ЕСТЬNULL(СтатьиРасходовДокумента.ПринятиеКНалоговомуУчету, ИСТИНА)) = ИСТИНА
	|		ТОГДА Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками) КАК ВидСчетаКт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, ЕСТЬNULL(СтатьиРасходовДокумента.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО)) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|	ТОГДА
	|		Суммы.СуммаПриведенная + Суммы.СуммаНДС
	|	ИНАЧЕ
	|		Суммы.СуммаПриведенная
	|	КОНЕЦ КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, ЕСТЬNULL(СтатьиРасходовДокумента.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО)) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаБезНДСРегл
	|	КОНЕЦ КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл КАК СуммаВРКт,
	|	""Корректировка приобретения услуг"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.Расхождения КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках КАК ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках
	|	ПО
	|		Строки.Ссылка = ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.Регистратор
	|		И Строки.ИдентификаторСтроки = ТоварыУслугиКОформлениюОтчетовКомитентуОЗакупках.ИдентификаторСтроки
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.НастройкиСчетовУчетаПрочихОпераций КАК НастройкиСчетовУчета
	|	ПО
	|		Строки.НастройкаСчетовУчета = НастройкиСчетовУчета.Ссылка
	|		И Строки.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходовДокумента
	|	ПО
	|		Операция.СтатьяРасходов = СтатьиРасходовДокумента.Ссылка
	|		И Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
	|		И НЕ Строки.СписатьНаРасходы
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходовСтроки
	|	ПО
	|		Строки.СтатьяРасходов = СтатьиРасходовСтроки.Ссылка
	|		И (Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УменьшитьСтоимостьТовара)
	|		ИЛИ Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.УвеличитьСтоимостьТовара)
	|		ИЛИ Строки.СписатьНаРасходы)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительстваДокумента
	|	ПО 
	|		ОбъектыСтроительстваДокумента.Ссылка = Операция.АналитикаРасходов
	|		И СтатьиРасходовДокумента.Ссылка ЕСТЬ НЕ NULL
	|		И СтатьиРасходовДокумента.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		И ОбъектыСтроительстваДокумента.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительстваСтроки
	|	ПО 
	|		ОбъектыСтроительстваСтроки.Ссылка = Строки.АналитикаРасходов
	|		И СтатьиРасходовСтроки.Ссылка ЕСТЬ НЕ NULL
	|		И СтатьиРасходовСтроки.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		И ОбъектыСтроительстваСтроки.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.Назначение
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ПартииПроизводства КАК СпрПартииПроизводстваОтчета
	|	ПО
	|		СпрПартииПроизводстваОтчета.Документ = Операция.ДокументОснование
	|		И СпрПартииПроизводстваОтчета.Код = Строки.НомерГруппыЗатрат
	|		И НЕ СпрПартииПроизводстваОтчета.ПометкаУдаления
	//++ НЕ УТКА
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ПартииПроизводства КАК СпрПартииПроизводстваЭтапа
	|	ПО
	|		СпрПартииПроизводстваЭтапа.Ссылка = Строки.ЭтапПроизводства.ПартияПроизводства
	|		И НЕ СпрПартииПроизводстваЭтапа.ПометкаУдаления
	//-- НЕ УТКА
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения
	|
	|ГДЕ
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|	И (Строки.СписатьНаРасходы
	|		ИЛИ ЕСТЬNULL(Строки.Номенклатура.ТипНоменклатуры, ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.ПустаяСсылка)) НЕ В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)))
	|	И НЕ (Операция.Договор.ВариантОформленияЗакупок = ЗНАЧЕНИЕ(Перечисление.ВариантыОформленияЗакупок.НеотфактурованныеПоставкиТоваровИУслуг)
	|			И Расчеты.КорректировкаФактуровкиПоставки
	|			И НЕ Строки.ВариантОтражения В (
	|				ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах),
	|				ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)))
	|	И НЕ (Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|		И (Строки.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиДоходов ИЛИ Операция.СтатьяДоходов ССЫЛКА ПланВидовХарактеристик.СтатьиДоходов))
    |	И (НЕ(Операция.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаОтчетаПереработчика)
    |					И Строки.ВариантОтражения <> ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы))
    |			ИЛИ (Операция.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаОтчетаПереработчика)
    |				И Строки.ВариантОтражения <> ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы)
    |				И НАЧАЛОПЕРИОДА(ЕСТЬNULL(ВЫРАЗИТЬ(Операция.ДокументОснование КАК Документ.ОтчетПереработчика2_5).Дата, ДАТАВРЕМЯ(1, 1, 1)), МЕСЯЦ) = НАЧАЛОПЕРИОДА(Операция.Дата, МЕСЯЦ)))
	|";
	
	Возврат КорректировкаУслугНаРасходы;
	
КонецФункции

Функция КорректировкаУслугНаРасходыНоваяПереработка()
	
	КорректировкаУслугНаРасходыНоваяПереработка = "
	|ВЫБРАТЬ //// Корректировка приобретения услуг (Дт 08, 2Х, 44, 91 :: Кт 60, 71, 76)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведеннаяУпр + Суммы.СуммаНДСУпр
	|		ИНАЧЕ Суммы.СуммаПриведеннаяУпр
	|	КОНЕЦ КАК СуммаУУ,
	|		
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ВыбытияТоваровВПрошлыхПериодах) КАК АналитикаУчетаДт,
	|
	|	Строки.Подразделение КАК МестоУчетаДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	ВЫБОР
	|		КОГДА Строки.СписатьНаРасходы И Строки.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	|			ТОГДА Строки.НаправлениеДеятельности
	|		КОГДА Строки.СписатьНаРасходы
	|			ТОГДА Операция.НаправлениеДеятельности
	|		КОГДА СпрПартииПроизводстваОтчета.НаправлениеДеятельности ЕСТЬ НЕ NULL
	|		ТОГДА СпрПартииПроизводстваОтчета.НаправлениеДеятельности
	//++ НЕ УТКА
	|		КОГДА СпрПартииПроизводстваЭтапа.НаправлениеДеятельности ЕСТЬ НЕ NULL
	|		ТОГДА СпрПартииПроизводстваЭтапа.НаправлениеДеятельности
	//-- НЕ УТКА
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			И &УчитыватьСебестоимостьТоваровПоНазначениям И НЕ Строки.СписатьНаРасходы
	|			И Операция.Дата >= &ДатаВключенияСебестоимостиПоНазначениям
	|		ТОГДА ЕСТЬNULL(Строки.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			И НЕ Строки.СписатьНаРасходы
	|		ТОГДА ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|		ИНАЧЕ Расчеты.НаправлениеДеятельности
	|	КОНЕЦ КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ВыбытияТоваровВПрошлыхПериодах) КАК СубконтоДт1,
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее) КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	Строки.Количество КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ИСТИНА) = ИСТИНА
	|		ТОГДА (ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|					ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|							ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|					И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|					И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|				ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|				ИНАЧЕ Суммы.СуммаБезНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ИСТИНА) = ЛОЖЬ
	|		ТОГДА (ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|					ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|					КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|					И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|					И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|				ТОГДА Суммы.СуммаПриведеннаяРегл + Суммы.СуммаНДСРегл
	|				ИНАЧЕ Суммы.СуммаПриведеннаяРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаПРДт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ПринятиеКНалоговомуУчету, ИСТИНА) = ИСТИНА
	|		ТОГДА Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками) КАК ВидСчетаКт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаПриведенная + Суммы.СуммаНДС
	|		ИНАЧЕ Суммы.СуммаПриведенная
	|	КОНЕЦ КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		КОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|					ТОГДА Назначения.ВидДеятельностиНДС
	|				ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|			И ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаздельногоУчетаНДС, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
	|			И НЕ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ)
	|		ТОГДА Суммы.СуммаБезНДСРегл + Суммы.СуммаНДСРегл
	|		ИНАЧЕ Суммы.СуммаБезНДСРегл
	|	КОНЕЦ КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	Суммы.СуммаПриведеннаяРегл - Суммы.СуммаБезНДСРегл КАК СуммаВРКт,
	|	""Корректировка приобретения услуг"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.Расхождения КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходовСтроки
	|	ПО
	|		Строки.СтатьяРасходов = СтатьиРасходовСтроки.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.Склады КАК Склады
	|	ПО
	|		Склады.Ссылка = Строки.Склад
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка	
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.Назначение
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ПартииПроизводства КАК СпрПартииПроизводстваОтчета
	|	ПО
	|		СпрПартииПроизводстваОтчета.Документ = Операция.ДокументОснование
	|		И СпрПартииПроизводстваОтчета.Код = Строки.НомерГруппыЗатрат
	|		И НЕ СпрПартииПроизводстваОтчета.ПометкаУдаления
	//++ НЕ УТКА
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ПартииПроизводства КАК СпрПартииПроизводстваЭтапа
	|	ПО
	|		СпрПартииПроизводстваЭтапа.Ссылка = Строки.ЭтапПроизводства.ПартияПроизводства
	|		И НЕ СпрПартииПроизводстваЭтапа.ПометкаУдаления
	//-- НЕ УТКА
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения
	|
	|ГДЕ
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|	И (Строки.СписатьНаРасходы 
	|		ИЛИ ЕСТЬNULL(Строки.Номенклатура.ТипНоменклатуры, ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.ПустаяСсылка)) НЕ В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)))
	|	И Строки.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиРасходов
	|	И Операция.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаОтчетаПереработчика)
	|	И НЕ Строки.ВариантОтражения В (
	|			ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|			ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|	И НАЧАЛОПЕРИОДА(ВЫРАЗИТЬ(Операция.ДокументОснование КАК Документ.ОтчетПереработчика2_5).Дата, МЕСЯЦ) <
	|		НАЧАЛОПЕРИОДА(Операция.Дата, МЕСЯЦ)
	|";
	
	Возврат КорректировкаУслугНаРасходыНоваяПереработка;
	
КонецФункции

Функция КорректировкаНаДоходыПоСтрокам()
	
	КорректировкаНаДоходыПоСтрокам = "
	|ВЫБРАТЬ //// Корректировка приобретения услуг (Дт 60, 71, 76 :: Кт 91.01)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА -Суммы.СуммаПриведеннаяРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА -Суммы.СуммаПриведеннаяРегл - Суммы.СуммаНДСРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА -Суммы.СуммаПриведеннаяУпр
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА -Суммы.СуммаПриведеннаяУпр - Суммы.СуммаНДСУпр
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	ВЫБОР КОГДА Расчеты.ВернутьМногооборотнуюТару
	|		И Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|	ТОГДА
	|		ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщикамиТара)
	|	ИНАЧЕ
	|		ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками)
	|	КОНЕЦ КАК ВидСчетаДт,
	|
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаДт,
	|	Расчеты.Подразделение КАК ПодразделениеДт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|	Расчеты.Контрагент КАК СубконтоДт1,
	|	Расчеты.Договор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	(ВЫБОР КОГДА ВЫБОР КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Строки.Назначение.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС) 
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА - Суммы.СуммаПриведенная
	|		КОГДА ВЫБОР КОГДА ЕСТЬNULL(Строки.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Строки.Назначение.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА - Суммы.СуммаПриведенная - Суммы.СуммаНДС
	|	КОНЕЦ) КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыОблагаемыеНДС)
	|			ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|		ТОГДА -Суммы.СуммаБезНДСРегл
	|		КОГДА ВЫБОР
	|			КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|			ТОГДА Назначения.ВидДеятельностиНДС
	|			ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|			КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|		ТОГДА -Суммы.СуммаБезНДСРегл - Суммы.СуммаНДСРегл
	|	КОНЕЦ КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	Суммы.СуммаБезНДСРегл - Суммы.СуммаПриведеннаяРегл КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Доходы) КАК ВидСчетаКт,
	|	СтатьиДоходов.Ссылка КАК АналитикаУчетаКт,
	|	Строки.Подразделение КАК МестоУчетаКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаКт,
	|	Строки.Подразделение КАК ПодразделениеКт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|
	|	СтатьиДоходов.Ссылка КАК СубконтоКт1,
	|	Строки.АналитикаДоходов КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА (ВЫБОР
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыОблагаемыеНДС)
	|						ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|				ТОГДА -Суммы.СуммаБезНДСРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|				ТОГДА -Суммы.СуммаБезНДСРегл - Суммы.СуммаНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУКт,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА (ВЫБОР
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС, &ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыОблагаемыеНДС)
	|						ИЛИ ЕСТЬNULL(УчетнаяПолитикаОрганизаций.НДСПредъявленныйПриВключенииВСтоимость, ЛОЖЬ) 
	|				ТОГДА -Суммы.СуммаПриведеннаяРегл
	|				КОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(Назначения.ВидДеятельностиНДС,&ПустойТипНалогообложения) <> &ПустойТипНалогообложения
	|						ТОГДА Назначения.ВидДеятельностиНДС
	|						ИНАЧЕ Расчеты.ЗакупкаПодДеятельность
	|						КОНЕЦ В (&ТипыНеОблагаемыеНДС)
	|				ТОГДА -Суммы.СуммаПриведеннаяРегл - Суммы.СуммаНДСРегл
	|			КОНЕЦ)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаПРКт,
	|	Суммы.СуммаБезНДСРегл - Суммы.СуммаПриведеннаяРегл КАК СуммаВРКт,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(Строки.Номенклатура.ТипНоменклатуры, ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.ПустаяСсылка)) В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|			ТОГДА ""Корректировка поступления товаров на доходы""
	|		ИНАЧЕ
	|			""Корректировка приобретения услуг на доходы""
	|	КОНЕЦ КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.Расхождения КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.Назначение
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СуммыДокументовВВалютахУчета КАК Суммы
	|	ПО
	|		Суммы.Регистратор = Строки.Ссылка
	|		И Суммы.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиДоходов КАК СтатьиДоходов
	|	ПО
	|		Строки.СтатьяРасходов = СтатьиДоходов.Ссылка
	|		И Строки.ВариантОтражения = ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|	ПО
	|		Операция.Ссылка = УчетнаяПолитикаОрганизаций.Ссылка
	|		И Операция.Организация = УчетнаяПолитикаОрганизаций.Организация
	|		И НАЧАЛОПЕРИОДА(Операция.Дата, ДЕНЬ) = УчетнаяПолитикаОрганизаций.ДатаОтражения
	|ГДЕ
	|	(Расчеты.ЕстьВзаиморасчеты ИЛИ Суммы.СуммаБезНДС = 0)
	|";
	
	Возврат КорректировкаНаДоходыПоСтрокам;
	
КонецФункции

Функция ЗакупкаНДС()
	
	ЗакупкаНДС = "
	|ВЫБРАТЬ // НДС при поступлении по рег. НДСПредъявленный (Дт <19.ХХ> :: Кт <60.ХХ, 76.ХХ, 71>) @НДСПредъявленный
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	НДСПредъявленный.НДС КАК Сумма,
	|	НДСПредъявленный.НДСУпр КАК СуммаУУ,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСпоПриобретеннымЦенностям) КАК ВидСчетаДт,
	|	НДСПредъявленный.ВидДеятельностиНДС                                    КАК АналитикаУчетаДт,
	|	НДСПредъявленный.ВидЦенности                                           КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)                               КАК ВалютаДт,
	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)                 КАК ПодразделениеДт,
	|	ЕСТЬNULL(ВводСобственныхСредств.НаправлениеДеятельности, НДСПредъявленный.НаправлениеДеятельности) КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|
	|	НДСПредъявленный.Поставщик  КАК СубконтоДт1,
	|	НДСПредъявленный.СчетФактура КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	Строки.Количество КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками) КАК ВидСчетаКт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	Операция.ВалютаВзаиморасчетов КАК ВалютаКт,
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	Строки.СуммаНДСВзаиморасчетов КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Корректировка НДС"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		СтрокиНДС КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.НДСПредъявленный КАК НДСПредъявленный
	|	ПО
	|		НДСПредъявленный.Регистратор = Строки.Ссылка
	|		И НДСПредъявленный.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И НДСПредъявленный.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|		И НЕ НДСПредъявленный.РегламентнаяОперация
	|		И НЕ НДСПредъявленный.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ТоварыНалоговыйАгент)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО 
	|		Расчеты.Ссылка = Операция.Ссылка
	|		И Расчеты.ЕстьВзаиморасчеты
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТВводСобственныхСредств КАК ВводСобственныхСредств
	|	ПО ДокументыКОтражению.Ссылка = ВводСобственныхСредств.Ссылка
	|		И НДСПредъявленный.СчетФактура = ВводСобственныхСредств.СчетФактура
	|		И НДСПредъявленный.НаправлениеДеятельности = ВводСобственныхСредств.ИсходноеНаправлениеДеятельности
	|
	|";
	
	Возврат ЗакупкаНДС;
	
КонецФункции

Функция КорректировкаНДС()
	
	КорректировкаНДС = "
	|ВЫБРАТЬ // Корректировка НДС при поступлении по рег. НДСПредъявленный (Дт 10, 41, 25, 26, 44, 20, <ХХ.ХХ> :: Кт 19) @НДСПредъявленный
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	-НДСПредъявленный.НДС КАК Сумма,
	|	-НДСПредъявленный.НДСУпр КАК СуммаУУ,
	|
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы)
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПрочиеАктивыПассивы)
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ТоварыКомитентовКОформлениюПоЗакупке)
	|		КОГДА ЕСТЬNULL(Строки.Склад.ЦеховаяКладовая, ЛОЖЬ)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НаСкладе)
	|	КОНЕЦ КАК ВидСчетаДт,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL
	|			ТОГДА ЕСТЬNULL(СтатьиРасходовСтроки.Ссылка, НЕОПРЕДЕЛЕНО)
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Назначения.Договор.ГруппаФинансовогоУчета
	|		КОГДА ЕСТЬNULL(Строки.Склад.ЦеховаяКладовая, ЛОЖЬ)
	|			ТОГДА Строки.ВидЗапасов.ГруппаПродукции
	|		ИНАЧЕ
	|			ВЫБОР
	|			КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			ТОГДА Строки.ВидЗапасов.ГруппаФинансовогоУчета
	|			ИНАЧЕ Строки.Номенклатура.ГруппаФинансовогоУчета
	|		КОНЕЦ
	|	КОНЕЦ КАК АналитикаУчетаДт,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL
	|			ТОГДА Строки.Подразделение
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ЕСТЬNULL(Строки.Склад.ЦеховаяКладовая, ЛОЖЬ)
	|			ТОГДА Строки.Склад.Подразделение
	|		ИНАЧЕ Строки.Склад
	|	КОНЕЦ КАК МестоУчетаДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	ВЫБОР
	|	КОГДА НЕ (СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL И НастройкиСчетовУчета.Ссылка ЕСТЬ NULL)
	|		ТОГДА Строки.Подразделение
	|	КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|		ТОГДА Назначения.Договор.Подразделение
	|	ИНАЧЕ
	|		Строки.Склад.Подразделение
	|	КОНЕЦ КАК ПодразделениеДт,
	|	ВЫБОР КОГДА Строки.НаправлениеДеятельности <> ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) ТОГДА
	|		Строки.НаправлениеДеятельности
	|	ИНАЧЕ
	|		ЕСТЬNULL(Назначения.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
	|	КОНЕЦ КАК НаправлениеДеятельностиДт,
	|
	|	ЕСТЬNULL(НастройкиСчетовУчета.СчетУчета, ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)) КАК СчетДт,
	|
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL
	|			ТОГДА ЕСТЬNULL(СтатьиРасходовСтроки.Ссылка, НЕОПРЕДЕЛЕНО)
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|			ТОГДА НастройкиСчетовУчета.Субконто1
	|		ИНАЧЕ Строки.Номенклатура
	|	КОНЕЦ КАК СубконтоДт1,
	|	ВЫБОР
	|		КОГДА НЕ СтатьиРасходовСтроки.Ссылка ЕСТЬ NULL
	|			ТОГДА Строки.АналитикаРасходов
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|			ТОГДА НастройкиСчетовУчета.Субконто2
	|		КОГДА ЕСТЬNULL(Назначения.ТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА Строки.ВидЗапасов.Контрагент
	|		КОГДА ЕСТЬNULL(Строки.Склад.ЦеховаяКладовая, ЛОЖЬ)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.МатериальныеЗатраты)
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА Строки.ВидЗапасов.ГруппаПродукции
	|		ИНАЧЕ Строки.Склад
	|	КОНЕЦ КАК СубконтоДт2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(СтатьиРасходовСтроки.ВариантРаспределенияРасходовРегл, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|			ТОГДА ЕСТЬNULL(ОбъектыСтроительстваСтроки.СпособСтроительства, ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.Подрядный))
	|		КОГДА НЕ НастройкиСчетовУчета.Ссылка ЕСТЬ NULL
	|			ТОГДА НастройкиСчетовУчета.Субконто3
	|		КОГДА Строки.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа) И НЕ Строки.СписатьНаРасходы
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Работы)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее)
	|	КОНЕЦ КАК СубконтоДт3,
	|	
	|	0 КАК ВалютнаяСуммаДт,
	|	Строки.Количество КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСпоПриобретеннымЦенностям) КАК ВидСчетаКт,
	|	НДСПредъявленный.ВидДеятельностиНДС КАК АналитикаУчетаКт,
	|	НДСПредъявленный.ВидЦенности КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеКт,
	|	ЕСТЬNULL(ВводСобственныхСредств.НаправлениеДеятельности, НДСПредъявленный.НаправлениеДеятельности) КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|
	|	НДСПредъявленный.Поставщик КАК СубконтоКт1,
	|	НДСПредъявленный.СчетФактура КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	-Строки.СуммаНДС КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Корректировка НДС"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения.Расхождения КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.Назначения КАК Назначения
	|	ПО
	|		Назначения.Ссылка = Строки.Назначение
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.НДСПредъявленный КАК НДСПредъявленный
	|	ПО
	|		НДСПредъявленный.Регистратор = Строки.Ссылка
	|		И НДСПредъявленный.ИдентификаторСтроки = Строки.ИдентификаторСтроки
	|		И НЕ НДСПредъявленный.РегламентнаяОперация
	|		И НЕ НДСПредъявленный.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ТоварыНалоговыйАгент)
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ВТВводСобственныхСредств КАК ВводСобственныхСредств
	|	ПО
	|		ДокументыКОтражению.Ссылка = ВводСобственныхСредств.Ссылка
	|		И НДСПредъявленный.СчетФактура = ВводСобственныхСредств.СчетФактура
	|		И НДСПредъявленный.НаправлениеДеятельности = ВводСобственныхСредств.ИсходноеНаправлениеДеятельности
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.НастройкиСчетовУчетаПрочихОпераций КАК НастройкиСчетовУчета
	|	ПО
	|		Строки.НастройкаСчетовУчета = НастройкиСчетовУчета.Ссылка
	|		И Строки.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Расчеты КАК Расчеты
	|	ПО
	|		Расчеты.Ссылка = Операция.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходовСтроки
	|	ПО
	|		Строки.СтатьяРасходов = СтатьиРасходовСтроки.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительстваСтроки
	|	ПО 
	|		ОбъектыСтроительстваСтроки.Ссылка = Строки.АналитикаРасходов
	|		И СтатьиРасходовСтроки.Ссылка ЕСТЬ НЕ NULL
	|		И СтатьиРасходовСтроки.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|		И ОбъектыСтроительстваСтроки.СпособСтроительства <> ЗНАЧЕНИЕ(Перечисление.СпособыСтроительства.ПустаяСсылка)
	|
	|ГДЕ
	|	НЕ Расчеты.ЕстьВзаиморасчеты
	|	И НЕ Строки.ВариантОтражения В (
	|		ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.СписатьНаРасходы),
	|		ЗНАЧЕНИЕ(Перечисление.ВариантыОтраженияКорректировокПоступлений.ОтразитьНаПрочихДоходах))
	|
	|";
	
	Возврат КорректировкаНДС;
	
КонецФункции

Функция ЗачетАванса()
	
	ТекстЗачетАвансовПоставщикам = "
	|ВЫБРАТЬ //// Зачет авансов поставщикам (Дт <60.01> :: Кт <60.02, 76>)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Расчеты.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	-Расчеты.ПредоплатаРегл КАК Сумма,
	|	-Расчеты.ПредоплатаУпр КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками) КАК ВидСчетаДт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	Расчеты.Валюта КАК ВалютаДт,
	|	Расчеты.Подразделение КАК ПодразделениеДт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	Расчеты.Контрагент КАК СубконтоДт1,
	|	Расчеты.Договор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	-Расчеты.Предоплата КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	-Расчеты.ПредоплатаРегл КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные) КАК ВидСчетаКт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	Расчеты.Валюта КАК ВалютаКт,
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	-Расчеты.Предоплата КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	-Расчеты.ПредоплатаРегл КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Зачет авансов поставщикам"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РасчетыСПоставщикамиПоДокументам КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка И Расчеты.ПредоплатаРегл < 0
	|";
	
	Возврат ТекстЗачетАвансовПоставщикам;
	
КонецФункции

Функция ВыделениеАванса()
	
	ТекстЗачетАвансовПоставщикам = "
	|ВЫБРАТЬ //// Восстановление аванса поставщику (Дт <60.02, 76> :: Кт <60.01>)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Расчеты.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	Расчеты.ПредоплатаРегл КАК Сумма,
	|	Расчеты.ПредоплатаУпр КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.АвансыВыданные) КАК ВидСчетаДт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	Расчеты.Валюта КАК ВалютаДт,
	|	Расчеты.Подразделение КАК ПодразделениеДт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	Расчеты.Контрагент КАК СубконтоДт1,
	|	Расчеты.Договор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	Расчеты.Предоплата КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	Расчеты.ПредоплатаРегл КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками) КАК ВидСчетаКт,
	|	Расчеты.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	Расчеты.Валюта КАК ВалютаКт,
	|	Расчеты.Подразделение КАК ПодразделениеКт,
	|	Расчеты.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	Расчеты.Контрагент КАК СубконтоКт1,
	|	Расчеты.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	Расчеты.Предоплата КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	Расчеты.ПредоплатаРегл КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Восстановление аванса поставщику"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РасчетыСПоставщикамиПоДокументам КАК Расчеты
	|	ПО 
	|		Операция.Ссылка = Расчеты.Ссылка И Расчеты.ПредоплатаРегл > 0
	|";
	
	Возврат ТекстЗачетАвансовПоставщикам;
	
КонецФункции

Функция ТекстПроцентыПоДисконтированию()
	
	Текст = "
	|ВЫБРАТЬ // Проценты по дисконтированию (Дт 76.хх :: Кт 60, 76)
	|	
	|	РасчетыПоДисконтированию.Регистратор КАК Ссылка,
	|	РасчетыПоДисконтированию.Период КАК Период,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|	
	|	ВЫБОР
	|		КОГДА РасчетыПоДисконтированию.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА РасчетыПоДисконтированию.СуммаДисконтированияРегл
	|		ИНАЧЕ -РасчетыПоДисконтированию.СуммаДисконтированияРегл
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА РасчетыПоДисконтированию.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА РасчетыПоДисконтированию.СуммаДисконтированияУпр
	|		ИНАЧЕ -РасчетыПоДисконтированию.СуммаДисконтированияУпр
	|	КОНЕЦ КАК СуммаУУ,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПроцентыПоДисконтированию) КАК ВидСчетаДт,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	РасчетыПоДисконтированию.Валюта КАК ВалютаДт,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.Подразделение КАК ПодразделениеДт,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.Контрагент КАК СубконтоДт1,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.Договор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|	
	|	ВЫБОР
	|		КОГДА РасчетыПоДисконтированию.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА РасчетыПоДисконтированию.СуммаДисконтирования
	|		ИНАЧЕ -РасчетыПоДисконтированию.СуммаДисконтирования
	|	КОНЕЦ КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	ВЫБОР
	|		КОГДА РасчетыПоДисконтированию.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА РасчетыПоДисконтированию.СуммаДисконтированияРегл
	|		ИНАЧЕ -РасчетыПоДисконтированию.СуммаДисконтированияРегл
	|	КОНЕЦ КАК СуммаВРДт,
	|	
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.РасчетыСПоставщиками) КАК ВидСчетаКт,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|	
	|	РасчетыПоДисконтированию.Валюта КАК ВалютаКт,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.Подразделение КАК ПодразделениеКт,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|	
	|	РасчетыПоДисконтированию.ОбъектРасчетов.Контрагент КАК СубконтоКт1,
	|	РасчетыПоДисконтированию.ОбъектРасчетов.Договор КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	ВЫБОР
	|		КОГДА РасчетыПоДисконтированию.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА РасчетыПоДисконтированию.СуммаДисконтирования
	|		ИНАЧЕ -РасчетыПоДисконтированию.СуммаДисконтирования
	|	КОНЕЦ КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""Проценты по дисконтированию"" КАК Содержание
	|
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПроцентныеРасходыДисконтирования КАК РасчетыПоДисконтированию
	|	ПО
	|		РасчетыПоДисконтированию.Регистратор = ДокументыКОтражению.Ссылка
	|";
	Возврат Текст;
	
КонецФункции

Функция ТекстОтклонениеВСтоимостиРасходы()
	
	ТекстЗапроса = РеглУчетВыборкиСерверПовтИсп.ТекстОтклонениеВСтоимостиРасходы(Истина, Истина);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОтборПоУмолчанию", "Стоимости.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику)");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстОтклонениеВСтоимостиДоходы()
	
	ТекстЗапроса = РеглУчетВыборкиСерверПовтИсп.ТекстОтклонениеВСтоимостиДоходы(Истина, Истина);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОтборПоУмолчанию", "Стоимости.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику)");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстВключениеНДСпоПриобретеннымЦенностям() 
	
	Текст = "
	|ВЫБРАТЬ //// Включение НДС в прочие доходы (Дт 19 :: Кт 91)
	|
	|	Операция.Ссылка КАК Ссылка,
	|	Операция.Дата КАК Период,
	|	Операция.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	-НДСПредъявленный.НДС    КАК Сумма,
	|	-НДСПредъявленный.НДСУпр КАК СуммаУУ,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НДСпоПриобретеннымЦенностям) КАК ВидСчетаДт,
	|	НДСПредъявленный.ВидДеятельностиНДС                                    КАК АналитикаУчетаДт,
	|	НДСПредъявленный.ВидЦенности                                           КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)                               КАК ВалютаДт,
	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)                 КАК ПодразделениеДт,
	|	НДСПредъявленный.НаправлениеДеятельности                               КАК НаправлениеДеятельностиДт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетДт,
	|
	|	НДСПредъявленный.Поставщик   КАК СубконтоДт1,
	|	НДСПредъявленный.Регистратор КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО                 КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Доходы) КАК ВидСчетаКт,
	|	Доходы.СтатьяДоходов                              КАК АналитикаУчетаКт,
	|	Доходы.Подразделение                              КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	Доходы.Подразделение                     КАК ПодразделениеКт,
	|	Доходы.НаправлениеДеятельности           КАК НаправлениеДеятельностиКт,
	|
	|	НЕОПРЕДЕЛЕНО КАК СчетКт,
	|
	|	Доходы.СтатьяДоходов    КАК СубконтоКт1,
	|	Доходы.АналитикаДоходов КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	ВЫБОР
	|		КОГДА СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА Доходы.СуммаРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУКт,
	|	ВЫБОР
	|		КОГДА СтатьиДоходов.ПринятиеКНалоговомуУчету
	|		ТОГДА 0
	|		ИНАЧЕ Доходы.СуммаРегл
	|	КОНЕЦ КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|
	|	""Включение НДС в стоимость"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаПриобретения КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПрочиеДоходы КАК Доходы
	|	ПО
	|		Операция.Ссылка = Доходы.Регистратор
	| 		И Доходы.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Доходы.Активность И НЕ Доходы.Сторно
	|		И Доходы.НастройкаХозяйственнойОперации = ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ВключениеНДСВСтоимость)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.НДСПредъявленный КАК НДСПредъявленный
	|	ПО
	|		НДСПредъявленный.Регистратор = Доходы.Регистратор
	|		И НДСПредъявленный.ИдентификаторФинЗаписи = Доходы.ИдентификаторФинЗаписи
	|		И НДСПредъявленный.НастройкаХозяйственнойОперации = Доходы.НастройкаХозяйственнойОперации
	|		И НЕ НДСПредъявленный.РегламентнаяОперация
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ПланВидовХарактеристик.СтатьиДоходов КАК СтатьиДоходов
	|	ПО
	|		Доходы.СтатьяДоходов = СтатьиДоходов.Ссылка
	|";
	
	Возврат Текст;
	
КонецФункции

Процедура ПроверитьЗаполнениеКоличестваПоРНПТ(Объект, Отказ)
	
	Если Не УчетПрослеживаемыхТоваровЛокализация.ИспользоватьУчетПрослеживаемыхИмпортныхТоваров(Дата(1, 1, 1)) Тогда
		Возврат;
	КонецЕсли;
	
	ВыгружаемыеКолонки = "НомерСтроки, НомерГТД, КодТНВЭД, КоличествоПоРНПТ";
	
	ТаблицаОС = Объект.Товары.Выгрузить(, ВыгружаемыеКолонки);
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ТаблицаОС.НомерСтроки		КАК НомерСтроки,
	|	ВЫРАЗИТЬ(ТаблицаОС.НомерГТД КАК Справочник.НомераГТД) КАК НомерГТД,
	|	ВЫРАЗИТЬ(ТаблицаОС.КодТНВЭД КАК Справочник.КлассификаторТНВЭД) КАК КодТНВЭД,
	|	ТаблицаОС.КоличествоПоРНПТ	КАК КоличествоПоРНПТ
	|ПОМЕСТИТЬ ТаблицаОСДляЗапроса
	|ИЗ
	|	&ТаблицаОС КАК ТаблицаОС
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаОС.НомерСтроки КАК НомерСтроки
	|ИЗ
	|	ТаблицаОСДляЗапроса КАК ТаблицаОС
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НомераГТД КАК ДанныеГТД
	|		ПО ТаблицаОС.НомерГТД = ДанныеГТД.Ссылка
	|		
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлассификаторТНВЭД КАК ДанныеТНВЭД
	|		ПО ТаблицаОС.КодТНВЭД = ДанныеТНВЭД.Ссылка
	|	
	|ГДЕ
	|	ТаблицаОС.КоличествоПоРНПТ = 0
	|	И ДанныеГТД.ТипНомераГТД В(ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТ),
	|								ЗНАЧЕНИЕ(Перечисление.ТипыНомеровГТД.НомерРНПТКомплекта))
	|	И ЕСТЬNULL(ДанныеТНВЭД.ПрослеживаемыйТовар, ЛОЖЬ)
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки";
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	
	Запрос.УстановитьПараметр("ТаблицаОС", ТаблицаОС);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Возврат;
	КонецЕсли;
	
	Выборка = РезультатЗапроса.Выбрать();
	
	ОшибкаЗаполненияКоличестваПоРНПТ = НСтр("ru = 'Не заполнена колонка ""Количество по РНПТ"" в строке %НомерСтроки% списка ""Расходы"".';
											|en = 'The ""Quantity by RNPT"" column is not filled in line %НомерСтроки% of the ""Expenses"" list.'");
	
	КлючДанных = ОбщегоНазначенияУТ.КлючДанныхДляСообщенияПользователю(Объект);
	
	Пока Выборка.Следующий() Цикл
		ТекстСообщения = СтрЗаменить(ОшибкаЗаполненияКоличестваПоРНПТ, "%НомерСтроки%", Выборка.НомерСтроки);
		
		Поле = ОбщегоНазначенияКлиентСервер.ПутьКТабличнойЧасти("Товары", Выборка.НомерСтроки, "КоличествоПоРНПТ");
		
		ОбщегоНазначения.СообщитьПользователю(ТекстСообщения, КлючДанных, Поле, "Объект", Отказ);
	КонецЦикла;
	
КонецПроцедуры

//-- НЕ УТ

//-- Локализация
#КонецОбласти

#КонецОбласти

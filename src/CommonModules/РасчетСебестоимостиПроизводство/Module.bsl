
// Вызываются процедуры и функции общих модулей:
//	- РасчетСебестоимостиПрикладныеАлгоритмы.

#Область ПрограммныйИнтерфейс

#Область Инициализация

// Перед началом расшифровки заполняет все необходимые параметры и инициализирует все структуры данных, используемые алгоритмом расчета.
//
// Параметры:
//	Дата - Дата - период документа распределения
//	МассивОрганизаций - Массив - Организации
//	Регистратор - ДокументСсылка - документ распределения расходов
//
// Возвращаемое значение:
//	Структура - параметры, используемые при расчете.
//
Функция ИнициализироватьПараметрыРасшифровкиРаспределения(Дата, МассивОрганизаций, Регистратор) Экспорт
	
	ПараметрыРасчета = Неопределено;
	ПараметрыОтладки = Неопределено;
	
	ПараметрыЗапуска = Новый Структура(
		"Дата, МассивОрганизаций, РасшифровкаРаспределения",
		Дата, МассивОрганизаций, Истина);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьПараметрыОтладки(ПараметрыОтладки, ПараметрыЗапуска);
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьПараметрыРасчетаПартий(ПараметрыЗапуска, ПараметрыРасчета, ПараметрыОтладки);
	
	ПараметрыРасчета.Вставить("Регистратор", Регистратор);
	
	Возврат ПараметрыРасчета;
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ПроцедурыЭтапов_1_2_3_4_5

// Вт Этапы, ПартииПроизводстваПоЭтапам, ПартииПроизводстваСводно, РаспределенныеОтчеты,
// втДолиПоПереработке, втПродукция, втДолиИтог, Продукция, ДолиВыпуска.
//
// Возвращаемое значение:
// 	Строка - текст запроса
Функция ТекстПартииПроизводства() Экспорт
	
	ТекстЗапроса = "
	//++ НЕ УТКА
	
	// Выбирает данные для организации указанной в реквизитах документа,
	// когда это Не внутренняя переработка
	|ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Этап,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.ПартияПроизводства КАК ПартияПроизводства,
	|	Реквизиты.ТипПроизводственногоПроцесса
	|ПОМЕСТИТЬ ЭтапыТекущегоПериода
	|ИЗ
	|	Документ.ЭтапПроизводства2_2 КАК Реквизиты
	|ГДЕ
	|	НЕ Реквизиты.ВнутренняяПереработка
	|	И Реквизиты.Организация В(&МассивОрганизаций)
	|	И НЕ Реквизиты.ПроизводствоНаСтороне
	|	И Реквизиты.Проведен
	|	И Реквизиты.ФактическоеНачалоЭтапа <= &КонецПериода
	|	И (Реквизиты.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЭтаповПроизводства2_2.Начат)
	|		ИЛИ Реквизиты.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЭтаповПроизводства2_2.Завершен)
	|			И Реквизиты.ФактическоеОкончаниеЭтапа >= &НачалоПериода)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// Выбирает данные для организации давальца, в случае если это внутренняя переработка
	|ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Этап,
	|	Реквизиты.ОрганизацияДавалец КАК Организация,
	|	Реквизиты.ПартияПроизводства КАК ПартияПроизводства,
	|	Реквизиты.ТипПроизводственногоПроцесса
	|ИЗ
	|	Документ.ЭтапПроизводства2_2 КАК Реквизиты
	|ГДЕ
	|	Реквизиты.ВнутренняяПереработка
	|	И Реквизиты.ОрганизацияДавалец В (&МассивОрганизаций)
	|	И НЕ Реквизиты.ПроизводствоНаСтороне
	|	И Реквизиты.Проведен
	|	И Реквизиты.ФактическоеНачалоЭтапа <= &КонецПериода
	|	И (Реквизиты.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЭтаповПроизводства2_2.Начат)
	|		ИЛИ Реквизиты.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЭтаповПроизводства2_2.Завершен)
	|			И Реквизиты.ФактическоеОкончаниеЭтапа >= &НачалоПериода)
	|;
	//-- НЕ УТКА
	|ВЫБРАТЬ
	|	ДД.ПартияПроизводства			КАК ПартияПроизводства,
	|	ДД.ДокументПартии				КАК ДокументПартии,
	|	ДД.НомерГруппыЗатрат			КАК НомерГруппыЗатрат,
	|	ДД.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	ДД.Этап							КАК Этап,
	|	ДД.Организация					КАК Организация,
	|	ДД.Номенклатура					КАК Номенклатура,
	|	ДД.Назначение					КАК Назначение,
	|	ДД.ВидДеятельностиНДС			КАК ВидДеятельностиНДС,
	|	ДД.НаправлениеДеятельности		КАК НаправлениеДеятельности
	|ПОМЕСТИТЬ ПартииПроизводстваПоЭтапам
	|ИЗ
	|	(
	// производство без заказа 2.2,
	//	Выбирает данные для организации указанной в реквизитах документа,
	//	когда это Не внутренняя переработка
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ															КАК АналитикаФинансовогоУчета,
	|		РеквизитыДокумента.Ссылка										КАК Этап,
	|		СпрОрганизации.Ссылка											КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура				КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение								КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС						КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))	КАК НаправлениеДеятельности
	|	ИЗ
	|		Документ.ПроизводствоБезЗаказа.ВыходныеИзделия КАК ТаблицаТоваров
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК РеквизитыДокумента
	|		ПО РеквизитыДокумента.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Организации КАК СпрОрганизации
	|		ПО РеквизитыДокумента.Организация = СпрОрганизации.Ссылка
	//++ НЕ УТКА
	|			И НЕ ТаблицаТоваров.ВнутренняяПереработка
	//-- НЕ УТКА
	|			И СпрОрганизации.Ссылка В (&МассивОрганизаций)
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|		ПО СпрПартииПроизводства.Документ = ТаблицаТоваров.Ссылка
	|		И СпрПартииПроизводства.Код = ТаблицаТоваров.НомерГруппыЗатрат
	|		И НЕ СпрПартииПроизводства.ПометкаУдаления
	|
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
	|			ПО Реестр.СторнируемыйДокумент = ТаблицаТоваров.Ссылка
	|			И Реестр.СторноИсправление
	|			И Реестр.ДатаДокументаИБ <= &КонецПериода
	|			И Реестр.Проведен
	|	ГДЕ
	|		РеквизитыДокумента.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РеквизитыДокумента.Проведен
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		И Реестр.Ссылка ЕСТЬ NULL
	|
	//++ НЕ УТКА
	|
	|ОБЪЕДИНИТЬ ВСЕ
	// производство без заказа 2.2, выбирает данные для организации давальца, в случае если это внутренняя переработка
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ															КАК АналитикаФинансовогоУчета,
	|		РеквизитыДокумента.Ссылка										КАК Этап,
	|		СпрОрганизации.Ссылка											КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура				КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение								КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС						КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))	КАК НаправлениеДеятельности
	|	ИЗ
	|		Документ.ПроизводствоБезЗаказа.ВыходныеИзделия КАК ТаблицаТоваров
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК РеквизитыДокумента
	|		ПО РеквизитыДокумента.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Организации КАК СпрОрганизации
	|		ПО ТаблицаТоваров.ВнутренняяПереработка
	|			И ТаблицаТоваров.ОрганизацияДавалец = СпрОрганизации.Ссылка
	|			И СпрОрганизации.Ссылка В(&МассивОрганизаций)
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|		ПО СпрПартииПроизводства.Документ = ТаблицаТоваров.Ссылка
	|			И СпрПартииПроизводства.Код = ТаблицаТоваров.НомерГруппыЗатрат
	|			И НЕ СпрПартииПроизводства.ПометкаУдаления
	|
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
	|			ПО Реестр.СторнируемыйДокумент = ТаблицаТоваров.Ссылка
	|			И Реестр.СторноИсправление
	|			И Реестр.ДатаДокументаИБ <= &КонецПериода
	|			И Реестр.Проведен
	|	ГДЕ
	|		РеквизитыДокумента.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РеквизитыДокумента.Проведен
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		И Реестр.Ссылка ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		АктивныеПартииБезСпецификаций.ПартияПроизводства         КАК ПартияПроизводства,
	|		РеквизитыПП.Документ                                     КАК ДокументПартии,
	|		РеквизитыПП.Код                                          КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ РеквизитыПП.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА РеквизитыПП.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ                                                    КАК АналитикаФинансовогоУчета,
	|		ЕСТЬNULL(Этапы.Этап,
	|			ЗНАЧЕНИЕ(Документ.ЭтапПроизводства2_2.ПустаяСсылка)) КАК Этап,
	|		ЕСТЬNULL(Этапы.Организация,
	|			ЗаказНаПроизводство.Организация)                     КАК Организация,
	|		РеквизитыПП.ОсновноеИзделиеНоменклатура                  КАК Номенклатура,
	|		РеквизитыПП.Назначение                                   КАК Назначение,
	|		РеквизитыПП.ВидДеятельностиНДС                           КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(РеквизитыПП.НаправлениеДеятельности,
	|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности
	|	ИЗ
	|		АктивныеПартииБезСпецификаций КАК АктивныеПартииБезСпецификаций
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаПроизводство2_2 КАК ЗаказНаПроизводство
	|			ПО АктивныеПартииБезСпецификаций.ПартияПроизводства = ЗаказНаПроизводство.ПартияПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК РеквизитыПП
	|			ПО РеквизитыПП.Ссылка = АктивныеПартииБезСпецификаций.ПартияПроизводства
	|
	|			ЛЕВОЕ СОЕДИНЕНИЕ ЭтапыТекущегоПериода КАК Этапы
	|			ПО АктивныеПартииБезСпецификаций.ПартияПроизводства = Этапы.ПартияПроизводства
	|				И Этапы.ТипПроизводственногоПроцесса = ЗНАЧЕНИЕ(Перечисление.ТипыПроизводственныхПроцессов.БезСпецификаций)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// производство по заказам 2.2
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ										КАК АналитикаФинансовогоУчета,
	|		ЭтапыТекущегоПериода.Этап					КАК Этап,
	|		ЭтапыТекущегоПериода.Организация			КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение			КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС	КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))	КАК НаправлениеДеятельности
	|	ИЗ
	|		ЭтапыТекущегоПериода КАК ЭтапыТекущегоПериода
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|		ПО СпрПартииПроизводства.Ссылка = ЭтапыТекущегоПериода.ПартияПроизводства
	|	ГДЕ
	|		НЕ ЭтапыТекущегоПериода.ТипПроизводственногоПроцесса = ЗНАЧЕНИЕ(Перечисление.ТипыПроизводственныхПроцессов.БезСпецификаций)
	//-- НЕ УТКА
	
	//++ Устарело_Переработка24
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// отчеты переработчиков без этапов
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ										КАК АналитикаФинансовогоУчета,
	|		РеквизитыОтчета.Ссылка						КАК Этап,
	|		РеквизитыОтчета.Организация					КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение			КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС	КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности
	|	ИЗ
	|		Документ.ОтчетПереработчика.Продукция КАК ТаблицаТоваров
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК РеквизитыОтчета
	|			ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|			ПО СпрПартииПроизводства.Документ = ТаблицаТоваров.Ссылка
	|				И СпрПартииПроизводства.Код = ТаблицаТоваров.НомерГруппыЗатрат
	|				И НЕ СпрПартииПроизводства.ПометкаУдаления
	|
	|	ГДЕ
	|		РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РеквизитыОтчета.Организация В(&МассивОрганизаций)
	|		И РеквизитыОтчета.Проведен
	|		И НЕ РеквизитыОтчета.ГруппировкаЗатрат = ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПоЭтапамПроизводства)
	//-- Устарело_Переработка24
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// отчеты переработчиков 2.5 без этапов
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ										КАК АналитикаФинансовогоУчета,
	|		РеквизитыОтчета.Ссылка						КАК Этап,
	|		РеквизитыОтчета.Организация					КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение			КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС	КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности
	|	ИЗ
	|		Документ.ОтчетПереработчика2_5.ВыходныеИзделия КАК ТаблицаТоваров
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5 КАК РеквизитыОтчета
	|			ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|			ПО СпрПартииПроизводства.Документ = ТаблицаТоваров.Ссылка
	|				И СпрПартииПроизводства.Код = ТаблицаТоваров.НомерГруппыЗатрат
	|				И НЕ СпрПартииПроизводства.ПометкаУдаления
	|
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
	|			ПО Реестр.СторнируемыйДокумент = ТаблицаТоваров.Ссылка
	|			И Реестр.СторноИсправление
	|			И Реестр.ДатаДокументаИБ <= &КонецПериода
	|			И Реестр.Проведен
	|
	|	ГДЕ
	|		РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РеквизитыОтчета.Организация В(&МассивОрганизаций)
	|		И РеквизитыОтчета.Проведен
	|		И НЕ РеквизитыОтчета.ГруппировкаЗатрат = ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПоЭтапамПроизводства)
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		И Реестр.Ссылка ЕСТЬ NULL
	//++ НЕ УТКА
	
	//++ Устарело_Переработка24
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// отчеты переработчиков по этапам
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ										КАК АналитикаФинансовогоУчета,
	|		РеквизитыЭтапа.Ссылка						КАК Этап,
	|		РеквизитыОтчета.Организация					КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение			КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС	КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|				ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности
	|	ИЗ
	|		Документ.ОтчетПереработчика.Продукция КАК ТаблицаТоваров
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК РеквизитыОтчета
	|			ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|			ПО РеквизитыЭтапа.Ссылка = ТаблицаТоваров.ЭтапПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|			ПО СпрПартииПроизводства.Ссылка = РеквизитыЭтапа.ПартияПроизводства
	|
	|	ГДЕ
	|		РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РеквизитыОтчета.Организация В(&МассивОрганизаций)
	|		И РеквизитыОтчета.Проведен
	|		И РеквизитыОтчета.ГруппировкаЗатрат = ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПоЭтапамПроизводства)
	//-- Устарело_Переработка24
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ										КАК АналитикаФинансовогоУчета,
	|		РеквизитыЭтапа.Ссылка						КАК Этап,
	|		РеквизитыОтчета.Организация					КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение			КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС	КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|				ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности
	|	ИЗ
	|		Документ.ОтчетПереработчика2_5.ВыходныеИзделия КАК ТаблицаТоваров
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5 КАК РеквизитыОтчета
	|			ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|			ПО РеквизитыЭтапа.Ссылка = ТаблицаТоваров.ЭтапПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|			ПО СпрПартииПроизводства.Ссылка = РеквизитыЭтапа.ПартияПроизводства
	|
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
	|			ПО Реестр.СторнируемыйДокумент = ТаблицаТоваров.Ссылка
	|			И Реестр.СторноИсправление
	|			И Реестр.ДатаДокументаИБ <= &КонецПериода
	|			И Реестр.Проведен
	|	ГДЕ
	|		РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РеквизитыОтчета.Организация В(&МассивОрганизаций)
	|		И РеквизитыОтчета.Проведен
	|		И РеквизитыОтчета.ГруппировкаЗатрат = ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПоЭтапамПроизводства)
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		И Реестр.Ссылка ЕСТЬ NULL
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	// Отчет давальцу между организациями
	|	ВЫБРАТЬ
	|		СпрПартииПроизводства.Ссылка				КАК ПартияПроизводства,
	|		СпрПартииПроизводства.Документ				КАК ДокументПартии,
	|		СпрПартииПроизводства.Код					КАК НомерГруппыЗатрат,
	|		ВЫБОР
	|			КОГДА НЕ СпрПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА СпрПартииПроизводства.ГруппаПродукции
	|			ИНАЧЕ
	|				НЕОПРЕДЕЛЕНО
	|		КОНЕЦ										КАК АналитикаФинансовогоУчета,
	|		РеквизитыДокумента.Ссылка					КАК Этап,
	|		РеквизитыДокумента.Организация				КАК Организация,
	|		СпрПартииПроизводства.ОсновноеИзделиеНоменклатура	КАК Номенклатура,
	|		СпрПартииПроизводства.Назначение					КАК Назначение,
	|		СпрПартииПроизводства.ВидДеятельностиНДС			КАК ВидДеятельностиНДС,
	|		ЕСТЬNULL(СпрПартииПроизводства.НаправлениеДеятельности,
	|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))	КАК НаправлениеДеятельности
	|	ИЗ
	|		Документ.ОтчетДавальцуМеждуОрганизациями.Товары КАК ТаблицаТоваров
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетДавальцуМеждуОрганизациями КАК РеквизитыДокумента
	|		ПО РеквизитыДокумента.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|		ПО СпрПартииПроизводства.Ссылка = ТаблицаТоваров.ПартияПроизводства
	|
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
	|			ПО Реестр.СторнируемыйДокумент = ТаблицаТоваров.Ссылка
	|			И Реестр.СторноИсправление
	|			И Реестр.ДатаДокументаИБ <= &КонецПериода
	|			И Реестр.Проведен
	|	ГДЕ
	|		РеквизитыДокумента.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РеквизитыДокумента.Организация В(&МассивОрганизаций)
	|		И РеквизитыДокумента.Проведен
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		И Реестр.Ссылка ЕСТЬ NULL
	//-- НЕ УТКА
	|	) КАК ДД
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.ПартияПроизводства,
	|	ДД.ДокументПартии,
	|	ДД.НомерГруппыЗатрат,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.Этап,
	|	ДД.Организация,
	|	ДД.Номенклатура,
	|	ДД.Назначение,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.НаправлениеДеятельности
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ПартияПроизводства
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.ПартияПроизводства			КАК ПартияПроизводства,
	|	ДД.ДокументПартии				КАК ДокументПартии,
	|	ДД.НомерГруппыЗатрат			КАК НомерГруппыЗатрат,
	|	ДД.НаправлениеДеятельности		КАК НаправлениеДеятельности,
	|	ДД.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	ДД.Организация					КАК Организация,
	|	ДД.Номенклатура					КАК Номенклатура,
	|	ДД.Назначение					КАК Назначение,
	|	ДД.ВидДеятельностиНДС			КАК ВидДеятельностиНДС
	|ПОМЕСТИТЬ ПартииПроизводстваСводно
	|ИЗ
	|	ПартииПроизводстваПоЭтапам КАК ДД
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ПартияПроизводства
	//++ Устарело_Переработка24
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	// Обслуживание переработки на стороне.
	// Отчеты переработчиков, материалы которых не подлежат распределению.
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	РеквизитыОтчета.Ссылка			КАК ОтчетПереработчика,
	|	СпрПартииПроизводства.Ссылка	КАК ПартияПроизводства
	|ПОМЕСТИТЬ РаспределенныеОтчеты
	|ИЗ
	|	Документ.ОтчетПереработчика.Продукция КАК ТаблицаТоваров
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|		ПО СпрПартииПроизводства.Документ = ТаблицаТоваров.Ссылка
	|			И СпрПартииПроизводства.Код = ТаблицаТоваров.НомерГруппыЗатрат
	|			И НЕ СпрПартииПроизводства.ПометкаУдаления
	|
	|ГДЕ
	|	РеквизитыОтчета.Проведен
	|	И РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И РеквизитыОтчета.Организация В(&МассивОрганизаций)
	|	И НЕ РеквизитыОтчета.ГруппировкаЗатрат = ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПоЭтапамПроизводства)
	//++ НЕ УТКА
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	РеквизитыОтчета.Ссылка				КАК ОтчетПереработчика,
	|	РеквизитыЭтапа.ПартияПроизводства	КАК ПартияПроизводства
	|ИЗ
	|	Документ.ОтчетПереработчика.Продукция КАК ТаблицаТоваров
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|		ПО РеквизитыЭтапа.Ссылка = ТаблицаТоваров.ЭтапПроизводства
	|
	|ГДЕ
	|	РеквизитыОтчета.Проведен
	|	И РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И РеквизитыОтчета.Организация В(&МассивОрганизаций)
	|	И РеквизитыОтчета.ГруппировкаЗатрат = ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПоЭтапамПроизводства)
	//-- НЕ УТКА
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ОтчетПереработчика,
	|	ПартияПроизводства
	//-- Устарело_Переработка24
	|;";
	
	Возврат ТекстЗапроса
	
КонецФункции

//++ НЕ УТКА

// Вт ПартииДавальческогоПроизводства
//
// Возвращаемое значение:
// 	Строка - текст запроса
Функция ТекстПартииДавальческогоПроизводства() Экспорт
	
	Возврат "
	|ВЫБРАТЬ
	|	ЗаказНаПроизводство2_2.Партнер              КАК Партнер,
	|	ЗаказНаПроизводство2_2.Договор              КАК Договор,
	|	ПартииПроизводстваСводно.ПартияПроизводства КАК ПартияПроизводства
	|ПОМЕСТИТЬ ПартииДавальческогоПроизводства
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводстваСводно
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаПроизводство2_2 КАК ЗаказНаПроизводство2_2
	|	ПО ПартииПроизводстваСводно.ДокументПартии = ЗаказНаПроизводство2_2.Ссылка
	|
	|ГДЕ
	|	ЗаказНаПроизводство2_2.ХозяйственнаяОперация В(
	//++ Устарело_Переработка24
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПроизводствоИзДавальческогоСырья),
	//-- Устарело_Переработка24
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПроизводствоИзДавальческогоСырья2_5))
	|
	|СГРУППИРОВАТЬ ПО
	|	ЗаказНаПроизводство2_2.Партнер,
	|	ЗаказНаПроизводство2_2.Договор,
	|	ПартииПроизводстваСводно.ПартияПроизводства
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Партнер,
	|	Договор
	|;";
	
КонецФункции
//-- НЕ УТКА

Функция ТекстОстаткиПартийМатериаловВНЗП() Экспорт
	
	Возврат "
	|ВЫБРАТЬ
	|	ДД.Организация						КАК Организация,
	|	ДД.АналитикаУчетаНоменклатуры		КАК АналитикаУчетаНоменклатуры,
	|	ДД.ПартияПроизводства				КАК ПартияПроизводства,
	|	ДД.ВидЗапасов						КАК ВидЗапасов,
	|	ДД.РазделУчета						КАК РазделУчета,
	|	ДД.АналитикаУчетаПартий				КАК АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета		КАК АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС				КАК ВидДеятельностиНДС,
	|	СУММА(ДД.Количество)				КАК Количество
	|ПОМЕСТИТЬ ОстаткиМатериалов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДД.Организация					КАК Организация,
	|		ДД.АналитикаУчетаНоменклатуры	КАК АналитикаУчетаНоменклатуры,
	|		ДД.Партия						КАК ПартияПроизводства,
	|		ДД.ВидЗапасов					КАК ВидЗапасов,
	|		ДД.РазделУчета					КАК РазделУчета,
	|		ДД.АналитикаУчетаПартий			КАК АналитикаУчетаПартий,
	|		ДД.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|		ДД.ВидДеятельностиНДС			КАК ВидДеятельностиНДС,
	|		ДД.КоличествоОстаток			КАК Количество
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров.Остатки(
	|			&ГраницаКонецПредыдущегоПериода,
	|			Организация В (&МассивОрганизаций)
	|			И Партия В (ВЫБРАТЬ
	|							Т.ПартияПроизводства
	|						ИЗ
	|							ПартииПроизводстваСводно КАК Т)) КАК ДД
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		ДД.Организация					КАК Организация,
	|		ДД.АналитикаУчетаНоменклатуры	КАК АналитикаУчетаНоменклатуры,
	|		ДД.Партия						КАК ПартияПроизводства,
	|		ДД.ВидЗапасов					КАК ВидЗапасов,
	|		ДД.РазделУчета					КАК РазделУчета,
	|		ДД.АналитикаУчетаПартий			КАК АналитикаУчетаПартий,
	|		ДД.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|		ДД.ВидДеятельностиНДС			КАК ВидДеятельностиНДС,
	|		ДД.Количество					КАК Количество
	|	ИЗ
	|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК Партии
	|			ПО ДД.Партия = Партии.ПартияПроизводства
	|			И ДД.Организация = Партии.Организация
	|
	//++ Устарело_Переработка24
	|			ЛЕВОЕ СОЕДИНЕНИЕ РаспределенныеОтчеты КАК РаспределенныеОтчеты
	|			ПО ДД.Регистратор = РаспределенныеОтчеты.ОтчетПереработчика
	|				И ДД.Партия = РаспределенныеОтчеты.ПартияПроизводства
	//-- Устарело_Переработка24
	|	ГДЕ
	|		ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И ДД.Организация В (&МассивОрганизаций)
	|		И ДД.СлужебноеВидДвиженияПриход
	|		И НЕ ДД.РасчетПартий
	//++ Устарело_Переработка24
			// Отчеты переработчиков 2.1 по выпускающим этапам сами списывают материалы на продукцию.
	|		И РаспределенныеОтчеты.ОтчетПереработчика ЕСТЬ NULL
	//-- Устарело_Переработка24
	
	|		И (
				// Исключаем сторно отчетов переработчика
	|			ТИПЗНАЧЕНИЯ(ДД.Регистратор) <> ТИП(Документ.Сторно)
	//++ НЕ УТКА
	|			ИЛИ ТИПЗНАЧЕНИЯ(ДД.ДокументИсточник) = ТИП(Документ.ОтчетДавальцуМеждуОрганизациями)
	//-- НЕ УТКА
	|			ИЛИ ТИПЗНАЧЕНИЯ(ДД.ДокументИсточник) = ТИП(Документ.КорректировкаПриобретения)
	|			ИЛИ ЛОЖЬ)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		ДД.Организация					КАК Организация,
	|		ДД.АналитикаУчетаНоменклатуры	КАК АналитикаУчетаНоменклатуры,
	|		ДД.Партия						КАК ПартияПроизводства,
	|		ДД.ВидЗапасов					КАК ВидЗапасов,
	|		ДД.РазделУчета					КАК РазделУчета,
	|		ДД.АналитикаУчетаПартий			КАК АналитикаУчетаПартий,
	|		ДД.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|		ДД.ВидДеятельностиНДС			КАК ВидДеятельностиНДС,
	|		ДД.Количество					КАК Количество
	|	ИЗ
	|		ВтПроизводственныеЗатратыСебестоимостьТоваров КАК ДД
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК Партии
	|			ПО ДД.Партия = Партии.ПартияПроизводства
	|			И ДД.Организация = Партии.Организация
	|
	|	ГДЕ
	|		ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И ДД.Организация В (&МассивОрганизаций)
	|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|) КАК ДД
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.Организация,
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.ПартияПроизводства,
	|	ДД.ВидЗапасов,
	|	ДД.РазделУчета,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС
	|;	
	|	
	|ВЫБРАТЬ
	|	Остатки.Организация					КАК Организация,
	|	Остатки.ПартияПроизводства			КАК ПартияПроизводства,
	|	Остатки.АналитикаУчетаНоменклатуры	КАК АналитикаУчетаНоменклатуры,
	|	ДД.Партия							КАК ПартияМатериала,
	|	ДД.АналитикаУчетаПартий				КАК АналитикаУчетаПартий,
	|	СУММА(ВЫРАЗИТЬ(ДД.Количество КАК ЧИСЛО(15,3))) КАК Количество
	|ПОМЕСТИТЬ ПартииМатериаловВНЗП
	|ИЗ
	|	ОстаткиМатериалов КАК Остатки
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
	|		ПО Остатки.ПартияПроизводства = ДД.КорПартия
	|			И Остатки.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
	|
	|ГДЕ
	|	ДД.Период <= &КонецПериода
	|	И НЕ ДД.СлужебноеВидДвиженияПриход
	|	И НЕ ДД.Партия = НЕОПРЕДЕЛЕНО
	|
	|СГРУППИРОВАТЬ ПО
	|	Остатки.Организация,
	|	Остатки.ПартияПроизводства,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	Остатки.АналитикаУчетаНоменклатуры
	|;";
	
КонецФункции

Функция ТекстПустаяТаблицаПартииМатериаловВНЗП() Экспорт
	
	Возврат "
	|ВЫБРАТЬ ПЕРВЫЕ 0
	|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК Организация,
	|	ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка) КАК ПартияПроизводства,
	|	НЕОПРЕДЕЛЕНО КАК ПартияМатериала,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
	|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(15,3)) КАК Количество
	|ПОМЕСТИТЬ ПартииМатериаловВНЗП
	|;";
	
КонецФункции

Функция ТекстДолиСтоимостиПоПродукции() Экспорт
	
	//++ НЕ УТКА

	// доли по переработке и фактическое количество продукции
	#Область ТекствтДолиПоПереработке
	ТекствтДолиПоПереработке = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.ПартияПроизводства		КАК ПартияПроизводства,
	|	ДД.Номенклатура				КАК Номенклатура,
	|	ДД.Характеристика			КАК Характеристика,
	|	ДД.КодСтроки				КАК КодСтроки,
	|	СУММА(ДД.КоличествоПлан)	КАК КоличествоПлан,
	|	СУММА(ДД.КоличествоФакт)	КАК КоличествоФакт,
	|	СУММА(ДД.ДоляСтоимостиПлан)	КАК ДоляСтоимостиПлан
	|ПОМЕСТИТЬ втДолиПоПереработке
	|ИЗ
	|	(
	|	ВЫБРАТЬ
	|		РеквизитыЭтапа.ПартияПроизводства	КАК ПартияПроизводства,
	|		ТаблицаТоваров.Номенклатура			КАК Номенклатура,
	|		ТаблицаТоваров.Характеристика		КАК Характеристика,
	|		ТаблицаТоваров.КодСтроки			КАК КодСтроки,
	|		ТаблицаТоваров.Количество			КАК КоличествоПлан,
	|		0									КАК КоличествоФакт,
	|		ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ								КАК ДоляСтоимостиПлан
	|	ИЗ
	|		ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|			ПО ПартииПроизводства.ПартияПроизводства = РеквизитыЭтапа.ПартияПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВыходныеИзделия КАК ТаблицаТоваров
	|			ПО ТаблицаТоваров.Ссылка = РеквизитыЭтапа.Ссылка
	|
	|	ГДЕ
	|		РеквизитыЭтапа.ПроизводствоНаСтороне
	|		И РеквизитыЭтапа.Проведен
	|		И НЕ ТаблицаТоваров.Отменено
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// ВнутренняяПереработка
	|ВЫБРАТЬ
	|		РеквизитыЭтапа.ПартияПроизводства	КАК ПартияПроизводства,
	|		ТаблицаТоваров.Номенклатура			КАК Номенклатура,
	|		ТаблицаТоваров.Характеристика		КАК Характеристика,
	|		ТаблицаТоваров.КодСтроки			КАК КодСтроки,
	|		ТаблицаТоваров.Количество			КАК КоличествоПлан,
	|		0									КАК КоличествоФакт,
	|		ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ								КАК ДоляСтоимостиПлан
	|	ИЗ
	|		ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|			ПО ПартииПроизводства.ПартияПроизводства = РеквизитыЭтапа.ПартияПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВыходныеИзделия КАК ТаблицаТоваров
	|			ПО ТаблицаТоваров.Ссылка = РеквизитыЭтапа.Ссылка
	|
	|	ГДЕ
	|		РеквизитыЭтапа.ВнутренняяПереработка
	|		И РеквизитыЭтапа.Проведен
	|		И НЕ ТаблицаТоваров.Отменено
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|		ПартииПроизводства.ПартияПроизводства	КАК ПартияПроизводства,
	|		ТаблицаТоваров.Номенклатура				КАК Номенклатура,
	|		ТаблицаТоваров.Характеристика			КАК Характеристика,
	|		ТаблицаТоваров.КодСтроки				КАК КодСтроки,
	|		ТаблицаТоваров.Количество				КАК КоличествоПлан,
	|		0										КАК КоличествоФакт,
	|		ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ								КАК ДоляСтоимостиПлан
	|	ИЗ
	|		ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК РеквизитыПроизводствоБезЗаказа
	|			ПО ПартииПроизводства.ПартияПроизводства = РеквизитыПроизводствоБезЗаказа.Ссылка
	|				И РеквизитыПроизводствоБезЗаказа.Проведен
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа.ВыходныеИзделия КАК ТаблицаТоваров
	|			ПО ТаблицаТоваров.Ссылка = РеквизитыПроизводствоБезЗаказа.Ссылка
	|				И ПартииПроизводства.НомерГруппыЗатрат = ТаблицаТоваров.НомерГруппыЗатрат
	|				И ТаблицаТоваров.ВнутренняяПереработка
	|		
	|	
	//++ Устарело_Переработка24
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		РеквизитыЭтапа.ПартияПроизводства	КАК ПартияПроизводства,
	|		ТаблицаТоваров.Номенклатура			КАК Номенклатура,
	|		ТаблицаТоваров.Характеристика		КАК Характеристика,
	|		ТаблицаТоваров.КодСтроки			КАК КодСтроки,
	|		0									КАК КоличествоПлан,
	|		ТаблицаТоваров.Количество			КАК КоличествоФакт,
	|		0									КАК ДоляСтоимостиПлан
	|	ИЗ
	|		Документ.ОтчетПереработчика.Продукция КАК ТаблицаТоваров
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|			ПО РеквизитыЭтапа.Ссылка = ТаблицаТоваров.ЭтапПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК ПартииПроизводства
	|			ПО РеквизитыЭтапа.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|
	|	ГДЕ
	|		ТаблицаТоваров.Ссылка.Проведен
	|		И ТаблицаТоваров.Ссылка.Дата <= &КонецПериода
	//-- Устарело_Переработка24
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		РеквизитыЭтапа.ПартияПроизводства	КАК ПартияПроизводства,
	|		ТаблицаТоваров.Номенклатура			КАК Номенклатура,
	|		ТаблицаТоваров.Характеристика		КАК Характеристика,
	|		ТаблицаТоваров.КодСтроки			КАК КодСтроки,
	|		0									КАК КоличествоПлан,
	|		ТаблицаТоваров.Количество			КАК КоличествоФакт,
	|		0									КАК ДоляСтоимостиПлан
	|	ИЗ
	|		Документ.ОтчетПереработчика2_5.ВыходныеИзделия КАК ТаблицаТоваров
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|			ПО РеквизитыЭтапа.Ссылка = ТаблицаТоваров.ЭтапПроизводства
	|
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК ПартииПроизводства
	|			ПО РеквизитыЭтапа.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|
	|	ГДЕ
	|		ТаблицаТоваров.Ссылка.Проведен
	|		И ТаблицаТоваров.Ссылка.Дата <= &КонецПериода
	|	) КАК ДД
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.ПартияПроизводства,
	|	ДД.Номенклатура,
	|	ДД.Характеристика,
	|	ДД.КодСтроки
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДД.ПартияПроизводства,
	|	ДД.Номенклатура,
	|	ДД.Характеристика,
	|	ДД.КодСтроки";
	#КонецОбласти
	
	//-- НЕ УТКА

	// план и факт по производству без заказов - товары
	#Область ТекствтПродукция_ОписаниеДанных
	ТекствтПродукция_ОписаниеДанных = "
	|ВЫБРАТЬ ПЕРВЫЕ 0
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)
	|													КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|													КАК РазделУчета,
	|	ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|													КАК ПартияПроизводства,
	|	НЕОПРЕДЕЛЕНО									КАК ПартияВыпуска,
	|	ДАТАВРЕМЯ(1,1,1)								КАК ДатаПроизводства,
	|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
	|													КАК АналитикаУчетаПартий,
	|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|													КАК АналитикаФинансовогоУчета,
	|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|													КАК Организация,
	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|													КАК Подразделение,
	|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|													КАК ВидДеятельностиНДС,
	|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	|													КАК Номенклатура,
	|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
	|													КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
	|													КАК Серия,
	|	ЗНАЧЕНИЕ(Справочник.РесурсныеСпецификации.ПустаяСсылка)
	|													КАК Спецификация,
	|	ВЫРАЗИТЬ("""" КАК СТРОКА(36))						КАК ИдентификаторСтроки,
	|	ВЫРАЗИТЬ("""" КАК СТРОКА(36))						КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|													КАК ВидЗапасов,
	|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|													КАК АналитикаУчетаНоменклатуры,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|													КАК СтатьяРасходовСписания,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
	|													КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(15, 3))					КАК Факт,
	|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(15, 3))					КАК План,
	|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(15, 3))					КАК КоличествоПродукции,
	|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(23, 10))					КАК ДоляСтоимостиФакт,
	|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(23, 10))					КАК ДоляСтоимости,
	|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(23, 10))					КАК ПолнаяДоляСтоимости
	|ПОМЕСТИТЬ втПродукция";
	#КонецОбласти
	
	// план и факт по производству без заказов - товары
	#Область ТекствтПродукция_ПБЗ_Товары
	ТекствтПродукция_ПБЗ_Товары = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ВЫБОР
	|		КОГДА СпрВидыЗапасов.ТипЗапасов ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|			ИЛИ СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|	КОНЕЦ											КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыДокумента.Ссылка						КАК ПартияВыпуска,
	|	РеквизитыДокумента.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация					КАК Организация,
	|	РеквизитыДокумента.Подразделение				КАК Подразделение,
	|	РеквизитыДокумента.ВыпускПодДеятельность		КАК ВидДеятельностиНДС,
	|	АналитикаПоПолучателю.Номенклатура				КАК Номенклатура,
	|	АналитикаПоПолучателю.Характеристика			КАК Характеристика,
	|	АналитикаПоПолучателю.Серия						КАК Серия,
	|	ТаблицаТовары.Спецификация						КАК Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторФинЗаписи			КАК ИдентификаторФинЗаписи,
	|	СпрВидыЗапасов.Ссылка							КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			И НЕ СпрСклады.ЦеховаяКладовая
	|			ТОГДА АналитикаПоПодразделению.КлючАналитики
	|		КОГДА НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
	|			И НЕ СпрСклады.ЦеховаяКладовая
	|			ТОГДА АналитикаПоПодразделениюБезНазначения.КлючАналитики
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ АналитикаПоПолучателюБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ТаблицаТовары.Получатель) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ТаблицаТовары.Получатель
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ											КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ТаблицаТовары.Получатель) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ТаблицаТовары.Получатель
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ											КАК СтатьяАктивовПассивов,
	|	ТаблицаТовары.АналитикаРасходов					КАК АналитикаРасходов,
	|	ТаблицаТовары.АналитикаАктивовПассивов			КАК АналитикаАктивовПассивов,
	|	СУММА(ТаблицаТовары.Количество)					КАК Факт,
	|	СУММА(ТаблицаТовары.Количество)					КАК План,
	|	СУММА(ТаблицаТовары.Количество)					КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество - ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|				- ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|					* ТаблицаТовары.ДоляСтоимости
	|					/ ТаблицаТовары.Количество
	|		КОНЕЦ КАК ЧИСЛО(23, 10)))					КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|		КОНЕЦ)										КАК ПолнаяДоляСтоимости
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа.ВидыЗапасовВыходныеИзделия КАК ТаблицаТовары
	|		ПО ТаблицаТовары.Ссылка = ПартииПроизводства.ДокументПартии
	|			И ТаблицаТовары.НомерГруппыЗатрат = ПартииПроизводства.НомерГруппыЗатрат
	|		
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ТаблицаТовары.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|		И ПартииПроизводства.Организация = СпрВидыЗапасов.Организация
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК РеквизитыДокумента
	|		ПО РеквизитыДокумента.Ссылка = ТаблицаТовары.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаПоПолучателю
	|		ПО АналитикаПоПолучателю.Ссылка = ТаблицаТовары.АналитикаУчетаНоменклатуры
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
	|		ПО СпрСклады.Ссылка = АналитикаПоПолучателю.МестоХранения
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаПоПолучателюБезНазначения
	|		ПО АналитикаПоПолучателюБезНазначения.Номенклатура = АналитикаПоПолучателю.Номенклатура
	|			И АналитикаПоПолучателюБезНазначения.Характеристика = АналитикаПоПолучателю.Характеристика
	|			И АналитикаПоПолучателюБезНазначения.Серия = АналитикаПоПолучателю.Серия
	|			И АналитикаПоПолучателюБезНазначения.МестоХранения = АналитикаПоПолучателю.МестоХранения
	|			И АналитикаПоПолучателюБезНазначения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|			И АналитикаПоПолучателюБезНазначения.СтатьяКалькуляции = АналитикаПоПолучателю.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаПоПодразделению
	|		ПО АналитикаПоПолучателю.Номенклатура = АналитикаПоПодразделению.Номенклатура
	|			И АналитикаПоПолучателю.Характеристика = АналитикаПоПодразделению.Характеристика
	|			И АналитикаПоПолучателю.Серия = АналитикаПоПодразделению.Серия
	|			И РеквизитыДокумента.Подразделение = АналитикаПоПодразделению.МестоХранения
	|			И АналитикаПоПолучателю.Назначение = АналитикаПоПодразделению.Назначение
	|			И АналитикаПоПолучателю.СтатьяКалькуляции = АналитикаПоПодразделению.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаПоПодразделениюБезНазначения
	|		ПО АналитикаПоПодразделению.Номенклатура = АналитикаПоПодразделениюБезНазначения.Номенклатура
	|			И АналитикаПоПодразделению.Характеристика = АналитикаПоПодразделениюБезНазначения.Характеристика
	|			И АналитикаПоПодразделению.Серия = АналитикаПоПодразделениюБезНазначения.Серия
	|			И АналитикаПоПодразделению.МестоХранения = АналитикаПоПодразделениюБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаПоПодразделениюБезНазначения.Назначение
	|			И АналитикаПоПодразделению.СтатьяКалькуляции = АналитикаПоПодразделениюБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Контрагент				= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартий.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.НалогообложениеНДС 		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТовары.КодСтроки
	|			И РеквизитыДокумента.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииМатериаловВНЗП КАК ПартииМатериаловВНЗП
	|		ПО ПартииМатериаловВНЗП.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ПартииМатериаловВНЗП.ПартияМатериала = ПартииПроизводства.ДокументПартии
	|			И ПартииМатериаловВНЗП.АналитикаУчетаПартий = АналитикиУчетаПартий.КлючАналитики
	|			И ПартииМатериаловВНЗП.Организация = СпрВидыЗапасов.Организация
	|
	|ГДЕ
	|	РеквизитыДокумента.Проведен
	|	И НЕ АналитикаПоПолучателю.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|
	|СГРУППИРОВАТЬ ПО
	|	СпрВидыЗапасов.Ссылка,
	|	СпрВидыЗапасов.ТипЗапасов,
	|	ВЫБОР
	|		КОГДА СпрВидыЗапасов.ТипЗапасов ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|			ИЛИ СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|	КОНЕЦ,
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыДокумента.Ссылка,
	|	РеквизитыДокумента.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация,
	|	РеквизитыДокумента.Подразделение,
	|	РеквизитыДокумента.ВыпускПодДеятельность,
	|	АналитикаПоПолучателю.Номенклатура,
	|	АналитикаПоПолучателю.Характеристика,
	|	АналитикаПоПолучателю.Серия,
	|	ТаблицаТовары.Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторФинЗаписи,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			И НЕ СпрСклады.ЦеховаяКладовая
	|			ТОГДА АналитикаПоПодразделению.КлючАналитики
	|		КОГДА НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
	|			И НЕ СпрСклады.ЦеховаяКладовая
	|			ТОГДА АналитикаПоПодразделениюБезНазначения.КлючАналитики
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ АналитикаПоПолучателюБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТовары.Получатель,
	|	ТаблицаТовары.АналитикаРасходов,
	|	ТаблицаТовары.АналитикаАктивовПассивов";
	#КонецОбласти
	
	// план и факт по производству без заказов - работы
	#Область ТекствтПродукция_ПБЗ_Работы
	ТекствтПродукция_ПБЗ_Работы = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)					КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)	КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыДокумента.Ссылка						КАК ПартияВыпуска,
	|	РеквизитыДокумента.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация					КАК Организация,
	|	РеквизитыДокумента.Подразделение				КАК Подразделение,
	|	РеквизитыДокумента.ВыпускПодДеятельность		КАК ВидДеятельностиНДС,
	|	АналитикаПоПолучателю.Номенклатура				КАК Номенклатура,
	|	АналитикаПоПолучателю.Характеристика			КАК Характеристика,
	|	АналитикаПоПолучателю.Серия						КАК Серия,
	|	ТаблицаТовары.Спецификация						КАК Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)	КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаПоПолучателюБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ТаблицаТовары.Получатель) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ТаблицаТовары.Получатель
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ											КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ТаблицаТовары.Получатель) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ТаблицаТовары.Получатель
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ											КАК СтатьяАктивовПассивов,
	|	ТаблицаТовары.АналитикаРасходов					КАК АналитикаРасходов,
	|	ТаблицаТовары.АналитикаАктивовПассивов			КАК АналитикаАктивовПассивов,
	|	СУММА(ТаблицаТовары.Количество)					КАК Факт,
	|	СУММА(ТаблицаТовары.Количество)					КАК План,
	|	СУММА(ТаблицаТовары.Количество)					КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество - ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|					- ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|						* ТаблицаТовары.ДоляСтоимости
	|						/ ТаблицаТовары.Количество
	|		КОНЕЦ КАК ЧИСЛО(23, 10)))					КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|		КОНЕЦ)										КАК ПолнаяДоляСтоимости
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК РеквизитыДокумента
	|		ПО РеквизитыДокумента.Ссылка = ПартииПроизводства.ДокументПартии
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа.ВыходныеИзделия КАК ТаблицаТовары
	|		ПО ТаблицаТовары.Ссылка = ПартииПроизводства.ДокументПартии
	|			И ТаблицаТовары.НомерГруппыЗатрат = ПартииПроизводства.НомерГруппыЗатрат
	|			И ВЫБОР
	//++ НЕ УТКА
	|				КОГДА ТаблицаТовары.ВнутренняяПереработка
	|					ТОГДА ТаблицаТовары.ОрганизацияДавалец = ПартииПроизводства.Организация
	//-- НЕ УТКА
	|				КОГДА ИСТИНА
	|					ТОГДА РеквизитыДокумента.Организация = ПартииПроизводства.Организация
	|			КОНЕЦ
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаПоПолучателю
	|		ПО АналитикаПоПолучателю.Ссылка = ТаблицаТовары.АналитикаУчетаНоменклатуры
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаПоПолучателюБезНазначения
	|		ПО АналитикаПоПолучателюБезНазначения.Номенклатура = АналитикаПоПолучателю.Номенклатура
	|			И АналитикаПоПолучателюБезНазначения.Характеристика = АналитикаПоПолучателю.Характеристика
	|			И АналитикаПоПолучателюБезНазначения.Серия = АналитикаПоПолучателю.Серия
	|			И АналитикаПоПолучателюБезНазначения.МестоХранения = АналитикаПоПолучателю.МестоХранения
	|			И АналитикаПоПолучателюБезНазначения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|			И АналитикаПоПолучателюБезНазначения.СтатьяКалькуляции = АналитикаПоПолучателю.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
	|		ПО СпрНоменклатура.Ссылка = ТаблицаТовары.Номенклатура
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Контрагент				= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартий.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.НалогообложениеНДС 		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПрочиеРаботыИУслуги)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТовары.КодСтроки
	|			И РеквизитыДокумента.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииМатериаловВНЗП КАК ПартииМатериаловВНЗП
	|		ПО ПартииМатериаловВНЗП.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ПартииМатериаловВНЗП.ПартияМатериала = ПартииПроизводства.ДокументПартии
	|			И ПартииМатериаловВНЗП.АналитикаУчетаПартий = АналитикиУчетаПартий.КлючАналитики
	|			И ПартииМатериаловВНЗП.Организация = РеквизитыДокумента.Организация
	|
	|ГДЕ
	|	СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|	И РеквизитыДокумента.Проведен
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыДокумента.Ссылка,
	|	РеквизитыДокумента.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация,
	|	РеквизитыДокумента.Подразделение,
	|	РеквизитыДокумента.ВыпускПодДеятельность,
	|	АналитикаПоПолучателю.Номенклатура,
	|	АналитикаПоПолучателю.Характеристика,
	|	АналитикаПоПолучателю.Серия,
	|	ТаблицаТовары.Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаПоПолучателюБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТовары.Получатель,
	|	ТаблицаТовары.АналитикаРасходов,
	|	ТаблицаТовары.АналитикаАктивовПассивов";
	#КонецОбласти
	
	//++ НЕ УТКА
	
	// план и факт по этапам (выпущенные товары)
	#Область ТекствтПродукция_Этапы_Товары
	ТекствтПродукция_Этапы_Товары = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)		КАК ХозяйственнаяОперация,
	|	ВЫБОР
	|		КОГДА СпрВидыЗапасов.ТипЗапасов ЕСТЬ NULL 
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		ИНАЧЕ
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|	КОНЕЦ																КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства								КАК ПартияПроизводства,
	|	РеквизитыЭтапа.Ссылка												КАК ПартияВыпуска,
	|	ВидыЗапасов.ДатаОперации											КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартийТоваров.КлючАналитики,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))	КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета						КАК АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация										КАК Организация,
	|	ВидыЗапасов.Подразделение											КАК Подразделение,
	|	РеквизитыЭтапа.ВыпускПодДеятельность								КАК ВидДеятельностиНДС,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура					КАК Номенклатура,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Характеристика				КАК Характеристика,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Серия						КАК Серия,
	|	РеквизитыЭтапа.Спецификация											КАК Спецификация,
	|	ВидыЗапасов.ИдентификаторСтроки										КАК ИдентификаторСтроки,
	|	ВидыЗапасов.ИдентификаторФинЗаписи									КАК ИдентификаторФинЗаписи,
	|	СпрВидыЗапасов.Ссылка												КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ВидыЗапасов.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ																КАК АналитикаУчетаНоменклатуры,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ВидыЗапасов.СтатьяРасходов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ВидыЗапасов.СтатьяРасходов
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ВидыЗапасов.СтатьяРасходов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ВидыЗапасов.СтатьяРасходов
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																КАК СтатьяАктивовПассивов,
	|	ВидыЗапасов.АналитикаРасходов										КАК АналитикаРасходов,
	|	ВидыЗапасов.АналитикаАктивовПассивов								КАК АналитикаАктивовПассивов,
	|	СУММА(ВЫБОР
	|			КОГДА ВидыЗапасов.ДатаОперации <= &КонецПериода
	|				ТОГДА ВидыЗапасов.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)															КАК Факт,
	|	СУММА(ВидыЗапасов.Количество)										КАК План,
	|	СУММА(ВЫБОР
	|			КОГДА ВидыЗапасов.ДатаОперации МЕЖДУ &НачалоПериода И &КонецПериода
	|				ТОГДА ВидыЗапасов.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)															КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА ВидыЗапасов.ДатаОперации <= &КонецПериода
	|				ТОГДА ВЫБОР
	|						КОГДА ВидыЗапасов.ДоляСтоимости = 0
	|							ТОГДА ВидыЗапасов.Количество
	|						ИНАЧЕ ВидыЗапасов.ДоляСтоимости
	|					КОНЕЦ
	|			ИНАЧЕ 0
	|		КОНЕЦ)															КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ВидыЗапасов.ДоляСтоимости = 0
	|				ТОГДА ВидыЗапасов.Количество - ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|			ИНАЧЕ ВидыЗапасов.ДоляСтоимости
	|					- ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|						* ВидыЗапасов.ДоляСтоимости
	|						/ ВидыЗапасов.Количество
	|		КОНЕЦ КАК ЧИСЛО(23, 10)))										КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ВидыЗапасов.ДоляСтоимости = 0
	|				ТОГДА ВидыЗапасов.Количество
	|			ИНАЧЕ ВидыЗапасов.ДоляСтоимости
	|		КОНЕЦ)															КАК ПолнаяДоляСтоимости
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|		ПО РеквизитыЭтапа.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВидыЗапасовИзделия КАК ВидыЗапасов
	|		ПО ВидыЗапасов.Ссылка = РеквизитыЭтапа.Ссылка
	|			И ВидыЗапасов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
	|		ПО ВидыЗапасов.ВидЗапасов = СпрВидыЗапасов.Ссылка
	|			И СпрВидыЗапасов.Организация = ПартииПроизводства.Организация
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО Аналитика.Ссылка = ВидыЗапасов.АналитикаУчетаНоменклатуры
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартийТоваров
	|		ПО АналитикиУчетаПартийТоваров.ГруппаФинансовогоУчета = ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.Контрагент			= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартийТоваров.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.НалогообложениеНДС	= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.ВидЦенности			= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартийТоваров.КодСтроки				= ВидыЗапасов.КодСтроки
	|			И РеквизитыЭтапа.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииМатериаловВНЗП КАК ПартииМатериаловВНЗП
	|		ПО ПартииМатериаловВНЗП.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ПартииМатериаловВНЗП.ПартияМатериала = РеквизитыЭтапа.Ссылка
	|			И ПартииМатериаловВНЗП.АналитикаУчетаПартий = АналитикиУчетаПартийТоваров.КлючАналитики
	|			И ПартииМатериаловВНЗП.Организация = СпрВидыЗапасов.Организация
	|
	|ГДЕ
	|	НЕ РеквизитыЭтапа.ПроизводствоНаСтороне
	|	И РеквизитыЭтапа.Проведен
	|	И ВидыЗапасов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|	И НЕ ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|
	|СГРУППИРОВАТЬ ПО
	|	СпрВидыЗапасов.Ссылка,
	|	СпрВидыЗапасов.ТипЗапасов,
	|	ВЫБОР
	|		КОГДА СпрВидыЗапасов.ТипЗапасов ЕСТЬ NULL 
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|		КОГДА СпрВидыЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		ИНАЧЕ
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|	КОНЕЦ,
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыЭтапа.Ссылка,
	|	ВидыЗапасов.ДатаОперации,
	|	ЕСТЬNULL(АналитикиУчетаПартийТоваров.КлючАналитики,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация,
	|	ВидыЗапасов.Подразделение,
	|	РеквизитыЭтапа.ВыпускПодДеятельность,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Номенклатура,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Характеристика,
	|	ВидыЗапасов.АналитикаУчетаНоменклатуры.Серия,
	|	РеквизитыЭтапа.Спецификация,
	|	ВидыЗапасов.ИдентификаторСтроки,
	|	ВидыЗапасов.ИдентификаторФинЗаписи,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ВидыЗапасов.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ВидыЗапасов.СтатьяРасходов,
	|	ВидыЗапасов.АналитикаРасходов,
	|	ВидыЗапасов.АналитикаАктивовПассивов";
	#КонецОбласти
	
	// план и факт по этапам (не выпущенные товары, работы)
	#Область ТекствтПродукция_Этапы_Работы
	ТекствтПродукция_Этапы_Работы = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)	КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства							КАК ПартияПроизводства,
	|	РеквизитыЭтапа.Ссылка											КАК ПартияВыпуска,
	|	ТаблицаТовары.ДатаПроизводства									КАК ДатаПроизводства,
	|	ВЫБОР
	|		КОГДА ТаблицаТовары.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЕСТЬNULL(АналитикиУчетаПартийРабот.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(АналитикиУчетаПартийТоваров.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
	|	КОНЕЦ															КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета					КАК АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация									КАК Организация,
	|	ТаблицаТовары.Подразделение										КАК Подразделение,
	|	РеквизитыЭтапа.ВыпускПодДеятельность							КАК ВидДеятельностиНДС,
	|	ТаблицаТовары.Номенклатура										КАК Номенклатура,
	|	ТаблицаТовары.Характеристика									КАК Характеристика,
	|	ТаблицаТовары.Серия												КАК Серия,
	|	РеквизитыЭтапа.Спецификация										КАК Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки								КАК ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторСтроки								КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)					КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ															КАК АналитикаУчетаНоменклатуры,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ТаблицаТовары.СтатьяРасходов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ТаблицаТовары.СтатьяРасходов
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ															КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ТаблицаТовары.СтатьяРасходов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ТаблицаТовары.СтатьяРасходов
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ															КАК СтатьяАктивовПассивов,
	|	ТаблицаТовары.АналитикаРасходов									КАК АналитикаРасходов,
	|	ТаблицаТовары.АналитикаАктивовПассивов							КАК АналитикаАктивовПассивов,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.Произведено
	|				И ТаблицаТовары.ДатаПроизводства <= &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)														КАК Факт,
	|	СУММА(ТаблицаТовары.Количество)									КАК План,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.Произведено
	|				И ТаблицаТовары.ДатаПроизводства МЕЖДУ &НачалоПериода И &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)														КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.Произведено
	|				И ТаблицаТовары.ДатаПроизводства <= &КонецПериода
	|				ТОГДА ВЫБОР
	|						КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|							ТОГДА ТаблицаТовары.Количество
	|						ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|					КОНЕЦ
	|			ИНАЧЕ 0
	|		КОНЕЦ)														КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество - ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|					- ЕСТЬNULL(ПартииМатериаловВНЗП.Количество, 0)
	|						* ТаблицаТовары.ДоляСтоимости
	|						/ ТаблицаТовары.Количество
	|		КОНЕЦ КАК ЧИСЛО(23, 10)))									КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|		КОНЕЦ)														КАК ПолнаяДоляСтоимости
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|		ПО РеквизитыЭтапа.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ВЫБОР
	|					КОГДА РеквизитыЭтапа.ВнутренняяПереработка
	|						ТОГДА РеквизитыЭтапа.ОрганизацияДавалец
	|					ИНАЧЕ РеквизитыЭтапа.Организация
	|				КОНЕЦ = ПартииПроизводства.Организация
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВыходныеИзделия КАК ТаблицаТовары
	|		ПО ТаблицаТовары.Ссылка = РеквизитыЭтапа.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО Аналитика.Ссылка = ТаблицаТовары.АналитикаУчетаНоменклатуры
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартийТоваров
	|		ПО АналитикиУчетаПартийТоваров.ГруппаФинансовогоУчета = ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.Контрагент			= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартийТоваров.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.НалогообложениеНДС 	= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартийТоваров.ВидЦенности			= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартийТоваров.КодСтроки				= ТаблицаТовары.КодСтроки
	|			И РеквизитыЭтапа.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартийРабот
	|		ПО АналитикиУчетаПартийРабот.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартийРабот.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартийРабот.Контрагент				= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартийРабот.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартийРабот.НалогообложениеНДС		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартийРабот.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПрочиеРаботыИУслуги)
	|			И АналитикиУчетаПартийРабот.КодСтроки				= ТаблицаТовары.КодСтроки
	|			И РеквизитыЭтапа.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииМатериаловВНЗП КАК ПартииМатериаловВНЗП
	|		ПО ПартииМатериаловВНЗП.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ПартииМатериаловВНЗП.ПартияМатериала = РеквизитыЭтапа.Ссылка
	|			И (ПартииМатериаловВНЗП.АналитикаУчетаПартий = АналитикиУчетаПартийТоваров.КлючАналитики
	|				ИЛИ ПартииМатериаловВНЗП.АналитикаУчетаПартий = АналитикиУчетаПартийРабот.КлючАналитики)
	|			И ПартииМатериаловВНЗП.Организация = РеквизитыЭтапа.Организация
	|
	|ГДЕ
	|	НЕ РеквизитыЭтапа.ПроизводствоНаСтороне
	|	И РеквизитыЭтапа.Проведен
	|	И НЕ ТаблицаТовары.Отменено
	|	И (ТаблицаТовары.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		ИЛИ НЕ ТаблицаТовары.Произведено)
	|
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыЭтапа.Ссылка,
	|	ТаблицаТовары.ДатаПроизводства,
	|	ВЫБОР
	|		КОГДА ТаблицаТовары.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЕСТЬNULL(АналитикиУчетаПартийРабот.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
	|		ИНАЧЕ ЕСТЬNULL(АналитикиУчетаПартийТоваров.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
	|	КОНЕЦ,
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	ПартииПроизводства.Организация,
	|	ТаблицаТовары.Подразделение,
	|	РеквизитыЭтапа.ВыпускПодДеятельность,
	|	ТаблицаТовары.Номенклатура,
	|	ТаблицаТовары.Характеристика,
	|	ТаблицаТовары.Серия,
	|	РеквизитыЭтапа.Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТовары.СтатьяРасходов,
	|	ТаблицаТовары.АналитикаРасходов,
	|	ТаблицаТовары.АналитикаАктивовПассивов";
	#КонецОбласти

	//++ Устарело_Переработка24

	// план и факт по отчетам переработчиков по этапам
	#Область ТекствтПродукция_ОтчетыПереработчиковПоЭтапам
	ТекствтПродукция_ОтчетыПереработчиковПоЭтапам = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка							КАК ПартияВыпуска,
	|	РеквизитыОтчета.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация						КАК Организация,
	|	РеквизитыОтчета.Подразделение					КАК Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность			КАК ВидДеятельностиНДС,
	|	ТаблицаТовары.Номенклатура						КАК Номенклатура,
	|	ТаблицаТовары.Характеристика					КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
	|	РеквизитыЭтапа.Спецификация						КАК Спецификация,
	|	""""											КАК ИдентификаторСтроки,
	|	""""											КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)	КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК Факт,
	|	МАКСИМУМ(ДолиПоПереработке.КоличествоПлан) КАК План,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ВЫБОР
	|						КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|							ТОГДА ТаблицаТовары.Количество
	|						ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|					КОНЕЦ
	|			ИНАЧЕ 0
	|	КОНЕЦ)											КАК ДоляСтоимостиФакт,
	|	МАКСИМУМ(ДолиПоПереработке.ДоляСтоимостиПлан)	КАК ДоляСтоимости,
	|	МАКСИМУМ(ДолиПоПереработке.ДоляСтоимостиПлан)	КАК ПолнаяДоляСтоимости
	|ИЗ
	|	Документ.ОтчетПереработчика.Продукция КАК ТаблицаТовары
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|		ПО РеквизитыЭтапа.Ссылка = ТаблицаТовары.ЭтапПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК ПартииПроизводства
	|		ПО ПартииПроизводства.ПартияПроизводства = РеквизитыЭтапа.ПартияПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТовары.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втДолиПоПереработке КАК ДолиПоПереработке
	|		ПО ДолиПоПереработке.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ДолиПоПереработке.Номенклатура = ТаблицаТовары.Номенклатура
	|			И ДолиПоПереработке.Характеристика = ТаблицаТовары.Характеристика
	|			И ДолиПоПереработке.КодСтроки = ТаблицаТовары.КодСтроки
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО ТаблицаТовары.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= РеквизитыОтчета.Партнер
	|			И АналитикиУчетаПартий.Контрагент				= РеквизитыОтчета.Контрагент
	|			И АналитикиУчетаПартий.СтавкаНДС				= РеквизитыОтчета.СтавкаНДС
	|			И АналитикиУчетаПартий.НалогообложениеНДС		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) // при ПУ 2.2 НалогообложениеНДС не заполняется
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТовары.КодСтрокиПродукция
	|			И РеквизитыОтчета.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|ГДЕ
	|	РеквизитыОтчета.Проведен
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка,
	|	РеквизитыОтчета.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация,
	|	РеквизитыОтчета.Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность,
	|	ТаблицаТовары.Номенклатура,
	|	ТаблицаТовары.Характеристика,
	|	РеквизитыЭтапа.Спецификация,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ";
	#КонецОбласти

	//-- Устарело_Переработка24
	
	// план и факт по отчетам переработчиков 2.5 по этапам (работы)
	#Область ТекствтПродукция_ОтчетыПереработчиков25ПоЭтапам_Работы
	ТекствтПродукция_ОтчетыПереработчиков25ПоЭтапам_Работы = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка							КАК ПартияВыпуска,
	|	РеквизитыОтчета.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация						КАК Организация,
	|	РеквизитыОтчета.Подразделение					КАК Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность			КАК ВидДеятельностиНДС,
	|	ТаблицаТовары.Номенклатура						КАК Номенклатура,
	|	ТаблицаТовары.Характеристика					КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
	|	РеквизитыЭтапа.Спецификация						КАК Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)	КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК Факт,
	|	ВЫБОР
	|		КОГДА МАКСИМУМ(ДолиПоПереработке.КоличествоФакт) = 0 ТОГДА 0
	|		ИНАЧЕ 
	|			СУММА(ВЫБОР
	|					КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|						ТОГДА ТаблицаТовары.Количество
	|					ИНАЧЕ 0
	|				КОНЕЦ) / МАКСИМУМ(ДолиПоПереработке.КоличествоФакт) *
	|			МАКСИМУМ(ДолиПоПереработке.КоличествоПлан) 
	|	КОНЕЦ КАК План,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ВЫБОР
	|						КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|							ТОГДА ТаблицаТовары.Количество
	|						ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|					КОНЕЦ
	|			ИНАЧЕ 0
	|	КОНЕЦ)											КАК ДоляСтоимостиФакт,
	|	МАКСИМУМ(ДолиПоПереработке.ДоляСтоимостиПлан)	КАК ДоляСтоимости,
	|	МАКСИМУМ(ДолиПоПереработке.ДоляСтоимостиПлан)	КАК ПолнаяДоляСтоимости
	|ИЗ
	|	Документ.ОтчетПереработчика2_5.ВыходныеИзделия КАК ТаблицаТовары
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|		ПО РеквизитыЭтапа.Ссылка = ТаблицаТовары.ЭтапПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК ПартииПроизводства
	|		ПО ПартииПроизводства.ПартияПроизводства = РеквизитыЭтапа.ПартияПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5 КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТовары.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втДолиПоПереработке КАК ДолиПоПереработке
	|		ПО ДолиПоПереработке.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ДолиПоПереработке.Номенклатура = ТаблицаТовары.Номенклатура
	|			И ДолиПоПереработке.Характеристика = ТаблицаТовары.Характеристика
	|			И ДолиПоПереработке.КодСтроки = ТаблицаТовары.КодСтроки
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО ТаблицаТовары.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Контрагент				= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартий.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.НалогообложениеНДС		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) // при ПУ 2.2 НалогообложениеНДС не заполняется
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТовары.КодСтрокиПродукция
	|			И РеквизитыОтчета.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|ГДЕ
	|	ТаблицаТовары.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка,
	|	РеквизитыОтчета.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация,
	|	РеквизитыОтчета.Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность,
	|	ТаблицаТовары.Номенклатура,
	|	ТаблицаТовары.Характеристика,
	|	РеквизитыЭтапа.Спецификация,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТовары.ИдентификаторСтроки";
	#КонецОбласти
	
	// план и факт по отчетам переработчиков 2.5 по этапам по товарам
	#Область ТекствтПродукция_ОтчетыПереработчиков25ПоЭтапам_Товары
	ТекствтПродукция_ОтчетыПереработчиков25ПоЭтапам_Товары = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ВЫБОР
	|		КОГДА ТаблицаТовары.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам)
	|		КОГДА ТаблицаТовары.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|		  ИЛИ ТаблицаТовары.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеПереданныеПартнерам)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|	КОНЕЦ КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка							КАК ПартияВыпуска,
	|	РеквизитыОтчета.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация						КАК Организация,
	|	РеквизитыОтчета.Подразделение					КАК Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность			КАК ВидДеятельностиНДС,
	|	Аналитика.Номенклатура							КАК Номенклатура,
	|	Аналитика.Характеристика						КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
	|	РеквизитыЭтапа.Спецификация						КАК Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторФинЗаписи			КАК ИдентификаторФинЗаписи,
	|	ТаблицаТовары.ВидЗапасов						КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК Факт,
	|	ВЫБОР
	|		КОГДА МАКСИМУМ(ДолиПоПереработке.КоличествоФакт) = 0 ТОГДА 0
	|		ИНАЧЕ 
	|			СУММА(ВЫБОР
	|					КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|						ТОГДА ТаблицаТовары.Количество
	|					ИНАЧЕ 0
	|				КОНЕЦ) / МАКСИМУМ(ДолиПоПереработке.КоличествоФакт) *
	|			МАКСИМУМ(ДолиПоПереработке.КоличествоПлан)
	|	КОНЕЦ КАК План,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ВЫБОР
	|						КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|							ТОГДА ТаблицаТовары.Количество
	|						ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|					КОНЕЦ
	|			ИНАЧЕ 0
	|	КОНЕЦ)											КАК ДоляСтоимостиФакт,
	|	МАКСИМУМ(ДолиПоПереработке.ДоляСтоимостиПлан)	КАК ДоляСтоимости,
	|	МАКСИМУМ(ДолиПоПереработке.ДоляСтоимостиПлан)	КАК ПолнаяДоляСтоимости
	|ИЗ
	|	Документ.ОтчетПереработчика2_5.ВидыЗапасовИзделия КАК ТаблицаТовары
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК РеквизитыЭтапа
	|		ПО РеквизитыЭтапа.Ссылка = ТаблицаТовары.ЭтапПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК ПартииПроизводства
	|		ПО ПартииПроизводства.ПартияПроизводства = РеквизитыЭтапа.ПартияПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5 КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТовары.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5.ВыходныеИзделия КАК ТЧВыходныеИзделия
	|		ПО ТаблицаТовары.Ссылка = ТЧВыходныеИзделия.Ссылка
	|			И ТаблицаТовары.КодСтрокиПродукция = ТЧВыходныеИзделия.КодСтрокиПродукция
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО ТаблицаТовары.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втДолиПоПереработке КАК ДолиПоПереработке
	|		ПО ДолиПоПереработке.ПартияПроизводства = ПартииПроизводства.ПартияПроизводства
	|			И ДолиПоПереработке.Номенклатура = Аналитика.Номенклатура
	|			И ДолиПоПереработке.Характеристика = Аналитика.Характеристика
	|			И ДолиПоПереработке.КодСтроки = ТЧВыходныеИзделия.КодСтроки
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Контрагент				= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартий.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.НалогообложениеНДС		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) // при ПУ 2.2 НалогообложениеНДС не заполняется
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТовары.КодСтрокиПродукция
	|			И РеквизитыОтчета.Организация В (&ОрганизацииСФИФОСкользящая)
	|ГДЕ
	|	НЕ ТаблицаТовары.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|
	|СГРУППИРОВАТЬ ПО
	|	ВЫБОР
	|		КОГДА ТаблицаТовары.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам)
	|		КОГДА ТаблицаТовары.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|		  ИЛИ ТаблицаТовары.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеПереданныеПартнерам)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|	КОНЕЦ,
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка,
	|	РеквизитыОтчета.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация,
	|	РеквизитыОтчета.Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	ТаблицаТовары.ВидЗапасов,
	|	РеквизитыЭтапа.Спецификация,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТовары.ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторФинЗаписи";
	#КонецОбласти
	
	//-- НЕ УТКА

	//++ Устарело_Переработка24
	
	// план и факт по отчетам переработчиков без этапов
	#Область ТекствтПродукция_ОтчетыПереработчиковБезЭтапов
	ТекствтПродукция_ОтчетыПереработчиковБезЭтапов = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка							КАК ПартияВыпуска,
	|	РеквизитыОтчета.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация						КАК Организация,
	|	РеквизитыОтчета.Подразделение					КАК Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность			КАК ВидДеятельностиНДС,
	|	ТаблицаТоваров.Номенклатура						КАК Номенклатура,
	|	ТаблицаТоваров.Характеристика					КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
	|	ТаблицаТоваров.Спецификация						КАК Спецификация,
	|	""""											КАК ИдентификаторСтроки,
	|	""""											КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)	КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТоваров.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	СУММА(ТаблицаТоваров.Количество)				КАК Факт,
	|	СУММА(ТаблицаТоваров.Количество)				КАК План,
	|	СУММА(ТаблицаТоваров.Количество)				КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ПолнаяДоляСтоимости
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика.Продукция КАК ТаблицаТоваров
	|		ПО ПартииПроизводства.ДокументПартии = ТаблицаТоваров.Ссылка
	|			И ПартииПроизводства.НомерГруппыЗатрат = ТаблицаТоваров.НомерГруппыЗатрат
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО ТаблицаТоваров.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= РеквизитыОтчета.Партнер
	|			И АналитикиУчетаПартий.Контрагент				= РеквизитыОтчета.Контрагент
	|			И АналитикиУчетаПартий.СтавкаНДС				= РеквизитыОтчета.СтавкаНДС
	|			И АналитикиУчетаПартий.НалогообложениеНДС		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) // при ПУ 2.2 НалогообложениеНДС не заполняется
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТоваров.КодСтрокиПродукция
	|			И ПартииПроизводства.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|ГДЕ
	|	РеквизитыОтчета.Проведен
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка,
	|	РеквизитыОтчета.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация,
	|	РеквизитыОтчета.Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность,
	|	ТаблицаТоваров.Номенклатура,
	|	ТаблицаТоваров.Характеристика,
	|	ТаблицаТоваров.Спецификация,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТоваров.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ";
	#КонецОбласти
	
	//-- Устарело_Переработка24
	
	// план и факт по отчетам переработчиков 2.5 без этапов по работам
	#Область ТекствтПродукция_ОтчетыПереработчиков25БезЭтапов_Работы
	ТекствтПродукция_ОтчетыПереработчиков25БезЭтапов_Работы = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка							КАК ПартияВыпуска,
	|	РеквизитыОтчета.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация						КАК Организация,
	|	РеквизитыОтчета.Подразделение					КАК Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность			КАК ВидДеятельностиНДС,
	|	ТаблицаТоваров.Номенклатура						КАК Номенклатура,
	|	ТаблицаТоваров.Характеристика					КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
	|	ТаблицаТоваров.Спецификация						КАК Спецификация,
	|	ТаблицаТоваров.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ТаблицаТоваров.ИдентификаторСтроки				КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)	КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТоваров.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	СУММА(ТаблицаТоваров.Количество)				КАК Факт,
	|	СУММА(ТаблицаТоваров.Количество)				КАК План,
	|	СУММА(ТаблицаТоваров.Количество)				КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ПолнаяДоляСтоимости
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5.ВыходныеИзделия КАК ТаблицаТоваров
	|		ПО ПартииПроизводства.ДокументПартии = ТаблицаТоваров.Ссылка
	|			И ПартииПроизводства.НомерГруппыЗатрат = ТаблицаТоваров.НомерГруппыЗатрат
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5 КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО ТаблицаТоваров.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Контрагент				= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартий.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.НалогообложениеНДС		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) // при ПУ 2.2 НалогообложениеНДС не заполняется
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТоваров.КодСтрокиПродукция
	|			И ПартииПроизводства.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|ГДЕ
	|	ТаблицаТоваров.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка,
	|	РеквизитыОтчета.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация,
	|	РеквизитыОтчета.Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность,
	|	ТаблицаТоваров.Номенклатура,
	|	ТаблицаТоваров.Характеристика,
	|	ТаблицаТоваров.Спецификация,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТоваров.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТоваров.ИдентификаторСтроки";
	#КонецОбласти
	
	// план и факт по отчетам переработчиков 2.5 без этапов по товарам
	#Область ТекствтПродукция_ОтчетыПереработчиков25БезЭтапов_Товары
	ТекствтПродукция_ОтчетыПереработчиков25БезЭтапов_Товары = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ВЫБОР
	|		КОГДА ТаблицаТоваров.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам)
	|		КОГДА ТаблицаТоваров.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|		  ИЛИ ТаблицаТоваров.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеПереданныеПартнерам)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|	КОНЕЦ КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка							КАК ПартияВыпуска,
	|	РеквизитыОтчета.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация						КАК Организация,
	|	РеквизитыОтчета.Подразделение					КАК Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность			КАК ВидДеятельностиНДС,
	|	Аналитика.Номенклатура							КАК Номенклатура,
	|	Аналитика.Характеристика						КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
	|	ЗНАЧЕНИЕ(Справочник.РесурсныеСпецификации.ПустаяСсылка) КАК Спецификация,
	|	ТаблицаТоваров.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ТаблицаТоваров.ИдентификаторФинЗаписи			КАК ИдентификаторФинЗаписи,
	|	ТаблицаТоваров.ВидЗапасов						КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТоваров.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	СУММА(ТаблицаТоваров.Количество)				КАК Факт,
	|	СУММА(ТаблицаТоваров.Количество)				КАК План,
	|	СУММА(ТаблицаТоваров.Количество)				КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТоваров.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТоваров.Количество
	|			ИНАЧЕ ТаблицаТоваров.ДоляСтоимости
	|		КОНЕЦ)										КАК ПолнаяДоляСтоимости
	|ИЗ
	|	ПартииПроизводстваСводно КАК ПартииПроизводства
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5.ВидыЗапасовИзделия КАК ТаблицаТоваров
	|		ПО ПартииПроизводства.ДокументПартии = ТаблицаТоваров.Ссылка
	|			И ПартииПроизводства.НомерГруппыЗатрат = ТаблицаТоваров.НомерГруппыЗатрат
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5 КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТоваров.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО ТаблицаТоваров.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
	|		ПО АналитикиУчетаПартий.ГруппаФинансовогоУчета	= ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Поставщик				= ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
	|			И АналитикиУчетаПартий.Контрагент				= НЕОПРЕДЕЛЕНО
	|			И АналитикиУчетаПартий.СтавкаНДС				= ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
	|			И АналитикиУчетаПартий.НалогообложениеНДС		= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) // при ПУ 2.2 НалогообложениеНДС не заполняется
	|			И АналитикиУчетаПартий.ВидЦенности				= ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.Товары)
	|			И АналитикиУчетаПартий.КодСтроки				= ТаблицаТоваров.КодСтрокиПродукция
	|			И ПартииПроизводства.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	|ГДЕ
	|	НЕ ТаблицаТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|
	|СГРУППИРОВАТЬ ПО
	|	ВЫБОР
	|		КОГДА ТаблицаТоваров.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам)
	|		КОГДА ТаблицаТоваров.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|		  ИЛИ ТаблицаТоваров.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеПереданныеПартнерам)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|	КОНЕЦ,
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка,
	|	РеквизитыОтчета.Дата,
	|	ЕСТЬNULL(АналитикиУчетаПартий.КлючАналитики, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация,
	|	РеквизитыОтчета.Подразделение,
	|	РеквизитыОтчета.ЗакупкаПодДеятельность,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	ТаблицаТоваров.ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТоваров.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТоваров.ИдентификаторСтроки,
	|	ТаблицаТоваров.ИдентификаторФинЗаписи";
	#КонецОбласти
	
	ИндексвтПродукция = "
	|
	//++ НЕ УТКА
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// План и факт Отчет давальцу между организациями по товарам
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
	|	ПартииПроизводства.ПартияПроизводства			КАК ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка							КАК ПартияВыпуска,
	|	РеквизитыОтчета.Дата							КАК ДатаПроизводства,
	|	ЕСТЬNULL(Т.КорАналитикаУчетаПартий,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Организация						КАК Организация,
	|	РеквизитыОтчета.Подразделение					КАК Подразделение,
	|	ПартииПроизводства.ВидДеятельностиНДС			КАК ВидДеятельностиНДС,
	|	Аналитика.Номенклатура										КАК Номенклатура,
	|	Аналитика.Характеристика									КАК Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)			КАК Серия,
	|	ЗНАЧЕНИЕ(Справочник.РесурсныеСпецификации.ПустаяСсылка)		КАК Спецификация,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ТаблицаТовары.ИдентификаторСтроки				КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)	КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ											КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО									КАК СтатьяАктивовПассивов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО									КАК АналитикаАктивовПассивов,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК Факт,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК План,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК КоличествоПродукции,
	|	СУММА(ВЫБОР
	|			КОГДА РеквизитыОтчета.Дата <= &КонецПериода
	|				ТОГДА ВЫБОР
	|						КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|							ТОГДА ТаблицаТовары.Количество
	|						ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|					КОНЕЦ
	|			ИНАЧЕ 0
	|		КОНЕЦ)										КАК ДоляСтоимостиФакт,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|		КОНЕЦ)										КАК ДоляСтоимости,
	|	СУММА(ВЫБОР
	|			КОГДА ТаблицаТовары.ДоляСтоимости = 0
	|				ТОГДА ТаблицаТовары.Количество
	|			ИНАЧЕ ТаблицаТовары.ДоляСтоимости
	|		КОНЕЦ)										КАК ПолнаяДоляСтоимости
	|ИЗ
	|	Документ.ОтчетДавальцуМеждуОрганизациями.Товары КАК ТаблицаТовары
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетДавальцуМеждуОрганизациями КАК РеквизитыОтчета
	|		ПО РеквизитыОтчета.Ссылка = ТаблицаТовары.Ссылка
	|		И РеквизитыОтчета.Проведен
	|		И НЕ РеквизитыОтчета.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК ПартииПроизводства
	|		ПО ПартииПроизводства.ПартияПроизводства = ТаблицаТовары.ПартияПроизводства
	|			И ПартииПроизводства.Организация = РеквизитыОтчета.Организация
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО ТаблицаТовары.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|			И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|			И Аналитика.Серия = АналитикаБезНазначения.Серия
	|			И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|			И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	|			И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Т
	|		ПО Т.Регистратор = РеквизитыОтчета.Ссылка
	|			И Т.ИдентификаторСтроки = ТаблицаТовары.ИдентификаторСтроки
	|			И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|			И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|			И НЕ Т.РасчетПартий 
	|			И НЕ Т.РасчетСебестоимости
	|			И РеквизитыОтчета.Организация В (&ОрганизацииСФИФОСкользящая)
	|
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
	|			ПО Реестр.СторнируемыйДокумент = ТаблицаТовары.Ссылка
	|			И Реестр.СторноИсправление
	|			И Реестр.ДатаДокументаИБ <= &КонецПериода
	|			И Реестр.Проведен
	|	ГДЕ
	// Исключаем документы по которым введена корректировка или сторнирование в текущем периоде
	|		Реестр.Ссылка ЕСТЬ NULL
	|
	|СГРУППИРОВАТЬ ПО
	|	РеквизитыОтчета.Организация,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты),
	|	ПартииПроизводства.ПартияПроизводства,
	|	РеквизитыОтчета.Ссылка,
	|	РеквизитыОтчета.Дата,
	|	ЕСТЬNULL(Т.КорАналитикаУчетаПартий, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
	|	ПартииПроизводства.АналитикаФинансовогоУчета,
	|	РеквизитыОтчета.Подразделение,
	|	ПартииПроизводства.ВидДеятельностиНДС,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка),
	|	ЗНАЧЕНИЕ(Справочник.РесурсныеСпецификации.ПустаяСсылка),
	|	ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТаблицаТовары.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ
	|			АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ,
	|	ТаблицаТовары.ИдентификаторСтроки
	|
	//-- НЕ УТКА
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ПартияПроизводства";
	
	#Область ТекствтДолиИтог
	ТекствтДолиИтог = "
	// Итоги долей распределения по партиям производства 
	// (кроме переработки на стороне 2.5)
	|ВЫБРАТЬ
	|	ДД.ПартияПроизводства				КАК ПартияПроизводства,
	|	ДД.Организация						КАК Организация,
	|	СУММА(
	|		ВЫБОР
	|			КОГДА ДД.ДоляСтоимости < 0 
	|				ТОГДА 0 
	|			ИНАЧЕ ДД.ДоляСтоимости 
	|		КОНЕЦ)							КАК СуммаДолейПоЭтапу,
	|	СУММА(
	|		ВЫБОР
	|			КОГДА ДД.ПолнаяДоляСтоимости < 0 
	|				ТОГДА 0 
	|			ИНАЧЕ ДД.ПолнаяДоляСтоимости 
	|		КОНЕЦ)							КАК СуммаПолныхДолейПоЭтапу,
	|	МИНИМУМ(ВЫБОР
	|		КОГДА ДД.Факт <> ДД.План
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ)								КАК ПроизводствоЗавершено
	|ПОМЕСТИТЬ втДолиИтог
	|ИЗ
	|	втПродукция КАК ДД
	|ГДЕ
	|	НЕ ДД.ПартияВыпуска ССЫЛКА Документ.ОтчетПереработчика2_5
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.ПартияПроизводства,
	|	ДД.Организация
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// Итоги долей распределения по партиям производства, выполняемым переработчиком на стороне 2.5 
	// (для них не применяется суммирование долей, т.к. исходные данные уже задержат суммы долей из втДолиПоПереработке)
	|ВЫБРАТЬ
	|	ДД.ПартияПроизводства				КАК ПартияПроизводства,
	|	ДД.Организация						КАК Организация,
	|	МИНИМУМ(
	|		ВЫБОР
	|			КОГДА ДД.ДоляСтоимости < 0 
	|				ТОГДА 0 
	|			ИНАЧЕ ДД.ДоляСтоимости 
	|		КОНЕЦ)							КАК СуммаДолейПоЭтапу,
	|	МИНИМУМ(
	|		ВЫБОР
	|			КОГДА ДД.ПолнаяДоляСтоимости < 0 
	|				ТОГДА 0 
	|			ИНАЧЕ ДД.ПолнаяДоляСтоимости 
	|		КОНЕЦ)							КАК СуммаПолныхДолейПоЭтапу,
	|	МИНИМУМ(ВЫБОР
	|		КОГДА ДД.Факт <> ДД.План
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ)								КАК ПроизводствоЗавершено
	|ИЗ
	|	втПродукция КАК ДД
	|ГДЕ
	|	ДД.ПартияВыпуска ССЫЛКА Документ.ОтчетПереработчика2_5
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.ПартияПроизводства,
	|	ДД.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Организация,
	|	ПартияПроизводства";
	#КонецОбласти
	
	#Область ТекстПродукция
	ТекстПродукция = "
	|ВЫБРАТЬ
	|	ДД.ХозяйственнаяОперация			КАК ХозяйственнаяОперация,
	|	ДД.РазделУчета						КАК РазделУчета,
	|	ДД.ПартияПроизводства				КАК ПартияПроизводства,
	|	ДД.ПартияВыпуска					КАК ПартияВыпуска,
	|	ДД.ДатаПроизводства					КАК ДатаПроизводства,
	|	ДД.АналитикаУчетаПартий				КАК АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета		КАК АналитикаФинансовогоУчета,
	|	ДД.Организация						КАК Организация,
	|	ДД.ВидДеятельностиНДС				КАК ВидДеятельностиНДС,
	|	ДД.Подразделение					КАК Подразделение,
	|	ДД.Номенклатура						КАК Номенклатура,
	|	ДД.Характеристика					КАК Характеристика,
	// При ценообразовании 2.5 не поддерживается указание плановой цены в разрезе упаковок.
	// Значение будет определяться по цене для единицы хранения.
	|	ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка) КАК Упаковка,
	|	ДД.Серия							КАК Серия,
	|	ДД.Спецификация						КАК Спецификация,
	|	ДД.ВидЗапасов						КАК ВидЗапасов,
	|	ДД.АналитикаУчетаНоменклатуры		КАК АналитикаУчетаНоменклатуры,
	|	ДД.КоличествоПродукции				КАК КоличествоПродукции,
	|	ДД.СтатьяРасходовСписания			КАК СтатьяРасходовСписания,
	|	ДД.АналитикаРасходов				КАК АналитикаРасходов,
	|	ДД.СтатьяАктивовПассивов			КАК СтатьяАктивовПассивов,
	|	ДД.АналитикаАктивовПассивов			КАК АналитикаАктивовПассивов,
	|	ДД.ИдентификаторСтроки				КАК ИдентификаторСтроки,
	|	ДД.ИдентификаторФинЗаписи			КАК ИдентификаторФинЗаписи,
	|	ДД.Факт								КАК Факт,
	|	ДД.План								КАК План,
	|	ДД.ДоляСтоимости					КАК ДоляСтоимости,
	|	ДД.ПолнаяДоляСтоимости				КАК ПолнаяДоляСтоимости,
	|	ВЫБОР КОГДА ДолиИтог.СуммаПолныхДолейПоЭтапу = 0
	|		ИЛИ ДД.План = 0
	|		ТОГДА 0
	|		ИНАЧЕ
	|			ВЫРАЗИТЬ(ДД.ПолнаяДоляСтоимости / ДолиИтог.СуммаПолныхДолейПоЭтапу * (ДД.Факт / ДД.План) КАК ЧИСЛО(23,10))
	|	КОНЕЦ								КАК ПолнаяДоляНаименованияВсего,
	|	ВЫБОР КОГДА ДолиИтог.СуммаПолныхДолейПоЭтапу = 0
	|		ИЛИ ДД.План = 0
	|		ТОГДА 0
	|		ИНАЧЕ
	|			ВЫРАЗИТЬ(ДД.ПолнаяДоляСтоимости / ДолиИтог.СуммаПолныхДолейПоЭтапу * (ДД.КоличествоПродукции / ДД.План) КАК ЧИСЛО(23,10))
	|	КОНЕЦ								КАК ПолнаяДоляНаименованияМесяца,
	|	ВЫБОР КОГДА ДолиИтог.СуммаДолейПоЭтапу = 0
	|		ИЛИ ДД.План = 0
	|		ТОГДА 0
	|		ИНАЧЕ
	|			ВЫРАЗИТЬ(ДД.ДоляСтоимости / ДолиИтог.СуммаДолейПоЭтапу * (ДД.Факт / ДД.План) КАК ЧИСЛО(23,10))
	|	КОНЕЦ								КАК ДоляНаименованияВсего,
	|	ВЫБОР КОГДА ДолиИтог.СуммаДолейПоЭтапу = 0 
	|		ИЛИ ДД.План = 0
	|		ТОГДА 0
	|		ИНАЧЕ
	|			ВЫРАЗИТЬ(ДД.ДоляСтоимости / ДолиИтог.СуммаДолейПоЭтапу * (ДД.КоличествоПродукции / ДД.План) КАК ЧИСЛО(23,10))
	|	КОНЕЦ								КАК ДоляНаименованияМесяца,
	|	ДолиИтог.ПроизводствоЗавершено		КАК ПроизводствоЗавершено
	|ПОМЕСТИТЬ Продукция
	|ИЗ
	|	втПродукция КАК ДД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втДолиИтог КАК ДолиИтог
	|		ПО ДД.ПартияПроизводства = ДолиИтог.ПартияПроизводства
	|		И ДД.Организация = ДолиИтог.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ПартияПроизводства";
	#КонецОбласти
	
	#Область ТекстДолиВыпуска
	ТекстДолиВыпуска = "
	|ВЫБРАТЬ
	|	ДД.ПартияПроизводства					КАК ПартияПроизводства,
	|	ДД.ПроизводствоЗавершено				КАК ПроизводствоЗавершено,
	|	ДД.Организация							КАК Организация,
	|	СУММА(ДД.ДоляНаименованияВсего)			КАК ДоляВыпускаВсего,
	|	СУММА(ДД.ДоляНаименованияМесяца)		КАК ДоляВыпускаМесяца
	|ПОМЕСТИТЬ ДолиВыпуска
	|ИЗ
	|	Продукция КАК ДД
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.ПартияПроизводства,
	|	ДД.ПроизводствоЗавершено,
	|	ДД.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Организация,
	|	ПартияПроизводства";
	#КонецОбласти
	
	#Область ТекстЗамкнутыеПартии
	ТекстЗамкнутыеПартии = "
	|ВЫБРАТЬ
	|	ПартииМатериаловВНЗП.ПартияПроизводства			КАК ПартияПроизводства,
	|	Продукция.ПартияВыпуска							КАК ПартияВыпуска,
	|	ПартииМатериаловВНЗП.АналитикаУчетаНоменклатуры	КАК АналитикаУчетаНоменклатуры,
	|	СУММА(ПартииМатериаловВНЗП.Количество)			КАК Количество
	|ПОМЕСТИТЬ ЗамкнутыеПартии
	|ИЗ
	|	ПартииМатериаловВНЗП КАК ПартииМатериаловВНЗП
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Продукция КАК Продукция
	|		ПО ПартииМатериаловВНЗП.ПартияПроизводства = Продукция.ПартияПроизводства
	|		И ПартииМатериаловВНЗП.ПартияМатериала = Продукция.ПартияВыпуска
	|		И ПартииМатериаловВНЗП.АналитикаУчетаПартий = Продукция.АналитикаУчетаПартий
	|		И ПартииМатериаловВНЗП.Организация = Продукция.Организация
	|
	|СГРУППИРОВАТЬ ПО
	|	ПартииМатериаловВНЗП.ПартияПроизводства,
	|	Продукция.ПартияВыпуска,
	|	ПартииМатериаловВНЗП.АналитикаУчетаНоменклатуры";
	#КонецОбласти	
	
	ТекстывтПродукция = Новый Массив;
	ТекстывтПродукция.Добавить(ТекствтПродукция_ОписаниеДанных);
	ТекстывтПродукция.Добавить(ТекствтПродукция_ПБЗ_Товары);
	ТекстывтПродукция.Добавить(ТекствтПродукция_ПБЗ_Работы);
	
	//++ НЕ УТКА
	ТекстывтПродукция.Добавить(ТекствтПродукция_Этапы_Товары);
	ТекстывтПродукция.Добавить(ТекствтПродукция_Этапы_Работы);
	//++ Устарело_Переработка24
	ТекстывтПродукция.Добавить(ТекствтПродукция_ОтчетыПереработчиковПоЭтапам);
	//-- Устарело_Переработка24
	ТекстывтПродукция.Добавить(ТекствтПродукция_ОтчетыПереработчиков25ПоЭтапам_Товары);
	ТекстывтПродукция.Добавить(ТекствтПродукция_ОтчетыПереработчиков25ПоЭтапам_Работы);
	//-- НЕ УТКА
	
	//++ Устарело_Переработка24
	ТекстывтПродукция.Добавить(ТекствтПродукция_ОтчетыПереработчиковБезЭтапов);
	//-- Устарело_Переработка24
	ТекстывтПродукция.Добавить(ТекствтПродукция_ОтчетыПереработчиков25БезЭтапов_Работы);
	ТекстывтПродукция.Добавить(ТекствтПродукция_ОтчетыПереработчиков25БезЭтапов_Товары);
	ТекствтПродукция = 
		СтрСоединить(ТекстывтПродукция, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении()) + ИндексвтПродукция;

	ТекстыЗапроса = Новый Массив;
	//++ НЕ УТКА
	ТекстыЗапроса.Добавить(ТекствтДолиПоПереработке);
	//-- НЕ УТКА
	ТекстыЗапроса.Добавить(ТекствтПродукция);
	ТекстыЗапроса.Добавить(ТекствтДолиИтог);
	ТекстыЗапроса.Добавить(ТекстПродукция);
	ТекстыЗапроса.Добавить(ТекстДолиВыпуска);
	ТекстыЗапроса.Добавить(ТекстЗамкнутыеПартии);
	ТекстыЗапроса.Добавить("");

	Возврат СтрСоединить(ТекстыЗапроса, ОбщегоНазначенияУТ.РазделительЗапросовВПакете());
	
КонецФункции

// Таблицы: ДанныеПоПродукции
// 
// Возвращаемое значение:
// 	Строка - текст запроса
Функция ТекстДанныеПоВыпущеннойПродукции() Экспорт
	
	ИспользуетсяЦенообразование25 = ЦенообразованиеВызовСервера.ИспользуетсяЦенообразование25();
	ТекстыЗапросов = Новый Массив;
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ТаблицаТоваров.ДатаПроизводства					КАК ДатаПроизводства,
	|	ТаблицаТоваров.Организация						КАК Организация,
	|	ТаблицаТоваров.Подразделение					КАК Подразделение,
	|	ТаблицаТоваров.Номенклатура						КАК Номенклатура,
	|	ТаблицаТоваров.Характеристика					КАК Характеристика,
	|	ПартииПроизводства.АналитикаФинансовогоУчета	КАК ГруппаПродукции,
	|	ТаблицаТоваров.ПартияПроизводства				КАК ПартияПроизводства,
	|	ПартииПроизводства.ВидДеятельностиНДС			КАК ВидДеятельностиНДС,
	|	ПартииПроизводства.Назначение					КАК Назначение,
	|	ПартииПроизводства.НаправлениеДеятельности		КАК НаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО									КАК ЗаказНаПроизводство,
	|	0												КАК КодСтрокиПродукция,
	|	&ПоляДляЦенообразования,
	|	ТаблицаТоваров.КоличествоПродукции				КАК Количество,
	|	ТаблицаТоваров.План - ТаблицаТоваров.Факт		КАК КоличествоПлан
	|ПОМЕСТИТЬ ДанныеПоПродукцииБезЦен
	|ИЗ
	|	Продукция КАК ТаблицаТоваров
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводстваСводно КАК ПартииПроизводства
	|		ПО ПартииПроизводства.ПартияПроизводства = ТаблицаТоваров.ПартияПроизводства
	|			И ПартииПроизводства.Организация = ТаблицаТоваров.Организация
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыНоменклатуры КАК ВидыНоменклатуры
	|			ПО ВидыНоменклатуры.Ссылка = ТаблицаТоваров.Номенклатура.ВидНоменклатуры
	|	
	|ГДЕ
	|	ТаблицаТоваров.ПолнаяДоляНаименованияМесяца > 0 ИЛИ &УчитыватьБудущиеВыпуски";
	
	НастройкаЦенообразования = ЦенообразованиеКлиентСервер.НастройкиДляВременнойТаблицыСДополнениемДляЦенообразования();
	НастройкаЦенообразования.ИсточникТоваров = "ТаблицаТоваров";
	ТекстЗамены = ЦенообразованиеКлиентСервер.ТекстПолейДляЦенообразования(НастройкаЦенообразования);
	Если ЗначениеЗаполнено(ТекстЗамены) Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляДляЦенообразования", ТекстЗамены);
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляДляЦенообразования,", "");
	КонецЕсли;
		
	ТекстыЗапросов.Добавить(ТекстЗапроса);
	
	//++ Устарело_Производство21

	// производство без заказов 2.1
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	Реквизиты.Дата													КАК ДатаПроизводства,
	|	Реквизиты.Организация											КАК Организация,
	|	Реквизиты.Подразделение											КАК Подразделение,
	|	ДД.Номенклатура													КАК Номенклатура,
	|	ДД.Характеристика												КАК Характеристика,
	|	ВЫБОР
	|		КОГДА &АналитическийУчетПоГруппамПродукции
	|			ТОГДА ДД.Номенклатура.ГруппаАналитическогоУчета
	|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|	КОНЕЦ															КАК ГруппаПродукции,
	|	ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)			КАК ПартияПроизводства,
	|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)		КАК ВидДеятельностиНДС,
	|	ДД.Назначение													КАК Назначение,
	|	ЕСТЬNULL(ДД.Назначение.НаправлениеДеятельности, 
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))	КАК НаправлениеДеятельности,
	|	ДД.Ссылка														КАК ЗаказНаПроизводство,
	|	ДД.КодСтроки													КАК КодСтрокиПродукция,
	|	&ПоляДляЦенообразования,
	|	ДД.Количество													КАК Количество,
	|	0																КАК КоличествоПлан
	|ИЗ
	|	Документ.ВыпускПродукции.Товары КАК ДД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВыпускПродукции КАК Реквизиты
	|			ПО (Реквизиты.Ссылка = ДД.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыНоменклатуры КАК ВидыНоменклатуры
	|			ПО ВидыНоменклатуры.Ссылка = ДД.Номенклатура.ВидНоменклатуры
	|
	|ГДЕ
	|	Реквизиты.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Реквизиты.Организация В (&МассивОрганизаций)
	|	И ДД.ТипСтоимости = ЗНАЧЕНИЕ(Перечисление.ТипыСтоимостиВыходныхИзделий.Рассчитывается)
	|	И Реквизиты.Проведен
	|	И НЕ Реквизиты.ВыпускПоРаспоряжениям
	|	И &ВключатьДанныеПроизводства21
	|";

	НастройкаЦенообразования.ИсточникТоваров = "ДД";
	ТекстЗамены = ЦенообразованиеКлиентСервер.ТекстПолейДляЦенообразования(НастройкаЦенообразования);
	Если ЗначениеЗаполнено(ТекстЗамены) Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляДляЦенообразования", ТекстЗамены);
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляДляЦенообразования,", "");
	КонецЕсли;
		
	ТекстыЗапросов.Добавить(ТекстЗапроса);
	
	//++ НЕ УТКА

	// производство по заказам 2.1
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	Реквизиты.Дата													КАК ДатаПроизводства,
	|	Реквизиты.Организация											КАК Организация,
	|	Реквизиты.Подразделение											КАК Подразделение,
	|	ДД.Номенклатура													КАК Номенклатура,
	|	ДД.Характеристика												КАК Характеристика,
	|	ВЫБОР
	|		КОГДА &АналитическийУчетПоГруппамПродукции
	|			ТОГДА Продукция.Номенклатура.ГруппаАналитическогоУчета
	|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|	КОНЕЦ                                            КАК ГруппаПродукции,
	|	ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)			КАК ПартияПроизводства,
	|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)		КАК ВидДеятельностиНДС,
	|	Продукция.Назначение											КАК Назначение,
	|	ЕСТЬNULL(Продукция.Назначение.НаправлениеДеятельности, 
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))	КАК НаправлениеДеятельности,
	|	МаршрутныйЛист.Распоряжение										КАК ЗаказНаПроизводство,
	|	МаршрутныйЛист.КодСтроки										КАК КодСтрокиПродукция,
	|	&ПоляДляЦенообразования,
	|	ДД.Количество													КАК Количество,
	|	0																КАК КоличествоПлан
	|ИЗ
	|	Документ.ВыпускПродукции.Товары КАК ДД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВыпускПродукции КАК Реквизиты
	|			ПО (Реквизиты.Ссылка = ДД.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.МаршрутныйЛистПроизводства КАК МаршрутныйЛист
	|			ПО ДД.Распоряжение = МаршрутныйЛист.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказНаПроизводство.Продукция КАК Продукция
	|			ПО МаршрутныйЛист.Распоряжение = Продукция.Ссылка
	|			И МаршрутныйЛист.КодСтроки = Продукция.КодСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыНоменклатуры КАК ВидыНоменклатуры
	|			ПО ВидыНоменклатуры.Ссылка = ДД.Номенклатура.ВидНоменклатуры
	|
	|ГДЕ
	|	Реквизиты.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Реквизиты.Организация В (&МассивОрганизаций)
	|	И ДД.ТипСтоимости = ЗНАЧЕНИЕ(Перечисление.ТипыСтоимостиВыходныхИзделий.Рассчитывается)
	|	И Реквизиты.Проведен
	|	И Реквизиты.ВыпускПоРаспоряжениям
	|	И &ВключатьДанныеПроизводства21
	|";
		
	НастройкаЦенообразования.ИсточникТоваров = "ДД";
	ТекстЗамены = ЦенообразованиеКлиентСервер.ТекстПолейДляЦенообразования(НастройкаЦенообразования);
	Если ЗначениеЗаполнено(ТекстЗамены) Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляДляЦенообразования", ТекстЗамены);
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляДляЦенообразования,", "");
	КонецЕсли;
		
	ТекстыЗапросов.Добавить(ТекстЗапроса);

	//-- НЕ УТКА

	//-- Устарело_Производство21

	
	ВТ_ДанныеПоПродукцииБезЦен = СтрСоединить(ТекстыЗапросов, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении()) 
		+ ОбщегоНазначения.РазделительПакетаЗапросов();
		
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ДД.ДатаПроизводства									КАК ДатаПроизводства,
	|	ДД.Организация										КАК Организация,
	|	ДД.Подразделение									КАК Подразделение,
	|	ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)	КАК СтатьяКалькуляции,
	|	ДД.Номенклатура										КАК Продукция,
	|	ДД.ГруппаПродукции												КАК ГруппаПродукции,
	|	ДД.ПартияПроизводства								КАК ПартияПроизводства,
	|	ДД.ВидДеятельностиНДС								КАК ВидДеятельностиНДС,
	|	ДД.Назначение										КАК Назначение,
	|	ДД.НаправлениеДеятельности							КАК НаправлениеДеятельности,
	|	ДД.ЗаказНаПроизводство								КАК ЗаказНаПроизводство,
	|	ДД.КодСтрокиПродукция								КАК КодСтрокиПродукция,
	|	ДД.Количество										КАК Количество,
	|	&Объем * ДД.Количество								КАК Объем,
	|	&Вес * ДД.Количество								КАК Вес,
	|	ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0) 
	|		* ДД.Количество									КАК Стоимость,
	|	ДД.КоличествоПлан									КАК КоличествоПлан,
	|	&Объем * ДД.КоличествоПлан							КАК ОбъемПлан,
	|	&Вес * ДД.КоличествоПлан							КАК ВесПлан,
	|	ЕСТЬNULL(ЦеныНоменклатуры.Цена, 0) 
	|		* ДД.КоличествоПлан								КАК СтоимостьПлан
	|ПОМЕСТИТЬ ДанныеПоПродукции
	|ИЗ
	|	ДанныеПоПродукцииБезЦен КАК ДД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СН
	|			ПО (СН.Ссылка = ДД.Номенклатура)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ХарактеристикиНоменклатуры КАК СХ
	|			ПО СХ.Ссылка = ДД.Характеристика
	|		ЛЕВОЕ СОЕДИНЕНИЕ
	|			&ЦеныНоменклатуры КАК ЦеныНоменклатуры
	|		ПО 
	|			&УсловиеСоединенияЦеныНоменклатуры
	|";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,
		"&ЦеныНоменклатуры",
		ЦенообразованиеКлиентСервер.ТекстЗапросаРегистрСведенийЦеныНоменклатуры(
			"ДанныеПоПродукцииБезЦен",
			"&КонецПериода",
			Новый Структура("Параметр", "&ВидПлановыхЦен"),
			ИспользуетсяЦенообразование25)
	);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,
		"&УсловиеСоединенияЦеныНоменклатуры",
		ЦенообразованиеКлиентСервер.ТекстЗапросаРегистрСведенийЦеныНоменклатурыУсловиеСоединения(
			"ДД",
			"ЦеныНоменклатуры",
			,
			ИспользуетсяЦенообразование25)
	);
		
	
	Возврат ВТ_ДанныеПоПродукцииБезЦен 
		+ ТекстЗапроса
		+ ОбщегоНазначения.РазделительПакетаЗапросов();
	
КонецФункции

// Таблицы: ДанныеПоТрудозатратам
// 
// Параметры:
// 	ПараметрыРасчета - Структура - параметры расчета
// Возвращаемое значение:
// 	Строка - текст запроса
Функция ТекстДанныеПоТрудозатратам(ПараметрыРасчета = Неопределено) Экспорт
	
	ДляРасшифровки 				= РасчетСебестоимостиПрикладныеАлгоритмы.РасчетВызванДляРасшифровки(ПараметрыРасчета);
	РасчетСебестоимостиВыполнен = РасчетСебестоимостиПрикладныеАлгоритмы.РасчетСебестоимостиВыполненДляРасшифровки(ПараметрыРасчета);
	
	// Данные по трудозатратам выбираются в одну таблицу т.к. источники данных для плана и факта одинаковые.
	// Исключением являются выпуски без заказа 2.1, для них данные выбираются из документов производства без заказов.
	Текст = "
	|ВЫБРАТЬ
	|	ДД.Организация,
	|	ДД.Подразделение,
	|	ДД.СтатьяКалькуляции,
	|	ДД.ВидРабот,
	|	СУММА(ДД.Количество) КАК Количество,
	|	СУММА(ДД.Стоимость) КАК Стоимость,
	|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
	//++ Локализация
	|	СУММА(ДД.СтоимостьРегл - ДД.ПостояннаяРазница - ДД.ВременнаяРазница)	КАК СтоимостьНУ,
	//-- Локализация
	|	СУММА(ДД.СтоимостьНДД) КАК СтоимостьНДД
	|ПОМЕСТИТЬ ТекущиеТрудозатратыНЗП
	|ИЗ
	|	ВТКэшРасчетныеОборотыТрудозатратыНезавершенногоПроизводства КАК ДД
	|ГДЕ
	|	ДД.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	//++ Устарело_Производство21

	//++ НЕ УТКА
	|	И ДД.ЗаказНаПроизводство = ЗНАЧЕНИЕ(Документ.ЗаказНаПроизводство.ПустаяСсылка)
	//-- НЕ УТКА

	//-- Устарело_Производство21
	|	И ДД.СлужебноеВидДвиженияПриход
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.Организация,
	|	ДД.Подразделение,
	|	ДД.СтатьяКалькуляции,
	|	ДД.ВидРабот
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Организация,
	|	Подразделение,
	|	СтатьяКалькуляции,
	|	ВидРабот
	|;
	// производство 2.2
	|ВЫБРАТЬ
	|	ДД.Организация								КАК Организация,
	|	ДД.Подразделение							КАК Подразделение,
	|	ДД.СтатьяКалькуляции						КАК СтатьяКалькуляции,
	|	ДД.ВидРабот									КАК ВидРабот,
	|	ДД.ПартияПроизводства.ГруппаПродукции		КАК ГруппаПродукции,
	|	ДД.ПартияПроизводства.Назначение			КАК Назначение,
	|	ДД.ПартияПроизводства						КАК ПартияПроизводства,
	|	ДД.ПартияПроизводства.ВидДеятельностиНДС	КАК ВидДеятельностиНДС,
	|	НЕОПРЕДЕЛЕНО								КАК ЗаказНаПроизводство,
	|	0											КАК КодСтрокиПродукция,
	|	ЕСТЬNULL(ДД.ПартияПроизводства.НаправлениеДеятельности,
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
	|	СУММА(ДД.Количество)						КАК Количество,
	|	СУММА(ДД.НормативнаяСтоимость)				КАК НормативнаяСтоимость,
	|	СУММА(ДД.Стоимость)							КАК Стоимость,
	|	СУММА(ДД.СтоимостьРегл)						КАК СтоимостьРегл,
	//++ Локализация
	|	СУММА(ДД.СтоимостьРегл - ДД.ПостояннаяРазница - ДД.ВременнаяРазница)	КАК СтоимостьНУ,
	//-- Локализация
	|	СУММА(ДД.СтоимостьНДД)						КАК СтоимостьНДД
	|ПОМЕСТИТЬ ДанныеПоТрудозатратам
	|ИЗ
	|	ВТКэшРасчетныеОборотыТрудозатратыНезавершенногоПроизводства КАК ДД
	|
	|ГДЕ
	|	ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДД.Организация В (&МассивОрганизаций)
	|	И ДД.ПартияПроизводства <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|	И ДД.СлужебноеВидДвиженияПриход
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.Подразделение,
	|	ДД.СтатьяКалькуляции,
	|	ДД.ВидРабот,
	|	ДД.ПартияПроизводства.Назначение,
	|	ДД.ПартияПроизводства.ВидДеятельностиНДС,
	|	ЕСТЬNULL(ДД.ПартияПроизводства.НаправлениеДеятельности,
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
	|	ДД.Организация,
	|	ДД.ПартияПроизводства,
	|	ДД.ПартияПроизводства.НаправлениеДеятельности,
	|	ДД.ПартияПроизводства.ГруппаПродукции
	|";
	
	РасчетСебестоимостиЛокализация.ДополнитьЗапросДаннымиПоТрудозатратам(Текст);
	
	Текст = Текст + ";";
	
	Если РасчетСебестоимостиВыполнен ИЛИ ДляРасшифровки Тогда
		Текст = СтрЗаменить(Текст,
			"ВТКэшРасчетныеОборотыТрудозатратыНезавершенногоПроизводства",
			"РегистрНакопления.ТрудозатратыНезавершенногоПроизводства");
		Текст = СтрЗаменить(Текст,
			"ДД.СлужебноеВидДвиженияПриход",
			"ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) И ДД.Активность");
	КонецЕсли;
	
	Возврат Текст;
	
КонецФункции

Функция ОтборПоМатериаламИерархия(ПараметрыРасчета) Экспорт
	
	Контекст = ПараметрыРасчета.РаспределениеПартий.ОписаниеДвижений.Контекст;
	
	Материалы = Новый ТаблицаЗначений;
	Материалы.Колонки.Добавить("Регистратор", РасчетСебестоимостиУниверсальныеАлгоритмы.ОписаниеТиповДокументов());
	Материалы.Колонки.Добавить("Материал",    Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Если Контекст = "РаспределениеНоменклатурыНаПроизводство"
		ИЛИ Контекст = "РаспределениеМатериаловИРаботПоБазе" Тогда
		
		// Этап 2
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Д.Ссылка КАК Регистратор,
		|	ТЧ.Материал КАК Материал,
		|	ТЧ.Материал.ЭтоГруппа КАК ЭтоГруппа
		|ИЗ
		|	Документ.РаспределениеПроизводственныхЗатрат.ОтборПоМатериалам КАК ТЧ
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеПроизводственныхЗатрат КАК Д
		|		ПО ТЧ.Ссылка = Д.Ссылка
		|
		|ГДЕ
		|	Д.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Д.Организация В (&МассивОрганизаций)
		|	И Д.Проведен
		|	И Д.КоличествоКРаспределениюПоПравилу <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Д.Ссылка КАК Регистратор,
		|	ТЧ.Материал КАК Материал,
		|	ТЧ.Материал.ЭтоГруппа КАК ЭтоГруппа
		|ИЗ
		|	Документ.РаспределениеВозвратныхОтходов.ОтборПоМатериалам КАК ТЧ
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеВозвратныхОтходов КАК Д
		|		ПО ТЧ.Ссылка = Д.Ссылка
		|
		|ГДЕ
		|	Д.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Д.Организация В (&МассивОрганизаций)
		|	И Д.Проведен
		|	И Д.КоличествоПоПравилу <> 0
		|";
		
	ИначеЕсли Контекст = "ПрочиеРасходыНЗППоБазе_КРаспределению"
	 ИЛИ Контекст = "ПрочиеРасходыНЗППоБазе_ПоПодразделениям" 
	 ИЛИ Контекст = "ПрочиеРасходыНЗППоБазе_ПоЭтапам" Тогда
		
		// Этап 15
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Д.Ссылка КАК Регистратор,
		|	ТЧ.Материал КАК Материал,
		|	ТЧ.Материал.ЭтоГруппа КАК ЭтоГруппа
		|ИЗ
		|	Документ.РаспределениеПрочихЗатрат.ОтборПоМатериалам КАК ТЧ
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеПрочихЗатрат КАК Д
		|		ПО ТЧ.Ссылка = Д.Ссылка
		|
		|ГДЕ
		|	Д.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Д.Организация В (&МассивОрганизаций)
		|	И Д.Проведен";
		
	Иначе
		
		ТекстДляПротокола = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru = 'Для контекста %1 не предусмотрено формирование отбора по материалам с иерархией';
				|en = 'Generation of filter by materials with hierarchy is not available for context %1'", ОбщегоНазначения.КодОсновногоЯзыка()),
			Контекст);
		
		РасчетСебестоимостиПротоколРасчета.ЗафиксироватьОшибкуРасчета(
			ПараметрыРасчета,
			Перечисления.ТипыОшибокПартионногоУчетаИСебестоимости.ОшибкаРаспределенияПартий,
			ТекстДляПротокола);
			
		ВызватьИсключение РасчетСебестоимостиПрикладныеАлгоритмы.ТекстИсключениеДляРегистрацииПроблемы(ТекстДляПротокола);
		
	КонецЕсли;

	Результат = Запрос.Выполнить().Выбрать();
	
	ЗапросИерархия = Новый Запрос;
	ЗапросИерархия.Текст =
	"ВЫБРАТЬ
	|	Н.Ссылка КАК Материал
	|ИЗ
	|	Справочник.Номенклатура КАК Н
	|ГДЕ
	|	Н.Ссылка В ИЕРАРХИИ(&Номенклатура)
	|	И НЕ Н.ЭтоГруппа";
		
	Пока Результат.Следующий() Цикл
		
		Если Результат.ЭтоГруппа Тогда
			
			ЗапросИерархия.УстановитьПараметр("Номенклатура", Результат.Материал);
			
			РезультатИерархия = ЗапросИерархия.Выполнить().Выбрать();
			
			Пока РезультатИерархия.Следующий() Цикл
				
				НоваяСтрока = Материалы.Добавить();
				НоваяСтрока.Регистратор = Результат.Регистратор;
				НоваяСтрока.Материал 	= РезультатИерархия.Материал;
				
			КонецЦикла;
			
		Иначе
			
			НоваяСтрока = Материалы.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, Результат);
			
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат Материалы;
	
КонецФункции

Функция ТекстРаспаковкаНаборов(ИсточникСпискаСпецификаций) Экспорт // вт МатериалыИУслугиСпецификаций
	
	ТекстыЗапросов = Новый Массив;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ИсточникСпискаСпецификаций.Спецификация КАК Спецификация
	|ПОМЕСТИТЬ ВТСпецификации
	|ИЗ
	|	&ИсточникСпискаСпецификаций КАК ИсточникСпискаСпецификаций
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Спецификация";
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ИсточникСпискаСпецификаций", ИсточникСпискаСпецификаций);
	ТекстыЗапросов.Добавить(ТекстЗапроса);
	
	ТекстыЗапросов.Добавить(
		Справочники.РесурсныеСпецификации.ТекстЗапросаМатериалыСпецификацийВключаяСоставНаборов("ВТСпецификации"));
	
	ТекстЗапроса =
		"УНИЧТОЖИТЬ ВТСпецификации";
	ТекстыЗапросов.Добавить(ТекстЗапроса);
	
	Возврат СтрСоединить(ТекстыЗапросов, ОбщегоНазначения.РазделительПакетаЗапросов());
	
КонецФункции

#КонецОбласти

#КонецОбласти

#КонецОбласти
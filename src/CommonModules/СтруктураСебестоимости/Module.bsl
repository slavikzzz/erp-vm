
#Область ПрограммныйИнтерфейс

//Инициализирует настройки отчета для формирования отчета.
// Возвращаемое значение:
//	Структура - настройки отчета.
Функция ИнициализироватьНастройкиОтчета(Отчет, КлючТекущегоВарианта, ОтчетОбъект) Экспорт
	
	НастройкиОтчета = ВариантыОтчетов.НастройкиФормыОтчета(Отчет, КлючТекущегоВарианта, ОтчетОбъект); // Структура
	
	НастройкиОтчета.Вставить("ПрочитатьФлажокФормироватьСразуИзПользовательскихНастроек", Ложь);
	НастройкиОтчета.Вставить("РазрешеноВыбиратьВарианты", Ложь);
	НастройкиОтчета.Вставить("СхемаМодифицирована", Ложь);
	НастройкиОтчета.Вставить("ПредопределенныеВарианты", Неопределено);
	НастройкиОтчета.Вставить("АдресСхемы",   "");
	НастройкиОтчета.Вставить("КлючСхемы",    "");
	НастройкиОтчета.Вставить("Контекстный",  Ложь);
	НастройкиОтчета.Вставить("ПолноеИмя",    "");
	НастройкиОтчета.Вставить("Наименование", "");
	НастройкиОтчета.Вставить("ОтчетСсылка",  Неопределено);
	НастройкиОтчета.Вставить("Внешний",      Ложь);
	НастройкиОтчета.Вставить("Безопасный",   Ложь);
	
	Возврат НастройкиОтчета;
	
КонецФункции

// Строит дерево себестоимости для изделия.
//
// Параметры:
//  ПараметрыДерева - см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
//  ПараметрыУзла - см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости.
//
Процедура ПостроитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла = Неопределено) Экспорт
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	Замер = ОценкаПроизводительности.НачатьЗамерДлительнойОперации("ОбщийМодуль.СтруктураСебестоимости.ПостроитьДеревоСебестоимости");
	ПараметрыДерева.Вставить("КоличествоСтрок", 0);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	Если ПараметрыУзла = Неопределено Тогда
		ПараметрыУзла = СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости();
	КонецЕсли;
	
	Если ПараметрыДерева.Результат = Неопределено Тогда
		ПустоеДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла);
	КонецЕсли;
	
	ЗаполнитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла);
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ОценкаПроизводительности.ЗакончитьЗамерДлительнойОперации(Замер, ПараметрыДерева.КоличествоСтрок / 1000);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
КонецПроцедуры

// Строит дерево себестоимости для изделия в фоне.
//
// Параметры:
// 	Параметры - Структура - описание параметров формирования отчетов:
//		* ПараметрыДерева - см. СтруктураСебестоимости.ПараметрыДереваСебестоимости - параметры дерева.
//		* ПараметрыУзла -см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости - параметры узла дерева.
//	АдресХранилища - Строка - адрес временного хранилища.
Процедура ПостроитьДеревоСебестоимостиВФоне(Параметры, АдресХранилища) Экспорт
	
	ПараметрыДерева = Параметры.ПараметрыДерева; // см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
	ПараметрыУзла = Параметры.ПараметрыУзла; // см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости
	ПостроитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла);
	
	Результат = Новый Структура("ДеревоСебестоимости, Успех");
	Результат.ДеревоСебестоимости	= ПараметрыДерева.Результат;
	Результат.Успех					= Истина;
	
	ПоместитьВоВременноеХранилище(Результат, АдресХранилища);
	
КонецПроцедуры

// Вызывается перед раскрытием узла дерева себестоимости.
//
// Параметры:
//  ПараметрыДерева	- см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
//  ПараметрыУзла - см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости
//  ОписаниеПродукции	- Структура	- Аналитика учета, партия и уровень продукции.
//
Процедура ДеревоСебестоимостиПередРазворачиванием(ПараметрыДерева, ПараметрыУзла, ОписаниеПродукции) Экспорт
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	Замер = ОценкаПроизводительности.НачатьЗамерДлительнойОперации("ОбщийМодуль.СтруктураСебестоимости.ДеревоСебестоимостиПередРазворачиванием");
	ПараметрыДерева.Вставить("КоличествоСтрок", 0);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзла, ПараметрыДерева.Результат, ОписаниеПродукции);
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ОценкаПроизводительности.ЗакончитьЗамерДлительнойОперации(Замер, ПараметрыДерева.КоличествоСтрок / 100);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
КонецПроцедуры

#Область ПараметрыДереваСебестоимости

// Параметры построения дерева себестоимости
// 
// Возвращаемое значение:
// Структура:
//  * ДинамическоеСчитывание - Булево - Истина, если уровни дерева себестоимости получается последовательно.
//  * ТипРезультата - Строка - Тип объекта, в который будет помещен результат - ДеревоЗначений, ТаблицаЗначений, МенеджерВременныхТаблиц.
//  * Результат - ДеревоЗначений, ТаблицаЗначений, МенеджерВременныхТаблиц - Объект, в который будет помещен результат разузлования.
//  * ДобавлятьПолуфабрикатыВРезультат - Булево - Будут ли добавлены промежуточные полуфабрикаты в результат.
//                                                Если результат ДеревоЗначений, то полуфабрикаты добавляются всегда.
//
Функция ПараметрыДереваСебестоимости() Экспорт
	
	ТипыРезультата = Новый ОписаниеТипов("ДеревоЗначений,ТаблицаЗначений,МенеджерВременныхТаблиц");
	
	ПараметрыДерева = Новый Структура;
	
	ПараметрыДерева.Вставить("ДинамическоеСчитывание",	Истина);
	ПараметрыДерева.Вставить("ТипРезультата",			"ДеревоЗначений");
	ПараметрыДерева.Вставить("Результат",				ТипыРезультата.ПривестиЗначение(Неопределено));
	ПараметрыДерева.Вставить("ДобавлятьПолуфабрикатыВРезультат", Истина);
	
	Возврат ПараметрыДерева;
	
КонецФункции

// Параметры узла дерева себестоимости
// 
// Возвращаемое значение:
// Структура:
//  * ИнтерактивнаяНастройка - Булево - Истина, если для получения таблицы ВыпущеннаяПродукция используется схема КД
//  * СхемаКД - СхемаКомпоновкиДанных - Схема КД для получения таблицы ВыпущеннаяПродукция
//  * НастройкиКД - НастройкиКомпоновкиДанных - Настройки схемы КД для получения таблицы ВыпущеннаяПродукция
//  * Отборы - Структура - Структура отборов, накладываемых на получение таблицы ВыпущеннаяПродукция.
//                         Используется для программного получения данных себестоимости.
//
Функция ПараметрыУзлаДереваСебестоимости() Экспорт
	
	ПараметрыУзла = Новый Структура;
	
	ПараметрыУзла.Вставить("ИнтерактивнаяНастройка",	Ложь);
	ПараметрыУзла.Вставить("СхемаКД",					Отчеты.ДеревоСебестоимостиПродукции.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных"));
	ПараметрыУзла.Вставить("НастройкиКД",				ПараметрыУзла.СхемаКД.НастройкиПоУмолчанию);
	
	Отборы = НоваяСтруктураОтборов();
	ПараметрыУзла.Вставить("Отборы", Отборы);
	
	ПараметрыУзла.Вставить("Сумма",                 0);
	ПараметрыУзла.Вставить("Материальные",          0);
	ПараметрыУзла.Вставить("ДопРасходы",            0);
	ПараметрыУзла.Вставить("Трудозатраты",          0);
	ПараметрыУзла.Вставить("ПостатейныеПеременные", 0);
	ПараметрыУзла.Вставить("ПостатейныеПостоянные", 0);
	ПараметрыУзла.Вставить("НалоговыйУчет",         0);
	ПараметрыУзла.Вставить("ПостояннаяРазница",     0);
	ПараметрыУзла.Вставить("ВременнаяРазница",      0);
	ПараметрыУзла.Вставить("СуммаЗабалансовая",     0);
	
	Возврат ПараметрыУзла;
	
КонецФункции

Функция НоваяСтруктураОтборов()
	
	Регистраторы = Новый Массив; // Массив из ДокументСсылка
	Организации = Новый Массив; // Массив из СправочникСсылка.Организации
	Подразделения = Новый Массив; // Массив из СправочникСсылка.СтруктураПредприятия
	Продукция = Новый Массив; // Массив из СправочникСсылка.Номенклатура
	ХарактеристикиПродукции = Новый Массив; // Массив из СправочникСсылка.ХарактеристикиНоменклатуры
	СерииПродукции = Новый Массив; // Массив из СправочникСсылка.СерииНоменклатуры
	НазначенияПродукции = Новый Массив; // Массив из СправочникСсылка.Назначения
	ПартииПродукции = Новый Массив; // Массив из ДокументСсылка
	АналитикиУчетаПартийПродукции = Новый Массив; // Массив из СправочникСсылка.КлючиАналитикиУчетаПартий
	АналитикаУчетаЗатрата = Новый Массив; // Массив из СправочникСсылка.КлючиАналитикиУчетаНоменклатуры
	
	Отборы = Новый Структура;
	
	Отборы.Вставить("ДанныеПоСебестоимости",			1);
	Отборы.Вставить("ДатаНачала",						'00010101');
	Отборы.Вставить("ДатаОкончания",					'00010101');
	Отборы.Вставить("Регистраторы",						Регистраторы);
	Отборы.Вставить("Организации",						Организации);
	Отборы.Вставить("Подразделения",					Подразделения);
	Отборы.Вставить("Продукция",						Продукция);
	Отборы.Вставить("ХарактеристикиПродукции",			ХарактеристикиПродукции);
	Отборы.Вставить("СерииПродукции",					СерииПродукции);
	Отборы.Вставить("НазначенияПродукции",				НазначенияПродукции);
	Отборы.Вставить("ПартииПродукции",					ПартииПродукции);
	Отборы.Вставить("АналитикиУчетаПартийПродукции",	АналитикиУчетаПартийПродукции);
	Отборы.Вставить("АналитикаУчетаЗатрата",			АналитикаУчетаЗатрата);
	Отборы.Вставить("Числитель",						0);
	Отборы.Вставить("Знаменатель",						0);
	Отборы.Вставить("ВалютаУправленческогоУчета",		Справочники.Валюты.ПустаяСсылка());
	Отборы.Вставить("АналитикаУчетаВыходноеИзделие",	Справочники.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка());
	Отборы.Вставить("СтатьяКалькуляции",				Справочники.СтатьиКалькуляции.ПустаяСсылка());
	Отборы.Вставить("КоличествоПродукции",				0);
	Отборы.Вставить("РазворачиватьДопРасходы",			Истина);
	Отборы.Вставить("ДатаИсходнойПартии",				'00010101');
	Отборы.Вставить("ВключитьНДСВСтоимость",			Ложь);
	Отборы.Вставить("ИсключитьНДСИзСтоимости",			Ложь);
	
	Возврат Отборы;
	
КонецФункции
	
#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Заполняет дерево себестоимости
//
// Параметры:
//  ПараметрыДерева	- см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
//  ПараметрыУзла - см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости
//
Процедура ЗаполнитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла)
	
	Запрос = ЗапросВыпущеннаяПродукция(ПараметрыУзла, Ложь);
	ВыпущеннаяПродукция = Запрос.Выполнить().Выгрузить();
	
	Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
		Результат = ПараметрыДерева.Результат.Строки;
	ИначеЕсли ПараметрыДерева.ТипРезультата = "ТаблицаЗначений" Тогда
		Результат = ПараметрыДерева.Результат;
	Иначе
		Результат = Новый ТаблицаЗначений;
		ИнициализироватьПоляДереваСебестоимости(Результат);
		ПоляТаблицы = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьИменаКолонокСтрокой(Результат, "Идентификатор");
		СчетчикТаблиц = 0;
		ИменаТаблиц = "";
	КонецЕсли;
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ПараметрыДерева.КоличествоСтрок = ПараметрыДерева.КоличествоСтрок + ВыпущеннаяПродукция.Количество();
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	Для Каждого ТекПартия Из ВыпущеннаяПродукция Цикл
		
		Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			ИЛИ ПараметрыДерева.ДобавлятьПолуфабрикатыВРезультат
			ИЛИ Не ТекПартия.ТребуетсяРазузлование Тогда
			СтрокаПартия = Результат.Добавить(); // СтрокаДереваЗначений
			ЗаполнитьЗначенияСвойств(СтрокаПартия, ТекПартия);
			
			СтрокаПартия.Идентификатор	= Новый УникальныйИдентификатор();
			СтрокаПартия.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияПродукции;
			
			СтрокаПартия.АналитикаУчетаВыходноеИзделие			= ТекПартия.АналитикаУчетаПродукции;
			СтрокаПартия.АналитикаУчетаПартийВыходноеИзделие	= ТекПартия.АналитикаУчетаПартийПродукции;
			СтрокаПартия.ПартияВыходноеИзделие					= ТекПартия.ПартияПродукции;
			
			СтрокаПартия.Номенклатура			= ТекПартия.Продукция;
			СтрокаПартия.Характеристика			= ТекПартия.ХарактеристикаПродукции;
			СтрокаПартия.Серия					= ТекПартия.СерияПродукции;
			СтрокаПартия.Назначение				= ТекПартия.НазначениеПродукции;
			СтрокаПартия.Валюта					= ТекПартия.Валюта;
			СтрокаПартия.Партия					= ТекПартия.ПартияПродукции;
			СтрокаПартия.АналитикаУчетаПартий	= ТекПартия.АналитикаУчетаПартийПродукции;
			СтрокаПартия.ЕдиницаИзмерения		= ТекПартия.ЕдиницаИзмеренияПродукция;
			
			СтрокаПартия.Количество	= ТекПартия.КоличествоПродукция;
			СтрокаПартия.Сумма		= ТекПартия.СуммаПродукция;
			СтрокаПартия.СуммаЗабалансовая = ТекПартия.СуммаПродукцияЗабалансовая;
		КонецЕсли;
		
		Если ТекПартия.ТребуетсяРазузлование
			И ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			И ПараметрыДерева.ДинамическоеСчитывание
			И ТекПартия.КоличествоПродукция <> 0 Тогда
			
			СтрокаПартия.Строки.Добавить();
			
		ИначеЕсли ТекПартия.ТребуетсяРазузлование
			И ТекПартия.КоличествоПродукция <> 0 Тогда //проверка на отсторнированный выпуск в выбранном периоде
			// общий подход к заполнению отбора параметров узла и условиям разузлования должен совпадать с:
			// - РазузловатьУзелДереваСебестоимости();
			// - Отчет.ДеревоСебестоимости.МодульОбъекта.ПолноеДеревоСебестоимостиПередРазворачиваниемСервер(). 
			ПараметрыУзлаПартии = СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости();
			
			Отборы = ПараметрыУзлаПартии.Отборы;
			Отборы.ДанныеПоСебестоимости = ПараметрыУзла.Отборы.ДанныеПоСебестоимости;
			Отборы.Продукция.Добавить(ТекПартия.Продукция);
			Отборы.ХарактеристикиПродукции.Добавить(ТекПартия.ХарактеристикаПродукции);
			Отборы.СерииПродукции.Добавить(ТекПартия.СерияПродукции);
			Отборы.НазначенияПродукции.Добавить(ТекПартия.НазначениеПродукции);
			Отборы.ПартииПродукции.Добавить(ТекПартия.ПартияПродукции);
			Отборы.АналитикиУчетаПартийПродукции.Добавить(ТекПартия.АналитикаУчетаПартийПродукции);
			// для знаменателя и количества продукции берем модуль значения, чтобы знак количества и сумм затрат определялся по числителю, который при выпуске будет > 0, а при сторно < 0
			Отборы.Числитель               = ТекПартия.Числитель;
			Отборы.Знаменатель             = Макс(-ТекПартия.Знаменатель, ТекПартия.Знаменатель);
			Отборы.КоличествоПродукции     = Макс(-ТекПартия.КоличествоПродукция,ТекПартия. КоличествоПродукция);
			Отборы.РазворачиватьДопРасходы = ПараметрыУзла.Отборы.РазворачиватьДопРасходы;
			Отборы.ДатаИсходнойПартии = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ТекПартия.ПартияПродукции, "Дата");
			Отборы.ДатаОкончания           = ПараметрыУзла.Отборы.ДатаОкончания;
			
			ПараметрыУзлаПартии.Сумма = ТекПартия.СуммаПродукция;
			ПараметрыУзлаПартии.Материальные = ТекПартия.Материальные;
			ПараметрыУзлаПартии.ДопРасходы = ТекПартия.ДопРасходы;
			ПараметрыУзлаПартии.Трудозатраты = ТекПартия.Трудозатраты;
			ПараметрыУзлаПартии.ПостатейныеПеременные = ТекПартия.ПостатейныеПеременные;
			ПараметрыУзлаПартии.ПостатейныеПостоянные = ТекПартия.ПостатейныеПостоянные;
			ПараметрыУзлаПартии.НалоговыйУчет = ТекПартия.НалоговыйУчет;
			ПараметрыУзлаПартии.ПостояннаяРазница = ТекПартия.ПостояннаяРазница;
			ПараметрыУзлаПартии.ВременнаяРазница = ТекПартия.ВременнаяРазница;
			ПараметрыУзлаПартии.СуммаЗабалансовая = ТекПартия.СуммаПродукцияЗабалансовая;
			
			ОписаниеПродукции = Новый Структура("АналитикаУчетаПродукции, ПартияПродукции, АналитикаУчетаПартийПродукции");
			ЗаполнитьЗначенияСвойств(ОписаниеПродукции, ТекПартия);
			ОписаниеПродукции.Вставить("Уровень", 0);
			
			Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
				ТаблицаРезультата = СтрокаПартия;
			Иначе
				ТаблицаРезультата = Результат;
			КонецЕсли;
			
			РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзлаПартии, ТаблицаРезультата, ОписаниеПродукции);
			
		КонецЕсли;
		
		Если ПараметрыДерева.ТипРезультата = "МенеджерВременныхТаблиц" Тогда
			СчетчикТаблиц = СчетчикТаблиц + 1;
			ИмяТекущейТаблицы = "Результат" + Формат(СчетчикТаблиц, "ЧГ=0;");
			РасчетСебестоимостиПрикладныеАлгоритмы.ПоместитьТаблицуЗначенийВоВременнуюТаблицу(
				ПараметрыДерева.Результат,
				ИмяТекущейТаблицы,
				Результат,
				ПоляТаблицы);
			ИменаТаблиц = ИменаТаблиц + ?(ПустаяСтрока(ИменаТаблиц), "", ",") + ИмяТекущейТаблицы;
			Результат.Очистить();
		КонецЕсли;
		
	КонецЦикла;
	
	Если ПараметрыДерева.ТипРезультата = "МенеджерВременныхТаблиц" Тогда
		Если НЕ ПустаяСтрока(ИменаТаблиц) Тогда
			РасчетСебестоимостиПрикладныеАлгоритмы.ОбъединитьВременныеТаблицы(
				ПараметрыДерева.Результат,
				ИменаТаблиц,
				"Результат",
				ПоляТаблицы, "", , Истина);
		Иначе
			Запрос = Новый Запрос;
			Запрос.МенеджерВременныхТаблиц = ПараметрыДерева.Результат;
			Запрос.Текст =
			"ВЫБРАТЬ
			|	*
			|ПОМЕСТИТЬ Результат
			|ИЗ
			|	&Результат КАК Результат";
			
			Результат.Колонки.Удалить("Идентификатор");
			Запрос.УстановитьПараметр("Результат", Результат);
			// Структуру ВТ Результат см. в СтруктураСебестоимости.СтруктураПолейДереваСебестоимости.
			Запрос.Выполнить();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзла, ТаблицаРезультата, ОписаниеПродукции)
	
	Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
		Результат = ТаблицаРезультата.Строки;
		Если ПараметрыДерева.ДинамическоеСчитывание Тогда
			Результат.Очистить();
		КонецЕсли;
	Иначе
		Результат = ТаблицаРезультата
	КонецЕсли;
	
	ПройденныйПуть = Неопределено;
	Если НЕ ПараметрыДерева.Свойство("ПройденныйПуть", ПройденныйПуть) Тогда
		ПройденныйПуть = Новый ТаблицаЗначений;
		ПройденныйПуть.Колонки.Добавить("Партия");
		ПройденныйПуть.Колонки.Добавить("АналитикаУчетаПартий");
		ПройденныйПуть.Индексы.Добавить("Партия, АналитикаУчетаПартий");
		ПараметрыДерева.Вставить("ПройденныйПуть", ПройденныйПуть);
	КонецЕсли;
	
	АналитикаУчетаПродукции			= ОписаниеПродукции.АналитикаУчетаПродукции;
	ПартияПродукции					= ОписаниеПродукции.ПартияПродукции;
	АналитикаУчетаПартийПродукции	= ОписаниеПродукции.АналитикаУчетаПартийПродукции;
	УровеньУзла						= ОписаниеПродукции.Уровень + 1;
	
	ВыводитьДопРасходы = ПараметрыУзла.Отборы.РазворачиватьДопРасходы И НЕ (УровеньУзла = 1);
	СебестоимостьУзла = СебестоимостьУзла(ПараметрыДерева, ПараметрыУзла, ВыводитьДопРасходы);
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ПараметрыДерева.КоличествоСтрок = ПараметрыДерева.КоличествоСтрок + СебестоимостьУзла.Количество();
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	ЭтоРазузлованиеДопРасходов = Ложь;
	Для Каждого ТекПартия Из СебестоимостьУзла Цикл
		
		Если ТекПартия.ТребуетсяРазузлование И ТекПартия.КоличествоЗатрата <> 0 Тогда
			ПараметрыОтбора = Новый Структура("Партия, АналитикаУчетаПартий",
				ТекПартия.ПартияЗатрата,
				ТекПартия.АналитикаУчетаПартийЗатрата);
			МассивСтрок = ПройденныйПуть.НайтиСтроки(ПараметрыОтбора);
		Иначе
			МассивСтрок = Новый Массив;
		КонецЕсли;
		
		Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			ИЛИ ПараметрыДерева.ДобавлятьПолуфабрикатыВРезультат
			ИЛИ Не ТекПартия.ТребуетсяРазузлование Тогда

			СтрокаПартия = Результат.Добавить(); // СтрокаДереваЗначений
			ЗаполнитьЗначенияСвойств(СтрокаПартия, ТекПартия);
			
			СтрокаПартия.Идентификатор	= Новый УникальныйИдентификатор();
			Если ТекПартия.ТребуетсяРазузлование
			 И Окр(ТекПартия.КоличествоЗатрата, 3) <> 0
			 И (ТекПартия.СуммаЗатрата <> 0 Или ТекПартия.СуммаЗатратаЗабалансовая <> 0)
			 И МассивСтрок.Количество() = 0 Тогда
				
				СтрокаПартия.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияПолуфабриката;
				СтрокаПартия.Числитель 		= ТекПартия.КоличествоЗатрата;
				
			Иначе
				СтрокаПартия.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияЗатраты;
				СтрокаПартия.ТребуетсяРазузлование = Ложь;
			КонецЕсли;
			
			СтрокаПартия.АналитикаУчетаПродукции		= АналитикаУчетаПродукции;
			СтрокаПартия.ПартияПродукции				= ПартияПродукции;
			СтрокаПартия.АналитикаУчетаПартийПродукции	= АналитикаУчетаПартийПродукции;
			
			СтрокаПартия.Номенклатура			= ТекПартия.Затрата;
			СтрокаПартия.Характеристика			= ТекПартия.ХарактеристикаЗатрата;
			СтрокаПартия.Серия					= ТекПартия.СерияЗатрата;
			СтрокаПартия.Назначение				= ТекПартия.НазначениеЗатрата;
			СтрокаПартия.Партия					= ТекПартия.ПартияЗатрата;
			СтрокаПартия.АналитикаУчетаПартий	= ТекПартия.АналитикаУчетаПартийЗатрата;
			СтрокаПартия.ЕдиницаИзмерения		= ТекПартия.ЕдиницаИзмеренияЗатрата;
			СтрокаПартия.Уровень				= УровеньУзла;
			
			СтрокаПартия.Количество			= ТекПартия.КоличествоЗатрата;
			СтрокаПартия.Сумма				= Окр(ТекПартия.СуммаЗатрата - ТекПартия.ВключениеИсключениеНДСВСтоимости, 2);
			СтрокаПартия.ДопРасходы			= Окр(СтрокаПартия.ДопРасходы, 2);
			СтрокаПартия.НалоговыйУчет		= Окр(СтрокаПартия.НалоговыйУчет - ТекПартия.ВключениеИсключениеНДСВСтоимости, 2);
			СтрокаПартия.СуммаЗабалансовая	= ТекПартия.СуммаЗатратаЗабалансовая;
			СтрокаПартия.Материальные		= СтрокаПартия.Материальные - ТекПартия.ВключениеИсключениеНДСВСтоимости;
			
			// Уменьшаем суммовые показатели в узле на разузлованные суммы. 
			// На оставшиеся суммы будет сформирована отдельная строка для отражения расхождения стоимости с детализацией.
			Если ПараметрыУзла.Сумма <> 0 Или ПараметрыУзла.СуммаЗабалансовая <> 0 Тогда
				ПараметрыУзла.Сумма = ПараметрыУзла.Сумма - СтрокаПартия.Сумма - ТекПартия.ВключениеИсключениеНДСВСтоимости;
				ПараметрыУзла.Материальные = ПараметрыУзла.Материальные - СтрокаПартия.Материальные - ТекПартия.ВключениеИсключениеНДСВСтоимости;
				ПараметрыУзла.ДопРасходы = ПараметрыУзла.ДопРасходы - СтрокаПартия.ДопРасходы;
				ПараметрыУзла.Трудозатраты = ПараметрыУзла.Трудозатраты - СтрокаПартия.Трудозатраты;
				ПараметрыУзла.ПостатейныеПеременные = ПараметрыУзла.ПостатейныеПеременные - СтрокаПартия.ПостатейныеПеременные;
				ПараметрыУзла.ПостатейныеПостоянные = ПараметрыУзла.ПостатейныеПостоянные - СтрокаПартия.ПостатейныеПостоянные;
				ПараметрыУзла.НалоговыйУчет = ПараметрыУзла.НалоговыйУчет - СтрокаПартия.НалоговыйУчет - ТекПартия.ВключениеИсключениеНДСВСтоимости;
				ПараметрыУзла.ПостояннаяРазница = ПараметрыУзла.ПостояннаяРазница - СтрокаПартия.ПостояннаяРазница;
				ПараметрыУзла.ВременнаяРазница = ПараметрыУзла.ВременнаяРазница - СтрокаПартия.ВременнаяРазница;
				ПараметрыУзла.СуммаЗабалансовая = ПараметрыУзла.СуммаЗабалансовая - СтрокаПартия.СуммаЗабалансовая;
				
				ЭтоРазузлованиеДопРасходов = (ТекПартия.ТипЗатрат = "ДопРасходы");
			КонецЕсли;
		КонецЕсли;
		
		Если ТекПартия.ТребуетсяРазузлование
			И ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			И ПараметрыДерева.ДинамическоеСчитывание Тогда
			СтрокаПартия.Строки.Добавить();
		ИначеЕсли ТекПартия.ТребуетсяРазузлование
		 И Окр(ТекПартия.КоличествоЗатрата, 3) <> 0
		 И (ТекПартия.СуммаЗатрата <> 0 Или ТекПартия.СуммаЗатратаЗабалансовая <> 0)
		 И МассивСтрок.Количество() = 0
		 ИЛИ ТекПартия.ТребуетсяРазузлованиеДопРасходов
		 И Окр(ТекПартия.КоличествоЗатрата, 3) <> 0
		 И ТекПартия.ДопРасходы <> 0 Тогда
			// общий подход к заполнению отбора параметров узла и условиям разузлования должен совпадать с:
			// - ЗаполнитьДеревоСебестоимости();
			// - Отчет.ДеревоСебестоимости.МодульОбъекта.ПолноеДеревоСебестоимостиПередРазворачиваниемСервер(). 
			ПараметрыУзлаПартии = СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости();
			
			Если НЕ ТекПартия.ТребуетсяРазузлованиеДопРасходов Тогда
				НовыйПуть = ПройденныйПуть.Добавить();
				НовыйПуть.Партия = ТекПартия.ПартияЗатрата;
				НовыйПуть.АналитикаУчетаПартий = ТекПартия.АналитикаУчетаПартийЗатрата;
			КонецЕсли;
			
			Отборы = ПараметрыУзлаПартии.Отборы;
			Отборы.ДанныеПоСебестоимости = ПараметрыУзла.Отборы.ДанныеПоСебестоимости;
			Отборы.Продукция.Добавить(ТекПартия.Затрата);
			Отборы.ХарактеристикиПродукции.Добавить(ТекПартия.ХарактеристикаЗатрата);
			Отборы.СерииПродукции.Добавить(ТекПартия.СерияЗатрата);
			// При разузловании полуфабрикатов отбор по назначению не нужен, т.к. полуфабрикат может быть выпущен без назначения или
			// с указанием другого назначения.
			Отборы.ПартииПродукции.Добавить(ТекПартия.ПартияЗатрата);
			Отборы.АналитикиУчетаПартийПродукции.Добавить(ТекПартия.АналитикаУчетаПартийЗатрата);
			Отборы.АналитикаУчетаЗатрата.Добавить(ТекПартия.АналитикаУчетаЗатрата);
			// для знаменателя и количества продукции берем модуль значения, чтобы знак количества и сумм затрат определялся по числителю, который при выпуске будет > 0, а при сторно < 0
			Отборы.Числитель               = ТекПартия.КоличествоЗатрата;
			Отборы.КоличествоПродукции     = Макс(-ТекПартия.КоличествоЗатрата, ТекПартия.КоличествоЗатрата);
			Отборы.РазворачиватьДопРасходы = ПараметрыУзла.Отборы.РазворачиватьДопРасходы;
			Отборы.ДатаИсходнойПартии      = ПараметрыУзла.Отборы.ДатаИсходнойПартии;
			Отборы.ДатаОкончания           = ПараметрыУзла.Отборы.ДатаОкончания;
			
			Отборы.ВключитьНДСВСтоимость   = ТекПартия.ВключитьНДСВСтоимость;
			Отборы.ИсключитьНДСИзСтоимости = ТекПартия.ИсключитьНДСИзСтоимости;
			Отборы.АналитикаУчетаВыходноеИзделие = ТекПартия.АналитикаУчетаЗатрата;
			Отборы.СтатьяКалькуляции       = ТекПартия.СтатьяКалькуляции;
			
			Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
				ТаблицаРезультатаПартии = СтрокаПартия;
			Иначе
				ТаблицаРезультатаПартии = Результат;
			КонецЕсли;
			
			Если НЕ ТекПартия.ТребуетсяРазузлованиеДопРасходов Тогда
				ПараметрыУзлаПартии.Сумма = СтрокаПартия.Сумма;
				ПараметрыУзлаПартии.Материальные = СтрокаПартия.Материальные;
				ПараметрыУзлаПартии.ДопРасходы = СтрокаПартия.ДопРасходы;
				ПараметрыУзлаПартии.Трудозатраты = СтрокаПартия.Трудозатраты;
				ПараметрыУзлаПартии.ПостатейныеПеременные = СтрокаПартия.ПостатейныеПеременные;
				ПараметрыУзлаПартии.ПостатейныеПостоянные = СтрокаПартия.ПостатейныеПостоянные;
				ПараметрыУзлаПартии.НалоговыйУчет = СтрокаПартия.НалоговыйУчет;
				ПараметрыУзлаПартии.ПостояннаяРазница = СтрокаПартия.ПостояннаяРазница;
				ПараметрыУзлаПартии.ВременнаяРазница = СтрокаПартия.ВременнаяРазница;
				ПараметрыУзлаПартии.СуммаЗабалансовая = СтрокаПартия.СуммаЗабалансовая;
			КонецЕсли;
			
			ОписаниеПродукции.Вставить("Уровень", УровеньУзла);
			Если ПараметрыДерева.ТипРезультата = "МенеджерВременныхТаблиц" Тогда
				КоличествоСтрокРезультата = ТаблицаРезультатаПартии.Количество();
			КонецЕсли;
			РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзлаПартии, ТаблицаРезультатаПартии, ОписаниеПродукции);
			
			// Если разозлование доп расходов не выполнено, снимем признак ТребуетсяРазузлованиеДопРасходов.
			Если ПараметрыДерева.ТипРезультата = "МенеджерВременныхТаблиц"
			 И ТекПартия.ТребуетсяРазузлованиеДопРасходов
			 И КоличествоСтрокРезультата = ТаблицаРезультатаПартии.Количество() Тогда
			 	СтрокаПартия.ТребуетсяРазузлованиеДопРасходов = Ложь;
			КонецЕсли;
		КонецЕсли;
		
		// Удалим строку, по которой уже выполнено разузлование.
		Если ТекПартия.ТребуетсяРазузлование
		 И Окр(ТекПартия.КоличествоЗатрата, 3) <> 0
		 И ТекПартия.СуммаЗатрата <> 0 Тогда
			ПараметрыОтбора = Новый Структура("Партия, АналитикаУчетаПартий",
				ТекПартия.ПартияЗатрата,
				ТекПартия.АналитикаУчетаПартийЗатрата);
			МассивСтрок = ПройденныйПуть.НайтиСтроки(ПараметрыОтбора);
			Для Каждого СтрокаКУдалению Из МассивСтрок Цикл
				ПройденныйПуть.Удалить(СтрокаКУдалению);
			КонецЦикла;
		КонецЕсли;
		
		// Сумму включения/исключения НДС, в рамках регл. учета, добавляем отдельной строкой.
		Если ТекПартия.ВключениеИсключениеНДСВСтоимости <> 0 Тогда
			СтрокаПартия = Результат.Добавить(); // СтрокаДереваЗначений
			ЗаполнитьЗначенияСвойств(СтрокаПартия, ТекПартия);
			СтрокаПартия.Идентификатор	= Новый УникальныйИдентификатор;
			СтрокаПартия.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияЗатраты;
			СтрокаПартия.ТребуетсяРазузлование = Ложь;

			СтрокаПартия.АналитикаУчетаПродукции		= АналитикаУчетаПродукции;
			СтрокаПартия.ПартияПродукции				= ПартияПродукции;
			СтрокаПартия.АналитикаУчетаПартийПродукции	= АналитикаУчетаПартийПродукции;

			СтрокаПартия.Номенклатура	= НСтр("ru = 'Включение / Исключение НДС в стоимости';
												|en = 'Включение / Исключение НДС в стоимости'");
			СтрокаПартия.Уровень		= УровеньУзла;

			СтрокаПартия.Количество			= 0;
			СтрокаПартия.Сумма				= ТекПартия.ВключениеИсключениеНДСВСтоимости;
			СтрокаПартия.Материальные		= ТекПартия.ВключениеИсключениеНДСВСтоимости;
			СтрокаПартия.ДопРасходы			= 0;
			СтрокаПартия.Трудозатраты		= 0;
			СтрокаПартия.ПостояннаяРазница	= 0;
			СтрокаПартия.ВременнаяРазница	= 0;
			СтрокаПартия.НалоговыйУчет		= ТекПартия.ВключениеИсключениеНДСВСтоимости;
			СтрокаПартия.СуммаЗабалансовая	= 0;
		КонецЕсли;
	КонецЦикла;

	// При наличии данных о разузловании добавим строку на суммы изменения стоимости.
	Если СебестоимостьУзла.Количество() > 0 И НЕ ЭтоРазузлованиеДопРасходов Тогда
		УчестьИзменениеСтоимости(ПараметрыУзла, ОписаниеПродукции, Результат);
	КонецЕсли;
	
КонецПроцедуры

Процедура УчестьИзменениеСтоимости(ПараметрыУзла, ОписаниеПродукции, Результат)
		
	Если ПараметрыУзла.Сумма <> 0
	 ИЛИ ПараметрыУзла.НалоговыйУчет <> 0
	 ИЛИ ПараметрыУзла.СуммаЗабалансовая <> 0 Тогда
		
		// Если сумма дополнительных расходов отличается от суммы доп расходов, полученных при разузловании
		// без изменения стоимости материальных затрат, необходимо отразить разницу отдельной 
		// строкой "Изменение стоимости при хранении".
		Если Окр(ПараметрыУзла.Сумма, 2) <> 0 И Окр(ПараметрыУзла.Сумма, 2) = Окр(ПараметрыУзла.ДопРасходы, 2) Тогда
			
			НоваяСтрока = Результат.Добавить();
			
			НоваяСтрока.Идентификатор	= Новый УникальныйИдентификатор();
			НоваяСтрока.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияЗатраты;
			НоваяСтрока.ТребуетсяРазузлование = Ложь;
			
			НоваяСтрока.Номенклатура = НСтр("ru = 'Изменение стоимости при хранении';
											|en = 'Cost change at storage'");
			
			НоваяСтрока.АналитикаУчетаВыходноеИзделие		= ОписаниеПродукции.АналитикаУчетаПродукции;
			НоваяСтрока.АналитикаУчетаПартийВыходноеИзделие	= ОписаниеПродукции.АналитикаУчетаПартийПродукции;
			НоваяСтрока.ПартияВыходноеИзделие				= ОписаниеПродукции.ПартияПродукции;
			
			НоваяСтрока.АналитикаУчетаПродукции		= ОписаниеПродукции.АналитикаУчетаПродукции;
			НоваяСтрока.ПартияПродукции				= ОписаниеПродукции.ПартияПродукции;
			НоваяСтрока.АналитикаУчетаПартийПродукции	= ОписаниеПродукции.АналитикаУчетаПартийПродукции;
			НоваяСтрока.Уровень						= ОписаниеПродукции.Уровень + 1;
			
			НоваяСтрока.ДопРасходы = ПараметрыУзла.ДопРасходы;
			НоваяСтрока.Сумма = ПараметрыУзла.ДопРасходы;
			НоваяСтрока.НалоговыйУчет = ПараметрыУзла.НалоговыйУчет;
			
		КонецЕсли;
		
		// Для материальных расходов в незавершенном производстве может быть усреднение стоимости, 
		// т.к. после распределения на партию производства исходная партия теряется и в НЗП стоимость
		// складывается из всех партий одного материала. Поэтому при разузловании возможно расхождение
		// между суммой, рассчитанной по партиям, и рассчитанной себестоимостью расхода из незавершенного
		// производства на выпуск продукции. Такое расхождение будет отражено отдельной 
		// строкой "Усреднение стоимости в незавершенном производстве".
		Если Окр(ПараметрыУзла.Сумма, 2) <> 0 И Окр(ПараметрыУзла.Сумма, 2) <> Окр(ПараметрыУзла.ДопРасходы, 2) Тогда
			
			НоваяСтрока = Результат.Добавить();
			
			НоваяСтрока.Идентификатор	= Новый УникальныйИдентификатор();
			НоваяСтрока.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияЗатраты;
			НоваяСтрока.ТребуетсяРазузлование = Ложь;
			
			НоваяСтрока.Номенклатура = НСтр("ru = 'Усреднение стоимости в незавершенном производстве';
											|en = 'Cost averaging in work-in-progress'");
			
			НоваяСтрока.АналитикаУчетаВыходноеИзделие		= ОписаниеПродукции.АналитикаУчетаПродукции;
			НоваяСтрока.АналитикаУчетаПартийВыходноеИзделие	= ОписаниеПродукции.АналитикаУчетаПартийПродукции;
			НоваяСтрока.ПартияВыходноеИзделие				= ОписаниеПродукции.ПартияПродукции;
			
			НоваяСтрока.АналитикаУчетаПродукции		= ОписаниеПродукции.АналитикаУчетаПродукции;
			НоваяСтрока.ПартияПродукции				= ОписаниеПродукции.ПартияПродукции;
			НоваяСтрока.АналитикаУчетаПартийПродукции	= ОписаниеПродукции.АналитикаУчетаПартийПродукции;
			НоваяСтрока.Уровень						= ОписаниеПродукции.Уровень + 1;
			
			НоваяСтрока.Материальные = ПараметрыУзла.Материальные;
			НоваяСтрока.ДопРасходы = ПараметрыУзла.ДопРасходы;
			НоваяСтрока.Трудозатраты = ПараметрыУзла.Трудозатраты;
			НоваяСтрока.Сумма = ПараметрыУзла.Сумма;
			НоваяСтрока.НалоговыйУчет = ПараметрыУзла.НалоговыйУчет;
			НоваяСтрока.ПостояннаяРазница = ПараметрыУзла.ПостояннаяРазница;
			НоваяСтрока.ВременнаяРазница = ПараметрыУзла.ВременнаяРазница;
			НоваяСтрока.СуммаЗабалансовая = ПараметрыУзла.СуммаЗабалансовая;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Функция СебестоимостьУзла(ПараметрыДерева, ПараметрыУзла, ВыводитьДопРасходы)
	
	Запрос = ЗапросВыпущеннаяПродукция(ПараметрыУзла, Истина);
	Запрос.Текст = Запрос.Текст
					+ ТекстЗапросаЗатратыНаПродукцию(ВыводитьДопРасходы);
	Результат = Запрос.Выполнить();
	
	Возврат Результат.Выгрузить();
	
КонецФункции

Функция ТекстЗапросаЗатратыНаПродукцию(ВыводитьДопРасходы)
	
	ТекстыЗапроса = Новый Массив;
	
#Область ТекстМатериальныеЗатраты

	#Область ВыбытиеИзНЗППоПродукции
	ТекстМатериальныеЗатраты =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ) КАК Период,
		|	ВыпущеннаяПродукция.Организация КАК Организация,
		|	ВыпущеннаяПродукция.ПартияПродукции КАК ПартияПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции КАК АналитикаУчетаПартийПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПродукции КАК АналитикаУчетаПродукции,
		|	МАКСИМУМ(ВыпущеннаяПродукция.Числитель) КАК Числитель,
		|	МАКСИМУМ(ВыпущеннаяПродукция.Знаменатель) КАК Знаменатель,
		|	СебестоимостьТоваров.Партия КАК Партия,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.ВидЗапасов КАК ВидЗапасов,
		|	СУММА(СебестоимостьТоваров.Количество) КАК Количество,
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|				+ СебестоимостьТоваров.ТрудозатратыУпр
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|				+ СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьНДД
		|			ИНАЧЕ 0
		|		КОНЕЦ)												КАК НДД,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	СУММА(СебестоимостьТоваров.СтоимостьУпр)				КАК МатериальныеУпр,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыУпр)				КАК ТрудозатратыУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеУпр)	КАК ПостатейныеПостоянныеУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеУпр)	КАК ПостатейныеПеременныеУпр,
		|	СУММА(СебестоимостьТоваров.ДопРасходыУпр)				КАК ДопРасходыУпр,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансовая)		КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл
		|		+ СебестоимостьТоваров.ТрудозатратыРегл
		|		+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		+ СебестоимостьТоваров.ДопРасходыРегл
		|		- СебестоимостьТоваров.ПостояннаяРазница
		|		- СебестоимостьТоваров.ВременнаяРазница)			КАК НалоговыйУчет,
		|	СУММА(СебестоимостьТоваров.ПостояннаяРазница)			КАК ПостояннаяРазница,
		|	СУММА(СебестоимостьТоваров.ВременнаяРазница)			КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ ВыбытиеИзНЗППоПродукции
		|ИЗ
		|	ВыпущеннаяПродукция КАК ВыпущеннаяПродукция
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ПО СебестоимостьТоваров.Организация = ВыпущеннаяПродукция.Организация
		|			И ВыпущеннаяПродукция.ПартияПродукции = СебестоимостьТоваров.Регистратор
		|			И ВыпущеннаяПродукция.АналитикаУчетаПродукции = СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры
		|			И ВыпущеннаяПродукция.ПартияПродукции = СебестоимостьТоваров.КорПартия
		|			И ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции = СебестоимостьТоваров.КорАналитикаУчетаПартий
		|			И (СебестоимостьТоваров.Период <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|ГДЕ
		|	СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Партия) = ТИП(Справочник.ПартииПроизводства)
		|	И НЕ СебестоимостьТоваров.Партия = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	ВыпущеннаяПродукция.Организация,
		|	ВыпущеннаяПродукция.ПартияПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПродукции,
		|	СебестоимостьТоваров.Партия,
		|	СебестоимостьТоваров.ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти

	#Область ВыбывшиеЗатратыСводно
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Т.Организация КАК Организация,
		|	МАКСИМУМ(Т.Период) КАК Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия
		|ПОМЕСТИТЬ ВыбывшиеЗатратыСводно
		|ИЗ
		|	ВыбытиеИзНЗППоПродукции КАК Т
		|ГДЕ
		|	Т.Количество <> 0
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ПартииПроизводства
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Партия КАК Партия
		|ПОМЕСТИТЬ ПартииПроизводства
		|ИЗ
		|	ВыбывшиеЗатратыСводно КАК Т
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ВыбытиеИзНЗП
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Т.Организация КАК Организация,
		|	НАЧАЛОПЕРИОДА(Т.Период, МЕСЯЦ) КАК Период,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия,
		|	СУММА(Т.КоличествоРасход) КАК Количество
		|ПОМЕСТИТЬ ВыбытиеИзНЗП
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Обороты(,, МЕСЯЦ,
		|		Партия В (
		|			ВЫБРАТЬ
		|				Т.Партия
		|			ИЗ
		|				ПартииПроизводства КАК Т)
		|		И (АналитикаУчетаНоменклатуры, Организация) В (
		|			ВЫБРАТЬ
		|				Выбытие.АналитикаУчетаНоменклатуры,
		|				Выбытие.Организация КАК Организация
		|			ИЗ
		|				ВыбывшиеЗатратыСводно КАК Выбытие)
		|	) КАК Т
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|	ПО Т.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|		И Т.Партия = Выбытие.Партия
		|			
		|ГДЕ
		|	Т.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	НАЧАЛОПЕРИОДА(Т.Период, МЕСЯЦ),
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ПервичныеПартииВНЗП
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ) КАК Период,
		|	СебестоимостьТоваров.Организация					КАК Организация,
		|	СебестоимостьТоваров.ВидЗапасов						КАК ВидЗапасов,
		// Аналитика первичной партии.
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры 	КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий 			КАК АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Партия 						КАК Партия,
		// Аналитка в НЗП.
		|	СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры 	КАК КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.КорПартия						КАК КорПартия,
		|
		|	МАКСИМУМ(ВЫБОР
		|		КОГДА СебестоимостьТоваров.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСНеУчитываетсяВСтоимости)
		|		 И СебестоимостьТоваров.КорВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК ВключитьНДСВСтоимость,
		|	МАКСИМУМ(ВЫБОР
		|		КОГДА СебестоимостьТоваров.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
		|		 И СебестоимостьТоваров.КорВидДеятельностиНДС В (&ТипыНалогообложенияНДСНеУчитываетсяВСтоимости)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК ИсключитьНДСИзСтоимости,
		
		|	СУММА(СебестоимостьТоваров.Количество) 				КАК Количество,
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|				+ СебестоимостьТоваров.ТрудозатратыУпр
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|				+ СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьНДД
		|			ИНАЧЕ 0
		|		КОНЕЦ)												КАК НДД,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	СУММА(СебестоимостьТоваров.СтоимостьУпр)				КАК МатериальныеУпр,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыУпр)				КАК ТрудозатратыУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеУпр)	КАК ПостатейныеПостоянныеУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеУпр)	КАК ПостатейныеПеременныеУпр,
		|	СУММА(СебестоимостьТоваров.ДопРасходыУпр)				КАК ДопРасходыУпр,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансовая)		КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл
		|		+ СебестоимостьТоваров.ТрудозатратыРегл
		|		+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		+ СебестоимостьТоваров.ДопРасходыРегл
		|		- СебестоимостьТоваров.ПостояннаяРазница
		|		- СебестоимостьТоваров.ВременнаяРазница)			КАК НалоговыйУчет,
		|	СУММА(СебестоимостьТоваров.ПостояннаяРазница)			КАК ПостояннаяРазница,
		|	СУММА(СебестоимостьТоваров.ВременнаяРазница)			КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ ПервичныеПартииВНЗП
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводства КАК ПП
		|		ПО СебестоимостьТоваров.КорПартия = ПП.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|		ПО СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|			И СебестоимостьТоваров.КорПартия = Выбытие.Партия
		|			И СебестоимостьТоваров.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|			И СебестоимостьТоваров.Организация = Выбытие.Организация
		|ГДЕ
		|	СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И НЕ Выбытие.АналитикаУчетаНоменклатуры ЕСТЬ NULL
		|	И (СебестоимостьТоваров.Период <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.Организация,
		|	СебестоимостьТоваров.ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Партия,
		|	СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.КорПартия
		|
		|ИМЕЮЩИЕ СУММА(СебестоимостьТоваров.Количество) > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Фикс. стоимость
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ)	КАК Период,
		|	СебестоимостьТоваров.Организация					КАК Организация,
		|	СебестоимостьТоваров.ВидЗапасов						КАК ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры 	КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий 			КАК АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор					КАК Партия,
		
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры		КАК КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия							КАК КорПартия,
		|	ЛОЖЬ												КАК ВключитьНДСВСтоимость,
		|	ЛОЖЬ												КАК ИсключитьНДСИзСтоимости,
		
		|	СУММА(СебестоимостьТоваров.Количество),
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|				+ СебестоимостьТоваров.ТрудозатратыУпр
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|				+ СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьНДД
		|			ИНАЧЕ 0
		|		КОНЕЦ)												КАК НДД,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	СУММА(СебестоимостьТоваров.СтоимостьУпр)				КАК МатериальныеУпр,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыУпр)				КАК ТрудозатратыУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеУпр)	КАК ПостатейныеПостоянныеУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеУпр)	КАК ПостатейныеПеременныеУпр,
		|	СУММА(СебестоимостьТоваров.ДопРасходыУпр)				КАК ДопРасходыУпр,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансовая)		КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл
		|		+ СебестоимостьТоваров.ТрудозатратыРегл
		|		+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		+ СебестоимостьТоваров.ДопРасходыРегл
		|		- СебестоимостьТоваров.ПостояннаяРазница
		|		- СебестоимостьТоваров.ВременнаяРазница)			КАК НалоговыйУчет,
		|	СУММА(СебестоимостьТоваров.ПостояннаяРазница)			КАК ПостояннаяРазница,
		|	СУММА(СебестоимостьТоваров.ВременнаяРазница)			КАК ВременнаяРазница
		|
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводства КАК ПП
		|		ПО СебестоимостьТоваров.Партия = ПП.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|		ПО СебестоимостьТоваров.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|			И СебестоимостьТоваров.Партия = Выбытие.Партия
		|			И СебестоимостьТоваров.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|			И СебестоимостьТоваров.Организация = Выбытие.Организация
		|ГДЕ
		|	СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
		|	И СебестоимостьТоваров.Количество < 0
		|	И НЕ Выбытие.АналитикаУчетаНоменклатуры ЕСТЬ NULL
		|	И (СебестоимостьТоваров.Период <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.Организация,
		|	СебестоимостьТоваров.ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		|	СебестоимостьТоваров.Партия
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Услуги переработчика
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ)	КАК Период,
		|	СебестоимостьТоваров.Организация					КАК Организация,
		|	СебестоимостьТоваров.ВидЗапасов						КАК ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры		КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий			КАК АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор					КАК Партия,
		
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры		КАК КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия							КАК КорПартия,
		|	ЛОЖЬ												КАК ВключитьНДСВСтоимость,
		|	ЛОЖЬ												КАК ИсключитьНДСИзСтоимости,
		
		|	СУММА(СебестоимостьТоваров.Количество),
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|				+ СебестоимостьТоваров.ТрудозатратыУпр
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|				+ СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьНДД
		|			ИНАЧЕ 0
		|		КОНЕЦ)												КАК НДД,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	СУММА(СебестоимостьТоваров.СтоимостьУпр)				КАК МатериальныеУпр,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыУпр)				КАК ТрудозатратыУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеУпр)	КАК ПостатейныеПостоянныеУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеУпр)	КАК ПостатейныеПеременныеУпр,
		|	СУММА(СебестоимостьТоваров.ДопРасходыУпр)				КАК ДопРасходыУпр,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансовая)		КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл
		|		+ СебестоимостьТоваров.ТрудозатратыРегл
		|		+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		+ СебестоимостьТоваров.ДопРасходыРегл
		|		- СебестоимостьТоваров.ПостояннаяРазница
		|		- СебестоимостьТоваров.ВременнаяРазница)			КАК НалоговыйУчет,
		|	СУММА(СебестоимостьТоваров.ПостояннаяРазница)			КАК ПостояннаяРазница,
		|	СУММА(СебестоимостьТоваров.ВременнаяРазница)			КАК ВременнаяРазница
		|
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводства КАК ПП
		|		ПО СебестоимостьТоваров.Партия = ПП.Партия
		|	
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|	ПО СебестоимостьТоваров.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|	И СебестоимостьТоваров.Партия = Выбытие.Партия
		|	И СебестоимостьТоваров.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|	И СебестоимостьТоваров.Организация = Выбытие.Организация
		|ГДЕ
		|	ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) В(
		//++ Устарело_Переработка24
		|		ТИП(Документ.ОтчетПереработчика),
		//-- Устарело_Переработка24
		|		ТИП(Документ.ОтчетПереработчика2_5))
		|	И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|	И СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|	И (СебестоимостьТоваров.Период <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.Организация,
		|	СебестоимостьТоваров.ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		|	СебестоимостьТоваров.Партия
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Начальные остатки
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ)	КАК Период,
		|	СебестоимостьТоваров.Организация					КАК Организация,
		|	СебестоимостьТоваров.ВидЗапасов						КАК ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры		КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий			КАК АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор					КАК Партия,
		
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры		КАК КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия							КАК КорПартия,
		|	ЛОЖЬ												КАК ВключитьНДСВСтоимость,
		|	ЛОЖЬ												КАК ИсключитьНДСИзСтоимости,
		
		|	СУММА(СебестоимостьТоваров.Количество),
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|				+ СебестоимостьТоваров.ТрудозатратыУпр
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеУпр
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеУпр
		|				+ СебестоимостьТоваров.ДопРасходыУпр
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА СебестоимостьТоваров.СтоимостьНДД
		|			ИНАЧЕ 0
		|		КОНЕЦ)												КАК НДД,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	СУММА(СебестоимостьТоваров.СтоимостьУпр)				КАК МатериальныеУпр,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыУпр)				КАК ТрудозатратыУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеУпр)	КАК ПостатейныеПостоянныеУпр,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеУпр)	КАК ПостатейныеПеременныеУпр,
		|	СУММА(СебестоимостьТоваров.ДопРасходыУпр)				КАК ДопРасходыУпр,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансовая)		КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл
		|		+ СебестоимостьТоваров.ТрудозатратыРегл
		|		+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		+ СебестоимостьТоваров.ДопРасходыРегл
		|		- СебестоимостьТоваров.ПостояннаяРазница
		|		- СебестоимостьТоваров.ВременнаяРазница)			КАК НалоговыйУчет,
		|	СУММА(СебестоимостьТоваров.ПостояннаяРазница)			КАК ПостояннаяРазница,
		|	СУММА(СебестоимостьТоваров.ВременнаяРазница)			КАК ВременнаяРазница
		|
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводства КАК ПП
		|		ПО СебестоимостьТоваров.Партия = ПП.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|		ПО СебестоимостьТоваров.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|			И СебестоимостьТоваров.Партия = Выбытие.Партия
		|			И СебестоимостьТоваров.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|			И СебестоимостьТоваров.Организация = Выбытие.Организация
		|ГДЕ
		|	СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковЗатратПартийПроизводства)
		|	И НЕ Выбытие.АналитикаУчетаНоменклатуры ЕСТЬ NULL
		|	И (СебестоимостьТоваров.Период <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.Организация,
		|	СебестоимостьТоваров.ВидЗапасов,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		|	СебестоимостьТоваров.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ДетализацияПартий
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	СебестоимостьТоваров.Организация					КАК Организация,
		|	СебестоимостьТоваров.Период							КАК Период,
		// Аналитика первичной партии.
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры 	КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий 			КАК АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Партия 						КАК Партия,
		// Аналитка в НЗП.
		|	СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры 	КАК КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.КорПартия						КАК КорПартия,
		|
		|	ВЫРАЗИТЬ(СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости <> 3 ТОГДА 0
		|		КОГДА СебестоимостьТоваров.ВключитьНДСВСтоимость
		|			ТОГДА (ЕСТЬNULL(Детализация.НДСУпр, 0) + ЕСТЬNULL(ДетализацияПостатейные.НДСУпр, 0))
		|				* СебестоимостьТоваров.Количество
		|		КОГДА СебестоимостьТоваров.ИсключитьНДСИзСтоимости
		|			ТОГДА (ЕСТЬNULL(-Детализация.НДСУпр, 0) + ЕСТЬNULL(-ДетализацияПостатейные.НДСУпр, 0))
		|				* СебестоимостьТоваров.Количество
		|		ИНАЧЕ 0 КОНЕЦ) КАК ЧИСЛО(31,2)) КАК НДСУпр,
		|	ВЫРАЗИТЬ(СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости <> 4 ТОГДА 0
		|		КОГДА СебестоимостьТоваров.ВключитьНДСВСтоимость
		|			ТОГДА (ЕСТЬNULL(Детализация.НДСРегл, 0) + ЕСТЬNULL(ДетализацияПостатейные.НДСРегл, 0))
		|				* СебестоимостьТоваров.Количество
		|		КОГДА СебестоимостьТоваров.ИсключитьНДСИзСтоимости
		|			ТОГДА (ЕСТЬNULL(-Детализация.НДСРегл, 0) + ЕСТЬNULL(-ДетализацияПостатейные.НДСРегл, 0))
		|				* СебестоимостьТоваров.Количество
		|		ИНАЧЕ 0 КОНЕЦ) КАК ЧИСЛО(31,2)) КАК НДСРегл
		|
		|ПОМЕСТИТЬ ДетализацияПартий
		|ИЗ
		|	ПервичныеПартииВНЗП КАК СебестоимостьТоваров
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|	ПО Аналитика.Ссылка = СебестоимостьТоваров.АналитикаУчетаНоменклатуры
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДетализацияСебестоимостиПартииТоваров КАК Детализация
		|	ПО Детализация.Партия = СебестоимостьТоваров.Партия
		|		И Детализация.АналитикаУчетаПартий = СебестоимостьТоваров.АналитикаУчетаПартий
		|		И Детализация.Организация = СебестоимостьТоваров.Организация
		|		И Детализация.ВидЗапасов = СебестоимостьТоваров.ВидЗапасов
		|		И Детализация.Номенклатура = Аналитика.Номенклатура
		|		И Детализация.Характеристика = Аналитика.Характеристика
		|		И НЕ Детализация.ЗатратыПредыдущихПеределов
		|		И (Детализация.ПериодРегистрации <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|		И СебестоимостьТоваров.Количество <> 0
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДетализацияСебестоимостиПартииТоваровПостатейныеЗатраты КАК ДетализацияПостатейные
		|	ПО ДетализацияПостатейные.Партия = СебестоимостьТоваров.Партия
		|		И ДетализацияПостатейные.АналитикаУчетаПартий = СебестоимостьТоваров.АналитикаУчетаПартий
		|		И ДетализацияПостатейные.Организация = СебестоимостьТоваров.Организация
		|		И ДетализацияПостатейные.ВидЗапасов = СебестоимостьТоваров.ВидЗапасов
		|		И ДетализацияПостатейные.Номенклатура = Аналитика.Номенклатура
		|		И ДетализацияПостатейные.Характеристика = Аналитика.Характеристика
		|		И НЕ ДетализацияПостатейные.ЗатратыПредыдущихПеределов
		|		И (ДетализацияПостатейные.ПериодРегистрации <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|		И СебестоимостьТоваров.Количество <> 0
		|ГДЕ
		|	СебестоимостьТоваров.ВключитьНДСВСтоимость ИЛИ СебестоимостьТоваров.ИсключитьНДСИзСтоимости
		|
		|СГРУППИРОВАТЬ ПО
		|	СебестоимостьТоваров.Организация,
		|	СебестоимостьТоваров.Период,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Партия,
		|	СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.КорПартия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
	
	#Область ПриходыНарастающимИтогом
		// Количество материала нарастаующим итогом, распределенное на партию производсьтва. 
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Т.Организация КАК Организация,
		|	Т.Период КАК Период,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия,
		|	СУММА(Партии.Количество) КАК Количество
		|ПОМЕСТИТЬ ПриходыНарастающимИтогом
		|ИЗ
		|	ВыбытиеИзНЗП КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеПартииВНЗП КАК Партии
		|		ПО Т.АналитикаУчетаНоменклатуры = Партии.КорАналитикаУчетаНоменклатуры
		|			И Т.Партия = Партии.КорПартия
		|			И Т.Период >= Партии.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область РасходыНарастающимИтогом
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Т.Организация КАК Организация,
		|	Т.Период КАК Период,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия,
		|	СУММА(НарастающийИтог.Количество) КАК Количество
		|ПОМЕСТИТЬ РасходыНарастающимИтогом
		|ИЗ
		|	ВыбытиеИзНЗП КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбытиеИзНЗП КАК НарастающийИтог
		|		ПО Т.АналитикаУчетаНоменклатуры = НарастающийИтог.АналитикаУчетаНоменклатуры
		|			И Т.Организация = НарастающийИтог.Организация
		|			И Т.Партия = НарастающийИтог.Партия
		|			И Т.Период >= НарастающийИтог.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область НулевыеПериоды
		// Периоды, в которых конечный остаток материала в НЗП равен 0.
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Расходы.Организация КАК Организация,
		|	Расходы.Период КАК Период,
		|	Расходы.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Расходы.Партия КАК Партия
		|ПОМЕСТИТЬ НулевыеПериоды
		|ИЗ
		|	РасходыНарастающимИтогом КАК Расходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПриходыНарастающимИтогом КАК Приходы
		|		ПО Расходы.АналитикаУчетаНоменклатуры = Приходы.АналитикаУчетаНоменклатуры
		|			И Расходы.Партия = Приходы.Партия
		|			И Расходы.Период = Приходы.Период
		|			И Расходы.Организация = Приходы.Организация
		|ГДЕ
		|	Расходы.Количество - ЕСТЬNULL(Приходы.Количество, 0) = 0
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ИнтервалыРасходаПартий
		// Периоды, в которых был расход партий производства на выпуск.
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Т.Организация КАК Организация,
		|	Т.Период КАК КонецПериода,
		|	МАКСИМУМ(ЕСТЬNULL(ДОБАВИТЬКДАТЕ(НулевыеПериоды.Период, МЕСЯЦ, 1), ДАТАВРЕМЯ(1, 1, 1))) КАК НачалоПериода,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия
		|ПОМЕСТИТЬ ИнтервалыРасходаПартий
		|ИЗ
		|	НулевыеПериоды КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ НулевыеПериоды КАК НулевыеПериоды
		|		ПО Т.АналитикаУчетаНоменклатуры = НулевыеПериоды.АналитикаУчетаНоменклатуры
		|			И Т.Партия = НулевыеПериоды.Партия
		|			И Т.Период > НулевыеПериоды.Период
		|			И Т.Организация = НулевыеПериоды.Организация
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
	
	#Область ПриходыНарастающимИтогомПоИнтервалам
		// Периоды, в которых был расход партий производства на выпуск.
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Выбытие.Организация,
		|	Выбытие.Период,
		|	Выбытие.АналитикаУчетаНоменклатуры,
		|	Выбытие.Партия КАК Партия,
		|	СУММА(ПП.Количество) КАК Количество
		|ПОМЕСТИТЬ ПриходыНарастающимИтогомПоИнтервалам
		|ИЗ
		|	ВыбытиеИзНЗП КАК Выбытие
		|	ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасходаПартий КАК Интервалы
		|	ПО Выбытие.АналитикаУчетаНоменклатуры = Интервалы.АналитикаУчетаНоменклатуры
		|		И Выбытие.Партия = Интервалы.Партия
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеПартииВНЗП КАК ПП
		|	ПО Выбытие.АналитикаУчетаНоменклатуры = ПП.КорАналитикаУчетаНоменклатуры
		|		И Выбытие.Партия = ПП.КорПартия
		|		И Выбытие.Период >= ПП.Период
		|		И (ПП.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|ГДЕ
		|	(Интервалы.НачалоПериода ЕСТЬ NULL
		|		ИЛИ Выбытие.Период МЕЖДУ Интервалы.НачалоПериода И Интервалы.КонецПериода)
		|
		|СГРУППИРОВАТЬ ПО
		|	Выбытие.Организация,
		|	Выбытие.Период,
		|	Выбытие.АналитикаУчетаНоменклатуры,
		|	Выбытие.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ПредварительныйРасходПартий
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Выбытие.Организация КАК Организация,
		|	Выбытие.Период КАК Период,
		|	ПП.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ПП.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ПП.Партия КАК Партия,
		|	МАКСИМУМ(ПП.ВключитьНДСВСтоимость) КАК ВключитьНДСВСтоимость,
		|	МАКСИМУМ(ПП.ИсключитьНДСИзСтоимости) КАК ИсключитьНДСИзСтоимости,
		|	Выбытие.АналитикаУчетаНоменклатуры 	КАК КорАналитикаУчетаНоменклатуры,
		|	Выбытие.Партия 						КАК КорПартия,
		
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|			Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.Количество) КАК Количество,
		|	МАКСИМУМ(Выбытие.Количество = Поступило.Количество - ЕСТЬNULL(Выбыло.Количество, 0) + Выбытие.Количество) КАК СписатьОстаток,
		
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.Материальные) КАК Материальные,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.Трудозатраты) КАК Трудозатраты,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянные) КАК ПостатейныеПостоянные,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременные) КАК ПостатейныеПеременные,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходы) КАК ДопРасходы,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.СуммаЗатратаЗабалансовая) КАК СуммаЗатратаЗабалансовая,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.СуммаЗатрата) КАК СуммаЗатрата,
		|	СУММА(ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.НДД) КАК НДД,
		
		// Стоимости с НДС
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.МатериальныеСНДС) КАК МатериальныеСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ТрудозатратыСНДС) КАК ТрудозатратыСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходыСНДС) КАК ДопРасходыСНДС,
		
		// Стоимости без НДС
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.МатериальныеБезНДС) КАК МатериальныеБезНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		
		// Стоимости Упр
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.МатериальныеУпр) КАК МатериальныеУпр,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.СтоимостьЗабалансоваяУпр) КАК СтоимостьЗабалансоваяУпр,
		
		// Стоимости Регл
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.МатериальныеРегл) КАК МатериальныеРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|
		// Налоговый учет
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.НалоговыйУчет) КАК НалоговыйУчет,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ВременнаяРазница) КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ ПредварительныйРасходПартий
		|ИЗ
		|	ВыбытиеИзНЗП КАК Выбытие
		|		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасходаПартий КАК Интервалы
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = Интервалы.АналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = Интервалы.Партия
		|			И Выбытие.Организация = Интервалы.Организация
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеПартииВНЗП КАК ПП
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = ПП.КорАналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = ПП.КорПартия
		|			И Выбытие.Период >= ПП.Период
		|			И (ПП.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|			И Выбытие.Организация = ПП.Организация
		|		ЛЕВОЕ СОЕДИНЕНИЕ РасходыНарастающимИтогом КАК Выбыло
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = Выбыло.АналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = Выбыло.Партия
		|			И Выбытие.Период = Выбыло.Период
		|			И Выбытие.Организация = Выбыло.Организация
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПриходыНарастающимИтогомПоИнтервалам КАК Поступило
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = Поступило.АналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = Поступило.Партия
		|			И Выбытие.Период = Поступило.Период
		|			И Выбытие.Организация = Поступило.Организация
		|ГДЕ
		|	(Интервалы.НачалоПериода ЕСТЬ NULL
		|		ИЛИ Выбытие.Период МЕЖДУ Интервалы.НачалоПериода И Интервалы.КонецПериода)
		|	И НЕ Поступило.Количество ЕСТЬ NULL
		|
		|СГРУППИРОВАТЬ ПО
		|	Выбытие.Организация,
		|	Выбытие.Период,
		|	Выбытие.АналитикаУчетаНоменклатуры,
		|	Выбытие.Партия,
		|	ПП.АналитикаУчетаНоменклатуры,
		|	ПП.АналитикаУчетаПартий,
		|	ПП.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ПартииСводно
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Т.Организация КАК Организация,
		|	Т.Период КАК Период,
		|	Т.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия КАК КорПартия,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	Т.Партия КАК Партия,
		|	СУММА(Партии.Количество) КАК Количество,
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(Партии.Материальные
		|		+ ЕСТЬNULL(Детализация.НДСУпр,0)
		|		+ ЕСТЬNULL(Детализация.НДСРегл,0)) КАК Материальные,
		|	СУММА(Партии.Трудозатраты) КАК Трудозатраты,
		|	СУММА(Партии.ПостатейныеПостоянные) КАК ПостатейныеПостоянные,
		|	СУММА(Партии.ПостатейныеПеременные) КАК ПостатейныеПеременные,
		|	СУММА(Партии.ДопРасходы) КАК ДопРасходы,
		|	СУММА(Партии.СуммаЗатратаЗабалансовая) КАК СуммаЗатратаЗабалансовая,
		|	СУММА(Партии.СуммаЗатрата
		|		+ ЕСТЬNULL(Детализация.НДСУпр,0)
		|		+ ЕСТЬNULL(Детализация.НДСРегл,0)) КАК СуммаЗатрата,
		|	СУММА(Партии.НДД) КАК НДД,
		|
		// Стоимости с НДС
		|	СУММА(Партии.МатериальныеСНДС) КАК МатериальныеСНДС,
		|	СУММА(Партии.ТрудозатратыСНДС) КАК ТрудозатратыСНДС,
		|	СУММА(Партии.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(Партии.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(Партии.ДопРасходыСНДС) КАК ДопРасходыСНДС,
		|
		// Стоимости без НДС
		|	СУММА(Партии.МатериальныеБезНДС) КАК МатериальныеБезНДС,
		|	СУММА(Партии.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(Партии.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(Партии.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|
		// Стоимости Упр
		|	СУММА(Партии.МатериальныеУпр + ЕСТЬNULL(Детализация.НДСУпр,0)) КАК МатериальныеУпр,
		|	СУММА(Партии.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(Партии.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(Партии.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(Партии.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(Партии.СтоимостьЗабалансоваяУпр) КАК СтоимостьЗабалансоваяУпр,
		|
		// Стоимости Регл
		|	СУММА(Партии.МатериальныеРегл + ЕСТЬNULL(Детализация.НДСРегл,0)) КАК МатериальныеРегл,
		|	СУММА(Партии.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(Партии.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(Партии.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(Партии.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(Партии.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|
		// Налоговый учет
		|	СУММА(Партии.НалоговыйУчет + ЕСТЬNULL(Детализация.НДСРегл,0)) КАК НалоговыйУчет,
		|	СУММА(Партии.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(Партии.ВременнаяРазница) КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ ПартииСводно
		|ИЗ
		|	ПредварительныйРасходПартий КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасходаПартий КАК Интервалы
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Интервалы.АналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Интервалы.Партия
		|			И Т.Организация = Интервалы.Организация
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеПартииВНЗП КАК Партии
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Партии.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Партии.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Партии.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Партии.АналитикаУчетаПартий
		|			И Т.Партия = Партии.Партия
		|			И Т.Период >= Партии.Период
		|			И (Партии.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|			И Т.Организация = Партии.Организация
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ДетализацияПартий КАК Детализация
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Детализация.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Детализация.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Детализация.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Детализация.АналитикаУчетаПартий
		|			И Т.Партия = Детализация.Партия
		|			И Т.Период >= Детализация.Период
		|			И (Детализация.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|			И Т.Организация = Детализация.Организация
		|ГДЕ
		|	Интервалы.НачалоПериода ЕСТЬ NULL
		|		ИЛИ Т.Период МЕЖДУ Интервалы.НачалоПериода И Интервалы.КонецПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область РасходПартийСводно
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Т.Организация КАК Организация,
		|	Т.Период КАК Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия КАК Партия,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.Количество
		|		КОНЕЦ) КАК Количество,
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.Материальные
		|		КОНЕЦ) КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.Трудозатраты
		|		КОНЕЦ) КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянные
		|		КОНЕЦ) КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременные
		|		КОНЕЦ) КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходы
		|		КОНЕЦ) КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.СуммаЗатратаЗабалансовая
		|		КОНЕЦ) КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.СуммаЗатрата
		|		КОНЕЦ) КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.НДД
		|		КОНЕЦ) КАК НДД,
		|
		// Стоимости с НДС
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.МатериальныеСНДС
		|		КОНЕЦ) КАК МатериальныеСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ТрудозатратыСНДС
		|		КОНЕЦ) КАК ТрудозатратыСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянныеСНДС
		|		КОНЕЦ) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременныеСНДС
		|		КОНЕЦ) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходыСНДС
		|		КОНЕЦ) КАК ДопРасходыСНДС,
		// Стоимости без НДС
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.МатериальныеБезНДС
		|		КОНЕЦ) КАК МатериальныеБезНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянныеБезНДС
		|		КОНЕЦ) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременныеБезНДС
		|		КОНЕЦ) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходыБезНДС
		|		КОНЕЦ) КАК ДопРасходыБезНДС,
		// Стоимости Упр
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.МатериальныеУпр
		|		КОНЕЦ) КАК МатериальныеУпр,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ТрудозатратыУпр
		|		КОНЕЦ) КАК ТрудозатратыУпр,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянныеУпр
		|		КОНЕЦ) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременныеУпр
		|		КОНЕЦ) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходыУпр
		|		КОНЕЦ) КАК ДопРасходыУпр,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.СтоимостьЗабалансоваяУпр
		|		КОНЕЦ) КАК СтоимостьЗабалансоваяУпр,
		// Стоимости Регл
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.МатериальныеРегл
		|		КОНЕЦ) КАК МатериальныеРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ТрудозатратыРегл
		|		КОНЕЦ) КАК ТрудозатратыРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянныеРегл
		|		КОНЕЦ) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременныеРегл
		|		КОНЕЦ) КАК ПостатейныеПеременныеРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходыРегл
		|		КОНЕЦ) КАК ДопРасходыРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ) КАК СтоимостьЗабалансоваяРегл,
		|
		// Налоговый учет
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.НалоговыйУчет
		|		КОНЕЦ) КАК НалоговыйУчет,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостояннаяРазница
		|		КОНЕЦ) КАК ПостояннаяРазница,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ВременнаяРазница
		|		КОНЕЦ) КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ РасходПартийСводно
		|ИЗ
		|	ПредварительныйРасходПартий КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасходаПартий КАК Интервалы
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Интервалы.АналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Интервалы.Партия
		|			И Т.Организация = Интервалы.Организация
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПредварительныйРасходПартий КАК Расход
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Расход.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Расход.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Расход.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Расход.АналитикаУчетаПартий
		|			И Т.Партия = Расход.Партия
		|			И Т.Период >= Расход.Период
		|			И (Расход.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|			И Т.Организация = Расход.Организация
		|ГДЕ
		|	Т.Период МЕЖДУ Интервалы.НачалоПериода И Интервалы.КонецПериода
		|		ИЛИ Интервалы.НачалоПериода ЕСТЬ NULL
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ПервичныеЗатратыПоПериодам
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	Т.Организация КАК Организация,
		|	Т.Период КАК Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия КАК КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия КАК Партия,
		|	Т.ВключитьНДСВСтоимость КАК ВключитьНДСВСтоимость,
		|	Т.ИсключитьНДСИзСтоимости КАК ИсключитьНДСИзСтоимости,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.Количество - Расход.Количество
		|		ИНАЧЕ Т.Количество
		|	КОНЕЦ КАК Количество,
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.Материальные - Расход.Материальные
		|		ИНАЧЕ Т.Материальные
		|	КОНЕЦ КАК Материальные,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.Трудозатраты - Расход.Трудозатраты
		|		ИНАЧЕ Т.Трудозатраты
		|	КОНЕЦ КАК Трудозатраты,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянные - Расход.ПостатейныеПостоянные
		|		ИНАЧЕ Т.ПостатейныеПостоянные
		|	КОНЕЦ КАК ПостатейныеПостоянные,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременные - Расход.ПостатейныеПеременные
		|		ИНАЧЕ Т.ПостатейныеПеременные
		|	КОНЕЦ КАК ПостатейныеПеременные,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходы - Расход.ДопРасходы
		|		ИНАЧЕ Т.ДопРасходы
		|	КОНЕЦ КАК ДопРасходы,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.СуммаЗатратаЗабалансовая - Расход.СуммаЗатратаЗабалансовая
		|		ИНАЧЕ Т.СуммаЗатратаЗабалансовая
		|	КОНЕЦ КАК СуммаЗатратаЗабалансовая,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.СуммаЗатрата - Расход.СуммаЗатрата
		|		ИНАЧЕ Т.СуммаЗатрата
		|	КОНЕЦ КАК СуммаЗатрата,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.НДД - Расход.НДД
		|		ИНАЧЕ Т.НДД
		|	КОНЕЦ КАК НДД,
		|
		// Стоимости с НДС
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.МатериальныеСНДС - Расход.МатериальныеСНДС
		|		ИНАЧЕ Т.МатериальныеСНДС
		|	КОНЕЦ КАК МатериальныеСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ТрудозатратыСНДС - Расход.ТрудозатратыСНДС
		|		ИНАЧЕ Т.ТрудозатратыСНДС
		|	КОНЕЦ КАК ТрудозатратыСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянныеСНДС - Расход.ПостатейныеПостоянныеСНДС
		|		ИНАЧЕ Т.ПостатейныеПостоянныеСНДС
		|	КОНЕЦ КАК ПостатейныеПостоянныеСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременныеСНДС - Расход.ПостатейныеПеременныеСНДС
		|		ИНАЧЕ Т.ПостатейныеПеременныеСНДС
		|	КОНЕЦ КАК ПостатейныеПеременныеСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходыСНДС - Расход.ДопРасходыСНДС
		|		ИНАЧЕ Т.ДопРасходыСНДС
		|	КОНЕЦ КАК ДопРасходыСНДС,
		|
		// Стоимости без НДС
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.МатериальныеБезНДС - Расход.МатериальныеБезНДС
		|		ИНАЧЕ Т.МатериальныеБезНДС
		|	КОНЕЦ КАК МатериальныеБезНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянныеБезНДС - Расход.ПостатейныеПостоянныеБезНДС
		|		ИНАЧЕ Т.ПостатейныеПостоянныеБезНДС
		|	КОНЕЦ КАК ПостатейныеПостоянныеБезНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременныеБезНДС - Расход.ПостатейныеПеременныеБезНДС
		|		ИНАЧЕ Т.ПостатейныеПеременныеБезНДС
		|	КОНЕЦ КАК ПостатейныеПеременныеБезНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходыБезНДС - Расход.ДопРасходыБезНДС
		|		ИНАЧЕ Т.ДопРасходыБезНДС
		|	КОНЕЦ КАК ДопРасходыБезНДС,
		|
		// Стоимости Упр
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.МатериальныеУпр - Расход.МатериальныеУпр
		|		ИНАЧЕ Т.МатериальныеУпр
		|	КОНЕЦ КАК МатериальныеУпр,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ТрудозатратыУпр - Расход.ТрудозатратыУпр
		|		ИНАЧЕ Т.ТрудозатратыУпр
		|	КОНЕЦ КАК ТрудозатратыУпр,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянныеУпр - Расход.ПостатейныеПостоянныеУпр
		|		ИНАЧЕ Т.ПостатейныеПостоянныеУпр
		|	КОНЕЦ КАК ПостатейныеПостоянныеУпр,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременныеУпр - Расход.ПостатейныеПеременныеУпр
		|		ИНАЧЕ Т.ПостатейныеПеременныеУпр
		|	КОНЕЦ КАК ПостатейныеПеременныеУпр,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходыУпр - Расход.ДопРасходыУпр
		|		ИНАЧЕ Т.ДопРасходыУпр
		|	КОНЕЦ КАК ДопРасходыУпр,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.СтоимостьЗабалансоваяУпр - Расход.СтоимостьЗабалансоваяУпр
		|		ИНАЧЕ Т.СтоимостьЗабалансоваяУпр
		|	КОНЕЦ КАК СтоимостьЗабалансоваяУпр,
		|
		// Стоимости Регл
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.МатериальныеРегл - Расход.МатериальныеРегл
		|		ИНАЧЕ Т.МатериальныеРегл
		|	КОНЕЦ КАК МатериальныеРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ТрудозатратыРегл - Расход.ТрудозатратыРегл
		|		ИНАЧЕ Т.ТрудозатратыРегл
		|	КОНЕЦ КАК ТрудозатратыРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянныеРегл - Расход.ПостатейныеПостоянныеРегл
		|		ИНАЧЕ Т.ПостатейныеПостоянныеРегл
		|	КОНЕЦ КАК ПостатейныеПостоянныеРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременныеРегл - Расход.ПостатейныеПеременныеРегл
		|		ИНАЧЕ Т.ПостатейныеПеременныеРегл
		|	КОНЕЦ КАК ПостатейныеПеременныеРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходыРегл - Расход.ДопРасходыРегл
		|		ИНАЧЕ Т.ДопРасходыРегл
		|	КОНЕЦ КАК ДопРасходыРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.СтоимостьЗабалансоваяРегл - Расход.СтоимостьЗабалансоваяРегл
		|		ИНАЧЕ Т.СтоимостьЗабалансоваяРегл
		|	КОНЕЦ КАК СтоимостьЗабалансоваяРегл,
		|
		// Налоговый учет
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.НалоговыйУчет - Расход.НалоговыйУчет
		|		ИНАЧЕ Т.НалоговыйУчет
		|	КОНЕЦ КАК НалоговыйУчет,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостояннаяРазница - Расход.ПостояннаяРазница
		|		ИНАЧЕ Т.ПостояннаяРазница
		|	КОНЕЦ КАК ПостояннаяРазница,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ВременнаяРазница - Расход.ВременнаяРазница
		|		ИНАЧЕ Т.ВременнаяРазница
		|	КОНЕЦ КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ ПервичныеЗатратыПоПериодам
		|ИЗ
		|	ПредварительныйРасходПартий КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ РасходПартийСводно КАК Расход
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Расход.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Расход.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Расход.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Расход.АналитикаУчетаПартий
		|			И Т.Партия = Расход.Партия
		|			И Т.Период = Расход.Период
		|			И Т.Организация = Расход.Организация
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииСводно КАК Приход
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Приход.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Приход.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Приход.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Приход.АналитикаУчетаПартий
		|			И Т.Партия = Приход.Партия
		|			И Т.Период = Приход.Период
		|			И Т.Организация = Приход.Организация
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ПервичныеПартииСводно
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Организация КАК Организация,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	Т.Партия КАК Партия
		|ПОМЕСТИТЬ ПервичныеПартииСводно
		|ИЗ
		|	ПервичныеЗатратыПоПериодам КАК Т
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;";
	#КонецОбласти
		
	#Область ПартииПолуфабрикатов
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ВЫБОР КОГДА &ДанныеПоСебестоимости < 3
		|		ТОГДА НЕОПРЕДЕЛЕНО
		|		ИНАЧЕ СебестоимостьТоваров.Организация
		|	КОНЕЦ КАК Организация,
		|	ПП.Партия КАК Партия,
		|	ПП.АналитикаУчетаПартий,
		|	ПП.АналитикаУчетаНоменклатуры
		|ПОМЕСТИТЬ ПартииПолуфабрикатов
		|ИЗ
		|	ПервичныеПартииСводно КАК ПП
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ПО СебестоимостьТоваров.Регистратор = ПП.Партия
		|		И СебестоимостьТоваров.АналитикаУчетаПартий = ПП.АналитикаУчетаПартий
		|		И (СебестоимостьТоваров.Период <= &ДатаОкончания ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1,1,1))
		|		И СебестоимостьТоваров.Организация = ПП.Организация
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
		|		ПО СебестоимостьТоваров.АналитикаУчетаПартий = АналитикиУчетаПартий.КлючАналитики
		|
		|ГДЕ
		|	СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И СебестоимостьТоваров.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|													ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|													ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение),
		|													ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами),
		|													ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуМеждуОрганизациями))
		|	И НЕ АналитикиУчетаПартий.КодСтроки = 0
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;
		|";
	#КонецОбласти
	
	#Область ВключениеИсключениеНДСВСтоимости
		ТекстМатериальныеЗатраты = ТекстМатериальныеЗатраты + "
		|ВЫБРАТЬ
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия КАК Партия,
		|	ВЫБОР КОГДА СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		ТОГДА -1
		|		ИНАЧЕ 1
		|	КОНЕЦ
		|	*
		|	ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА СебестоимостьТоваров.СтоимостьУпр
		|		КОГДА &ДанныеПоСебестоимости = 4
		|			ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|	КОНЕЦ КАК Стоимость
		|ПОМЕСТИТЬ ВТВключениеИсключениеНДСВСтоимости
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВыбытиеИзНЗП КАК ПП
		|		ПО &ДанныеПоСебестоимости > 2
		|			И СебестоимостьТоваров.АналитикаУчетаНоменклатуры = ПП.АналитикаУчетаНоменклатуры
		|			И СебестоимостьТоваров.Партия = ПП.Партия
		|			И (СебестоимостьТоваров.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИСключениеНДСВСтоимости))
		|			И (СебестоимостьТоваров.Период <= &ДатаОкончания
		|				ИЛИ &ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1))
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры,
		|	Партия
		|;
		|";
	#КонецОбласти
	
#КонецОбласти

#Область ТекстМатериальныеЗатратыОбъединение

	ТекстМатериальныеЗатратыОбъединение =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	НЗППоПродукции.Организация							КАК Организация,
		|	НЗППоПродукции.ПартияПродукции						КАК ПартияВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПартийПродукции		КАК АналитикаУчетаПартийВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПродукции				КАК АналитикаУчетаВыходноеИзделие,
		|	ПартииМатериалов.Партия								КАК ПартияЗатрата,
		|	ПартииМатериалов.АналитикаУчетаПартий				КАК АналитикаУчетаПартийЗатрата,
		|	ПартииМатериалов.ВключитьНДСВСтоимость				КАК ВключитьНДСВСтоимость,
		|	ПартииМатериалов.ИсключитьНДСИзСтоимости			КАК ИсключитьНДСИзСтоимости,
		|	ПартииМатериалов.АналитикаУчетаНоменклатуры			КАК АналитикаУчетаЗатрата,
		|	АналитикаЗатрат.Номенклатура						КАК Затрата,
		|	АналитикаЗатрат.Номенклатура.ЕдиницаИзмерения 		КАК ЕдиницаИзмеренияЗатрата,
		|	АналитикаЗатрат.Характеристика						КАК ХарактеристикаЗатрата,
		|	АналитикаЗатрат.Серия								КАК СерияЗатрата,
		|	АналитикаЗатрат.Назначение							КАК НазначениеЗатрата,
		|	АналитикаЗатрат.СтатьяКалькуляции					КАК СтатьяКалькуляции,
		|	АналитикаЗатрат.МестоХранения                       КАК Подразделение,
		|	(ВЫБОР
		|		КОГДА НЗППоПродукции.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
		|			ТОГДА ЛОЖЬ
		// Для возвратных отходов разузлования не требуется. 
		|		КОГДА АналитикаЗатрат.СтатьяКалькуляции.ТипЗатрат = ЗНАЧЕНИЕ(Перечисление.ТипыЗатрат.ВозвратныеОтходы)
		|			ТОГДА ЛОЖЬ
		//++ НЕ УТКА
		
		// Разузловывать затраты переработчика, если отчет формируется в валюте регл./упр. учета, по давальцу, не нужно
		|		КОГДА &ДанныеПоСебестоимости > 3
		|			И НЗППоПродукции.Организация = ЕСТЬNULL(ОтчетДавальцуМеждуОрганизациями.Давалец, НЕОПРЕДЕЛЕНО)
		|				ТОГДА ЛОЖЬ
		//-- НЕ УТКА
		|		КОГДА ПартииПолуфабрикатов.Партия ЕСТЬ НЕ NULL
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) 								КАК ТребуетсяРазузлование,
		|	(ВЫБОР
		|		КОГДА НЗППоПродукции.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
		|			ТОГДА ЛОЖЬ
		//++ НЕ УТКА
		
		// Разузловывать затраты переработчика, если отчет формируется в валюте регл./упр. учета, по давальцу, не нужно
		|		КОГДА &ДанныеПоСебестоимости > 3
		|			И НЗППоПродукции.Организация = ЕСТЬNULL(ОтчетДавальцуМеждуОрганизациями.Давалец, НЕОПРЕДЕЛЕНО)
		|				ТОГДА ЛОЖЬ
		//-- НЕ УТКА
		|		КОГДА &РазворачиватьДопРасходы
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) 								КАК ТребуетсяРазузлованиеДопРасходов,
		|	&ТипЗатратМатериальные								КАК ТипЗатрат,
		|	ПартииМатериалов.Количество
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	ПартииМатериалов.Материальные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Материальные,
		|	ПартииМатериалов.Трудозатраты
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Трудозатраты,
		|	ПартииМатериалов.ПостатейныеПостоянные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянные,
		|	ПартииМатериалов.ПостатейныеПеременные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременные,
		|	ПартииМатериалов.ДопРасходы
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходы,
		|	ПартииМатериалов.СуммаЗатратаЗабалансовая
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатратаЗабалансовая,
		|	ПартииМатериалов.СуммаЗатрата
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатрата,
		|	ПартииМатериалов.НДД
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК НДД,
		|
		|// Стоимости с НДС
		|	ПартииМатериалов.МатериальныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеСНДС,
		|	ПартииМатериалов.ТрудозатратыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыСНДС,
		|	ПартииМатериалов.ПостатейныеПостоянныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеСНДС,
		|	ПартииМатериалов.ПостатейныеПеременныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеСНДС,
		|	ПартииМатериалов.ДопРасходыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	ПартииМатериалов.МатериальныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеБезНДС,
		|	ПартииМатериалов.ПостатейныеПостоянныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеБезНДС,
		|	ПартииМатериалов.ПостатейныеПеременныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеБезНДС,
		|	ПартииМатериалов.ДопРасходыБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	ПартииМатериалов.МатериальныеУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеУпр,
		|	ПартииМатериалов.ТрудозатратыУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10))	КАК ТрудозатратыУпр,
		|	ПартииМатериалов.ПостатейныеПостоянныеУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеУпр,
		|	ПартииМатериалов.ПостатейныеПеременныеУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель	/ НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеУпр,
		|	ПартииМатериалов.ДопРасходыУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыУпр,
		|	ПартииМатериалов.СтоимостьЗабалансоваяУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель  КАК ЧИСЛО(31,10)) КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	ПартииМатериалов.МатериальныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеРегл,
		|	ПартииМатериалов.ТрудозатратыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыРегл,
		|	ПартииМатериалов.ПостатейныеПостоянныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеРегл,
		|	ПартииМатериалов.ПостатейныеПеременныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеРегл,
		|	ПартииМатериалов.ДопРасходыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыРегл,
		|	ПартииМатериалов.СтоимостьЗабалансоваяРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	ПартииМатериалов.НалоговыйУчет
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК НалоговыйУчет,
		|	ПартииМатериалов.ПостояннаяРазница
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостояннаяРазница,
		|	ПартииМатериалов.ВременнаяРазница
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ВременнаяРазница,
		|
		|// Включение исключение НДС в стоимости
		|	ВЫБОР
		|		КОГДА ВТВключениеИсключениеНДСВСтоимости.Стоимость ЕСТЬ NULL
		|			ТОГДА 0
		|		ИНАЧЕ ВТВключениеИсключениеНДСВСтоимости.Стоимость * (ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31, 10))) * (ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31, 10)))
		|	КОНЕЦ КАК ВключениеИсключениеНДСВСтоимости
		|
		|ИЗ
		|	ВыбытиеИзНЗППоПродукции КАК НЗППоПродукции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПервичныеЗатратыПоПериодам КАК ПартииМатериалов
		|		ПО НЗППоПродукции.Период = ПартииМатериалов.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = ПартииМатериалов.КорАналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = ПартииМатериалов.КорПартия
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаЗатрат
		|		ПО НЗППоПродукции.АналитикаУчетаНоменклатуры = АналитикаЗатрат.КлючАналитики
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбытиеИзНЗП КАК ВыбытиеСводно
		|		ПО НЗППоПродукции.Период = ВыбытиеСводно.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = ВыбытиеСводно.АналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = ВыбытиеСводно.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииПолуфабрикатов КАК ПартииПолуфабрикатов
		|		ПО ПартииМатериалов.Партия = ПартииПолуфабрикатов.Партия
		|			И ПартииМатериалов.АналитикаУчетаПартий = ПартииПолуфабрикатов.АналитикаУчетаПартий
		|			И ПартииМатериалов.АналитикаУчетаНоменклатуры = ПартииПолуфабрикатов.АналитикаУчетаНоменклатуры
		|			И (НЕ НЗППоПродукции.ПартияПродукции = ПартииПолуфабрикатов.Партия
		|				ИЛИ НЕ НЗППоПродукции.АналитикаУчетаПартийПродукции = ПартииПолуфабрикатов.АналитикаУчетаПартий
		|				ИЛИ НЕ НЗППоПродукции.АналитикаУчетаПродукции = ПартииПолуфабрикатов.АналитикаУчетаНоменклатуры)
		|			И (ПартииПолуфабрикатов.Организация = НЗППоПродукции.Организация
		|				ИЛИ &ДанныеПоСебестоимости < 3)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВключениеИсключениеНДСВСтоимости КАК ВТВключениеИсключениеНДСВСтоимости
		|		ПО НЗППоПродукции.АналитикаУчетаНоменклатуры = ВТВключениеИсключениеНДСВСтоимости.АналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = ВТВключениеИсключениеНДСВСтоимости.Партия
		//++ НЕ УТКА
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ОтчетДавальцуМеждуОрганизациями КАК ОтчетДавальцуМеждуОрганизациями
		|		ПО (ОтчетДавальцуМеждуОрганизациями.Ссылка = ПартииМатериалов.Партия)
		//-- НЕ УТКА
		|";
	
	ТекстыЗапроса.Добавить(ТекстМатериальныеЗатратыОбъединение);
#КонецОбласти	
	
#Область ТекстМатериалыНачальныеОстаткиНЗПОбъединение
	ТекстМатериалыНачальныеОстаткиНЗПОбъединение =
		"ВЫБРАТЬ
		|	НЗППоПродукции.Организация							КАК Организация,
		|	НЗППоПродукции.ПартияПродукции						КАК ПартияВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПартийПродукции		КАК АналитикаУчетаПартийВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПродукции				КАК АналитикаУчетаВыходноеИзделие,
		|	НЗППоПродукции.Партия								КАК ПартияЗатрата,
		|	НЕОПРЕДЕЛЕНО										КАК АналитикаУчетаПартийЗатрата,
		|	ЛОЖЬ												КАК ВключитьНДСВСтоимость,
		|	ЛОЖЬ												КАК ИсключитьНДСИзСтоимости,
		|	НЗППоПродукции.АналитикаУчетаНоменклатуры			КАК АналитикаУчетаЗатрата,
		|	АналитикаЗатрат.Номенклатура						КАК Затрата,
		|	АналитикаЗатрат.Номенклатура.ЕдиницаИзмерения 		КАК ЕдиницаИзмеренияЗатрата,
		|	АналитикаЗатрат.Характеристика						КАК ХарактеристикаЗатрата,
		|	АналитикаЗатрат.Серия								КАК СерияЗатрата,
		|	АналитикаЗатрат.Назначение							КАК НазначениеЗатрата,
		|	АналитикаЗатрат.СтатьяКалькуляции					КАК СтатьяКалькуляции,
		|	АналитикаЗатрат.МестоХранения                       КАК Подразделение,
		|	ЛОЖЬ												КАК ТребуетсяРазузлование,
		|	ЛОЖЬ												КАК ТребуетсяРазузлованиеДопРасходов,
		|	&ТипЗатратМатериальные								КАК ТипЗатрат,
		|	НЗППоПродукции.Количество
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	НЗППоПродукции.Материальные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Материальные,
		|	НЗППоПродукции.Трудозатраты
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Трудозатраты,
		|	НЗППоПродукции.ПостатейныеПостоянные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянные,
		|	НЗППоПродукции.ПостатейныеПеременные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременные,
		|	НЗППоПродукции.ДопРасходы
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходы,
		|	НЗППоПродукции.СуммаЗатратаЗабалансовая
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатратаЗабалансовая,
		|	НЗППоПродукции.СуммаЗатрата
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатрата,
		|	НЗППоПродукции.НДД
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК НДД,
		|
		|// Стоимости с НДС
		|	НЗППоПродукции.МатериальныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеСНДС,
		|	НЗППоПродукции.ТрудозатратыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыСНДС,
		|	НЗППоПродукции.ПостатейныеПостоянныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеСНДС,
		|	НЗППоПродукции.ПостатейныеПеременныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеСНДС,
		|	НЗППоПродукции.ДопРасходыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	НЗППоПродукции.МатериальныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеБезНДС,
		|	НЗППоПродукции.ПостатейныеПостоянныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеБезНДС,
		|	НЗППоПродукции.ПостатейныеПеременныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеБезНДС,
		|	НЗППоПродукции.ДопРасходыБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	НЗППоПродукции.МатериальныеУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеУпр,
		|	НЗППоПродукции.ТрудозатратыУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыУпр,
		|	НЗППоПродукции.ПостатейныеПостоянныеУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель	/ НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеУпр,
		|	НЗППоПродукции.ПостатейныеПеременныеУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеУпр,
		|	НЗППоПродукции.ДопРасходыУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель	/ НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыУпр,
		|	НЗППоПродукции.СтоимостьЗабалансоваяУпр
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	НЗППоПродукции.МатериальныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеРегл,
		|	НЗППоПродукции.ТрудозатратыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыРегл,
		|	НЗППоПродукции.ПостатейныеПостоянныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеРегл,
		|	НЗППоПродукции.ПостатейныеПеременныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеРегл,
		|	НЗППоПродукции.ДопРасходыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыРегл,
		|	НЗППоПродукции.СтоимостьЗабалансоваяРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	НЗППоПродукции.НалоговыйУчет
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК НалоговыйУчет,
		|	НЗППоПродукции.ПостояннаяРазница
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостояннаяРазница,
		|	НЗППоПродукции.ВременнаяРазница
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ВременнаяРазница,
		|
		|// Включение исключение НДС в стоимости
		|	0 КАК ВключениеИсключениеНДСВСтоимости
		|
		|ИЗ
		|	ВыбытиеИзНЗППоПродукции КАК НЗППоПродукции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеЗатратыПоПериодам КАК ПартииМатериалов
		|	    ПО НЗППоПродукции.Период = ПартииМатериалов.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = ПартииМатериалов.КорАналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = ПартииМатериалов.КорПартия
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаЗатрат
		|		ПО НЗППоПродукции.АналитикаУчетаНоменклатуры = АналитикаЗатрат.КлючАналитики
		|ГДЕ
		|	ПартииМатериалов.Партия ЕСТЬ NULL
		|";
	
	ТекстыЗапроса.Добавить(ТекстМатериалыНачальныеОстаткиНЗПОбъединение);
	
#КонецОбласти
	
#Область ТекстТрудозатратыОбъединение
	ТекстТрудозатратыОбъединение =
		"ВЫБРАТЬ
		|	ТрудозатратыНЗП.Организация						КАК Организация,
		|	ТрудозатратыНЗП.Регистратор						КАК ПартияВыходноеИзделие,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПартий			КАК АналитикаУчетаПартийВыходноеИзделие,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПродукции		КАК АналитикаУчетаВыходноеИзделие,
		|	НЕОПРЕДЕЛЕНО									КАК ПартияЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК АналитикаУчетаПартийЗатрата,
		|	ЛОЖЬ											КАК ВключитьНДСВСтоимость,
		|	ЛОЖЬ											КАК ИсключитьНДСИзСтоимости,
		|	ТрудозатратыНЗП.ВидРабот						КАК АналитикаЗатрата,
		|	ТрудозатратыНЗП.ВидРабот						КАК Затрата,
		|	СпрВидыРабот.ЕдиницаИзмерения					КАК ЕдиницаИзмеренияЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК ХарактеристикаЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК СерияЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК НазначениеЗатрата,
		|	ТрудозатратыНЗП.СтатьяКалькуляции				КАК СтатьяКалькуляции,
		|	ТрудозатратыНЗП.Подразделение					КАК Подразделение,
		|	ЛОЖЬ											КАК ТребуетсяРазузлование,
		|	ЛОЖЬ											КАК ТребуетсяРазузлованиеДопРасходов,
		|	&ТипЗатратТрудозатраты							КАК ТипЗатрат,
		|	СУММА(ТрудозатратыНЗП.Количество
		|		* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	0												КАК Материальные,
		|	СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 4
		|			ТОГДА ТрудозатратыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК Трудозатраты,
		|	0												КАК ПостатейныеПостоянные,
		|	0												КАК ПостатейныеПеременные,
		|	0												КАК ДопРасходы,
		|	0												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 4
		|			ТОГДА ТрудозатратыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 4
		|				ТОГДА ТрудозатратыНЗП.СтоимостьНДД
		|			ИНАЧЕ 0
		|		КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК НДД,
		|
		|// Стоимости с НДС
		|	0												КАК МатериальныеСНДС,
		|	СУММА(ТрудозатратыНЗП.Стоимость
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ТрудозатратыСНДС,
		|	0												КАК ПостатейныеПостоянныеСНДС,
		|	0												КАК ПостатейныеПеременныеСНДС,
		|	0												КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	0												КАК МатериальныеБезНДС,
		|	0												КАК ПостатейныеПостоянныеБезНДС,
		|	0												КАК ПостатейныеПеременныеБезНДС,
		|	0												КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	0												КАК МатериальныеУпр,
		|	СУММА(ТрудозатратыНЗП.Стоимость
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ТрудозатратыУпр,
		|	0												КАК ПостатейныеПостоянныеУпр,
		|	0												КАК ПостатейныеПеременныеУпр,
		|	0												КАК ДопРасходыУпр,
		|	0												КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	0												КАК МатериальныеРегл,
		|	СУММА(ТрудозатратыНЗП.СтоимостьРегл
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ТрудозатратыРегл,
		|	0												КАК ПостатейныеПостоянныеРегл,
		|	0												КАК ПостатейныеПеременныеРегл,
		|	0												КАК ДопРасходыРегл,
		|	0												КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	СУММА((ТрудозатратыНЗП.СтоимостьРегл
		|		- ТрудозатратыНЗП.ПостояннаяРазница
		|		- ТрудозатратыНЗП.ВременнаяРазница)
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК НалоговыйУчет,
		|	СУММА(ТрудозатратыНЗП.ПостояннаяРазница
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ПостояннаяРазница,
		|	СУММА(ТрудозатратыНЗП.ВременнаяРазница
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ВременнаяРазница,
		|		
		|// Включение исключение НДС в стоимости
		|	0 КАК ВключениеИсключениеНДСВСтоимости
		|
		|ИЗ
		|	ВыпущеннаяПродукция КАК ВыпущеннаяПродукция
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ТрудозатратыНезавершенногоПроизводства КАК ТрудозатратыНЗП
		|		ПО ТрудозатратыНЗП.Организация = ВыпущеннаяПродукция.Организация
		|		И ВыпущеннаяПродукция.ПартияПродукции = ТрудозатратыНЗП.Регистратор
		|		И ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции = ТрудозатратыНЗП.КорАналитикаУчетаПартий
		|		И ВыпущеннаяПродукция.АналитикаУчетаПродукции = ТрудозатратыНЗП.КорАналитикаУчетаПродукции
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыРаботСотрудников КАК СпрВидыРабот
		|		ПО СпрВидыРабот.Ссылка = ТрудозатратыНЗП.ВидРабот
		|
		|СГРУППИРОВАТЬ ПО
		|	ТрудозатратыНЗП.Организация,
		|	ТрудозатратыНЗП.ВидРабот,
		|	ТрудозатратыНЗП.СтатьяКалькуляции,
		|	СпрВидыРабот.ЕдиницаИзмерения,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПродукции,
		|	ТрудозатратыНЗП.Регистратор,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПартий,
		|	ТрудозатратыНЗП.Подразделение
		|";
	
	ТекстыЗапроса.Добавить(ТекстТрудозатратыОбъединение);
	
#КонецОбласти
	
#Область ТекстПрочиеРасходыОбъединение
	ТекстПрочиеРасходыОбъединение =
		"ВЫБРАТЬ
		|	ПрочиеРасходыНЗП.Организация				КАК Организация,
		|	ПрочиеРасходыНЗП.Регистратор				КАК ПартияВыходноеИзделие,
		|	ПрочиеРасходыНЗП.КорАналитикаУчетаПартий	КАК АналитикаУчетаПартийВыходноеИзделие,
		|	ПрочиеРасходыНЗП.АналитикаУчетаПродукции	КАК АналитикаУчетаВыходноеИзделие,
		|	НЕОПРЕДЕЛЕНО								КАК ПартияЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК АналитикаУчетаПартийЗатрата,
		|	ЛОЖЬ										КАК ВключитьНДСВСтоимость,
		|	ЛОЖЬ										КАК ИсключитьНДСИзСтоимости,
		|	ПрочиеРасходыНЗП.СтатьяРасходов				КАК АналитикаЗатрата,
		|	ПрочиеРасходыНЗП.СтатьяРасходов				КАК Затрата,
		|	НЕОПРЕДЕЛЕНО								КАК ЕдиницаИзмеренияЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК ХарактеристикаЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК СерияЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК НазначениеЗатрата,
		|	ПрочиеРасходыНЗП.СтатьяКалькуляции			КАК СтатьяКалькуляции,
		|	ПрочиеРасходыНЗП.Подразделение				КАК Подразделение,
		|	ЛОЖЬ										КАК ТребуетсяРазузлование,
		|	ЛОЖЬ										КАК ТребуетсяРазузлованиеДопРасходов,
		|	&ТипЗатратПостатейные						КАК ТипЗатрат,
		|	0											КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	0											КАК Материальные,
		|	0											КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ПрочиеРасходыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьБезНДС
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьУпр
		|		КОГДА &ДанныеПоСебестоимости = 4
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ПрочиеРасходыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьБезНДС
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьУпр
		|		КОГДА &ДанныеПоСебестоимости = 4
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременные,
		|	0											КАК ДопРасходы,
		|	0											КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ПрочиеРасходыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьБезНДС
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьУпр
		|		КОГДА &ДанныеПоСебестоимости = 4
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК СуммаЗатрата,
		|	СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 4
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьНДД
		|		ИНАЧЕ 0
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК НДД,
		|
		|// Стоимости с НДС
		|	0											КАК МатериальныеСНДС,
		|	0											КАК ТрудозатратыСНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.Стоимость
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.Стоимость
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременныеСНДС,
		|	0											КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	0											КАК МатериальныеБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьБезНДС
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьБезНДС
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременныеБезНДС,
		|	0											КАК ДопРасходыБезНДС,
		|
		|// Стоимости Упр
		|	0											КАК МатериальныеУпр,
		|	0											КАК ТрудозатратыУпр,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьУпр
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьУпр
		|	КОНЕЦ * ВыпущеннаяПродукция.Числитель
		|			/ ВыпущеннаяПродукция.Знаменатель)	КАК ПостатейныеПеременныеУпр,
		|	0											КАК ДопРасходыУпр,
		|	0											КАК СтоимостьЗабалансоваяУпр,
		|
		|// Стоимости Регл
		|	0											КАК МатериальныеРегл,
		|	0											КАК ТрудозатратыРегл,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременныеРегл,
		|	0											КАК ДопРасходыРегл,
		|	0											КАК СтоимостьЗабалансоваяРегл,
		|
		|// Налоговый учет
		|	СУММА((ПрочиеРасходыНЗП.СтоимостьРегл
		|		- ПрочиеРасходыНЗП.ПостояннаяРазница
		|		- ПрочиеРасходыНЗП.ВременнаяРазница)
		|		* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК НалоговыйУчет,
		|	СУММА(ПрочиеРасходыНЗП.ПостояннаяРазница
		|		* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ПостояннаяРазница,
		|	СУММА(ПрочиеРасходыНЗП.ВременнаяРазница
		|		* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ВременнаяРазница,
		|
		|// Включение исключение НДС в стоимости
		|	0 КАК ВключениеИсключениеНДСВСтоимости
		|
		|ИЗ
		|	ВыпущеннаяПродукция КАК ВыпущеннаяПродукция
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПрочиеРасходыНезавершенногоПроизводства КАК ПрочиеРасходыНЗП
		|		ПО ВыпущеннаяПродукция.Организация = ПрочиеРасходыНЗП.Организация
		|		И ВыпущеннаяПродукция.ПартияПродукции = ПрочиеРасходыНЗП.Регистратор
		|		И ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции = ПрочиеРасходыНЗП.КорАналитикаУчетаПартий
		|		И ВыпущеннаяПродукция.АналитикаУчетаПродукции = ПрочиеРасходыНЗП.АналитикаУчетаПродукции
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
		|		ПО ПрочиеРасходыНЗП.СтатьяРасходов = СтатьиРасходов.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	ПрочиеРасходыНЗП.Организация,
		|	ПрочиеРасходыНЗП.СтатьяРасходов,
		|	ПрочиеРасходыНЗП.СтатьяКалькуляции,
		|	ПрочиеРасходыНЗП.АналитикаУчетаПродукции,
		|	ПрочиеРасходыНЗП.Регистратор,
		|	ПрочиеРасходыНЗП.КорАналитикаУчетаПартий,
		|	ПрочиеРасходыНЗП.Подразделение
		|";
	
	ТекстыЗапроса.Добавить(ТекстПрочиеРасходыОбъединение);
	
#КонецОбласти
	
#Область ТекстДопРасходыОбъединение
	
	Если ВыводитьДопРасходы Тогда
			
		ТекстДопРасходыОбъединение =
			"ВЫБРАТЬ
			|	ДетализацияСебестоимости.Организация		КАК Организация,
			|	ДетализацияСебестоимости.Партия				КАК ПартияВыходноеИзделие,
			|	ДетализацияСебестоимости.АналитикаУчетаПартий	КАК АналитикаУчетаПартийВыходноеИзделие,
			|	&АналитикаУчетаВыходноеИзделие				КАК АналитикаУчетаВыходноеИзделие,
			|	ДетализацияСебестоимости.ДокументПоступления КАК ПартияЗатрата,
			|	ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления КАК АналитикаУчетаПартийЗатрата,
			|	ЛОЖЬ										КАК ВключитьНДСВСтоимость,
			|	ЛОЖЬ										КАК ИсключитьНДСИзСтоимости,
			|	ДетализацияСебестоимости.АналитикаРасходов	КАК АналитикаЗатрата,
			|	ВЫБОР
			|		КОГДА ДетализацияСебестоимости.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
			|			ТОГДА ЕСТЬNULL(ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления.ВидЦенности, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка))
			|		ИНАЧЕ ДетализацияСебестоимости.СтатьяРасходов
			|	КОНЕЦ КАК Затрата,
			|	НЕОПРЕДЕЛЕНО								КАК ЕдиницаИзмеренияЗатрата,
			|	НЕОПРЕДЕЛЕНО								КАК ХарактеристикаЗатрата,
			|	НЕОПРЕДЕЛЕНО								КАК СерияЗатрата,
			|	НЕОПРЕДЕЛЕНО								КАК НазначениеЗатрата,
			|	&СтатьяКалькуляции							КАК СтатьяКалькуляции,
			|	НЕОПРЕДЕЛЕНО								КАК Подразделение,
			|	ЛОЖЬ										КАК ТребуетсяРазузлование,
			|	ЛОЖЬ										КАК ТребуетсяРазузлованиеДопРасходов,
			|	&ТипЗатратДопРасходы						КАК ТипЗатрат,
			|	0											КАК КоличествоЗатрата,
			|
			|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
			|	0											КАК Материальные,
			|	0											КАК Трудозатраты,
			|	0											КАК ПостатейныеПостоянные,
			|	0											КАК ПостатейныеПеременные,
			|	СУММА(ВЫБОР
			|		КОГДА &ДанныеПоСебестоимости = 1
			|			ТОГДА ДетализацияСебестоимости.СтоимостьСНДС
			|		КОГДА &ДанныеПоСебестоимости = 2
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДС
			|		КОГДА &ДанныеПоСебестоимости = 3
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСУпр ИНАЧЕ 0 КОНЕЦ)
			|		КОГДА &ДанныеПоСебестоимости = 4
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСРегл
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСРегл ИНАЧЕ 0 КОНЕЦ)
			|	КОНЕЦ * &КоличествоПродукции)				КАК ДопРасходы,
			|	0											КАК СуммаЗатратаЗабалансовая,
			|	СУММА(ВЫБОР
			|		КОГДА &ДанныеПоСебестоимости = 1
			|			ТОГДА ДетализацияСебестоимости.СтоимостьСНДС
			|		КОГДА &ДанныеПоСебестоимости = 2
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДС
			|		КОГДА &ДанныеПоСебестоимости = 3
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСУпр ИНАЧЕ 0 КОНЕЦ)
			|		КОГДА &ДанныеПоСебестоимости = 4
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСРегл
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСРегл ИНАЧЕ 0 КОНЕЦ)
			|	КОНЕЦ * &КоличествоПродукции)				КАК СуммаЗатрата,
			|	0											КАК НДД,
			|
			|// Стоимости с НДС
			|	0											КАК МатериальныеСНДС,
			|	0											КАК ТрудозатратыСНДС,
			|	0											КАК ПостатейныеПостоянныеСНДС,
			|	0											КАК ПостатейныеПеременныеСНДС,
			|	СУММА(ДетализацияСебестоимости.СтоимостьСНДС
			|			* &КоличествоПродукции)				КАК ДопРасходыСНДС,
			|
			|// Стоимости без НДС
			|	0											КАК МатериальныеБезНДС,
			|	0											КАК ПостатейныеПостоянныеБезНДС,
			|	0											КАК ПостатейныеПеременныеБезНДС,
			|	СУММА(ДетализацияСебестоимости.СтоимостьБезНДС
			|			* &КоличествоПродукции)				КАК ДопРасходыБезНДС,
			|
			|// Стоимости Упр
			|	0											КАК МатериальныеУпр,
			|	0											КАК ТрудозатратыУпр,
			|	0											КАК ПостатейныеПостоянныеУпр,
			|	0											КАК ПостатейныеПеременныеУпр,
			|	СУММА((ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСУпр ИНАЧЕ 0 КОНЕЦ))
			|			* &КоличествоПродукции)				КАК ДопРасходыУпр,
			|	0											КАК СтоимостьЗабалансоваяУпр,
			|
			|// Стоимости Регл
			|	0											КАК МатериальныеРегл,
			|	0											КАК ТрудозатратыРегл,
			|	0											КАК ПостатейныеПостоянныеРегл,
			|	0											КАК ПостатейныеПеременныеРегл,
			|	СУММА((ДетализацияСебестоимости.СтоимостьБезНДСРегл 
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСРегл ИНАЧЕ 0 КОНЕЦ))
			|			* &КоличествоПродукции)				КАК ДопРасходыРегл,
			|	0											КАК СтоимостьЗабалансоваяРегл,
			|
			|// Налоговый учет
			|	0 КАК НалоговыйУчет,
			|	0 КАК ПостояннаяРазница,
			|	0 КАК ВременнаяРазница,
			|
			|// Включение исключение НДС в стоимости
			|	0 КАК ВключениеИсключениеНДСВСтоимости
			|
			|ИЗ
			|	РегистрСведений.ДетализацияСебестоимостиПартииТоваровПостатейныеЗатраты КАК ДетализацияСебестоимости
			|		
			|ГДЕ 
			|	ДетализацияСебестоимости.Партия В (&ПартииПродукции)
			|	И ДетализацияСебестоимости.АналитикаУчетаПартий В (&АналитикиУчетаПартийПродукции)
			|	И ДетализацияСебестоимости.Номенклатура В (&Продукция)
			|	И ДетализацияСебестоимости.Характеристика В (&ХарактеристикиПродукции)
			|	И ЕСТЬNULL(ДетализацияСебестоимости.ВидЗапасов.ТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
			|	И НЕ ДетализацияСебестоимости.ЗатратыПредыдущихПеределов
			|	И НЕ ВЫБОР
			|			КОГДА &ДанныеПоСебестоимости = 1
			|				ТОГДА ДетализацияСебестоимости.СтоимостьСНДС
			|			КОГДА &ДанныеПоСебестоимости = 2
			|				ТОГДА ДетализацияСебестоимости.СтоимостьБезНДС
			|			КОГДА &ДанныеПоСебестоимости = 3
			|				ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			КОГДА &ДанныеПоСебестоимости = 4
			|				ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСРегл
			|		КОНЕЦ = 0
			|	И ВЫБОР
			|		КОГДА ДетализацияСебестоимости.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
			|			ТОГДА ИСТИНА	
			|		КОГДА &ДанныеПоСебестоимости = 4
			|			ТОГДА ДетализацияСебестоимости.СтатьяРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
			|		ИНАЧЕ ДетализацияСебестоимости.СтатьяРасходов.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
			|	КОНЕЦ 
			|
			|СГРУППИРОВАТЬ ПО
			|	ДетализацияСебестоимости.Организация,
			|	ДетализацияСебестоимости.Партия,
			|	ДетализацияСебестоимости.АналитикаУчетаПартий,
			|	ДетализацияСебестоимости.ДокументПоступления,
			|	ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления,
			|	ДетализацияСебестоимости.АналитикаРасходов,
			|	ВЫБОР
			|		КОГДА ДетализацияСебестоимости.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
			|			ТОГДА ЕСТЬNULL(ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления.ВидЦенности, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка))
			|		ИНАЧЕ ДетализацияСебестоимости.СтатьяРасходов
			|	КОНЕЦ
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДетализацияСебестоимости.Организация		КАК Организация,
			|	ДетализацияСебестоимости.Партия				КАК ПартияВыходноеИзделие,
			|	ДетализацияСебестоимости.АналитикаУчетаПартий	КАК АналитикаУчетаПартийВыходноеИзделие,
			|	&АналитикаУчетаВыходноеИзделие				КАК АналитикаУчетаВыходноеИзделие,
			|	ДетализацияСебестоимости.ДокументПоступления КАК ПартияЗатрата,
			|	ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления КАК АналитикаУчетаПартийЗатрата,
			|	ЛОЖЬ										КАК ВключитьНДСВСтоимость,
			|	ЛОЖЬ										КАК ИсключитьНДСИзСтоимости,
			|	ДетализацияСебестоимости.АналитикаРасходов	КАК АналитикаЗатрата,
			|	ВЫБОР
			|		КОГДА ДетализацияСебестоимости.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
			|			ТОГДА ЕСТЬNULL(ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления.ВидЦенности, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка))
			|		ИНАЧЕ ДетализацияСебестоимости.СтатьяРасходов
			|	КОНЕЦ КАК Затрата,
			|	НЕОПРЕДЕЛЕНО								КАК ЕдиницаИзмеренияЗатрата,
			|	НЕОПРЕДЕЛЕНО								КАК ХарактеристикаЗатрата,
			|	НЕОПРЕДЕЛЕНО								КАК СерияЗатрата,
			|	НЕОПРЕДЕЛЕНО								КАК НазначениеЗатрата,
			|	&СтатьяКалькуляции							КАК СтатьяКалькуляции,
			|	НЕОПРЕДЕЛЕНО								КАК Подразделение,
			|	ЛОЖЬ										КАК ТребуетсяРазузлование,
			|	ЛОЖЬ										КАК ТребуетсяРазузлованиеДопРасходов,
			|	&ТипЗатратДопРасходы						КАК ТипЗатрат,
			|	0											КАК КоличествоЗатрата,
			|
			|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
			|	0											КАК Материальные,
			|	0											КАК Трудозатраты,
			|	0											КАК ПостатейныеПостоянные,
			|	0											КАК ПостатейныеПеременные,
			|	СУММА(ВЫБОР
			|		КОГДА &ДанныеПоСебестоимости = 1
			|			ТОГДА ДетализацияСебестоимости.СтоимостьСНДС
			|		КОГДА &ДанныеПоСебестоимости = 2
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДС
			|		КОГДА &ДанныеПоСебестоимости = 3
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСУпр ИНАЧЕ 0 КОНЕЦ)
			|		КОГДА &ДанныеПоСебестоимости = 4
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСРегл
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСРегл ИНАЧЕ 0 КОНЕЦ)
			|	КОНЕЦ * &КоличествоПродукции)				КАК ДопРасходы,
			|	0											КАК СуммаЗатратаЗабалансовая,
			|	СУММА(ВЫБОР
			|		КОГДА &ДанныеПоСебестоимости = 1
			|			ТОГДА ДетализацияСебестоимости.СтоимостьСНДС
			|		КОГДА &ДанныеПоСебестоимости = 2
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДС
			|		КОГДА &ДанныеПоСебестоимости = 3
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСУпр ИНАЧЕ 0 КОНЕЦ)
			|		КОГДА &ДанныеПоСебестоимости = 4
			|			ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСРегл
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСРегл ИНАЧЕ 0 КОНЕЦ)
			|	КОНЕЦ * &КоличествоПродукции)				КАК СуммаЗатрата,
			|	0											КАК НДД,
			|
			|// Стоимости с НДС
			|	0											КАК МатериальныеСНДС,
			|	0											КАК ТрудозатратыСНДС,
			|	0											КАК ПостатейныеПостоянныеСНДС,
			|	0											КАК ПостатейныеПеременныеСНДС,
			|	СУММА(ДетализацияСебестоимости.СтоимостьСНДС
			|			* &КоличествоПродукции)				КАК ДопРасходыСНДС,
			|
			|// Стоимости без НДС
			|	0											КАК МатериальныеБезНДС,
			|	0											КАК ПостатейныеПостоянныеБезНДС,
			|	0											КАК ПостатейныеПеременныеБезНДС,
			|	СУММА(ДетализацияСебестоимости.СтоимостьБезНДС
			|			* &КоличествоПродукции)				КАК ДопРасходыБезНДС,
			|
			|// Стоимости Упр
			|	0											КАК МатериальныеУпр,
			|	0											КАК ТрудозатратыУпр,
			|	0											КАК ПостатейныеПостоянныеУпр,
			|	0											КАК ПостатейныеПеременныеУпр,
			|	СУММА((ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСУпр ИНАЧЕ 0 КОНЕЦ))
			|			* &КоличествоПродукции)				КАК ДопРасходыУпр,
			|	0											КАК СтоимостьЗабалансоваяУпр,
			|
			|// Стоимости Регл
			|	0											КАК МатериальныеРегл,
			|	0											КАК ТрудозатратыРегл,
			|	0											КАК ПостатейныеПостоянныеРегл,
			|	0											КАК ПостатейныеПеременныеРегл,
			|	СУММА((ДетализацияСебестоимости.СтоимостьБезНДСРегл
			|			+ (ВЫБОР КОГДА &ВключитьНДСВСтоимость ТОГДА ДетализацияСебестоимости.НДСРегл ИНАЧЕ 0 КОНЕЦ))
			|			* &КоличествоПродукции)				КАК ДопРасходыРегл,
			|	0											КАК СтоимостьЗабалансоваяРегл,
			|
			|// Налоговый учет
			|	0 КАК НалоговыйУчет,
			|	0 КАК ПостояннаяРазница,
			|	0 КАК ВременнаяРазница,
			|
			|// Включение исключение НДС в стоимости
			|	0 КАК ВключениеИсключениеНДСВСтоимости
			|ИЗ
			|	РегистрСведений.ДетализацияСебестоимостиТоваровПостатейныеЗатраты КАК ДетализацияСебестоимости
			|		
			|ГДЕ 
			|	ДетализацияСебестоимости.Период МЕЖДУ НАЧАЛОПЕРИОДА(&ДатаИсходнойПартии, МЕСЯЦ) И КОНЕЦПЕРИОДА(&ДатаИсходнойПартии, МЕСЯЦ)
			|	И ДетализацияСебестоимости.Партия В (&ПартииПродукции)
			|	И ДетализацияСебестоимости.АналитикаУчетаПартий В (&АналитикиУчетаПартийПродукции)
			|	И ДетализацияСебестоимости.АналитикаУчетаНоменклатуры В (&АналитикаУчетаЗатрата)
			|	И ДетализацияСебестоимости.РазделУчета В (
			|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
			|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
			|	И НЕ ВЫБОР
			|			КОГДА &ДанныеПоСебестоимости = 1
			|				ТОГДА ДетализацияСебестоимости.СтоимостьСНДС
			|			КОГДА &ДанныеПоСебестоимости = 2
			|				ТОГДА ДетализацияСебестоимости.СтоимостьБезНДС
			|			КОГДА &ДанныеПоСебестоимости = 3
			|				ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСУпр
			|			КОГДА &ДанныеПоСебестоимости = 4
			|				ТОГДА ДетализацияСебестоимости.СтоимостьБезНДСРегл
			|		КОНЕЦ = 0
			|	И ВЫБОР
			|		КОГДА ДетализацияСебестоимости.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
			|			ТОГДА ИСТИНА	
			|		КОГДА &ДанныеПоСебестоимости = 4
			|			ТОГДА ДетализацияСебестоимости.СтатьяРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
			|		ИНАЧЕ ДетализацияСебестоимости.СтатьяРасходов.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
			|	КОНЕЦ 
			|
			|СГРУППИРОВАТЬ ПО
			|	ДетализацияСебестоимости.Организация,
			|	ДетализацияСебестоимости.Партия,
			|	ДетализацияСебестоимости.АналитикаУчетаНоменклатуры,
			|	ДетализацияСебестоимости.АналитикаУчетаПартий,
			|	ДетализацияСебестоимости.ДокументПоступления,
			|	ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления,
			|	ДетализацияСебестоимости.АналитикаРасходов,
			|	ВЫБОР
			|		КОГДА ДетализацияСебестоимости.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
			|			ТОГДА ЕСТЬNULL(ДетализацияСебестоимости.АналитикаУчетаПартийДокументаПоступления.ВидЦенности, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка))
			|		ИНАЧЕ ДетализацияСебестоимости.СтатьяРасходов
			|	КОНЕЦ
			|";
		
		ТекстыЗапроса.Добавить(ТекстДопРасходыОбъединение);
	
	КонецЕсли;
	
#КонецОбласти
		
	Возврат ТекстМатериальныеЗатраты
			+ СтрСоединить(ТекстыЗапроса, " ОБЪЕДИНИТЬ ВСЕ ");
	
КонецФункции

#Область ЗапросПоВыпущеннойПродукции

Функция ЗапросВыпущеннаяПродукция(ПараметрыУзла, ПомещатьВВТ = Ложь)
	
	Если ПараметрыУзла.ИнтерактивнаяНастройка Тогда
		АдаптироватьЗапросСКД(ПараметрыУзла.СхемаКД);
		КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
		МакетКомпоновки = КомпоновщикМакета.Выполнить(ПараметрыУзла.СхемаКД, ПараметрыУзла.НастройкиКД,,, Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));
		
		НаборДанных = МакетКомпоновки.НаборыДанных.Найти("ВыпущеннаяПродукция");
		
		ПараметрыЗапроса = МакетКомпоновки.ЗначенияПараметров;
		КлючПараметра = "Имя";
	Иначе
		НаборДанных = ПараметрыУзла.СхемаКД.НаборыДанных.Найти("ВыпущеннаяПродукция");
		
		Отборы = ПараметрыУзла.Отборы; 
		
		Отборы.Вставить("ЗаВесьПериод",				Не ЗначениеЗаполнено(Отборы.ДатаНачала) И Не ЗначениеЗаполнено(Отборы.ДатаОкончания));
		Отборы.Вставить("ПоВсемОрганизациям",		Не ЗначениеЗаполнено(Отборы.Организации));
		Отборы.Вставить("ПоВсемПодразделениям",		Не ЗначениеЗаполнено(Отборы.Подразделения));
		Отборы.Вставить("ПоВсейПродукции",			Не ЗначениеЗаполнено(Отборы.Продукция));
		Отборы.Вставить("ПоВсемХарактеристикам",	Не ЗначениеЗаполнено(Отборы.ХарактеристикиПродукции));
		// При наличии отбора по аналитике учета партий, отбор по сериям не имеет смысла, т.к. аналитика учета партий определяет строку выпуска продукции.
		Отборы.Вставить("ПоВсемСериям",				Не ЗначениеЗаполнено(Отборы.СерииПродукции) ИЛИ ЗначениеЗаполнено(Отборы.АналитикиУчетаПартийПродукции));
		Отборы.Вставить("ПоВсемНазначениям",		Не ЗначениеЗаполнено(Отборы.НазначенияПродукции));
		Отборы.Вставить("ПоВсемПартиям",			Не ЗначениеЗаполнено(Отборы.ПартииПродукции));
		Отборы.Вставить("ПоВсемАналитикамПартий",	Не ЗначениеЗаполнено(Отборы.АналитикиУчетаПартийПродукции));
		Отборы.Вставить("РасшифровкаДвиженийДокумента", ЗначениеЗаполнено(Отборы.Регистраторы));
		
		ПараметрыЗапроса = ПараметрыУзла.Отборы;
		КлючПараметра = "Ключ";
	КонецЕсли;
	
	ТекстЗапроса = НаборДанных.Запрос;
	ТекстЗапроса = Лев(ТекстЗапроса, СтрНайти(ТекстЗапроса, ";", НаправлениеПоиска.СКонца) - 1);
	
	Если Не ПараметрыУзла.ИнтерактивнаяНастройка Тогда
		ТекстУсловия = 
		"И (&ЗаВесьПериод
		|		ИЛИ СебестоимостьТоваров.Период МЕЖДУ &ДатаНачала И &ДатаОкончания)
		|	И (&ПоВсемОрганизациям
		|		ИЛИ СебестоимостьТоваров.Организация В (&Организации))
		|	И (&ПоВсемПодразделениям
		|		ИЛИ СпрПодразделения.Ссылка В (&Подразделения))
		|	И (&ПоВсейПродукции
		|		ИЛИ КлючиАналитики.Номенклатура В (&Продукция))
		|	И (&ПоВсемПартиям
		|		ИЛИ СебестоимостьТоваров.Партия В (&ПартииПродукции))
		|	И (&ПоВсемХарактеристикам
		|		ИЛИ КлючиАналитики.Характеристика В (&ХарактеристикиПродукции))
		|	И (&ПоВсемСериям
		|		ИЛИ КлючиАналитики.Серия В (&СерииПродукции))
		|	И (&ПоВсемНазначениям
		|		ИЛИ КлючиАналитики.Назначение В (&НазначенияПродукции))
		|	И (&ПоВсемАналитикамПартий
		|		ИЛИ СебестоимостьТоваров.АналитикаУчетаПартий В (&АналитикиУчетаПартийПродукции))";
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "И &ТекстУсловия", ТекстУсловия);
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Если Не ПомещатьВВТ Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПОМЕСТИТЬ ВыпущеннаяПродукция", "");
		ТекстСортировка = 
		"УПОРЯДОЧИТЬ ПО
		|	ВтПродукция.ПродукцияПредставление,
		|	ВтПродукция.ХарактеристикаПродукцииПредставление,
		|	ВтПродукция.СерияПродукцииПредставление,
		|	ВтПродукция.НазначениеПродукцииПредставление,
		|	ВтПродукция.ПартияПродукции
		|;
		|";
		ТекстЗапроса = ТекстЗапроса + ТекстСортировка;
	Иначе
		ТекстЗапроса = ТекстЗапроса + ";";
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	УстановитьПараметрыДереваСебестоимости(Запрос, ПараметрыЗапроса, КлючПараметра);
	Возврат Запрос;
	
КонецФункции

Процедура УстановитьПараметрыДереваСебестоимости(Запрос, ПараметрыЗапроса, КлючПараметра)
	
	Для Каждого ТекПараметр Из ПараметрыЗапроса Цикл
		Запрос.УстановитьПараметр(ТекПараметр[КлючПараметра], ТекПараметр.Значение);
	КонецЦикла;
	
	Запрос.УстановитьПараметр("ТипыНалогообложенияНДСНеУчитываетсяВСтоимости",
		УчетНДСУП.ТипыНалогообложенияНДСНеУчитываетсяВСтоимости());
	Запрос.УстановитьПараметр("ТипыНалогообложенияНДСУчитываетсяВСтоимости",
		УчетНДСУП.ВидыДеятельностиНДСУчитываетсяВСтоимости());
	
	Запрос.УстановитьПараметр("ТипЗатратПродукция",    НСтр("ru = 'Продукция';
															|en = 'Manufactured product'"));
	Запрос.УстановитьПараметр("ТипЗатратМатериальные", НСтр("ru = 'Материальные';
															|en = 'Material costs'"));
	Запрос.УстановитьПараметр("ТипЗатратТрудозатраты", НСтр("ru = 'Трудозатраты';
															|en = 'Labor costs'"));
	Запрос.УстановитьПараметр("ТипЗатратПостатейные",  НСтр("ru = 'Постатейные';
															|en = 'Itemized costs'"));
	Запрос.УстановитьПараметр("ТипЗатратДопРасходы",   НСтр("ru = 'Доп. расходы';
															|en = 'Additional expenses'"));
	
КонецПроцедуры

Процедура АдаптироватьЗапросСКД(СхемаКомпоновки) Экспорт
	
	НаборДанных = СхемаКомпоновки.НаборыДанных.Найти("ВыпущеннаяПродукция");
	
	Если НаборДанных = Неопределено Тогда
		ВызватьИсключение НСтр("ru = 'Изменен перечень наборов данных схемы компоновки дерева себестоимости.';
								|en = 'List of data sets of cost tree composition schema is changed.'");
	Иначе
		НаборДанных.Запрос = СтрЗаменить(НаборДанных.Запрос, "И &ТекстУсловия", "");
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СтруктураДереваСебестоимости

Процедура ПустоеДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла)
	
	Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
		ПараметрыДерева.Результат = Новый ДеревоЗначений;
		ИнициализироватьПоляДереваСебестоимости(ПараметрыДерева.Результат);
	ИначеЕсли ПараметрыДерева.ТипРезультата = "ТаблицаЗначений" Тогда
		ПараметрыДерева.Результат = Новый ТаблицаЗначений;
		ИнициализироватьПоляДереваСебестоимости(ПараметрыДерева.Результат);
	Иначе
		ПараметрыДерева.Результат = Новый МенеджерВременныхТаблиц;
	КонецЕсли;
	
КонецПроцедуры

Процедура ИнициализироватьПоляДереваСебестоимости(Результат)
	
	СтруктураПолей = СтруктураПолейДереваСебестоимости();
	
	Для Каждого ТекПоле Из СтруктураПолей Цикл
		Если ТекПоле.Значение = Неопределено Тогда
			Результат.Колонки.Добавить(ТекПоле.Ключ);
		Иначе
			Результат.Колонки.Добавить(ТекПоле.Ключ, ТекПоле.Значение);
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Функция СтруктураПолейДереваСебестоимости()
	
	СтруктураПолей = Новый Структура;
	
	СтруктураПолей.Вставить("ВидСтроки",
		Новый ОписаниеТипов("ПеречислениеСсылка.ВидыСтрокДереваСебестоимости"));
		
	СтруктураПолей.Вставить("Идентификатор",
		Новый ОписаниеТипов("УникальныйИдентификатор"));
	
	СтруктураПолей.Вставить("АналитикаУчетаПродукции",
		Новый ОписаниеТипов("СправочникСсылка.КлючиАналитикиУчетаНоменклатуры"));
	
	СтруктураПолей.Вставить("АналитикаУчетаВыходноеИзделие",
		Новый ОписаниеТипов("СправочникСсылка.КлючиАналитикиУчетаНоменклатуры"));
	
	ТипыАналитикиЗатрат = Новый Массив;
	ТипыАналитикиЗатрат.Добавить(Тип("СправочникСсылка.КлючиАналитикиУчетаНоменклатуры"));
	ТипыАналитикиЗатрат.Добавить(Тип("СправочникСсылка.ВидыРаботСотрудников"));
	ТипыАналитикиЗатрат.Добавить(Тип("ПланВидовХарактеристикСсылка.СтатьиРасходов"));
	ТипыАналитикиЗатрат = Новый ОписаниеТипов(ТипыАналитикиЗатрат);
	СтруктураПолей.Вставить("АналитикаУчетаЗатрата", ТипыАналитикиЗатрат);
	
	ТипыАналитикиУчетаПартий = Новый ОписаниеТипов("СправочникСсылка.КлючиАналитикиУчетаПартий");
	СтруктураПолей.Вставить("АналитикаУчетаПартий",					ТипыАналитикиУчетаПартий);
	СтруктураПолей.Вставить("АналитикаУчетаПартийПродукции",		ТипыАналитикиУчетаПартий);
	СтруктураПолей.Вставить("АналитикаУчетаПартийВыходноеИзделие",	ТипыАналитикиУчетаПартий);
	СтруктураПолей.Вставить("АналитикаУчетаПартийЗатрата",			ТипыАналитикиУчетаПартий);
	
	СтруктураПолей.Вставить("Организация",
		Новый ОписаниеТипов("СправочникСсылка.Организации"));
		
	СтруктураПолей.Вставить("Подразделение",
		Новый ОписаниеТипов("СправочникСсылка.СтруктураПредприятия"));
	
	СтруктураПолей.Вставить("ТипЗатрат",
		Новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(255)));
	
	СтруктураПолей.Вставить("ТребуетсяРазузлование",
		Новый ОписаниеТипов("Булево"));
		
	СтруктураПолей.Вставить("ТребуетсяРазузлованиеДопРасходов",
		Новый ОписаниеТипов("Булево"));
	
	СтруктураПолей.Вставить("ЕдиницаИзмерения",
		Новый ОписаниеТипов("СправочникСсылка.УпаковкиЕдиницыИзмерения"));
	
	ТипыЗатраты = Новый Массив;
	ТипыЗатраты.Добавить(Тип("СправочникСсылка.Номенклатура"));
	ТипыЗатраты.Добавить(Тип("СправочникСсылка.ВидыРаботСотрудников"));
	ТипыЗатраты.Добавить(Тип("ПланВидовХарактеристикСсылка.СтатьиРасходов"));
	ТипыЗатраты.Добавить(Тип("Строка"));
	ТипыЗатраты = Новый ОписаниеТипов(ТипыЗатраты,,Новый КвалификаторыСтроки(255));
	СтруктураПолей.Вставить("Номенклатура", ТипыЗатраты);
	
	СтруктураПолей.Вставить("Характеристика",
		Новый ОписаниеТипов("СправочникСсылка.ХарактеристикиНоменклатуры"));
	
	СтруктураПолей.Вставить("Серия",
		Новый ОписаниеТипов("СправочникСсылка.СерииНоменклатуры"));
	
	СтруктураПолей.Вставить("Назначение",
		Новый ОписаниеТипов("СправочникСсылка.Назначения"));
		
	СтруктураПолей.Вставить("Валюта",
		Новый ОписаниеТипов("СправочникСсылка.Валюты"));
	
	СтруктураПолей.Вставить("СтатьяКалькуляции",
		Новый ОписаниеТипов("СправочникСсылка.СтатьиКалькуляции"));
	
	СтруктураПолей.Вставить("Уровень",
		Новый ОписаниеТипов("Число"));
	
	ТипыПартий = Новый ОписаниеТипов(Метаданные.ОпределяемыеТипы.ДокументПартии.Тип.Типы());
	СтруктураПолей.Вставить("Партия",					ТипыПартий);
	СтруктураПолей.Вставить("ПартияПродукции",			ТипыПартий);
	СтруктураПолей.Вставить("ПартияВыходноеИзделие",	ТипыПартий);
	СтруктураПолей.Вставить("ПартияЗатрата",			ТипыПартий);
	
	ТипЧисла = Новый ОписаниеТипов("Число",,, Новый КвалификаторыЧисла(19, 6));
	СтруктураПолей.Вставить("Количество",			ТипЧисла);
	СтруктураПолей.Вставить("Числитель",			ТипЧисла);
	СтруктураПолей.Вставить("Знаменатель",			ТипЧисла);
	
	// Стоимости согласно параметру "ДанныеПоСебестоимости"
	СтруктураПолей.Вставить("Сумма",					ТипЧисла);
	СтруктураПолей.Вставить("СуммаЗабалансовая",		ТипЧисла);
	СтруктураПолей.Вставить("Материальные",				ТипЧисла);
	СтруктураПолей.Вставить("Трудозатраты",				ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянные",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременные",	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходы",				ТипЧисла);
	СтруктураПолей.Вставить("НДД",						ТипЧисла);
	
	// Стоимости с НДС
	СтруктураПолей.Вставить("МатериальныеСНДС",				ТипЧисла);
	СтруктураПолей.Вставить("ТрудозатратыСНДС",				ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянныеСНДС",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременныеСНДС", 	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходыСНДС",				ТипЧисла);
	
	// Стоимости без НДС
	СтруктураПолей.Вставить("МатериальныеБезНДС",			ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянныеБезНДС",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременныеБезНДС",	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходыБезНДС",				ТипЧисла);
	
	// Стоимости Упр
	СтруктураПолей.Вставить("МатериальныеУпр",				ТипЧисла);
	СтруктураПолей.Вставить("ТрудозатратыУпр",				ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянныеУпр",		ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременныеУпр",		ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходыУпр",				ТипЧисла);
	СтруктураПолей.Вставить("СтоимостьЗабалансоваяУпр",		ТипЧисла);
	
	// Стоимости Регл
	СтруктураПолей.Вставить("МатериальныеРегл",				ТипЧисла);
	СтруктураПолей.Вставить("ТрудозатратыРегл",				ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянныеРегл",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременныеРегл",	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходыРегл",				ТипЧисла);
	СтруктураПолей.Вставить("СтоимостьЗабалансоваяРегл",	ТипЧисла);
	
	// Налоговый учет
	СтруктураПолей.Вставить("НалоговыйУчет",				ТипЧисла);
	СтруктураПолей.Вставить("ПостояннаяРазница",			ТипЧисла);
	СтруктураПолей.Вставить("ВременнаяРазница",				ТипЧисла);
	
	Возврат СтруктураПолей;
	
КонецФункции

#КонецОбласти


#КонецОбласти

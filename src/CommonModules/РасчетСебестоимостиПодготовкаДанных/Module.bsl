#Область ПрограммныйИнтерфейс

// Этап подготовки к расчету
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ПодготовкаИсходныхДанныхКРасчету(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПодготовкаДанныхЛокализация.ПодготовкаИсходныхДанныхКРасчету(ПараметрыРасчета);
	
	ПерепровестиДокументыПоРегистрам(ПараметрыРасчета);
	
	// Исправим проблемы в движениях и в самих документах в рассчитываемом периоде.
	ИсправитьПроблемыВДвиженияхИДокументах(ПараметрыРасчета);
	
	ОчиститьДанныеУпрРегистров(ПараметрыРасчета);
	
	// Проверим корректность исходных данных для расчета.
	РасчетСебестоимостиПрикладныеАлгоритмы.ПроверитьКорректностьИсходныхДанныхДоРасчета(ПараметрыРасчета);
	
	// Обновим кэши регистров, данные которых были изменены в этой процедуре.
	РасчетСебестоимостиПрикладныеАлгоритмы.ОбновитьРасчетныеКэшиРегистров(ПараметрыРасчета, Истина);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ПерепровестиДокументыПоРегистрам(ПараметрыРасчета)
	
	// Перепроведение документов выполняется в автотестах на файловой базе.
	Если НЕ ПараметрыРасчета.АвтоматическоеТестирование
	 ИЛИ НЕ РасчетСебестоимостиПовтИсп.ЗначенияТехнологическихПараметров().ПерепроводитьДокументыПоРегистрам Тогда
		Возврат;
	КонецЕсли;
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПерепровестиДокументыПоРегистрам");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	#Область СебестоимостьТоваров_ВыручкаИСебестоимостьПродаж
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	ДД.Регистратор           КАК Ссылка,
	|	ДД.Организация           КАК Организация,
	|	1						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК ДД
	|ГДЕ
	|	ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДД.Организация В (&МассивОрганизаций)
	|	И НЕ ДД.РасчетПартий
	|	И НЕ ДД.РасчетСебестоимости
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ВыручкаИСебестоимостьПродаж""	         КАК ИмяРегистра,
	|	ДД.Регистратор                           КАК Ссылка,
	|	ДД.АналитикаУчетаПоПартнерам.Организация КАК Организация,
	|	2							             КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ДД
	|ГДЕ
	|	ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДД.АналитикаУчетаПоПартнерам.Организация В (&МассивОрганизаций)
	|	И НЕ ДД.РасчетПартий
	|	И НЕ ДД.РасчетСебестоимости
	|";
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Перепроведение документов по регистру ""Себестоимость товаров"" при автотестировании';
											|en = 'Repost documents in the ""Inventory cost"" register upon automatic testing'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Перепроведение документов по регистру ""Выручка и себестоимость продаж"" при автотестировании';
											|en = 'Repost documents in the ""Revenue and cost of goods sold"" register upon automatic testing'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'перепроведение документов по регистрам при автотестировании';
			|en = 'repost documents in registers upon automatic testing'", ОбщегоНазначения.КодОсновногоЯзыка()),
		Неопределено, // Дополнительные поля
		Истина // Только перепроведение
		);
		
	#КонецОбласти
	
	#Область ПрочиеРасходы
	
	Запрос.УстановитьПараметр("ТипыДокументовОСиНМА", РасчетСебестоимостиПрикладныеАлгоритмы.ТипыДокументовОСиНМА());
	Запрос.УстановитьПараметр("ТипыДокументовРегламентные", РасчетСебестоимостиПрикладныеАлгоритмы.ТипыДокументовРегламентные());
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.Регистратор КАК Ссылка,
	|	ДД.Организация КАК Организация
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК ДД
	|ГДЕ
	|	ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДД.Организация В (&МассивОрганизаций)
	|	И НЕ ДД.РасчетПартий
	|	И НЕ ДД.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(ДД.Регистратор) В (&ТипыДокументовОСиНМА)
	|	И НЕ ТИПЗНАЧЕНИЯ(ДД.Регистратор) В (&ТипыДокументовРегламентные)
	|
	//++ НЕ УТ
	|ОБЪЕДИНИТЬ // могут быть выбраны одинаковые документы в обоих запросах
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.Регистратор КАК Ссылка,
	|	ДД.Организация КАК Организация
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика2_5 КАК ОтчетПереработчика
	|		ПО ОтчетПереработчика.Ссылка = ДД.Регистратор
	|ГДЕ
	|	ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДД.Организация В (&МассивОрганизаций)
	|	И ДД.РасчетСебестоимости
	//-- НЕ УТ
	|";
	ВыборкаДокументов = Запрос.Выполнить().Выбрать();
	
	ОписаниеРегистра = ПараметрыРасчета.Движения[Метаданные.РегистрыНакопления.ПрочиеРасходы.Имя];
	ОписаниеРегистра.НадоОбновитьРасчетныйКэш = Истина;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВосстановитьДвиженияДокументовПоРегиструНакопления(
		ПараметрыРасчета, 
		ВыборкаДокументов, 
		Метаданные.РегистрыНакопления.ПрочиеРасходы.Имя);
		
	#КонецОбласти
	
	#Область ПартииПрочихРасходов
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.Регистратор КАК Ссылка,
	|	ДД.Организация КАК Организация
	|ИЗ
	|	РегистрНакопления.ПартииПрочихРасходов КАК ДД
	|ГДЕ
	|	ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДД.Организация В (&МассивОрганизаций)
	|	И НЕ ДД.РасчетПартий
	|	И НЕ ДД.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(ДД.Регистратор) В (&ТипыДокументовОСиНМА)
	|";
	ВыборкаДокументов = Запрос.Выполнить().Выбрать();
	
	ОписаниеРегистра = ПараметрыРасчета.Движения[Метаданные.РегистрыНакопления.ПартииПрочихРасходов.Имя];
	ОписаниеРегистра.НадоОбновитьРасчетныйКэш = Истина;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВосстановитьДвиженияДокументовПоРегиструНакопления(
		ПараметрыРасчета, 
		ВыборкаДокументов, 
		Метаданные.РегистрыНакопления.ПартииПрочихРасходов.Имя);
		
	#КонецОбласти
	
КонецПроцедуры

// Механизм, аналогичный по своему назначению механизму обновления ИБ.
// Выполняется при расчете конкретного периода и исправляет документы только этого периода.
//
// Исправляет проблемы в движениях документов и в самих документах в рассчитываемом периоде.
//
// Есть ошибки, которые "портят" исходные данные для расчета,
// но для исправления их последствий не пишется обработчик обновления.
// Например, из-за какой-то старой ошибки в каких-то случаях движения документа были некорректны.
// - если для исправления этой ошибки написать обработчик обновления,
// то он изменит данные прошлых, "закрытых" периодов, из-за чего эти периоды перестанут быть "закрытыми".
// Придется повторно закрывать эти периоды, из-за чего в них может измениться себестоимость и, как следствие,
// регламентированная отчетность. Это плохо, т.к. по этим периодам отчетность уже может быть сдана.
// - с другой стороны, в тех периодах, которые пользователь будет пересчитывать, эту ошибку в движениях надо бы исправить,
// чтобы в этих пересчитанных периодах себестоимость основывалась на правильных исходных данных.
//
// Для исправления таких ошибок и предназначена данная процедура.
// По сути, она является аналогом обработчика обновления, исправляющего движения документов в периоде, указанном пользователем.
//
// Также эта процедура используется для корректировки движений периода при его перерасчете в партионном учете версии 2.2.
Процедура ИсправитьПроблемыВДвиженияхИДокументах(ПараметрыРасчета)
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ИсправитьПроблемыВДвиженияхИДокументах");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	СуществующиеВТДоЭтапа = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос);
	
	#Область ПоляПартионногоУчетаВерсии22
	
	// Проверим в первичных движениях документов корректность заполнения полей:
	// Партия, КорПартия, ТипЗаписи, аналитика учета партий, вид деятельности НДС.
	// Если поля заполнены некорректно, то, видимо, документ был проведен до перехода на партионный учет версии 2.2 -
	// надо перепровести документ по регистру, содержащему некорректные движения.
	// Если после перепроведения документа поля все равно заполнены некорректно, значит ошибка кроется
	// в процедурах формирования движений документа или в макете описания движений (для регистра себестоимости товаров).
	
	// Подготовим вспомогательные данные.
	ОписаниеЦепочек 		= РасчетСебестоимостиЗаполнениеПартий.ОписаниеЦепочекПартийТоваров(ПараметрыРасчета);
	ИспользуемыеТипыЗаписей = РасчетСебестоимостиПрикладныеАлгоритмы.ИспользуемыеТипыЗаписейВЦепочках(ОписаниеЦепочек);
	
	Запрос.УстановитьПараметр("ИспользуемыеТипыЗаписей", ИспользуемыеТипыЗаписей);
	//++ НЕ УТ
	Запрос.УстановитьПараметр("АналитическийУчетПоГруппамПродукции", ПолучитьФункциональнуюОпцию("АналитическийУчетПоГруппамПродукции"));
	//-- НЕ УТ
	
	#Область ТекстЗапроса
	
	// Подготовим запрос для формирования ВТРегистраторыСНекорректнымиДвижениями.
	ТекстЗапроса = "
	//++ НЕ УТ
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор				КАК Регистратор,
	|	Т.Организация				КАК Организация,
	|	Т.ПартияПроизводства		КАК ПартияПроизводства
	|ПОМЕСТИТЬ ВТДвиженияПрочиеРасходыНезавершенногоПроизводства
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходыНезавершенногоПроизводства КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (ТИП(Документ.РасчетСебестоимостиТоваров),
	|									ТИП(Документ.КорректировкаРегистров))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////

	//-- НЕ УТ
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.ВидДвижения			 КАК ВидДвижения,
	|	Т.Регистратор 			 КАК Регистратор,
	|	Т.Организация 			 КАК Организация,
	|	Т.АналитикаУчетаПартий	 КАК АналитикаУчетаПартий,
	|	Т.ВидДеятельностиНДС	 КАК ВидДеятельностиНДС
	|ПОМЕСТИТЬ ВТДвиженияПартииПрочихРасходов
	|ИЗ
	|	РегистрНакопления.ПартииПрочихРасходов КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	//++ Локализация
	|	И НЕ Т.Регистратор ССЫЛКА Документ.РаспределениеНДС
	//-- Локализация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор КАК Регистратор,
	|	Т.Организация КАК Организация,
	|	Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация
	|ПОМЕСТИТЬ ВозвратыТоваровНаДругойСклад
	|ИЗ
	|	ВТДвиженияСебестоимостьТоваров КАК Т
	|ГДЕ
	|	ТИПЗНАЧЕНИЯ(Т.Регистратор) В (ТИП(Документ.ВозвратТоваровОтКлиента), ТИП(Документ.ВозвратТоваровМеждуОрганизациями))
	|	И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор КАК Регистратор,
	|	Т.Организация,
	|	Т.ХозяйственнаяОперация
	|ПОМЕСТИТЬ РеализацииВПутиРазныйРазделУчета
	|ИЗ
	|	ВТДвиженияСебестоимостьТоваров КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|		ПО СебестоимостьТоваров.Регистратор = Т.Регистратор
	|		И СебестоимостьТоваров.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение)
	|		И СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СебестоимостьТоваров.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
	|		И СебестоимостьТоваров.ВидЗапасов = Т.ВидЗапасов
	|		И СебестоимостьТоваров.РазделУчета <> Т.РазделУчета
	|ГДЕ
	|	ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.РеализацияТоваровУслуг)
	|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
	|	И Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Реализация)
	|ИНДЕКСИРОВАТЬ ПО
	|    Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.ИмяРегистра КАК ИмяРегистра,
	|	Т.Ссылка 	  КАК Ссылка,
	|	Т.Организация КАК Организация,
	|	Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|	Т.КодОшибки   КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ (
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"" КАК ИмяРегистра,
	|		Т.Регистратор КАК Ссылка,
	|		Т.Организация КАК Организация,
	|		Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|		ВЫБОР
	|			КОГДА Правила.ПустоеЗначениеРегистратора ЕСТЬ NULL 
	|				ТОГДА 1
	|			КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА ВЫБОР
	|						КОГДА Т.ТипЗаписи В
	|							(ВЫБРАТЬ
	|								ТипыЗаписей.ТипЗаписиПриход
	|							 ИЗ
	|								ВТПравилаЗаполненияПоляТипЗаписи КАК ТипыЗаписей
	|							 ГДЕ
	|								ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИПЗНАЧЕНИЯ(ТипыЗаписей.ПустоеЗначениеРегистратора)
	|								И (ТипыЗаписей.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)
	|									ИЛИ Т.ХозяйственнаяОперация = ТипыЗаписей.ХозяйственнаяОперация)
	|								И (ТипыЗаписей.ПоложительноеКоличество = НЕОПРЕДЕЛЕНО
	|									ИЛИ Т.ПоложительноеКоличество = ТипыЗаписей.ПоложительноеКоличество))
	|							ТОГДА 0
	|						ИНАЧЕ 2
	|					КОНЕЦ
	|			ИНАЧЕ ВЫБОР
	|						КОГДА Т.ТипЗаписи В
	|							(ВЫБРАТЬ
	|								ТипыЗаписей.ТипЗаписиРасход
	|							 ИЗ
	|								ВТПравилаЗаполненияПоляТипЗаписи КАК ТипыЗаписей
	|							 ГДЕ
	|								ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИПЗНАЧЕНИЯ(ТипыЗаписей.ПустоеЗначениеРегистратора)
	|								И (ТипыЗаписей.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)
	|									ИЛИ Т.ХозяйственнаяОперация = ТипыЗаписей.ХозяйственнаяОперация)
	|								И (ТипыЗаписей.ПоложительноеКоличество = НЕОПРЕДЕЛЕНО
	|									ИЛИ Т.ПоложительноеКоличество = ТипыЗаписей.ПоложительноеКоличество))
	|						ТОГДА 0
	|					ИНАЧЕ 3
	|				КОНЕЦ
	|		КОНЕЦ КАК КодОшибки
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТПравилаЗаполненияПоляТипЗаписи КАК Правила
	|			ПО ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИПЗНАЧЕНИЯ(Правила.ПустоеЗначениеРегистратора)
	|				И (Правила.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)
	|					ИЛИ Т.ХозяйственнаяОперация = Правила.ХозяйственнаяОперация)
	|				И (Правила.ПоложительноеКоличество = НЕОПРЕДЕЛЕНО
	|					ИЛИ Т.ПоложительноеКоличество = Правила.ПоложительноеКоличество)
	|
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		ВЫБОР
	// Проверка кор. партии в расходных движениях при заполненной кор. организации (схема Интеркампани).
	|			КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая)
	|				И Т.КорОрганизация <> ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|				И НЕ Т.КорОрганизация В (&ОрганизацииСФИФОСкользящая)
	//++ НЕ УТ
	|				И НЕ ТИПЗНАЧЕНИЯ(Т.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|				И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА
	|					ВЫБОР
	|						КОГДА Т.КорПартия = НЕОПРЕДЕЛЕНО
	|							ТОГДА 0
	|						ИНАЧЕ 5
	|					КОНЕЦ
	|			КОГДА НЕ Т.Организация В (&ОрганизацииСФИФОСкользящая)
	|				И Т.КорОрганизация В (&ОрганизацииСФИФОСкользящая)
	|				И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				И Т.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|				ТОГДА
	|					ВЫБОР
	|						КОГДА Т.КорПартия = Т.Регистратор
	|							ТОГДА 0
	|						ИНАЧЕ 6
	|					КОНЕЦ
	// Проверка кор. партии в расходных движениях без кор. организации (изменение документа партии внутри одной организации).
	|			КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая)
	|				И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				И НЕ Т.КорРазделУчета В (ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
	|										ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение),
	|										ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка))
	|				И ЕСТЬNULL(Правила.ТипЗаписиРасход, НЕОПРЕДЕЛЕНО) = Т.ТипЗаписи
	//++ НЕ УТ
	|				И НЕ Т.КорСтатьяКалькуляции ЕСТЬ NULL
	//-- НЕ УТ
	|				И (
	// При списании на партии производства кор. партия должна быть заполнена.
	|					(
	//++ НЕ УТКА
	|						НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ЭтапПроизводства2_2)
	|						И
	//-- НЕ УТКА
	|						(ЕСТЬNULL(Правила.КорПартияВРасходе, ЛОЖЬ)
	|							И Т.КорПартия = НЕОПРЕДЕЛЕНО
	|						ИЛИ НЕ ЕСТЬNULL(Правила.КорПартияВРасходе, ЛОЖЬ)
	|							И НЕ Т.КорПартия = НЕОПРЕДЕЛЕНО)
	|						)
	//++ НЕ УТКА

	// Для этапа производства кор. партия заполняется партией производства этапа.
	|					ИЛИ (ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ЭтапПроизводства2_2)
	|						И (ЕСТЬNULL(Правила.КорПартияВРасходе, ЛОЖЬ)
	|							И Т.КорПартия <> ЭтапыПроизводства.ПартияПроизводства
	|							ИЛИ НЕ ЕСТЬNULL(Правила.КорПартияВРасходе, ЛОЖЬ)
	|								И Т.КорПартия = ЭтапыПроизводства.ПартияПроизводства)
	|					)
	//++ Устарело_Переработка24
	|
	// Для отчета переработчика по этапам кор. партия заполняется партией производства этапа.
	|					ИЛИ (ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтчетПереработчика)
	|						И ЕСТЬNULL(ОтчетыПереработчика.ГруппировкаЗатрат,
	|							ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПустаяСсылка)) =
	|								ЗНАЧЕНИЕ(Перечисление.ГруппировкиЗатратВЗаказеПереработчику.ПоЭтапамПроизводства)
	|						И (ЕСТЬNULL(Правила.КорПартияВРасходе, ЛОЖЬ)
	|							И ТИПЗНАЧЕНИЯ(СпрПартииПроизводства.Документ) <> ТИП(Документ.ЗаказНаПроизводство2_2)
	|							ИЛИ НЕ ЕСТЬNULL(Правила.КорПартияВРасходе, ЛОЖЬ)
	|								И ТИПЗНАЧЕНИЯ(СпрПартииПроизводства.Документ) = ТИП(Документ.ЗаказНаПроизводство2_2))
	|						)
	//-- Устарело_Переработка24
	|
	//-- НЕ УТКА
	|				)
	|				ТОГДА 6
	//++ НЕ УТ
	|			КОГДА НЕ Т.Организация В (&ОрганизацииСФИФОСкользящая)
	|				И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				И Т.КорПартия = Т.Регистратор
	|				И НЕ Т.КорРазделУчета В (ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
	|										ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение),
	|										ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
	|				И НЕ Т.КорСтатьяКалькуляции ЕСТЬ NULL
	|				ТОГДА 5
	//-- НЕ УТ
	|			ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТПравилаЗаполненияПоляТипЗаписи КАК Правила
	|			ПО ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИПЗНАЧЕНИЯ(Правила.ПустоеЗначениеРегистратора)
	|				И (Правила.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)
	|					ИЛИ Т.ХозяйственнаяОперация = Правила.ХозяйственнаяОперация)
	|				И (Правила.ПоложительноеКоличество = НЕОПРЕДЕЛЕНО
	|					ИЛИ Т.ПоложительноеКоличество = Правила.ПоложительноеКоличество)
	//++ НЕ УТКА
	|			ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК ЭтапыПроизводства
	|			ПО ЭтапыПроизводства.Ссылка = Т.Регистратор
	|
	//++ Устарело_Переработка24
	|			ЛЕВОЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК ОтчетыПереработчика
	|			ПО ОтчетыПереработчика.Ссылка = Т.Регистратор
	//-- Устарело_Переработка24
	|
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|			ПО СпрПартииПроизводства.Ссылка = Т.КорПартия
	//-- НЕ УТКА
	|	ГДЕ
	|		НЕ Т.Сторно
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		ВЫБОР
	|			КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И Правила.ДокументИсточникВПриходе И Т.ДокументИсточник = НЕОПРЕДЕЛЕНО
	|			  ТОГДА 18
	|			КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И Правила.ДокументИсточникВРасходе И Т.ДокументИсточник = НЕОПРЕДЕЛЕНО
	|			  ТОГДА 19
	|			  ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТПравилаЗаполненияПоляТипЗаписи КАК Правила
	|			ПО ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИПЗНАЧЕНИЯ(Правила.ПустоеЗначениеРегистратора)
	|				И (Правила.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка)
	|					ИЛИ Т.ХозяйственнаяОперация = Правила.ХозяйственнаяОперация)
	|				И (Правила.ПоложительноеКоличество = НЕОПРЕДЕЛЕНО
	|					ИЛИ Т.ПоложительноеКоличество = Правила.ПоложительноеКоличество)
	|				И (Правила.ДокументИсточникВПриходе И Т.ТипЗаписи = Правила.ТипЗаписиПриход
	|					ИЛИ Правила.ДокументИсточникВРасходе И Т.ТипЗаписи = Правила.ТипЗаписиРасход)
	|	ГДЕ
	|		ВЫБОР
	|			КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И Правила.ДокументИсточникВПриходе И Т.ДокументИсточник = НЕОПРЕДЕЛЕНО
	|			  ТОГДА 18
	|			КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И Правила.ДокументИсточникВРасходе И Т.ДокументИсточник = НЕОПРЕДЕЛЕНО
	|			  ТОГДА 19
	|			  ИНАЧЕ 0
	|		КОНЕЦ <> 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"" КАК ИмяРегистра,
	|		Т.Регистратор КАК Ссылка,
	|		Т.Организация КАК Организация,
	|		Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|		ВЫБОР
	|			КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая) И Т.Партия = НЕОПРЕДЕЛЕНО
	|				ТОГДА 4
	|			КОГДА НЕ (Т.Организация В (&ОрганизацииСФИФОСкользящая)) И Т.Партия <> НЕОПРЕДЕЛЕНО
	|			  И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|			  И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
	|			  И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	//++ НЕ УТ
	|			  И НЕ (Т.РазделУчета В(ЗНАЧЕНИЕ (Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
	|											ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение))
	|					И НЕ Т.СтатьяКалькуляции ЕСТЬ NULL)
	//-- НЕ УТ
	|				ТОГДА 5
	|			ИНАЧЕ 0
	|		КОНЕЦ КАК КодОшибки
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		(Т.ТипЗаписи В (&ТипыЗаписейПервичныхПартий)
	|		ИЛИ Т.ТипЗаписи В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|			И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.КорректировкаРеализации)
	|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
	|			И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		И НЕ Т.Сторно
	|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|			И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности)
	|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
	|			И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		7
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		НЕ (Т.ТипЗаписи В (&ИспользуемыеТипыЗаписей))
	|		И НЕ (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей))
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		8
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК Аналитики
	|			ПО Т.АналитикаУчетаПартий = Аналитики.Ссылка
	|	ГДЕ
	|		Аналитики.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		9
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК Аналитики
	|			ПО Т.КорАналитикаУчетаПартий = Аналитики.Ссылка
	|	ГДЕ
	|		Аналитики.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ПартииПрочихРасходов"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		8
	|	ИЗ
	|		ВТДвиженияПартииПрочихРасходов КАК Т
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК Аналитики
	|			ПО Т.АналитикаУчетаПартий = Аналитики.Ссылка
	|	ГДЕ
	|		Аналитики.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ПартииПрочихРасходов"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		10
	|	ИЗ
	|		ВТДвиженияПартииПрочихРасходов КАК Т
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК Аналитики
	|			ПО Т.АналитикаУчетаПартий = Аналитики.Ссылка
	|	ГДЕ
	|		Т.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		11
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК Аналитики
	|			ПО Т.АналитикаУчетаПартий = Аналитики.Ссылка
	|
	|	ГДЕ
	|		Т.Организация В (&ОрганизацииСФИФОСкользящая)
	|		И Т.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
	|									ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
	|									ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И НЕ Т.Сторно
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) В (
	//++ НЕ УТКА
	|			ТИП(Документ.ЭтапПроизводства2_2),
	//-- НЕ УТКА

	//++ Устарело_Производство21
	|			ТИП(Документ.ВыпускПродукции),
	//-- Устарело_Производство21
	
	//++ Устарело_Переработка24
	|			ТИП(Документ.ОтчетПереработчика),
	//-- Устарело_Переработка24
	|			ТИП(Документ.ПроизводствоБезЗаказа))
	|		И ЕСТЬNULL(Аналитики.КодСтроки, 0) = 0
	|		И НЕ Т.Сторно
	//-- НЕ УТ
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		12
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Возвраты.Регистратор,
	|		Возвраты.Организация,
	|		Возвраты.ХозяйственнаяОперация,
	|		13
	|	ИЗ
	|		ВозвратыТоваровНаДругойСклад КАК Возвраты
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияСебестоимостьТоваров КАК Т
	|			ПО Т.Регистратор = Возвраты.Регистратор
	|			И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад)
	|	ГДЕ
	|		Т.Регистратор ЕСТЬ NULL
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		14
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|		И НЕ Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам))
	|
	//++ НЕ УТ

	//++ Устарело_Производство21
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		ДД.Регистратор,
	|		ДД.Организация,
	|		ДД.ХозяйственнаяОперация,
	|		15
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК ДД
	|	ГДЕ
	|		НЕ ДД.ПоложительноеКоличество
	|		И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		И ДД.Регистратор Ссылка Документ.ВыпускПродукции
	//-- Устарело_Производство21
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		ДД.Регистратор,
	|		ДД.Организация,
	|		ДД.ХозяйственнаяОперация,
	|		16
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК ДД
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрАналитикаУчетаНоменклатуры
	|		ПО СпрАналитикаУчетаНоменклатуры.Ссылка = ДД.АналитикаУчетаНоменклатуры
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
	|		ПО СпрНоменклатура.Ссылка = СпрАналитикаУчетаНоменклатуры.Номенклатура
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрКорАналитикаУчетаНоменклатуры
	|		ПО СпрКорАналитикаУчетаНоменклатуры.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
	|
	|	ГДЕ
	|		ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И НЕ (ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика2_5
	|			ИЛИ ДД.Регистратор ССЫЛКА Документ.Сторно И ДД.ДокументИсточник ССЫЛКА Документ.ОтчетПереработчика2_5)
	|		И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|		И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|			И (&АналитическийУчетПоГруппамПродукции
	|				И НЕ СпрНоменклатура.ГруппаАналитическогоУчета = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				И (ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|					ИЛИ (ДД.КорАналитикаФинансовогоУчета = НЕОПРЕДЕЛЕНО
	|							И (ЕСТЬNULL(СпрКорАналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая, ЛОЖЬ)
	|								ИЛИ СпрКорАналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|								ИЛИ СпрКорАналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер)
	|								)
	|						)
	|				)
	|				
	|			)
	|			ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|				И НЕ ДД.КорАналитикаФинансовогоУчета = НЕОПРЕДЕЛЕНО
	|		)
	//-- НЕ УТ
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		17
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией)
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
	|		И Т.ДокументИсточник = НЕОПРЕДЕЛЕНО
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		20
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		НЕ Т.Организация В (&ОрганизацииСФИФОСкользящая)
	|		И Т.КорАналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
	|		И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И (Т.СтоимостьРегл <> 0 ИЛИ Т.НДСРегл <> 0)
	|		И Т.ТипЗаписи В (
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения))
	|		И Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|		И НЕ Т.Сторно
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		21
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов)
	|		И Т.ПериодПродажи = ДАТАВРЕМЯ(1,1,1)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		22
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаРеглУчет)
	|		И Т.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	//++ НЕ УТ
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		23
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|		ПО СпрПартииПроизводства.Ссылка = Т.Партия
	|
	|	ГДЕ
	|		СпрПартииПроизводства.ИспользуетсяДляПерехода
	|		И НЕ ЕСТЬNULL(Т.АналитикаУчетаНоменклатуры.СтатьяКалькуляции,
	|			ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)) =
	|				ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		23
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК СпрПартииПроизводства
	|		ПО СпрПартииПроизводства.Ссылка = Т.КорПартия
	|
	|	ГДЕ
	|		СпрПартииПроизводства.ИспользуетсяДляПерехода
	|		И НЕ ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.СтатьяКалькуляции,
	|			ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)) =
	|				ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ПрочиеРасходыНезавершенногоПроизводства"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		23
	|	ИЗ
	|		ВТДвиженияПрочиеРасходыНезавершенногоПроизводства КАК Т
	|
	|	ГДЕ
	|		ЕСТЬNULL(Т.ПартияПроизводства.ИспользуетсяДляПерехода, ЛОЖЬ)
	//-- НЕ УТ
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		24
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ВыручкаИСебестоимостьПродаж
	|			ПО ВыручкаИСебестоимостьПродаж.Регистратор = Т.Регистратор
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.Организация = ЗНАЧЕНИЕ(Справочник.Организации.УправленческаяОрганизация)
	|		И Т.АналитикаУчетаПоПартнерам = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка)
	|		И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад)
	|		И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		25
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		(Т.КорАналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
	|			ИЛИ Т.КорАналитикаУчетаПартий = Т.АналитикаУчетаПартий) // По ошибке перезаполнился реквизит КорАналитикаУчетаПартий
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.ПриобретениеТоваровУслуг)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.КорректировкаПриобретения)
	|		И Т.ТипЗаписи В (
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
	|
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		26
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтчетПереработчика)
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|		И НЕ Т.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	//-- Устарело_Переработка24
	|	
	//++ Устарело_Производство21
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		27
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ВыпускПродукции)
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		И Т.ГруппаПродукции <> Т.АналитикаФинансовогоУчета
	|		И (
	|			Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|			И ТИПЗНАЧЕНИЯ(Т.АналитикаФинансовогоУчета) = Тип(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|			И Т.АналитикаФинансовогоУчета <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|			ИЛИ
	|			Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|			И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|			И Т.ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|			)
	//-- Устарело_Производство21

	//-- НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ВыручкаИСебестоимостьПродаж"",
	|		Т.Регистратор,
	|		Аналитика.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		28
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
	|			ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Аналитика.Организация В (&МассивОрганизаций)
	|		И Т.Активность
	|		И НЕ Т.РасчетПартий
	|		И НЕ Т.РасчетСебестоимости
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтчетПоКомиссииМеждуОрганизациями)
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		30
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт КАК Декларация
	|			ПО Декларация.Ссылка = Т.Регистратор
	|	ГДЕ
	|		Т.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		31
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		&УчитыватьСебестоимостьТоваровПоНазначениям
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И (Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) В (
	//++ НЕ УТ
	|			ТИП(Документ.ПроизводствоБезЗаказа),
	//-- НЕ УТ
	|			ТИП(Документ.СборкаТоваров))
	|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ПередачаТоваровМеждуОрганизациями))
	|
	|		И ЕСТЬNULL(Т.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
	|			<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		И ЕСТЬNULL(Т.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
	|			<> Т.ВидДеятельностиНДС
	|	
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		32
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК ПроизводствоБезЗаказа
	|			ПО ПроизводствоБезЗаказа.Ссылка = Т.Регистратор
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|		И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|		И Т.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|
	//++ НЕ УТКА
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		33
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК ЭтапПроизводства
	|			ПО ЭтапПроизводства.Ссылка = Т.Регистратор
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.АналитикаУчетаНоменклатуры = Т.КорАналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Т.КорРазделУчета
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаВПроизводство)
	//-- НЕ УТКА
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		34
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеВозвратныхОтходов КАК Реквизиты
	|			ПО Реквизиты.Ссылка = Т.Регистратор
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.Активность
	|		И Т.Организация В(&МассивОрганизаций)
	|		И НЕ Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|		И Т.Количество < 0
	//-- НЕ УТ

	//++ НЕ УТКА
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// Заполнение ДокументаДвижения для возвратных отходов этапов производства (баланс)
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		35
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Т.Организация В(&МассивОрганизаций)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ЭтапПроизводства2_2)
	|		И НЕ Т.СтоимостьРегл = 0
	|		И Т.ДокументДвижения = НЕОПРЕДЕЛЕНО
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// Заполнение ДокументаДвижения для возвратных отходов этапов производства (забаланс)
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		35
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Т.Организация В(&МассивОрганизаций)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ЭтапПроизводства2_2)
	|		И НЕ Т.СтоимостьЗабалансоваяРегл = 0
	|		И Т.ДокументДвижения = НЕОПРЕДЕЛЕНО
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	//-- НЕ УТКА
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		36
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК КорректировкаПриобретения
	|			ПО КорректировкаПриобретения.Ссылка = Т.Регистратор
	|	ГДЕ
	|		Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
	|		И Т.Стоимость <> 0
	|		ИЛИ
	|		Т.ТипЗаписи В (
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения))
	|		И Т.Количество = 0
	|		И Т.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ВключениеНДСВСтоимость)
	|		ИЛИ
	|		Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
	|		И Т.Количество = 0
	|		И Т.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|		И Т.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ЗакупкаУПоставщика)
	|	
	//++ НЕ УТ

	// После изменения флажка "Цеховая кладовая" в складе могут остаться движения с неправильным разделом учета.
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		37
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|		И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|		И Т.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ВыручкаИСебестоимостьПродаж"",
	|		Т.Регистратор,
	|		Аналитика.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		37
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
	|			ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Аналитика.Организация В (&МассивОрганизаций)
	|		И Т.Активность
	|		И НЕ Т.РасчетПартий
	|		И НЕ Т.РасчетСебестоимости
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|		И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|		И Т.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		38
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|		И НЕ Т.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ВыручкаИСебестоимостьПродаж"",
	|		Т.Регистратор,
	|		Аналитика.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		38
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
	|			ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Аналитика.Организация В (&МассивОрганизаций)
	|		И Т.Активность
	|		И НЕ Т.РасчетПартий
	|		И НЕ Т.РасчетСебестоимости
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|		И НЕ Т.АналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая
	//-- НЕ УТ
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ПартииПрочихРасходов"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		39
	|	ИЗ
	|		РегистрНакопления.ПартииПрочихРасходов КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПрочиеДоходыРасходы КАК Отбор
	|			ПО Т.Регистратор = Отбор.Ссылка
	|			И Отбор.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеклассификацияРасходов)
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Т.Организация В (&МассивОрганизаций)
	|		И Т.Активность
	|		И НЕ Т.РасчетПартий
	|		И НЕ Т.РасчетСебестоимости
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		40
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|		И Т.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		41
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.КорректировкаНазначенияТоваров)
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.АналитикаУчетаНоменклатуры = Т.КорАналитикаУчетаНоменклатуры
	|		И Т.ВидЗапасов = Т.КорВидЗапасов
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		42
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.КорСтоимость <> 0
	|		И Т.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровМеждуОрганизациями),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровСПереоценкой),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияПереданнойВозвратнойТары),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноПереданнойТары),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноПереданнойТарыВозвратНаДругойСклад),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаПартийТоваров))
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		43
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровСПереоценкой)
	|		И Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|		И Т.СтатьяДоходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)
	|	
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		44
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК ПартииПроизводства
	|			ПО ПартииПроизводства.Ссылка = Т.Партия
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) В (
	|			ТИП(Документ.ПроизводствоБезЗаказа),
	//++ НЕ УТКА
	|			ТИП(Документ.ЭтапПроизводства2_2),
	//-- НЕ УТКА
	|			ТИП(Документ.РаспределениеПроизводственныхЗатрат))
	|		И ПартииПроизводства.ВидДеятельностиНДС	<> Т.ВидДеятельностиНДС
	//-- НЕ УТ
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		45
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		И Т.ВидЗапасов.ТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|
	//++ НЕ УТКА
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		46
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВидыЗапасовМатериалы КАК ТабличнаяЧасть
	|			ПО ТабличнаяЧасть.Ссылка = Т.Регистратор
	|			И ТабличнаяЧасть.ИдентификаторСтроки = Т.ИдентификаторСтроки
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ЭтапПроизводства2_2)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	//-- НЕ УТКА
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		47
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ПриобретениеТоваровУслуг)
	|		И Т.ИдентификаторСтроки = """"
	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		48
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ИсправлениеРазвернутогоСальдоТоваровОрганизаций)
	|		И Т.ВидЗапасов = Т.КорВидЗапасов
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		49
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути))
	|		И Т.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|
	//++ НЕ УТ
	
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		51
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.РаспределениеПроизводственныхЗатрат)
	|		И Т.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		И (Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|			И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	//-- НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		52
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры, НЕОПРЕДЕЛЕНО)
	|			= ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		И Т.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|		И Т.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		53
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа.ВидыЗапасовПобочныеИзделия КАК ВидыЗапасов
	|			ПО ВидыЗапасов.Ссылка = Т.Регистратор
	|			И ВидыЗапасов.ИдентификаторСтроки = Т.ИдентификаторСтроки
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	//-- НЕ УТ

	//++ НЕ УТКА
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		54
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВидыЗапасовИзделия КАК ВидыЗапасов
	|			ПО ВидыЗапасов.Ссылка = Т.Регистратор
	|			И ВидыЗапасов.ИдентификаторСтроки = Т.ИдентификаторСтроки
	|			И ВидыЗапасов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	//-- НЕ УТКА
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		55
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|		И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		57
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
	|			ПО Реализация.Ссылка = Т.ДокументИсточник
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.Количество < 0
	|		И Т.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноРеализации),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионера))
	|		И (Т.ПериодПродажи < &НачалоПериода И Т.ПериодПродажи <> ДАТАВРЕМЯ(1,1,1)
	|			ИЛИ ЕСТЬNULL(Реализация.Дата, &НачалоПериода) < &НачалоПериода)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ВыручкаИСебестоимостьПродаж"",
	|		Т.Регистратор,
	|		Аналитика.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		57
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
	|			ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияСебестоимостьТоваров КАК Себестоимость
	|			ПО Себестоимость.Регистратор = Т.Регистратор
	|			И Себестоимость.ИдентификаторФинЗаписи = Т.ИдентификаторФинЗаписи
	|			И Себестоимость.ИдентификаторФинЗаписи <> """"
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
	|			ПО Реализация.Ссылка = Себестоимость.ДокументИсточник
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Аналитика.Организация В (&МассивОрганизаций)
	|		И Т.Активность
	|		И НЕ Т.РасчетПартий
	|		И НЕ Т.РасчетСебестоимости
	|		И Т.Количество < 0
	|		И Т.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноРеализации),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионера))
	|		И (Себестоимость.ПериодПродажи < &НачалоПериода И Себестоимость.ПериодПродажи <> ДАТАВРЕМЯ(1,1,1)
	|			ИЛИ ЕСТЬNULL(Реализация.Дата, &НачалоПериода) < &НачалоПериода)
	|
	//++ НЕ УТ
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// В разделе "Незавершенное производство" аналитика финансового учета должна соответствовать группе продукции из
	// партии производства, или иметь значение НЕОПРЕДЕЛЕНО, если группа продукции не заполнена.
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		58
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК ПартииПроизводства
	|			ПО ПартииПроизводства.Ссылка = Т.Партия
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)                                           
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|		И (&АналитическийУчетПоГруппамПродукции
	|			И ПартииПроизводства.ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|			И ПартииПроизводства.ГруппаПродукции <> Т.АналитикаФинансовогоУчета
	|			ИЛИ &АналитическийУчетПоГруппамПродукции
	|				И ПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				И Т.АналитикаФинансовогоУчета <> НЕОПРЕДЕЛЕНО
	|			ИЛИ НЕ &АналитическийУчетПоГруппамПродукции И Т.АналитикаФинансовогоУчета <> НЕОПРЕДЕЛЕНО
	|			)
	//++ Устарело_Переработка24
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	|
	//-- НЕ УТ
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		59
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияСебестоимостьТоваров КАК ДвиженияПриход
	|			ПО ДвиженияПриход.Регистратор = Т.Регистратор
	|			И ДвиженияПриход.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|			И ДвиженияПриход.АналитикаУчетаНоменклатуры = Т.КорАналитикаУчетаНоменклатуры
	|			И ДвиженияПриход.РазделУчета = Т.РазделУчета
	|			И ДвиженияПриход.ВидДеятельностиНДС = Т.КорВидДеятельностиНДС
	|	ГДЕ
	//		Проверка корреспонденции движений для переноса балансовой стоимости товаров в управленческую организацию
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет)
	|		И НЕ Т.РазделУчета В (&ЗабалансовыеРазделыУчета)
	|		И ДвиженияПриход.Регистратор ЕСТЬ NULL
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		60
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетКомиссионера)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтчетКомиссионера)
	|		И Т.ИдентификаторСтроки = """"
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		61
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидЗапасов.ТипЗапасов В (
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|		И Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		62
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов)
	|		И Т.Количество < 0
	|		И НЕ Т.Сторно
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ПартииПрочихРасходов"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		63
	|	ИЗ
	|		ВТДвиженияПартииПрочихРасходов КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
	|			ПО Корректировка.Ссылка = Т.Регистратор
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// Товары, переданные на комиссию по комиссионной продаже версии 2.5, учитываются в разделе "Товары переданные на комиссию",
	// кроме товаров, принятых на комиссию. Принятые на комиссию товаров и остаются на разделе учета "Товары принятые на комиссию".
	// На комиссию межно передавать только собственные товары, и товары, принятые на комиссию.
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		64
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		И Т.АналитикаУчетаНоменклатуры.Договор.ТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СКомиссионером)
	|		И НЕ Т.РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию))
	|	
	//++ Локализация
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// В себестоимости товаров не должно быть вида деятельности НДС "Экспорт". Такой вид деятельности преобразовывается в
	// "Экспорт сырьевых товаров, услуг (работ)" или "Экспорт несырьевых товаров".
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		65
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНаЭкспорт)
	|		ИЛИ Т.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНаЭкспорт)
	|		ИЛИ Т.ВидДеятельностиНДСДокумента = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНаЭкспорт)
	//-- Локализация
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	// В себестоимости товаров должна быть заполнена операция учета себестоимости для выбытий по фиксированной стоимости,
	// Это нужно для правильной работы процедуры СкорректироватьСтоимостьСписанияЗапасов().
	// В запросах этой процедуры есть условия на операцию учета себестоимости.
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		66
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.Количество <> 0
	|		И Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ПустаяСсылка)
	|		И Т.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровСПереоценкой))
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	// Реализация без перехода права собственности для комиссионного товара должна иметь одинаковый раздел учета
	|	ВЫБРАТЬ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		67
	|	ИЗ
	|		РеализацииВПутиРазныйРазделУчета КАК Т
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		""ВыручкаИСебестоимостьПродаж"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		67
	|	ИЗ
	|		РеализацииВПутиРазныйРазделУчета КАК Т
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// Исправление движений для типов записей с неправильным знаком количеста.
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		68
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И НЕ Т.Сторно
	|		И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|		И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияВРозницу)
	|		И (Т.Количество < 0 И Т.ТипЗаписи  = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|			ИЛИ Т.Количество > 0 И Т.ТипЗаписи  = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно))
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ВыручкаИСебестоимостьПродаж"",
	|		Т.Регистратор,
	|		Аналитика.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		70
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
	|			ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Аналитика.Организация В (&МассивОрганизаций)
	|		И Т.Активность
	|		И НЕ Т.РасчетПартий
	|		И НЕ Т.РасчетСебестоимости
	|		И Т.Количество <> 0
	|		И Т.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеПоВозврату)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		71
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		&УчитыватьСебестоимостьТоваровПоНазначениям
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|		И ЕСТЬNULL(Т.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
	|			<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		И ЕСТЬNULL(Т.АналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
	|			<> Т.ВидДеятельностиНДС
	|		И НЕ Т.Регистратор ССЫЛКА Документ.ЗаявлениеОВвозеТоваров
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""ПрочиеРасходы"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		72
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПрочиеРасходы КАК ПрочиеРасходы
	|			ПО ПрочиеРасходы.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|			И ПрочиеРасходы.Регистратор = Т.Регистратор
	|			И ПрочиеРасходы.ИдентификаторФинЗаписи = Т.ИдентификаторФинЗаписи
	|			И ПрочиеРасходы.НастройкаХозяйственнойОперации = Т.НастройкаХозяйственнойОперации
	|			И ПрочиеРасходы.ХозяйственнаяОперация <> Т.ХозяйственнаяОперация
	|	ГДЕ
	|		Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНаРасходыФиксированнаяСтоимость)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		73
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.НастройкаХозяйственнойОперации = ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ВключениеНДСВСтоимость)
	|		И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеНДСВСтоимость)
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ТаможеннаяДекларацияИмпорт)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		76
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|		И Т.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// Документы "ПередачаТоваровХранителю" и "ПоступлениеТоваровОтХранителя" не имеют данных о виде деятельности НДС,
	// поэтому для данных документов должен сохраняться вид деятельности НДС подобранной партии.
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		77
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.ВидДеятельностиНДСДокумента <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
	|			= ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		И (ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ПередачаТоваровХранителю)
	|			ИЛИ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ПоступлениеТоваровОтХранителя))
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// Если в документе указана одна и та же номенклатура и характеристика с одинаковым складом, назначением и серией
	// в нескольких строках, то во всех таких строках должна быть аналитика учета партий с одинаковым кодом строки,
	// что бы одинаковые строки формировали одну общую партию.
	// Запрос заполнения аналитики учета партий выполняется в функции ТекстЗапросаКодыСтрокДляАналитикиУчетаПартий()
	// общего модуля РасчетСебестоимостиПроведениеДокументов(). 
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		НЕОПРЕДЕЛЕНО,
	|		84
	|	ИЗ
	|		(ВЫБРАТЬ
	|			Т.Регистратор,
	|			Т.Организация,
	|			Т.АналитикаУчетаНоменклатуры,
	|			СУММА(1) КАК КоличествоСтрок,
	|			КОЛИЧЕСТВО(РАЗЛИЧНЫЕ Ключи.КодСтроки) КАК КоличествоКодовСтрок
	|		ИЗ
	|			ВТДвиженияСебестоимостьТоваров КАК Т
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК Ключи
	|			ПО Т.АналитикаУчетаПартий = Ключи.Ссылка
	|		ГДЕ
	|			Т.Количество > 0
	|			И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|			И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ПриобретениеТоваровУслуг)
	|			И Т.РазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|			И НЕ Т.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаРеглУчет),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость))
	|		СГРУППИРОВАТЬ ПО
	|			Т.Регистратор,
	|			Т.Организация,
	|			Т.АналитикаУчетаНоменклатуры
	|		) КАК Т
	|	ГДЕ
	|		Т.КоличествоСтрок > 1
	|		И Т.КоличествоКодовСтрок > 1
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	// До версии 2.5.14 в движениях документа "Сторно" по перемещению товаров заполнялся тип записи "Корректировка приобретения". 
	// После 2.5.14 тип записи поменялся на "Исправление перемещения прошлого периода". 
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		85
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|	ГДЕ
	|		Т.Сторно
	|		И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
	|		И Т.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуПодразделениями),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутреннееПоступлениеРабот),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзКладовой),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВПроизводство),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВКладовую),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратМатериаловИзПроизводства),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратМатериаловИзКладовой),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеПолуфабрикатов),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутреннееПоступлениеТоваров),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаХранениеСПравомПродажи),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссию),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПереработчику2_5),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваров),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика2_5),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтПереработчика2_5),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтХранителя),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера)
	|			)
	//++ НЕ УТ
	|		И ТИПЗНАЧЕНИЯ(Т.ДокументИсточник) <> ТИП(Документ.ПроизводствоБезЗаказа)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		""СебестоимостьТоваров"",
	|		Т.Регистратор,
	|		Т.Организация,
	|		Т.ХозяйственнаяОперация,
	|		87
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК ПартииПроизводства
	|			ПО ПартииПроизводства.Ссылка = Т.КорПартия
	|	ГДЕ
	|		Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|		И (&АналитическийУчетПоГруппамПродукции
	|			И ПартииПроизводства.ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|			И ПартииПроизводства.ГруппаПродукции <> Т.КорАналитикаФинансовогоУчета
	|			ИЛИ &АналитическийУчетПоГруппамПродукции
	|				И ПартииПроизводства.ГруппаПродукции = ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				И Т.КорАналитикаФинансовогоУчета <> НЕОПРЕДЕЛЕНО
	|			ИЛИ НЕ &АналитическийУчетПоГруппамПродукции И Т.КорАналитикаФинансовогоУчета <> НЕОПРЕДЕЛЕНО
	|			)
	//++ Устарело_Переработка24
	|		И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	|
	//-- НЕ УТ
	|	) КАК Т
	|
	|ГДЕ
	|	Т.КодОшибки <> 0
	|";
	
	Запрос.Текст = ТекстЗапросаВТДвиженияСебестоимостьТоваров() + ТекстЗапроса;
	
	#КонецОбласти
	
	// Сформируем описание возможных кодов ошибок в движениях.
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Для движения не найдено соответствующее ему правило заполнения типа записи';
											|en = 'A respective record type autofill rule is not found for the register record'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Тип записи приходного движения не соответствует правилу';
											|en = 'The record type of the receipt register record does not match the rule'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'Тип записи расходного движения не соответствует правилу';
											|en = 'The record type of the expense register record does not match the rule'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(4, НСтр("ru = 'Для организаций с методом оценки ""ФИФО (скользящая)"" не заполнена первичная партия';
											|en = 'Primary lot for companies with the ""FIFO (rolling valuation)"" evaluation method is not filled in'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(5, НСтр("ru = 'Для организаций с методом оценки, отличным от ""ФИФО (скользящая)"", заполнена первичная партия или кор. партия';
											|en = 'Primary lot or corr. lot is filled in for companies with evaluation method other than ""FIFO (rolling valuation)""'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(6, НСтр("ru = 'Для организаций с методом оценки ""ФИФО (скользящая)"" некорректно заполнена кор. партия в расходном движении';
											|en = 'For companies with the ""FIFO (rolling valuation)"" evaluation method, the correspondent lot is filled incorrectly in the expense register record'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(7, НСтр("ru = 'Тип записи, указанный в движении, не используется при распределении партий';
											|en = 'Record type specified in the movement is not used in lot allocation'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(8, НСтр("ru = 'Аналитика учета партий не содержит вида ценности';
											|en = 'Lot: vendor attributes do not contain an asset tax class'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(9, НСтр("ru = 'Кор. аналитика учета партий не содержит вида ценности';
											|en = 'Lot: vendor attributes (corr.) do not contain asset tax class'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(10, НСтр("ru = 'Не заполнен вид деятельности НДС при заполненной аналитике учета партий';
											|en = 'VAT activity type is not specified while lot: vendor attributes are filled in'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(11, НСтр("ru = 'Для аналитики учета партий выпуска изделий не заполнен код строки (продукции)';
											|en = 'Line (product) code is not specified for lot: vendor attributes of product release'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(12, НСтр("ru = 'Не заполнена кор. аналитика учета номенклатуры для операции ""Реализация (товары в пути)""';
											|en = 'Cor. inventory location attributes are not filled in for ""Customer invoice — Goods-in-transit""'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(13, НСтр("ru = 'Для документов возврата товаров от клиента/организации на склад, отличный от склада реализации, используются неправильные хозяйственные операции и типы записей';
											|en = 'Incorrect business transactions and record types are used for the documents for goods return from customer/company to the warehouse other than the sales warehouse'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(14, НСтр("ru = 'Не заполнен вид деятельности НДС у приходных движений с типом записи ""Партия""';
											|en = 'VAT activity type is not specified for receipt movements with the ""Lot"" record type'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(15, НСтр("ru = 'Для документов выпуска обнаружены отрицательные движения по возвратным отходам при производстве давальческой продукции';
											|en = 'Negative records of recyclable waste on production of material provider products are found for release documents.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(16, НСтр("ru = 'Неправильно заполнена аналитика учета выпуска возвратных отходов (кор. аналитика учета номенклатуры, кор. аналитика финансового учета).';
											|en = 'Accounting dimension of recyclable waste release is filled in incorrectly (corr. inventory location attributes, corr. financial accounting dimension).'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТ
	РасшифровкаКодовОшибок.Вставить(17, НСтр("ru = 'Не заполнен документ - источник для операции ""Дополнительные расходы с указанием документа партии"".';
											|en = 'Source document is required for the ""Additional expenses with lot document specification"" operation.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(18, НСтр("ru = 'Заполнение документа-источника в приходном движении не соответствует правилу.';
											|en = 'The source document population in the receipt register record does not match the rule.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(19, НСтр("ru = 'Заполнение документа-источника в расходном движении не соответствует правилу.';
											|en = 'The source document population in the expense register record does not match the rule.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(20, НСтр("ru = 'Не заполнена кор. аналитика учета партий приходных движений с типом записи ""Партия"" или ""Корректировка приобретения"" для организаций с методом оценки, отличным от ""ФИФО (скользящая)""';
											|en = 'Lot: vendor attributes (corr.) of receipt movements with the ""Batch"" or ""Purchase adjustment"" record type are not filled in for companies using an evaluation method different form ""FIFO (rolling valuation)""'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(21, НСтр("ru = 'Не заполнен период продажи для операции ""Возврат товаров от клиента прошлых периодов""';
											|en = 'Sale period is required for the ""Sales return request of previous periods"" operation'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(22, НСтр("ru = 'Не заполнены кор. реквизиты для операции ""Закупка по регл. учету""';
											|en = 'Cor. attributes are required for the ""Purchase by local accounting"" operation'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(23, НСтр("ru = 'В незавершенном производстве в качестве партии производства используется ссылка на служебный элемент справочника ""Партии производства""';
											|en = 'In unfinished production, a link to a service item of the ""Production lots"" catalog is used as a production lot'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТ
	РасшифровкаКодовОшибок.Вставить(24, НСтр("ru = 'Не заполнена аналитика учета по партнерам в движениях документов продажи';
											|en = 'Accounting dimension by partners is required for sales document register records'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(25, НСтр("ru = 'Не заполнена кор. аналитика учета партий в приходных движениях с типом записей ""Доп. расходы (не указана партия)"" и ""Доп. расходы (указана партия)""';
											|en = 'Lot: vendor attributes (corr.) are required for receipt movements with the ""Add. expenses (lot is not specified)"" and ""Add. expenses (lot is specified)"" record types'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(26, НСтр("ru = 'В движениях по распределению материалов в отчете переработчика заполнен реквизит ""Группа продукции"".';
											|en = '""Group products"" attribute is filled in material allocation movements in ""Subcontracting services notification received"".'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(27, НСтр("ru = 'В движениях по выпуску продукции отличается заполнение реквизитов ""Аналитика финансового учета"" и ""Группа продукции"".';
											|en = 'In product release movements, the ""Financial accounting dimension"" and ""Group products"" attributes are filled in differently.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТ
	РасшифровкаКодовОшибок.Вставить(28, НСтр("ru = 'Не корректно заполнен раздел учета для операции ""Отчет по комиссии между организациями""';
											|en = 'Accounting section for the ""Commission sales report — Intercompany"" operation is filled in incorrectly'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(30, НСтр("ru = 'Не корректно заполнен кор. вид деятельности НДС для документа ""Таможенная декларация на импорт"".';
											|en = 'The cor VAT activity kind is filled incorrectly for the ""Customs declaration for import"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(31, НСтр("ru = 'Не корректно заполнен вид деятельности НДС в приходном движении документа.';
											|en = 'The VAT activity type in receipt document register record is filled in incorrectly.'"));
	РасшифровкаКодовОшибок.Вставить(32, НСтр("ru = 'Не корректно заполнен тип записи в приходном движении для документа ""Производство без заказа"".';
											|en = 'The entry type in receipt movements for the document ""Backflush production"" is filled in incorrectly.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(33, НСтр("ru = 'Не корректные движения по изменению назначения работ для документа ""Этап производства"".';
											|en = 'Incorrect records to change the job assignments for the ""Production stage"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(34, НСтр("ru = 'Некорректные движения по разделу учета ""Производственные затраты"".';
											|en = 'Incorrect movements on the ""Production costs"" accounting section.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТКА
	РасшифровкаКодовОшибок.Вставить(35, НСтр("ru = 'Не заполнен реквизит ""Документ движения"" в движениях продукции по фиксированной стоимости.';
											|en = 'Attribute ""Transfer record"" is required for fixed-cost product transfer records.'"));
	//-- НЕ УТКА
	РасшифровкаКодовОшибок.Вставить(36, НСтр("ru = 'Некорректные движения документа ""Корректировка приобретения"".';
											|en = 'Invalid records in the ""Purchase adjustment"" document.'"));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(37, НСтр("ru = 'Неправильный раздел учета для движений в цеховой кладовой.';
											|en = 'Invalid accounting section for transfer in the shop floor stockrooms.'"));
	РасшифровкаКодовОшибок.Вставить(38, НСтр("ru = 'Неправильный раздел учета для движений по складу, который не является цеховой кладовой.';
											|en = 'Invalid accounting section for transfer in the warehouse which is not a shop floor stockroom.'"));
	//-- НЕ УТ
	РасшифровкаКодовОшибок.Вставить(39, НСтр("ru = 'Неправильный вид движения документа ""Отражение прочих доходов и расходов"".';
											|en = 'Incorrect type of register records of the ""Non-operating income and expenses"" document.'"));
	РасшифровкаКодовОшибок.Вставить(40, НСтр("ru = 'Неправильный раздел учета для товаров на хранении с правом продажи.';
											|en = 'Incorrect branch of accounting for goods at storage with sale right.'"));
	РасшифровкаКодовОшибок.Вставить(41, НСтр("ru = 'Некорректные движения документа ""Корректировка назначения товаров"" при отключенном учете себестоимости по назначениям.';
											|en = 'Incorrect records in the ""Inventory assignment adjustment"" document with disabled cost accounting by destinations.'"));
	РасшифровкаКодовОшибок.Вставить(42, НСтр("ru = 'В движениях заполнен реквизит ""Кор стоимость"".';
											|en = 'The ""Cor cost"" attribute is filled in the register records.'"));
	РасшифровкаКодовОшибок.Вставить(43, НСтр("ru = 'Не заполнена статья доходов в движениях документа ""Порча товаров"".';
											|en = 'The income item in the ""Stock quality change"" document records cannot be empty.'"));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(44, НСтр("ru = 'Вид деятельности НДС в приходном движении не соответствует партии производства.';
											|en = 'VAT activity in receipt record does not match production lot.'"));
	//-- НЕ УТ
	РасшифровкаКодовОшибок.Вставить(45, НСтр("ru = 'Неправильный раздел учета для собственных товаров.';
											|en = 'Incorrect accounting section for own goods items.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(46, НСтр("ru = 'Неправильный тип записи в движениях списания неизрасходованных материалов на расходы.';
											|en = 'Incorrect record type in transactions to write off unspent materials to expenses.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(47, НСтр("ru = 'Не заполнен идентификатор строки в движениях документа ""Приобретение товаров услуг"".';
											|en = 'The line ID is missing in the ""Vendor invoice"" document records.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(48, НСтр("ru = 'Лишние движения документа ""Исправление развернутого сальдо товаров организаций"".';
											|en = 'Extra records of the document ""Correction of detailed balance of company goods"".'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(49, НСтр("ru = 'Неправильный раздел учета ""Товары в пути (отгрузка без перехода права собственности)"" для комиссионных товаров.';
											|en = 'Incorrect branch of accounting ""Goods in transit (shipment without transfer of title to goods)"" for consignment goods.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(51, НСтр("ru = 'Не правильный раздел учета в движениях списания комиссионного товара.';
											|en = 'Incorrect branch of accounting in the consigned goods write-off records.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТ
	РасшифровкаКодовОшибок.Вставить(52, НСтр("ru = 'Неправильный кор. раздел учета при реализации работ между организациями.';
											|en = 'Incorrect corr. accounting section on implementation of works between companies.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(53, НСтр("ru = 'Неправильная хозяйственная операция в движениях выпуска побочных изделий на расходы.';
											|en = 'Incorrect business transaction in records of the by-products release for expenses.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТ

	//++ НЕ УТКА
	РасшифровкаКодовОшибок.Вставить(54, НСтр("ru = 'Неправильная хозяйственная операция в движениях выпуска побочных изделий на расходы.';
											|en = 'Incorrect business transaction in records of the by-products release for expenses.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТКА
	РасшифровкаКодовОшибок.Вставить(55, НСтр("ru = 'Неправильный раздел учета для товаров в пути от поставщиков.';
											|en = 'Incorrect branch of accounting for the goods in transit from vendors.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(57, НСтр("ru = 'Неправильная хозяйственная операция для возврата от клиента товаров, проданных в прошлом периоде.';
											|en = 'Incorrect business transaction for the return of goods sold in the previous period from the customer.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(58, НСтр("ru = 'Аналитика финансового учета в приходном движении не соответствует партии производства.';
											|en = 'Financial accounting dimension in the receipt document register record does not correspond to the production lot.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТ
	РасшифровкаКодовОшибок.Вставить(59, НСтр("ru = 'Не корректно заполнен кор. вид деятельности НДС в расходном движении ""Реализация (только регл. учет)"".';
											|en = 'The cor. VAT taxation in the ""Sales (only local accounting)"" expense record is filled in incorrectly.'"));
	РасшифровкаКодовОшибок.Вставить(60, НСтр("ru = 'Не заполнен идентификатор строки в движениях документа ""Отчет комиссионера"".';
											|en = 'Line ID in the ""Consignment issue notification"" document records is not filled in.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(61, НСтр("ru = 'Неправильный раздел учета для давальческих материалов, полуфабрикатов или продукции.';
											|en = 'Incorrect accounting section for provider materials, semi-finished products, and manufactured products.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(62, НСтр("ru = 'Неправильный знак у количества для операции ""Возврат товаров от клиента прошлых периодов""';
											|en = 'Invalid quantity sign for the ""Goods return from customer of previous periods"" operation'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(63, НСтр("ru = 'Не заполнена аналитика учета партий в движениях документа ""Корректировка приобретения"".';
											|en = 'Lot: vendor attributes of register records of the ""Purchase adjustment"" document is not filled.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(64, НСтр("ru = 'Неправильный раздел учета для товаров у комиссионера.';
											|en = 'Incorrect accounting section for goods held by a consignee.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ Локализация
	РасшифровкаКодовОшибок.Вставить(65, НСтр("ru = 'Вида деятельности НДС ""Экспорт"" не должно быть в движениях себестоимости товаров.';
											|en = 'The ""Export"" VAT taxation cannot be included in inventory cost records.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- Локализация
	РасшифровкаКодовОшибок.Вставить(66, НСтр("ru = 'Не заполнена операция учета себестоимости в движениях себестоимости товаров.';
											|en = 'Cost accounting operation is not filled in inventory cost register records.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(67, НСтр("ru = 'Некорректный раздел учета себестоимости в реализации комиссионного товара в пути.';
											|en = 'Incorrect cost accounting section in sales of consignment goods in transit.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(68, НСтр("ru = 'Не правильный знак у количества в расходном движении.';
											|en = 'Incorrect character in the quantity in the expense register record.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(70, НСтр("ru = 'Не заполнен вид деятельности НДС при возврате от клиента по указанной стоимости';
											|en = 'The VAT taxation is not filled upon sales return at the specified cost'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(71, НСтр("ru = 'Не корректно заполнен вид деятельности НДС в разделе ""Неотфактурованные поставки"".';
											|en = 'The VAT activity type in the ""Goods received not invoiced"" section is filled incorrectly.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(72, НСтр("ru = 'Не правильная хозяйственная операция для выпуска по фикс. стоимости в регистре ""Прочие расходы"".';
											|en = 'Incorrect business transaction for product release at fix. cost in the ""Other expenses"" register.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(73, НСтр("ru = 'Не правильный тип записи для движения по включению НДС в стоимость в регистре ""Себестоимость товаров"".';
											|en = 'Incorrect record type for the record of including VAT in cost in the ""Inventory cost"" register.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(76, НСтр("ru = 'Не заполнен вид деятельности НДС в движениях с типом записи ""Дополнение"" в регистре ""Себестоимость товаров"".';
											|en = 'Не заполнен вид деятельности НДС в движениях с типом записи ""Дополнение"" в регистре ""Себестоимость товаров"".'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(77, НСтр("ru = 'Заполнен вид деятельности НДС документа в движениях по регистру ""Себестоимость товаров"" у документов ""Передача товаров хранителю"" и ""Поступление товаров от хранителя"".';
											|en = 'Заполнен вид деятельности НДС документа в движениях по регистру ""Себестоимость товаров"" у документов ""Передача товаров хранителю"" и ""Поступление товаров от хранителя"".'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(84, НСтр("ru = 'Заполнены различные коды строк в аналитике учета партии приходного документа при одинаковых аналитиках в строках документа';
											|en = 'Заполнены различные коды строк в аналитике учета партии приходного документа при одинаковых аналитиках в строках документа'", ОбщегоНазначения.КодОсновногоЯзыка()));	
	РасшифровкаКодовОшибок.Вставить(85, НСтр("ru = 'Не правильный тип записи в сторно движениях перемещения товаров';
											|en = 'Не правильный тип записи в сторно движениях перемещения товаров'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//++ НЕ УТ
	РасшифровкаКодовОшибок.Вставить(87, НСтр("ru = 'Аналитика финансового учета в расходом движении не соответствует партии производства.';
											|en = 'Аналитика финансового учета в расходом движении не соответствует партии производства.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	//-- НЕ УТ
	
	ДополнительныеПоля = Новый Структура("ХозяйственнаяОперация", НСтр("ru = 'операция';
																		|en = 'transaction'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление ошибок в движениях документов';
			|en = 'error correction in document records'", ОбщегоНазначения.КодОсновногоЯзыка()),
		ДополнительныеПоля);
	
	#КонецОбласти
	
//++ НЕ УТ

//++ Устарело_Переработка24
	#Область СебестоимостьТоваровСуммыВОтчетеПереработчика
	
	// Исправление некорректных движений в регистре "Себестоимость товаров".
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Упр. стоимость в движениях по регистру ""Себестоимость товаров"" не приведена к валюте упр. учета';
											|en = 'Manag. cost of records in the ""Inventory cost"" register is not reduced to the manag. accounting currency'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.УстановитьПараметр("ВалютаУпр", Константы.ВалютаУправленческогоУчета.Получить());
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров""	КАК ИмяРегистра,
	|	Т.Регистратор				КАК Ссылка,
	|	Т.Организация				КАК Организация,
	|	1							КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ОтчетПереработчика КАК ОтчетыПереработчика
	|	ПО Т.Регистратор = ОтчетыПереработчика.Ссылка
	|
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтчетПереработчика)
	|	И НЕ &ВалютаУпр = Т.Организация.ВалютаРегламентированногоУчета
	|	И Т.Стоимость = Т.СтоимостьРегл
	|	И НЕ Т.Стоимость = 0
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'приведение стоимостей в отчете переработчика к валюте упр. учета';
			|en = 'reduce the subcontractor report costs to the man. accounting currency'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
//-- Устарело_Переработка24

//-- НЕ УТ

	#Область ВключениеУчетаСебестоимости
	
	РасшифровкаКодовОшибок = Новый Соответствие;	
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Включение учета себестоимости';
											|en = 'Enable cost accounting'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.УстановитьПараметр("ТипДокументаИмпорта", ОбщегоНазначения.ИдентификаторОбъектаМетаданных("Документ.ТаможеннаяДекларацияИмпорт"));
	
	Запрос.Текст = ТекстЗапросаВключениеУчетаСебестоимости();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'включение учета себестоимости';
			|en = 'Enable cost accounting'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти

	#Область ВыручкаИСебестоимостьПродаж
	
	// Исправление некорректных движений в регистре "Выручка и себестоимость продаж".
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Дублирование расчетной себестоимости в первичных движениях';
											|en = 'Duplication of estimated cost in primary records'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	СуществующиеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос);
	
	Запрос.Текст = ТекстЗапросаДокументыСДублямиДвиженийПоВыручкеИСебестоимостиПродаж();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'ошибка 00-00071689';
			|en = 'error 00-00071689'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	НовыеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос, СуществующиеВТ);
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, НовыеВТ);
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Пропавшие первичные движения по корректировке выручки';
											|en = 'Missing primary records on revenue adjustment'"));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Движения по регистру ""Выручка и себестоимость продаж"" не соответствуют движениям по регистру ""Себестоимость товаров""';
											|en = 'The ""Revenue and COGS"" register records do not correspond to the ""Inventory cost"" register records'"));
	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'Для работы не заполнен раздел учета в движениях по регистру ""Выручка и себестоимости продаж""';
											|en = 'To operate, an accounting section in the the ""Revenue and COGS"" register records is not filled'"));
	
	СуществующиеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос);
	
	Запрос.Текст = ТекстЗапросаДокументыСПропавшимиДвижениямиПоВыручкеИСебестоимостиПродаж();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений по регистру ""Выручка и себестоимость продаж""';
			|en = 'correction of records in the ""Revenue and COGS"" register'"));
	
	НовыеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос, СуществующиеВТ);
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, НовыеВТ);
	
	#КонецОбласти

	#Область НекорректнаяАналитикаФинансовогоУчета
	
	// Исправление некорректной пустой аналитики финансового учета в регистре "Себестоимость товаров".
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Пустая аналитика финансового учет в первичных движениях имеет значение отличное от НЕОПРЕДЕЛЕНО';
											|en = 'Empty dimension of financial accounting in primary records has a value different from UNDEFINED'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Пустая кор аналитика финансового учет в первичных движениях имеет значение отличное от НЕОПРЕДЕЛЕНО';
											|en = 'Empty adjustment dimension of financial accounting in primary records has a value different from UNDEFINED'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'Пустая аналитика финансового учет в первичных движениях отличается от кор аналитики финансового учета';
											|en = 'Empty dimension of financial accounting in primary records is different from cor. dimension of financial accounting'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	1 						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.АналитикаФинансовогоУчета В
	|		(ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка),
	|		 ЗНАЧЕНИЕ(Справочник.Пользователи.ПустаяСсылка),
	|		 ЗНАЧЕНИЕ(Справочник.СделкиСКлиентами.ПустаяСсылка),
	|		 ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	2 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.КорАналитикаФинансовогоУчета В
	|		(ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка),
	|		 ЗНАЧЕНИЕ(Справочник.Пользователи.ПустаяСсылка),
	|		 ЗНАЧЕНИЕ(Справочник.СделкиСКлиентами.ПустаяСсылка),
	|		 ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка))
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) В (
	|		ТИП(Документ.РеализацияТоваровУслуг),
	|		ТИП(Документ.ПеремещениеТоваров))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	3 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Движения
	|		ПО Движения.Период = Т.Период
	|		И Движения.Регистратор = Т.Регистратор
	|		И Движения.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И НЕ Движения.РасчетПартий
	|		И НЕ Движения.РасчетСебестоимости
	|		И Движения.КорАналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
	|		И Движения.КорВидЗапасов = Т.ВидЗапасов
	|		И Движения.КорАналитикаФинансовогоУчета = Т.АналитикаФинансовогоУчета
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Т.КорАналитикаФинансовогоУчета  <> НЕОПРЕДЕЛЕНО
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ПередачаТоваровМеждуОрганизациями)
	|	И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссиюВДругуюОрганизацию)
	|	И Движения.Регистратор ЕСТЬ NULL
	|";

	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление аналитики финансового учета в движениях';
			|en = 'correction of financial accounting dimension in records'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти

	#Область СуммыВДвижениях
	
	// Проверка соответствия заполненности суммы упр./регл. значениям функциональных опций.
	РасшифровкаКодовОшибок = Новый Соответствие;
	
	Шаблон1 = НСтр("ru = 'Заполнение упр. сумм в движениях не соответствует значению функциональной опции ""%Парам1%""';
					|en = 'Filling of the amounts, ENT in register records does not correspond to the value of the functional option ""%Парам1%""'", ОбщегоНазначения.КодОсновногоЯзыка());
	Шаблон1 = СтрЗаменить(Шаблон1, "%Парам1%", "ВестиУправленческийУчетОрганизаций");
	РасшифровкаКодовОшибок.Вставить(1,Шаблон1 );
	
	Шаблон1 = НСтр("ru = 'Заполнение регл. сумм в движениях не соответствует значению функциональной опции ""%Парам1%""';
					|en = 'Filling of the local amounts in register records does not correspond to the value of the functional option ""%Парам1%""'", ОбщегоНазначения.КодОсновногоЯзыка());
	Шаблон1 = СтрЗаменить(Шаблон1, "%Парам1%", "ИспользоватьУчетПрочихДоходовРасходовРегл");
	РасшифровкаКодовОшибок.Вставить(2,Шаблон1 );

	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'Заполнение суммы без НДС в движениях не соответствует варианту распределения статьи расходов';
											|en = 'Filling of amounts excluding VAT in the records does not match the expense item distribution option'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(4, НСтр("ru = 'Движения по регистру ""Прочие доходы"" сформированы без признака ""Расчет себестоимости"".';
											|en = 'Records of the ""Income"" register are created without the ""Cost calculation"" flag.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#Область ИсключаемыеТипыДокументов
	
	Запрос.УстановитьПараметр("ТипыДокументовОСиНМА", РасчетСебестоимостиПрикладныеАлгоритмы.ТипыДокументовОСиНМА());
	Запрос.УстановитьПараметр("ТипыРегламентныхДокументов", РасчетСебестоимостиПрикладныеАлгоритмы.ТипыДокументовРегламентные());
	
	#КонецОбласти
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	1 						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
	|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|		  И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию))
	|	И (Т.Стоимость <> 0 ИЛИ Т.КорСтоимость <> 0 ИЛИ Т.ДопРасходы <> 0 ИЛИ Т.Трудозатраты <> 0
	|		ИЛИ Т.ПостатейныеПостоянныеСНДС <> 0 ИЛИ Т.ПостатейныеПеременныеСНДС <> 0
	|		ИЛИ Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию))
	|	И НЕ Т.РазделУчета В (
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи))
	|	И ((&УправленческийУчетОрганизаций И (Т.СтоимостьБезНДС <> 0 ИЛИ Т.КорСтоимость <> 0
	|			ИЛИ Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
	|			 И Т.СтоимостьРегл <> 0
	|			 И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара))
	|		И Т.СтоимостьУпр = 0 И Т.ДопРасходыУпр = 0 И Т.ТрудозатратыУпр = 0
	|		И Т.ПостатейныеПостоянныеУпр = 0 И Т.ПостатейныеПеременныеУпр = 0)
	|	ИЛИ (НЕ &УправленческийУчетОрганизаций
	|		И (Т.СтоимостьУпр <> 0 ИЛИ Т.ДопРасходыУпр <> 0 ИЛИ Т.ТрудозатратыУпр <> 0
	|		ИЛИ Т.ПостатейныеПостоянныеУпр <> 0 ИЛИ Т.ПостатейныеПеременныеУпр <> 0)))
	|	И НЕ (Т.СтоимостьБезНДС = 0	И Т.ДопРасходы <> 0 И Т.ДопРасходыУпр = 0)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеДоходы"" 		 КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	ВЫБОР
	|		КОГДА Т.Сумма <> 0
	|			И Т.СуммаРегл = 0
	|			И &ИспользоватьУчетПрочихДоходовРасходовРегл
	|			И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|			ТОГДА 2
	|		КОГДА Т.СуммаРегл <> 0
	|			И НЕ &ИспользоватьУчетПрочихДоходовРасходовРегл
	|			И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|			ТОГДА 2
	|		ИНАЧЕ 1
	|	КОНЕЦ					 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПрочиеДоходы КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТКурсыВалютОрганизаций КАК Курсы
	|		ПО Т.Организация = Курсы.Организация
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|	И ((&УправленческийУчетОрганизаций
	|			И Т.СуммаУпр = 0
	|			И Т.Сумма <> 0)
	|		ИЛИ (НЕ &УправленческийУчетОрганизаций
	|			И Т.СуммаУпр <> 0)
	|		ИЛИ (Т.Сумма <> 0
	|			И Т.СуммаРегл = 0
	|			И НЕ (ВЫРАЗИТЬ(Т.Сумма * Курсы.КоэффициентВалютыУпр КАК ЧИСЛО(31,2)) МЕЖДУ -&ЗначениеПогрешностиСебестоимостьРегл И &ЗначениеПогрешностиСебестоимостьРегл)
	|			И &ИспользоватьУчетПрочихДоходовРасходовРегл)
	|		ИЛИ (Т.СуммаРегл <> 0
	|			И НЕ &ИспользоватьУчетПрочихДоходовРасходовРегл)
	|	  )
	|
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеДоходы"" 		 КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	4						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПрочиеДоходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетСебестоимости
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ВозвратТоваровОтКлиента)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеРасходы"" 		 КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	1 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И ((&УправленческийУчетОрганизаций И Т.СуммаУпр = 0 И Т.Сумма <> 0 И Т.СуммаРегл <> 0
	|			И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА))
	|		ИЛИ (НЕ &УправленческийУчетОрганизаций И Т.СуммаУпр <> 0
	|			И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеРасходы"" 		 КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	2 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.НачислениеРеверсивногоНДС)
	//++ Локализация
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.СчетФактураНалоговыйАгент)
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.СчетФактураПолученныйНалоговыйАгент)
	//-- Локализация
	
	// Корректировкой задолженности вся сумма задолженности может быть списана за счет резервов. При этом сумма регл в движениях будет равна 0.
	|	И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеБезнадежнойЗадолженностиЗаСчетРезервовПоСомнительнымДолгам)
	// В реализации услуг и прочих активов сумма регл. может быть не заполнена.
	|	И НЕ Т.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиенту),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СебестоимостьРеализацииНМА))
	// Если сумма без НДС равна 0, это значит что в документе указана только сумма НДС. При этом сумма регл не будет заполнена.
	|	И ((&ИспользоватьУчетПрочихДоходовРасходовРегл И Т.СуммаРегл = 0 И Т.Сумма <> 0 И Т.СуммаБезНДС <> 0
	|			И НЕ Т.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторнированиеРасходовУУ),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РегистрацияРасходовУУ))
	|			И НЕ Т.СтатьяРасходов.ВариантРаспределенияРасходовРегл В (
	|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы),
	|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПрочиеАктивы)))
	|		ИЛИ (НЕ &ИспользоватьУчетПрочихДоходовРасходовРегл И Т.СуммаРегл <> 0))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПартииПрочихРасходов"" КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	1 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПартииПрочихРасходов КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТКурсыВалютОрганизаций КАК Курсы
	|		ПО Т.Организация = Курсы.Организация
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И ((&УправленческийУчетОрганизаций И Т.Стоимость <> 0 И Т.НДСРегл <> 0 И Т.НДСУпр = 0
	|			И ВЫРАЗИТЬ(Т.НДСРегл * Курсы.КоэффициентВалютыРегл КАК ЧИСЛО(31,2)) <> 0
	|			И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА))
	|		ИЛИ (НЕ &УправленческийУчетОрганизаций И Т.НДСУпр <> 0)
	|		ИЛИ (Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РегистрацияРасходовУУ)
	|			И Т.НДСУпр <> 0))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПартииПрочихРасходов"" КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	2 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПартииПрочихРасходов КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТКурсыВалютОрганизаций КАК Курсы
	|		ПО Т.Организация = Курсы.Организация
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И ((&ИспользоватьУчетПрочихДоходовРасходовРегл И Т.Стоимость <> 0 И Т.СтоимостьРегл = 0 И Т.НДСРегл = 0 И Т.ПостояннаяРазница = 0 И Т.ВременнаяРазница = 0
	|			И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|			И НЕ Т.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторнированиеРасходовУУ),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РегистрацияРасходовУУ))
	|			И (Т.СтатьяРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
	//++ Локализация
	|				ИЛИ (Т.СтатьяРасходов.ВариантРаспределенияРасходовРегл В (
	|						ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты),
	|						ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьПроизводства))
	|					И Т.Организация В (&ОрганизацииСРаздельнымУчетомПостатейныхЗатрат))
	//-- Локализация
	|		  ))
	|		ИЛИ (НЕ &ИспользоватьУчетПрочихДоходовРасходовРегл И (Т.СтоимостьРегл <> 0 ИЛИ Т.НДСРегл <> 0 ИЛИ Т.ПостояннаяРазница <> 0 ИЛИ Т.ВременнаяРазница <> 0)))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ВыручкаИСебестоимостьПродаж"" КАК ИмяРегистра,
	|	Т.Регистратор 			        КАК Ссылка,
	|	Аналитика.Организация 			КАК Организация,
	|	1 						        КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
	|		ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Аналитика.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И ((&УправленческийУчетОрганизаций И Т.Стоимость <> 0 И Т.СтоимостьУпр = 0)
	|		ИЛИ (НЕ &УправленческийУчетОрганизаций И Т.СтоимостьУпр <> 0))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// Проверка заполнения суммы без НДС в движениях.
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеРасходы"" 		 КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	3 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.НачислениеРеверсивногоНДС)
	//++ Локализация
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.СчетФактураНалоговыйАгент)
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.СчетФактураПолученныйНалоговыйАгент)
	//-- Локализация
	// Сумма без НДС может быть не заполнена, если в в документе указана сумма НДС равная сумме документа.
	// В этом случае сумма без НДС и сумма регл будут равны 0. 
	|	И Т.Сумма <> 0 И Т.СуммаБезНДС = 0 И Т.СуммаРегл <> 0
	|	И НЕ Т.СтатьяРасходов.ВариантРаспределенияРасходовУпр В (
	|		ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы),
	|		ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПрочиеАктивы))
	|	И НЕ Т.Сторно
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректное заполнение сумм упр. учета';
			|en = 'amounts, ENT are filled in incorrectly'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти

//++ НЕ УТ

//++ Устарело_Переработка24
	#Область ВыпускПродукции
	
	// Исправление движений по регистру Выпуск продукции
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Требуется сформировать движения по регистру ""Выпуск продукции"" для отчетов переработчиков';
											|en = 'Generate records in the ""Product release"" register for subcontractor reports'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Требуется удалить движения по регистру ""Выпуск продукции"" для поступлений от переработчиков';
											|en = 'Delete records in the ""Product release"" register for subcontractor receipts'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ВыпускПродукции"" 	 КАК ИмяРегистра,
	|	Реквизиты.Ссылка 		 КАК Ссылка,
	|	Реквизиты.Организация 	 КАК Организация,
	|	1 						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	Документ.ОтчетПереработчика КАК Реквизиты
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ВыпускПродукции КАК Т
	|	ПО Реквизиты.Ссылка = Т.Регистратор
	|ГДЕ
	|	Реквизиты.Проведен
	|	И Реквизиты.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Реквизиты.Организация В (&МассивОрганизаций)
	|	И Т.Регистратор ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ВыпускПродукции"" 	 КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	2 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ВыпускПродукции КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И Т.Регистратор Ссылка Документ.ПоступлениеОтПереработчика
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректные движения по регистру ""Выпуск продукции""';
			|en = 'incorrect records in the ""Product release"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
//-- Устарело_Переработка24
	
//++ НЕ УТКА
#Область БалансоваяСтоимостьПоПродукцииСОформлениемОтчетаДавальца
	
	// Исправление движений по регистру Выпуск продукции
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Продукция давальца, по которой необходимо отчитаться, не должна иметь плановую стоимость.';
											|en = 'Manufactured products of material provider for which it is necessary to report should not have a standard cost.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор,
	|	Т.Организация,
	|   (Т.Стоимость = 0
	|		И Т.СтоимостьБезНДС = 0
	|		И Т.СтоимостьРегл = 0
	|		И Т.СтоимостьУпр = 0) КАК ПустыеСуммы
	|ПОМЕСТИТЬ ПредварительныеРегистраторы
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ДвижениеПродукцииИМатериалов КАК ТоварыДвижения
	|		ПО Т.Регистратор = ТоварыДвижения.Ссылка
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|	И Т.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
	|								ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзКладовой))
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров""	КАК ИмяРегистра,
	|	Регистраторы.Регистратор	КАК Ссылка,
	|	Регистраторы.Организация	КАК Организация,
	|	1 						 	КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	ПредварительныеРегистраторы КАК Регистраторы
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ДвижениеПродукцииИМатериалов.Товары КАК ТаблицаТовары
	|		ПО Регистраторы.Регистратор = ТаблицаТовары.Ссылка
	|				
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВыходныеИзделия КАК ИзделияЭтапа
	|		ПО ТаблицаТовары.Распоряжение = ИзделияЭтапа.Ссылка
	|			И ТаблицаТовары.КодСтроки = ИзделияЭтапа.КодСтроки
	|ГДЕ
	|	Регистраторы.ПустыеСуммы
	//++ Устарело_Переработка24
	|		И НЕ ИзделияЭтапа.ОформитьОтчетДавальцу
	//-- Устарело_Переработка24
	|		И НЕ ТаблицаТовары.Сумма = 0
	//++ Устарело_Переработка24
	|	ИЛИ НЕ Регистраторы.ПустыеСуммы
	|		И ИзделияЭтапа.ОформитьОтчетДавальцу
	//-- Устарело_Переработка24
	|;
	|УНИЧТОЖИТЬ ПредварительныеРегистраторы";
			
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректные движения по регистру ""Себестоимость товаров""';
			|en = 'incorrect records in the ""Inventory cost"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
#КонецОбласти
//-- НЕ УТКА
	
	#Область ТрудозатратыНЗП
	
	// Подготовим запрос для формирования ВТРегистраторыСНекорректнымиДвижениями.
	// Исключаем документы "ОтражениеЗарплатыВФинансовомУчете", так как они должны быть проведены в самом конце.
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ТрудозатратыНезавершенногоПроизводства""	КАК ИмяРегистра,
	|	Т.Регистратор								КАК Ссылка,
	|	Т.Организация								КАК Организация,
	|	1											КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.ТрудозатратыНезавершенногоПроизводства КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И НЕ Т.РасчетПартий
	|	И ЕСТЬNULL(Т.ПартияПроизводства.ИспользуетсяДляПерехода, ЛОЖЬ)
	//++ Локализация
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтражениеЗарплатыВФинансовомУчете)
	//-- Локализация
	|";
	
	// Сформируем описание возможных кодов ошибок в движениях.
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'В незавершенном производстве в качестве партии производства используется ссылка на документ партии, а не на справочник ""Партии производства""';
											|en = 'In unfinished production, a reference to lot document is used instead of the reference to the ""Production lots"" catalog'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'переход на новую партию производства';
			|en = 'transfer to new production lot'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	// Подготовим запрос для формирования ВТРегистраторыСНекорректнымиДвижениями.
	// Выбираем только документы "ОтражениеЗарплатыВФинансовомУчете", так как все остальные уже перепроведены.
	Запрос.Текст = " 
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ТрудозатратыНезавершенногоПроизводства""	КАК ИмяРегистра,
	|	Т.Регистратор								КАК Ссылка,
	|	Т.Организация								КАК Организация,
	|	1											КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.ТрудозатратыНезавершенногоПроизводства КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И НЕ Т.РасчетПартий
	|	И ЕСТЬNULL(Т.ПартияПроизводства.ИспользуетсяДляПерехода, ЛОЖЬ)
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректные движения ""Трудозатраты НЗП""';
			|en = 'incorrect records ""Labor costs of WIP""'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти

	#Область ДвиженияНоменклатураНоменклатура
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Не сформированы количественные движения по регистру ""Движения Номенклатура - Номенклатура"".';
											|en = 'Quantitative register records ""Line item records"" are not generated.'"));
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор				КАК Ссылка,
	|	Т.Организация				КАК Организация
	|ПОМЕСТИТЬ ВТДвиженияСебестоимостиСписаниеВПроизводстве
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Т.КорАналитикаУчетаНоменклатуры <> Т.АналитикаУчетаНоменклатуры
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) В (
	//++ НЕ УТКА
	|		ТИП(Документ.ЭтапПроизводства2_2),
	//-- НЕ УТКА
	|		ТИП(Документ.ПроизводствоБезЗаказа))
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка
	|;
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор КАК Ссылка
	|ПОМЕСТИТЬ ВТДвиженияНоменклатураСписаниеВПроизводстве
	|ИЗ
	|	РегистрНакопления.ДвиженияНоменклатураНоменклатура КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) В (
	//++ НЕ УТКА
	|		ТИП(Документ.ЭтапПроизводства2_2),
	//-- НЕ УТКА
	|		ТИП(Документ.ПроизводствоБезЗаказа))
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка
	|;
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ДвиженияНоменклатураНоменклатура""	КАК ИмяРегистра,
	|	Себестоимость.Ссылка					КАК Ссылка,
	|	Себестоимость.Организация				КАК Организация,
	|	1 										КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	ВТДвиженияСебестоимостиСписаниеВПроизводстве КАК Себестоимость
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияНоменклатураСписаниеВПроизводстве КАК Движения
	|		ПО Движения.Ссылка = Себестоимость.Ссылка
	|ГДЕ
	|	Движения.Ссылка ЕСТЬ NULL
	|";

	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документов производства по регистру ""Движения номенклатура-номенклатура""';
			|en = 'correction of production document records on the register ""Line item records""'"));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(
		ПараметрыРасчета,
		"ВТДвиженияСебестоимостиСписаниеВПроизводстве, ВТДвиженияНоменклатураСписаниеВПроизводстве");
	
	#КонецОбласти
//-- НЕ УТ

	#Область ДвиженияНоменклатураДоходыРасходы
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Сформированы некорректные движения по регистру ""Движения Номенклатура - Доходы/Расходы"".';
											|en = 'Invalid records were generated for the ""Items - Income/Expenses"" register.'"));
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор				КАК Ссылка,
	|	Т.Период					КАК Период,
	|	Т.Организация				КАК Организация
	|ПОМЕСТИТЬ ВТДвиженияСебестоимостиСписаниеВПроизводстве
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка,
	|	Период
	|;
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор 				КАК Ссылка,
	|	Т.Период	  				КАК Период
	|ПОМЕСТИТЬ ВТДвиженияНоменклатураСписаниеВПроизводстве
	|ИЗ
	|	РегистрНакопления.ДвиженияНоменклатураДоходыРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка,
	|	Период
	|;
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ДвиженияНоменклатураДоходыРасходы""	КАК ИмяРегистра,
	|	Себестоимость.Ссылка					КАК Ссылка,
	|	Себестоимость.Организация				КАК Организация,
	|	1 										КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	ВТДвиженияСебестоимостиСписаниеВПроизводстве КАК Себестоимость
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияНоменклатураСписаниеВПроизводстве КАК Движения
	|		ПО Движения.Ссылка = Себестоимость.Ссылка
	|		 И Движения.Период = Себестоимость.Период
	|ГДЕ
	|	Движения.Ссылка ЕСТЬ NULL
	|";

	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документов по регистру ""Движения номенклатура доходы-расходы""';
			|en = 'correction of document records on the register ""Items - Income/Expenses""'"));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(
		ПараметрыРасчета,
		"ВТДвиженияСебестоимостиСписаниеВПроизводстве, ВТДвиженияНоменклатураСписаниеВПроизводстве");
	
	#КонецОбласти

	#Область НаправлениеДеятельностиВПрочихРасходах
		
	// В регистрах "Прочие расходы" и "Партии прочих расходов" направление деятельности заполняется только при включенном
	// учете затрат по направлению деятельности. 
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Заполнено направление деятельности с выключенным учетом затрат';
											|en = 'The line of business has been filled in with expenses accounting disabled'"));
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеРасходы""		 КАК ИмяРегистра,
	|	Т.Регистратор			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	1 						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.НаправлениеДеятельности <> ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|	И НЕ Т.НаправлениеДеятельности.УчетЗатрат
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПартииПрочихРасходов"" КАК ИмяРегистра,
	|	Т.Регистратор			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	1 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПартииПрочихРасходов КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.НаправлениеДеятельности <> ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|	И НЕ Т.НаправлениеДеятельности.УчетЗатрат
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|";
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректное заполнение направления деятельности в прочих расходах';
			|en = 'incorrect filling of the line of business in other expenses'"));
	
	#КонецОбласти

	#Область ПартнерВКлючеАналитикиУчетаНоменклатуры
	
	// Замена ключей аналитики учета номенклатуры с партнером на ключи с договором контрагента.
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'В ключе аналитики учета номенклатуры в регистре ""Себестоимость товаров"" указан партнер, а не договор контрагента.';
											|en = 'In the inventory location attribute key, in the ""Inventory cost"" register, a partner is specified instead of a counterparty contract.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'В ключе аналитики учета номенклатуры в регистре ""Закупки"" указан партнер, а не договор контрагента.';
											|en = 'In the inventory location attribute key, in the ""Purchases"" register, a partner is specified instead of a counterparty contract.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'В ключе аналитики учета номенклатуры в регистре ""Движения Номенклатура - Номенклатура"" указан партнер, а не договор контрагента.';
											|en = 'In the inventory location attribute key, in the ""Line item records"" register, a partner is specified instead of a counterparty contract.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров""	КАК ИмяРегистра,
	|	Т.Регистратор				КАК Ссылка,
	|	Т.Организация				КАК Организация,
	|	1							КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И Т.РазделУчета В (
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
	|	И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер)
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""Закупки""	  КАК ИмяРегистра,
	|	Т.Регистратор КАК Ссылка,
	|	Т.Организация КАК Организация,
	|	2			  КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.Закупки КАК Т
	|
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И Т.ТипЗапасов В (
	|		ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути),
	|		ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке))
	|	И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер)
	|	И НЕ Т.РасчетСебестоимости
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ДвиженияНоменклатураНоменклатура"" КАК ИмяРегистра,
	|	Т.Регистратор						 КАК Ссылка,
	|	Т.Организация						 КАК Организация,
	|	3									 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ДвиженияНоменклатураНоменклатура КАК Т
	|
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И Т.ТипЗапасов В (
	|		ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути),
	|		ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке))
	|	И Т.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер)
	|	И НЕ Т.РасчетСебестоимости
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление ключей аналитики учета номенклатуры в регистрах (замена партнера на договор)';
			|en = 'correction of the inventory location attribute keys in registers (replacement of a partner for a contract)'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	#Область НетТаможеннойПошлиныВДвиженияхДокументаТаможеннаяДекларацияИмпорт
	
	// Исправление движений по регистру "Себестоимость товаров" для документов "Таможенная декларация на импорт".
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'В движения таможенной декларации на импорт по регистру ""Себестоимость товаров"" отсутствует сумма пошлины. Требуется перепровести документ по регистру ""Себестоимость товаров""';
											|en = 'Duty amount is missing in records of the customs declaration for import by the ""Inventory cost"" register. Repost the document for the ""Inventory cost"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Декларация.Ссылка 		 КАК Ссылка,
	|	Декларация.Организация 	 КАК Организация,
	|	1 						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	Документ.ТаможеннаяДекларацияИмпорт КАК Декларация
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Движения
	|		ПО Декларация.Ссылка = Движения.Регистратор
	|		И Движения.ТипЗаписи В (
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
	|ГДЕ
	|	Декларация.Проведен
	|	И Декларация.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Декларация.Организация В (&МассивОрганизаций)
	|	И Декларация.Статус <> ЗНАЧЕНИЕ(Перечисление.СтатусыТаможенныхДеклараций.ТаможенноеОформление)
	|	И (Декларация.СуммаДокумента - Декларация.ТаможенныйСбор - Декларация.ТаможенныйШтраф) <> 0
	|	И Движения.Регистратор ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|ВЫБРАТЬ ПЕРВЫЕ 0
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Движения.Регистратор	 КАК Ссылка,
	|	Движения.Организация 	 КАК Организация,
	|	1 						 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Движения
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'не отражена таможенная пошлина в движениях по регистру ""Себестоимость товаров""';
			|en = 'customs duty is not recorded in records for the ""Inventory cost"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));

	
	#КонецОбласти
	
	#Область АналитикаОтгрузкиВВозвратеТоваровМеждуОрганизациями
	
	// Заполнение нового реквизита табличной части ВидыЗапасов
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Не заполнена аналитика номенклатуры отгрузки в документе возврата товаров между организациями.';
											|en = 'Shipped products dimension is required in the ""Goods return — Intercompany"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Ссылка				КАК Ссылка,
	|	Т.Ссылка.Организация	КАК Организация,
	|	1						КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыДляПерепроведения
	|ИЗ
	|	Документ.ВозвратТоваровМеждуОрганизациями.ВидыЗапасов КАК Т
	|
	|ГДЕ
	|	Т.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Ссылка.Организация В(&МассивОрганизаций)
	|	И Т.Ссылка.Проведен
	|	И Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимости.ИзДокументаПередачи)
	|	И Т.АналитикаУчетаНоменклатурыОтгрузки = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументы(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление ключей аналитики учета номенклатуры отгрузки в документе возврата товаров между организациями';
			|en = 'correction of shipped inventory dimension keys in the ""Goods return — Intercompany"" document'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти

	#Область ВключениеУчетаСебестоимостиПоНазначениям
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Включение учета себестоимости по назначениям';
											|en = 'Enable cost accounting by assignments'", ОбщегоНазначения.КодОсновногоЯзыка()));

	Запрос.УстановитьПараметр("ТипДокументаИмпорта", ОбщегоНазначения.ИдентификаторОбъектаМетаданных("Документ.ТаможеннаяДекларацияИмпорт"));
	
	Запрос.Текст = ТекстЗапросаВключениеУчетаСебестоимостиПоНазначениям();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'включение учета себестоимости по назначениям';
			|en = 'Enable cost accounting by assignments'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	Запрос.Текст = ТекстЗапросаВключениеУчетаВыручкиИСебестоимостиПродажПоНазначениям();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'включение учета выручки и себестоимости продаж по назначениям';
			|en = 'enabling accounting of revenue and COGS by assignments'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	#Область ВыключениеУчетаСебестоимостиПоНазначениям
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Выключение учета себестоимости по назначениям';
											|en = 'Выключение учета себестоимости по назначениям'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = ТекстЗапросаВыключениеУчетаСебестоимостиПоНазначениям();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'выключение учета себестоимости по назначениям';
			|en = 'выключение учета себестоимости по назначениям'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	Запрос.Текст = ТекстЗапросаВыключениеУчетаВыручкиИСебестоимостиПродажПоНазначениям();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'выключение учета выручки и себестоимости продаж по назначениям';
			|en = 'disabling accounting of revenue and COGS by assignments'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	#КонецОбласти
		
	#Область ВключениеУчетаСебестоимостиПоВидамЗапасов
	
	РасшифровкаКодовОшибок = Новый Соответствие;	
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Включение учета себестоимости по видам запасов';
											|en = 'Enable cost accounting by inventory owner attributes'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = ТекстЗапросаВключениеУчетаСебестоимостиПоВидамЗапасов();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'включение учета себестоимости по видам запасов';
			|en = 'Enable cost accounting by inventory owner attributes'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	Запрос.Текст = ТекстЗапросаВключениеУчетаВыручкиИСебестоимостиПродажПоВидамЗапасов();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'включение учета выручки и себестоимости продаж по видам запасов';
			|en = 'enabling accounting of revenue and COGS by inventory owner attributes'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
//++ НЕ УТКА
	#Область СоответствиеТоваровОрганизацийИСебестоимости
	
	// Исправление движений по регистру Выпуск продукции
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Движения этапа производства по регистру ""Себестоимость товаров"" не соответствуют регистру ""Товары организаций"". Требуется перепровести документ по регистру ""Себестоимость товаров""';
											|en = 'Movements of production stage in the ""Inventory cost"" register do not correspond to the ""Company goods"" register. Repost the document for the ""Inventory cost"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ТоварыОрганизаций.Регистратор КАК Регистратор,
	|	(ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА ТоварыОрганизаций.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ) КАК АналитикаУчетаНоменклатуры,
	|	ТоварыОрганизаций.ВидЗапасов КАК ВидЗапасов,
	|	ТоварыОрганизаций.Количество + ТоварыОрганизаций.КОформлениюСписания КАК Количество,
	|	ТоварыОрганизаций.Организация КАК Организация
	|ПОМЕСТИТЬ ВтТоварыОрганизацийИСебестоимость
	|ИЗ
	|	РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|	ПО АналитикаБезНазначения.Номенклатура = ТоварыОрганизаций.АналитикаУчетаНоменклатуры.Номенклатура
	|	И АналитикаБезНазначения.Характеристика = ТоварыОрганизаций.АналитикаУчетаНоменклатуры.Характеристика
	|	И АналитикаБезНазначения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|	И АналитикаБезНазначения.Серия = ТоварыОрганизаций.АналитикаУчетаНоменклатуры.Серия
	|	И АналитикаБезНазначения.МестоХранения = ТоварыОрганизаций.АналитикаУчетаНоменклатуры.МестоХранения
	|	И АналитикаБезНазначения.СтатьяКалькуляции = ТоварыОрганизаций.АналитикаУчетаНоменклатуры.СтатьяКалькуляции
	|
	|ГДЕ
	|	ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) = ТИП(Документ.ЭтапПроизводства2_2)
	|	И ТоварыОрганизаций.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ТоварыОрганизаций.Организация В (&МассивОрганизаций)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СебестоимостьТоваров.Регистратор,
	|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
	|	СебестоимостьТоваров.ВидЗапасов КАК ВидЗапасов,
	|	-СебестоимостьТоваров.Количество,
	|	СебестоимостьТоваров.Организация
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ВыходныеИзделия КАК ВыходныеИзделия
	|	ПО СебестоимостьТоваров.Регистратор = ВыходныеИзделия.Ссылка
	|	И СебестоимостьТоваров.ИдентификаторСтроки = ВыходныеИзделия.ИдентификаторСтроки
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2.ПобочныеИзделия КАК ПобочныеИзделия
	|	ПО СебестоимостьТоваров.Регистратор = ПобочныеИзделия.Ссылка
	|	И СебестоимостьТоваров.ИдентификаторСтроки = ПобочныеИзделия.ИдентификаторСтроки
	|
	|ГДЕ
	// Исключаем движения в незавершенном производстве.
	|	ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) = ТИП(Документ.ЭтапПроизводства2_2)
	|	И СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И СебестоимостьТоваров.АналитикаУчетаНоменклатуры.СтатьяКалькуляции = ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)
	|	И НЕ СебестоимостьТоваров.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	// Исключаем движения к оформлению отчетов давальцу.
	|	И НЕ (
	|		СебестоимостьТоваров.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|		И СебестоимостьТоваров.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость))
	|		И СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		И НЕ СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка))
	// Исключаем товары, выкупленные у комитента.
	| 	И НЕ (
	|		СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|		И СебестоимостьТоваров.АналитикаУчетаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	// Исключаем движения по себестоимости для продукции, списываемой на расходы, т.к. аналогичных движений в товарах организаций нет.
	|	И НЕ ЕСТЬNULL(ВыходныеИзделия.СписатьНаРасходы, ЛОЖЬ)
	|	И НЕ ЕСТЬNULL(ПобочныеИзделия.СписатьНаРасходы, ЛОЖЬ)
	// Исключаем движения по внутренней переработке, приход и расход зависимых организаций филиалов
	|	И НЕ (СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			И СебестоимостьТоваров.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|			И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами)
	|		)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	ВтДвижения.Регистратор КАК Ссылка,
	|	ВтДвижения.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	ВтТоварыОрганизацийИСебестоимость КАК ВтДвижения
	|
	|СГРУППИРОВАТЬ ПО
	|	ВтДвижения.Регистратор,
	|	ВтДвижения.АналитикаУчетаНоменклатуры,
	|	ВтДвижения.ВидЗапасов,
	|	ВтДвижения.Организация
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВтДвижения.Количество) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВтТоварыОрганизацийИСебестоимость
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректные движения по регистру ""Себестоимость товаров""';
			|en = 'incorrect records in the ""Inventory cost"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
//-- НЕ УТКА
	
	#Область КорректировкаПриобретения
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Неправильная операция учета себестоимости в движениях документа ""Корректировка приобретения"".';
											|en = 'Incorrect cost accounting operation in the ""Purchase adjustment"" document register records'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Неправильные суммы НДС в движениях документа ""Корректировка приобретения"".';
											|en = 'Incorrect VAT amounts in register records for the ""Purchase adjustment"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Т.Ссылка 		 		 КАК Ссылка,
	|	Т.Организация 	 		 КАК Организация,
	|	1 						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	Документ.КорректировкаПриобретения КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Движения
	|		ПО Т.Ссылка = Движения.Регистратор
	|ГДЕ
	|	Т.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Движения.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости)
	|	И Т.Проведен
	|	И НЕ Движения.РасчетПартий
	|	И НЕ Движения.РасчетСебестоимости
	|
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Т.Ссылка 		 		 КАК Ссылка,
	|	Т.Организация 	 		 КАК Организация,
	|	2 						 КАК КодОшибки
	|ИЗ
	|	Документ.КорректировкаПриобретения КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Движения
	|		ПО Т.Ссылка = Движения.Регистратор
	|ГДЕ
	|	Т.Проведен
	|	И Т.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Движения.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОпределяетсяРаспределением)
	|	И (Движения.НДСРегл <> 0 ИЛИ Движения.НДСУпр <> 0)
	|	И НЕ Движения.РасчетПартий
	|	И НЕ Движения.РасчетСебестоимости
	|";

	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документа ""Корректировка приобретения""';
			|en = 'corrected records in the ""Purchase adjustment"" document'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	#Область КорректировкаРеализации
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Неправильное движение в документе ""Корректировка реализации"".';
											|en = 'Incorrect register record in the ""Sales adjustment"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));

	Запрос.УстановитьПараметр("ДатаВключенияОбособленногоУчетаСебестоимостиПоНазначениям", Константы.ДатаВключенияОбособленногоУчетаСебестоимостиПоНазначениям.Получить());
	
	ТекстыЗапросов = Новый Массив;
	
	// При выключенном обособленном учете себестоимости по назначениеям, в документе "Корректировка реализации",
	// созданном на основании документа прошлого периода, с заполненным направлением деятельности,
	// формировалось приходное движение с неправильно подоборанными аналитиками учета номенклатуры,
	// у которых было заполнено назначение.
	
	ТекстЗапроса = "ВЫБРАТЬ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	СебестоимостьТоваров.Регистратор КАК Ссылка,
	|	СебестоимостьТоваров.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КлючиАналитикиУчетаНоменклатуры
	|		ПО СебестоимостьТоваров.АналитикаУчетаНоменклатуры = КлючиАналитикиУчетаНоменклатуры.Ссылка
	|ГДЕ
	|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) = ТИП(Документ.КорректировкаРеализации)
	|	И СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов)
	|	И КлючиАналитикиУчетаНоменклатуры.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|	И КлючиАналитикиУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|	И (НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ИЛИ &УчитыватьСебестоимостьТоваровПоНазначениям
	|				И СебестоимостьТоваров.Период < &ДатаВключенияОбособленногоУчетаСебестоимостиПоНазначениям)";
	
	ТекстыЗапросов.Добавить(ТекстЗапроса);
	
	// При корректировке в сторону уменьшения (оприходование) возвратной тары от реализации прошлого периода не формировались партии при закрытии месяца, так как не заполнялись кор аналитика и кор вид запасов.
	
	ТекстЗапроса = "ВЫБРАТЬ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	СебестоимостьТоваров.Регистратор КАК Ссылка,
	|	СебестоимостьТоваров.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|ГДЕ
	|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) = ТИП(Документ.КорректировкаРеализации)
	|	И СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТарыОтКлиентаПрошлыхПериодов)
	|	И СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|	И СебестоимостьТоваров.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)";
	
	ТекстыЗапросов.Добавить(ТекстЗапроса);
	
	Запрос.Текст = СтрСоединить(ТекстыЗапросов, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
	ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документа ""Корректировка реализации""';
			|en = 'correct register records in the ""Sales adjustment"" document'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	// Документы корректировки, которые по РН "ПрочиеРасходы" сфоримровали некорректные приходные движения по расхождениям в части НДС.                                       .
	// До исправления, в подобных движениях не формировалась сумма постоянной разницы, из-за чего в прочих расходах зависали остатки, а в проводках появлялись лишние суммы НУ
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Некорректные движения по документу ""Корректировка реализации"" в регистре ""Прочие расходы""';
											|en = 'Incorrect register records for the ""Sales adjustment"" document in the ""Other expenses"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеРасходы"" КАК ИмяРегистра,
	|	ПрочиеРасходы.Регистратор КАК Ссылка,
	|	ПрочиеРасходы.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК ПрочиеРасходы
	|ГДЕ 
	|	ПрочиеРасходы.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ПрочиеРасходы.Организация В (&МассивОрганизаций) 
	|	И ТИПЗНАЧЕНИЯ(ПрочиеРасходы.Регистратор) = ТИП(Документ.КорректировкаРеализации)
	|	И ПрочиеРасходы.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ПрочиеРасходы.НастройкаХозяйственнойОперации = ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.РеализацияКлиенту)
	|	И НЕ ПрочиеРасходы.СтатьяРасходов.ПринятиеКНалоговомуУчету
	|	И ПрочиеРасходы.ПостояннаяРазница = 0
	|	И ПрочиеРасходы.Сумма = 0
	|	И ПрочиеРасходы.СуммаБезНДС = 0
	|	И ПрочиеРасходы.СуммаРегл <> 0
	|	И ПрочиеРасходы.СуммаУпр <> 0";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректные движения по документу ""Корректировка реализации"" в регистре ""Прочие расходы""';
			|en = 'Incorrect register records for the ""Sales adjustment"" document in the ""Other expenses"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	#Область ПрочееОприходованиеТоваров_СторноСписанияНаРасходы
	
	// Для сторно списания на расходы не заполняется направление деятельности в прочих расходах, хотя при списании указывается,
	//	необходимо заполнять КорНаправлениеДеятельности в таких документах.
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Неправильное движение в документе ""Прочее оприходование товаров"".';
											|en = 'Incorrect register record in the ""Other receipt of goods"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));

	Запрос.Текст = "ВЫБРАТЬ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	СебестоимостьТоваров.Регистратор КАК Ссылка,
	|	СебестоимостьТоваров.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПрочееОприходованиеТоваров КАК ПрочееОприходованиеТоваров
	|		ПО СебестоимостьТоваров.Регистратор = ПрочееОприходованиеТоваров.Ссылка
	|ГДЕ
	|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
	|	И СебестоимостьТоваров.КорНаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|	И ПрочееОприходованиеТоваров.НаправлениеДеятельности <> ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
	ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документа ""Прочее оприходование товаров""';
			|en = 'correct register records of the ""Other receipt of goods"" document'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	#КонецОбласти
	
	//++ НЕ УТ
	#Область Производство_СписаниеНаДругиеПартии
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	// Для движений с указанной стоимостью (возвратные отходы, плановая стоимость) не заполняется документ движения, хотя до этого указывался,
	//	необходимо заполнять ДокументДвижения в таких записях, в противном случае проводки формируются без учета стоимости.
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Неправильное движение в документе ""Производство без заказа"".';
											|en = 'Incorrect record in the ""Backflush production"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	// Для всех движений производства без заказа, за исключением движений с хозяйственной операцией "" должен указываться идентификатор финансовой записи.
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Не указывается ИФЗ в документе ""Производство без заказа"".';
											|en = 'The financial record ID is not specified in the ""Backflush production"" document.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	// Для забалансовых типов запасов, при передаче номенклатуры в производство, должно меняться только место учета в аналитике (на подразделение), сам
	//	раздел учета должен оставаться прежним. Однако указывался раздел учета "Незавершенное производство", что приводило к ошибкам в проводках.
	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'Неправильное движение в документе ""Этап производства"" при списании на другие партии: для забалансовых типов запасов раздел учета должен оставаться забалансовым.';
											|en = 'Incorrect register record in the ""Production stage"" document when writing off to other lots: for off-balance inventory types, the branch of accounting must be off-balance.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(4, НСтр("ru = 'Неправильное движение в документе ""Производство без заказа"" при списании на другие партии: для забалансовых типов запасов раздел учета должен оставаться забалансовым.';
											|en = 'Incorrect register record in the ""Backflush production"" document when writing off to other lots: for off-balance inventory types, the branch of accounting must be off-balance.'", ОбщегоНазначения.КодОсновногоЯзыка()));

	Запрос.Текст = "ВЫБРАТЬ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	СебестоимостьТоваров.Регистратор КАК Ссылка,
	|	СебестоимостьТоваров.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК ПроизводствоБезЗаказа
	|		ПО СебестоимостьТоваров.Регистратор = ПроизводствоБезЗаказа.Ссылка
	|ГДЕ
	|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И СебестоимостьТоваров.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии)
	|	И СебестоимостьТоваров.ДокументДвижения = Неопределено
	|	И СебестоимостьТоваров.СтоимостьРегл <> 0
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	СебестоимостьТоваров.Регистратор КАК Ссылка,
	|	СебестоимостьТоваров.Организация КАК Организация,
	|	2 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК ДанныеДокумента
	|		ПО СебестоимостьТоваров.Регистратор = ДанныеДокумента.Ссылка
	|ГДЕ
	|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И СебестоимостьТоваров.ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца), ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца), ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|	И СебестоимостьТоваров.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
	|	И СебестоимостьТоваров.ИдентификаторФинЗаписи = &ИдентификаторНеиспользуемойФинЗаписи
	|
	//++ НЕ УТКА
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	СебестоимостьТоваров.Регистратор КАК Ссылка,
	|	СебестоимостьТоваров.Организация КАК Организация,
	|	3 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭтапПроизводства2_2 КАК ДанныеДокумента
	|		ПО СебестоимостьТоваров.Регистратор = ДанныеДокумента.Ссылка
	|ГДЕ
	|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И СебестоимостьТоваров.ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца), ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца), ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|	И СебестоимостьТоваров.Партия ССЫЛКА Справочник.ПартииПроизводства
	|	И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|	И СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|
	//-- НЕ УТКА
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	СебестоимостьТоваров.Регистратор КАК Ссылка,
	|	СебестоимостьТоваров.Организация КАК Организация,
	|	4 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПроизводствоБезЗаказа КАК ДанныеДокумента
	|		ПО СебестоимостьТоваров.Регистратор = ДанныеДокумента.Ссылка
	|ГДЕ
	|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|	И СебестоимостьТоваров.ВидЗапасов.ТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца), ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца), ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|	И СебестоимостьТоваров.Партия ССЫЛКА Справочник.ПартииПроизводства
	|	И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|	И СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
	ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений производственных документов';
			|en = 'correct register records of production documents'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	#КонецОбласти
	//-- НЕ УТ
	
	#Область ПрочаяВыручка
	
	// Документы, у которых ранее были движения по регистру "Прочие расходы", теперь должны формировать движения по регистру "Прочая выручка":
	// - "Реализация услуг и прочих активов"
	// - "Корректировка реализации", у которой документ - основание "Реализация услуг и прочих активов"
	// - "Начисления по кредитам и депозитам"
	// - "Отражение зарплаты в финансовом учете"  
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Восстановление движений по регистру ""Прочая выручка"".';
											|en = 'Restore records through ""Revenue — Services and Assets"" register.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор     КАК Регистратор,
	|	Т.Организация     КАК Организация
	|ПОМЕСТИТЬ ВТРегистраторыСПрочимиДоходами
	|ИЗ
	|	РегистрНакопления.ПрочиеДоходы КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации КАК Корректировка
	|		ПО Корректировка.Ссылка = Т.Регистратор
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияУслугПрочихАктивов КАК РеализацияУслуг
	|		ПО РеализацияУслуг.Ссылка = Корректировка.ДокументОснование
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И НЕ Т.РасчетСебестоимости
	|	И (ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.РеализацияУслугПрочихАктивов)
	// Корректировка реализации услуг прошлого года отражается в регистре "Прочие доходы", а не в регистре "Прочая выручка".
	|		ИЛИ НЕ РеализацияУслуг.Ссылка ЕСТЬ NULL
	|			И НАЧАЛОПЕРИОДА(Корректировка.Дата, ГОД) = НАЧАЛОПЕРИОДА(РеализацияУслуг.Дата, ГОД)
	|		ИЛИ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.НачисленияКредитовИДепозитов)
	//++ Локализация

	//++ НЕ УТ
	|		ИЛИ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтражениеЗарплатыВФинансовомУчете)
	//-- НЕ УТ

	//-- Локализация
	|		)
	|;
	|ВЫБРАТЬ
	|	""ПрочаяВыручка"" КАК ИмяРегистра,
	|	Т.Регистратор     КАК Ссылка,
	|	Т.Организация     КАК Организация,
	|	1                 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	ВТРегистраторыСПрочимиДоходами КАК Т
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""ПрочиеДоходы""  КАК ИмяРегистра,
	|	Т.Регистратор     КАК Ссылка,
	|	Т.Организация     КАК Организация,
	|	1                 КАК КодОшибки
	|ИЗ
	|	ВТРегистраторыСПрочимиДоходами КАК Т
	|;
	|УНИЧТОЖИТЬ ВТРегистраторыСПрочимиДоходами
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'восстановление движений по регистру ""Прочая выручка""';
			|en = 'restore records through ""Revenue — Services and Assets"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	#Область ПартииПрочихРасходов
	
	// Отражение статей с вариантом распределения НаПроизводственныеЗатраты в регистре накопления ПартииПрочихРасходов.
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Отражение статей с вариантом распределения ""На производственные затраты"" в регистре ""Партии прочих расходов"" не соответствует учетной политике организации';
											|en = 'Record items with allocation option ""For production costs"" in the ""Material overheads for allocation"" register does not correspond to the company accounting policy'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Отражение статей с вариантом распределения ""На себестоимость товаров"" в регистре ""Партии прочих расходов"" не соответствует учетной политике организации';
											|en = 'Recording items with allocation option ""For production costs"" in the ""Material overheads for allocation"" register does not correspond to the company accounting policy'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'Для статей с вариантом распределения ""На себестоимость товаров"" нет движений в регистре ""Партии прочих расходов"" для организации плательщика НДД';
											|en = 'For items with the ""To inventory cost"" allocation option, there are no records in the ""Material overheads for allocation"" register for the AIT payer company'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	СуществующиеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос);
	
	Запрос.Текст = ТекстЗапросаСтатьиСРаздельнымУчетомНДСВРегистреПартииПрочихРасходов();
	ПараметрыОтбораДокументовЗапросаСтатьиСРаздельнымУчетомНДСВРегистреПартииПрочихРасходов(Запрос);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректные движения по регистру ""Партии прочих расходов""';
			|en = 'incorrect records in the ""Material overheads for allocation"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Заполнена аналитика учета номенклатуры в регистре ""Партии прочих расходов"".';
											|en = 'Inventory location attributes are filled in the ""Material overheads for allocation"" register.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2, НСтр("ru = 'Заполнена сумма НДС в движениях с признаком Сторно в регистре ""Партии прочих расходов"".';
											|en = 'The VAT amount is filled in records with the Storno flag in the ""Material overheads for allocation"" register.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(3, НСтр("ru = 'Сформированы движения по регистру ""Партии прочих расходов"" для организации с методом оценки стоимости ""ФИФО (взвешенная)"".';
											|en = 'Сформированы движения по регистру ""Партии прочих расходов"" для организации с методом оценки стоимости ""ФИФО (взвешенная)"".'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	""ПартииПрочихРасходов"" КАК ИмяРегистра,
	|	Т.Регистратор     КАК Ссылка,
	|	Т.Организация     КАК Организация,
	|	ВЫБОР КОГДА Т.АналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		ТОГДА 1
	|		ИНАЧЕ 3
	|	КОНЕЦ КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.ПартииПрочихРасходов КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И (Т.АналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		ИЛИ Т.Организация В(&ОрганизацииСФИФОВзвешенная))
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
	|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовБезДвижений)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""ПартииПрочихРасходов"" КАК ИмяРегистра,
	|	Т.Регистратор     КАК Ссылка,
	|	Т.Организация     КАК Организация,
	|	2                 КАК КодОшибки
	|ИЗ
	|	РегистрНакопления.ПартииПрочихРасходов КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И Т.Сторно
	|	И (Т.НДСРегл <> 0 ИЛИ Т.НДСУпр <> 0)
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'некорректные движения по регистру ""Партии прочих расходов""';
			|en = 'incorrect records in the ""Material overheads for allocation"" register'", ОбщегоНазначения.КодОсновногоЯзыка()));
		
	НовыеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос, СуществующиеВТ);
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, НовыеВТ);
	
	#КонецОбласти
	
	#Область ПрочиеРасходы
	
	// В документах "Движение прочих активов и пассивов по операции увеличения активов за счет уменьшения расходов формировались неправильные движения в регистре "Прочие расходы":
	// - было: расходное движение с положительными суммами
	// - должно быть: приходное движение с отрицательными суммами
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1, НСтр("ru = 'Сформированы некорректные движения по регистру  ""Прочие расходы"".';
											|en = 'Generated records in the ""Other expenses"" register are incorrect.'", ОбщегоНазначения.КодОсновногоЯзыка()));;
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ПрочиеРасходы"" 		 КАК ИмяРегистра,
	|	Т.Регистратор 			 КАК Ссылка,
	|	Т.Организация 			 КАК Организация,
	|	1 						 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.Активность
	|	И Т.Регистратор ССЫЛКА Документ.ДвижениеПрочихАктивовПассивов
	|	И ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтражениеПрочихАктивовПассивов)
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.Сумма > 0 И Т.СуммаБезНДС > 0
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документов по регистру ""Прочие расходы"".';
			|en = 'correct document register records in the ""Other expenses"" register.'", ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	#Область СебестоимостьТоваровСуммыВТаможенныхДекларацияхИмпорт
	
	// В документах ТаможеннаяДекларацияИмпорт, регламентом расчета себестоимости,
	// могли быть сформированы проводки с неполной суммой, ошибка исправлена в рамках задачи 00-00542007
	// для восстановления сумм проводок необходимо перепроведение документов
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1,
		НСтр("ru = 'Отличаются суммы в движения по регистру ""Себестоимость товаров"" от регистра ""Закупки""';
			|en = 'Amounts in the Inventory cost register records differ from amounts in the Purchases register records'",
			ОбщегоНазначения.КодОсновногоЯзыка()));
	РасшифровкаКодовОшибок.Вставить(2,
		НСтр("ru = 'Отличаются суммы в движения по регистру ""Закупки"" от регистра ""Себестоимость товаров""';
			|en = 'Amounts in the Purchases register records differ from amounts in the Inventory cost register records'",
			ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	ВЗ.Регистратор КАК Регистратор,
	|	ВЗ.Организация КАК Организация,
	|	ВЗ.Номенклатура КАК Номенклатура,
	|	ВЗ.Характеристика КАК Характеристика,
	|	ВЗ.Серия КАК Серия,
	|	ВЗ.МестоХранения КАК МестоХранения,
	|	СУММА(ВЗ.ДопРасходы) КАК ДопРасходы,
	|	СУММА(ВЗ.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
	|	СУММА(ВЗ.ДопРасходыРегл) КАК ДопРасходыРегл
	|ПОМЕСТИТЬ ВтСуммыДвиженийТаможеннойДекларации
	|ИЗ
	|	(ВЫБРАТЬ
	|		СебестоимостьТоваров.Организация КАК Организация,
	|		СебестоимостьТоваров.Регистратор КАК Регистратор,
	|		СебестоимостьТоваров.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	|		СебестоимостьТоваров.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
	|		СебестоимостьТоваров.АналитикаУчетаНоменклатуры.Серия КАК Серия,
	|		СебестоимостьТоваров.АналитикаУчетаНоменклатуры.МестоХранения КАК МестоХранения,
	|		СебестоимостьТоваров.ДопРасходы КАК ДопРасходы,
	|		СебестоимостьТоваров.ДопРасходыБезНДС КАК ДопРасходыБезНДС,
	|		СебестоимостьТоваров.ДопРасходыРегл КАК ДопРасходыРегл
	|	ИЗ
	|		РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
	|	ГДЕ
	|		СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И СебестоимостьТоваров.Организация В (&МассивОрганизаций)
	|		И СебестоимостьТоваров.Активность
	|		И СебестоимостьТоваров.Регистратор ССЫЛКА Документ.ТаможеннаяДекларацияИмпорт
	|		И СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И НЕ СебестоимостьТоваров.РасчетПартий
	|		И НЕ СебестоимостьТоваров.РасчетСебестоимости
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Закупки.Организация,
	|		Закупки.Регистратор,
	|		Закупки.АналитикаУчетаНоменклатуры.Номенклатура,
	|		Закупки.АналитикаУчетаНоменклатуры.Характеристика,
	|		Закупки.АналитикаУчетаНоменклатуры.Серия,
	|		Закупки.АналитикаУчетаНоменклатуры.МестоХранения,
	|		-Закупки.Сумма КАК ДопРасходы,
	|		-Закупки.СуммаБезНДС КАК ДопРасходыБезНДС,
	|		-Закупки.СтоимостьРегл КАК ДопРасходыРегл
	|	ИЗ
	|		РегистрНакопления.Закупки КАК Закупки
	|	ГДЕ
	|		Закупки.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Закупки.Организация В (&МассивОрганизаций)
	|		И Закупки.Активность
	|		И Закупки.Регистратор ССЫЛКА Документ.ТаможеннаяДекларацияИмпорт
	|) КАК ВЗ
	|СГРУППИРОВАТЬ ПО
	|	ВЗ.Регистратор,
	|	ВЗ.Номенклатура,
	|	ВЗ.Организация,
	|	ВЗ.Характеристика,
	|	ВЗ.Серия,
	|	ВЗ.МестоХранения
	|ИМЕЮЩИЕ
	|	(СУММА(ВЗ.ДопРасходы) <> 0
	|	ИЛИ СУММА(ВЗ.ДопРасходыБезНДС) <> 0
	|	ИЛИ СУММА(ВЗ.ДопРасходыРегл) <> 0)
	|;
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""СебестоимостьТоваров"" КАК ИмяРегистра,
	|	Т.Регистратор КАК Ссылка,
	|	Т.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	ВтСуммыДвиженийТаможеннойДекларации КАК Т
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""Закупки"" КАК ИмяРегистра,
	|	Т.Регистратор КАК Ссылка,
	|	Т.Организация КАК Организация,
	|	2 КАК КодОшибки
	|ИЗ
	|	ВтСуммыДвиженийТаможеннойДекларации КАК Т
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документа ""Таможенная декларация на испорт"" по регистрам ""Себестоимость товаров"" и ""Закупки"".';
			|en = 'correct register records of the Customs import declaration document by the Inventory cost and Purchases registers.'",
			ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	#Область РаспределениеПрочихЗатрат
	
	// В закрываемом периоде не должно быть 2х документов по НУ и Регл. учету со схожими аналитиками
	// При наличии таких документов, один помечаем на удаление, у второго ставим 2 галочки.
	Запрос.Текст = "ВЫБРАТЬ
	|	РаспределениеПрочихЗатрат.Организация КАК Организация,
	|	РаспределениеПрочихЗатрат.Подразделение КАК Подразделение,
	|	РаспределениеПрочихЗатрат.СтатьяРасходов КАК СтатьяРасходов,
	|	РаспределениеПрочихЗатрат.АналитикаРасходов КАК АналитикаРасходов,
	|	КОЛИЧЕСТВО(РаспределениеПрочихЗатрат.Ссылка) КАК КоличествоДокументов,
	|	МАКСИМУМ(РаспределениеПрочихЗатрат.УправленческийУчет) КАК УправленческийУчет,
	|	МАКСИМУМ(РаспределениеПрочихЗатрат.РегламентированныйУчет) КАК РегламентированныйУчет,
	|	МАКСИМУМ(РаспределениеПрочихЗатрат.НалоговыйУчет) КАК НалоговыйУчет,
	|	НАЧАЛОПЕРИОДА(РаспределениеПрочихЗатрат.Дата, МЕСЯЦ) КАК МесяцРасхода,
	|	РаспределениеПрочихЗатрат.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	МАКСИМУМ(ВЫБОР
	|		КОГДА РаспределениеПрочихЗатрат.РегламентированныйУчет
	|			ТОГДА РаспределениеПрочихЗатрат.Ссылка
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ) КАК ДокументДляПроведения
	|ПОМЕСТИТЬ РеквизитыСЗадвоеннымиДокументами
	|ИЗ
	|	Документ.РаспределениеПрочихЗатрат КАК РаспределениеПрочихЗатрат
	//++ НЕ УТ
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ОбъектыВозникновенияЗатрат КАК ОВЗ
	|		ПО ОВЗ.Ссылка = РаспределениеПрочихЗатрат.АналитикаРасходов
	//-- НЕ УТ
	|ГДЕ
	|	РаспределениеПрочихЗатрат.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И РаспределениеПрочихЗатрат.Организация В (&МассивОрганизаций)
	|	И РаспределениеПрочихЗатрат.Проведен
	|	И (РаспределениеПрочихЗатрат.РегламентированныйУчет ИЛИ РаспределениеПрочихЗатрат.НалоговыйУчет)
	|	И (РаспределениеПрочихЗатрат.СтатьяРасходов.ВариантРаспределенияРасходовРегл = РаспределениеПрочихЗатрат.СтатьяРасходов.ВариантРаспределенияРасходовНУ
	//++ НЕ УТ
	|		ИЛИ ОВЗ.ВариантРаспределенияРасходовРегл = ОВЗ.ВариантРаспределенияРасходовНУ
	//-- НЕ УТ
	|		)
	|СГРУППИРОВАТЬ ПО
	|	РаспределениеПрочихЗатрат.Организация,
	|	РаспределениеПрочихЗатрат.Подразделение,
	|	РаспределениеПрочихЗатрат.СтатьяРасходов,
	|	РаспределениеПрочихЗатрат.АналитикаРасходов,
	|	НАЧАЛОПЕРИОДА(РаспределениеПрочихЗатрат.Дата, МЕСЯЦ),
	|	РаспределениеПрочихЗатрат.НаправлениеДеятельности
	|ИМЕЮЩИЕ
	|	КОЛИЧЕСТВО(РаспределениеПрочихЗатрат.Ссылка) > 1
	|	И МАКСИМУМ(РаспределениеПрочихЗатрат.РегламентированныйУчет)
	|	И МАКСИМУМ(РаспределениеПрочихЗатрат.НалоговыйУчет)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РеквизитыСЗадвоеннымиДокументами.ДокументДляПроведения КАК ДокументДляПроведения,
	|	РеквизитыСЗадвоеннымиДокументами.УправленческийУчет КАК УправленческийУчет
	|ИЗ
	|	РеквизитыСЗадвоеннымиДокументами КАК РеквизитыСЗадвоеннымиДокументами
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РаспределениеПрочихЗатрат.Ссылка КАК ДокументДляПометкиНаУдаление
	|ИЗ
	|	РеквизитыСЗадвоеннымиДокументами КАК РеквизитыСЗадвоеннымиДокументами
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеПрочихЗатрат КАК РаспределениеПрочихЗатрат
	|		ПО РеквизитыСЗадвоеннымиДокументами.Организация = РаспределениеПрочихЗатрат.Организация
	|		И РеквизитыСЗадвоеннымиДокументами.Подразделение = РаспределениеПрочихЗатрат.Подразделение
	|		И РеквизитыСЗадвоеннымиДокументами.СтатьяРасходов = РаспределениеПрочихЗатрат.СтатьяРасходов
	|		И РеквизитыСЗадвоеннымиДокументами.АналитикаРасходов = РаспределениеПрочихЗатрат.АналитикаРасходов
	|		И (РаспределениеПрочихЗатрат.РегламентированныйУчет
	|		ИЛИ РаспределениеПрочихЗатрат.НалоговыйУчет)
	|		И РеквизитыСЗадвоеннымиДокументами.НаправлениеДеятельности = РаспределениеПрочихЗатрат.НаправлениеДеятельности
	|		И РеквизитыСЗадвоеннымиДокументами.ДокументДляПроведения <> РаспределениеПрочихЗатрат.Ссылка
	|		И РаспределениеПрочихЗатрат.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|		И РаспределениеПрочихЗатрат.Проведен";
	
	РезультатЗапросаПакет = Запрос.ВыполнитьПакет();
	
	НачатьТранзакцию();
	
	Попытка
		Блокировка = Новый БлокировкаДанных;
		ЭлементБлокировки = Блокировка.Добавить("Документ.РаспределениеПрочихЗатрат");
		ЭлементБлокировки.ИсточникДанных = РезультатЗапросаПакет[1];
		ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Ссылка", "ДокументДляПроведения");
		Блокировка.Заблокировать();
		
		Блокировка = Новый БлокировкаДанных;
		ЭлементБлокировки = Блокировка.Добавить("Документ.РаспределениеПрочихЗатрат");
		ЭлементБлокировки.ИсточникДанных = РезультатЗапросаПакет[2];
		ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Ссылка", "ДокументДляПометкиНаУдаление");
		Блокировка.Заблокировать();  
		
		ДокументыДляПроведения = РезультатЗапросаПакет[1].Выбрать();
		ДокументыДляПоменткиНаУдаление = РезультатЗапросаПакет[2].Выбрать();
		
		Пока ДокументыДляПоменткиНаУдаление.Следующий() Цикл
			ДокументОбъект = ДокументыДляПоменткиНаУдаление.ДокументДляПометкиНаУдаление.ПолучитьОбъект();
			ДокументОбъект.ДополнительныеСвойства.Вставить("ОтменитьЗаписьЗаданияКРасчетуСебестоимости", Истина);
			ДокументОбъект.ПометкаУдаления = Истина;
			ДокументОбъект.Записать(РежимЗаписиДокумента.ОтменаПроведения);
		КонецЦикла;
		
		Пока ДокументыДляПроведения.Следующий() Цикл
			ДокументОбъект = ДокументыДляПроведения.ДокументДляПроведения.ПолучитьОбъект();
			ДокументОбъект.УправленческийУчет = ДокументыДляПроведения.УправленческийУчет;
			ДокументОбъект.НалоговыйУчет = Истина;
			ДокументОбъект.ОбменДанными.Загрузка = Истина;
			ДокументОбъект.Записать();
		КонецЦикла;
		
		ЗафиксироватьТранзакцию();
		
	Исключение
		
		ОтменитьТранзакцию();
		
		ТекстДляПротокола = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru = 'Не удалось исправить документы распределения прочих затрат по причине:
				|%1';
				|en = 'Cannot correct the documents of other cost allocation due to:
				|%1'", ОбщегоНазначения.КодОсновногоЯзыка()),
			ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		
		РасчетСебестоимостиПротоколРасчета.ЗафиксироватьОшибкуРасчета(
			ПараметрыРасчета,
			Перечисления.ТипыОшибокПартионногоУчетаИСебестоимости.ОшибкаВИсходныхДанныхДляРасчета,
			ТекстДляПротокола);
		
		ВызватьИсключение РасчетСебестоимостиПрикладныеАлгоритмы.ТекстИсключениеДляРегистрацииПроблемы(
			ТекстДляПротокола);
		
	КонецПопытки;
	
	#КонецОбласти
	
	#Область ВыручкаИСебестоимостьПродажЗадвоениеКоличестваВДВижениях
	
	// В документах ВозвратТоваровОтКлиента, регламентом расчета себестоимости, Этап ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж
	// добавляет в регистр накопления ВыручкаИСебестоимостьПродаж движение без партии и с задвоеным, затроенным и т.д. количеством
	
	РасшифровкаКодовОшибок = Новый Соответствие;
	РасшифровкаКодовОшибок.Вставить(1,
		НСтр("ru = 'Сформированы некорректные движения по регистру ""Выручка и себестоимость продаж"", найдены расхождения по количеству с регистром ""Себестоимость товаров""';
			|en = 'Incorrect ""Revenue and COGS"" register records are generated. Discrepancies in quantity with the ""Inventory cost"" register are found'",
			ОбщегоНазначения.КодОсновногоЯзыка()));
	
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	ВЗ.Организация КАК Организация,
	|	ВЗ.Регистратор КАК Регистратор,
	|	ВЗ.Номенклатура КАК Номенклатура,
	|	ВЗ.РазделУчета КАК РазделУчета,
	|	ВЗ.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|	СУММА(ВЗ.Количество) КАК Количество
	|ПОМЕСТИТЬ ВТРегистраторыСОшибкамиВКоличестве
	|ИЗ
	|	(ВЫБРАТЬ
	|		Т.АналитикаУчетаПоПартнерам.Организация КАК Организация,
	|		Т.Регистратор КАК Регистратор,
	|		Т.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	|		Т.РазделУчета КАК РазделУчета,
	|		Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	// Количество при данном виде возврата, в движениях, отрицательное
	|		Т.Количество КАК Количество
	|	ИЗ
	|		РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитики
	|		ПО Т.АналитикаУчетаПоПартнерам = Аналитики.Ссылка
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Аналитики.Организация В(&МассивОрганизаций)
	|		И Т.Регистратор ССЫЛКА Документ.ВозвратТоваровОтКлиента 
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов)
	// Услуга не отображается в себестоимости, поэтому исключаем ее из ВыручкаИСебестоимостьПродаж 
	|		И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Т.Организация,
	|		Т.Регистратор,
	|		СпрНоменклатура.Ссылка КАК Номенклатура,
	|		Т.РазделУчета,
	|		Т.ХозяйственнаяОперация,
	|		Т.Количество
	|	ИЗ
	|		ВТДвиженияСебестоимостьТоваров КАК Т
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрКлючиАналитикиУчетаНоменклатуры
	|		ПО (СпрКлючиАналитикиУчетаНоменклатуры.Ссылка = Т.АналитикаУчетаНоменклатуры)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорКлючиАналитикиУчетаНоменклатуры
	|		ПО (КорКлючиАналитикиУчетаНоменклатуры.Ссылка = Т.КорАналитикаУчетаНоменклатуры)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
	|		ПО (ЕСТЬNULL(КорКлючиАналитикиУчетаНоменклатуры.Номенклатура, СпрКлючиАналитикиУчетаНоменклатуры.Номенклатура) = СпрНоменклатура.Ссылка)
	|	ГДЕ
	|		Т.Регистратор ССЫЛКА Документ.ВозвратТоваровОтКлиента
	// Многооборотная тара не отражается в выручке если отражается возврат многооборотной тары, поэтому исключим ее из СебестоимостьТоваров
	// У возврата многооборотной тары хозяйственная операция "Сторно переданной тары" или "Возврат тары от клиента прошлых периодов", поэтому условие ниже её исключает
	|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов)
	|	) КАК ВЗ
	|
	|СГРУППИРОВАТЬ ПО
	|	ВЗ.Организация,
	|	ВЗ.Регистратор,
	|	ВЗ.Номенклатура,
	|	ВЗ.РазделУчета,
	|	ВЗ.ХозяйственнаяОперация
	|	
	|ИМЕЮЩИЕ СУММА(ВЗ.Количество) <> 0
	|;
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	""ВыручкаИСебестоимостьПродаж"" КАК ИмяРегистра,
	|	Т.Регистратор КАК Ссылка,
	|	Т.Организация КАК Организация,
	|	1 КАК КодОшибки
	|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
	|ИЗ
	|	ВТРегистраторыСОшибкамиВКоличестве КАК Т
	|";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПерепровестиДокументыПоОтдельнымРегистрамНакопления(
		ПараметрыРасчета,
		Запрос,
		РасшифровкаКодовОшибок,
		НСтр("ru = 'исправление движений документов по регистру ""Выручка и себестоимость продаж"".';
			|en = 'correction of document records in the ""Revenue and COGS"" register.'",
			ОбщегоНазначения.КодОсновногоЯзыка()));
	
	#КонецОбласти
	
	РасчетСебестоимостиПодготовкаДанныхЛокализация.ИсправитьПроблемыВДвиженияхИДокументах(ПараметрыРасчета);
	
	ВТЭтапа = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(Запрос, СуществующиеВТДоЭтапа);
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(Запрос, ВТЭтапа);
	
КонецПроцедуры

Функция ТекстЗапросаСтатьиСРаздельнымУчетомНДСВРегистреПартииПрочихРасходов() Экспорт
	Возврат
		"ВЫБРАТЬ
		|	Т.Ссылка 							 КАК Ссылка,
		|	Т.Организация 						 КАК Организация,
		|	Т.Подразделение 					 КАК Подразделение,
		|	Т.НаправлениеДеятельности 			 КАК НаправлениеДеятельности,
		|	Т.СтатьяРасходов 					 КАК СтатьяРасходов,
		|	Т.АналитикаРасходов					 КАК АналитикаРасходов,
		|	МАКСИМУМ(Т.ЕстьПрочиеРасходы) 		 КАК ЕстьПрочиеРасходы,
		|	МАКСИМУМ(Т.ЕстьПартииПрочихРасходов) КАК ЕстьПартииПрочихРасходов
		|ПОМЕСТИТЬ ВТДвижения
		|ИЗ
		|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		Т.Регистратор КАК Ссылка,
		|		Т.Организация КАК Организация,
		|		Т.Подразделение КАК Подразделение,
		|		Т.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|		Т.СтатьяРасходов КАК СтатьяРасходов,
		|		Т.АналитикаРасходов	КАК АналитикаРасходов,
		|		ИСТИНА КАК ЕстьПрочиеРасходы,
		|		ЛОЖЬ КАК ЕстьПартииПрочихРасходов
		|	ИЗ
		|		РегистрНакопления.ПрочиеРасходы КАК Т
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статья
		|			ПО Статья.Ссылка = Т.СтатьяРасходов
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.Сторно КАК ДокументСторно
		|			ПО ДокументСторно.Ссылка = Т.Регистратор
		|	ГДЕ
		|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И Т.Организация В(&МассивОрганизаций)
		// Условие выбоки записей должны соответствовать функции:
		// РегистрыНакопления.ПартииПрочихРасходов.ТекстЗапросаТаблицаВтПартииПрочихРасходов()
		|		И (
		//++ Локализация
		|			(((Статья.ВариантРаспределенияРасходовУпр В (
		|						ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты),
		|						ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьПроизводства)) 
		// Когда статья расходов распределяется на производственные затраты только в УУ, 
		// движения в РН ПартииПрочихРасходов формируются только в том случае, если есть сумма НДС. Определить это можно по разнице Суммы и СуммыБезНДС.
		|				И Т.Сумма <> Т.СуммаБезНДС
		|				)
		|				ИЛИ Статья.ВариантРаспределенияРасходовРегл В (
		|						ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты),
		|						ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьПроизводства)))
		|			И Статья.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ИзДокумента)
		|			И Т.Организация В (&ОрганизацииСРаздельнымУчетомПостатейныхЗатрат)
		|			)
		|		  ИЛИ
		//-- Локализация
		|			(Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|				ИЛИ Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			И (Т.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|				ИЛИ Т.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|				ИЛИ Т.Организация В (&ОрганизацииСДетализациейМатериальныхИПостатейныхЗатрат))
		|			)
		|		  )
		// Исключаем проверку движений по переброске расходов между организациями в упр. учете.
		|		И НЕ Т.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторнированиеРасходовУУ),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РегистрацияРасходовУУ))
		// Исключаем списание продукции на расходы по плановой стоимости
		|		И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
		|		И НЕ Т.РасчетПартий
		|		И НЕ Т.РасчетСебестоимости
		|		И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
		|		И НЕ ТИПЗНАЧЕНИЯ(ДокументСторно.СторнируемыйДокумент) В (&ТипыДокументовОСиНМА)
		|		И (НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
		|			ИЛИ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.КорректировкаПриобретения))
		|		И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовБезДвижений)
		//++ Локализация
		
		//++ НЕ УТ 
		|		И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.РезервыПоОплатеТруда)
		//-- НЕ УТ
		
		//-- Локализация
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		Т.Регистратор,
		|		Т.Организация,
		|		Т.Подразделение,
		|		Т.НаправлениеДеятельности,
		|		Т.СтатьяРасходов,
		|		Т.АналитикаРасходов,
		|		ЛОЖЬ,
		|		ИСТИНА
		|	ИЗ
		|		РегистрНакопления.ПартииПрочихРасходов КАК Т
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статья
		|			ПО Статья.Ссылка = Т.СтатьяРасходов
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.Сторно КАК ДокументСторно
		|			ПО ДокументСторно.Ссылка = Т.Регистратор
		|	ГДЕ
		|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И Т.Организация В(&МассивОрганизаций)
		// Условие выборки записей должны соответствовать функции:
		// РегистрыНакопления.ПартииПрочихРасходов.ТекстЗапросаТаблицаВтПартииПрочихРасходов()
		|		И (
		//++ Локализация
		|			((Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
		|				ИЛИ Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты))
		|			И Статья.ВариантРаздельногоУчетаНДС <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|			И Т.Организация В (&ОрганизацииСРаздельнымУчетомПостатейныхЗатрат)
		|			)
		|		  ИЛИ
		//-- Локализация
		|			(Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|				ИЛИ Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			И (Т.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|				ИЛИ Т.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|				ИЛИ Т.Организация В (&ОрганизацииСДетализациейМатериальныхИПостатейныхЗатрат))
		|			)
		|		  )
		// Исключаем проверку движений по переброске расходов между организациями в упр. учете.
		|		И НЕ Т.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторнированиеРасходовУУ),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РегистрацияРасходовУУ))
		// Исключаем списание продукции на расходы по плановой стоимости
		|		И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
		|		И НЕ Т.РасчетПартий
		|		И НЕ Т.РасчетСебестоимости
		|		И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовОСиНМА)
		|		И НЕ ТИПЗНАЧЕНИЯ(ДокументСторно.СторнируемыйДокумент) В (&ТипыДокументовОСиНМА)
		|		И (НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыРегламентныхДокументов)
		|			ИЛИ ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.КорректировкаПриобретения))
		|		И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (&ТипыДокументовБезДвижений)
		|	) КАК Т
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Ссылка,
		|	Т.Организация,
		|	Т.Подразделение,
		|	Т.НаправлениеДеятельности,
		|	Т.СтатьяРасходов,
		|	Т.АналитикаРасходов
		|;
		|/////////////////////////////////////////////////////////////////////////////
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ПартииПрочихРасходов"" КАК ИмяРегистра,
		|	Т.Ссылка 				 КАК Ссылка,
		|	Т.Организация 			 КАК Организация,
		|	(ВЫБОР
		|		КОГДА Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|		 ИЛИ Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА (ВЫБОР
		|					КОГДА 
		//++ Локализация
		|					  (Т.Организация В (&ОрганизацииПлательщикиНДД)
		|			 		  И Т.ЕстьПрочиеРасходы И НЕ Т.ЕстьПартииПрочихРасходов) ИЛИ
		//-- Локализация
		|					  ЛОЖЬ
		|						ТОГДА 3
		|					ИНАЧЕ 2 КОНЕЦ)
		|		ИНАЧЕ 1 КОНЕЦ)		 КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	ВТДвижения КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Организации КАК Организации
		|		ПО Т.Организация = Организации.Ссылка
		//++ Локализация
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНастройкиУчетаНДС КАК УчетнаяПолитика
		|		ПО Организации.Ссылка = УчетнаяПолитика.Организация
		//-- Локализация
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статья
		|		ПО Статья.Ссылка = Т.СтатьяРасходов
		|ГДЕ
		|	ВЫБОР
		//++ Локализация
		|		КОГДА Т.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		 И УчетнаяПолитика.РаздельныйУчетПостатейныхПроизводственныхЗатратПоНалогообложениюНДС
		|		 И (Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
		|			ИЛИ Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты))
		|		 И Статья.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ИзДокумента)
		|			ТОГДА Т.ЕстьПрочиеРасходы И НЕ Т.ЕстьПартииПрочихРасходов
		//-- Локализация
		|		КОГДА (Т.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|			ИЛИ Т.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|			ИЛИ Т.Организация В (&ОрганизацииСДетализациейМатериальныхИПостатейныхЗатрат))
		|		 И (Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|		 ИЛИ Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров))
		|			ТОГДА Т.ЕстьПрочиеРасходы И НЕ Т.ЕстьПартииПрочихРасходов
		|		ИНАЧЕ Т.ЕстьПартииПрочихРасходов
		|	КОНЕЦ
		|;
		|/////////////////////////////////////////////////////////////////////////////
		|
		|УНИЧТОЖИТЬ ВТДвижения";
КонецФункции

Процедура ПараметрыОтбораДокументовЗапросаСтатьиСРаздельнымУчетомНДСВРегистреПартииПрочихРасходов(Запрос) Экспорт
	
	// Типы документов, которые имеют движения только по одному из регистров ПартииПрочихРасходов или ПрочиеРасходы.
	ТипыРегистраторов = Новый Массив;
	
	Для Каждого МетаДокумент Из Метаданные.Документы Цикл
		Если МетаДокумент.Движения.Содержит(Метаданные.РегистрыНакопления.ПрочиеРасходы) <>
		  МетаДокумент.Движения.Содержит(Метаданные.РегистрыНакопления.ПартииПрочихРасходов) Тогда
			ТипыРегистраторов.Добавить(Тип("ДокументСсылка." + МетаДокумент.Имя));
		КонецЕсли;
	КонецЦикла;
	
	ТипыРегистраторов.Добавить(Тип("ДокументСсылка.РаспределениеПрочихЗатрат"));
	
	Запрос.УстановитьПараметр("ТипыДокументовБезДвижений", ТипыРегистраторов);
	
КонецПроцедуры

// Возвращает текст запроса для формирования ВТДвиженияСебестоимостьТоваров
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВТДвиженияСебестоимостьТоваров() Экспорт
	Возврат
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.ВидДвижения				 КАК ВидДвижения,
		|	Т.Регистратор 				 КАК Регистратор,
		|	Т.Организация 				 КАК Организация,
		|	Т.КорОрганизация 			 КАК КорОрганизация,
		|	Т.Партия 	  				 КАК Партия,
		|	Т.КорПартия 	  			 КАК КорПартия,
		|	Т.ХозяйственнаяОперация 	 КАК ХозяйственнаяОперация,
		|	Т.ТипЗаписи					 КАК ТипЗаписи,
		|	Т.АналитикаУчетаПартий		 КАК АналитикаУчетаПартий,
		|	Т.КорАналитикаУчетаПартий	 КАК КорАналитикаУчетаПартий,
		//++ НЕ УТ
		|	Статьи.Ссылка				 КАК СтатьяКалькуляции, 
		|	КорСтатьи.Ссылка			 КАК КорСтатьяКалькуляции, 
		//-- НЕ УТ
		|	Т.РазделУчета				 КАК РазделУчета,
		|	Т.ВидЗапасов				 КАК ВидЗапасов,
		|	Т.КорВидЗапасов				 КАК КорВидЗапасов,
		|	Т.КорРазделУчета			 КАК КорРазделУчета,
		|	Т.АналитикаУчетаНоменклатуры	КАК АналитикаУчетаНоменклатуры,
		|	Т.КорАналитикаУчетаНоменклатуры	КАК КорАналитикаУчетаНоменклатуры,
		|	Т.АналитикаФинансовогоУчета	КАК АналитикаФинансовогоУчета,
		|	Т.КорАналитикаФинансовогоУчета	КАК КорАналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС		 КАК ВидДеятельностиНДС,
		|	Т.КорВидДеятельностиНДС		 КАК КорВидДеятельностиНДС,
		|	Т.ВидДеятельностиНДСДокумента КАК ВидДеятельностиНДСДокумента,
		|	Т.АналитикаУчетаПоПартнерам	 КАК АналитикаУчетаПоПартнерам,
		|	Т.ГруппаПродукции			 КАК ГруппаПродукции,
		|	Т.ДокументИсточник			 КАК ДокументИсточник,
		|	Т.ПериодПродажи				 КАК ПериодПродажи,
		|	Т.Сторно					 КАК Сторно,
		|	Т.ИдентификаторСтроки		 КАК ИдентификаторСтроки,
		|	Т.ИдентификаторФинЗаписи	 КАК ИдентификаторФинЗаписи,
		|	Т.НастройкаХозяйственнойОперации КАК НастройкаХозяйственнойОперации,
		|	Т.ОперацияУчетаСебестоимости КАК ОперацияУчетаСебестоимости,
		|	ВЫБОР КОГДА Т.Количество > 0
		|		ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ 						 КАК ПоложительноеКоличество,
		|	Т.ДокументДвижения			 КАК ДокументДвижения,
		|	Т.КорСтоимость				 КАК КорСтоимость,
		|	Т.СтатьяДоходов				 КАК СтатьяДоходов,
		|	Т.Количество				 КАК Количество,
		|	Т.Стоимость					 КАК Стоимость,
		|	Т.СтоимостьРегл				 КАК СтоимостьРегл,
		|	Т.НДСРегл					 КАК НДСРегл,
		|	Т.СтоимостьЗабалансоваяРегл	 КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ ВТДвиженияСебестоимостьТоваров
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК Т
		//++ НЕ УТ
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
		|			ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтатьиКалькуляции КАК Статьи
		|			ПО АналитикаНоменклатуры.СтатьяКалькуляции = Статьи.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорАналитикаНоменклатуры
		|			ПО Т.КорАналитикаУчетаНоменклатуры = КорАналитикаНоменклатуры.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтатьиКалькуляции КАК КорСтатьи
		|			ПО КорАналитикаНоменклатуры.СтатьяКалькуляции = КорСтатьи.Ссылка
		//-- НЕ УТ
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Т.Организация В(&МассивОрганизаций)
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И НЕ ТИПЗНАЧЕНИЯ(Т.Регистратор) В (ТИП(Документ.РасчетСебестоимостиТоваров),
		//++ НЕ УТ
		|									ТИП(Документ.РасчетРезервовПодОбесценениеЗапасов),
		//-- НЕ УТ
		|									ТИП(Документ.КорректировкаРегистров))
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|";
КонецФункции

// Возвращает текст запроса, позволяющего получить список документов
// с некорректными (задублированными) движениями по выручке и себестоимости продаж,
// появившимися в результате ошибки 00-00071689.
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаДокументыСДублямиДвиженийПоВыручкеИСебестоимостиПродаж() Экспорт
	Возврат
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ВыручкаИСебестоимостьПродаж"" КАК ИмяРегистра,
		|	Т.Регистратор 					КАК Ссылка,
		|	Аналитики.Организация			КАК Организация,
		|	1 								КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитики
		|		ПО Т.АналитикаУчетаПоПартнерам = Аналитики.Ссылка
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Аналитики.Организация В(&МассивОрганизаций)
		|	И Т.Количество = 0
		|	И Т.Стоимость <> 0
		|	И НЕ Т.РасчетСебестоимости
		|	И НЕ Т.Регистратор ССЫЛКА Документ.КорректировкаРегистров
		|	И НЕ Т.Регистратор ССЫЛКА Документ.РасчетСебестоимостиТоваров
		//++ НЕ УТ
		|	И НЕ Т.Регистратор ССЫЛКА Документ.РасчетРезервовПодОбесценениеЗапасов
		//-- НЕ УТ
		|	И НЕ Т.Регистратор ССЫЛКА Документ.КорректировкаРеализации";
КонецФункции

// Возвращает текст запроса, позволяющего получить список документов
// с пропавшими движениями по корректировке выручки и себестоимости продаж,
// появившимися в результате ошибки 00-00302463.
//
Функция ТекстЗапросаДокументыСПропавшимиДвижениямиПоВыручкеИСебестоимостиПродаж()
	Возврат
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	""ВыручкаИСебестоимостьПродаж"" 		КАК ИмяРегистра,
		|	Т.Регистратор							КАК Ссылка,
		|	Т.АналитикаУчетаПоПартнерам.Организация	КАК Организация,
		|	1 										КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ВыручкаИСебестоимостьПродаж"" КАК ИмяРегистра,
		|	Т.Ссылка 						КАК Ссылка,
		|	Т.Ссылка.Организация			КАК Организация,
		|	1 								КАК КодОшибки
		|ИЗ
		|	Документ.КорректировкаРеализации.ВидыЗапасовКорректировкаВыручки КАК Т
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Выручка
		|		ПО Т.Ссылка = Выручка.Регистратор
		|		И Т.АналитикаУчетаНоменклатуры.Номенклатура = Выручка.АналитикаУчетаНоменклатуры.Номенклатура
		|		И Т.АналитикаУчетаНоменклатуры.Характеристика = Выручка.АналитикаУчетаНоменклатуры.Характеристика
		|		И Т.АналитикаУчетаНоменклатуры.Серия = Выручка.АналитикаУчетаНоменклатуры.Серия
		|		И Выручка.Количество = 0
		|		И НЕ Выручка.РасчетСебестоимости
		|ГДЕ
		|	Т.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Т.Ссылка.Организация В(&МассивОрганизаций)
		|	И (Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
		|		ИЛИ (Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
		|			И ВЫБОР КОГДА Т.Ссылка.ДокументОснование ССЫЛКА Документ.РеализацияТоваровУслуг
		|				ТОГДА ВЫРАЗИТЬ(Т.Ссылка.ДокументОснование КАК Документ.РеализацияТоваровУслуг).ВернутьМногооборотнуюТару
		|				ИНАЧЕ ЛОЖЬ
		|			  КОНЕЦ = ЛОЖЬ)
		|		ИЛИ Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры ЕСТЬ NULL)
		|	И Выручка.Регистратор ЕСТЬ NULL
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Движения по регистру "Выручка и себестоимость продаж" должны соответствовать движениям по регистру "Себестоимость товаров"
		// по полям: Период, Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета,
		// ЗаказКлиента, ИдентификаторФинЗаписи, Сторно.
		// Партионные измерения не учитываем, т.к. они еще не заполнены в начале закрытия месяца.
		// По полю АналитикаУчетаПоПартнерам соответствие не проверяем, т.к. это поле не всегда заполняется в движениях регистра "Себестоимость товаров".
		// У отчетов давальцу в движениях по регистру "Выручка и себестоимость продаж" вид запасов не заполняется.
		// Для таких движений соединение с себестоимостью товаров по полю "Вид запасов" не нужно делать. 
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ВыручкаИСебестоимостьПродаж"" КАК ИмяРегистра,
		|	Т.Регистратор					КАК Ссылка,
		|	Аналитика.Организация			КАК Организация,
		|	2 								КАК КодОшибки
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Себестоимость
		|		ПО Себестоимость.Период = Т.Период
		|		И Себестоимость.Регистратор = Т.Регистратор
		|		И (Себестоимость.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|			ИЛИ Т.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента), 
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов))
		|			И Себестоимость.КорАналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|		)
		// Для отчетов давальцу вид запасов не заполняется.
		|		И (Себестоимость.ВидЗапасов = Т.ВидЗапасов
		|			ИЛИ Т.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Услуга))
		|		И Себестоимость.Организация = Аналитика.Организация
		|		И Себестоимость.РазделУчета = Т.РазделУчета
		|		И Себестоимость.ЗаказКлиента = Т.ЗаказКлиента
		|		И Себестоимость.ИдентификаторФинЗаписи = Т.ИдентификаторФинЗаписи
		|		И Себестоимость.Сторно = Т.Сторно
		|ГДЕ
		|	&ИспользоватьУчетСебестоимости
		|	И Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Аналитика.Организация В (&МассивОрганизаций)
		|	И Т.Количество <> 0
		|	И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		// Для хоз. операции "Оприходование по возврату" расчет себестоимости не выполняется (себестоимость определяется данными документа),
		// поэтому по таким операциям не нужно проверять соответствие движений регистров.
		|	И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеПоВозврату)
		|	И Т.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ОприходованиеПоВозврату)
		|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.ВводОстатковОПродажахЗаПрошлыеПериоды)
		|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) <> ТИП(Документ.ВводОстатков)
		// В прошлых периодах могут быть движения с устаревшими видами запасов. Такие движения исключаем из проверки.
		|	И НЕ Т.ВидЗапасов.Устаревший 
		|	И Т.Активность
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Себестоимость.Регистратор ЕСТЬ NULL
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ВыручкаИСебестоимостьПродаж"" КАК ИмяРегистра,
		|	Т.Регистратор					КАК Ссылка,
		|	Аналитика.Организация			КАК Организация,
		|	3 								КАК КодОшибки
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Аналитика.Организация В (&МассивОрганизаций)
		|	И Т.Количество <> 0
		|	И Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|	И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяССылка)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Движения по регистру "Себестоимость товаров" должны соответствовать регистру "Выручка и себестоимость продаж"
		// в части заполнение поля "Аналитика учета по партнерам".
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""СебестоимостьТоваров""		КАК ИмяРегистра,
		|	Т.Регистратор					КАК Ссылка,
		|	Аналитика.Организация			КАК Организация,
		|	2 								КАК КодОшибки
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаПоПартнерам
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Выручка
		|		ПО Выручка.Период = Т.Период
		|		И Выручка.Регистратор = Т.Регистратор
		|		И Выручка.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|		И Выручка.ВидЗапасов = Т.ВидЗапасов
		|		И Выручка.АналитикаУчетаПоПартнерам.Организация = Т.Организация
		|		И Выручка.РазделУчета = Т.РазделУчета
		|		И Выручка.ЗаказКлиента = Т.ЗаказКлиента
		|		И Выручка.АналитикаУчетаПоПартнерам = Т.АналитикаУчетаПоПартнерам
		|		И Выручка.ИдентификаторФинЗаписи = Т.ИдентификаторФинЗаписи
		|		И Выручка.Сторно = Т.Сторно
		|ГДЕ
		|	&ИспользоватьУчетСебестоимости
		|	И Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Т.Организация В (&МассивОрганизаций)
		|	И Т.Количество <> 0
		// Для хоз. операции "Оприходование по возврату" расчет себестоимости не выполняется (себестоимость определяется данными документа),
		// поэтому по таким операциям не нужно проверять соответствие движений регистров.
		|	И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеПоВозврату)
		|	И Т.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ОприходованиеПоВозврату)
		|	И ТИПЗНАЧЕНИЯ(Т.Регистратор) = ТИП(Документ.ОтчетОРозничныхВозвратах)
		|	И Т.Активность
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Выручка.Регистратор ЕСТЬ NULL
		|";
КонецФункции

Процедура ОчиститьДанныеУпрРегистров(ПараметрыРасчета)
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ОчиститьДанныеУправленческихРегистров");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Регистратор
		|ИЗ
		|	РегистрНакопления.ДвиженияДоходыРасходыПрочиеАктивыПассивы КАК Т
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Т.Организация В(&МассивОрганизаций)
		|	И Т.Регистратор ССЫЛКА Документ.РаспределениеПрочихЗатрат";
	
	Результат = Запрос.Выполнить();
	
	Если Не Результат.Пустой() Тогда
		
		Выборка = Результат.Выбрать();
		
		ПараметрыЗаписи = РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьПараметрыЗаписи(
			ПараметрыРасчета.РасчетныйПериод.НачалоПериода,
			ПараметрыРасчета.НомерЗаданияДоРасчета);
	
		Попытка
			РасчетСебестоимостиПрикладныеАлгоритмы.ЗаписатьДвиженияПоРегистру(
				Выборка,
				РегистрыНакопления.ДвиженияДоходыРасходыПрочиеАктивыПассивы,
				ПараметрыЗаписи);
		Исключение
			
			// Информацию об ошибке добавим в протокол расчета, в механизме закрытия месяца ошибки уже должны быть зарегистрированы.
			ТекстДляПротокола = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
			
			РасчетСебестоимостиПротоколРасчета.ЗафиксироватьОшибкуРасчета(
				ПараметрыРасчета,
				Перечисления.ТипыОшибокПартионногоУчетаИСебестоимости.ОшибкаЗаписиДвиженийПоРегистрам,
				ТекстДляПротокола);
				
			ВызватьИсключение ТекстДляПротокола;
			
		КонецПопытки;
		
		РасчетСебестоимостиПротоколРасчета.ДополнительнаяИнформация(
			ПараметрыРасчета,
			СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Очищено движений по регистру %1: %2';
					|en = 'Records by %1 register cleared:%2'", ОбщегоНазначения.КодОсновногоЯзыка()),
				Метаданные.РегистрыНакопления.ДвиженияДоходыРасходыПрочиеАктивыПассивы.ПолноеИмя(),
				РасчетСебестоимостиПротоколРасчета.ПредставлениеЗначения(Выборка.Количество())));
		
		
	КонецЕсли;
	
КонецПроцедуры

#Область ВключениеУчетаСебестоимостиПоВидамЗапасов

// Выбираем документы, в движениях которых не заполнен вид запасов, кроме исключений.
// Дополнительно выбираем данные из документов "Исправление развернутого сальдо товаров организаций",
// если у них не было движений по регистру "Себестоимость товаров" и отличаются виды запасов списания и оприходования.
//
// Движения, для которых не заполняется вид запасов в учете себестоимости товаров:
// - в аналитике учета номенклатуры указана номенклатура с типом номенклатуры "Работа" или "Услуга"
// - товары, выкупленные у комитентов
//		раздел учета "Товары на складах", в аналитике учета номенклатуры тип места хранения "Партнер" или "Организация"
// - продукция, отраженная отчетами переработчика
//		раздел учета "Производственные затраты", в аналитике учета номенклатуры тип места хранения "Партнер"
// - работы к оформлению отчетов давальцу
//		движения "Приход" по разделу учета "Производственные затраты" с заполненным реквизитом "Кор. аналитика учета номенклатуры", 
//		хозяйственной операцией "Выпуск продукции", и типом записи "Партия"
// - продукция, реализованная документом "Отчет давальцу"
//		движения с хозяйственной операцией "Отчет давальцу"
//
// Дополнительные исключения для выручки и себестоимости продаж:
// - в типе запасов указано значение "Агентская услуга"
//	(в аналитике учета номенклатуры указана номенклатура с типом номенклатуры "Услуга. Выполняется партнером")
//
// Исключения для документов производства 2.1:	
// - вид запасов в движениях заполняется оффлайн: раздел учета "Производственные затраты" и тип записи "Потребление (производство)"
// - для документа "Перемещение материалов в производстве" вид запасов в движениях заполняется оффлайн
//
// Необходимо исправить движения в регистрах:
//	- Себестоимость товаров
//	- Выручка и себестоимость продаж
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВключениеУчетаСебестоимостиПоВидамЗапасов() Экспорт
	Возврат "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""СебестоимостьТоваров""			КАК ИмяРегистра,
		|	СебестоимостьТоваров.Регистратор	КАК Ссылка,
		|	СебестоимостьТоваров.Организация	КАК Организация,
		|	1									КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|ГДЕ
		|	СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И СебестоимостьТоваров.Организация В(&МассивОрганизаций)
		|	И СебестоимостьТоваров.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|	И СебестоимостьТоваров.Количество <> 0
		|	И НЕ СебестоимостьТоваров.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга))
		// Товары, выкупленные у комитентов, или отраженные отчетами переработчика
		|	И НЕ (
		|		СебестоимостьТоваров.РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
		|		И СебестоимостьТоваров.АналитикаУчетаНоменклатуры.ТипМестаХранения В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Организация)))
		//++ НЕ УТ

		// Возвратные отходы, отраженные отчетом переработчика.
		|	И НЕ (
		|		СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|		И СебестоимостьТоваров.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		И СебестоимостьТоваров.ХозяйственнаяОперация В
		|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|			 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость))
		//++ Устарело_Переработка24
		|		И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) = ТИП(Документ.ОтчетПереработчика)
		//-- Устарело_Переработка24
		|		И СебестоимостьТоваров.Количество < 0)
		//-- НЕ УТ

		//++ НЕ УТКА
		
		// Приход и списание выпущенной работы переработчика, для зависимых организаций (филиалов)
		|	И НЕ (СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			И СебестоимостьТоваров.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			И СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами)    
		|			И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) В (ТИП(Документ.ПроизводствоБезЗаказа), ТИП(Документ.ЭтапПроизводства2_2))
		|		)

		// Работы к оформлению отчетов давальцу
		//++ Устарело_Переработка24
		|	И НЕ (
		|		СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И СебестоимостьТоваров.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		И СебестоимостьТоваров.ХозяйственнаяОперация В
		|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|			 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость))
		|		И СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка))
		|	И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) <> ТИП(Документ.ОтчетДавальцу)
		|	И НЕ (ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) = ТИП(Документ.Сторно)
		|		И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.ДокументИсточник) = ТИП(Документ.ОтчетДавальцу))
		//-- Устарело_Переработка24
		// Скорректированные работы к оформлению отчетов давальцу
		|	И НЕ (ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) = ТИП(Документ.КорректировкаРеализации)
		|		И СебестоимостьТоваров.ХозяйственнаяОперация В 
		|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСторно),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуКорректировкаПрошлогоПериода)))
		//-- НЕ УТКА

		//++ Устарело_Производство21

		//++ НЕ УТ

		// Для документов производства 2.1 вид запасов в движениях заполняется оффлайн:
		// раздел учета "Производственные затраты" и тип записи "Потребление (производство)"
		|	И НЕ (
		|		СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И СебестоимостьТоваров.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеПроизводство))
		// Для документа "Перемещение материалов в производстве" вид запасов в движениях заполняется оффлайн.
		|	И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Регистратор) <> ТИП(Документ.ПеремещениеМатериаловВПроизводстве)
		//-- НЕ УТ

		//-- Устарело_Производство21
		|	И НЕ СебестоимостьТоваров.РасчетСебестоимости
		|	И НЕ СебестоимостьТоваров.РасчетПартий
		|	И НЕ СебестоимостьТоваров.Регистратор ССЫЛКА Документ.РасчетСебестоимостиТоваров
		//++ НЕ УТ
		|	И НЕ СебестоимостьТоваров.Регистратор ССЫЛКА Документ.РасчетРезервовПодОбесценениеЗапасов
		//-- НЕ УТ
		|	И НЕ СебестоимостьТоваров.Сторно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Дополнительно выбираем данные из документов "Исправление развернутого сальдо товаров организаций",
		// если у них не было движений по регистру "Себестоимость товаров" и отличаются виды запасов списания и оприходования.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""СебестоимостьТоваров""		КАК ИмяРегистра,
		|	Исправления.Ссылка				КАК Ссылка,
		|	Исправления.Ссылка.Организация	КАК Организация,
		|	1								КАК КодОшибки
		|ИЗ
		|	Документ.ИсправлениеРазвернутогоСальдоТоваровОрганизаций.Исправления КАК Исправления
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ПО СебестоимостьТоваров.Период = Исправления.Ссылка.Дата
		|		И СебестоимостьТоваров.Регистратор = Исправления.Ссылка
		|ГДЕ
		|	Исправления.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Исправления.Ссылка.Организация В(&МассивОрганизаций)
		|	И Исправления.ВидЗапасовСписания <> Исправления.ВидЗапасовОприходования
		|	И СебестоимостьТоваров.Регистратор ЕСТЬ NULL
		|";
КонецФункции

// Выбираем документы, в движениях которых не заполнен вид запасов, кроме исключений.
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВключениеУчетаВыручкиИСебестоимостиПродажПоВидамЗапасов() Экспорт
	Возврат "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ВыручкаИСебестоимостьПродаж""			КАК ИмяРегистра,
		|	ВыручкаИСебестоимостьПродаж.Регистратор	КАК Ссылка,
		|	Аналитики.Организация					КАК Организация,
		|	1										КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ВыручкаИСебестоимостьПродаж
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитики
		|		ПО ВыручкаИСебестоимостьПродаж.АналитикаУчетаПоПартнерам = Аналитики.Ссылка
		|ГДЕ
		|	ВыручкаИСебестоимостьПродаж.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Аналитики.Организация В(&МассивОрганизаций)
		|	И ВыручкаИСебестоимостьПродаж.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|	И ВыручкаИСебестоимостьПродаж.Количество <> 0
		|	И НЕ ВыручкаИСебестоимостьПродаж.ТипЗапасов В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Услуга),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.АгентскаяУслуга))
		|	И ВыручкаИСебестоимостьПродаж.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		//++ НЕ УТКА

		//++ Устарело_Переработка24
		|	И ТИПЗНАЧЕНИЯ(ВыручкаИСебестоимостьПродаж.Регистратор) <> ТИП(Документ.ОтчетДавальцу)
		//-- Устарело_Переработка24

		//-- НЕ УТКА
		|	И НЕ ВыручкаИСебестоимостьПродаж.РасчетСебестоимости
		|	И НЕ ВыручкаИСебестоимостьПродаж.РасчетПартий
		|	И НЕ ВыручкаИСебестоимостьПродаж.Регистратор ССЫЛКА Документ.РасчетСебестоимостиТоваров
		//++ НЕ УТ
		|	И НЕ ВыручкаИСебестоимостьПродаж.Регистратор ССЫЛКА Документ.РасчетРезервовПодОбесценениеЗапасов
		//-- НЕ УТ
		|	И НЕ ВыручкаИСебестоимостьПродаж.Регистратор ССЫЛКА Документ.ВводОстатков
		|	И НЕ ВыручкаИСебестоимостьПродаж.Регистратор ССЫЛКА Документ.ВводОстатковОПродажахЗаПрошлыеПериоды
		|";
КонецФункции

#КонецОбласти

#Область ВключениеУчетаСебестоимости

// Выбираем документы, у которых есть движения по оперативным регистрам, но нет движений по учету себестоимости.
// Используются данные следующих оперативных регистров:
//	- Товары организаций
//		кроме таможенных деклараций с нулевыми суммами пошлины и НДС
//		кроме перемещений товаров в статусе "Отгружено"
//		кроме сборок товаров в статусе "В работе"
//++ Локализация
//		кроме уведомлений об остатках и ввозах прослеживаемых товаров (документы не делают движения по учету себестоимости)
//-- Локализация
//	- Товары организаций к передаче
//	- Товары переданные переработчику
//	- Товары полученные от переработчика
//	- Товары к оформлению таможенных деклараций (движения "Приход)
//	- Материалы и работы в производстве (учитываются работы при партионном учете версии 2.2,
//		при партионном учете 2.1 не используется одновременно с онлайн движениями по регистру "Себестоимость товаров")
//		исключаются движения у документов "Маршрутный лист производства", "Списание затрат на выпуск", "Распределение материалов и работ",
//		используемых для производства 2.1, т.к. эти документы не делают онлайн движений по регистру "Себестоимость товаров" 
//		одновременно с регистром "Материалы и работы в производстве".
// Дополнительно к оперативным регистрам выбираем данные непосредственно из документов (у этих документов нет оперативных регистров):
//	- Отчет давальцу
//	- Заявление о ввозе товаров из ЕАЭС с заполненной суммой НДС
//	- Ввод остатков с выключенным флажком "ОУ"
// Исключения:
//	- Для движений себестоимости по разделу учета "Незавершенное производство" нет соответствующих оперативных регистров.
//		Но этот раздел учета всегда корреспондирует с другими разделами, которые имеют соответствующие оперативные регистры.
//		Поэтому движения по разделу "Незавершенное производстве" не проверяем. Они будут переформированы одновременно с другими движениями.
//	- Движения документов "Заявление о ввозе товаров из ЕАЭС" по себестоимости не имеют соответствующих оперативных регистров. 
//		Проверяем данные в табличной части документов
//	- Движения документов "Распределение материалов и работ" при распределении материалов по правилу
//	- Движения документов "Исправление развернутого сальдо товаров организаций" если в движениях не меняется вид запасов.
// 		У таких документов не будет движений по регистру "Себестоимость товаров".
//	- Документы корректировки регистров. У таких документов могут быть движения только по оперативным регистрам.
//	- Документы ввода начальных остатков, у которых снят флажок "Себестоимость" (у таких документов нет движений по учету себестоимости)
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВключениеУчетаСебестоимости() Экспорт
	Возврат "
		// Выбираем таможенные декларации на импорт, в которых указаны нулевые суммы таможенной пошлины и НДС.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.Ссылка,
		|	Строки.АналитикаУчетаНоменклатуры
		|ПОМЕСТИТЬ ДекларацииСНулевымиСуммами
		|ИЗ
		|	Документ.ТаможеннаяДекларацияИмпорт КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Строки
		|		ПО Строки.Ссылка = ДД.Ссылка
		|ГДЕ
		|	ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Проведен
		|	И Строки.СуммаПошлины = 0
		|	И Строки.СуммаНДС = 0
		|	И ДД.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыТаможенныхДеклараций.ВыпущеноСТаможни)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Если в аналитике учета номенклатуры место хранения отличается от склада,
		// то подберем аналитику учета номенклатуры, соответствующую складу.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.Ссылка,
		|	Аналитика.КлючАналитики КАК АналитикаУчетаНоменклатуры
		|ИЗ
		|	Документ.ТаможеннаяДекларацияИмпорт КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Строки
		|		ПО Строки.Ссылка = ДД.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Номенклатура = Строки.Номенклатура
		|		И Аналитика.Характеристика = Строки.Характеристика
		|		И Аналитика.Серия = Строки.Серия
		|		И Аналитика.МестоХранения = Строки.Склад
		|		И (ВЫБОР КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Аналитика.Назначение = Строки.Назначение
		|			ИНАЧЕ Аналитика.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) КОНЕЦ)
		|ГДЕ
		|	ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Проведен
		|	И Строки.СуммаПошлины = 0
		|	И Строки.СуммаНДС = 0
		|	И ДД.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыТаможенныхДеклараций.ВыпущеноСТаможни)
		|;
		// Выбираем документы, у которых есть движения по оперативным регистрам.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Товары.Регистратор КАК Регистратор,
		|	Товары.Организация КАК Организация
		|ПОМЕСТИТЬ ДокументыСДвижениями
		|ИЗ (
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыОрганизаций.Регистратор КАК Регистратор,
		|		ТоварыОрганизаций.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
		// Исключаем таможенные декларации с нулевыми суммами пошлины и НДС
		|		ЛЕВОЕ СОЕДИНЕНИЕ ДекларацииСНулевымиСуммами КАК Декларации
		|			ПО Декларации.Ссылка = ТоварыОрганизаций.Регистратор
		|			И Декларации.АналитикаУчетаНоменклатуры = ТоварыОрганизаций.АналитикаУчетаНоменклатуры
		|			И ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) = ТИП(Документ.ТаможеннаяДекларацияИмпорт)
		// Исключаем перемещения товаров в статусе "Отгружено"
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПеремещениеТоваров КАК Перемещение
		|			ПО Перемещение.Ссылка = ТоварыОрганизаций.Регистратор
		|			И Перемещение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыПеремещенийТоваров.Отгружено)
		// Исключаем сторно перемещения товаров в статусе "Отгружено"
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.Сторно КАК СторноПеремещенияТоваров
		|			ПО СторноПеремещенияТоваров.Ссылка = ТоварыОрганизаций.Регистратор
		|			И СторноПеремещенияТоваров.СторнируемыйДокумент ССЫЛКА Документ.ПеремещениеТоваров
		|			И ВЫРАЗИТЬ(СторноПеремещенияТоваров.СторнируемыйДокумент КАК Документ.ПеремещениеТоваров).Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыПеремещенийТоваров.Отгружено)
		// Исключаем сборки товаров в статусе "В работе"
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СборкаТоваров КАК Сборка
		|			ПО Сборка.Ссылка = ТоварыОрганизаций.Регистратор
		|			И Сборка.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСборокТоваров.ВРаботе)
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ТоварыОрганизаций.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыОрганизаций.Организация В(&МассивОрганизаций)
		|		И (ТоварыОрганизаций.ОрганизацияОтгрузки = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|			ИЛИ ТоварыОрганизаций.ОрганизацияОтгрузки = ТоварыОрганизаций.Организация)
		|		И ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		// Исключаем движения документов производства 2.2, для которых нет онлайн движений по регистру "Себестоимость товаров"
		|		И ТоварыОрганизаций.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства)
		// Исключаем движения документов "Исправление развернутого сальдо товаров организаций" и "Корректировка назначения товаров",
		// если в движениях не меняется вид запасов. У таких документов не будет движений по регистру "Себестоимость товаров".
		|		И НЕ (
		|			ТоварыОрганизаций.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаОбособленногоУчета)
		|			И ТоварыОрганизаций.ВидЗапасов = ТоварыОрганизаций.КорВидЗапасов)
		// Исключаем таможенные декларации с нулевыми суммами пошлины и НДС
		|		И Декларации.Ссылка ЕСТЬ NULL
		// Исключаем вводы остатков с выключенным учетом себестоимости
		|		И ЕСТЬNULL(ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ВводОстатков).ОтражатьСебестоимость, ИСТИНА)
		|		И ЕСТЬNULL(ВЫРАЗИТЬ(ТоварыОрганизаций.Регистратор КАК Документ.ВводОстатковТоваров).ОтражатьСебестоимость, ИСТИНА)
		// Исключаем перемещения товаров в статусе "Отгружено"
		|		И Перемещение.Ссылка ЕСТЬ NULL
		// Исключаем сторно перемещения товаров в статусе "Отгружено"
		|		И СторноПеремещенияТоваров.Ссылка ЕСТЬ NULL
		// Исключаем сборки товаров в статусе "В работе"
		|		И Сборка.Ссылка ЕСТЬ NULL
		//++ Локализация
		
		// Исключаем уведомления об остатках и ввозах прослеживаемых товаров (документы не делают движений по учету себестоимости)
		|		И ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) <> ТИП(Документ.УведомлениеОбОстаткахПрослеживаемыхТоваров)
		|		И ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) <> ТИП(Документ.УведомлениеОВвозеПрослеживаемыхТоваров)
		//-- Локализация
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыОрганизацийКПередаче.Регистратор КАК Регистратор,
		|		ТоварыОрганизацийКПередаче.ВидЗапасовПродавца.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыОрганизацийКПередаче КАК ТоварыОрганизацийКПередаче
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ТоварыОрганизацийКПередаче.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыОрганизацийКПередаче.ВидЗапасовПродавца.Организация В(&МассивОрганизаций)
		|		И ТИПЗНАЧЕНИЯ(ТоварыОрганизацийКПередаче.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		|
		//++ НЕ УТ
		
		//++ Устарело_Переработка24
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыПереданныеПереработчику.Регистратор КАК Регистратор,
		|		ТоварыПереданныеПереработчику.ВидЗапасов.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыПереданныеПереработчику КАК ТоварыПереданныеПереработчику
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ТоварыПереданныеПереработчику.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыПереданныеПереработчику.ВидЗапасов.Организация В(&МассивОрганизаций)
		|		И ТИПЗНАЧЕНИЯ(ТоварыПереданныеПереработчику.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		// Исключаем вводы остатков с выключенным учетом себестоимости
		|		И ЕСТЬNULL(ВЫРАЗИТЬ(ТоварыПереданныеПереработчику.Регистратор КАК Документ.ВводОстатков).ОтражатьСебестоимость, ИСТИНА)
		|		И ЕСТЬNULL(ВЫРАЗИТЬ(ТоварыПереданныеПереработчику.Регистратор КАК Документ.ВводОстатковТоваров).ОтражатьСебестоимость, ИСТИНА)
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыПолученныеОтПереработчика.Регистратор КАК Регистратор,
		|		ТоварыПолученныеОтПереработчика.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыПолученныеОтПереработчика КАК ТоварыПолученныеОтПереработчика
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ТоварыПолученныеОтПереработчика.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыПолученныеОтПереработчика.Организация В(&МассивОрганизаций)
		|		И ТИПЗНАЧЕНИЯ(ТоварыПолученныеОтПереработчика.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		//-- Устарело_Переработка24
		
		//-- НЕ УТ
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыКОформлениюДокументовИмпорта.Регистратор КАК Регистратор,
		|		ТоварыКОформлениюДокументовИмпорта.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыКОформлениюДокументовИмпорта КАК ТоварыКОформлениюДокументовИмпорта
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ТоварыКОформлениюДокументовИмпорта.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыКОформлениюДокументовИмпорта.Организация В(&МассивОрганизаций)
		|		И ТоварыКОформлениюДокументовИмпорта.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		И ТИПЗНАЧЕНИЯ(ТоварыКОформлениюДокументовИмпорта.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		|		И ТоварыКОформлениюДокументовИмпорта.ТипДокументаИмпорта = &ТипДокументаИмпорта
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		МатериалыИРаботыВПроизводстве.Регистратор КАК Регистратор,
		|		МатериалыИРаботыВПроизводстве.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.МатериалыИРаботыВПроизводстве КАК МатериалыИРаботыВПроизводстве
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И МатериалыИРаботыВПроизводстве.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И МатериалыИРаботыВПроизводстве.Организация В(&МассивОрганизаций)
		|		И МатериалыИРаботыВПроизводстве.Количество <> 0
		|		И НЕ ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) В (
		|			ТИП(Документ.КорректировкаРегистров),
		|			ТИП(Документ.РасчетСебестоимостиТоваров))
		// Исключаем вводы остатков с выключенным учетом себестоимости
		|		И ЕСТЬNULL(ВЫРАЗИТЬ(МатериалыИРаботыВПроизводстве.Регистратор КАК Документ.ВводОстатков).ОтражатьСебестоимость, ИСТИНА)
		|		И ЕСТЬNULL(ВЫРАЗИТЬ(МатериалыИРаботыВПроизводстве.Регистратор КАК Документ.ВводОстатковТоваров).ОтражатьСебестоимость, ИСТИНА)
		//++ НЕ УТ

		// Кроме документов "Распределение материалов и работ" и "Распределение возвратных отходов".
		// Они делают движения по регистру "Материалы и работы в производстве", но не всегда имеют движения по регистру "Себестоимость товаров".
		|		И ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) <> ТИП(Документ.РаспределениеПроизводственныхЗатрат)
		|		И ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) <> ТИП(Документ.РаспределениеВозвратныхОтходов)
		//++ Устарело_Производство21
		// При использовании производства 2.1 документы "Маршрутный лист производства", "Списание затрат на выпуск" и "Распределение материалов и работ"
		// не имеют онлайн движений по регистру "Себестоимость товаров".
		|		И ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) <> ТИП(Документ.СписаниеЗатратНаВыпуск)
		//++ НЕ УТКА
		|		И ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) <> ТИП(Документ.МаршрутныйЛистПроизводства)
		//-- НЕ УТКА

		//-- Устарело_Производство21

		//-- НЕ УТ
		|
		//++ НЕ УТКА

		//++ Устарело_Переработка24
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ОтчетДавальцу.Ссылка КАК Регистратор,
		|		ОтчетДавальцу.Организация КАК Организация
		|	ИЗ
		|		Документ.ОтчетДавальцу КАК ОтчетДавальцу
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ОтчетДавальцу.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ОтчетДавальцу.Организация В(&МассивОрганизаций)
		|		И ОтчетДавальцу.Проведен
		//-- Устарело_Переработка24

		//-- НЕ УТКА
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ЗаявлениеОВвозеТовары.Ссылка КАК Регистратор,
		|		ЗаявлениеОВвозеТовары.Ссылка.Организация КАК Организация
		|	ИЗ
		|		Документ.ЗаявлениеОВвозеТоваров.Товары КАК ЗаявлениеОВвозеТовары
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ЗаявлениеОВвозеТовары.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ЗаявлениеОВвозеТовары.Ссылка.Организация В(&МассивОрганизаций)
		|		И ЗаявлениеОВвозеТовары.Ссылка.Проведен
		|		И ЗаявлениеОВвозеТовары.СуммаНДС <> 0
		|		И ЗаявлениеОВвозеТовары.Номенклатура <> ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		//++ НЕ УТ
		|		И ТИПЗНАЧЕНИЯ(ЗаявлениеОВвозеТовары.ДокументПоступления) <> ТИП(Документ.ЗаключениеДоговораАренды)
		//-- НЕ УТ
		|		И ТИПЗНАЧЕНИЯ(ЗаявлениеОВвозеТовары.ДокументПоступления) <> ТИП(Документ.ПриобретениеУслугПрочихАктивов)
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ВводОстатков.Ссылка КАК Регистратор,
		|		ВводОстатков.Ссылка.Организация КАК Организация
		|	ИЗ
		|		Документ.ВводОстатков.Товары КАК ВводОстатков
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ВводОстатков.Ссылка.ОтражатьСебестоимость
		|		И НЕ ВводОстатков.Ссылка.ОтражатьВОперативномУчете
		|		И ВводОстатков.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ВводОстатков.Ссылка.Организация В(&МассивОрганизаций)
		|		И ВводОстатков.Ссылка.Проведен
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ВводОстатков.Ссылка КАК Регистратор,
		|		ВводОстатков.Ссылка.Организация КАК Организация
		|	ИЗ
		|		Документ.ВводОстатковТоваров.Товары КАК ВводОстатков
		|	ГДЕ
		|		&ИспользоватьУчетСебестоимости
		|		И ВводОстатков.Ссылка.ОтражатьСебестоимость
		|		И НЕ ВводОстатков.Ссылка.ОтражатьВОперативномУчете
		|		И ВводОстатков.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ВводОстатков.Ссылка.Организация В(&МассивОрганизаций)
		|		И ВводОстатков.Ссылка.Проведен
		|	) КАК Товары
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	Организация
		|;
		// Выбираем документы, у которых есть движения по себестоимости.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СебестоимостьТоваров.Регистратор КАК Регистратор,
		|	СебестоимостьТоваров.Организация КАК Организация
		|
		|ПОМЕСТИТЬ ЕстьДвиженияСебестоимости
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыСДвижениями КАК ДокументыСДвижениями
		|		ПО ДокументыСДвижениями.Регистратор = СебестоимостьТоваров.Регистратор
		|		И ДокументыСДвижениями.Организация = СебестоимостьТоваров.Организация
		|ГДЕ
		|	&ИспользоватьУчетСебестоимости
		|	И СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И СебестоимостьТоваров.Организация В(&МассивОрганизаций)
		|	И НЕ СебестоимостьТоваров.РасчетСебестоимости
		|	И НЕ СебестоимостьТоваров.РасчетПартий
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	Организация
		|;
		//Выбираем документы, у которых есть движения по оперативным регистрам, но нет движений по учету себестоимости.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""СебестоимостьТоваров""			КАК ИмяРегистра,
		|	ДокументыСДвижениями.Регистратор	КАК Ссылка,
		|	ДокументыСДвижениями.Организация	КАК Организация,
		|	1									КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	ДокументыСДвижениями КАК ДокументыСДвижениями
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьДвиженияСебестоимости КАК ЕстьДвиженияСебестоимости
		|		ПО ЕстьДвиженияСебестоимости.Регистратор = ДокументыСДвижениями.Регистратор
		|		И ЕстьДвиженияСебестоимости.Организация = ДокументыСДвижениями.Организация
		|
		// Исключаем из ошибок возвраты и сторно возвратов, многооборотной тары, операция - "Возврат от комиссионера (2.0)"
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровОтКлиента КАК ВозвратТоваровОтКлиента
		|		ПО ЕстьДвиженияСебестоимости.Регистратор ЕСТЬ NULL
		|			И ДокументыСДвижениями.Регистратор = ВозвратТоваровОтКлиента.Ссылка
		|			И ВозвратТоваровОтКлиента.ВозвратПереданнойМногооборотнойТары
		|			И ВозвратТоваровОтКлиента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера)
		|			
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.Сторно КАК Сторно
		|		ПО ЕстьДвиженияСебестоимости.Регистратор ЕСТЬ NULL
		|			И ДокументыСДвижениями.Регистратор = Сторно.Ссылка
		|			И  ТИПЗНАЧЕНИЯ(Сторно.СторнируемыйДокумент) = ТИП(Документ.ВозвратТоваровОтКлиента)
		|		
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровОтКлиента КАК СторнированныйВозвратТоваровОтКлиента
		|		ПО Сторно.СторнируемыйДокумент = СторнированныйВозвратТоваровОтКлиента.Ссылка
		|			И СторнированныйВозвратТоваровОтКлиента.ВозвратПереданнойМногооборотнойТары
		|			И СторнированныйВозвратТоваровОтКлиента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера)
		|
		|ГДЕ
		|	&ИспользоватьУчетСебестоимости
		|	И ЕстьДвиженияСебестоимости.Регистратор ЕСТЬ NULL
		|
		// Исключаем из ошибок возвраты и сторно возвратов, многооборотной тары, операция - "Возврат от комиссионера (2.0)"
		|	И ВозвратТоваровОтКлиента.Ссылка ЕСТЬ NULL
		|	И СторнированныйВозвратТоваровОтКлиента.Ссылка ЕСТЬ NULL
		|;
		|УНИЧТОЖИТЬ ДекларацииСНулевымиСуммами;
		|УНИЧТОЖИТЬ ДокументыСДвижениями;
		|УНИЧТОЖИТЬ ЕстьДвиженияСебестоимости
		|";
КонецФункции

#КонецОбласти

#Область ВыключениеУчетаСебестоимостиПоНазначениям

// Выбираем документы, у которых в движениях в аналитике учета номенклатуры указано назначение.
// Необходимо исправить движения в регистрах:
//	- Себестоимость товаров
//	- Выручка и себестоимость продаж
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВыключениеУчетаСебестоимостиПоНазначениям() Экспорт
	Возврат "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""СебестоимостьТоваров""			КАК ИмяРегистра,
		|	СебестоимостьТоваров.Регистратор	КАК Ссылка,
		|	СебестоимостьТоваров.Организация	КАК Организация,
		|	1									КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|ГДЕ
		|	НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|	И СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И СебестоимостьТоваров.Организация В(&МассивОрганизаций)
		|	И СебестоимостьТоваров.АналитикаУчетаНоменклатуры.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
		|	И НЕ СебестоимостьТоваров.РасчетСебестоимости
		|	И НЕ СебестоимостьТоваров.РасчетПартий
		|	И НЕ СебестоимостьТоваров.Регистратор ССЫЛКА Документ.РасчетСебестоимостиТоваров
		//++ НЕ УТ
		|	И НЕ СебестоимостьТоваров.Регистратор ССЫЛКА Документ.РасчетРезервовПодОбесценениеЗапасов
		//-- НЕ УТ
		|";
КонецФункции

// Выбираем документы, у которых в движениях в аналитике учета номенклатуры указано назначение.
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВыключениеУчетаВыручкиИСебестоимостиПродажПоНазначениям() Экспорт
	Возврат "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ВыручкаИСебестоимостьПродаж""			КАК ИмяРегистра,
		|	ВыручкаИСебестоимостьПродаж.Регистратор	КАК Ссылка,
		|	Аналитики.Организация					КАК Организация,
		|	1										КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ВыручкаИСебестоимостьПродаж
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитики
		|		ПО ВыручкаИСебестоимостьПродаж.АналитикаУчетаПоПартнерам = Аналитики.Ссылка
		|ГДЕ
		|	НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|	И ВыручкаИСебестоимостьПродаж.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Аналитики.Организация В(&МассивОрганизаций)
		|	И ВыручкаИСебестоимостьПродаж.АналитикаУчетаНоменклатуры.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
		|	И НЕ ВыручкаИСебестоимостьПродаж.РасчетСебестоимости
		|	И НЕ ВыручкаИСебестоимостьПродаж.РасчетПартий
		|	И НЕ ВыручкаИСебестоимостьПродаж.Регистратор ССЫЛКА Документ.РасчетСебестоимостиТоваров
		//++ НЕ УТ
		|	И НЕ ВыручкаИСебестоимостьПродаж.Регистратор ССЫЛКА Документ.РасчетРезервовПодОбесценениеЗапасов
		//-- НЕ УТ
		|";
КонецФункции

#КонецОбласти

#Область ВключениеУчетаСебестоимостиПоНазначениям

// Выбираем документы, у которых в движениях по оперативным регистрам указано назначение,
// а в движении учета себестоимости не указано назначение.
// Используются данные следующих оперативных регистров:
//	- Товары организаций
//		кроме таможенных деклараций с нулевыми суммами пошлины и НДС
//		кроме перемещений товаров в статусе "Отгружено"
//		кроме сборок товаров в статусе "В работе"
//	- Товары организаций к передаче
//	- Товары переданные переработчику
//	- Товары полученные от переработчика
//	- Товары к оформлению таможенных деклараций (движения "Приход)
//	- Материалы и работы в производстве (учитываются работы при партионном учете версии 2.2,
//		при партионном учете 2.1 не используется одновременно с онлайн движениями по регистру "Себестоимость товаров")
//		исключаются движения у документов "Маршрутный лист производства", "Списание затрат на выпуск", "Распределение материалов и работ",
//		используемых для производства 2.1, т.к. эти документы не делают онлайн движений по регистру "Себестоимость товаров" 
//		одновременно с регистром "Материалы и работы в производстве".
// Дополнительно к оперативным регистрам выбираем данные непосредственно из документов (у этих документов нет оперативных регистров):
//	- Отчет давальцу
//	- Заявление о ввозе товаров из ЕАЭС с заполненной суммой НДС
//	- Ввод остатков с выключенным флажком "ОУ"
// Исключения:
//	- По товарам, переданным на комиссию, учет по назначениям не ведется
//	- По товаром к оформлению отчетов комитенту учет по назначениям не ведется
//	- По товарам, отгруженным без перехода права собственности, учет по назначениям не ведется
//	- Для движений себестоимости по разделу учета "Незавершенное производство" нет соответствующих оперативных регистров.
//		Но этот раздел учета всегда корреспондирует с другими разделами, которые имеют соответствующие оперативные регистры.
//		Поэтому движения по разделу "Незавершенное производстве" не проверяем. Они будут переформированы одновременно с другими движениями.
//	- Движения документов "Заявление о ввозе товаров из ЕАЭС" по себестоимости не имеют соответствующих оперативных регистров. 
//		Проверяем данные в табличной части документов
//	- Движения документов "Распределение материалов и работ" при распределении материалов по правилу
//	- Движения документов "Исправление развернутого сальдо товаров организаций" если в движениях не меняется вид запасов.
// 		У таких документов не будет движений по регистру "Себестоимость товаров".
//	- Документы корректировки регистров. У таких документов могут быть движения только по оперативным регистрам.
//	- Документы ввода начальных остатков, у которых снят флажок "Себестоимость" (у таких документов нет движений по учету себестоимости)
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВключениеУчетаСебестоимостиПоНазначениям() Экспорт
	Возврат "
		|ВЫБРАТЬ
		|	Ключи.Ссылка КАК Ссылка
		|ПОМЕСТИТЬ АналитикаСНазначениями
		|ИЗ
		|	Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И &ИспользоватьУчетСебестоимости
		|	И Ключи.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
		//++ НЕ УТ
		|	И Ключи.СтатьяКалькуляции = ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)
		//-- НЕ УТ
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка
		|;
		// Выбираем таможенные декларации на импорт, в которых указаны нулевые суммы таможенной пошлины и НДС.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.Ссылка КАК Ссылка,
		|	Строки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры
		|ПОМЕСТИТЬ ДекларацииСНулевымиСуммами
		|ИЗ
		|	Документ.ТаможеннаяДекларацияИмпорт КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Строки
		|		ПО Строки.Ссылка = ДД.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|		ПО АналитикаСНазначениями.Ссылка = Строки.АналитикаУчетаНоменклатуры
		|ГДЕ
		|	ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Проведен
		|	И Строки.СуммаПошлины = 0
		|	И Строки.СуммаНДС = 0
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка,
		|	АналитикаУчетаНоменклатуры
		|;
		|ВЫБРАТЬ
		|	ВводОстатков.Ссылка КАК Ссылка
		|ПОМЕСТИТЬ ВТВводОстатковСВыключеннымУчетомСебестоимости
		|ИЗ
		|	Документ.ВводОстатков КАК ВводОстатков
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И &ИспользоватьУчетСебестоимости
		|	И ВводОстатков.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ВводОстатков.Организация В(&МассивОрганизаций)
		|	И НЕ ВводОстатков.ОтражатьСебестоимость
		|	И ВводОстатков.Проведен
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВводОстатков.Ссылка
		|ИЗ
		|	Документ.ВводОстатковТоваров КАК ВводОстатков
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И &ИспользоватьУчетСебестоимости
		|	И ВводОстатков.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ВводОстатков.Организация В(&МассивОрганизаций)
		|	И НЕ ВводОстатков.ОтражатьСебестоимость
		|	И ВводОстатков.Проведен
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка
		|;
		// Выбираем документы, у которых в движениях по оперативным регистрам указано назначение.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Товары.Регистратор КАК Регистратор,
		|	Товары.Организация КАК Организация
		|ПОМЕСТИТЬ ДокументыСНазначениями
		|ИЗ (
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыОрганизаций.Регистратор КАК Регистратор,
		|		ТоварыОрганизаций.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ТоварыОрганизаций.АналитикаУчетаНоменклатуры
		// Исключаем таможенные декларации с нулевыми суммами пошлины и НДС
		|		ЛЕВОЕ СОЕДИНЕНИЕ ДекларацииСНулевымиСуммами КАК Декларации
		|			ПО Декларации.Ссылка = ТоварыОрганизаций.Регистратор
		|			И Декларации.АналитикаУчетаНоменклатуры = ТоварыОрганизаций.АналитикаУчетаНоменклатуры
		|			И ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) = ТИП(Документ.ТаможеннаяДекларацияИмпорт)
		// Исключаем перемещения товаров в статусе "Отгружено"
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПеремещениеТоваров КАК Перемещение
		|			ПО Перемещение.Ссылка = ТоварыОрганизаций.Регистратор
		|			И Перемещение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыПеремещенийТоваров.Отгружено)
		// Исключаем сторно перемещения товаров в статусе "Отгружено"
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.Сторно КАК СторноПеремещенияТоваров
		|			ПО СторноПеремещенияТоваров.Ссылка = ТоварыОрганизаций.Регистратор
		|			И СторноПеремещенияТоваров.СторнируемыйДокумент ССЫЛКА Документ.ПеремещениеТоваров
		|			И ВЫРАЗИТЬ(СторноПеремещенияТоваров.СторнируемыйДокумент КАК Документ.ПеремещениеТоваров).Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыПеремещенийТоваров.Отгружено)
		// Исключаем сборки товаров в статусе "В работе"
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СборкаТоваров КАК Сборка
		|			ПО Сборка.Ссылка = ТоварыОрганизаций.Регистратор
		|			И Сборка.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСборокТоваров.ВРаботе)
		// Исключаем ввод остатков с выключенным учетом себестоимости
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВводОстатковСВыключеннымУчетомСебестоимости ВводОстатков
		|			ПО ТоварыОрганизаций.Регистратор = ВводОстатков.Ссылка
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ТоварыОрганизаций.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыОрганизаций.Организация В(&МассивОрганизаций)
		|		И ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		// Исключаем движения документов производства 2.2, для которых нет онлайн движений по регистру "Себестоимость товаров"
		|		И ТоварыОрганизаций.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства)
		// Исключаем движения документов "Исправление развернутого сальдо товаров организаций" если в движениях не меняется вид запасов.
		// У таких документов не будет движений по регистру "Себестоимость товаров".
		|		И НЕ (
		|			ТоварыОрганизаций.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаОбособленногоУчета)
		|			И ТоварыОрганизаций.ВидЗапасов = ТоварыОрганизаций.КорВидЗапасов
		|			И ТИПЗНАЧЕНИЯ(ТоварыОрганизаций.Регистратор) <> ТИП(Документ.КорректировкаНазначенияТоваров))
		// Исключаем таможенные декларации с нулевыми суммами пошлины и НДС
		|		И Декларации.Ссылка ЕСТЬ NULL
		// Исключаем вводы остатков с выключенным учетом себестоимости
		|		И ВводОстатков.Ссылка ЕСТЬ NULL
		// Исключаем перемещения товаров в статусе "Отгружено"
		|		И Перемещение.Ссылка ЕСТЬ NULL
		// Исключаем сторно перемещения товаров в статусе "Отгружено"
		|		И СторноПеремещенияТоваров.Ссылка ЕСТЬ NULL
		// Исключаем сборки товаров в статусе "В работе"
		|		И Сборка.Ссылка ЕСТЬ NULL
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыОрганизацийКПередаче.Регистратор КАК Регистратор,
		|		ТоварыОрганизацийКПередаче.ВидЗапасовПродавца.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыОрганизацийКПередаче КАК ТоварыОрганизацийКПередаче
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ТоварыОрганизацийКПередаче.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ТоварыОрганизацийКПередаче.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыОрганизацийКПередаче.ВидЗапасовПродавца.Организация В(&МассивОрганизаций)
		|		И ТИПЗНАЧЕНИЯ(ТоварыОрганизацийКПередаче.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		|
		//++ НЕ УТ
		
		//++ Устарело_Переработка24
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыПереданныеПереработчику.Регистратор КАК Регистратор,
		|		ТоварыПереданныеПереработчику.ВидЗапасов.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыПереданныеПереработчику КАК ТоварыПереданныеПереработчику
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ТоварыПереданныеПереработчику.АналитикаУчетаНоменклатуры
		// Исключаем ввод остатков с выключенным учетом себестоимости
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВводОстатковСВыключеннымУчетомСебестоимости ВводОстатков
		|			ПО ТоварыПереданныеПереработчику.Регистратор = ВводОстатков.Ссылка
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ТоварыПереданныеПереработчику.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыПереданныеПереработчику.ВидЗапасов.Организация В(&МассивОрганизаций)
		|		И ТИПЗНАЧЕНИЯ(ТоварыПереданныеПереработчику.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		// Исключаем вводы остатков с выключенным учетом себестоимости
		|		И ВводОстатков.Ссылка ЕСТЬ NULL
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыПолученныеОтПереработчика.Регистратор КАК Регистратор,
		|		ТоварыПолученныеОтПереработчика.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыПолученныеОтПереработчика КАК ТоварыПолученныеОтПереработчика
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ТоварыПолученныеОтПереработчика.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ТоварыПолученныеОтПереработчика.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыПолученныеОтПереработчика.Организация В(&МассивОрганизаций)
		|		И ТИПЗНАЧЕНИЯ(ТоварыПолученныеОтПереработчика.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		//-- Устарело_Переработка24
		
		//-- НЕ УТ
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыКОформлениюДокументовИмпорта.Регистратор КАК Регистратор,
		|		ТоварыКОформлениюДокументовИмпорта.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыКОформлениюДокументовИмпорта КАК ТоварыКОформлениюДокументовИмпорта
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ТоварыКОформлениюДокументовИмпорта.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ТоварыКОформлениюДокументовИмпорта.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыКОформлениюДокументовИмпорта.Организация В(&МассивОрганизаций)
		|		И ТоварыКОформлениюДокументовИмпорта.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		И ТИПЗНАЧЕНИЯ(ТоварыКОформлениюДокументовИмпорта.Регистратор) <> ТИП(Документ.КорректировкаРегистров)
		|		И ТоварыКОформлениюДокументовИмпорта.ТипДокументаИмпорта = &ТипДокументаИмпорта
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		МатериалыИРаботыВПроизводстве.Регистратор КАК Регистратор,
		|		МатериалыИРаботыВПроизводстве.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.МатериалыИРаботыВПроизводстве КАК МатериалыИРаботыВПроизводстве
		// Исключаем ввод остатков с выключенным учетом себестоимости
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВводОстатковСВыключеннымУчетомСебестоимости ВводОстатков
		|			ПО МатериалыИРаботыВПроизводстве.Регистратор = ВводОстатков.Ссылка
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И МатериалыИРаботыВПроизводстве.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И МатериалыИРаботыВПроизводстве.Организация В(&МассивОрганизаций)
		|		И МатериалыИРаботыВПроизводстве.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
		|		И МатериалыИРаботыВПроизводстве.Количество <> 0
		|		И НЕ ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) В (
		|			ТИП(Документ.КорректировкаРегистров),
		|			ТИП(Документ.РасчетСебестоимостиТоваров))
		// Исключаем вводы остатков с выключенным учетом себестоимости
		|		И ВводОстатков.Ссылка ЕСТЬ NULL
		//++ НЕ УТ

		// Кроме документов "Распределение материалов и работ". Они делают движения по регистру "Материалы и работы в производстве",
		// но не всегда имеют движения по регистру "Себестоимость товаров".
		|		И ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) <> ТИП(Документ.РаспределениеПроизводственныхЗатрат)
		//++ Устарело_Производство21
		// При использовании производства 2.1 документы "Маршрутный лист производства", "Списание затрат на выпуск" и "Распределение материалов и работ"
		// не имеют онлайн движений по регистру "Себестоимость товаров".
		|		И ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) <> ТИП(Документ.СписаниеЗатратНаВыпуск)
		//++ НЕ УТКА
		|		И ТИПЗНАЧЕНИЯ(МатериалыИРаботыВПроизводстве.Регистратор) <> ТИП(Документ.МаршрутныйЛистПроизводства)
		//-- НЕ УТКА

		//-- Устарело_Производство21

		//-- НЕ УТ
		|
		//++ НЕ УТКА

		//++ Устарело_Переработка24
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ОтчетДавальцу.Ссылка КАК Регистратор,
		|		ОтчетДавальцу.Организация КАК Организация
		|	ИЗ
		|		Документ.ОтчетДавальцу КАК ОтчетДавальцу
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ОтчетДавальцу.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ОтчетДавальцу.Организация В(&МассивОрганизаций)
		|		И ОтчетДавальцу.Проведен
		//-- Устарело_Переработка24

		//-- НЕ УТКА
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ЗаявлениеОВвозеТовары.Ссылка КАК Регистратор,
		|		ЗаявлениеОВвозеТовары.Ссылка.Организация КАК Организация
		|	ИЗ
		|		Документ.ЗаявлениеОВвозеТоваров.Товары КАК ЗаявлениеОВвозеТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ЗаявлениеОВвозеТовары.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ЗаявлениеОВвозеТовары.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ЗаявлениеОВвозеТовары.Ссылка.Организация В(&МассивОрганизаций)
		|		И ЗаявлениеОВвозеТовары.Ссылка.Проведен
		|		И ЗаявлениеОВвозеТовары.СуммаНДС <> 0
		//++ НЕ УТ
		|		И ТИПЗНАЧЕНИЯ(ЗаявлениеОВвозеТовары.ДокументПоступления) <> ТИП(Документ.ЗаключениеДоговораАренды)
		//-- НЕ УТ
		|		И ТИПЗНАЧЕНИЯ(ЗаявлениеОВвозеТовары.ДокументПоступления) <> ТИП(Документ.ПриобретениеУслугПрочихАктивов)
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ВводОстатков.Ссылка КАК Регистратор,
		|		ВводОстатков.Ссылка.Организация КАК Организация
		|	ИЗ
		|		Документ.ВводОстатков.Товары КАК ВводОстатков
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ВводОстатков.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И ВводОстатков.Ссылка.ОтражатьСебестоимость
		|		И НЕ ВводОстатков.Ссылка.ОтражатьВОперативномУчете
		|		И ВводОстатков.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ВводОстатков.Ссылка.Организация В(&МассивОрганизаций)
		|		И ВводОстатков.Ссылка.Проведен
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ВводОстатков.Ссылка КАК Регистратор,
		|		ВводОстатков.Ссылка.Организация КАК Организация
		|	ИЗ
		|		Документ.ВводОстатковТоваров.Товары КАК ВводОстатков
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ВводОстатков.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И ВводОстатков.Ссылка.ОтражатьСебестоимость
		|		И НЕ ВводОстатков.Ссылка.ОтражатьВОперативномУчете
		|		И ВводОстатков.Ссылка.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ВводОстатков.Ссылка.Организация В(&МассивОрганизаций)
		|		И ВводОстатков.Ссылка.Проведен
		|	) КАК Товары
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	Организация
		|;
		// Выбираем документы, у которых в движениях по себестоимости указано назначение.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СебестоимостьТоваров.Регистратор КАК Регистратор,
		|	СебестоимостьТоваров.Организация КАК Организация
		|
		|ПОМЕСТИТЬ ДвиженияСебестоимостиСНазначениями
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыСНазначениями КАК ДокументыСНазначениями
		|		ПО ДокументыСНазначениями.Регистратор = СебестоимостьТоваров.Регистратор
		|		И ДокументыСНазначениями.Организация = СебестоимостьТоваров.Организация
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|		ПО АналитикаСНазначениями.Ссылка = СебестоимостьТоваров.АналитикаУчетаНоменклатуры
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И СебестоимостьТоваров.Организация В(&МассивОрганизаций)
		|	И НЕ СебестоимостьТоваров.РасчетСебестоимости
		|	И НЕ СебестоимостьТоваров.РасчетПартий
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	Организация
		|;
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СебестоимостьТоваров.Регистратор КАК Регистратор,
		|	СебестоимостьТоваров.Организация КАК Организация
		|
		|ПОМЕСТИТЬ ЕстьДвиженияСебестоимости
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыСНазначениями КАК ДокументыСНазначениями
		|		ПО ДокументыСНазначениями.Регистратор = СебестоимостьТоваров.Регистратор
		|		И ДокументыСНазначениями.Организация = СебестоимостьТоваров.Организация
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И СебестоимостьТоваров.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И СебестоимостьТоваров.Организация В(&МассивОрганизаций)
		|	И НЕ СебестоимостьТоваров.РасчетСебестоимости
		|	И НЕ СебестоимостьТоваров.РасчетПартий
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	Организация
		|;
		// Выбираем документы, у которых в движениях по оперативным регистрам указано назначение,
		// а в движениях учета себестоимости не указано назначение (нет движений с указанным назначением).
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""СебестоимостьТоваров""			КАК ИмяРегистра,
		|	ДокументыСНазначениями.Регистратор	КАК Ссылка,
		|	ДокументыСНазначениями.Организация	КАК Организация,
		|	1									КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	ДокументыСНазначениями КАК ДокументыСНазначениями
		// Выполняем проверерку только при наличии движений по себестоимости товаров. 
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ЕстьДвиженияСебестоимости КАК ЕстьДвиженияСебестоимости
		|		ПО ЕстьДвиженияСебестоимости.Регистратор = ДокументыСНазначениями.Регистратор
		|		И ЕстьДвиженияСебестоимости.Организация = ДокументыСНазначениями.Организация
		|	ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияСебестоимостиСНазначениями КАК СебестоимостьТоваров
		|		ПО СебестоимостьТоваров.Регистратор = ДокументыСНазначениями.Регистратор
		|		И СебестоимостьТоваров.Организация = ДокументыСНазначениями.Организация
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И СебестоимостьТоваров.Регистратор ЕСТЬ NULL
		|;
		|УНИЧТОЖИТЬ АналитикаСНазначениями;
		|УНИЧТОЖИТЬ ДекларацииСНулевымиСуммами;
		|УНИЧТОЖИТЬ ВТВводОстатковСВыключеннымУчетомСебестоимости;
		|УНИЧТОЖИТЬ ДокументыСНазначениями;
		|УНИЧТОЖИТЬ ЕстьДвиженияСебестоимости;
		|УНИЧТОЖИТЬ ДвиженияСебестоимостиСНазначениями
		|";
КонецФункции

// Выбираем документы, у которых в движениях в аналитике учета номенклатуры не указано назначение.
//
// Возвращаемое значение:
//	Строка - текст запроса
//
Функция ТекстЗапросаВключениеУчетаВыручкиИСебестоимостиПродажПоНазначениям() Экспорт
	Возврат "
		|ВЫБРАТЬ
		|	Ключи.Ссылка КАК Ссылка
		|ПОМЕСТИТЬ АналитикаСНазначениями
		|ИЗ
		|	Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И &ИспользоватьУчетСебестоимости
		|	И Ключи.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
		//++ НЕ УТ
		|	И Ключи.СтатьяКалькуляции = ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка)
		//-- НЕ УТ
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка
		|;
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ВыручкаИСебестоимостьПродаж.Регистратор КАК Регистратор,
		|	Аналитики.Организация КАК Организация
		|ПОМЕСТИТЬ ДокументыПродаж
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ВыручкаИСебестоимостьПродаж
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитики
		|		ПО ВыручкаИСебестоимостьПродаж.АналитикаУчетаПоПартнерам = Аналитики.Ссылка
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И &ИспользоватьУчетСебестоимости
		|	И ВыручкаИСебестоимостьПродаж.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Аналитики.Организация В (&МассивОрганизаций)
		|	И НЕ ВыручкаИСебестоимостьПродаж.ХозяйственнаяОперация В (
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
		|;
		// Выбираем документы продаж, у которых в движениях по оперативным регистрам указано назначение.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Товары.Регистратор КАК Регистратор,
		|	Товары.Организация КАК Организация
		|ПОМЕСТИТЬ ДокументыСНазначениями
		|ИЗ (
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыОрганизаций.Регистратор КАК Регистратор,
		|		ТоварыОрганизаций.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыОрганизаций КАК ТоварыОрганизаций
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыПродаж КАК ДокументыПродаж
		|			ПО ДокументыПродаж.Регистратор = ТоварыОрганизаций.Регистратор
		|			И ДокументыПродаж.Организация = ТоварыОрганизаций.Организация
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ТоварыОрганизаций.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ТоварыОрганизаций.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыОрганизаций.Организация В(&МассивОрганизаций)
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ТоварыОрганизацийКПередаче.Регистратор КАК Регистратор,
		|		ТоварыОрганизацийКПередаче.ВидЗапасовПродавца.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.ТоварыОрганизацийКПередаче КАК ТоварыОрганизацийКПередаче
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыПродаж КАК ДокументыПродаж
		|			ПО ДокументыПродаж.Регистратор = ТоварыОрганизацийКПередаче.Регистратор
		|			И ДокументыПродаж.Организация = ТоварыОрганизацийКПередаче.ВидЗапасовПродавца.Организация
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|			ПО АналитикаСНазначениями.Ссылка = ТоварыОрганизацийКПередаче.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ТоварыОрганизацийКПередаче.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ТоварыОрганизацийКПередаче.ВидЗапасовПродавца.Организация В(&МассивОрганизаций)
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		МатериалыИРаботыВПроизводстве.Регистратор КАК Регистратор,
		|		МатериалыИРаботыВПроизводстве.Организация КАК Организация
		|	ИЗ
		|		РегистрНакопления.МатериалыИРаботыВПроизводстве КАК МатериалыИРаботыВПроизводстве
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыПродаж КАК ДокументыПродаж
		|			ПО ДокументыПродаж.Регистратор = МатериалыИРаботыВПроизводстве.Регистратор
		|			И ДокументыПродаж.Организация = МатериалыИРаботыВПроизводстве.Организация
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И МатериалыИРаботыВПроизводстве.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И МатериалыИРаботыВПроизводстве.Организация В(&МассивОрганизаций)
		|		И МатериалыИРаботыВПроизводстве.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
		//++ НЕ УТКА

		//++ Устарело_Переработка24
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ОтчетДавальцу.Ссылка КАК Регистратор,
		|		ОтчетДавальцу.Организация КАК Организация
		|	ИЗ
		|		Документ.ОтчетДавальцу КАК ОтчетДавальцу
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ОтчетДавальцу.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ОтчетДавальцу.Организация В(&МассивОрганизаций)
		|		И ОтчетДавальцу.Проведен
		//-- Устарело_Переработка24
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ОтчетДавальцу2_5.Ссылка      КАК Регистратор,
		|		ОтчетДавальцу2_5.Организация КАК Организация
		|	ИЗ
		|		Документ.ОтчетДавальцу2_5 КАК ОтчетДавальцу2_5
		|	ГДЕ
		|		&УчитыватьСебестоимостьТоваровПоНазначениям
		|		И &ИспользоватьУчетСебестоимости
		|		И ОтчетДавальцу2_5.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ОтчетДавальцу2_5.Организация В(&МассивОрганизаций)
		|		И ОтчетДавальцу2_5.Проведен
		|
		//-- НЕ УТКА
		|	) КАК Товары
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	Организация
		|;
		// Выбираем документы, у которых в движениях по выручке и себестоимости продаж указано назначение.
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ВыручкаИСебестоимостьПродаж.Регистратор КАК Регистратор,
		|	Аналитики.Организация КАК Организация
		|
		|ПОМЕСТИТЬ ДвиженияСебестоимостиСНазначениями
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ВыручкаИСебестоимостьПродаж
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК Аналитики
		|		ПО ВыручкаИСебестоимостьПродаж.АналитикаУчетаПоПартнерам = Аналитики.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыСНазначениями КАК ДокументыСНазначениями
		|		ПО ДокументыСНазначениями.Регистратор = ВыручкаИСебестоимостьПродаж.Регистратор
		|		И ДокументыСНазначениями.Организация = Аналитики.Организация
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикаСНазначениями КАК АналитикаСНазначениями
		|		ПО АналитикаСНазначениями.Ссылка = ВыручкаИСебестоимостьПродаж.АналитикаУчетаНоменклатуры
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И ВыручкаИСебестоимостьПродаж.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Аналитики.Организация В(&МассивОрганизаций)
		|	И ВыручкаИСебестоимостьПродаж.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
		|	И ВыручкаИСебестоимостьПродаж.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности)
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор,
		|	Организация
		|;
		// Выбираем документы, у которых в движениях по оперативным регистрам указано назначение,
		// а в движении выручки и себестоимости продаж не указано назначение (нет движений с указанным назначением).
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	""ВыручкаИСебестоимостьПродаж""		КАК ИмяРегистра,
		|	ДокументыСНазначениями.Регистратор	КАК Ссылка,
		|	ДокументыСНазначениями.Организация	КАК Организация,
		|	1									КАК КодОшибки
		|ПОМЕСТИТЬ ВТРегистраторыСНекорректнымиДвижениями
		|ИЗ
		|	ДокументыСНазначениями КАК ДокументыСНазначениями
		|	ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияСебестоимостиСНазначениями КАК СебестоимостьТоваров
		|		ПО СебестоимостьТоваров.Регистратор = ДокументыСНазначениями.Регистратор
		|		И СебестоимостьТоваров.Организация = ДокументыСНазначениями.Организация
		|ГДЕ
		|	&УчитыватьСебестоимостьТоваровПоНазначениям
		|	И СебестоимостьТоваров.Регистратор ЕСТЬ NULL
		|;
		|УНИЧТОЖИТЬ АналитикаСНазначениями;
		|УНИЧТОЖИТЬ ДокументыПродаж;
		|УНИЧТОЖИТЬ ДокументыСНазначениями;
		|УНИЧТОЖИТЬ ДвиженияСебестоимостиСНазначениями
		|";
КонецФункции

#КонецОбласти

#КонецОбласти

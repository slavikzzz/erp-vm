///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2024, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Позволяет изменить работу интерфейса при встраивании.
//
// Параметры:
//  НастройкиРаботыИнтерфейса - Структура:
//   * ИспользоватьВнешнихПользователей - Булево - начальное значение Ложь,
//     если установить Истина, тогда даты запрета можно будет настраивать для внешних пользователей.
//
Процедура НастройкаИнтерфейса(НастройкиРаботыИнтерфейса) Экспорт
	
	ДатыЗапретаИзмененияУТ.НастройкаИнтерфейса(НастройкиРаботыИнтерфейса);
	ДатыЗапретаИзмененияЛокализация.НастройкаИнтерфейса(НастройкиРаботыИнтерфейса);
	
КонецПроцедуры

// Заполняет разделы дат запрета изменения, используемые при настройке дат запрета.
// Если не указать ни одного раздела, тогда будет доступна только настройка общей даты запрета.
//
// Параметры:
//  Разделы - ТаблицаЗначений:
//   * Имя - Строка - имя, используемое в описании источников данных в
//       процедуре ЗаполнитьИсточникиДанныхДляПроверкиЗапретаИзменения.
//
//   * Идентификатор - УникальныйИдентификатор - идентификатор ссылки элемента плана видов характеристик.
//       Чтобы получить идентификатор, нужно в режиме 1С:Предприятие выполнить метод платформы:
//       "ПланыВидовХарактеристик.РазделыДатЗапретаИзменения.ПолучитьСсылку().УникальныйИдентификатор()".
//       Не следует указывать идентификаторы, полученные любым другим способом,
//       так как это может нарушить их уникальность.
//
//   * Представление - Строка - представляет раздел в форме настройки дат запрета.
//
//   * ТипыОбъектов  - Массив - типы ссылок объектов, в разрезе которых можно настроить даты запрета,
//       например Тип("СправочникСсылка.Организации"); если не указано ни одного типа,
//       то даты запрета будут настраиваться только с точностью до раздела.
//
Процедура ПриЗаполненииРазделовДатЗапретаИзменения(Разделы) Экспорт
	
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "АвансовыеОтчеты";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("199db5e2-c45a-4004-9e87-742579e7a749");
	Раздел.Представление = НСтр("ru = 'Авансовые отчеты';
								|en = 'Expense reports'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "Банк";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("0f558de9-37af-484b-8f46-1ba523cf01d2");
	Раздел.Представление = НСтр("ru = 'Банк';
								|en = 'Bank'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.БанковскиеСчетаОрганизаций"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "БухгалтерскийУчет";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("2bdf6479-8eaf-4ec0-93a1-412e8659a178");
	Раздел.Представление = НСтр("ru = 'Бухгалтерский учет';
								|en = 'Accounting'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));
	
	//++ НЕ УТ
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "Бюджетирование";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("10b010bf-ff02-407a-b71d-fa3d2c8186cc");
	Раздел.Представление = НСтр("ru = 'Бюджетирование';
								|en = 'Budgeting'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Сценарии"));
	//-- НЕ УТ

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "ВводОстатков";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("c061d639-5929-11ea-87c6-1831bf523f36");
	Раздел.Представление = НСтр("ru = 'Ввод остатков';
								|en = 'Balance entry'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));
	
	//++ НЕ УТ
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "ВнеоборотныеАктивы";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("1dc4b831-3ca1-11e7-9d6b-e0cb4ed5f5dc");
	Раздел.Представление = НСтр("ru = 'Внеоборотные активы';
								|en = 'Fixed assets'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));
	//-- НЕ УТ

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "ВнутреннееТовародвижение";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("a7c88ae7-129c-45c5-bdcd-df587700fa2d");
	Раздел.Представление = НСтр("ru = 'Внутреннее товародвижение';
								|en = 'Internal inventory transfers'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "Закупки";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("fc4596d4-f365-4986-b633-fe77017b938f");
	Раздел.Представление = НСтр("ru = 'Закупки';
								|en = 'Purchases'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "Касса";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("97e0cfbc-3a80-40d5-bbce-ce9c3e87e7d8");
	Раздел.Представление = НСтр("ru = 'Касса';
								|en = 'Cash account'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Кассы"));

	//++ НЕ УТКА
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "МеждународныйУчет";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("759a6987-ef82-442c-a4eb-2735afaa10d2");
	Раздел.Представление = НСтр("ru = 'Международный учет';
								|en = 'Financial accounting'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));//

	//-- НЕ УТКА

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "Планирование";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("0c370df6-fb93-499d-bec3-81c4b7dcfcf2");
	Раздел.Представление = НСтр("ru = 'Планирование';
								|en = 'Planning'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.СценарииТоварногоПланирования"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "Продажи";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("f9d6852a-09c2-4505-901e-ac07fa0a73eb");
	Раздел.Представление = НСтр("ru = 'Продажи';
								|en = 'Sales'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "ПродажиМеждуОрганизациями";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("c061d63b-5929-11ea-87c6-1831bf523f36");
	Раздел.Представление = НСтр("ru = 'Продажи между организациями';
								|en = 'Intercompany sales'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "Производство";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("8795bd29-84ab-47b5-a59f-4fff6b242bab");
	Раздел.Представление = НСтр("ru = 'Производство';
								|en = 'Production'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "РегламентныеОперации";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("49fca300-0137-4f5e-bc8d-af6cc30545a3");
	Раздел.Представление = НСтр("ru = 'Регламентные операции';
								|en = 'Scheduled jobs'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));
	
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "РозничныеПродажи";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("c061d646-5929-11ea-87c6-1831bf523f36");
	Раздел.Представление = НСтр("ru = 'Розничные продажи';
								|en = 'Retail sales'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));
	
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "СверкиИКорректировкиЗадолженности";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("ece392ee-5209-4bfa-9f32-5b1244b1f74e");
	Раздел.Представление = НСтр("ru = 'Сверки и корректировки задолженности';
								|en = 'Debt reconciliations and adjustments'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));

	Раздел = Разделы.Добавить();
	Раздел.Имя  = "СкладскиеОперации";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("f37d661e-6540-4890-8642-f7481ff1ee7b");
	Раздел.Представление = НСтр("ru = 'Складские операции (на ордерных складах)';
								|en = 'Warehouse operations — Warehouse Management'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Склады"));
	
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "ФинансовыйКонтур";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("66a40e05-5ebd-11ea-87c6-1831bf523f36");
	Раздел.Представление = НСтр("ru = 'Финансовый контур';
								|en = 'Financial contour'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));
	
	//++ НЕ УТКА
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "УправлениеРемонтами";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("4fbd7445-50f5-4aa4-ac19-be884591f1b6");
	Раздел.Представление = НСтр("ru = 'Управление ремонтами';
								|en = 'R&&M management'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.Организации"));
	//-- НЕ УТКА

	ДатыЗапретаИзмененияЛокализация.ПриЗаполненииРазделовДатЗапретаИзменения(Разделы);

КонецПроцедуры

// Позволяет задать таблицы и поля объектов для проверки запрета изменения данных.
// Для добавления нового источника в ИсточникиДанных см. ДатыЗапретаИзменения.ДобавитьСтроку.
//
// Вызывается из процедуры ИзменениеЗапрещено общего модуля ДатыЗапретаИзменения,
// используемой в подписке на событие ПередЗаписью объекта для проверки наличия
// запретов и отказа от изменений запрещенного объекта.
//
// Параметры:
//  ИсточникиДанных - ТаблицаЗначений:
//   * Таблица     - Строка - полное имя объекта метаданных,
//                   например Метаданные.Документы.ПриходнаяНакладная.ПолноеИмя().
//   * ПолеДаты    - Строка - имя реквизита объекта или табличной части,
//                   например: "Дата", "Товары.ДатаОтгрузки".
//   * Раздел      - Строка - имя раздела дат запрета, указанного в
//                   процедуре ПриЗаполненииРазделовДатЗапретаИзменения (см. выше).
//   * ПолеОбъекта - Строка - имя реквизита объекта или реквизита табличной части,
//                   например: "Организация", "Товары.Склад".
//
Процедура ЗаполнитьИсточникиДанныхДляПроверкиЗапретаИзменения(ИсточникиДанных) Экспорт
	
	ДатыЗапретаИзмененияУТ.ЗаполнитьИсточникиДанныхДляПроверкиЗапретаИзменения(ИсточникиДанных);
	ДатыЗапретаИзмененияЛокализация.ЗаполнитьИсточникиДанныхДляПроверкиЗапретаИзменения(ИсточникиДанных);
	
КонецПроцедуры

// Позволяет переопределить выполнение проверки запрета изменения произвольным образом.
//
// Если проверка выполняется в процессе записи документа, то в свойстве ДополнительныеСвойства документа Объект
// имеется свойство РежимЗаписи.
//  
// Параметры:
//  Объект       - СправочникОбъект
//               - ДокументОбъект
//               - ПланВидовХарактеристикОбъект
//               - ПланСчетовОбъект
//               - ПланВидовРасчетаОбъект
//               - БизнесПроцессОбъект
//               - ЗадачаОбъект
//               - ПланОбменаОбъект
//               - РегистрСведенийНаборЗаписей
//               - РегистрНакопленияНаборЗаписей
//               - РегистрБухгалтерииНаборЗаписей
//               - РегистрРасчетаНаборЗаписей - проверяемый элемент данных или набор записей 
//                 (который передается из обработчиков ПередЗаписью и ПриЧтенииНаСервере).
//
//  ПроверкаЗапретаИзменения    - Булево - установить в Ложь, чтобы пропустить проверку запрета изменения данных.
//  УзелПроверкиЗапретаЗагрузки - ПланОбменаСсылка
//                              - Неопределено - установить в Неопределено, чтобы 
//                                пропустить проверку запрета загрузки данных.
//  ВерсияОбъекта               - Строка - установить "СтараяВерсия" или "НоваяВерсия", чтобы
//                                выполнить проверку только старой (в базе данных) 
//                                или только новой версии объекта (в параметре Объект).
//                                По умолчанию содержит значение "" - проверяются обе версии объекта сразу.
//
Процедура ПередПроверкойЗапретаИзменения(Объект,
                                         ПроверкаЗапретаИзменения,
                                         УзелПроверкиЗапретаЗагрузки,
                                         ВерсияОбъекта) Экспорт
	
	ДатыЗапретаИзмененияУТ.ПередПроверкойЗапретаИзменения(
		Объект,
		ПроверкаЗапретаИзменения,
		УзелПроверкиЗапретаЗагрузки,
		ВерсияОбъекта);
		
	ДатыЗапретаИзмененияЛокализация.ПередПроверкойЗапретаИзменения(
		Объект,
		ПроверкаЗапретаИзменения,
		УзелПроверкиЗапретаЗагрузки,
		ВерсияОбъекта);
	
КонецПроцедуры

// Позволяет переопределить получение данных для проверки даты запрета старой (существующей) версии данных.
//
// Параметры:
//  ОбъектМетаданных - ОбъектМетаданных - объект метаданных получаемых данных.
//  ИдентификаторДанных - СправочникСсылка
//                      - ДокументСсылка
//                      - ПланВидовХарактеристикСсылка
//                      - ПланСчетовСсылка
//                      - ПланВидовРасчетаСсылка
//                      - БизнесПроцессСсылка
//                      - ЗадачаСсылка
//                      - ПланОбменаСсылка
//                      - Отбор - ссылка на элемент данных или отбор набора записей, который нужно проверить.
//                                При этом значение для проверки будет получено из базы данных.
//
//  УзелПроверкиЗапретаЗагрузки - Неопределено
//                              - ПланОбменаСсылка - если Неопределено, то проверить запрет 
//                                изменения данных; иначе - загрузку данных из указанного узла плана обмена.
//
//  ДанныеДляПроверки - см. ДатыЗапретаИзменения.ШаблонДанныхДляПроверки.
//
//  Пример:
//  Если ТипЗнч(ИдентификаторДанных) = Тип("ДокументСсылка.Заказ") Тогда
//  	Данные = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(ИдентификаторДанных, "Организация, ДатаОкончанияРабот, ЗаказНаряд");
//  	Если Данные.ЗаказНаряд Тогда
//  		Проверка = ДанныеДляПроверки.Добавить();
//  		Проверка.Раздел = "ЗаказНаряды";
//  		Проверка.Объект =  Данные.Организация;
//  		Проверка.Дата   = Данные.ДатаОкончанияРабот;
//  	КонецЕсли;
//  КонецЕсли;
//
Процедура ПередПроверкойСтаройВерсииДанных(ОбъектМетаданных, ИдентификаторДанных, УзелПроверкиЗапретаЗагрузки, ДанныеДляПроверки) Экспорт
	
	ДатыЗапретаИзмененияУТ.ПередПроверкойСтаройВерсииДанных(ОбъектМетаданных, ИдентификаторДанных, УзелПроверкиЗапретаЗагрузки, ДанныеДляПроверки);
	
КонецПроцедуры

// Позволяет переопределить получение данных для проверки даты запрета новой (будущей) версии данных.
//
// Параметры:
//  ОбъектМетаданных - ОбъектМетаданных - объект метаданных получаемых данных.
//  Данные  - СправочникОбъект
//          - ДокументОбъект
//          - ПланВидовХарактеристикОбъект
//          - ПланСчетовОбъект
//          - ПланВидовРасчетаОбъект
//          - БизнесПроцессОбъект
//          - ЗадачаОбъект
//          - ПланОбменаОбъект
//          - РегистрСведенийНаборЗаписей
//          - РегистрНакопленияНаборЗаписей
//          - РегистрБухгалтерииНаборЗаписей
//          - РегистрРасчетаНаборЗаписей - проверяемый элемент данных или набор записей.
//
//  УзелПроверкиЗапретаЗагрузки - Неопределено
//                              - ПланОбменаСсылка - если Неопределено, то проверить запрет 
//                                изменения данных; иначе - загрузку данных из указанного узла плана обмена.
//
//  ДанныеДляПроверки - см. ДатыЗапретаИзменения.ШаблонДанныхДляПроверки.
//
//  Пример:
//  Если ТипЗнч(Данные) = Тип("ДокументОбъект.Заказ") И Данные.ЗаказНаряд Тогда
//  	
//  	Проверка = ДанныеДляПроверки.Добавить();
//  	Проверка.Раздел = "ЗаказНаряды";
//  	Проверка.Объект =  Данные.Организация;
//  	Проверка.Дата   = Данные.ДатаОкончанияРабот;
//  	
//  КонецЕсли;
//
Процедура ПередПроверкойНовойВерсииДанных(ОбъектМетаданных, Данные, УзелПроверкиЗапретаЗагрузки, ДанныеДляПроверки) Экспорт

	ДатыЗапретаИзмененияУТ.ПередПроверкойНовойВерсииДанных(ОбъектМетаданных, Данные, УзелПроверкиЗапретаЗагрузки, ДанныеДляПроверки);
	
КонецПроцедуры

#КонецОбласти

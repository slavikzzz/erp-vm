#Область ПрограммныйИнтерфейс

//++ НЕ УТ

#Область ФормированиеЗаписейРаздела7ДекларацииНДС

// В процедуре отбираются необлагаемые НДС операции и подтверждающие документы
//
// Параметры:
//	СтруктураПараметров - Структура - Организация, дата.
//	ДанныеДляЗаполнения - Структура - две таблицы: НеоблагаемыеНДСОперации, ПодтверждающиеДокументы.
//  АдресХранилища - Строка - адрес временного хранилища для помещения результата выполнения.
//
Процедура ЗапросПоДаннымЗаполнения7РазделаДекларацииПоНДС(СтруктураПараметров, ДанныеДляЗаполнения, АдресХранилища) Экспорт
	
	НеоблагаемыеНДСОперации = ДанныеДляЗаполнения.НеоблагаемыеНДСОперации;
	ПодтверждающиеДокументы = ДанныеДляЗаполнения.ПодтверждающиеДокументы;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("Организация", СтруктураПараметров.Организация);
	Запрос.УстановитьПараметр("ДатаГраница", Новый Граница(КонецДня(СтруктураПараметров.Дата), ВидГраницы.Включая));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоКвартала(СтруктураПараметров.Дата));
	Запрос.УстановитьПараметр("КонецПериода", КонецКвартала(СтруктураПараметров.Дата));
	Запрос.УстановитьПараметр("ПустойКод", Справочники.КодыОперацийРаздела7ДекларацииПоНДС.ПустаяСсылка());
	Запрос.УстановитьПараметр("ТоварыНеВРФ", Справочники.КодыОперацийРаздела7ДекларацииПоНДС.НайтиПоКоду("1010811"));
	Запрос.УстановитьПараметр("ТипЗапасовСобственные", УчетНДСУПСлужебный.ТипыЗапасовСобственные());
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	НДСЗаписиКнигиПродажОбороты.Регистратор КАК Регистратор,
	|	НДСЗаписиКнигиПродажОбороты.СуммаБезНДСОборот КАК Сумма,
	|	НДСЗаписиКнигиПродажОбороты.Покупатель КАК Покупатель
	|ПОМЕСТИТЬ ПродажиБезНДССводныеСправки
	|ИЗ
	|	РегистрНакопления.НДСЗаписиКнигиПродаж.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Регистратор,
	|			Организация = &Организация
	|				И СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
	|				И Событие = ЗНАЧЕНИЕ(Перечисление.СобытияПоНДСПродажи.Реализация)) КАК НДСЗаписиКнигиПродажОбороты
	|ГДЕ
	|	ТИПЗНАЧЕНИЯ(НДСЗаписиКнигиПродажОбороты.Регистратор) = ТИП(Документ.СводнаяСправкаНДС)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СводнаяСправкаНДС.Организация КАК Организация,
	|	СводнаяСправкаНДС.Дата КАК КонецПериода,
	|	ВЫБОР
	|		КОГДА СводнаяСправкаНДС.ПериодичностьОформления = ЗНАЧЕНИЕ(Перечисление.Периодичность.Месяц)
	|			ТОГДА НАЧАЛОПЕРИОДА(СводнаяСправкаНДС.Дата, МЕСЯЦ)
	|		ИНАЧЕ НАЧАЛОПЕРИОДА(СводнаяСправкаНДС.Дата, КВАРТАЛ)
	|	КОНЕЦ КАК НачалоПериода
	|ПОМЕСТИТЬ ПериодыРозничныхПродаж
	|ИЗ
	|	ПродажиБезНДССводныеСправки КАК СписокСчетовФактур
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СводнаяСправкаНДС КАК СводнаяСправкаНДС
	|		ПО СписокСчетовФактур.Регистратор = СводнаяСправкаНДС.Ссылка
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Организация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ОтчетОРозничныхПродажах.КассоваяСмена КАК КассоваяСмена
	|ПОМЕСТИТЬ КассовыеСменыСОтчетами
	|ИЗ
	|	Документ.ОтчетОРозничныхПродажах КАК ОтчетОРозничныхПродажах
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетОРозничныхПродажах.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетОРозничныхПродажах.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетОРозничныхПродажах.Проведен
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ОтчетОРозничныхВозвратах.КассоваяСмена
	|ИЗ
	|	Документ.ОтчетОРозничныхВозвратах КАК ОтчетОРозничныхВозвратах
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетОРозничныхВозвратах.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетОРозничныхВозвратах.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетОРозничныхВозвратах.Проведен
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	КассоваяСмена
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ОтчетОРозничныхПродажахТовары.Ссылка КАК Регистратор,
	|	ОтчетОРозничныхПродажахТовары.Сумма КАК Сумма,
	|	ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель) КАК Покупатель
	|ПОМЕСТИТЬ РозничныеПродажи
	|ИЗ
	|	Документ.ОтчетОРозничныхПродажах.Товары КАК ОтчетОРозничныхПродажахТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КассовыеСменыСОтчетами КАК КассовыеСменыСОтчетами
	|		ПО (КассовыеСменыСОтчетами.КассоваяСмена = ОтчетОРозничныхПродажахТовары.Ссылка.КассоваяСмена)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетОРозничныхПродажахТовары.Ссылка.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетОРозничныхПродажахТовары.Ссылка.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетОРозничныхПродажахТовары.Ссылка.Проведен
	|	И ОтчетОРозничныхПродажахТовары.Номенклатура.ТипНоменклатуры В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа), ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга))
	|	И ОтчетОРозничныхПродажахТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОтчетОРозничныхПродажахТовары.Ссылка,
	|	ОтчетОРозничныхПродажахТовары.СуммаСНДС,
	|	ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|ИЗ
	|	Документ.ОтчетОРозничныхПродажах.ВидыЗапасов КАК ОтчетОРозничныхПродажахТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КассовыеСменыСОтчетами КАК КассовыеСменыСОтчетами
	|		ПО (КассовыеСменыСОтчетами.КассоваяСмена = ОтчетОРозничныхПродажахТовары.Ссылка.КассоваяСмена)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетОРозничныхПродажахТовары.Ссылка.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетОРозничныхПродажахТовары.Ссылка.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетОРозничныхПродажахТовары.Ссылка.Проведен
	|	И ОтчетОРозничныхПродажахТовары.ВидЗапасов.ТипЗапасов В(&ТипЗапасовСобственные)
	|	И ОтчетОРозничныхПродажахТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОтчетКомиссионераТовары.Ссылка,
	|	ОтчетКомиссионераТовары.СуммаСНДС,
	|	ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|ИЗ
	|	Документ.ОтчетКомиссионера.ВидыЗапасов КАК ОтчетКомиссионераТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетКомиссионераТовары.Ссылка.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетКомиссионераТовары.Ссылка.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетКомиссионераТовары.Ссылка.Проведен
	|	И ОтчетКомиссионераТовары.ВидЗапасов.ТипЗапасов В(&ТипЗапасовСобственные)
	|	И (НЕ ОтчетКомиссионераТовары.Покупатель.ЮрФизЛицо В (ЗНАЧЕНИЕ(Перечисление.ЮрФизЛицо.ЮрЛицо), ЗНАЧЕНИЕ(Перечисление.ЮрФизЛицо.ИндивидуальныйПредприниматель))
	|			ИЛИ ОтчетКомиссионераТовары.Покупатель = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка))
	|	И ОтчетКомиссионераТовары.НомерСчетаФактурыКомиссионера = """"
	|	И ОтчетКомиссионераТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОтчетКомиссионераТовары.Ссылка,
	|	ОтчетКомиссионераТовары.СуммаСНДС,
	|	ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|ИЗ
	|	Документ.ОтчетКомиссионера.Товары КАК ОтчетКомиссионераТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетКомиссионераТовары.Ссылка.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетКомиссионераТовары.Ссылка.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетКомиссионераТовары.Ссылка.Проведен
	|	И ОтчетКомиссионераТовары.Номенклатура.ТипНоменклатуры В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа), ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга))
	|	И (НЕ ОтчетКомиссионераТовары.Покупатель.ЮрФизЛицо В (ЗНАЧЕНИЕ(Перечисление.ЮрФизЛицо.ЮрЛицо), ЗНАЧЕНИЕ(Перечисление.ЮрФизЛицо.ИндивидуальныйПредприниматель))
	|			ИЛИ ОтчетКомиссионераТовары.Покупатель = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка))
	|	И ОтчетКомиссионераТовары.НомерСчетаФактурыКомиссионера = """"
	|	И ОтчетКомиссионераТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОтчетОРозничныхВозвратахТовары.Ссылка,
	|	ОтчетОРозничныхВозвратахТовары.Сумма,
	|	ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|ИЗ
	|	Документ.ОтчетОРозничныхВозвратах.Товары КАК ОтчетОРозничныхВозвратахТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КассовыеСменыСОтчетами КАК КассовыеСменыСОтчетами
	|		ПО (КассовыеСменыСОтчетами.КассоваяСмена = ОтчетОРозничныхВозвратахТовары.Ссылка.КассоваяСмена)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетОРозничныхВозвратахТовары.Ссылка.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетОРозничныхВозвратахТовары.Ссылка.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|			И (ОтчетОРозничныхВозвратахТовары.ДокументРеализации.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетОРозничныхВозвратахТовары.Ссылка.Проведен
	|	И ОтчетОРозничныхВозвратахТовары.Номенклатура.ТипНоменклатуры В (ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа), ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга))
	|	И ОтчетОРозничныхВозвратахТовары.ПоЧекуКоррекции
	|	И ОтчетОРозничныхВозвратахТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОтчетОРозничныхВозвратахТовары.Ссылка,
	|	ОтчетОРозничныхВозвратахТовары.СуммаСНДС,
	|	ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|ИЗ
	|	Документ.ОтчетОРозничныхВозвратах.ВидыЗапасов КАК ОтчетОРозничныхВозвратахТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КассовыеСменыСОтчетами КАК КассовыеСменыСОтчетами
	|		ПО (КассовыеСменыСОтчетами.КассоваяСмена = ОтчетОРозничныхВозвратахТовары.Ссылка.КассоваяСмена)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыРозничныхПродаж КАК ПериодыРозничныхПродаж
	|		ПО ОтчетОРозничныхВозвратахТовары.Ссылка.Организация = ПериодыРозничныхПродаж.Организация
	|			И (ОтчетОРозничныхВозвратахТовары.Ссылка.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|			И (ОтчетОРозничныхВозвратахТовары.ДокументРеализации.Дата МЕЖДУ ПериодыРозничныхПродаж.НачалоПериода И ПериодыРозничныхПродаж.КонецПериода)
	|ГДЕ
	|	ОтчетОРозничныхВозвратахТовары.Ссылка.Проведен
	|	И ОтчетОРозничныхВозвратахТовары.ВидЗапасов.ТипЗапасов В(&ТипЗапасовСобственные)
	|	И ОтчетОРозничныхВозвратахТовары.ПоЧекуКоррекции
	|	И ОтчетОРозничныхВозвратахТовары.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ПериодыРозничныхПродаж
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ КассовыеСменыСОтчетами
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НДСЗаписиКнигиПродажОбороты.Регистратор КАК Регистратор,
	|	НДСЗаписиКнигиПродажОбороты.СуммаБезНДСОборот КАК Сумма,
	|	НДСЗаписиКнигиПродажОбороты.Покупатель КАК Покупатель,
	|	ВЫБОР
	|		КОГДА НДСЗаписиКнигиПродажОбороты.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ТоварыФизлицамВЕАЭСЭлектронныеПлощадки)
	|			ТОГДА &ТоварыНеВРФ
	|		ИНАЧЕ
	|			НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК КодОперации
	|ПОМЕСТИТЬ ПродажиБезНДС
	|ИЗ
	|	РегистрНакопления.НДСЗаписиКнигиПродаж.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Регистратор,
	|			Организация = &Организация
	|				И СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
	|				И Событие = ЗНАЧЕНИЕ(Перечисление.СобытияПоНДСПродажи.Реализация)) КАК НДСЗаписиКнигиПродажОбороты
	|ГДЕ
	|	ТИПЗНАЧЕНИЯ(НДСЗаписиКнигиПродажОбороты.Регистратор) <> ТИП(Документ.СводнаяСправкаНДС)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	РозничныеПродажи.Регистратор,
	|	СУММА(РозничныеПродажи.Сумма) КАК Сумма,
	|	РозничныеПродажи.Покупатель,
	|	НЕОПРЕДЕЛЕНО
	|ИЗ
	|	РозничныеПродажи КАК РозничныеПродажи
	|СГРУППИРОВАТЬ ПО
	|	РозничныеПродажи.Регистратор,
	|	РозничныеПродажи.Покупатель
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеОснованийСчетовФактур.Регистратор,
	|	ДанныеОснованийСчетовФактур.БазаНДСРегл,
	|	ДанныеОснованийСчетовФактур.Контрагент,
	|	НЕОПРЕДЕЛЕНО
	|ИЗ
	|	РегистрСведений.ДанныеОснованийСчетовФактур КАК ДанныеОснованийСчетовФактур
	|
	|ГДЕ
	|	ДанныеОснованийСчетовФактур.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДанныеОснованийСчетовФактур.Организация = &Организация
	|	И ДанныеОснованийСчетовФактур.КорректировкаПоСогласованиюСторон
	|	И ДанныеОснованийСчетовФактур.СуммаБезНДС < 0
	|	И ДанныеОснованийСчетовФактур.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
	|	И ДанныеОснованийСчетовФактур.ТипЗапасов В (&ТипЗапасовСобственные)
	|	И НЕ ДанныеОснованийСчетовФактур.НалогообложениеНДС В (ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.РеализацияРаботУслугНаЭкспорт))
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НачисленияПоЗаймамВыданным.Регистратор КАК Регистратор,
	|	НачисленияПоЗаймамВыданным.СуммаРеглОборот КАК Сумма,
	|	ВЫБОР
	|		КОГДА НачисленияПоЗаймамВыданным.Договор.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА НачисленияПоЗаймамВыданным.Договор.КодРаздел7ДекларацииНДС
	|		ИНАЧЕ &ПустойКод
	|	КОНЕЦ КАК КодОперации,
	|	НачисленияПоЗаймамВыданным.Контрагент КАК Контрагент,
	|	НачисленияПоЗаймамВыданным.Договор КАК Договор
	|ПОМЕСТИТЬ НачисленияПоЗаймам
	|ИЗ
	|	РегистрНакопления.ДвиженияКонтрагентДоходыРасходы.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Регистратор,
	|			Организация = &Организация
	|				И ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачисленияПоЗаймамВыданным)) КАК НачисленияПоЗаймамВыданным
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НачисленияПоЗаймамВыданным.Регистратор,
	|	НачисленияПоЗаймамВыданным.СуммаРеглОборот,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(НачисленияПоЗаймамВыданным.АналитикаДоходов КАК Справочник.ДоговорыКредитовИДепозитов).КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА ВЫРАЗИТЬ(НачисленияПоЗаймамВыданным.АналитикаДоходов КАК Справочник.ДоговорыКредитовИДепозитов).КодРаздел7ДекларацииНДС
	|		ИНАЧЕ &ПустойКод
	|	КОНЕЦ,
	|	НачисленияПоЗаймамВыданным.Контрагент,
	|	ВЫРАЗИТЬ(НачисленияПоЗаймамВыданным.АналитикаДоходов КАК Справочник.ДоговорыКредитовИДепозитов)
	|ИЗ
	|	РегистрНакопления.ДвиженияДоходыРасходыПрочиеАктивыПассивы.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Регистратор,
	|			Организация = &Организация
	|				И ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачисленияПоЗаймамВыданным)) КАК НачисленияПоЗаймамВыданным
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВыручкаИСебестоимостьПродажОбороты.Регистратор КАК Регистратор,
	|	СУММА(ВыручкаИСебестоимостьПродажОбороты.СуммаВыручкиРеглОборот) КАК Сумма,
	|	ВЫБОР
	|		КОГДА ПродажиБезНДС.КодОперации <> &ПустойКод И ПродажиБезНДС.КодОперации <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ПродажиБезНДС.КодОперации
	|		КОГДА ВыручкаИСебестоимостьПродажОбороты.Договор.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА ВыручкаИСебестоимостьПродажОбороты.Договор.КодРаздел7ДекларацииНДС
	|		КОГДА ВыручкаИСебестоимостьПродажОбороты.АналитикаУчетаНоменклатуры.Номенклатура.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА ВыручкаИСебестоимостьПродажОбороты.АналитикаУчетаНоменклатуры.Номенклатура.КодРаздел7ДекларацииНДС
	|		ИНАЧЕ &ПустойКод
	|	КОНЕЦ КАК КодОперации,
	|	ВыручкаИСебестоимостьПродажОбороты.Договор КАК Договор,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА ВыручкаИСебестоимостьПродажОбороты.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|					ИЛИ ВыручкаИСебестоимостьПродажОбороты.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|				ТОГДА 1
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ЕстьТовары
	|ПОМЕСТИТЬ ПродажиПоКодам
	|ИЗ
	|	РегистрНакопления.ВыручкаИСебестоимостьПродаж.Обороты(&НачалоПериода, &КонецПериода, Регистратор, АналитикаУчетаПоПартнерам.Организация = &Организация) КАК ВыручкаИСебестоимостьПродажОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПродажиБезНДС КАК ПродажиБезНДС
	|		ПО ВыручкаИСебестоимостьПродажОбороты.Регистратор = ПродажиБезНДС.Регистратор
	|
	|ГДЕ ВыручкаИСебестоимостьПродажОбороты.СуммаВыручкиОборот = ВыручкаИСебестоимостьПродажОбороты.СуммаВыручкиБезНДСОборот
	|
	|СГРУППИРОВАТЬ ПО
	|	ВыручкаИСебестоимостьПродажОбороты.Регистратор,
	|	ВЫБОР
	|		КОГДА ПродажиБезНДС.КодОперации <> &ПустойКод И ПродажиБезНДС.КодОперации <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ПродажиБезНДС.КодОперации
	|		КОГДА ВыручкаИСебестоимостьПродажОбороты.Договор.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА ВыручкаИСебестоимостьПродажОбороты.Договор.КодРаздел7ДекларацииНДС
	|		КОГДА ВыручкаИСебестоимостьПродажОбороты.АналитикаУчетаНоменклатуры.Номенклатура.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА ВыручкаИСебестоимостьПродажОбороты.АналитикаУчетаНоменклатуры.Номенклатура.КодРаздел7ДекларацииНДС
	|		ИНАЧЕ &ПустойКод
	|	КОНЕЦ,
	|	ВыручкаИСебестоимостьПродажОбороты.Договор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	РеализацияПрочихАктивов.Регистратор,
	|	РеализацияПрочихАктивов.СуммаРеглБезНДСОборот,
	|	ВЫБОР
	|		КОГДА РеализацияПрочихАктивов.Договор.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА РеализацияПрочихАктивов.Договор.КодРаздел7ДекларацииНДС
	|		ИНАЧЕ &ПустойКод
	|	КОНЕЦ,
	|	РеализацияПрочихАктивов.Договор,
	|	0
	|ИЗ
	|	РегистрНакопления.ДвиженияКонтрагентДоходыРасходы.Обороты(&НачалоПериода, &КонецПериода, Регистратор, Организация = &Организация) КАК РеализацияПрочихАктивов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПродажиБезНДС КАК ПродажиБезНДС
	|		ПО РеализацияПрочихАктивов.Регистратор = ПродажиБезНДС.Регистратор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗакупкиОбороты.Регистратор,
	|	ЗакупкиОбороты.СуммаРеглБезНДСОборот,
	|	ВЫБОР
	|		КОГДА ЗакупкиОбороты.Договор.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА ЗакупкиОбороты.Договор.КодРаздел7ДекларацииНДС
	|		КОГДА ЗакупкиОбороты.АналитикаУчетаНоменклатуры.Номенклатура.КодРаздел7ДекларацииНДС <> &ПустойКод
	|			ТОГДА ЗакупкиОбороты.АналитикаУчетаНоменклатуры.Номенклатура.КодРаздел7ДекларацииНДС
	|		ИНАЧЕ &ПустойКод
	|	КОНЕЦ,
	|	ЗакупкиОбороты.Договор,
	|	1
	|ИЗ
	|	РегистрНакопления.Закупки.Обороты(&НачалоПериода, &КонецПериода, Регистратор, Организация = &Организация) КАК ЗакупкиОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПродажиБезНДС КАК ПродажиБезНДС
	|		ПО ЗакупкиОбороты.Регистратор = ПродажиБезНДС.Регистратор
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|";
	
	Запрос.Выполнить();
	
	УстановитьПривилегированныйРежим(Ложь);
	
	// Получим данные партий НДС (ФИФО скользящая)
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор
	|ПОМЕСТИТЬ ВТРегистраторы
	|ИЗ
	|	ПродажиПоКодам КАК Т
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Регистратор,
	|	Т.Партия,
	|	Т.АналитикаУчетаПартий
	|ПОМЕСТИТЬ ВРегистраторыИПартии
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРегистраторы КАК Отбор
	|	ПО Т.Регистратор = Отбор.Регистратор
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Т.Активность";
	
	Запрос.Выполнить();
	
	СтруктураПолей  = Новый Структура;
	СтруктураПолей.Вставить("Регистратор", "Регистратор");
	СтруктураПолей.Вставить("Партия", "Партия");
	СтруктураПолей.Вставить("АналитикаУчетаПартий", "АналитикаУчетаПартий");
	
	СтруктураОтбора = Новый Структура;
	СтруктураОтбора.Вставить("ВРегистраторыИПартии", СтруктураПолей);
	
	РасчетСебестоимостиНДС.СформироватьДетализациюПартийНДС(
		Запрос.МенеджерВременныхТаблиц,
		СтруктураПараметров.Организация,
		НачалоКвартала(СтруктураПараметров.Дата),
		КонецКвартала(СтруктураПараметров.Дата),
		,
		СтруктураОтбора);
		
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ПродажиПоКодам.Регистратор КАК Регистратор,
	|	СУММА(ПродажиПоКодам.Сумма) КАК Сумма
	|ПОМЕСТИТЬ ИтогиПоДокументам
	|ИЗ
	|	ПродажиПоКодам КАК ПродажиПоКодам
	|
	|СГРУППИРОВАТЬ ПО
	|	ПродажиПоКодам.Регистратор
	|
	|ИМЕЮЩИЕ
	|	СУММА(ПродажиПоКодам.Сумма) <> 0
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(ВложенныйЗапрос.СуммаПриобретения) КАК СуммаПриобретения,
	|	СУММА(ВложенныйЗапрос.НДС) КАК НДС,
	|	ВложенныйЗапрос.Регистратор КАК Регистратор
	|ПОМЕСТИТЬ ПрямыеРасходы
	|ИЗ
	|	(ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ПартииТоваровОрганизаций.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ПартииТоваровОрганизаций.СтоимостьРегл
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК СуммаПриобретения,
	|		СУММА(ВЫБОР
	|				КОГДА ПартииТоваровОрганизаций.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ПартииТоваровОрганизаций.НДСРегл
	|			КОНЕЦ) КАК НДС,
	|		ПартииТоваровОрганизаций.Регистратор КАК Регистратор
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровОрганизаций КАК ПартииТоваровОрганизаций
	|	ГДЕ
	|		ПартииТоваровОрганизаций.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ПартииТоваровОрганизаций.Активность
	|		И ПартииТоваровОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПартииТоваровОрганизаций.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ПартииЗатратНаВыпуск.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ПартииЗатратНаВыпуск.СтоимостьРегл
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ПартииЗатратНаВыпуск.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ПартииЗатратНаВыпуск.НДСРегл
	|			КОНЕЦ),
	|		ПартииЗатратНаВыпуск.Регистратор
	|	ИЗ
	|		РегистрНакопления.ПартииЗатратНаВыпуск КАК ПартииЗатратНаВыпуск
	|	ГДЕ
	|		ПартииЗатратНаВыпуск.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ПартииЗатратНаВыпуск.Активность
	|		И ПартииЗатратНаВыпуск.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПартииЗатратНаВыпуск.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ПартииРасходовНаСебестоимостьТоваров.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ПартииРасходовНаСебестоимостьТоваров.СтоимостьРегл
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ПартииРасходовНаСебестоимостьТоваров.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ПартииРасходовНаСебестоимостьТоваров.НДСРегл
	|			КОНЕЦ),
	|		ПартииРасходовНаСебестоимостьТоваров.Регистратор
	|	ИЗ
	|		РегистрНакопления.ПартииРасходовНаСебестоимостьТоваров КАК ПартииРасходовНаСебестоимостьТоваров
	|	ГДЕ
	|		ПартииРасходовНаСебестоимостьТоваров.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ПартииРасходовНаСебестоимостьТоваров.Активность
	|		И ПартииРасходовНаСебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПартииРасходовНаСебестоимостьТоваров.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ПартииПрочихРасходов.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ПартииПрочихРасходов.СтоимостьРегл
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ПартииПрочихРасходов.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ПартииПрочихРасходов.НДСРегл
	|			КОНЕЦ),
	|		ПартииПрочихРасходов.Регистратор
	|	ИЗ
	|		РегистрНакопления.ПартииПрочихРасходов КАК ПартииПрочихРасходов
	|	ГДЕ
	|		ПартииПрочихРасходов.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ПартииПрочихРасходов.Активность
	|		И ПартииПрочихРасходов.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПартииПрочихРасходов.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ПартииПроизводственныхЗатрат.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ПартииПроизводственныхЗатрат.СтоимостьРегл
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ПартииПроизводственныхЗатрат.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ПартииПроизводственныхЗатрат.НДСРегл
	|			КОНЕЦ),
	|		ПартииПроизводственныхЗатрат.Регистратор
	|	ИЗ
	|		РегистрНакопления.ПартииПроизводственныхЗатрат КАК ПартииПроизводственныхЗатрат
	|	ГДЕ
	|		ПартииПроизводственныхЗатрат.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ПартииПроизводственныхЗатрат.Активность
	|		И ПартииПроизводственныхЗатрат.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПартииПроизводственныхЗатрат.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ПартииТоваровПереданныеНаКомиссию.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ПартииТоваровПереданныеНаКомиссию.СтоимостьРегл
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ПартииТоваровПереданныеНаКомиссию.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ПартииТоваровПереданныеНаКомиссию.НДСРегл
	|			КОНЕЦ),
	|		ПартииТоваровПереданныеНаКомиссию.Регистратор
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровПереданныеНаКомиссию КАК ПартииТоваровПереданныеНаКомиссию
	|	ГДЕ
	|		ПартииТоваровПереданныеНаКомиссию.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ПартииТоваровПереданныеНаКомиссию.Активность
	|		И ПартииТоваровПереданныеНаКомиссию.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПартииТоваровПереданныеНаКомиссию.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ДетализацияПартийТоваровДляНДСиУСН.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ДетализацияПартийТоваровДляНДСиУСН.СтоимостьБезНДС
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ДетализацияПартийТоваровДляНДСиУСН.АналитикаУчетаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ДетализацияПартийТоваровДляНДСиУСН.НДС
	|			КОНЕЦ),
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор
	|	ИЗ
	|		РегистрНакопления.ДетализацияПартийТоваровДляНДСиУСН КАК ДетализацияПартийТоваровДляНДСиУСН
	|	ГДЕ
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ДетализацияПартийТоваровДляНДСиУСН.Активность
	|		И ДетализацияПартийТоваровДляНДСиУСН.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ДетализацияПартийТоваровДляНДСиУСН.АналитикаУчетаДокументаПоступления.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ДетализацияПартийТоваровДляНДСиУСН.СтоимостьБезНДС
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ДетализацияПартийТоваровДляНДСиУСН.АналитикаУчетаДокументаПоступления.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ДетализацияПартийТоваровДляНДСиУСН.НДС
	|			КОНЕЦ),
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор
	|	ИЗ
	|		РегистрНакопления.ДетализацияПартийТоваровДляНДСиУСН2_4 КАК ДетализацияПартийТоваровДляНДСиУСН
	|	ГДЕ
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ДетализацияПартийТоваровДляНДСиУСН.Активность
	|		И ДетализацияПартийТоваровДляНДСиУСН.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		СУММА(ВЫБОР
	|				КОГДА ДетализацияПартийТоваровДляНДСиУСН.АналитикаУчетаПартийДокументаПоступления.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА ДетализацияПартийТоваровДляНДСиУСН.СтоимостьБезНДС
	|				ИНАЧЕ 0
	|			КОНЕЦ),
	|		СУММА(ВЫБОР
	|				КОГДА ДетализацияПартийТоваровДляНДСиУСН.АналитикаУчетаПартийДокументаПоступления.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.БезНДС)
	|					ТОГДА 0
	|				ИНАЧЕ ДетализацияПартийТоваровДляНДСиУСН.НДС
	|			КОНЕЦ),
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор
	|	ИЗ
	|		ВТСтоимостьПартийНДС КАК ДетализацияПартийТоваровДляНДСиУСН
	|	ГДЕ
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Т.Регистратор КАК Регистратор
	|				ИЗ
	|					ПродажиПоКодам КАК Т)
	|		И ДетализацияПартийТоваровДляНДСиУСН.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДетализацияПартийТоваровДляНДСиУСН.Регистратор
	|) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Регистратор
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПродажиБезНДС.Покупатель КАК Контрагент,
	|	ПродажиБезНДС.Регистратор КАК ДокументРеализации,
	|	СУММА(ЕСТЬNULL(ПродажиБезНДС.Сумма * ПродажиПоКодам.Сумма / ИтогиПоДокументам.Сумма, ПродажиБезНДС.Сумма)) КАК СуммаРеализации,
	|	ЕСТЬNULL(ПродажиПоКодам.КодОперации, &ПустойКод) КАК КодОперации,
	|	СУММА(ЕСТЬNULL(ПрямыеРасходы.СуммаПриобретения, 0)) КАК СуммаПриобретения,
	|	СУММА(ЕСТЬNULL(ПрямыеРасходы.НДС, 0)) КАК НДС,
	|	ПродажиПоКодам.Договор КАК Договор,
	|	ПродажиПоКодам.ЕстьТовары КАК ЕстьТовары
	|ПОМЕСТИТЬ Реализация
	|ИЗ
	|	ПродажиБезНДС КАК ПродажиБезНДС
	|		ЛЕВОЕ СОЕДИНЕНИЕ ИтогиПоДокументам КАК ИтогиПоДокументам
	|		ПО ПродажиБезНДС.Регистратор = ИтогиПоДокументам.Регистратор
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПродажиПоКодам КАК ПродажиПоКодам
	|		ПО ПродажиБезНДС.Регистратор = ПродажиПоКодам.Регистратор
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПрямыеРасходы КАК ПрямыеРасходы
	|		ПО ПродажиБезНДС.Регистратор = ПрямыеРасходы.Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	ПродажиБезНДС.Покупатель,
	|	ПродажиБезНДС.Регистратор,
	|	ЕСТЬNULL(ПродажиПоКодам.КодОперации, &ПустойКод),
	|	ПродажиПоКодам.Договор,
	|	ПродажиПоКодам.ЕстьТовары
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НачисленияПоЗаймам.Контрагент,
	|	НачисленияПоЗаймам.Регистратор,
	|	СУММА(НачисленияПоЗаймам.Сумма),
	|	НачисленияПоЗаймам.КодОперации,
	|	0,
	|	0,
	|	НачисленияПоЗаймам.Договор,
	|	0
	|ИЗ
	|	НачисленияПоЗаймам КАК НачисленияПоЗаймам
	|
	|СГРУППИРОВАТЬ ПО
	|	НачисленияПоЗаймам.Контрагент,
	|	НачисленияПоЗаймам.Регистратор,
	|	НачисленияПоЗаймам.КодОперации,
	|	НачисленияПоЗаймам.Договор
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Контрагент,
	|	Договор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Реализация.ДокументРеализации КАК ДокументРеализации,
	|	Реализация.Контрагент КАК Контрагент,
	|	Реализация.Договор КАК Договор,
	|	ДанныеПервичныхДокументов.Номер КАК НомерДокумента,
	|	ДанныеПервичныхДокументов.Дата КАК ДатаДокумента,
	|	ВЫБОР
	|		КОГДА Реализация.ДокументРеализации ССЫЛКА Документ.ОтчетОРозничныхПродажах
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.СправкаРасчет)
	|		КОГДА Реализация.ДокументРеализации ССЫЛКА Документ.ОтчетКомитенту
	//++ НЕ УТКА
	
	//++ Устарело_Переработка24
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ОтчетДавальцу
	//-- Устарело_Переработка24
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ОтчетДавальцу2_5
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ОтчетДавальцуМеждуОрганизациями
	//-- НЕ УТКА
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.РеализацияУслугПрочихАктивов
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.АктВыполненныхРабот
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.Акт)
	|		КОГДА Реализация.ДокументРеализации ССЫЛКА Документ.ВозвратТоваровПоставщику
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ВыкупВозвратнойТарыКлиентом
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ВозвратТоваровМеждуОрганизациями
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.Накладная)
	|		КОГДА Реализация.ДокументРеализации ССЫЛКА Документ.НачисленияКредитовИДепозитов
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ЗаписьКнигиПродаж
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.ПустаяСсылка)
	|		КОГДА Реализация.ДокументРеализации ССЫЛКА Документ.ОтчетКомиссионера
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.КорректировкаРеализации
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.РеализацияТоваровУслуг
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ОтчетПоКомиссииМеждуОрганизациями
	|				ИЛИ Реализация.ДокументРеализации ССЫЛКА Документ.ПередачаТоваровМеждуОрганизациями
	|			ТОГДА ВЫБОР
	|					КОГДА Реализация.ЕстьТовары > 0
	|						ТОГДА ЗНАЧЕНИЕ(Справочник.ТипыДокументов.Накладная)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.Акт)
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТипыДокументов.ПустаяСсылка)
	|	КОНЕЦ КАК ТипДокумента,
	|	Реализация.ЕстьТовары КАК ЕстьТовары
	|ПОМЕСТИТЬ ПодтверждающиеДокументы
	|ИЗ
	|	Реализация КАК Реализация
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО Реализация.ДокументРеализации = ДанныеПервичныхДокументов.Документ
	|			И ДанныеПервичныхДокументов.Организация = &Организация
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Реализация.ДокументРеализации,
	|	Реализация.Контрагент,
	|	Реализация.Договор,
	|	Реализация.Договор.Номер,
	|	Реализация.Договор.Дата,
	|	ЗНАЧЕНИЕ(Справочник.ТипыДокументов.Договор),
	|	Реализация.ЕстьТовары
	|ИЗ
	|	Реализация КАК Реализация
	|ГДЕ
	|	НЕ Реализация.Договор.Номер ЕСТЬ NULL
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументРеализации,
	|	Контрагент,
	|	Договор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Реализация.Контрагент КАК Контрагент,
	|	Реализация.ДокументРеализации КАК ДокументРеализации,
	|	Реализация.СуммаРеализации КАК СуммаРеализации,
	|	Реализация.КодОперации КАК КодОперации,
	|	Реализация.СуммаПриобретения КАК СуммаПриобретения,
	|	Реализация.НДС КАК НДС,
	|	ПодтверждающиеДокументы.НомерДокумента КАК НомерДокумента,
	|	ПодтверждающиеДокументы.ДатаДокумента КАК ДатаДокумента,
	|	ПодтверждающиеДокументы.ТипДокумента КАК ТипДокумента,
	|	0 КАК ПорядокДокументов,
	|	Реализация.КодОперации.Код КАК КодОперацииКод,
	|	Реализация.КодОперации.Наименование КАК КодОперацииНаименование,
	|	ВЫБОР
	|		КОГДА Реализация.КодОперации.ВключаетсяВРеестрПодтверждающихДокументов
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК ВключаетсяВРеестрСортировка,
	|	ВЫБОР
	|		КОГДА Реализация.КодОперации.ОперацияНеПодлежитНалогообложению
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК СТ149Сортировка
	|ИЗ
	|	Реализация КАК Реализация
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО Реализация.ДокументРеализации = ДанныеПервичныхДокументов.Документ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПодтверждающиеДокументы КАК ПодтверждающиеДокументы
	|		ПО Реализация.Контрагент = ПодтверждающиеДокументы.Контрагент
	|			И Реализация.ДокументРеализации = ПодтверждающиеДокументы.ДокументРеализации
	|			И Реализация.Договор = ПодтверждающиеДокументы.Договор
	|			И Реализация.ЕстьТовары = ПодтверждающиеДокументы.ЕстьТовары
	|ГДЕ
	|	ДанныеПервичныхДокументов.Организация = &Организация
	|
	|УПОРЯДОЧИТЬ ПО
	|	СТ149Сортировка,
	|	ВключаетсяВРеестрСортировка,
	|	КодОперацииКод,
	|	КодОперацииНаименование,
	|	ДанныеПервичныхДокументов.ДатаРегистратора,
	|	ПорядокДокументов
	|ИТОГИ
	|	МАКСИМУМ(СуммаРеализации),
	|	МАКСИМУМ(СуммаПриобретения),
	|	МАКСИМУМ(НДС),
	|	МАКСИМУМ(НомерДокумента),
	|	МАКСИМУМ(ДатаДокумента),
	|	МАКСИМУМ(ТипДокумента)
	|ПО
	|	КодОперации,
	|	Контрагент,
	|	Реализация.Договор,
	|	ДокументРеализации";
	
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда 
		Возврат;
	КонецЕсли;
	
	ВыборкаПоКодам = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока ВыборкаПоКодам.Следующий() Цикл
		
		ВыборкаПоКонтрагентам = ВыборкаПоКодам.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаПоКонтрагентам.Следующий() Цикл
			
			ВыборкаПоДоговорам = ВыборкаПоКонтрагентам.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			Пока ВыборкаПоДоговорам.Следующий() Цикл
			
				ВыборкаПоДокументам = ВыборкаПоДоговорам.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
				Пока ВыборкаПоДокументам.Следующий() Цикл
					
					СтрокаНеоблагаемыеНДСОперации = НеоблагаемыеНДСОперации.Добавить();
					СтрокаНеоблагаемыеНДСОперации.КодОперации = ВыборкаПоДокументам.КодОперации;
					СтрокаНеоблагаемыеНДСОперации.ДокументРеализации = ВыборкаПоДокументам.ДокументРеализации;
					СтрокаНеоблагаемыеНДСОперации.Контрагент = ВыборкаПоДокументам.Контрагент;
					СтрокаНеоблагаемыеНДСОперации.СуммаРеализации = ВыборкаПоДокументам.СуммаРеализации;
					СтрокаНеоблагаемыеНДСОперации.СуммаПриобретения = ВыборкаПоДокументам.СуммаПриобретения;
					СтрокаНеоблагаемыеНДСОперации.НДСПрямой= ВыборкаПоДокументам.НДС;
					СтрокаНеоблагаемыеНДСОперации.КлючСтроки = Новый УникальныйИдентификатор;
					
					ИндексДокумента = 0;
					ПодтверждающиеДокументыПредставление = "";
					
					ВыборкаПоСтрокам = ВыборкаПоДокументам.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					КоличествоПодтверждающихДокументов = ВыборкаПоСтрокам.Количество();
					Пока ВыборкаПоСтрокам.Следующий() Цикл
						Если ЗначениеЗаполнено(ВыборкаПоСтрокам.ТипДокумента) Тогда 
							СтрокаПодтверждающиеДокументы = ПодтверждающиеДокументы.Добавить();
							СтрокаПодтверждающиеДокументы.ТипДокумента = ВыборкаПоСтрокам.ТипДокумента;
							СтрокаПодтверждающиеДокументы.НомерДокумента = ВыборкаПоСтрокам.НомерДокумента;
							СтрокаПодтверждающиеДокументы.ДатаДокумента= ВыборкаПоСтрокам.ДатаДокумента;
							СтрокаПодтверждающиеДокументы.КлючСтроки = СтрокаНеоблагаемыеНДСОперации.КлючСтроки;
							Если ИндексДокумента = 2 Тогда
								ПодтверждающиеДокументыПредставление = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
									НСтр("ru = '%1 и еще %2';
										|en = '%1 and %2 more'"),
									ПодтверждающиеДокументыПредставление, 
									КоличествоПодтверждающихДокументов - 2);
							ИначеЕсли ИндексДокумента < 2 Тогда
								ПодтверждающиеДокументыПредставление = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
									НСтр("ru = '%1%2%3 №%4 от %5';
										|en = '%1%2%3 No.%4 dated %5'"),
									ПодтверждающиеДокументыПредставление, 
									?(ЗначениеЗаполнено(ПодтверждающиеДокументыПредставление), ";", ""),
									Строка(ВыборкаПоСтрокам.ТипДокумента),
									ВыборкаПоСтрокам.НомерДокумента,
									Формат(ВыборкаПоСтрокам.ДатаДокумента,"ДЛФ=D"));
							КонецЕсли;
							ИндексДокумента = ИндексДокумента + 1;
						КонецЕсли;
					КонецЦикла;
					Если КоличествоПодтверждающихДокументов = 0 Тогда
						СтрокаНеоблагаемыеНДСОперации.ПодтверждающиеДокументыПредставление = "<...>";
					Иначе
						СтрокаНеоблагаемыеНДСОперации.ПодтверждающиеДокументыПредставление = ПодтверждающиеДокументыПредставление;
					КонецЕсли;
					
				КонецЦикла;
			
			КонецЦикла;
			
		КонецЦикла;
		
	КонецЦикла;
	
	// Отдельно распределим включенный в стоимость НДС по кодам операций
	МассивКоэффициентов = НеоблагаемыеНДСОперации.ВыгрузитьКолонку("СуммаРеализации");
	Для Индекс = 0 По МассивКоэффициентов.Количество() - 1 Цикл
		Если МассивКоэффициентов[Индекс] < 0 Тогда
			МассивКоэффициентов[Индекс] = 0;
		КонецЕсли;
	КонецЦикла;
	РаспределитьНДСПоКодамРаздела7(СтруктураПараметров, НеоблагаемыеНДСОперации, МассивКоэффициентов);
	
КонецПроцедуры

// В процедуре распределяется НДС по кодам операции
//
// Параметры:
//	СтруктураПараметров - Структура - Организация, дата.
//	НеоблагаемыеНДСОперации - ТаблицаЗначений - таблица необлагаемых операций
//	МассивКоэффициентов - ТаблицаЗначений - колонка СуммаРеализации таблицы НеоблагаемыеНДСОперации
//
Процедура РаспределитьНДСПоКодамРаздела7(СтруктураПараметров, НеоблагаемыеНДСОперации, МассивКоэффициентов) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Организация", СтруктураПараметров.Организация);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоКвартала(СтруктураПараметров.Дата));
	Запрос.УстановитьПараметр("КонецПериода", КонецКвартала(СтруктураПараметров.Дата));
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СУММА(ПартииНДС.НДСРегл) КАК НДС
	|ИЗ
	|	РегистрНакопления.ПартииНДСКРаспределению КАК ПартииНДС
	|ГДЕ
	|	ПартииНДС.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ПартииНДС.Организация = &Организация
	|	И ПартииНДС.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И ПартииНДС.Активность
	|	И ПартииНДС.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|	И ПартииНДС.Регистратор ССЫЛКА Документ.РаспределениеНДС";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.НДС) Тогда 
		НДСКРаспределению = Выборка.НДС;
		Если НеоблагаемыеНДСОперации.Количество() > 0 Тогда 
			МассивРаспределеннаяСуммаНДС = ОбщегоНазначения.РаспределитьСуммуПропорциональноКоэффициентам(НДСКРаспределению, МассивКоэффициентов);
			Для Инд = 0 По НеоблагаемыеНДСОперации.Количество() - 1 Цикл
				НеоблагаемыеНДСОперации[Инд].НДСРаспределенный = МассивРаспределеннаяСуммаНДС[Инд];
			КонецЦикла;
		КонецЕсли;
	Иначе
		Для Инд = 0 По НеоблагаемыеНДСОперации.Количество() - 1 Цикл
			НеоблагаемыеНДСОперации[Инд].НДСРаспределенный = 0;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

//-- НЕ УТ

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

#Область ЗаписиКнигиПокупок

// Возвращает текст запроса с реквизитами счетов-фактур полученных для книги покупок по Постановлению 735.
//
// Возвращаемое значение:
//	Строка - Текст запроса.
//
Функция ТекстЗапросаРеквизитыСчетовФактурПостановление735КнигаПокупок() Экспорт

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Строки.ДокументОснование КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	Строки.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ПОМЕСТИТЬ ВТ_СчетаФактурыДокументыПромежуточная
	|ИЗ
	|	Документ.СчетФактураПолученный КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	Документ.СчетФактураПолученный КАК Операция
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Операция.СчетФактураОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Строки.ДокументОснование КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	КорректировкаПриобретенияИсправление.Дата КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	Документ.СчетФактураПолученный КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|		И Строки.НомерСтроки = 1
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК КорректировкаПриобретенияИсправление
	|		ПО (Строки.ДокументОснование = КорректировкаПриобретенияИсправление.Ссылка)
	|			И (КорректировкаПриобретенияИсправление.ВидКорректировки = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеОшибок))
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК ДругиеИсправительныеСчетаФактуры
	|		ПО (Строки.ДокументОснование = ДругиеИсправительныеСчетаФактуры.ДокументОснование)
	|			И (Операция.НомерИсправления > ДругиеИсправительныеСчетаФактуры.Ссылка.НомерИсправления)
	|			И (ДругиеИсправительныеСчетаФактуры.НомерСтроки = 1)
	|			И (ДругиеИсправительныеСчетаФактуры.Ссылка.Проведен)
	|			И (ДругиеИсправительныеСчетаФактуры.Ссылка.Исправление)
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|	И ДругиеИсправительныеСчетаФактуры.Ссылка ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ
	|			Операция.ДокументОснование
	|	КОНЕЦ КАК ДокументОснование,
	|	Операция.Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер,
	|	Операция.ДатаСоставления,
	|	Операция.Ссылка,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаАванс),
	|	Операция.Исправление,
	|	Операция.ДокументОснование.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураПолученныйАванс КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.ДокументОснование,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.НаАванс),
	|	ЛОЖЬ,
	|	Операция.ДокументОснование.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданныйАванс КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданныйАванс КАК БудущаяОперация
	|		ПО Операция.ДокументОснование = БудущаяОперация.ДокументОснование
	|			И Операция.Контрагент = БудущаяОперация.Контрагент
	|			И Операция.Дата < БудущаяОперация.Дата
	|			И БудущаяОперация.Проведен
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|	И Операция.Организация В (&Организация)
	|	И БудущаяОперация.Ссылка ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ
	|			Строки.ДокументОснование
	|	КОНЕЦ,
	|	Операция.Контрагент,
	|	Операция.Организация,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	Операция.Исправление,
	|	Строки.ДокументОснование.Дата,
	|	2 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Справочник.Организации КАК ДанныеОрганизации
	|	ПО
	|		Операция.Контрагент = ДанныеОрганизации.Ссылка
	|		И ДанныеОрганизации.Ссылка В (&Организация)
	|ГДЕ
	|	Операция.Проведен
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ
	|			Строки.ДокументОснование
	|	КОНЕЦ,
	|	Корректировка.Организация,
	|	ВЫБОР
	|		КОГДА Операция.Корректировочный
	|			ТОГДА Корректировка.Контрагент
	|		ИНАЧЕ 
	|			Корректировка.Организация
	|	КОНЕЦ,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ВЫБОР
	|		КОГДА Операция.Корректировочный
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
	|		ИНАЧЕ 
	|			ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.НаРеализацию)
	|	КОНЕЦ,
	|	Операция.Исправление,
	|	Корректировка.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаРеализации КАК Корректировка
	|	ПО
	|		Корректировка.Ссылка = Строки.ДокументОснование
	|ГДЕ
	|	Операция.Проведен
	|	И Корректировка.Организация В (&Организация)
	|	И Корректировка.ВидКорректировки В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеОшибок),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.НомерДекларации,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	Документ.ТаможеннаяДекларацияИмпорт КАК Операция
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	ДанныеОплатыВБюджет.НомерОтметкиОРегистрации,
	|	ДанныеОплатыВБюджет.ДатаПодтвержденияОплаты,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	Документ.ЗаявлениеОВвозеТоваров КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ПодтверждениеОплатыНДСВБюджет КАК ДанныеОплатыВБюджет
	|		ПО Операция.Ссылка = ДанныеОплатыВБюджет.СчетФактура
	|			И ДанныеОплатыВБюджет.Состояние = Значение(Перечисление.СостоянияОплатыНДСВБюджет.ПолученоПодтверждение)
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.ДокументОснование,
	|	Операция.Организация,
	|	Операция.Поставщик,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	ВЫБОР
	|		КОГДА Операция.Договор = ЗНАЧЕНИЕ(Справочник.ДоговорыКонтрагентов.ПустаяСсылка) ТОГДА
	|			НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ 
	|			Операция.Договор 
	|	КОНЕЦ КАК ДоговорАванса,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.НалоговыйАгент),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураНалоговыйАгент КАК Операция
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВЫБОР 
	|		КОГДА Операция.ДокументРасчетов = НЕОПРЕДЕЛЕНО
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ Операция.ДокументРасчетов
	|	КОНЕЦ,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	ВЫБОР 
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.НомерСчетаФактуры
	|		ИНАЧЕ Операция.Номер
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.ДатаСчетаФактуры
	|		ИНАЧЕ Операция.Дата
	|	КОНЕЦ,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	ВЫБОР 
	|		КОГДА Операция.ДокументРасчетов = НЕОПРЕДЕЛЕНО
	|			ТОГДА Операция.Дата
	|		ИНАЧЕ ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, Операция.Дата) 
	|	КОНЕЦ,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	Документ.ЗаписьКнигиПокупок КАК Операция
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		Операция.Организация = ДанныеПервичныхДокументов.Организация
	|		И Операция.ДокументРасчетов = ДанныеПервичныхДокументов.Документ
	|	
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.ПредъявленСчетФактура
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.НомерРасходногоКассовогоОрдера,
	|	Операция.ДатаРасходногоКассовогоОрдера,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, Операция.Дата),
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	Документ.ВозвратТоваровОтКлиента КАК Операция
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО Операция.ДокументРеализации = ДанныеПервичныхДокументов.Документ
	|			И Операция.Организация = ДанныеПервичныхДокументов.Организация
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтРозничногоПокупателя)
	|	И Операция.ВыданыДенежныеСредства
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.ПокупательНеПлательщикНДС
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВидыЗапасов.ДокументРеализации,
	|	ВидыЗапасов.Ссылка.Организация,
	|	ВидыЗапасов.Ссылка.Организация,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	Операция.Исправление,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, ВидыЗапасов.Ссылка.Дата),
	|	2 КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВозвратТоваровОтКлиента.ВидыЗапасов КАК ВидыЗапасов
	|	ПО
	|		ВидыЗапасов.ДокументРеализации = Строки.ДокументОснование
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО ВидыЗапасов.ДокументРеализации = ДанныеПервичныхДокументов.Документ
	|			И ВидыЗапасов.Ссылка.Организация = ДанныеПервичныхДокументов.Организация
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Исправление
	|	И НЕ Операция.Корректировочный
	|	И ВидыЗапасов.Ссылка.ПокупательНеПлательщикНДС
	|	И ВидыЗапасов.Ссылка.Проведен
	|	И ВидыЗапасов.Ссылка.Организация В (&Организация)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснование,
	|	Организация,
	|	Контрагент,
	|	ДоговорКонтрагента,
	|	СтавкаНДСАванса,
	|	ВозвратЧерезКомиссионера
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры КАК ДокументОснование,
	|	ЕСТЬNULL(СчетаФактурыДокументы.ДатаСчетаФактуры, ДанныеПервичныхДокументов.Дата) КАК ДатаСчетаФактуры,
	|	ЕСТЬNULL(СчетаФактурыДокументы.НомерСчетаФактуры, ДанныеПервичныхДокументов.Номер) КАК НомерСчетаФактуры,
	|	ЕСТЬNULL(СчетаФактурыДокументы.СчетФактураДокумент, ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры) КАК СчетФактураДокумент,
	|	ЕСТЬNULL(СчетаФактурыДокументы.ДоговорКонтрагента, НЕОПРЕДЕЛЕНО) КАК ДоговорКонтрагента,
	|	ЕСТЬNULL(СчетаФактурыДокументы.СтавкаНДСАванса, НЕОПРЕДЕЛЕНО) КАК СтавкаНДСАванса,
	|	ЕСТЬNULL(СчетаФактурыДокументы.ВидСчетаФактуры, ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление)) КАК ВидСчетаФактуры,
	|	ЕСТЬNULL(СчетаФактурыДокументы.Исправление, ЛОЖЬ) КАК Исправление,
	|	СчетаФактурыДокументы.НомерСтроки КАК НомерСтроки,
	|	СчетаФактурыДокументы.СводныйКорректировочный КАК СводныйКорректировочный,
	|	СчетаФактурыДокументы.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЗаписиКнигиПокупок.КонтрагентПоСчетуФактуре КАК Контрагент,
	|	ВЫБОР
	|		КОГДА СчетаФактурыДокументы.СчетФактураДокумент ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА &КонецПериода >= ДАТАВРЕМЯ(2015, 1, 1)
	|						ТОГДА ""26""
	|					ИНАЧЕ ""01""
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КодВидаОперации,
	|	ЗаписиКнигиПокупок.ВозвратЧерезКомиссионера КАК ВозвратЧерезКомиссионера,
	|	ЕСТЬNULL(СчетаФактурыДокументы.Организация, ЗаписиКнигиПокупок.Организация) КАК Организация,
	|	СчетаФактурыДокументы.ОбрабатыватьНомерДокумента,
	|	СчетаФактурыДокументы.ДатаДокументаОснования КАК ДатаДокументаОснования
	|ПОМЕСТИТЬ ТаблицаСчетаФактурыДокументыПредварительная
	|ИЗ
	|	ЗаписиКнигиПокупок КАК ЗаписиКнигиПокупок
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыДокументыПромежуточная КАК СчетаФактурыДокументы
	|		ПО ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры = СчетаФактурыДокументы.ДокументОснование
	|			И ЗаписиКнигиПокупок.КонтрагентПоСчетуФактуре = СчетаФактурыДокументы.Контрагент
	|			И ЗаписиКнигиПокупок.ДоговорКонтрагента = СчетаФактурыДокументы.ДоговорКонтрагента
	|			И ЗаписиКнигиПокупок.СтавкаНДСАванса = СчетаФактурыДокументы.СтавкаНДСАванса
	|			И ЗаписиКнигиПокупок.ВозвратЧерезКомиссионера = СчетаФактурыДокументы.ВозвратЧерезКомиссионера
	|			И ЗаписиКнигиПокупок.Организация = СчетаФактурыДокументы.Организация
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО ЗаписиКнигиПокупок.СчетФактура = ДанныеПервичныхДокументов.Документ
	|			И ЗаписиКнигиПокупок.Организация = ДанныеПервичныхДокументов.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснование,
	|	Контрагент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаСчетаФактурыДокументы.Контрагент КАК СчетФактураДокументКонтрагент,
	|	ТаблицаСчетаФактурыДокументы.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ТаблицаСчетаФактурыДокументы.ВидСчетаФактуры КАК ВидСчетаФактуры,
	|	ТаблицаСчетаФактурыДокументы.Исправление КАК Исправление,
	|	ТаблицаСчетаФактурыДокументы.ДокументОснование КАК ДокументОснование,
	|	МАКСИМУМ(ТаблицаСчетаФактурыДокументы.СчетФактураДокумент) КАК СчетФактураДокумент,
	|	ТаблицаСчетаФактурыДокументы.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ТаблицаСчетаФактурыДокументы.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ТаблицаСчетаФактурыДокументы.КодВидаОперации КАК КодВидаОперации,
	|	ТаблицаСчетаФактурыДокументы.ВозвратЧерезКомиссионера КАК ВозвратЧерезКомиссионера
	|ПОМЕСТИТЬ ВТ_ОбъединениеСФ
	|ИЗ
	|	ТаблицаСчетаФактурыДокументыПредварительная КАК ТаблицаСчетаФактурыДокументы
	|
	|СГРУППИРОВАТЬ ПО
	|	ТаблицаСчетаФактурыДокументы.ДокументОснование,
	|	ТаблицаСчетаФактурыДокументы.Контрагент,
	|	ТаблицаСчетаФактурыДокументы.ДоговорКонтрагента,
	|	ТаблицаСчетаФактурыДокументы.ВидСчетаФактуры,
	|	ТаблицаСчетаФактурыДокументы.Исправление,
	|	ТаблицаСчетаФактурыДокументы.СводныйКорректировочный,
	|	ТаблицаСчетаФактурыДокументы.СводныйКомиссионный,
	|	ТаблицаСчетаФактурыДокументы.КодВидаОперации,
	|	ТаблицаСчетаФактурыДокументы.ВозвратЧерезКомиссионера
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснование,
	|	СчетФактураДокументКонтрагент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаСчетаФактурыДокументыПредварительная.ДокументОснование КАК ДокументОснование,
	|	ТаблицаСчетаФактурыДокументыПредварительная.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ТаблицаСчетаФактурыДокументыПредварительная.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ВТ_ОбъединениеСФ.СчетФактураДокумент КАК СчетФактураДокумент,
	|	ВТ_ОбъединениеСФ.СчетФактураДокументКонтрагент КАК КонтрагентПоСчетуФактуре,
	|	ТаблицаСчетаФактурыДокументыПредварительная.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ТаблицаСчетаФактурыДокументыПредварительная.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ТаблицаСчетаФактурыДокументыПредварительная.НомерСтроки КАК НомерСтроки,
	|	ТаблицаСчетаФактурыДокументыПредварительная.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ТаблицаСчетаФактурыДокументыПредварительная.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ТаблицаСчетаФактурыДокументыПредварительная.КодВидаОперации КАК КодВидаОперации,
	|	ТаблицаСчетаФактурыДокументыПредварительная.Организация,
	|	ТаблицаСчетаФактурыДокументыПредварительная.ОбрабатыватьНомерДокумента,
	|	ТаблицаСчетаФактурыДокументыПредварительная.ДатаДокументаОснования КАК ДатаДокументаОснования
	|ПОМЕСТИТЬ ВТ_ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ТаблицаСчетаФактурыДокументыПредварительная КАК ТаблицаСчетаФактурыДокументыПредварительная
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОбъединениеСФ КАК ВТ_ОбъединениеСФ
	|		ПО ТаблицаСчетаФактурыДокументыПредварительная.ДокументОснование = ВТ_ОбъединениеСФ.ДокументОснование
	|			И ТаблицаСчетаФактурыДокументыПредварительная.Контрагент = ВТ_ОбъединениеСФ.СчетФактураДокументКонтрагент
	|			И ТаблицаСчетаФактурыДокументыПредварительная.ДоговорКонтрагента = ВТ_ОбъединениеСФ.ДоговорКонтрагента
	|			И ТаблицаСчетаФактурыДокументыПредварительная.ВидСчетаФактуры = ВТ_ОбъединениеСФ.ВидСчетаФактуры
	|			И ТаблицаСчетаФактурыДокументыПредварительная.Исправление = ВТ_ОбъединениеСФ.Исправление
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактураДокумент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактур.Регистратор КАК Регистратор,
	|	ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактураДокумент,
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактур.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировки,
	|	ЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировки,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактур.Продавец
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.Контрагент
	|		ИНАЧЕ NULL
	|	КОНЕЦ КАК ПродавецДляПечати,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактур.КПППродавца
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.КППКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КПППродавцаДляПечати,
	|	ВЫБОР
	|		КОГДА &ПравилаПостановления735
	|				И ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.Контрагент
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|	КОНЕЦ КАК ПосредникСсылка,
	|	ЖурналУчетаСчетовФактур.НомерСтроки КАК НомерСтроки,
	|	ЖурналУчетаСчетовФактур.Валюта КАК Валюта,
	|	ЖурналУчетаСчетовФактур.Валюта.Наименование КАК ВалютаНаименование,
	|	ЖурналУчетаСчетовФактур.Валюта.НаименованиеПолное КАК ВалютаНаименованиеПолное,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураВыданный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|	КОНЕЦ КАК ВсегоПокупокВВалюте,
	|	ЖурналУчетаСчетовФактур.Валюта.Код КАК ВалютаКод,
	|	ЖурналУчетаСчетовФактур.КодВидаОперации КАК КодВидаОперации,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактур.ИННПродавца
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.ИННКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ИННПродавцаДляПечати,
	|	ЖурналУчетаСчетовФактур.Продавец КАК Продавец,
	|	ВЫБОР
	|		КОГДА &ПравилаПостановления735
	|				И ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.ИННКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ПосредникИНН,
	|	ВЫБОР
	|		КОГДА &ПравилаПостановления735
	|				И ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.КППКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ПосредникКПП,
	|	ЖурналУчетаСчетовФактур.Организация
	|ПОМЕСТИТЬ ВТ_РегистрацияСчетовФактур
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур КАК ЖурналУчетаСчетовФактур
	|ГДЕ
	|	ЖурналУчетаСчетовФактур.СчетФактура В
	|			(ВЫБРАТЬ
	|				ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|			ИЗ
	|				ВТ_ТаблицаСчетаФактурыДокументы)
	|	И ЖурналУчетаСчетовФактур.Организация В(&Организация)
	|	И НЕ ЖурналУчетаСчетовФактур.Сторно
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ЖурналУчетаСчетовФактур.СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ГТДИмпорт.Ссылка КАК СчетФактура,
	|	СУММА(ГТДИмпорт.ТаможеннаяСтоимость + ГТДИмпорт.СуммаПошлины + ГТДИмпорт.СуммаНДС) КАК Стоимость
	|ПОМЕСТИТЬ ВТ_ПокупкиПриВвозеИмпорте
	|ИЗ
	|	Документ.ТаможеннаяДекларацияИмпорт.Разделы КАК ГТДИмпорт
	|ГДЕ
	|	ГТДИмпорт.Ссылка В
	|			(ВЫБРАТЬ
	|				ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|			ИЗ
	|				ВТ_ТаблицаСчетаФактурыДокументы)
	|
	|СГРУППИРОВАТЬ ПО
	|	ГТДИмпорт.Ссылка
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗаявлениеОВвозеТоваров.Ссылка,
	|	СУММА(ЗаявлениеОВвозеТоваров.НалоговаяБазаНДС + ЗаявлениеОВвозеТоваров.СуммаНДС)
	|ИЗ
	|	Документ.ЗаявлениеОВвозеТоваров.Товары КАК ЗаявлениеОВвозеТоваров
	|ГДЕ
	|	ЗаявлениеОВвозеТоваров.Ссылка В
	|			(ВЫБРАТЬ
	|				ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|			ИЗ
	|				ВТ_ТаблицаСчетаФактурыДокументы)
	|СГРУППИРОВАТЬ ПО
	|	ЗаявлениеОВвозеТоваров.Ссылка
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.НомерСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры) КАК НомерСчетаФактуры,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры) КАК ДатаСчетаФактуры,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.СчетФактураДокумент, ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент) КАК СчетФактураДокумент,
	|	ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры КАК НомерСчетаФактурыСортировка,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправления, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ КАК ДатаСчетаФактурыСортировка,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДокументОснование КАК ДокументОснованиеСчетаФактуры,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент КАК СчетФактураДокументРасшифровка,
	|	ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировки,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправления КАК НомерИсправления,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправления КАК ДатаИсправления,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправленияКорректировки КАК НомерИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки КАК ДатаИсправленияКорректировки,
	|	ВЫБОР
	|		КОГДА ВТ_РегистрацияСчетовФактур.Регистратор ЕСТЬ NULL 
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ОбрабатыватьНомерДокумента,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ПродавецДляПечати, ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре) КАК ПродавецДляПечати,
	|	ВТ_РегистрацияСчетовФактур.КПППродавцаДляПечати КАК КПППродавцаДляПечати,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ВТ_РегистрацияСчетовФактур.Валюта КАК Валюта,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименование КАК ВалютаНаименование,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименованиеПолное КАК ВалютаНаименованиеПолное,
	|	СУММА(ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ВсегоПокупокВВалюте, ВТ_ПокупкиПриВвозеИмпорте.Стоимость)) КАК ВсегоПокупокВВалюте,
	|	ВТ_РегистрацияСчетовФактур.ВалютаКод КАК ВалютаКод,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.КодВидаОперации, ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации) КАК КодВидаОперации,
	|	ВТ_РегистрацияСчетовФактур.ПосредникСсылка КАК ПосредникСсылка,
	|	ВТ_РегистрацияСчетовФактур.ИННПродавцаДляПечати КАК ИННПродавцаДляПечати,
	|	ВТ_РегистрацияСчетовФактур.ПосредникИНН КАК ПосредникИНН,
	|	ВТ_РегистрацияСчетовФактур.ПосредникКПП КАК ПосредникКПП,
	|	ВТ_ТаблицаСчетаФактурыДокументы.Организация КАК Организация,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДатаДокументаОснования
	|ПОМЕСТИТЬ ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ВТ_ТаблицаСчетаФактурыДокументы КАК ВТ_ТаблицаСчетаФактурыДокументы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_РегистрацияСчетовФактур КАК ВТ_РегистрацияСчетовФактур
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = ВТ_РегистрацияСчетовФактур.СчетФактураДокумент
	|			И ВТ_ТаблицаСчетаФактурыДокументы.Организация = ВТ_РегистрацияСчетовФактур.Организация
	|			И (НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|					И НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный
	|				ИЛИ ВТ_ТаблицаСчетаФактурыДокументы.НомерСтроки = ВТ_РегистрацияСчетовФактур.НомерСтроки)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПокупкиПриВвозеИмпорте КАК ВТ_ПокупкиПриВвозеИмпорте
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = ВТ_ПокупкиПриВвозеИмпорте.СчетФактура
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДокументОснование,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.НомерСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры),
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры),
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.СчетФактураДокумент, ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент),
	|	ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправления, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДоговорКонтрагента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СтавкаНДСАванса,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент,
	|	ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры,
	|	ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправления,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправления,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ПродавецДляПечати, ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре),
	|	ВТ_РегистрацияСчетовФактур.КПППродавцаДляПечати,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре,
	|	ВТ_РегистрацияСчетовФактур.Валюта,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименование,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименованиеПолное,
	|	ВТ_РегистрацияСчетовФактур.ВалютаКод,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.КодВидаОперации, ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации),
	|	ВТ_РегистрацияСчетовФактур.ПосредникСсылка,
	|	ВТ_РегистрацияСчетовФактур.ИННПродавцаДляПечати,
	|	ВТ_РегистрацияСчетовФактур.ПосредникИНН,
	|	ВТ_РегистрацияСчетовФактур.ПосредникКПП,
	|	ВТ_ТаблицаСчетаФактурыДокументы.Организация,
	|	ВЫБОР
	|		КОГДА ВТ_РегистрацияСчетовФактур.Регистратор ЕСТЬ NULL 
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДатаДокументаОснования
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснованиеСчетаФактуры,
	|	КонтрагентПоСчетуФактуре,
	|	Организация,
	|	ДоговорКонтрагента,
	|	СтавкаНДСАванса"
	+ ОбщегоНазначения.РазделительПакетаЗапросов();
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Возвращает текст запроса с реквизитами счетов-фактур полученных для книги покупок по Постановлению 981 (с 1 октября 2017).
//
// Возвращаемое значение:
//	Строка - Текст запроса.
//
Функция ТекстЗапросаРеквизитыСчетовФактурПостановление981КнигаПокупок() Экспорт
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры КАК ДокументОснованиеСчетаФактуры
	|ПОМЕСТИТЬ СписокДокументовОснований
	|ИЗ
	|	ЗаписиКнигиПокупок КАК ЗаписиКнигиПокупок
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснованиеСчетаФактуры
	|;
	|
	|ВЫБРАТЬ
	|	Строки.ДокументОснование КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	ЕСТЬNULL(ДанныеОплатыВБюджет.НомерОтметкиОРегистрации, Операция.Номер) КАК НомерСчетаФактуры,
	|	ЕСТЬNULL(ДанныеОплатыВБюджет.ДатаПодтвержденияОплаты , Операция.ДатаСоставления) КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ПОМЕСТИТЬ ВТ_СчетаФактурыДокументыПромежуточная
	|ИЗ
	|	Документ.СчетФактураПолученный КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Строки.ДокументОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПодтверждениеОплатыНДСВБюджет КАК ДанныеОплатыВБюджет
	|		ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = ДанныеОплатыВБюджет.СчетФактура
	|			И ДанныеОплатыВБюджет.Состояние = Значение(Перечисление.СостоянияОплатыНДСВБюджет.ПолученоПодтверждение)
	|			И ДанныеОплатыВБюджет.НомерОтметкиОРегистрации <> """"
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СписокДокументовОснований.ДокументОснованиеСчетаФактуры КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	КорректировкаПриобретенияИсправление.Дата КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК Строки
	|		ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Строки.ДокументОснование
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК Операция
	|		ПО Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК КорректировкаПриобретенияИсправление
	|		ПО (СписокДокументовОснований.ДокументОснованиеСчетаФактуры = КорректировкаПриобретенияИсправление.Ссылка)
	|			И (КорректировкаПриобретенияИсправление.ВидКорректировки = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеОшибок))
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК ДругиеИсправительныеСчетаФактуры
	|		ПО (СписокДокументовОснований.ДокументОснованиеСчетаФактуры = ДругиеИсправительныеСчетаФактуры.ДокументОснование)
	|			И (Операция.НомерИсправления > ДругиеИсправительныеСчетаФактуры.Ссылка.НомерИсправления)
	|			И (ДругиеИсправительныеСчетаФактуры.Ссылка.Проведен)
	|			И (ДругиеИсправительныеСчетаФактуры.Ссылка.Исправление)
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|	И ДругиеИсправительныеСчетаФактуры.Ссылка ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Операция.СчетФактураОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	Операция.ДатаСоставления КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	Документ.СчетФактураПолученныйНалоговыйАгент КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Операция.Ссылка = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК ДокументОснование,
	|	Операция.Организация КАК Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорКонтрагента,
	|	1 КАК Приоритет,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление) КАК ВидСчетаФактуры,
	|	Операция.Исправление КАК Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора КАК ДатаДокументаОснования,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйНалоговыйАгент КАК Операция
	|		ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Операция.СчетФактураОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.ДокументОснование КАК ДокументОснование,
	|	Операция.Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер,
	|	Операция.ДатаСоставления,
	|	Операция.Ссылка,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаАванс),
	|	Операция.Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйАванс КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.ДокументОснование
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Операция.ДокументОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК ДокументОснование,
	|	Операция.Организация,
	|	Операция.Контрагент КАК Контрагент,
	|	Операция.Номер,
	|	Операция.ДатаСоставления,
	|	Операция.Ссылка,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаАванс),
	|	Операция.Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	Операция.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйАванс КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Операция.ДокументОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ
	|			Операция.ДокументОснование
	|	КОНЕЦ,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.НаАванс),
	|	ЛОЖЬ,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданныйАванс КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.ДокументОснование
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Операция.ДокументОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Строки.ДокументОснование,
	|	Операция.Контрагент,
	|	Операция.Организация,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	Операция.Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора,
	|	2 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Справочник.Организации КАК ДанныеОрганизации
	|	ПО
	|		Операция.Контрагент = ДанныеОрганизации.Ссылка
	|		И ДанныеОрганизации.Ссылка В (&Организация)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Строки.ДокументОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И НЕ Операция.Исправление
	|	И ЕСТЬNULL(ВЫРАЗИТЬ(СписокДокументовОснований.ДокументОснованиеСчетаФактуры КАК Документ.ПередачаТоваровМеждуОрганизациями).НалогообложениеНДС,
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
	|			<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК ДокументОснование,
	|	Операция.Контрагент,
	|	Операция.Организация,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	Операция.Исправление,
	|	ДанныеПервичныхДокументовДокументОснование.ДатаРегистратора,
	|	2 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Справочник.Организации КАК ДанныеОрганизации
	|	ПО
	|		Операция.Контрагент = ДанныеОрганизации.Ссылка
	|		И ДанныеОрганизации.Ссылка В (&Организация)
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументовДокументОснование
	|	ПО Строки.ДокументОснование = ДанныеПервичныхДокументовДокументОснование.Документ
	|		И Операция.Организация = ДанныеПервичныхДокументовДокументОснование.Организация
	|
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И Операция.Исправление
	|	И ЕСТЬNULL(ВЫРАЗИТЬ(СписокДокументовОснований.ДокументОснованиеСчетаФактуры КАК Документ.ПередачаТоваровМеждуОрганизациями).НалогообложениеНДС,
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
	|			<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Строки.ДокументОснование КАК ДокументОснование,
	|	Возврат.ОрганизацияПолучатель,
	|	Возврат.Организация,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный),
	|	Операция.Исправление,
	|	Возврат.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВозвратТоваровМеждуОрганизациями КАК Возврат
	|	ПО
	|		Возврат.Ссылка = Строки.ДокументОснование
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И НЕ Операция.Исправление
	|	И Возврат.ОрганизацияПолучатель В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Строки.ДокументОснование КАК ДокументОснование,
	|	Возврат.Организация,
	|	Возврат.Контрагент,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный),
	|	Операция.Исправление,
	|	Возврат.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВозвратТоваровОтКлиента КАК Возврат
	|	ПО
	|		Возврат.Ссылка = Строки.ДокументОснование
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И НЕ Операция.Исправление
	|	И Возврат.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Строки.ДокументОснование КАК ДокументОснование,
	|	Корректировка.Организация,
	|	ВЫБОР
	|		КОГДА Операция.Корректировочный
	|			ТОГДА Корректировка.Контрагент
	|		ИНАЧЕ 
	|			Корректировка.Организация
	|	КОНЕЦ,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ВЫБОР
	|		КОГДА Операция.Корректировочный
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
	|		ИНАЧЕ 
	|			ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.НаРеализацию)
	|	КОНЕЦ,
	|	Операция.Исправление,
	|	Корректировка.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.КорректировкаРеализации КАК Корректировка
	|	ПО
	|		Корректировка.Ссылка = Строки.ДокументОснование
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И НЕ Операция.Исправление
	|	И Корректировка.Организация В (&Организация)
	|	И Корректировка.ВидКорректировки В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеОшибок),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	НЕОПРЕДЕЛЕНО,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ВЫБОР
	|		КОГДА Операция.Корректировочная
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
	|		ИНАЧЕ 
	|			ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.НаРеализацию)
	|	КОНЕЦ,
	|	Операция.Исправление,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СводнаяСправкаНДС КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.НомерДекларации,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	ДанныеОплатыВБюджет.НомерОтметкиОРегистрации,
	|	ДанныеОплатыВБюджет.ДатаПодтвержденияОплаты,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявлениеОВвозеТоваров КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ПодтверждениеОплатыНДСВБюджет КАК ДанныеОплатыВБюджет
	|		ПО Операция.Ссылка = ДанныеОплатыВБюджет.СчетФактура
	|			И ДанныеОплатыВБюджет.Состояние = Значение(Перечисление.СостоянияОплатыНДСВБюджет.ПолученоПодтверждение)
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.ДокументОснование,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.НомерВходящегоДокумента,
	|	Операция.ДатаВходящегоДокумента,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ИнойДокументПодтвержденияНДС КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.ДокументОснование
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.ДокументОснование,
	|	Операция.Организация,
	|	Операция.Поставщик,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	ВЫБОР
	|		КОГДА Операция.Договор = ЗНАЧЕНИЕ(Справочник.ДоговорыКонтрагентов.ПустаяСсылка) ТОГДА
	|			НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ 
	|			Операция.Договор 
	|	КОНЕЦ КАК ДоговорАванса,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.НалоговыйАгент),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураНалоговыйАгент КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.ДокументОснование
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК ДокументОснование,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	ВЫБОР 
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.НомерСчетаФактуры
	|		ИНАЧЕ Операция.Номер
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.ДатаСчетаФактуры
	|		ИНАЧЕ Операция.Дата
	|	КОНЕЦ,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаписьКнигиПокупок КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|	
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.ПредъявленСчетФактура
	|	И Операция.Организация В (&Организация)
	|	И Операция.ДокументРасчетов = НЕОПРЕДЕЛЕНО
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.ДокументРасчетов КАК ДокументОснование,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	ВЫБОР 
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.НомерСчетаФактуры
	|		ИНАЧЕ Операция.Номер
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.ДатаСчетаФактуры
	|		ИНАЧЕ Операция.Дата
	|	КОНЕЦ,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, Операция.Дата),
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаписьКнигиПокупок КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.ДокументРасчетов
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		Операция.Организация = ДанныеПервичныхДокументов.Организация
	|		И Операция.ДокументРасчетов = ДанныеПервичныхДокументов.Документ
	|	
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.ПредъявленСчетФактура
	|	И Операция.Организация В (&Организация)
	|	И Операция.ДокументРасчетов <> НЕОПРЕДЕЛЕНО
	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.НомерРасходногоКассовогоОрдера,
	|	Операция.ДатаРасходногоКассовогоОрдера,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	ЛОЖЬ,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, Операция.Дата),
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровОтКлиента КАК Операция
	|	ПО СписокДокументовОснований.ДокументОснованиеСчетаФактуры = Операция.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО Операция.ДокументРеализации = ДанныеПервичныхДокументов.Документ
	|			И Операция.Организация = ДанныеПервичныхДокументов.Организация
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтРозничногоПокупателя)
	|	И Операция.ВыданыДенежныеСредства
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.ПокупательНеПлательщикНДС
	|
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВидыЗапасов.ДокументРеализации,
	|	ВидыЗапасов.Ссылка.Организация,
	|	ВидыЗапасов.Ссылка.Организация,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	Операция.Исправление,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.ДатаРегистратора, ВидыЗапасов.Ссылка.Дата),
	|	1 КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.ВозвратТоваровОтКлиента.ВидыЗапасов КАК ВидыЗапасов
	|	ПО
	|		ВидыЗапасов.ДокументРеализации = Строки.ДокументОснование
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО ВидыЗапасов.ДокументРеализации = ДанныеПервичныхДокументов.Документ
	|			И ВидыЗапасов.Ссылка.Организация = ДанныеПервичныхДокументов.Организация
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И НЕ Операция.Исправление
	|	И НЕ Операция.Корректировочный
	|	И ВидыЗапасов.Ссылка.ПокупательНеПлательщикНДС
	|	И ВидыЗапасов.Ссылка.Проведен
	|	И ВидыЗапасов.Ссылка.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Операция.Ссылка,
	|	Операция.Организация,
	|	Операция.Контрагент,
	|	Операция.Номер,
	|	Операция.Дата,
	|	Операция.Ссылка,
	|	НЕОПРЕДЕЛЕНО,
	|	НЕОПРЕДЕЛЕНО,
	|	1,
	|	ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.НаПоступление),
	|	Операция.Исправление,
	|	Операция.Дата,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК ВозвратЧерезКомиссионера
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Операция.Ссылка = СписокДокументовОснований.ДокументОснованиеСчетаФактуры
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснование,
	|	Организация,
	|	Контрагент,
	|	ДоговорКонтрагента,
	|	СтавкаНДСАванса,
	|	ВозвратЧерезКомиссионера
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЕСТЬNULL(СчетаФактурыДокументы.СчетФактураДокумент, ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры) КАК СчетФактураДокумент,
	|	ЕСТЬNULL(СчетаФактурыДокументы.ДатаСчетаФактуры, ДанныеПервичныхДокументов.Дата) КАК ДатаСчетаФактуры,
	|	ЕСТЬNULL(СчетаФактурыДокументы.НомерСчетаФактуры, ДанныеПервичныхДокументов.Номер) КАК НомерСчетаФактуры,
	|	ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры КАК ДокументОснованиеСчетаФактуры,
	|	ЗаписиКнигиПокупок.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ЕСТЬNULL(СчетаФактурыДокументы.Контрагент, ЗаписиКнигиПокупок.КонтрагентПоСчетуФактуре) КАК Контрагент,
	|	ЗаписиКнигиПокупок.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ЗаписиКнигиПокупок.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ЕСТЬNULL(СчетаФактурыДокументы.СводныйКорректировочный, ЛОЖЬ) КАК СводныйКорректировочный,
	|	ЕСТЬNULL(СчетаФактурыДокументы.СводныйКомиссионный, ЛОЖЬ) КАК СводныйКомиссионный,
	|	ВЫБОР
	|		КОГДА СчетаФактурыДокументы.СчетФактураДокумент ЕСТЬ NULL
	|			ТОГДА ""26""
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КодВидаОперации,
	|	СчетаФактурыДокументы.НомерСтроки КАК НомерСтроки,
	|	ЕСТЬNULL(СчетаФактурыДокументы.Организация, ЗаписиКнигиПокупок.Организация) КАК Организация,
	|	СчетаФактурыДокументы.ОбрабатыватьНомерДокумента,
	|	СчетаФактурыДокументы.ДатаДокументаОснования КАК ДатаДокументаОснования
	|ПОМЕСТИТЬ ВТ_ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ЗаписиКнигиПокупок КАК ЗаписиКнигиПокупок
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыДокументыПромежуточная КАК СчетаФактурыДокументы
	|		ПО ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры = СчетаФактурыДокументы.ДокументОснование
	|			И ЗаписиКнигиПокупок.КонтрагентПоСчетуФактуре = СчетаФактурыДокументы.Контрагент
	|			И ЗаписиКнигиПокупок.ДоговорКонтрагента = СчетаФактурыДокументы.ДоговорКонтрагента
	|			И ЗаписиКнигиПокупок.СтавкаНДСАванса = СчетаФактурыДокументы.СтавкаНДСАванса
	|			И ЗаписиКнигиПокупок.ВозвратЧерезКомиссионера = СчетаФактурыДокументы.ВозвратЧерезКомиссионера
	|			И ЗаписиКнигиПокупок.Организация = СчетаФактурыДокументы.Организация
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО ЗаписиКнигиПокупок.ДокументОснованиеСчетаФактуры = ДанныеПервичныхДокументов.Документ
	|			И ЗаписиКнигиПокупок.Организация = ДанныеПервичныхДокументов.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактураДокумент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_СчетаФактурыДокументыПромежуточная";
	
	// Получаем дополнительную информацию из журнала учета счетов-фактур.
	
	ТекстЗапроса = ТекстЗапроса + ОбщегоНазначения.РазделительПакетаЗапросов() +
	"ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактур.Регистратор КАК Регистратор,
	|	ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактураДокумент,
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактур.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировки,
	|	ЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировки,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактур.Продавец
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.Контрагент
	|		ИНАЧЕ NULL
	|	КОНЕЦ КАК ПродавецДляПечати,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактур.КПППродавца
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.КППКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КПППродавцаДляПечати,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.Контрагент
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|	КОНЕЦ КАК ПосредникСсылка,
	|	ЖурналУчетаСчетовФактур.НомерСтроки КАК НомерСтроки,
	|	ЖурналУчетаСчетовФактур.Валюта КАК Валюта,
	|	ЖурналУчетаСчетовФактур.Валюта.Наименование КАК ВалютаНаименование,
	|	ЖурналУчетаСчетовФактур.Валюта.НаименованиеПолное КАК ВалютаНаименованиеПолное,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученныйНалоговыйАгент
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученныйНалоговыйАгент).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение + ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураВыданный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СводнаяСправкаНДС
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СводнаяСправкаНДС).Корректировочная
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданныйАванс
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураВыданныйАванс).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученныйАванс
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученныйАванс).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|	КОНЕЦ КАК ВсегоПокупокВВалюте,
	|	ЖурналУчетаСчетовФактур.Валюта.Код КАК ВалютаКод,
	|	ЖурналУчетаСчетовФактур.КодВидаОперации КАК КодВидаОперации,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактур.ИННПродавца
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.ИННКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ИННПродавцаДляПечати,
	|	ЖурналУчетаСчетовФактур.Продавец КАК Продавец,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.ИННКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ПосредникИНН,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.КППКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ПосредникКПП,
	|	ЖурналУчетаСчетовФактур.Организация
	|ПОМЕСТИТЬ ВТ_РегистрацияСчетовФактур
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур КАК ЖурналУчетаСчетовФактур
	|ГДЕ
	|	ЖурналУчетаСчетовФактур.СчетФактура В
	|			(ВЫБРАТЬ
	|				ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|			ИЗ
	|				ВТ_ТаблицаСчетаФактурыДокументы)
	|	И ЖурналУчетаСчетовФактур.Организация В(&Организация)
	|	И НЕ ЖурналУчетаСчетовФактур.Сторно
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактураДокумент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_РегистрацияСчетовФактур.СчетФактураДокумент КАК СчетФактураДокумент,
	|	ВТ_РегистрацияСчетовФактур.Организация КАК Организация,
	|	СУММА(ВТ_РегистрацияСчетовФактур.ВсегоПокупокВВалюте) КАК ВсегоПокупокВВалюте
	|ПОМЕСТИТЬ СуммыПродажПоСчетамФактурам
	|ИЗ
	|	ВТ_РегистрацияСчетовФактур КАК ВТ_РегистрацияСчетовФактур
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_РегистрацияСчетовФактур.СчетФактураДокумент,
	|	ВТ_РегистрацияСчетовФактур.Организация
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактураДокумент,
	|	Организация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ КАК ДатаСчетаФактуры,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.НомерСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры)
	|	КОНЕЦ КАК НомерСчетаФактуры,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
	|		ИНАЧЕ ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|	КОНЕЦ КАК ДатаИсправления,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА """"
	|		ИНАЧЕ ВТ_РегистрацияСчетовФактур.НомерИсправления
	|	КОНЕЦ КАК НомерИсправления,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры
	|	КОНЕЦ КАК НомерСчетаФактурыСортировка,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|						ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|					КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|						ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|				КОНЕЦ
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправления, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ КАК ДатаСчетаФактурыСортировка,
	|	ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировки,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправленияКорректировки КАК НомерИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки КАК ДатаИсправленияКорректировки,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.КодВидаОперации, ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации) КАК КодВидаОперации,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДокументОснованиеСчетаФактуры КАК ДокументОснованиеСчетаФактуры,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.СчетФактураДокумент, ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент) КАК СчетФактураДокумент,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент КАК СчетФактураДокументРасшифровка,
	|	ВЫБОР
	|		КОГДА ВТ_РегистрацияСчетовФактур.Регистратор ЕСТЬ NULL 
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ОбрабатыватьНомерДокумента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ПродавецДляПечати, ВТ_ТаблицаСчетаФактурыДокументы.Контрагент) КАК ПродавецДляПечати,
	|	ВТ_РегистрацияСчетовФактур.ИННПродавцаДляПечати КАК ИННПродавцаДляПечати,
	|	ВТ_РегистрацияСчетовФактур.КПППродавцаДляПечати КАК КПППродавцаДляПечати,
	|	ВТ_РегистрацияСчетовФактур.ПосредникСсылка КАК ПосредникСсылка,
	|	ВТ_РегистрацияСчетовФактур.ПосредникИНН КАК ПосредникИНН,
	|	ВТ_РегистрацияСчетовФактур.ПосредникКПП КАК ПосредникКПП,
	|	СуммыПродажПоСчетамФактурам.ВсегоПокупокВВалюте КАК ВсегоПокупокВВалюте,
	|	ВТ_РегистрацияСчетовФактур.Валюта КАК Валюта,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименование КАК ВалютаНаименование,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименованиеПолное КАК ВалютаНаименованиеПолное,
	|	ВТ_РегистрацияСчетовФактур.ВалютаКод КАК ВалютаКод,
	|	ВТ_ТаблицаСчетаФактурыДокументы.Организация КАК Организация,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДатаДокументаОснования
	|ПОМЕСТИТЬ ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ВТ_ТаблицаСчетаФактурыДокументы КАК ВТ_ТаблицаСчетаФактурыДокументы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_РегистрацияСчетовФактур КАК ВТ_РегистрацияСчетовФактур
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = ВТ_РегистрацияСчетовФактур.СчетФактураДокумент
	|			И ВТ_ТаблицаСчетаФактурыДокументы.Организация = ВТ_РегистрацияСчетовФактур.Организация
	|			И (НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|					И НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный
	|				ИЛИ ВТ_ТаблицаСчетаФактурыДокументы.НомерСтроки = ВТ_РегистрацияСчетовФактур.НомерСтроки)
	|		ЛЕВОЕ СОЕДИНЕНИЕ СуммыПродажПоСчетамФактурам КАК СуммыПродажПоСчетамФактурам
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = СуммыПродажПоСчетамФактурам.СчетФактураДокумент
	|			И ВТ_ТаблицаСчетаФактурыДокументы.Организация = СуммыПродажПоСчетамФактурам.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснованиеСчетаФактуры,
	|	КонтрагентПоСчетуФактуре,
	|	Организация,
	|	ДоговорКонтрагента,
	|	СтавкаНДСАванса
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ТаблицаСчетаФактурыДокументы"
	+ ОбщегоНазначения.РазделительПакетаЗапросов();
		
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

#Область ЗаписиКнигиПродаж

// Возвращает текст запроса с реквизитами счетов-фактур полученных для книги продаж по Постановлению 735.
//
// Возвращаемое значение:
//	Строка - Текст запроса.
//
Функция ТекстЗапросаРеквизитыСчетовФактурПостановление735КнигаПродаж() Экспорт
	
	// Счета-фактуры выданные, составленные от имени продавца, возникают у комиссионера, в книге не отражаются.
	// Т.к. у счетов-фактур, составленных от имени продавца, и выданных комитенту на вознаграждение один и тот же 
	// документ - основание (отчет комитенту), то необходимо отбирать только счета-фактуры на вознаграждение, 
	// чтобы не задвоились записи при соединении регистра НДС и списка документов.
	
	// Счета-фактуры полученные, составленные от имени продавца, отражаются в базе комитента и
	// на основании их комитент принимает НДС к вычету, поэтому для счетов-фактур полученных отбор по
	// флагу "Составлен от имени продавца" не должен выполняться.
	//
	// Счета-фактуры (полученные и выданные) на аванс в базе комиссионера, составленные от имени продавца, 
	// не формируют движения по регистрам НДС, поэтому задвоение данных при соединении регистров с ними не возникает.
	
	// Для списка счетов-фактур получаем данные документов-оснований.
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ
	|			Строки.ДокументОснование
	|	КОНЕЦ КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Строки.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	NULL КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|
	|ПОМЕСТИТЬ ВТ_СчетаФактурыПромежуточная
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	ТаблицаПокупатели.Покупатель КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	ТаблицаПокупатели.НомерСтроки КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	Операция.Сводный КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураКомиссионеру.Покупатели КАК ТаблицаПокупатели
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураКомиссионеру КАК Операция
	|	ПО
	|		ТаблицаПокупатели.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ
	|			Операция.ДокументОснование
	|	КОНЕЦ КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ИСТИНА КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	Операция.Контрагент КАК Контрагент,
	|	ВЫБОР
	|		КОГДА Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ИЛИ Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураВыданныйАванс КАК Операция
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ИСТИНА КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	Операция.Контрагент КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураПолученныйАванс КАК Операция
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйАванс КАК ОперацияБудущая
	|		ПО Операция.ДокументОснование = ОперацияБудущая.ДокументОснование
	|			И Операция.Контрагент = ОперацияБудущая.Контрагент
	|			И Операция.Дата < ОперацияБудущая.Дата
	|			И ОперацияБудущая.Проведен
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И ОперацияБудущая.Ссылка ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	ВЫБОР
	|		КОГДА Операция.Договор = ЗНАЧЕНИЕ(Справочник.ДоговорыКонтрагентов.ПустаяСсылка) ТОГДА
	|			НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ 
	|			Операция.Договор 
	|	КОНЕЦ КАК ДоговорАванса,
	|	Операция.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураНалоговыйАгент КАК Операция
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураНалоговыйАгент.РасшифровкаСуммы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураНаНеподтвержденнуюРеализацию0 КАК Операция
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ИСТИНА КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.ОтчетОРозничныхПродажах КАК Операция
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация  КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.НомерДекларации КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|
	|ИЗ
	|	Документ.ТаможеннаяДекларацияИмпорт КАК Операция
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация  КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|
	|ИЗ
	|	Документ.ЗаявлениеОВвозеТоваров КАК Операция
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Передача.ОрганизацияПолучатель,
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА
	|				Операция.Ссылка
	|		ИНАЧЕ
	|			Строки.ДокументОснование
	|	КОНЕЦ,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Строки.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	2 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПередачаТоваровМеждуОрганизациями КАК Передача
	|		ПО Строки.ДокументОснование = Передача.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Передача.РасчетыЧерезОтдельногоКонтрагента
	|	И Передача.ОрганизацияПолучатель В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Основания.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Основания.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	Операция.КодВидаОперацииНаУменьшение КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураПолученный.ДокументыОснования КАК Основания
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК Операция
	|		ПО Основания.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И ТИПЗНАЧЕНИЯ(Основания.ДокументОснование) <> ТИП(Документ.КорректировкаРеализации)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Основания.ДокументОснование.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	Операция.КодВидаОперацииНаУменьшение КАК КодВидаОперации
	|ИЗ
	|	Документ.СчетФактураПолученный.ДокументыОснования КАК Основания
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК Операция
	|		ПО Основания.Ссылка = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И ТИПЗНАЧЕНИЯ(Основания.ДокументОснование) <> ТИП(Документ.КорректировкаРеализации)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	ВЫБОР 
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.НомерСчетаФактуры
	|		ИНАЧЕ Операция.Номер
	|	КОНЕЦ КАК НомерСчетаФактуры,
	|	ВЫБОР 
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.ДатаСчетаФактуры
	|		ИНАЧЕ Операция.Дата
	|	КОНЕЦ КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	ЛОЖЬ КАК НаАванс,
	|	ЛОЖЬ КАК НаСуммовуюРазницу,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.Дата КАК ДатаДокументаОснования,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации
	|ИЗ
	|	Документ.ЗаписьКнигиПокупок КАК Операция
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура,
	|	СтавкаНДСАванса,
	|	ДоговорАванса,
	|	Контрагент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗаписиКнигиПродаж.СчетФактура КАК СчетФактура,
	|	ЗаписиКнигиПродаж.ДокументОплаты КАК ДокументОплаты,
	|	ЗаписиКнигиПродаж.Организация КАК Организация,
	|	ЗаписиКнигиПродаж.ДоговорАванса КАК ДоговорАванса,
	|	ЗаписиКнигиПродаж.СтавкаНДС_Аванс КАК СтавкаНДСАванса,
	|	ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	СчетаФактурыДокументы.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	СчетаФактурыДокументы.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	СчетаФактурыДокументы.СчетФактураДокумент КАК СчетФактураДокумент,
	|	СчетаФактурыДокументы.НомерСтроки КАК НомерСтроки,
	|	СчетаФактурыДокументы.СводныйКорректировочный КАК СводныйКорректировочный,
	|	СчетаФактурыДокументы.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК НачислениеПоОказаниюУслуг,
	|	ВЫБОР
	|		КОГДА СчетаФактурыДокументы.СчетФактура ЕСТЬ NULL
	|				ИЛИ СчетаФактурыДокументы.ЭтоРозничнаяПродажа
	|			ТОГДА ВЫБОР
	|					КОГДА &КонецПериода >= ДАТАВРЕМЯ(2015, 1, 1)
	|						ТОГДА ""26""
	|					ИНАЧЕ ""01""
	|				КОНЕЦ
	|		КОГДА &КонецПериода >= ДАТАВРЕМЯ(2015, 1, 1)
	|				И СчетаФактурыДокументы.КодВидаОперации <> """"
	|			ТОГДА СчетаФактурыДокументы.КодВидаОперации
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КодВидаОперации,
	|	СчетаФактурыДокументы.ДатаДокументаОснования КАК ДатаДокументаОснования,
	|	СчетаФактурыДокументы.ЭтоРозничнаяПродажа КАК ЭтоРозничнаяПродажа,
	|	СчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|ПОМЕСТИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОснования
	|ИЗ
	|	ЗаписиКнигиПродаж КАК ЗаписиКнигиПродаж
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыПромежуточная КАК СчетаФактурыДокументы
	|		ПО (ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре = ЕСТЬNULL(СчетаФактурыДокументы.Контрагент, ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре))
	|			И ЗаписиКнигиПродаж.СтавкаНДС_Аванс = СчетаФактурыДокументы.СтавкаНДСАванса
	|			И ЗаписиКнигиПродаж.ДоговорАванса = СчетаФактурыДокументы.ДоговорАванса
	|			И ЗаписиКнигиПродаж.СчетФактура = СчетаФактурыДокументы.СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗаписиКнигиПродаж.СчетФактура КАК СчетФактура,
	|	ЗаписиКнигиПродаж.ДокументОплаты КАК ДокументОплаты,
	|	ЗаписиКнигиПродаж.Организация КАК Организация,
	|	ЗаписиКнигиПродаж.ДоговорАванса КАК ДоговорАванса,
	|	ЗаписиКнигиПродаж.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ЗаписиКнигиПродаж.ДатаДокументаОснования КАК ДатаДокументаОснования,
	|	ЗаписиКнигиПродаж.ЭтоРозничнаяПродажа КАК ЭтоРозничнаяПродажа,
	|	ЗаписиКнигиПродаж.ОбрабатыватьНомерДокумента КАК ОбрабатыватьНомерДокумента
	|ПОМЕСТИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОснованияБезСчетаФактуры
	|ИЗ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования КАК ЗаписиКнигиПродаж
	|ГДЕ
	|	ЗаписиКнигиПродаж.СчетФактураДокумент ЕСТЬ NULL
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОплаты,
	|	ДоговорАванса,
	|	СтавкаНДСАванса,
	|	КонтрагентПоСчетуФактуре
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗаписиКнигиПродаж.СчетФактура КАК СчетФактура,
	|	ЗаписиКнигиПродаж.Организация КАК Организация,
	|	ЗаписиКнигиПродаж.ДоговорАванса КАК ДоговорАванса,
	|	ЗаписиКнигиПродаж.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	СчетаФактурыДокументы.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	СчетаФактурыДокументы.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	СчетаФактурыДокументы.СчетФактураДокумент КАК СчетФактураДокумент,
	|	СчетаФактурыДокументы.НомерСтроки КАК НомерСтроки,
	|	СчетаФактурыДокументы.СводныйКорректировочный КАК СводныйКорректировочный,
	|	СчетаФактурыДокументы.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК НачислениеПоОказаниюУслуг,
	|	ВЫБОР
	|		КОГДА СчетаФактурыДокументы.СчетФактура ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА &КонецПериода >= ДАТАВРЕМЯ(2015, 1, 1)
	|						ТОГДА ""26""
	|					ИНАЧЕ ""01""
	|				КОНЕЦ
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КодВидаОперации,
	|	ЕСТЬNULL(ЗаписиКнигиПродаж.ДатаДокументаОснования, СчетаФактурыДокументы.ДатаДокументаОснования) КАК ДатаДокументаОснования,
	|	ЕСТЬNULL(ЗаписиКнигиПродаж.ЭтоРозничнаяПродажа, СчетаФактурыДокументы.ЭтоРозничнаяПродажа) КАК ЭтоРозничнаяПродажа,
	|	ЕСТЬNULL(ЗаписиКнигиПродаж.ОбрабатыватьНомерДокумента, СчетаФактурыДокументы.ОбрабатыватьНомерДокумента) КАК ОбрабатыватьНомерДокумента
	|ПОМЕСТИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОплаты
	|ИЗ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснованияБезСчетаФактуры КАК ЗаписиКнигиПродаж
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыПромежуточная КАК СчетаФактурыДокументы
	|		ПО ЗаписиКнигиПродаж.СтавкаНДСАванса = СчетаФактурыДокументы.СтавкаНДСАванса
	|			И (ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре = ЕСТЬNULL(СчетаФактурыДокументы.Контрагент, ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре))
	|			И ЗаписиКнигиПродаж.ДоговорАванса = СчетаФактурыДокументы.ДоговорАванса
	|			И ЗаписиКнигиПродаж.ДокументОплаты = СчетаФактурыДокументы.СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОснованияБезСчетаФактуры
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗаписиКнигиПродаж.СчетФактура КАК СчетФактура,
	|	ЗаписиКнигиПродаж.Организация КАК Организация,
	|	ЗаписиКнигиПродаж.ДоговорАванса КАК ДоговорАванса,
	|	ЗаписиКнигиПродаж.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ЗаписиКнигиПродаж.ДатаДокументаОснования КАК ДатаДокументаОснования,
	|	ЗаписиКнигиПродаж.ЭтоРозничнаяПродажа КАК ЭтоРозничнаяПродажа,
	|	ЗаписиКнигиПродаж.ОбрабатыватьНомерДокумента КАК ОбрабатыватьНомерДокумента
	|ПОМЕСТИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОплатыБезСчетаФактуры
	|ИЗ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты КАК ЗаписиКнигиПродаж
	|ГДЕ
	|	ЗаписиКнигиПродаж.СчетФактураДокумент ЕСТЬ NULL
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗаписиКнигиПродаж.СчетФактура КАК СчетФактура,
	|	ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ДанныеПервичныхДокументов.Дата КАК ДатаСчетаФактуры,
	|	ДанныеПервичныхДокументов.Номер КАК НомерСчетаФактуры,
	|	НЕОПРЕДЕЛЕНО КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	NULL КАК Ссылка,
	|	NULL КАК НомерСтроки,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК НачислениеПоОказаниюУслуг,
	|	ВЫБОР
	|		КОГДА &КонецПериода >= ДАТАВРЕМЯ(2015, 1, 1)
	|			ТОГДА ""26""
	|		ИНАЧЕ ""01""
	|	КОНЕЦ КАК КодВидаОперации,
	|	ЗаписиКнигиПродаж.Организация,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.Дата, ЗаписиКнигиПродаж.ДатаДокументаОснования) КАК ДатаДокументаОснования,
	|	ЗаписиКнигиПродаж.ЭтоРозничнаяПродажа КАК ЭтоРозничнаяПродажа,
	|	ЗаписиКнигиПродаж.ОбрабатыватьНомерДокумента КАК ОбрабатыватьНомерДокумента
	|ПОМЕСТИТЬ ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов
	|ИЗ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплатыБезСчетаФактуры КАК ЗаписиКнигиПродаж
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО ЗаписиКнигиПродаж.СчетФактура = ДанныеПервичныхДокументов.Документ
	|			И ЗаписиКнигиПродаж.Организация = ДанныеПервичныхДокументов.Организация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОплатыБезСчетаФактуры
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_СчетаФактурыПромежуточная
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.СчетФактура КАК СчетФактура,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.СчетФактураДокумент КАК СчетФактураДокумент,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.ДоговорАванса КАК ДоговорАванса,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.НомерСтроки КАК НомерСтроки,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.НачислениеПоОказаниюУслуг КАК НачислениеПоОказаниюУслуг,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.КодВидаОперации КАК КодВидаОперации,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.Организация КАК Организация,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.ДатаДокументаОснования КАК ДатаДокументаОснования,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.ЭтоРозничнаяПродажа КАК ЭтоРозничнаяПродажа,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования.ОбрабатыватьНомерДокумента КАК ОбрабатыватьНомерДокумента
	|ПОМЕСТИТЬ ВТ_ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОснования КАК ВТ_ЗаписиКнигиПродажПоДокументуОснования
	|ГДЕ
	|	НЕ ВТ_ЗаписиКнигиПродажПоДокументуОснования.СчетФактураДокумент ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.СчетФактура,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.ДатаСчетаФактуры,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.НомерСчетаФактуры,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.СчетФактураДокумент,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.ДоговорАванса,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.СтавкаНДСАванса,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.НомерСтроки,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.КонтрагентПоСчетуФактуре,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.СводныйКорректировочный,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.СводныйКомиссионный,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.НачислениеПоОказаниюУслуг,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.КодВидаОперации,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.Организация,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.ДатаДокументаОснования КАК ДатаДокументаОснования,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.ЭтоРозничнаяПродажа КАК ЭтоРозничнаяПродажа,
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты.ОбрабатыватьНомерДокумента КАК ОбрабатыватьНомерДокумента
	|ИЗ
	|	ВТ_ЗаписиКнигиПродажПоДокументуОплаты КАК ВТ_ЗаписиКнигиПродажПоДокументуОплаты
	|ГДЕ
	|	НЕ ВТ_ЗаписиКнигиПродажПоДокументуОплаты.СчетФактураДокумент ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.СчетФактура,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.ДатаСчетаФактуры,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.НомерСчетаФактуры,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.СчетФактураДокумент,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.ДоговорАванса,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.СтавкаНДСАванса,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.НомерСтроки,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.КонтрагентПоСчетуФактуре,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.СводныйКорректировочный,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.СводныйКомиссионный,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.НачислениеПоОказаниюУслуг,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.КодВидаОперации,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.Организация,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.ДатаДокументаОснования КАК ДатаДокументаОснования,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.ЭтоРозничнаяПродажа КАК ЭтоРозничнаяПродажа,
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов.ОбрабатыватьНомерДокумента КАК ОбрабатыватьНомерДокумента
	|ИЗ
	|	ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов КАК ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактураДокумент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЗаписиКнигиПродажПоДаннымПервичныхДокументов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОплаты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЗаписиКнигиПродажПоДокументуОснования";
	
	// Получаем дополнительную информацию из журнала учета счетов-фактур.
	ТекстЗапроса = ТекстЗапроса + ОбщегоНазначения.РазделительПакетаЗапросов() +
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ЖурналУчетаСчетовФактур.Регистратор,
	|	ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактур.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировки,
	|	ЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировки,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА """"
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.КППКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КППКонтрагента,
	|	ЖурналУчетаСчетовФактур.НомерСтроки,
	|	ЖурналУчетаСчетовФактур.КодВидаОперации,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Валюта <> &ВалютаРегУчета
	|			ТОГДА ЖурналУчетаСчетовФактур.Валюта.НаименованиеПолное
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ВалютаНаименование,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Валюта <> &ВалютаРегУчета
	|			ТОГДА ЖурналУчетаСчетовФактур.Валюта.Код
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ВалютаКод,
	|	ЖурналУчетаСчетовФактур.Валюта.Наименование КАК ВалютаНаименованиеКраткое,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураВыданный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|	КОНЕЦ КАК ВсегоПродажВВалюте,
	|	ЖурналУчетаСчетовФактур.Посредник КАК ПосредникСсылка,
	|	ЖурналУчетаСчетовФактур.Валюта КАК Валюта
	|ПОМЕСТИТЬ ВТ_РегистрацияСчетовФактур
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур КАК ЖурналУчетаСчетовФактур
	|ГДЕ
	|	ЖурналУчетаСчетовФактур.СчетФактура В
	|			(ВЫБРАТЬ
	|				ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|			ИЗ
	|				ВТ_ТаблицаСчетаФактурыДокументы)
	|	И ЖурналУчетаСчетовФактур.Организация В(&Организация)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ГТДИмпорт.Ссылка КАК СчетФактура,
	|	СУММА(ГТДИмпорт.ТаможеннаяСтоимость + ГТДИмпорт.СуммаПошлины + ГТДИмпорт.СуммаНДС) КАК Стоимость
	|ПОМЕСТИТЬ ВременнаяТаблицаГТДИмпорт
	|ИЗ
	|	Документ.ТаможеннаяДекларацияИмпорт.Разделы КАК ГТДИмпорт
	|ГДЕ
	|	ГТДИмпорт.Ссылка В
	|			(ВЫБРАТЬ
	|				ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|			ИЗ
	|				ВТ_ТаблицаСчетаФактурыДокументы)
	|
	|СГРУППИРОВАТЬ ПО
	|	ГТДИмпорт.Ссылка
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ТаблицаСчетаФактурыДокументы.СчетФактура КАК СчетФактура,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры) КАК ДатаСчетаФактуры,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.НомерСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры) КАК НомерСчетаФактуры,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.СчетФактура, ВЫБОР
	|			КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = НЕОПРЕДЕЛЕНО
	|				ТОГДА NULL
	|			ИНАЧЕ ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|		КОНЕЦ) КАК СчетФактураДокумент,
	|	ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры КАК НомерСчетаФактурыСортировка,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправления, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ КАК ДатаСчетаФактурыСортировка,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДоговорАванса КАК ДоговорАванса,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировки,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправления КАК НомерИсправления,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправления КАК ДатаИсправления,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправленияКорректировки КАК НомерИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки КАК ДатаИсправленияКорректировки,
	|	ВЫБОР
	|		КОГДА ВТ_РегистрацияСчетовФактур.СчетФактура ЕСТЬ NULL 
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ОбрабатыватьНомерДокумента,
	|	ВТ_РегистрацияСчетовФактур.КППКонтрагента КАК КППКонтрагента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации = """"
	|			ТОГДА ВТ_РегистрацияСчетовФактур.КодВидаОперации
	|		ИНАЧЕ ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации
	|	КОНЕЦ КАК КодВидаОперации,
	|	ВТ_РегистрацияСчетовФактур.ВалютаКод,
	|	СУММА(ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ВсегоПродажВВалюте, ВременнаяТаблицаГТДИмпорт.Стоимость)) КАК ВсегоПродажВВалюте,
	|	ВТ_РегистрацияСчетовФактур.ПосредникСсылка,
	|	ВТ_РегистрацияСчетовФактур.Валюта,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименование,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименованиеКраткое,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.НачислениеПоОказаниюУслуг,
	|	ЛОЖЬ КАК СводнаяСправка,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДатаДокументаОснования,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ЭтоРозничнаяПродажа
	|ПОМЕСТИТЬ ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ВТ_ТаблицаСчетаФактурыДокументы КАК ВТ_ТаблицаСчетаФактурыДокументы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_РегистрацияСчетовФактур КАК ВТ_РегистрацияСчетовФактур
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = ВТ_РегистрацияСчетовФактур.СчетФактура
	|			И (НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|					И НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный
	|				ИЛИ ВТ_ТаблицаСчетаФактурыДокументы.НомерСтроки = ВТ_РегистрацияСчетовФактур.НомерСтроки)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВременнаяТаблицаГТДИмпорт КАК ВременнаяТаблицаГТДИмпорт
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = ВременнаяТаблицаГТДИмпорт.СчетФактура
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_РегистрацияСчетовФактур.КППКонтрагента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДоговорАванса,
	|	ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры,
	|	ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры,
	|	ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.Валюта,
	|	ВТ_РегистрацияСчетовФактур.ВалютаКод,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименованиеКраткое,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.НачислениеПоОказаниюУслуг,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправления,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СчетФактура,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СтавкаНДСАванса,
	|	ВТ_РегистрацияСчетовФактур.ПосредникСсылка,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименование,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправления,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры),
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.НомерСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры),
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.СчетФактура, ВЫБОР
	|			КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = НЕОПРЕДЕЛЕНО
	|				ТОГДА NULL
	|			ИНАЧЕ ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|		КОНЕЦ),
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправления, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации = """"
	|			ТОГДА ВТ_РегистрацияСчетовФактур.КодВидаОперации
	|		ИНАЧЕ ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВТ_РегистрацияСчетовФактур.СчетФактура ЕСТЬ NULL 
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДатаДокументаОснования,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ЭтоРозничнаяПродажа
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура,
	|	ДоговорАванса,
	|	СтавкаНДСАванса,
	|	КонтрагентПоСчетуФактуре
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_РегистрацияСчетовФактур"
	+ ОбщегоНазначения.РазделительПакетаЗапросов();
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Возвращает текст запроса с реквизитами счетов-фактур полученных для книги продаж по Постановлению 981 (с 1 октября 2017).
//
// Возвращаемое значение:
//	Строка - Текст запроса.
//
Функция ТекстЗапросаРеквизитыСчетовФактурПостановление981КнигаПродаж() Экспорт
	
	// Счета-фактуры выданные, составленные от имени продавца, возникают у комиссионера, в книге не отражаются.
	// Т.к. у счетов-фактур, составленных от имени продавца, и выданных комитенту на вознаграждение один и тот же 
	// документ - основание (отчет комитенту), то необходимо отбирать только счета-фактуры на вознаграждение, 
	// чтобы не задвоились записи при соединении регистра НДС и списка документов.
	//
	// Счета-фактуры полученные, составленные от имени продавца, отражаются в базе комитента и
	// на основании их комитент принимает НДС к вычету, поэтому для счетов-фактур полученных отбор по
	// флагу "Составлен от имени продавца" не должен выполняться.
	// 
	// Счета-фактуры (полученные и выданные) на аванс в базе комиссионера, составленные от имени продавца, 
	// не формируют движения по регистрам НДС, поэтому задвоение данных при соединении регистров с ними не возникает.
	
	// Для списка счетов-фактур получаем данные документов-оснований.
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ЗаписиКнигиПродаж.СчетФактура КАК СчетФактура
	|ПОМЕСТИТЬ СписокДокументовОснований
	|ИЗ
	|	ЗаписиКнигиПродаж
	|ГДЕ
	|	НЕ ЗаписиКнигиПродаж.СчетФактура ЕСТЬ NULL
	|	И ЗаписиКнигиПродаж.СчетФактура <> НЕОПРЕДЕЛЕНО
	|
	|ОБЪЕДИНИТЬ 
	|
	|ВЫБРАТЬ
	|	ЗаписиКнигиПродаж.ДокументОплаты
	|ИЗ
	|	ЗаписиКнигиПродаж
	|ГДЕ
	|	НЕ ЗаписиКнигиПродаж.ДокументОплаты ЕСТЬ NULL
	|	И ЗаписиКнигиПродаж.ДокументОплаты <> НЕОПРЕДЕЛЕНО
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|ВЫБРАТЬ
	|	СписокДокументовОснований.СчетФактура КАК СчетФактура,
	|	ДокументСчетФактура.Ссылка КАК ИсправленныйСчетФактура,
	|	ДокументСчетФактура.Дата КАК ДатаИсправленногоСчетаФактуры,
	|	ДокументСчетФактура.Номер КАК НомерИсправленногоСчетаФактуры
	|ПОМЕСТИТЬ СчетаФактурыСОсобымПорядкомОтображения
	|ИЗ 
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК СтрокиСчетаФактуры
	|		ПО ВЫРАЗИТЬ(СписокДокументовОснований.СчетФактура КАК Документ.ЗаписьКнигиПродаж).ИсправляемыйДокумент = СтрокиСчетаФактуры.ДокументОснование 
	|			И ВЫРАЗИТЬ(СписокДокументовОснований.СчетФактура КАК Документ.ЗаписьКнигиПродаж).ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеПрочегоНачисленияНДС)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный КАК ДокументСчетФактура
	|		ПО СтрокиСчетаФактуры.Ссылка = ДокументСчетФактура.Ссылка
	|ГДЕ
	|	ДокументСчетФактура.Проведен
	|;
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК СчетФактура,
	|	МИНИМУМ(ЖурналУчетаСчетовФактур.НомерСтроки) КАК НомерСтроки
	|ПОМЕСТИТЬ вт_НомераСтрокПромежуточная
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|		ПО Строки.ДокументОснование = СписокДокументовОснований.СчетФактура
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровМеждуОрганизациями КАК Возврат
	|		ПО Строки.ДокументОснование = Возврат.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЖурналУчетаСчетовФактур КАК ЖурналУчетаСчетовФактур
	|		ПО ЖурналУчетаСчетовФактур.СчетФактура = Операция.Ссылка
	|			И ЖурналУчетаСчетовФактур.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И Возврат.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|	И Возврат.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|СГРУППИРОВАТЬ ПО
	|	Операция.Ссылка
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК Ссылка,
	|	КОЛИЧЕСТВО(Строки.Покупатель) КАК ПокупателиКоличество
	|ПОМЕСТИТЬ вт_ПокупателиПромежуточная
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.Покупатели КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|		ПО Строки.ДокументОснование = СписокДокументовОснований.СчетФактура
	|ГДЕ
	|	Операция.Проведен
	|СГРУППИРОВАТЬ ПО
	|	Операция.Ссылка
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Ссылка КАК Ссылка,
	|	КОЛИЧЕСТВО(Строки.Покупатель) КАК ПокупателиКоличество
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.Покупатели КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|		ПО Операция.Ссылка = СписокДокументовОснований.СчетФактура
	|ГДЕ
	|	Операция.Проведен
	|СГРУППИРОВАТЬ ПО
	|	Операция.Ссылка
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка
	|;
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Операция.Организация КАК Организация,
	|	Строки.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|
	|ПОМЕСТИТЬ ВТ_СчетаФактурыПромежуточная
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.СчетФактура
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|	И НЕ Операция.РеализацияЧерезКомиссионера
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Операция.Организация КАК Организация,
	|	Строки.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	(ПокупателиПромежуточная.ПокупателиКоличество > 1) КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Строки.ДокументОснование = СписокДокументовОснований.СчетФактура
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ вт_ПокупателиПромежуточная КАК ПокупателиПромежуточная
	|	ПО Операция.Ссылка = ПокупателиПромежуточная.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|	И Операция.РеализацияЧерезКомиссионера
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	(ЕСТЬNULL(ПокупателиПромежуточная.ПокупателиКоличество, 0) > 1) КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|	ПО Строки.Ссылка = Операция.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Операция.Ссылка = СписокДокументовОснований.СчетФактура
	|	ЛЕВОЕ СОЕДИНЕНИЕ вт_ПокупателиПромежуточная КАК ПокупателиПромежуточная
	|	ПО Операция.Ссылка = ПокупателиПромежуточная.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Операция.Перевыставленный
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка) КАК Контрагент,
	|	ИСТИНА КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ИСТИНА КАК СводнаяСправка
	|
	|ИЗ
	|	Документ.СводнаяСправкаНДС КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Операция.Ссылка = СписокДокументовОснований.СчетФактура
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|
	|ИЗ
	|	Документ.СчетФактураПолученныйНалоговыйАгент КАК Операция
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Операция.Ссылка = СписокДокументовОснований.СчетФактура
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	Документ.СчетФактураПолученныйНалоговыйАгент КАК Операция
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|	ПО Операция.Ссылка = СписокДокументовОснований.СчетФактура
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	ТаблицаПокупатели.Покупатель КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	ТаблицаПокупатели.НомерСтроки КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	Операция.Сводный КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураКомиссионеру.Покупатели КАК ТаблицаПокупатели
	|	ПО СписокДокументовОснований.СчетФактура = ТаблицаПокупатели.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураКомиссионеру КАК Операция
	|	ПО
	|		ТаблицаПокупатели.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА Операция.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ Операция.ДокументОснование
	|	КОНЕЦ КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.Контрагент КАК Контрагент,
	|	ВЫБОР
	|		КОГДА Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ИЛИ Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ВЫБОР
	|		КОГДА Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ИЛИ Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|			ТОГДА ""26""
	|		ИНАЧЕ """"
	|	КОНЕЦ КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданныйАванс КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.ДокументОснование
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.Контрагент КАК Контрагент,
	|	ВЫБОР
	|		КОГДА Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ИЛИ Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ВЫБОР
	|		КОГДА Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ИЛИ Операция.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.РозничныйПокупатель)
	|			ТОГДА ""26""
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданныйАванс КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.Ссылка
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураВыданныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА Операция.Исправление
	|			ТОГДА Операция.Ссылка
	|		ИНАЧЕ
	|			Операция.ДокументОснование
	|	КОНЕЦ КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	Строки.СтавкаНДС.ПеречислениеСтавкаНДС КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Операция.Контрагент КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйАванс КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.ДокументОснование
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураПолученныйАванс.Авансы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	ВЫБОР
	|		КОГДА Операция.Договор = ЗНАЧЕНИЕ(Справочник.ДоговорыКонтрагентов.ПустаяСсылка) ТОГДА
	|			НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ 
	|			Операция.Договор 
	|	КОНЕЦ КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураНалоговыйАгент КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.ДокументОснование
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		Документ.СчетФактураНалоговыйАгент.РасшифровкаСуммы КАК Строки
	|	ПО
	|		Строки.Ссылка = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураНаНеподтвержденнуюРеализацию0 КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.Ссылка
	|
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ИСТИНА КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	""26"" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетОРозничныхПродажах КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация  КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.НомерДекларации КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация  КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявлениеОВвозеТоваров КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация  КАК Организация,
	|	Операция.ДокументОснование КАК СчетФактура,
	|	Операция.НомерВходящегоДокумента КАК НомерСчетаФактуры,
	|	Операция.ДатаВходящегоДокумента КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ИнойДокументПодтвержденияНДС КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.ДокументОснование
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Передача.ОрганизацияПолучатель КАК Организация,
	|	Строки.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	2 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|		ПО Строки.ДокументОснование = СписокДокументовОснований.СчетФактура
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПередачаТоваровМеждуОрганизациями КАК Передача
	|		ПО Строки.ДокументОснование = Передача.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Передача.РасчетыЧерезОтдельногоКонтрагента
	|	И Передача.ОрганизацияПолучатель В (&Организация)
	|	И НЕ Операция.Исправление
	|	И Передача.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Передача.ОрганизацияПолучатель КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	2 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|		ПО Строки.ДокументОснование = СписокДокументовОснований.СчетФактура
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПередачаТоваровМеждуОрганизациями КАК Передача
	|		ПО Строки.ДокументОснование = Передача.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И НЕ Передача.РасчетыЧерезОтдельногоКонтрагента
	|	И Передача.ОрганизацияПолучатель В (&Организация)
	|	И Операция.Исправление
	|	И Передача.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Возврат.Организация КАК Организация,
	|	Строки.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	Возврат.ОрганизацияПолучатель КАК Контрагент,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	ЕСТЬNULL(НомераСтрок.НомерСтроки, 0) КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	Документ.СчетФактураВыданный КАК Операция
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный.ДокументыОснования КАК Строки
	|		ПО Строки.Ссылка = Операция.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписокДокументовОснований КАК СписокДокументовОснований
	|		ПО Строки.ДокументОснование = СписокДокументовОснований.СчетФактура
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровМеждуОрганизациями КАК Возврат
	|		ПО Строки.ДокументОснование = Возврат.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ вт_НомераСтрокПромежуточная КАК НомераСтрок
	|		ПО НомераСтрок.СчетФактура = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Возврат.Организация В (&Организация)
	|	И НЕ Операция.Исправление
	|	И Возврат.НалогообложениеНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Основания.ДокументОснование КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	Операция.КодВидаОперацииНаУменьшение КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК Основания
	|		ПО СписокДокументовОснований.СчетФактура = Основания.ДокументОснование
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК Операция
	|		ПО Основания.Ссылка = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И ТИПЗНАЧЕНИЯ(Основания.ДокументОснование) <> ТИП(Документ.КорректировкаРеализации)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.ДатаСоставления КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	Операция.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	Операция.КодВидаОперацииНаУменьшение КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК Основания
	|		ПО СписокДокументовОснований.СчетФактура = Основания.Ссылка
	|
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК Операция
	|		ПО Основания.Ссылка = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И ТИПЗНАЧЕНИЯ(Основания.ДокументОснование) <> ТИП(Документ.КорректировкаРеализации)
	|	И Операция.Исправление
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	ВЫБОР 
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.НомерСчетаФактуры
	|		ИНАЧЕ Операция.Номер
	|	КОНЕЦ КАК НомерСчетаФактуры,
	|	ВЫБОР 
	|		КОГДА Операция.ПредъявленСчетФактура 
	|				И Операция.ДатаПолучения <> ДАТАВРЕМЯ(1,1,1)
	|			ТОГДА Операция.ДатаСчетаФактуры
	|		ИНАЧЕ Операция.Дата
	|	КОНЕЦ КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ЛОЖЬ КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	"""" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаписьКнигиПокупок КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.Ссылка
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Операция.Организация КАК Организация,
	|	Операция.Ссылка КАК СчетФактура,
	|	Операция.Номер КАК НомерСчетаФактуры,
	|	Операция.Дата КАК ДатаСчетаФактуры,
	|	Операция.Ссылка КАК СчетФактураДокумент,
	|	НЕОПРЕДЕЛЕНО КАК СтавкаНДСАванса,
	|	НЕОПРЕДЕЛЕНО КАК ДоговорАванса,
	|	NULL,
	|	ЛОЖЬ КАК ЭтоРозничнаяПродажа,
	|	1 КАК НомерСтроки,
	|	ИСТИНА КАК ОбрабатыватьНомерДокумента,
	|	ЛОЖЬ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	""01"" КАК КодВидаОперации,
	|	ЛОЖЬ КАК СводнаяСправка
	|ИЗ
	|	СписокДокументовОснований КАК СписокДокументовОснований
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаписьКнигиПродаж КАК Операция
	|	ПО СписокДокументовОснований.СчетФактура = Операция.Ссылка
	|
	|ГДЕ
	|	Операция.Проведен
	|	И Операция.Организация В (&Организация)
	|	И Операция.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеПрочегоНачисленияНДС)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура,
	|	СтавкаНДСАванса,
	|	ДоговорАванса,
	|	Контрагент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗаписиКнигиПродаж.СчетФактура КАК СчетФактура,
	|	ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ЗаписиКнигиПродаж.ДоговорАванса КАК ДоговорАванса,
	|	ЗаписиКнигиПродаж.СтавкаНДС_Аванс КАК СтавкаНДСАванса,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.ДатаСчетаФактуры
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.ДатаСчетаФактуры
	|		ИНАЧЕ ДанныеПервичныхДокументов.Дата
	|	КОНЕЦ КАК ДатаСчетаФактуры,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.НомерСчетаФактуры
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.НомерСчетаФактуры
	|		ИНАЧЕ ДанныеПервичныхДокументов.Номер
	|	КОНЕЦ КАК НомерСчетаФактуры,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.СчетФактураДокумент
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.СчетФактураДокумент
	|	КОНЕЦ КАК СчетФактураДокумент,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.НомерСтроки
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.НомерСтроки
	|	КОНЕЦ КАК НомерСтроки,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.СводныйКорректировочный
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.СводныйКорректировочный
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СводныйКорректировочный,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.СводныйКомиссионный
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.СводныйКомиссионный
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СводныйКомиссионный,
	|	ЛОЖЬ КАК НачислениеПоОказаниюУслуг,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.КодВидаОперации
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.КодВидаОперации
	|		ИНАЧЕ ""26""
	|	КОНЕЦ КАК КодВидаОперации,
	|	ВЫБОР
	|		КОГДА СФДокументыСчетФактура.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыСчетФактура.СводнаяСправка
	|		КОГДА СФДокументыДокументОплаты.СчетФактура ЕСТЬ НЕ NULL 
	|			ТОГДА СФДокументыДокументОплаты.СводнаяСправка
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СводнаяСправка,
	|	ЗаписиКнигиПродаж.Организация КАК Организация,
	|	ЕСТЬNULL(СФДокументыСчетФактура.ЭтоРозничнаяПродажа, СФДокументыДокументОплаты.ЭтоРозничнаяПродажа) КАК ЭтоРозничнаяПродажа,
	|	ЕСТЬNULL(СФДокументыСчетФактура.ОбрабатыватьНомерДокумента, СФДокументыДокументОплаты.ОбрабатыватьНомерДокумента) КАК ОбрабатыватьНомерДокумента
	|ПОМЕСТИТЬ ВТ_ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ЗаписиКнигиПродаж КАК ЗаписиКнигиПродаж
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыПромежуточная КАК СФДокументыСчетФактура
	|		ПО ЗаписиКнигиПродаж.СчетФактура = СФДокументыСчетФактура.СчетФактура
	|			И (ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре = ЕСТЬNULL(СФДокументыСчетФактура.Контрагент, ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре))
	|			И ЗаписиКнигиПродаж.ДоговорАванса = СФДокументыСчетФактура.ДоговорАванса
	|			И ЗаписиКнигиПродаж.СтавкаНДС_Аванс = СФДокументыСчетФактура.СтавкаНДСАванса
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыПромежуточная КАК СФДокументыДокументОплаты
	|		ПО ЗаписиКнигиПродаж.ДокументОплаты = СФДокументыДокументОплаты.СчетФактура
	|			И (ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре = ЕСТЬNULL(СФДокументыДокументОплаты.Контрагент, ЗаписиКнигиПродаж.КонтрагентПоСчетуФактуре))
	|			И ЗаписиКнигиПродаж.ДоговорАванса = СФДокументыДокументОплаты.ДоговорАванса
	|			И ЗаписиКнигиПродаж.СтавкаНДС_Аванс = СФДокументыДокументОплаты.СтавкаНДСАванса
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО ЗаписиКнигиПродаж.СчетФактура = ДанныеПервичныхДокументов.Документ
	|			И ЗаписиКнигиПродаж.Организация = ДанныеПервичныхДокументов.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактураДокумент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_СчетаФактурыПромежуточная
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ СписокДокументовОснований
	|";
	
	// Получаем дополнительную информацию из журнала учета счетов-фактур.
	ТекстЗапроса = ТекстЗапроса + ОбщегоНазначения.РазделительПакетаЗапросов() +
	"ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактур.Регистратор КАК Регистратор,
	|	ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактур.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировки,
	|	ЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировки,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА """"
	|		КОГДА ЖурналУчетаСчетовФактур.Контрагент <> ЖурналУчетаСчетовФактур.Организация
	|			ТОГДА ЖурналУчетаСчетовФактур.КППКонтрагента
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК КППКонтрагента,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураКомиссионеру
	|				И ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураКомиссионеру).Сводный
	|			ТОГДА ЖурналУчетаСчетовФактур.ИндексСтроки
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.НомерСтроки
	|	КОНЕЦ КАК НомерСтроки,
	|	ЖурналУчетаСчетовФактур.КодВидаОперации КАК КодВидаОперации,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Валюта <> &ВалютаРегУчета
	|			ТОГДА ЖурналУчетаСчетовФактур.Валюта.НаименованиеПолное
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ВалютаНаименование,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.Валюта <> &ВалютаРегУчета
	|			ТОГДА ЖурналУчетаСчетовФактур.Валюта.Код
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ВалютаКод,
	|	ЖурналУчетаСчетовФактур.Валюта.Наименование КАК ВалютаНаименованиеКраткое,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученныйНалоговыйАгент
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученныйНалоговыйАгент).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение + ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданный И ЖурналУчетаСчетовФактур.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураВыданный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураВыданный).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СводнаяСправкаНДС
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СводнаяСправкаНДС).Корректировочная
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданныйАванс
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураВыданныйАванс).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		КОГДА ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураПолученныйАванс
	|			ТОГДА ВЫБОР
	|					КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактур.СчетФактура КАК Документ.СчетФактураПолученныйАванс).Корректировочный
	|						ТОГДА ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре
	|	КОНЕЦ КАК ВсегоПродажВВалюте,
	|	ЖурналУчетаСчетовФактур.Посредник КАК ПосредникСсылка,
	|	ЖурналУчетаСчетовФактур.Валюта КАК Валюта,
	|	ЖурналУчетаСчетовФактур.Организация КАК Организация
	|ПОМЕСТИТЬ ВТ_РегистрацияСчетовФактур
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур КАК ЖурналУчетаСчетовФактур
	|ГДЕ
	|	ЖурналУчетаСчетовФактур.СчетФактура В
	|			(ВЫБРАТЬ
	|				ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент
	|			ИЗ
	|				ВТ_ТаблицаСчетаФактурыДокументы)
	|	И ЖурналУчетаСчетовФактур.Организация В(&Организация)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_РегистрацияСчетовФактур.СчетФактура КАК СчетФактура,
	|	ВТ_РегистрацияСчетовФактур.Организация КАК Организация,
	|	СУММА(ВТ_РегистрацияСчетовФактур.ВсегоПродажВВалюте) КАК ВсегоПродажВВалюте
	|ПОМЕСТИТЬ СуммыПродажПоСчетамФактурам
	|ИЗ
	|	ВТ_РегистрацияСчетовФактур КАК ВТ_РегистрацияСчетовФактур
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_РегистрацияСчетовФактур.СчетФактура,
	|	ВТ_РегистрацияСчетовФактур.Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура,
	|	Организация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ КАК ДатаСчетаФактуры,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.НомерСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры)
	|	КОНЕЦ КАК НомерСчетаФактуры,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент ССЫЛКА Документ.ЗаписьКнигиПродаж
	|			И ВЫРАЗИТЬ(ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент КАК Документ.ЗаписьКнигиПродаж).ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеПрочегоНачисленияНДС)
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры
	|		ИНАЧЕ ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|	КОНЕЦ КАК ДатаИсправления,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА """"
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент ССЫЛКА Документ.ЗаписьКнигиПродаж
	|			И ВЫРАЗИТЬ(ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент КАК Документ.ЗаписьКнигиПродаж).ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеПрочегоНачисленияНДС)
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры
	|		ИНАЧЕ ВТ_РегистрацияСчетовФактур.НомерИсправления
	|	КОНЕЦ КАК НомерИсправления,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры
	|	КОНЕЦ КАК НомерСчетаФактурыСортировка,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|						ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|					КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|						ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|				КОНЕЦ
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправления, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ КАК ДатаСчетаФактурыСортировка,
	|	ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировки,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправленияКорректировки КАК НомерИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки КАК ДатаИсправленияКорректировки,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.КодВидаОперации, ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации) КАК КодВидаОперации,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СчетФактура КАК СчетФактура,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.СчетФактура, ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент) КАК СчетФактураДокумент,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДоговорАванса КАК ДоговорАванса,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СтавкаНДСАванса КАК СтавкаНДСАванса,
	|	ВЫБОР
	|		КОГДА ВТ_РегистрацияСчетовФактур.СчетФактура ЕСТЬ NULL 
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ОбрабатыватьНомерДокумента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.НачислениеПоОказаниюУслуг КАК НачислениеПоОказаниюУслуг,
	|	ВТ_РегистрацияСчетовФактур.КППКонтрагента КАК КППКонтрагента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре КАК КонтрагентПоСчетуФактуре,
	|	ВТ_РегистрацияСчетовФактур.ПосредникСсылка КАК ПосредникСсылка,
	|	СуммыПродажПоСчетамФактурам.ВсегоПродажВВалюте КАК ВсегоПродажВВалюте,
	|	ВТ_РегистрацияСчетовФактур.ВалютаКод КАК ВалютаКод,
	|	ВТ_РегистрацияСчетовФактур.Валюта КАК Валюта,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименование КАК ВалютаНаименование,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименованиеКраткое КАК ВалютаНаименованиеКраткое,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводнаяСправка КАК СводнаяСправка,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ЭтоРозничнаяПродажа
	|ПОМЕСТИТЬ ТаблицаСчетаФактурыДокументы
	|ИЗ
	|	ВТ_ТаблицаСчетаФактурыДокументы КАК ВТ_ТаблицаСчетаФактурыДокументы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_РегистрацияСчетовФактур КАК ВТ_РегистрацияСчетовФактур
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = ВТ_РегистрацияСчетовФактур.СчетФактура
	|			И (НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|					И НЕ ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный
	|				ИЛИ ВТ_ТаблицаСчетаФактурыДокументы.НомерСтроки = ВТ_РегистрацияСчетовФактур.НомерСтроки)
	|		ЛЕВОЕ СОЕДИНЕНИЕ СуммыПродажПоСчетамФактурам КАК СуммыПродажПоСчетамФактурам
	|		ПО ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент = СуммыПродажПоСчетамФактурам.СчетФактура
	|			И ВТ_ТаблицаСчетаФактурыДокументы.Организация = СуммыПродажПоСчетамФактурам.Организация
	|
	|СГРУППИРОВАТЬ ПО
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.НомерСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент ССЫЛКА Документ.ЗаписьКнигиПродаж
	|			И ВЫРАЗИТЬ(ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент КАК Документ.ЗаписьКнигиПродаж).ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеПрочегоНачисленияНДС)
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры
	|		ИНАЧЕ ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА """"
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент ССЫЛКА Документ.ЗаписьКнигиПродаж
	|			И ВЫРАЗИТЬ(ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент КАК Документ.ЗаписьКнигиПродаж).ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ИсправлениеПрочегоНачисленияНДС)
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.НомерСчетаФактуры
	|		ИНАЧЕ ВТ_РегистрацияСчетовФактур.НомерИсправления
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|						ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|					КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|						ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|				КОНЕЦ
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаИсправления, ДАТАВРЕМЯ(1, 1, 1)) <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВТ_РегистрацияСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.ДатаСчетаФактуры, ВТ_ТаблицаСчетаФактурыДокументы.ДатаСчетаФактуры)
	|	КОНЕЦ,
	|	ВТ_РегистрацияСчетовФактур.НомерКорректировочногоСчетаФактуры,
	|	ВТ_РегистрацияСчетовФактур.ДатаКорректировочногоСчетаФактуры,
	|	ВТ_РегистрацияСчетовФактур.НомерИсправленияКорректировки,
	|	ВТ_РегистрацияСчетовФактур.ДатаИсправленияКорректировки,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.КодВидаОперации, ВТ_ТаблицаСчетаФактурыДокументы.КодВидаОперации),
	|	ВТ_ТаблицаСчетаФактурыДокументы.СчетФактура,
	|	ЕСТЬNULL(ВТ_РегистрацияСчетовФактур.СчетФактура, ВТ_ТаблицаСчетаФактурыДокументы.СчетФактураДокумент),
	|	ВТ_ТаблицаСчетаФактурыДокументы.ДоговорАванса,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СтавкаНДСАванса,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКорректировочный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводныйКомиссионный,
	|	ВТ_ТаблицаСчетаФактурыДокументы.НачислениеПоОказаниюУслуг,
	|	ВТ_РегистрацияСчетовФактур.КППКонтрагента,
	|	ВТ_ТаблицаСчетаФактурыДокументы.КонтрагентПоСчетуФактуре,
	|	ВТ_РегистрацияСчетовФактур.ПосредникСсылка,
	|	СуммыПродажПоСчетамФактурам.ВсегоПродажВВалюте,
	|	ВТ_РегистрацияСчетовФактур.ВалютаКод,
	|	ВТ_РегистрацияСчетовФактур.Валюта,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименование,
	|	ВТ_РегистрацияСчетовФактур.ВалютаНаименованиеКраткое,
	|	ВТ_ТаблицаСчетаФактурыДокументы.СводнаяСправка,
	|	ВЫБОР
	|		КОГДА ВТ_РегистрацияСчетовФактур.СчетФактура ЕСТЬ NULL 
	|			ТОГДА ВТ_ТаблицаСчетаФактурыДокументы.ОбрабатыватьНомерДокумента
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВТ_ТаблицаСчетаФактурыДокументы.ЭтоРозничнаяПродажа
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура,
	|	ДоговорАванса,
	|	СтавкаНДСАванса,
	|	КонтрагентПоСчетуФактуре
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ СуммыПродажПоСчетамФактурам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_РегистрацияСчетовФактур
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ТаблицаСчетаФактурыДокументы
	|"
	+ ОбщегоНазначения.РазделительПакетаЗапросов();
	
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

//++ НЕ УТ

#Область УчетНДСФормированиеОтчетности

Функция ТекстЗапросаРаздел4_6_ФормированиеОтчетности() Экспорт
	
	ТекстЗапросаНеподтвержденныеРеализации0 = УчетНДСПереопределяемый.ТекстЗапросаНеподтвержденныеРеализации0();
	
	Возврат 
	"ВЫБРАТЬ
	|	НДСЗаписиКнигиПродаж.Организация,
	|	НДСЗаписиКнигиПродаж.СчетФактура КАК СчетФактура,
	|	СУММА(НДСЗаписиКнигиПродаж.СуммаБезНДС) КАК ПодтвержденнаяНалоговаяБаза,
	|	СУММА(НДСЗаписиКнигиПродаж.НДС) КАК НДС,
	|	НДСЗаписиКнигиПродаж.ВидДеятельностиНДС КАК ВидДеятельностиНДС
	|ПОМЕСТИТЬ НалоговаяБазаПоОтгрузкамПредварительная
	|ИЗ
	|	РегистрНакопления.НДСЗаписиКнигиПродаж КАК НДСЗаписиКнигиПродаж
	|ГДЕ
	|	НДСЗаписиКнигиПродаж.Организация В(&Организация)
	|	И НДСЗаписиКнигиПродаж.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И НЕ НДСЗаписиКнигиПродаж.ЗаписьДополнительногоЛиста
	|	И НДСЗаписиКнигиПродаж.Событие = &СобытиеНачисление
	|	И НДСЗаписиКнигиПродаж.Активность
	|
	|СГРУППИРОВАТЬ ПО
	|	НДСЗаписиКнигиПродаж.Организация,
	|	НДСЗаписиКнигиПродаж.СчетФактура,
	|	НДСЗаписиКнигиПродаж.ВидДеятельностиНДС
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НДСЗаписиКнигиПродаж.Организация,
	|	НДСЗаписиКнигиПродаж.СчетФактура,
	|	СУММА(НДСЗаписиКнигиПродаж.СуммаБезНДС),
	|	СУММА(НДСЗаписиКнигиПродаж.НДС),
	|	НДСЗаписиКнигиПродаж.ВидДеятельностиНДС
	|ИЗ
	|	РегистрНакопления.НДСЗаписиКнигиПродаж КАК НДСЗаписиКнигиПродаж
	|ГДЕ
	|	&СУчетомКорректировок
	|	И НДСЗаписиКнигиПродаж.Организация В(&Организация)
	|	И НДСЗаписиКнигиПродаж.Период МЕЖДУ &НачалоПериода И &КонецПериодаУчитываемыхКорректировок
	|	И НДСЗаписиКнигиПродаж.Событие = &СобытиеНачисление
	|	И НДСЗаписиКнигиПродаж.Активность
	|	И НДСЗаписиКнигиПродаж.ЗаписьДополнительногоЛиста
	|	И НДСЗаписиКнигиПродаж.КорректируемыйПериод МЕЖДУ &НачалоПериода И &КонецПериода
	|
	|СГРУППИРОВАТЬ ПО
	|	НДСЗаписиКнигиПродаж.Организация,
	|	НДСЗаписиКнигиПродаж.СчетФактура,
	|	НДСЗаписиКнигиПродаж.ВидДеятельностиНДС
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	НДСЗаписиКнигиПродаж.Организация,
	|	НДСЗаписиКнигиПродаж.СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	НалоговаяБазаПоОтгрузкам.СчетФактура,
	|	НалоговаяБазаПоОтгрузкам.ДокументОтгрузки
	|ПОМЕСТИТЬ ДокументыОтгрузки
	|ИЗ
	|	(" + ТекстЗапросаНеподтвержденныеРеализации0 + ") КАК НалоговаяБазаПоОтгрузкам
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	НалоговаяБазаПоОтгрузкам.СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НалоговаяБазаПоОтгрузкам.Организация,
	|	ЕСТЬNULL(ДокументыОтгрузки.ДокументОтгрузки, НалоговаяБазаПоОтгрузкам.СчетФактура) КАК ДокументОтгрузки,
	|	НалоговаяБазаПоОтгрузкам.ПодтвержденнаяНалоговаяБаза,
	|	НалоговаяБазаПоОтгрузкам.НДС,
	|	НалоговаяБазаПоОтгрузкам.ВидДеятельностиНДС
	|ПОМЕСТИТЬ НалоговаяБазаПоОтгрузкам
	|ИЗ
	|	НалоговаяБазаПоОтгрузкамПредварительная КАК НалоговаяБазаПоОтгрузкам
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДокументыОтгрузки КАК ДокументыОтгрузки
	|		ПО НалоговаяБазаПоОтгрузкам.СчетФактура = ДокументыОтгрузки.СчетФактура
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	НалоговаяБазаПоОтгрузкам.Организация,
	|	ЕСТЬNULL(ДокументыОтгрузки.ДокументОтгрузки, НалоговаяБазаПоОтгрузкам.СчетФактура)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НалоговаяБаза.Организация КАК Организация,
	|	НалоговаяБаза.ДокументОтгрузки КАК ДокументОтгрузки,
	|	НалоговаяБаза.ПодтвержденнаяНалоговаяБаза,
	|	НалоговаяБаза.НДС КАК НачислениеНДС,
	|	0 КАК ВычетНДС,
	|	НалоговаяБаза.ВидДеятельностиНДС КАК ВидДеятельностиНДС
	|ПОМЕСТИТЬ НалоговаяБазаИВычетПоОтгрузкам
	|ИЗ
	|	НалоговаяБазаПоОтгрузкам КАК НалоговаяБаза
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НДСЗаписиКнигиПокупок.Организация,
	|	НДСЗаписиКнигиПокупок.ДокументОтгрузки,
	|	0,
	|	0,
	|	НДСЗаписиКнигиПокупок.НДС,
	|	НДСЗаписиКнигиПокупок.ВидДеятельностиНДС
	|ИЗ
	|	РегистрНакопления.НДСЗаписиКнигиПокупок КАК НДСЗаписиКнигиПокупок
	|ГДЕ
	|	НДСЗаписиКнигиПокупок.Организация В(&Организация)
	|	И НЕ НДСЗаписиКнигиПокупок.ЗаписьДополнительногоЛиста
	|	И НДСЗаписиКнигиПокупок.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И НДСЗаписиКнигиПокупок.Событие = &СобытиеВычет
	|	И НДСЗаписиКнигиПокупок.Активность
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НДСЗаписиКнигиПокупок.Организация,
	|	НДСЗаписиКнигиПокупок.ДокументОтгрузки,
	|	0,
	|	0,
	|	НДСЗаписиКнигиПокупок.НДС,
	|	НДСЗаписиКнигиПокупок.ВидДеятельностиНДС
	|ИЗ
	|	РегистрНакопления.НДСЗаписиКнигиПокупок КАК НДСЗаписиКнигиПокупок
	|ГДЕ
	|	&СУчетомКорректировок
	|	И НДСЗаписиКнигиПокупок.Организация В(&Организация)
	|	И НДСЗаписиКнигиПокупок.ЗаписьДополнительногоЛиста
	|	И НДСЗаписиКнигиПокупок.Период МЕЖДУ &НачалоПериода И &КонецПериодаУчитываемыхКорректировок
	|	И НДСЗаписиКнигиПокупок.КорректируемыйПериод МЕЖДУ &НачалоПериода И &КонецПериода
	|	И НДСЗаписиКнигиПокупок.Событие = &СобытиеВычет
	|	И НДСЗаписиКнигиПокупок.Активность
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Организация,
	|	ДокументОтгрузки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ТаможенныеДекларацииПоЭкспорту.ДокументОтгрузки,
	|	ТаможенныеДекларацииПоЭкспорту.Организация,
	|	ТаможенныеДекларацииПоЭкспорту.КодОперации
	|ПОМЕСТИТЬ СведенияТаможенныхДекларацийЭкспорт
	|ИЗ
	|	РегистрСведений.СведенияТаможенныхДекларацийЭкспорт КАК ТаможенныеДекларацииПоЭкспорту
	|ГДЕ
	|	ТаможенныеДекларацииПоЭкспорту.Организация В(&Организация)
	|	И ТаможенныеДекларацииПоЭкспорту.ДокументОтгрузки В
	|			(ВЫБРАТЬ
	|				НалоговаяБазаИВычетПоОтгрузкам.ДокументОтгрузки
	|			ИЗ
	|				НалоговаяБазаИВычетПоОтгрузкам)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ТаможенныеДекларацииПоЭкспорту.Организация,
	|	ТаможенныеДекларацииПоЭкспорту.ДокументОтгрузки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НалоговаяБазаИВычетПоОтгрузкам.ПодтвержденнаяНалоговаяБаза КАК ПодтвержденнаяНалоговаяБаза,
	|	НалоговаяБазаИВычетПоОтгрузкам.НачислениеНДС КАК НачислениеНДС,
	|	НалоговаяБазаИВычетПоОтгрузкам.ВычетНДС КАК ВычетНДС,
	|	ВЫБОР
	|		КОГДА НалоговаяБазаИВычетПоОтгрузкам.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.Космос)
	|			ТОГДА ""1010409""
	|			ИНАЧЕ ЕСТЬNULL(СведенияТаможенныхДекларацийЭкспорт.КодОперации, &КодОперацииПоУмолчанию)
	|	КОНЕЦ КАК КодОперации
	|ПОМЕСТИТЬ НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций
	|ИЗ
	|	НалоговаяБазаИВычетПоОтгрузкам КАК НалоговаяБазаИВычетПоОтгрузкам
	|		ЛЕВОЕ СОЕДИНЕНИЕ СведенияТаможенныхДекларацийЭкспорт КАК СведенияТаможенныхДекларацийЭкспорт
	|		ПО НалоговаяБазаИВычетПоОтгрузкам.ДокументОтгрузки = СведенияТаможенныхДекларацийЭкспорт.ДокументОтгрузки
	|			И НалоговаяБазаИВычетПоОтгрузкам.Организация = СведенияТаможенныхДекларацийЭкспорт.Организация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций.ПодтвержденнаяНалоговаяБаза) КАК ПодтвержденнаяНалоговаяБаза,
	|	СУММА(НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций.НачислениеНДС) КАК НачислениеНДС,
	|	СУММА(НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций.ВычетНДС) КАК ВычетНДС,
	|	НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций.КодОперации
	|ИЗ
	|	НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций КАК НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций
	|
	|СГРУППИРОВАТЬ ПО
	|	НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций.КодОперации
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ НалоговаяБазаПоОтгрузкамПредварительная
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ДокументыОтгрузки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ НалоговаяБазаПоОтгрузкам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ НалоговаяБазаИВычетПоОтгрузкам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ СведенияТаможенныхДекларацийЭкспорт
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ НалоговаяБазаИВычетПоОтгрузкамПоКодамОпераций";
	
КонецФункции

Функция ДополнитьТекстЗапросаНачислениеНДСПоЗаявлениямОВвозе() Экспорт
	
	Возврат 
	"
	|;
	|
	|/////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(ХозрасчетныйОбороты.СуммаОборотКт) КАК ЧИСЛО(15, 0)), 0) - ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(ВЫБОР
	|				КОГДА ТИПЗНАЧЕНИЯ(ХозрасчетныйОбороты.Субконто2) = ТИП(Справочник.ДоговорыКонтрагентов)
	|						И ВЫРАЗИТЬ(ХозрасчетныйОбороты.Субконто2 КАК Справочник.ДоговорыКонтрагентов).ТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС)
	|					ТОГДА ЕСТЬNULL(ХозрасчетныйОбороты.СуммаОборотКт, 0)
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК ЧИСЛО(15, 0)), 0) - ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(ВЫБОР
	|				КОГДА ТИПЗНАЧЕНИЯ(ХозрасчетныйОбороты.Субконто2) = ТИП(Справочник.ДоговорыАренды)
	|						И ВЫРАЗИТЬ(ХозрасчетныйОбороты.Субконто2 КАК Справочник.ДоговорыАренды).ТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоровАренды.Лизинг)
	|					ТОГДА ЕСТЬNULL(ХозрасчетныйОбороты.СуммаОборотКт, 0)
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК ЧИСЛО(15, 0)), 0) КАК СуммаНДС,
	|	ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(ВЫБОР
	|				КОГДА ТИПЗНАЧЕНИЯ(ХозрасчетныйОбороты.Субконто2) = ТИП(Справочник.ДоговорыКонтрагентов)
	|						И ВЫРАЗИТЬ(ХозрасчетныйОбороты.Субконто2 КАК Справочник.ДоговорыКонтрагентов).ТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС)
	|					ТОГДА ЕСТЬNULL(ХозрасчетныйОбороты.СуммаОборотКт, 0)
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК ЧИСЛО(15, 0)), 0) КАК СуммаНДСУслугПереработки,
	|	ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(ВЫБОР
	|				КОГДА ТИПЗНАЧЕНИЯ(ХозрасчетныйОбороты.Субконто2) = ТИП(Справочник.ДоговорыАренды)
	|						И ВЫРАЗИТЬ(ХозрасчетныйОбороты.Субконто2 КАК Справочник.ДоговорыАренды).ТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоровАренды.Лизинг)
	|					ТОГДА ЕСТЬNULL(ХозрасчетныйОбороты.СуммаОборотКт, 0)
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК ЧИСЛО(15, 0)), 0) КАК СуммаНДСПредметовЛизинга
	|ИЗ
	|	РегистрБухгалтерии.Хозрасчетный.Обороты(
	|			,
	|			&ДатаПодписиДекларации,
	|			,
	|			Счет = &Счет6842,
	|			&ВидыСубконто6842,
	|			Организация = &Организация
	|				И Субконто3 В
	|					(ВЫБРАТЬ
	|						ДекларируемыеЗаявления.ЗаявлениеОВвозе
	|					ИЗ
	|						ДекларируемыеЗаявления),
	|			,
	|			) КАК ХозрасчетныйОбороты";
	
КонецФункции

Процедура ДополнитьОтчетКосвенныеНалогиПриИмпортеФормаОтчета2017Кв4(Раздел1, СтрокаНачислений) Экспорт 
	
	Раздел1.П000010003203 = СтрокаНачислений.СуммаНДСУслугПереработки;
	Раздел1.П000010003503 = СтрокаНачислений.СуммаНДСПредметовЛизинга;
	
КонецПроцедуры

#КонецОбласти 

//-- НЕ УТ

#КонецОбласти


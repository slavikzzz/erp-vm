// АПК:142-выкл 
// АПК:134-выкл 

#Область СлужебныеПроцедурыИФункции

#Область АлгоритмыПрошлыхЛет

// Отчетность.

Процедура ОписаниеПоказателей_6НДФЛ_2016Кв1(ПоказателиОтчета) Экспорт
	
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010001001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002501", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010004001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010004501", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010005001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010006001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010007001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010008001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010009001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014001", Истина, Истина);
	
КонецПроцедуры

Процедура ЗначенияПоказателей_6НДФЛ_2016Кв1(ПараметрыОтчета, Контейнер) Экспорт
	
	ДатаКонцаПериодаОтчета = ПараметрыОтчета.ДатаКонцаПериодаОтчета;
	Организация = ПараметрыОтчета.Организация;
	НачалоПериода = НачалоГода(ДатаКонцаПериодаОтчета);
	ОкончаниеПериода = КонецМесяца(ДатаКонцаПериодаОтчета);
	РегистрацияВНалоговомОргане = ПараметрыОтчета.РегистрацииВНО;
	НомерКорректировки = 0;
	Если ПараметрыОтчета.Свойство("НомерКорректировки") Тогда
		НомерКорректировки = ПараметрыОтчета.НомерКорректировки;
	КонецЕсли;
	
	// очищаем разделы
	ПоказателиОтчета = Новый Структура;
	ОписаниеПоказателей_6НДФЛ_2016Кв1(ПоказателиОтчета);
	
	ДанныеРаздела1 = Контейнер.Раздел1;
	Значение = Неопределено;
	Для каждого КлючИЗначение Из ДанныеРаздела1 Цикл
		Если ПоказателиОтчета.Свойство(КлючИЗначение.Ключ, Значение) Тогда
			ДанныеРаздела1[КлючИЗначение.Ключ] = 0
		КонецЕсли;
	КонецЦикла;
	Контейнер.Раздел1_ДанныеДопСтрок.Очистить();
	Контейнер.Раздел2_ДанныеДопСтрок.Очистить();
	 
	ОписаниеТаблиц = Новый Структура("КоличествоПолучателейДохода, Раздел1Доходы, Раздел1Вычеты, Раздел1Налоги, Раздел2");
	Если ОкончаниеПериода < '20170101' Тогда
		РасчетПоказателей_6НДФЛ_2016Кв1(НачалоПериода, ОкончаниеПериода, ?(ПараметрыОтчета.ДатаПодписи > ОкончаниеПериода,ПараметрыОтчета.ДатаПодписи, ОкончаниеПериода), Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц);	
	Иначе
		РасчетПоказателей_6НДФЛ_2017Кв1(НачалоПериода, ОкончаниеПериода, ?(ПараметрыОтчета.ДатаПодписи > ОкончаниеПериода,ПараметрыОтчета.ДатаПодписи, ОкончаниеПериода), Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, Ложь, НомерКорректировки);	
	КонецЕсли;
	
	// -------------------------------------------------------------------------------
	// Вывод данных в отчет
	
	// Раздел 1
	
	Результат = ОписаниеТаблиц.КоличествоПолучателейДохода;
	Если Результат.Количество() > 0 Тогда
		ЗаполнитьЗначенияСвойств(ДанныеРаздела1,Результат[0]);
	КонецЕсли;
	РезультатРаздел1Налоги = ОписаниеТаблиц.Раздел1Налоги;
	
	ВременнаяТаблица = Контейнер.Раздел1_ДанныеДопСтрок.СкопироватьКолонки();
	Для каждого СтрокаДанных Из ОписаниеТаблиц.Раздел1Доходы Цикл
		ЗаполнитьЗначенияСвойств(ВременнаяТаблица.Добавить(), СтрокаДанных);
	КонецЦикла;
	Для каждого СтрокаДанных Из ОписаниеТаблиц.Раздел1Вычеты Цикл
		ЗаполнитьЗначенияСвойств(ВременнаяТаблица.Добавить(), СтрокаДанных);
	КонецЦикла;
	Для каждого СтрокаДанных Из РезультатРаздел1Налоги Цикл
		ЗаполнитьЗначенияСвойств(ВременнаяТаблица.Добавить(), СтрокаДанных);
	КонецЦикла;
	
	РезультатРаздел1Налоги.Свернуть(,"П000010007001,П000010008001,П000010009001");
	Если РезультатРаздел1Налоги.Количество() > 0 Тогда
		ЗаполнитьЗначенияСвойств(ДанныеРаздела1, РезультатРаздел1Налоги[0]);
	КонецЕсли;
	
	ВременнаяТаблица.Свернуть("П000010001001","П000010002001,П000010002501,П000010003001,П000010004001,П000010004501,П000010005001");
	ВременнаяТаблица.Сортировать("П000010001001");
	ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВременнаяТаблица, Контейнер.Раздел1_ДанныеДопСтрок);
	
	// Раздел 2
	
	Для каждого СтрокаДанных Из ОписаниеТаблиц.Раздел2 Цикл
		ЗаполнитьЗначенияСвойств(Контейнер.Раздел2_ДанныеДопСтрок.Добавить(), СтрокаДанных);
	КонецЦикла;
	
КонецПроцедуры

Процедура РасчетПоказателей_6НДФЛ_2016Кв1(НачалоПериода, ОкончаниеПериода, ДатаПодписи, Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, ПодробныеДанные = Ложь) Экспорт
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("НачалоПредыдущегоГода", ДобавитьМесяц(НачалоПериода, -12));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("ДатаПодписи", ДатаПодписи);
	Запрос.УстановитьПараметр("ОкончаниеПериодаОсмотраДоходовВычетов", ?(КонецГода(ОкончаниеПериода) = ОкончаниеПериода, Макс(ДатаПодписи, ОкончаниеПериода), ОкончаниеПериода));
	
	Если ОписаниеТаблиц.Свойство("Раздел1Доходы") Или ОписаниеТаблиц.Свойство("Раздел1Вычеты") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
		
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление,
		|	СведенияОДоходахНДФЛ.КодВычета,
		|	СведенияОДоходахНДФЛ.СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
		|ПОМЕСТИТЬ ВТДоходы
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И СведенияОДоходахНДФЛ.Организация = &Организация
		|	И (СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|			ИЛИ СведенияОДоходахНДФЛ.СуммаВычета <> 0)";
		Запрос.Выполнить();
		
		СоздатьВТСтавкаНДФЛПоСтавкеРезидента2016(Запрос.МенеджерВременныхТаблиц, "ВТДоходы", "УчитыватьИзмененияСтатусаДляОтчетности", Месяц(ОкончаниеПериода));
		
		Если ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0) КАК П000010006001
			|ИЗ
			|	ВТДоходы КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаДохода <> 0
			|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
			|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))";
			
			ОписаниеТаблиц.КоличествоПолучателейДохода = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
	
		Если ОписаниеТаблиц.Свойство("Раздел1Доходы") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодДохода,
			|	СведенияОДоходахНДФЛ.Начисление,
			|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.СуммаДохода,
			|	ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
			|			ТОГДА СведенияОДоходахНДФЛ.СуммаДохода
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК СуммаДивидендов
			|ПОМЕСТИТЬ ВТДоходыПоСтавкам
			|ИЗ
			|	ВТДоходы КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаДохода <> 0
			|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
			|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))";
			Запрос.Выполнить();
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодДохода,
			|	СведенияОДоходах.Начисление,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога КАК П000010001001,
			|	СведенияОДоходах.СтавкаНалога,
			|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000010002001,
			|	СУММА(СведенияОДоходах.СуммаДивидендов) КАК П000010002501
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодДохода,
			|	СведенияОДоходах.Начисление,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога";
			
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
				МассивПолей.Добавить("КодДохода");
				МассивПолей.Добавить("Начисление");
				МассивПолей.Добавить("Регистратор");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
			ОписаниеТаблиц.Раздел1Доходы = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел1Вычеты") Тогда
			
			Запрос.УстановитьПараметр("ГодПериода", Год(ОкончаниеПериода));
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодВычета,
			|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.СуммаВычета
			|ПОМЕСТИТЬ ВТВычетыПоСтавкам
			|ИЗ
			|	ВТДоходы КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаВычета <> 0
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
			|	13,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма
			|ИЗ
			|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
			|ГДЕ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Организация = &Организация
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма <> 0
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ИмущественныеВычетыНДФЛ.Регистратор,
			|	ИмущественныеВычетыНДФЛ.ФизическоеЛицо,
			|	ИмущественныеВычетыНДФЛ.КодВычета,
			|	13,
			|	ИмущественныеВычетыНДФЛ.Сумма
			|ИЗ
			|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
			|ГДЕ
			|	ИмущественныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
			|	И ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|	И ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
			|	И ИмущественныеВычетыНДФЛ.Организация = &Организация
			|	И ИмущественныеВычетыНДФЛ.Сумма <> 0
			|	И ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
			|	И ИмущественныеВычетыНДФЛ.Год = &ГодПериода";
			Запрос.Выполнить();
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодВычета,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога КАК П000010001001,
			|	СведенияОДоходах.СтавкаНалога,
			|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000010003001
			|ИЗ
			|	ВТВычетыПоСтавкам КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодВычета,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога";
			
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
				МассивПолей.Добавить("КодВычета");
				МассивПолей.Добавить("Регистратор");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
			ОписаниеТаблиц.Раздел1Вычеты = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Или ОписаниеТаблиц.Свойство("Раздел2") Тогда
		
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КодДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.УчитыватьВыплаченныйДоходВ6НДФЛ
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.УчитыватьВыплаченныйДоходВ6НДФЛ
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода <> 0)";
		Запрос.Выполнить();
		
		Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Тогда
			
			СоздатьВТСтавкаНДФЛПоСтавкеРезидента2016(Запрос.МенеджерВременныхТаблиц, "ВТНалоги", "УчитыватьИзмененияСтатусаДляОтчетности", Месяц(ОкончаниеПериода));
			
			Запрос.УстановитьПараметр("ДатаПервогоОтчетногоПериода", '20160101');
			Запрос.Текст =
			"ВЫБРАТЬ
			|	НДФЛ.ФизическоеЛицо,
			|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Начислено,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК НачисленоПоДивидендам,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК ЗачтеноАвансов,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаПолученияДохода >= &ДатаПервогоОтчетногоПериода
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Удержано,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА НДФЛ.Сумма
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|			ТОГДА -НДФЛ.Сумма
			|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
			|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА -НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Сальдо,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
			|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|			ТОГДА -НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Возвращено
			|ПОМЕСТИТЬ ВТНалогиПоСтавкам
			|ИЗ
			|	ВТНалоги КАК НДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И НДФЛ.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
			|	Налоги.СтавкаНалога КАК СтавкаНалога,
			|	СУММА(Налоги.Сальдо) КАК НеУдержано
			|ПОМЕСТИТЬ ВТНеУдержано
			|ИЗ
			|	ВТНалогиПоСтавкам КАК Налоги
			|
			|СГРУППИРОВАТЬ ПО
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога
			|
			|ИМЕЮЩИЕ
			|	СУММА(Налоги.Сальдо) > 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога,
			|	СУММА(Налоги.Начислено) КАК Начислено,
			|	СУММА(Налоги.НачисленоПоДивидендам) КАК НачисленоПоДивидендам,
			|	СУММА(Налоги.ЗачтеноАвансов) КАК ЗачтеноАвансов,
			|	СУММА(Налоги.Удержано) КАК Удержано,
			|	ЕСТЬNULL(МАКСИМУМ(ПоФизлицам.НеУдержано), 0) КАК НеУдержано,
			|	СУММА(Налоги.Возвращено) КАК Возвращено
			|ПОМЕСТИТЬ ВТДанныеПоФизЛицам
			|ИЗ
			|	ВТНалогиПоСтавкам КАК Налоги
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНеУдержано КАК ПоФизлицам
			|		ПО Налоги.ФизическоеЛицо = ПоФизлицам.ФизическоеЛицо
			|			И Налоги.СтавкаНалога = ПоФизлицам.СтавкаНалога
			|ГДЕ
			|	(Налоги.Начислено <> 0
			|			ИЛИ Налоги.ЗачтеноАвансов <> 0
			|			ИЛИ Налоги.Удержано <> 0
			|			ИЛИ Налоги.Возвращено <> 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТСтавкаНДФЛПоСтавкеРезидента";
			Запрос.Выполнить();
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога КАК П000010001001,
			|	Налоги.СтавкаНалога,
			|	СУММА(Налоги.Начислено) КАК П000010004001,
			|	СУММА(Налоги.НачисленоПоДивидендам) КАК П000010004501,
			|	СУММА(Налоги.ЗачтеноАвансов) КАК П000010005001,
			|	СУММА(Налоги.Удержано) КАК П000010007001,
			|	СУММА(Налоги.НеУдержано) КАК П000010008001,
			|	СУММА(Налоги.Возвращено) КАК П000010009001
			|ИЗ
			|	ВТДанныеПоФизЛицам КАК Налоги
			|ГДЕ
			|	(Налоги.Начислено <> 0
			|			ИЛИ Налоги.ЗачтеноАвансов <> 0
			|			ИЛИ Налоги.Удержано <> 0
			|			ИЛИ Налоги.Возвращено <> 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога";
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "Налоги");
			ОписаниеТаблиц.Раздел1Налоги = Запрос.Выполнить().Выгрузить();
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел2") Тогда
			
			Запрос.УстановитьПараметр("НачалоОтчетногоКвартала", НачалоКвартала(ОкончаниеПериода));
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	МАКСИМУМ(ДатыУчета.ДатаПолученияДохода) КАК ПоздняяДатаПолученияДохода,
			|	МИНИМУМ(ДатыУчета.ДатаПолученияДохода) КАК РанняяДатаПолученияДохода
			|ИЗ
			|	ВТНалоги КАК ДатыУчета
			|ГДЕ
			|	ДатыУчета.ДатаУдержания <= &ОкончаниеПериода";
			Выборка = Запрос.Выполнить().Выбрать();
			РанняяДатаПолученияДохода = НачалоПериода;
			ПоздняяДатаПолученияДохода = ДобавитьМесяц(ОкончаниеПериода, 1);
			Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.РанняяДатаПолученияДохода) Тогда
				РанняяДатаПолученияДохода = Мин(РанняяДатаПолученияДохода, Выборка.РанняяДатаПолученияДохода);
				ПоздняяДатаПолученияДохода = Макс(ПоздняяДатаПолученияДохода, Выборка.ПоздняяДатаПолученияДохода);
			КонецЕсли;
			Запрос.УстановитьПараметр("РанняяДатаПолученияДохода", РанняяДатаПолученияДохода);
			Запрос.УстановитьПараметр("ПоздняяДатаПолученияДохода", ПоздняяДатаПолученияДохода);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодДохода,
			|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
			|	СведенияОДоходахНДФЛ.Период КАК ПериодРегистрации,
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
			|	СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ,
			|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
			|ПОМЕСТИТЬ ВТСтрокиДоходов
			|ИЗ
			|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &РанняяДатаПолученияДохода И &ПоздняяДатаПолученияДохода
			|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
			|	И СведенияОДоходахНДФЛ.Организация = &Организация
			|	И СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета <> 0";
			Запрос.Выполнить();

			СоздатьВТСтавкаНДФЛПоСтавкеРезидента2016(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиДоходов", "УчитыватьИзмененияСтатусаДляОтчетности", Месяц(ОкончаниеПериода));
		
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.ПериодРегистрации КАК Период,
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
			|	СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|ПОМЕСТИТЬ ВТСведенияОДоходахНДФЛ
			|ИЗ
			|	ВТСтрокиДоходов КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
			|ГДЕ
			|	(НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
			|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходахНДФЛ.Регистратор
			|ПОМЕСТИТЬ ВТРегистраторыНачислений
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВзаиморасчетыССотрудниками.Регистратор,
			|	СУММА(ВзаиморасчетыССотрудниками.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов
			|ПОМЕСТИТЬ ВТНачисленоПоРегистраторам
			|ИЗ
			|	РегистрНакопления.ВзаиморасчетыССотрудниками КАК ВзаиморасчетыССотрудниками
			|ГДЕ
			|	ВзаиморасчетыССотрудниками.Регистратор В
			|			(ВЫБРАТЬ
			|				РегистраторыНачислений.Регистратор
			|			ИЗ
			|				ВТРегистраторыНачислений КАК РегистраторыНачислений)
			|	И ВзаиморасчетыССотрудниками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|
			|СГРУППИРОВАТЬ ПО
			|	ВзаиморасчетыССотрудниками.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВзаиморасчетыССотрудниками.Регистратор,
			|	-СУММА(ВзаиморасчетыССотрудниками.Сумма) КАК Сумма
			|ПОМЕСТИТЬ ВТНДФЛПоРегистраторам
			|ИЗ
			|	ВТНалоги КАК ВзаиморасчетыССотрудниками
			|ГДЕ
			|	ВзаиморасчетыССотрудниками.Регистратор В
			|			(ВЫБРАТЬ
			|				РегистраторыНачислений.Регистратор
			|			ИЗ
			|				ВТРегистраторыНачислений КАК РегистраторыНачислений)
			|	И ВзаиморасчетыССотрудниками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|
			|СГРУППИРОВАТЬ ПО
			|	ВзаиморасчетыССотрудниками.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование,
			|	НАЧАЛОПЕРИОДА(НалогиПоДатам.ДатаУдержания, ДЕНЬ) КАК ДатаУдержания,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисления,
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.Сумма КАК Сумма,
			|	НалогиПоДатам.СуммаВыплаченногоДохода КАК СуммаВыплаченногоДохода
			|ПОМЕСТИТЬ ВТИсходныеДанныеПоДокументамОснованиям
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И &УсловиеОтбораПоДатам
			|	И НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	МАКСИМУМ(СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода) КАК ЭтоМежрасчетныйДокумент,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТОснованияНачислений
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИсходныеДанныеПоДокументамОснованиям КАК ОснованияСУдержаннымНалогом
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|			И (СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.ДокументОснование
			|				ИЛИ СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор)
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачисленоПоРегистраторам КАК НачисленоПоРегистраторам
			|		ПО СведенияОДоходахНДФЛ.Регистратор = НачисленоПоРегистраторам.Регистратор
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНДФЛПоРегистраторам КАК НДФЛПоРегистраторам
			|		ПО СведенияОДоходахНДФЛ.Регистратор = НДФЛПоРегистраторам.Регистратор
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.СуммаДохода > 0
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|	И ЕСТЬNULL(НачисленоПоРегистраторам.СуммаВзаиморасчетов, 0) <= ЕСТЬNULL(НДФЛПоРегистраторам.Сумма, 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	Основания.ФизическоеЛицо,
			|	Основания.Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиям
			|ИЗ
			|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
			|		Основания.ФизическоеЛицо КАК ФизическоеЛицо,
			|		Основания.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТОснованияНачислений КАК Основания) КАК Основания
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО Основания.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И Основания.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|
			|СГРУППИРОВАТЬ ПО
			|	Основания.ФизическоеЛицо,
			|	Основания.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ОснованияНачислений.ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор
			|ПОМЕСТИТЬ ВТОснованияСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияНачислений КАК ОснованияНачислений
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК НалогиПоДатам
			|		ПО ОснованияНачислений.ФизическоеЛицо = НалогиПоДатам.ФизическоеЛицо
			|			И (ОснованияНачислений.Регистратор = НалогиПоДатам.ДокументОснование
			|				ИЛИ ОснованияНачислений.Регистратор = НалогиПоДатам.Регистратор)
			|			И ОснованияНачислений.ДатаПолученияДохода = НалогиПоДатам.ДатаПолученияДохода
			|ГДЕ
			|	ОснованияНачислений.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияНачислений.ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				ТОГДА НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо,
			|	ОснованияСНеудержаннымНалогом.Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиямСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ОснованияСНеудержаннымНалогом.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|			И (СведенияОДоходахНДФЛ.СуммаДохода > 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МаксимальныеСуммы.ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор,
			|	МИНИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.ДатаПолученияДохода) КАК ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТДатыОснованийСНеудержаннымНалогом
			|ИЗ
			|	(ВЫБРАТЬ
			|		МАКСИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода) КАК СуммаДохода,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|	
			|	СГРУППИРОВАТЬ ПО
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор) КАК МаксимальныеСуммы
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|		ПО МаксимальныеСуммы.СуммаДохода = ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода
			|			И МаксимальныеСуммы.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|			И МаксимальныеСуммы.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|
			|СГРУППИРОВАТЬ ПО
			|	МаксимальныеСуммы.ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	ДатыОснованийСНеудержаннымНалогом.ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Регистратор
			|ПОМЕСТИТЬ ВТНатуральныеДоходы
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИсходныеДанныеПоДокументамОснованиям КАК ОснованияСУдержаннымНалогом
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.ДокументОснование
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиям КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|			ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|				И ОснованияСНеудержаннымНалогом.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДатыОснованийСНеудержаннымНалогом КАК ДатыОснованийСНеудержаннымНалогом
			|			ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДатыОснованийСНеудержаннымНалогом.ФизическоеЛицо
			|				И ОснованияСНеудержаннымНалогом.Регистратор = ДатыОснованийСНеудержаннымНалогом.Регистратор
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|	И ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|	И ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода > 0
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	ДатыОснованийСНеудержаннымНалогом.ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТДатыОснованийСНеудержаннымНалогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТДоходыПоОснованиямСНеудержаннымНалогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТОснованияСНеудержаннымНалогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТДоходыПоОснованиям
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТРегистраторыНачислений
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТНачисленоПоРегистраторам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТНДФЛПоРегистраторам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТОснованияНачислений
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	НалогиПоДатам.ДокументОснование
			|ПОМЕСТИТЬ ВТМежрасчетныеДокументыОснования
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|	И НалогиПоДатам.РасчетМежрасчетногоПериода
			|	И НалогиПоДатам.ДокументОснование <> НЕОПРЕДЕЛЕНО
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование,
			|	НАЧАЛОПЕРИОДА(НалогиПоДатам.ДатаУдержания, ДЕНЬ) КАК ДатаУдержания,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисления,
			|	СУММА(НалогиПоДатам.Сумма) КАК Сумма,
			|	МежрасчетныеДокументыОснования.ДокументОснование ЕСТЬ НЕ NULL  КАК ЭтоМежрасчетныйДокумент
			|ПОМЕСТИТЬ ВТИсходныеДанныеПоСтарымДокументамОснованиям
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМежрасчетныеДокументыОснования КАК МежрасчетныеДокументыОснования
			|		ПО НалогиПоДатам.ДокументОснование = МежрасчетныеДокументыОснования.ДокументОснование
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И &УсловиеОтбораПоДатам
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование,
			|	НАЧАЛОПЕРИОДА(НалогиПоДатам.ДатаУдержания, ДЕНЬ),
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	МежрасчетныеДокументыОснования.ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование,
			|	ВЫБОР
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 0
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 1
			|		ИНАЧЕ СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) / СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ)
			|	КОНЕЦ КАК Доля
			|ПОМЕСТИТЬ ВТДолиПолученногоДоходаПоДокументамОснованиям
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ДатаУдержания <= &ОкончаниеПериода
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДанныеУчета.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеУчета.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ДанныеУчета.ДокументОснование КАК Регистратор,
			|	ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) * ВЫБОР
			|				КОГДА ДанныеУчета.Доля > 1
			|					ТОГДА 1
			|				ИНАЧЕ ДанныеУчета.Доля
			|			КОНЕЦ КАК ЧИСЛО(15, 2)), 0) КАК СуммаДохода
			|ИЗ
			|	ВТДолиПолученногоДоходаПоДокументамОснованиям КАК ДанныеУчета
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ДанныеУчета.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ДанныеУчета.ДатаПолученияДохода = СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|			И ДанныеУчета.ДокументОснование = СведенияОДоходахНДФЛ.Регистратор
			|
			|СГРУППИРОВАТЬ ПО
			|	ДанныеУчета.ФизическоеЛицо,
			|	ДанныеУчета.ДатаПолученияДохода,
			|	ДанныеУчета.Доля,
			|	ДанныеУчета.ДокументОснование
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода,
			|	Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ИсходныеДанные.ДокументОснование КАК Регистратор,
			|	ИсходныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ИсходныеДанные.ДатаУдержания,
			|	ИсходныеДанные.СрокПеречисления,
			|	ИсходныеДанные.Сумма,
			|	0 КАК СуммаФактическиПолученногоДохода
			|ИЗ
			|	ВТИсходныеДанныеПоСтарымДокументамОснованиям КАК ИсходныеДанные
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода,
			|	Регистратор";
			Если ОкончаниеПериода < '20160701' Тогда
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода");
			Иначе
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода И НалогиПоДатам.ДатаУдержания >= ДАТАВРЕМЯ(2016, 7, 1, 0, 0, 0)");
			КонецЕсли;
			Результаты = Запрос.ВыполнитьПакет();
			ВсегоРезультатов = Результаты.Количество();
			НеОбработанныеДанные = Результаты[ВсегоРезультатов - 1].Выгрузить();
			ОбработанныеДанные = НеОбработанныеДанные.СкопироватьКолонки();
			СуммыДоходов = Результаты[ВсегоРезультатов - 2].Выгрузить();
			СтруктураПоиска = Новый Структура("ФизическоеЛицо,ДатаПолученияДохода,Регистратор");
			Для каждого СтрокаДохода Из СуммыДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаДохода);
				ВременнаяТаблица = НеОбработанныеДанные.Скопировать(НеОбработанныеДанные.НайтиСтроки(СтруктураПоиска));
				Если ВременнаяТаблица.Количество() = 0 Тогда
					Продолжить;
				КонецЕсли;
				Если ЗначениеЗаполнено(СтрокаДохода.СуммаДохода) Тогда
					Если ВременнаяТаблица.Количество() = 1 Тогда
						ВременнаяТаблица[0].СуммаФактическиПолученногоДохода = СтрокаДохода.СуммаДохода
					Иначе
						КоэффициентыРаспределения = ВременнаяТаблица.ВыгрузитьКолонку("Сумма");
						РаспределениеРесурса = ЗарплатаКадрыКлиентСервер.РаспределитьПропорциональноКоэффициентам(СтрокаДохода.СуммаДохода, КоэффициентыРаспределения);
						Если РаспределениеРесурса <> Неопределено Тогда
							ВременнаяТаблица.ЗагрузитьКолонку(РаспределениеРесурса, "СуммаФактическиПолученногоДохода");
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
				ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВременнаяТаблица, ОбработанныеДанные)
			КонецЦикла;
			Запрос.УстановитьПараметр("ОбработанныеДанные", ОбработанныеДанные); НеОбработанныеДанные = Неопределено; СуммыДоходов = Неопределено; ОбработанныеДанные = Неопределено; ВременнаяТаблица = Неопределено;
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	Данные.Регистратор,
			|	Данные.ФизическоеЛицо,
			|	Данные.ДатаПолученияДохода,
			|	Данные.ДатаУдержания,
			|	Данные.СрокПеречисления,
			|	Данные.СуммаФактическиПолученногоДохода,
			|	Данные.Сумма
			|ПОМЕСТИТЬ ВТОбработанныеДанныеПоДокументамОснованиям
			|ИЗ
			|	&ОбработанныеДанные КАК Данные
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	ВЫБОР
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 0
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 1
			|		ИНАЧЕ СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) / СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ)
			|	КОНЕЦ КАК Доля
			|ПОМЕСТИТЬ ВТДолиПолученногоДохода
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМежрасчетныеДокументыОснования КАК МежрасчетныеДокументыОснования
			|		ПО НалогиПоДатам.ДокументОснование = МежрасчетныеДокументыОснования.ДокументОснование
			|ГДЕ
			|	НалогиПоДатам.ДатаУдержания <= &ОкончаниеПериода
			|	И МежрасчетныеДокументыОснования.ДокументОснование ЕСТЬ NULL 
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ИсходныеДанные.ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода,
			|	МАКСИМУМ(ИсходныеДанные.ДатаУдержания) КАК ДатаУдержания
			|ПОМЕСТИТЬ ВТДатыУчета
			|ИЗ
			|	ВТИсходныеДанныеПоСтарымДокументамОснованиям КАК ИсходныеДанные
			|ГДЕ
			|	НЕ ИсходныеДанные.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ИсходныеДанные.ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДатыУчета.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор
			|ПОМЕСТИТЬ ВТОснованияСУдержаннымНалогом
			|ИЗ
			|	ВТДатыУчета КАК ДатыУчета
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ДатыУчета.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ДатыУчета.ДатаПолученияДохода = СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|			И (ВЫБОР
			|				КОГДА ДатыУчета.ДатаУдержания > ДатыУчета.ДатаПолученияДохода
			|					ТОГДА ДатыУчета.ДатаУдержания
			|				ИНАЧЕ ДатыУчета.ДатаПолученияДохода
			|			КОНЕЦ >= НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, ДЕНЬ))
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДолиПолученногоДохода КАК ДолиПолученногоДохода
			|		ПО ДатыУчета.ДатаПолученияДохода = ДолиПолученногоДохода.ДатаПолученияДохода
			|			И ДатыУчета.ФизическоеЛицо = ДолиПолученногоДохода.ФизическоеЛицо
			|ГДЕ
			|	НЕ СведенияОДоходахНДФЛ.Регистратор В
			|				(ВЫБРАТЬ
			|					ДанныеПоДокументамОснованиям.Регистратор
			|				ИЗ
			|					ВТОбработанныеДанныеПоДокументамОснованиям КАК ДанныеПоДокументамОснованиям
			|				ГДЕ
			|					ДанныеПоДокументамОснованиям.СуммаФактическиПолученногоДохода <> 0)
			|	И ЕСТЬNULL(ДолиПолученногоДохода.Доля, 0) <> 0
			|	И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ОбработанныеДанныеПоДокументамОснованиям.ФизическоеЛицо,
			|	ОбработанныеДанныеПоДокументамОснованиям.Регистратор
			|ИЗ
			|	ВТОбработанныеДанныеПоДокументамОснованиям КАК ОбработанныеДанныеПоДокументамОснованиям
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	МАКСИМУМ(СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода) КАК ЭтоМежрасчетныйДокумент
			|ПОМЕСТИТЬ ВТОснованияНачислений
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор
			|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ВзаиморасчетыССотрудниками КАК ВзаиморасчетыССотрудниками
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ВзаиморасчетыССотрудниками.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ВзаиморасчетыССотрудниками.Регистратор
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.СуммаДохода > 0
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|	И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|	И ВзаиморасчетыССотрудниками.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	Основания.ФизическоеЛицо,
			|	Основания.Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиям
			|ИЗ
			|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
			|		Основания.ФизическоеЛицо КАК ФизическоеЛицо,
			|		Основания.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТОснованияНачислений КАК Основания) КАК Основания
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО Основания.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И Основания.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|
			|СГРУППИРОВАТЬ ПО
			|	Основания.ФизическоеЛицо,
			|	Основания.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ОснованияНачислений.ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор
			|ПОМЕСТИТЬ ВТОснованияСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияНачислений КАК ОснованияНачислений
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК НалогиПоДатам
			|		ПО ОснованияНачислений.ФизическоеЛицо = НалогиПоДатам.ФизическоеЛицо
			|			И ОснованияНачислений.Регистратор = НалогиПоДатам.ДокументОснование
			|			И ОснованияНачислений.ДатаПолученияДохода = НалогиПоДатам.ДатаПолученияДохода
			|ГДЕ
			|	ОснованияНачислений.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияНачислений.ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				ТОГДА НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо,
			|	ОснованияСНеудержаннымНалогом.Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиямСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ОснованияСНеудержаннымНалогом.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|			И (СведенияОДоходахНДФЛ.СуммаДохода > 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МаксимальныеСуммы.ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор,
			|	МИНИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.ДатаПолученияДохода) КАК ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТДатыОснованийСНеудержаннымНалогом
			|ИЗ
			|	(ВЫБРАТЬ
			|		МАКСИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода) КАК СуммаДохода,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|	
			|	СГРУППИРОВАТЬ ПО
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор) КАК МаксимальныеСуммы
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|		ПО МаксимальныеСуммы.СуммаДохода = ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода
			|			И МаксимальныеСуммы.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|			И МаксимальныеСуммы.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|
			|СГРУППИРОВАТЬ ПО
			|	МаксимальныеСуммы.ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОснованияНачислений.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОснованияНачислений.ДатаПолученияДохода КАК ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТОставшиесяДатыПолученияДохода
			|ИЗ
			|	ВТОснованияНачислений КАК ОснованияНачислений
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|		ПО ОснованияНачислений.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|			И ОснованияНачислений.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|ГДЕ
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДатыПолученияДохода.ФизическоеЛицо,
			|	ДатыПолученияДохода.ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТДатыПолученияДоходаБезНалогов
			|ИЗ
			|	ВТОставшиесяДатыПолученияДохода КАК ДатыПолученияДохода
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК НалогиПоДатам
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|			ПО НалогиПоДатам.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|				И НалогиПоДатам.ДокументОснование = ОснованияСУдержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|			ПО НалогиПоДатам.ДокументОснование = ОснованияСНеудержаннымНалогом.Регистратор
			|				И НалогиПоДатам.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|		ПО ДатыПолученияДохода.ФизическоеЛицо = НалогиПоДатам.ФизическоеЛицо
			|			И ДатыПолученияДохода.ДатаПолученияДохода = НалогиПоДатам.ДатаПолученияДохода
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|ГДЕ
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	ДатыПолученияДохода.ФизическоеЛицо,
			|	ДатыПолученияДохода.ДатаПолученияДохода
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				ТОГДА НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0 И
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				ТОГДА НалогиПоДатам.Сумма
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|				ТОГДА -НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
			|	Доходы.ФизическоеЛицо,
			|	Доходы.ДатаПолученияДохода,
			|	Доходы.Регистратор
			|ПОМЕСТИТЬ ВТДоходыБезНалогов
			|ИЗ
			|	(ВЫБРАТЬ
			|		СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|		СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|		СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|		СведенияОДоходахНДФЛ.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиям КАК ДоходыПоОснованиям
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДоходыПоОснованиям.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ДоходыПоОснованиям.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДатыПолученияДоходаБезНалогов КАК ДатыПолученияДоходаБезНалогов
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДатыПолученияДоходаБезНалогов.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода = ДатыПолученияДоходаБезНалогов.ДатаПолученияДохода
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|	ГДЕ
			|		СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|		И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|		И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|		И ДатыПолученияДоходаБезНалогов.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|		И ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|		И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|		И ДоходыПоОснованиям.СуммаДохода > 0
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		СведенияОДоходахНДФЛ.СуммаДохода,
			|		СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|		ДатыОснованийСНеудержаннымНалогом.ДатаПолученияДохода,
			|		СведенияОДоходахНДФЛ.Регистратор
			|	ИЗ
			|		ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|				ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиям КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|				ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|					И ОснованияСНеудержаннымНалогом.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|				ЛЕВОЕ СОЕДИНЕНИЕ ВТДатыОснованийСНеудержаннымНалогом КАК ДатыОснованийСНеудержаннымНалогом
			|				ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДатыОснованийСНеудержаннымНалогом.ФизическоеЛицо
			|					И ОснованияСНеудержаннымНалогом.Регистратор = ДатыОснованийСНеудержаннымНалогом.Регистратор
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|	ГДЕ
			|		СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода
			|		И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|		И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|		И ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|		И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|		И ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода > 0) КАК Доходы
			|
			|СГРУППИРОВАТЬ ПО
			|	Доходы.ФизическоеЛицо,
			|	Доходы.ДатаПолученияДохода,
			|	Доходы.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДатыУчета.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДатыУчета.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) * ВЫБОР
			|				КОГДА ДолиПолученногоДохода.Доля > 1
			|					ТОГДА 1
			|				ИНАЧЕ ДолиПолученногоДохода.Доля
			|			КОНЕЦ КАК ЧИСЛО(15, 2)), 0) КАК СуммаДохода
			|ИЗ
			|	ВТДатыУчета КАК ДатыУчета
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ДатыУчета.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ДатыУчета.ДатаПолученияДохода = СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|			И (ВЫБОР
			|				КОГДА ДатыУчета.ДатаУдержания > ДатыУчета.ДатаПолученияДохода
			|					ТОГДА ДатыУчета.ДатаУдержания
			|				ИНАЧЕ ДатыУчета.ДатаПолученияДохода
			|			КОНЕЦ >= НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, ДЕНЬ))
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДолиПолученногоДохода КАК ДолиПолученногоДохода
			|		ПО ДатыУчета.ДатаПолученияДохода = ДолиПолученногоДохода.ДатаПолученияДохода
			|			И ДатыУчета.ФизическоеЛицо = ДолиПолученногоДохода.ФизическоеЛицо
			|ГДЕ
			|	НЕ СведенияОДоходахНДФЛ.Регистратор В
			|				(ВЫБРАТЬ
			|					ДанныеПоДокументамОснованиям.Регистратор
			|				ИЗ
			|					ВТОбработанныеДанныеПоДокументамОснованиям КАК ДанныеПоДокументамОснованиям
			|				ГДЕ
			|					ДанныеПоДокументамОснованиям.СуммаФактическиПолученногоДохода <> 0)
			|	И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	ДатыУчета.ФизическоеЛицо,
			|	ДатыУчета.ДатаПолученияДохода,
			|	ДолиПолученногоДохода.Доля
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ИсходныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ИсходныеДанные.ДатаУдержания,
			|	ИсходныеДанные.СрокПеречисления,
			|	СУММА(ИсходныеДанные.Сумма) КАК Сумма,
			|	0 КАК СуммаФактическиПолученногоДохода
			|ИЗ
			|	ВТИсходныеДанныеПоСтарымДокументамОснованиям КАК ИсходныеДанные
			|ГДЕ
			|	НЕ ИсходныеДанные.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ИсходныеДанные.ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода,
			|	ИсходныеДанные.ДатаУдержания,
			|	ИсходныеДанные.СрокПеречисления
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода";
			Если ОкончаниеПериода < '20160701' Тогда
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода");
			Иначе
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода И НалогиПоДатам.ДатаУдержания >= ДАТАВРЕМЯ(2016, 7, 1, 0, 0, 0)");
			КонецЕсли;
			
			Результаты = Запрос.ВыполнитьПакет();
			ВсегоРезультатов = Результаты.Количество();
			НеОбработанныеДанные = Результаты[ВсегоРезультатов - 1].Выгрузить();
			СуммыДоходов = Результаты[ВсегоРезультатов - 2].Выгрузить();
			ОбработанныеДанные = НеОбработанныеДанные.СкопироватьКолонки();
			СтруктураПоиска = Новый Структура("ФизическоеЛицо,ДатаПолученияДохода");
			Для каждого СтрокаДохода Из СуммыДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаДохода);
				ВременнаяТаблица = НеОбработанныеДанные.Скопировать(НеОбработанныеДанные.НайтиСтроки(СтруктураПоиска));
				Если ВременнаяТаблица.Количество() = 0 Тогда
					Продолжить;
				КонецЕсли;
				Если ЗначениеЗаполнено(СтрокаДохода.СуммаДохода) Тогда
					Если ВременнаяТаблица.Количество() = 1 Тогда
						ВременнаяТаблица[0].СуммаФактическиПолученногоДохода = СтрокаДохода.СуммаДохода
					Иначе
						КоэффициентыРаспределения = ВременнаяТаблица.ВыгрузитьКолонку("Сумма");
						РаспределениеРесурса = ЗарплатаКадрыКлиентСервер.РаспределитьПропорциональноКоэффициентам(СтрокаДохода.СуммаДохода, КоэффициентыРаспределения);
						Если РаспределениеРесурса <> Неопределено Тогда
							ВременнаяТаблица.ЗагрузитьКолонку(РаспределениеРесурса, "СуммаФактическиПолученногоДохода");
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
				ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВременнаяТаблица, ОбработанныеДанные)
			КонецЦикла;
			
			Запрос.УстановитьПараметр("ОбработанныеДанные", ОбработанныеДанные); 
			Запрос.Текст =
			"ВЫБРАТЬ
			|	Данные.ФизическоеЛицо,
			|	Данные.ДатаПолученияДохода,
			|	Данные.ДатаУдержания,
			|	Данные.СрокПеречисления,
			|	Данные.СуммаФактическиПолученногоДохода
			|ПОМЕСТИТЬ ВТОбработанныеДанные
			|ИЗ
			|	&ОбработанныеДанные КАК Данные";
			Запрос.Выполнить();
			
			НеОбработанныеДанные = Неопределено; СуммыДоходов = Неопределено; ОбработанныеДанные = Неопределено; ВременнаяТаблица = Неопределено;

			ТекстЗапроса =
			"ВЫБРАТЬ
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода КАК ДатаФактическогоПолученияДохода,
			|	НалогиПоДатам.ДатаПолученияДохода КАК П000020010001,
			|	НалогиПоДатам.ДатаУдержания КАК ДатаУдержанияНалога,
			|	НалогиПоДатам.ДатаУдержания КАК П000020011001,
			|	НалогиПоДатам.СрокПеречисления КАК СрокПеречисленияНалога,
			|	НалогиПоДатам.СрокПеречисления КАК П000020012001,
			|	СУММА(НалогиПоДатам.СуммаФактическиПолученногоДохода) < 0 КАК ОтрицательныйДоход,
			|	СУММА(НалогиПоДатам.СуммаФактическиПолученногоДохода) КАК П000020013001,
			|	СУММА(НалогиПоДатам.Сумма) КАК П000020014001
			|ИЗ
			|	(ВЫБРАТЬ
			|		Данные.ДокументОснование КАК Регистратор,
			|		Данные.ФизическоеЛицо КАК ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|		Данные.ДатаУдержания КАК ДатаУдержания,
			|		Данные.СрокПеречисления КАК СрокПеречисления,
			|		Данные.СуммаВыплаченногоДохода КАК СуммаФактическиПолученногоДохода,
			|		Данные.Сумма КАК Сумма
			|	ИЗ
			|		ВТИсходныеДанныеПоДокументамОснованиям КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Данные.Регистратор,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		Данные.СуммаДохода,
			|		0
			|	ИЗ
			|		ВТНатуральныеДоходы КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		НЕОПРЕДЕЛЕНО,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		Данные.ДатаУдержания,
			|		Данные.СрокПеречисления,
			|		Данные.СуммаФактическиПолученногоДохода,
			|		0
			|	ИЗ
			|		ВТОбработанныеДанные КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Данные.Регистратор,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		Данные.СуммаДохода,
			|		0
			|	ИЗ
			|		ВТДоходыБезНалогов КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Данные.Регистратор,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		Данные.ДатаУдержания,
			|		Данные.СрокПеречисления,
			|		Данные.СуммаФактическиПолученногоДохода,
			|		Данные.Сумма
			|	ИЗ
			|		ВТОбработанныеДанныеПоДокументамОснованиям КАК Данные) КАК НалогиПоДатам
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДатаУдержания,
			|	НалогиПоДатам.СрокПеречисления,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДатаУдержания,
			|	НалогиПоДатам.СрокПеречисления
			|
			|УПОРЯДОЧИТЬ ПО
			|	ДатаУдержанияНалога,
			|	СрокПеречисленияНалога,
			|	ДатаФактическогоПолученияДохода";
			
			МассивПолей = Новый Массив;
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
			СводныйРезультат = Запрос.Выполнить().Выгрузить();
			
			Если СводныйРезультат.Найти(Истина,"ОтрицательныйДоход") <> Неопределено Тогда
				
				Запрос.Текст = ТекстЗапроса;
				ВременнаяТаблица = Запрос.Выполнить().Выгрузить();
				
				ОстатокПересчета = 0;
				ОстаткиПересчетаПоФизлицам = Новый Соответствие;
				ОстатокНалогов = 0;
				ОстаткиНалоговПоФизлицам = Новый Соответствие;
				Для каждого СтрокаТЗ Из ВременнаяТаблица Цикл
					Если СтрокаТЗ.П000020013001 = 0 Тогда
					ИначеЕсли СтрокаТЗ.П000020013001 > 0 Тогда
						Если ОстатокПересчета > 0 Тогда
							ОстатокФизлица = ОстаткиПересчетаПоФизлицам[СтрокаТЗ.ФизическоеЛицо];
							Если ЗначениеЗаполнено(ОстатокФизлица) Тогда
								КЗачету = Мин(СтрокаТЗ.П000020013001, ОстатокФизлица);
								СтрокаТЗ.П000020013001 = СтрокаТЗ.П000020013001 - КЗачету;
								ОстатокПересчета = ОстатокПересчета - КЗачету;
								ОстаткиПересчетаПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ОстатокФизлица - КЗачету);
							КонецЕсли;
						КонецЕсли;
						Если ОстатокНалогов > 0 Тогда
							ОстатокФизлица = ОстаткиНалоговПоФизлицам[СтрокаТЗ.ФизическоеЛицо];
							Если ЗначениеЗаполнено(ОстатокФизлица) Тогда
								КЗачету = Мин(СтрокаТЗ.П000020014001, ОстатокФизлица);
								СтрокаТЗ.П000020014001 = СтрокаТЗ.П000020014001 - КЗачету;
								ОстатокНалогов = ОстатокНалогов - КЗачету;
								ОстаткиНалоговПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ОстатокФизлица - КЗачету);
							КонецЕсли;
						КонецЕсли;
					Иначе
						ОстатокПересчета = ОстатокПересчета - СтрокаТЗ.П000020013001;
						ОстаткиПересчетаПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ?(ЗначениеЗаполнено(ОстаткиПересчетаПоФизлицам[СтрокаТЗ.ФизическоеЛицо]),ОстаткиПересчетаПоФизлицам[СтрокаТЗ.ФизическоеЛицо],0) - СтрокаТЗ.П000020013001);
						Если СтрокаТЗ.П000020014001 < 0 Тогда
							ОстатокНалогов = ОстатокНалогов - СтрокаТЗ.П000020014001;
							ОстаткиНалоговПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ?(ЗначениеЗаполнено(ОстаткиНалоговПоФизлицам[СтрокаТЗ.ФизическоеЛицо]),ОстаткиНалоговПоФизлицам[СтрокаТЗ.ФизическоеЛицо],0) - СтрокаТЗ.П000020014001);
						КонецЕсли;
					КонецЕсли;
				КонецЦикла;
				Если ОстатокПересчета > 0 Тогда
					ВсегоСтрок = ВременнаяТаблица.Количество();
					Для Счетчик = 1 По ВсегоСтрок Цикл
						СтрокаТЗ = ВременнаяТаблица[ВсегоСтрок - Счетчик];
						Если СтрокаТЗ.П000020013001 < 0 Тогда
							Если ОстатокПересчета = 0 Тогда
							ИначеЕсли СтрокаТЗ.П000020013001 < -ОстатокПересчета Тогда
								ОстатокПересчета = 0;
							Иначе
								ОстатокПересчета = ОстатокПересчета + СтрокаТЗ.П000020013001;
							КонецЕсли;
							СтрокаТЗ.П000020013001 = 0;
						КонецЕсли;
						Если ОстатокНалогов > 0 Тогда
							Если СтрокаТЗ.П000020014001 < 0 Тогда
								Если ОстатокНалогов = 0 Тогда
								ИначеЕсли СтрокаТЗ.П000020014001 < -ОстатокНалогов Тогда
									ОстатокНалогов = 0;
								Иначе
									ОстатокНалогов = ОстатокНалогов + СтрокаТЗ.П000020014001;
								КонецЕсли;
								СтрокаТЗ.П000020014001 = 0;
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
				Иначе
					Для каждого СтрокаТЗ Из ВременнаяТаблица Цикл
						Если СтрокаТЗ.П000020013001 < 0 Тогда
							СтрокаТЗ.П000020013001 = 0;
							Если ОстатокНалогов = 0 И СтрокаТЗ.П000020014001 < 0 Тогда
								СтрокаТЗ.П000020014001 = 0;
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				
				ОписаниеТаблиц.Раздел2 = ВременнаяТаблица.СкопироватьКолонки();
				ВременнаяТаблица.Свернуть("ДатаФактическогоПолученияДохода,П000020010001,ДатаУдержанияНалога,П000020011001,СрокПеречисленияНалога,П000020012001" + ?(ПодробныеДанные, ",ФизическоеЛицо", ""),"П000020014001,П000020013001");
				Для каждого СтрокаТЗ Из ВременнаяТаблица Цикл
					Если СтрокаТЗ.П000020013001 <> 0 Или СтрокаТЗ.П000020014001 <> 0 Тогда
						ЗаполнитьЗначенияСвойств(ОписаниеТаблиц.Раздел2.Добавить(), СтрокаТЗ);
					КонецЕсли;
				КонецЦикла;
				
			ИначеЕсли ПодробныеДанные Тогда
				Запрос.Текст = ТекстЗапроса;
				ОписаниеТаблиц.Раздел2 = Запрос.Выполнить().Выгрузить();
			Иначе
				ОписаниеТаблиц.Раздел2 = СводныйРезультат.СкопироватьКолонки();
				Для каждого СтрокаТЗ Из СводныйРезультат Цикл
					Если СтрокаТЗ.П000020013001 <> 0 Или СтрокаТЗ.П000020014001 <> 0 Тогда
						ЗаполнитьЗначенияСвойств(ОписаниеТаблиц.Раздел2.Добавить(), СтрокаТЗ);
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура РасчетПоказателей_6НДФЛ_2017Кв1(НачалоПериода, ОкончаниеПериода, ДатаПодписи, Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, ПодробныеДанные, НомерКорректировки) Экспорт
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("НачалоПредыдущегоГода", ДобавитьМесяц(НачалоПериода, -12));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("ДатаПодписи", КонецДня(ДатаПодписи));
	Запрос.УстановитьПараметр("ОкончаниеПериодаОсмотраДоходовВычетов", ?(КонецГода(ОкончаниеПериода) = ОкончаниеПериода Или ЗначениеЗаполнено(НомерКорректировки), Макс(ДатаПодписи, ОкончаниеПериода), ОкончаниеПериода));
	
	Если ОписаниеТаблиц.Свойство("Раздел1Доходы") Или ОписаниеТаблиц.Свойство("Раздел1Вычеты") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
		
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
		|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
		|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ
		|ПОМЕСТИТЬ ВТДоходы
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|			ИЛИ СведенияОДоходахНДФЛ.СуммаВычета <> 0)";
		Запрос.Выполнить();
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТДоходы", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
		
		Если ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0) КАК П000010006001
			|ИЗ
			|	ВТДоходы КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаДохода <> 0
			|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
			|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))";
			
			ОписаниеТаблиц.КоличествоПолучателейДохода = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
	
		Если ОписаниеТаблиц.Свойство("Раздел1Доходы") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодДохода,
			|	СведенияОДоходахНДФЛ.Начисление,
			|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.СуммаДохода,
			|	ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
			|			ТОГДА СведенияОДоходахНДФЛ.СуммаДохода
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК СуммаДивидендов
			|ПОМЕСТИТЬ ВТДоходыПоСтавкам
			|ИЗ
			|	ВТДоходы КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаДохода <> 0
			|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
			|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))";
			Запрос.Выполнить();
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодДохода,
			|	СведенияОДоходах.Начисление,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога КАК П000010001001,
			|	СведенияОДоходах.СтавкаНалога,
			|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000010002001,
			|	СУММА(СведенияОДоходах.СуммаДивидендов) КАК П000010002501
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодДохода,
			|	СведенияОДоходах.Начисление,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога";
			
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
				МассивПолей.Добавить("КодДохода");
				МассивПолей.Добавить("Начисление");
				МассивПолей.Добавить("Регистратор");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
			ОписаниеТаблиц.Раздел1Доходы = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел1Вычеты") Тогда
			
			Запрос.УстановитьПараметр("ГодПериода", Год(ОкончаниеПериода));
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодВычета,
			|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.СуммаВычета
			|ПОМЕСТИТЬ ВТВычетыПоСтавкам
			|ИЗ
			|	ВТДоходы КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаВычета <> 0
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
			|	13,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма
			|ИЗ
			|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
			|ГДЕ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
			|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма <> 0
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ИмущественныеВычетыНДФЛ.Регистратор,
			|	ИмущественныеВычетыНДФЛ.ФизическоеЛицо,
			|	ИмущественныеВычетыНДФЛ.КодВычета,
			|	13,
			|	ИмущественныеВычетыНДФЛ.Сумма
			|ИЗ
			|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
			|ГДЕ
			|	ИмущественныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
			|	И ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|	И ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
			|	И ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
			|	И ИмущественныеВычетыНДФЛ.Сумма <> 0
			|	И ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
			|	И ИмущественныеВычетыНДФЛ.Год = &ГодПериода";
			Запрос.Выполнить();
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодВычета,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога КАК П000010001001,
			|	СведенияОДоходах.СтавкаНалога,
			|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000010003001
			|ИЗ
			|	ВТВычетыПоСтавкам КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодВычета,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога";
			
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
				МассивПолей.Добавить("КодВычета");
				МассивПолей.Добавить("Регистратор");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
			ОписаниеТаблиц.Раздел1Вычеты = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Или ОписаниеТаблиц.Свойство("Раздел2") Тогда
		
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения КАК ВидДвижения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода КАК СуммаВыплаченногоДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода КАК РасчетМежрасчетногоПериода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.УчитыватьВыплаченныйДоходВ6НДФЛ КАК УчитыватьВыплаченныйДоходВ6НДФЛ
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.УчитыватьВыплаченныйДоходВ6НДФЛ
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода <> 0)";
		Запрос.Выполнить();
		
		Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Тогда
			
			УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТНалоги", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
			
			Запрос.УстановитьПараметр("ДатаПервогоОтчетногоПериода", '20160101');
			Запрос.Текст =
			"ВЫБРАТЬ
			|	НДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Начислено,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
			|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
			|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК НачисленоПоДивидендам,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК ЗачтеноАвансов,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаПолученияДохода >= &ДатаПервогоОтчетногоПериода
			|			ТОГДА НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Удержано,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
			|			ТОГДА НДФЛ.Сумма
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|			ТОГДА -НДФЛ.Сумма
			|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
			|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
			|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
			|			ТОГДА -НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Сальдо,
			|	ВЫБОР
			|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
			|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
			|			ТОГДА -НДФЛ.Сумма
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК Возвращено
			|ПОМЕСТИТЬ ВТНалогиПоСтавкам
			|ИЗ
			|	ВТНалоги КАК НДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
			|	Налоги.СтавкаНалога КАК СтавкаНалога,
			|	СУММА(Налоги.Сальдо) КАК НеУдержано
			|ПОМЕСТИТЬ ВТНеУдержано
			|ИЗ
			|	ВТНалогиПоСтавкам КАК Налоги
			|
			|СГРУППИРОВАТЬ ПО
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога
			|
			|ИМЕЮЩИЕ
			|	СУММА(Налоги.Сальдо) > 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
			|	Налоги.СтавкаНалога КАК СтавкаНалога,
			|	СУММА(Налоги.Начислено) КАК Начислено,
			|	СУММА(Налоги.НачисленоПоДивидендам) КАК НачисленоПоДивидендам,
			|	СУММА(Налоги.ЗачтеноАвансов) КАК ЗачтеноАвансов,
			|	СУММА(Налоги.Удержано) КАК Удержано,
			|	ЕСТЬNULL(МАКСИМУМ(ПоФизлицам.НеУдержано), 0) КАК НеУдержано,
			|	СУММА(Налоги.Возвращено) КАК Возвращено
			|ПОМЕСТИТЬ ВТДанныеПоФизлицам
			|ИЗ
			|	ВТНалогиПоСтавкам КАК Налоги
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНеУдержано КАК ПоФизлицам
			|		ПО Налоги.ФизическоеЛицо = ПоФизлицам.ФизическоеЛицо
			|			И Налоги.СтавкаНалога = ПоФизлицам.СтавкаНалога
			|ГДЕ
			|	(Налоги.Начислено <> 0
			|			ИЛИ Налоги.ЗачтеноАвансов <> 0
			|			ИЛИ Налоги.Удержано <> 0
			|			ИЛИ Налоги.Возвращено <> 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТСтавкаНДФЛПоСтавкеРезидента";
			Запрос.Выполнить();
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога КАК П000010001001,
			|	Налоги.СтавкаНалога,
			|	СУММА(Налоги.Начислено) КАК П000010004001,
			|	СУММА(Налоги.НачисленоПоДивидендам) КАК П000010004501,
			|	СУММА(Налоги.ЗачтеноАвансов) КАК П000010005001,
			|	СУММА(Налоги.Удержано) КАК П000010007001,
			|	СУММА(Налоги.НеУдержано) КАК П000010008001,
			|	СУММА(Налоги.Возвращено) КАК П000010009001
			|ИЗ
			|	ВТДанныеПоФизлицам КАК Налоги
			|ГДЕ
			|	(Налоги.Начислено <> 0
			|			ИЛИ Налоги.ЗачтеноАвансов <> 0
			|			ИЛИ Налоги.Удержано <> 0
			|			ИЛИ Налоги.Возвращено <> 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	Налоги.ФизическоеЛицо,
			|	Налоги.СтавкаНалога";
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "Налоги");
			ОписаниеТаблиц.Раздел1Налоги = Запрос.Выполнить().Выгрузить();
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел2") Тогда
			
			Запрос.УстановитьПараметр("НачалоОтчетногоКвартала", НачалоКвартала(ОкончаниеПериода));
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	МАКСИМУМ(ДатыУчета.ДатаПолученияДохода) КАК ПоздняяДатаПолученияДохода,
			|	МИНИМУМ(ДатыУчета.ДатаПолученияДохода) КАК РанняяДатаПолученияДохода
			|ИЗ
			|	ВТНалоги КАК ДатыУчета
			|ГДЕ
			|	ДатыУчета.ДатаУдержания <= &ОкончаниеПериода";
			Выборка = Запрос.Выполнить().Выбрать();
			РанняяДатаПолученияДохода = НачалоПериода;
			ПоздняяДатаПолученияДохода = ДобавитьМесяц(ОкончаниеПериода, 1);
			Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.РанняяДатаПолученияДохода) Тогда
				РанняяДатаПолученияДохода = Мин(РанняяДатаПолученияДохода, Выборка.РанняяДатаПолученияДохода);
				ПоздняяДатаПолученияДохода = Макс(ПоздняяДатаПолученияДохода, Выборка.ПоздняяДатаПолученияДохода);
			КонецЕсли;
			Запрос.УстановитьПараметр("РанняяДатаПолученияДохода", РанняяДатаПолученияДохода);
			Запрос.УстановитьПараметр("ПоздняяДатаПолученияДохода", ПоздняяДатаПолученияДохода);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
			|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
			|	СведенияОДоходахНДФЛ.Период КАК ПериодРегистрации,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
			|	СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ КАК НеУчитыватьДоходВ6НДФЛ,
			|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
			|	СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование
			|ПОМЕСТИТЬ ВТСтрокиДоходов
			|ИЗ
			|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &РанняяДатаПолученияДохода И &ПоздняяДатаПолученияДохода
			|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
			|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
			|	И СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета <> 0";
			Запрос.Выполнить();

			УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиДоходов", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
		
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.ПериодРегистрации КАК Период,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
			|	СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ КАК НеУчитыватьДоходВ6НДФЛ,
			|	СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование
			|ПОМЕСТИТЬ ВТСведенияОДоходахНДФЛ
			|ИЗ
			|	ВТСтрокиДоходов КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
			|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
			|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
			|ГДЕ
			|	(НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
			|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор
			|ПОМЕСТИТЬ ВТРегистраторыНачислений
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВзаиморасчетыССотрудниками.Регистратор КАК Регистратор,
			|	СУММА(ВзаиморасчетыССотрудниками.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов
			|ПОМЕСТИТЬ ВТНачисленоПоРегистраторам
			|ИЗ
			|	РегистрНакопления.ВзаиморасчетыССотрудниками КАК ВзаиморасчетыССотрудниками
			|ГДЕ
			|	ВзаиморасчетыССотрудниками.Регистратор В
			|			(ВЫБРАТЬ
			|				РегистраторыНачислений.Регистратор
			|			ИЗ
			|				ВТРегистраторыНачислений КАК РегистраторыНачислений)
			|	И ВзаиморасчетыССотрудниками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|
			|СГРУППИРОВАТЬ ПО
			|	ВзаиморасчетыССотрудниками.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВзаиморасчетыССотрудниками.Регистратор КАК Регистратор,
			|	-СУММА(ВзаиморасчетыССотрудниками.Сумма) КАК Сумма
			|ПОМЕСТИТЬ ВТНДФЛПоРегистраторам
			|ИЗ
			|	ВТНалоги КАК ВзаиморасчетыССотрудниками
			|ГДЕ
			|	ВзаиморасчетыССотрудниками.Регистратор В
			|			(ВЫБРАТЬ
			|				РегистраторыНачислений.Регистратор
			|			ИЗ
			|				ВТРегистраторыНачислений КАК РегистраторыНачислений)
			|	И ВзаиморасчетыССотрудниками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|
			|СГРУППИРОВАТЬ ПО
			|	ВзаиморасчетыССотрудниками.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование КАК ДокументОснование,
			|	НАЧАЛОПЕРИОДА(НалогиПоДатам.ДатаУдержания, ДЕНЬ) КАК ДатаУдержания,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисления,
			|	НалогиПоДатам.Регистратор КАК Регистратор,
			|	НалогиПоДатам.Сумма КАК Сумма,
			|	НалогиПоДатам.СуммаВыплаченногоДохода КАК СуммаВыплаченногоДохода
			|ПОМЕСТИТЬ ВТИсходныеДанныеПоДокументамОснованиям
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И &УсловиеОтбораПоДатам
			|	И НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	МАКСИМУМ(СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
			|			ИЛИ НачисленоПоРегистраторам.Регистратор ЕСТЬ NULL
			|				И НДФЛПоРегистраторам.Регистратор ЕСТЬ НЕ NULL ) КАК ЭтоМежрасчетныйДокумент,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТОснованияНачислений
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИсходныеДанныеПоДокументамОснованиям КАК ОснованияСУдержаннымНалогом
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|			И (СведенияОДоходахНДФЛ.ДокументОснование = ОснованияСУдержаннымНалогом.ДокументОснование
			|				ИЛИ СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор)
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачисленоПоРегистраторам КАК НачисленоПоРегистраторам
			|		ПО СведенияОДоходахНДФЛ.Регистратор = НачисленоПоРегистраторам.Регистратор
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНДФЛПоРегистраторам КАК НДФЛПоРегистраторам
			|		ПО СведенияОДоходахНДФЛ.Регистратор = НДФЛПоРегистраторам.Регистратор
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.СуммаДохода > 0
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL
			|	И (ЕСТЬNULL(НачисленоПоРегистраторам.СуммаВзаиморасчетов, 0) <= ЕСТЬNULL(НДФЛПоРегистраторам.Сумма, 0)
			|			ИЛИ НачисленоПоРегистраторам.Регистратор ЕСТЬ NULL
			|				И НДФЛПоРегистраторам.Регистратор ЕСТЬ НЕ NULL )
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	Основания.ФизическоеЛицо КАК ФизическоеЛицо,
			|	Основания.Регистратор КАК Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиям
			|ИЗ
			|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
			|		Основания.ФизическоеЛицо КАК ФизическоеЛицо,
			|		Основания.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТОснованияНачислений КАК Основания) КАК Основания
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО Основания.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И Основания.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|
			|СГРУППИРОВАТЬ ПО
			|	Основания.ФизическоеЛицо,
			|	Основания.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ОснованияНачислений.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор КАК Регистратор
			|ПОМЕСТИТЬ ВТОснованияСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияНачислений КАК ОснованияНачислений
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК НалогиПоДатам
			|		ПО ОснованияНачислений.ФизическоеЛицо = НалогиПоДатам.ФизическоеЛицо
			|			И (ОснованияНачислений.Регистратор = НалогиПоДатам.ДокументОснование
			|				ИЛИ ОснованияНачислений.Регистратор = НалогиПоДатам.Регистратор)
			|			И ОснованияНачислений.ДатаПолученияДохода = НалогиПоДатам.ДатаПолученияДохода
			|ГДЕ
			|	ОснованияНачислений.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияНачислений.ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				ТОГДА НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОснованияСНеудержаннымНалогом.Регистратор КАК Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиямСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ОснованияСНеудержаннымНалогом.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|			И (СведенияОДоходахНДФЛ.СуммаДохода > 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МаксимальныеСуммы.ФизическоеЛицо КАК ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор КАК Регистратор,
			|	МИНИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.ДатаПолученияДохода) КАК ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТДатыОснованийСНеудержаннымНалогом
			|ИЗ
			|	(ВЫБРАТЬ
			|		МАКСИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода) КАК СуммаДохода,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|	
			|	СГРУППИРОВАТЬ ПО
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор) КАК МаксимальныеСуммы
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|		ПО МаксимальныеСуммы.СуммаДохода = ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода
			|			И МаксимальныеСуммы.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|			И МаксимальныеСуммы.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|
			|СГРУППИРОВАТЬ ПО
			|	МаксимальныеСуммы.ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДатыОснованийСНеудержаннымНалогом.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор
			|ПОМЕСТИТЬ ВТНатуральныеДоходы
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИсходныеДанныеПоДокументамОснованиям КАК ОснованияСУдержаннымНалогом
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.ДокументОснование = ОснованияСУдержаннымНалогом.ДокументОснование
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиям КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|			ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|				И ОснованияСНеудержаннымНалогом.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДатыОснованийСНеудержаннымНалогом КАК ДатыОснованийСНеудержаннымНалогом
			|			ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДатыОснованийСНеудержаннымНалогом.ФизическоеЛицо
			|				И ОснованияСНеудержаннымНалогом.Регистратор = ДатыОснованийСНеудержаннымНалогом.Регистратор
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|	И ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL
			|	И ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода > 0
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	ДатыОснованийСНеудержаннымНалогом.ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТДатыОснованийСНеудержаннымНалогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТДоходыПоОснованиямСНеудержаннымНалогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТОснованияСНеудержаннымНалогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТДоходыПоОснованиям
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТРегистраторыНачислений
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТНачисленоПоРегистраторам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТНДФЛПоРегистраторам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТОснованияНачислений
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	НалогиПоДатам.ДокументОснование КАК ДокументОснование
			|ПОМЕСТИТЬ ВТМежрасчетныеДокументыОснования
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|	И НалогиПоДатам.РасчетМежрасчетногоПериода
			|	И НалогиПоДатам.ДокументОснование <> НЕОПРЕДЕЛЕНО
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование КАК ДокументОснование,
			|	НАЧАЛОПЕРИОДА(НалогиПоДатам.ДатаУдержания, ДЕНЬ) КАК ДатаУдержания,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисления,
			|	СУММА(НалогиПоДатам.Сумма) КАК Сумма,
			|	МежрасчетныеДокументыОснования.ДокументОснование ЕСТЬ НЕ NULL  КАК ЭтоМежрасчетныйДокумент
			|ПОМЕСТИТЬ ВТИсходныеДанныеПоСтарымДокументамОснованиям
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМежрасчетныеДокументыОснования КАК МежрасчетныеДокументыОснования
			|		ПО НалогиПоДатам.ДокументОснование = МежрасчетныеДокументыОснования.ДокументОснование
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И &УсловиеОтбораПоДатам
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование,
			|	НАЧАЛОПЕРИОДА(НалогиПоДатам.ДатаУдержания, ДЕНЬ),
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	МежрасчетныеДокументыОснования.ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование КАК ДокументОснование,
			|	ВЫБОР
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 0
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 1
			|		ИНАЧЕ СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) / СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ)
			|	КОНЕЦ КАК Доля
			|ПОМЕСТИТЬ ВТДолиПолученногоДоходаПоДокументамОснованиям
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ДатаУдержания <= &ОкончаниеПериода
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДанныеУчета.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеУчета.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ДанныеУчета.ДокументОснование КАК Регистратор,
			|	ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) * ВЫБОР
			|				КОГДА ДанныеУчета.Доля > 1
			|					ТОГДА 1
			|				ИНАЧЕ ДанныеУчета.Доля
			|			КОНЕЦ КАК ЧИСЛО(15, 2)), 0) КАК СуммаДохода
			|ИЗ
			|	ВТДолиПолученногоДоходаПоДокументамОснованиям КАК ДанныеУчета
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ДанныеУчета.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ДанныеУчета.ДатаПолученияДохода = СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|			И ДанныеУчета.ДокументОснование = СведенияОДоходахНДФЛ.Регистратор
			|
			|СГРУППИРОВАТЬ ПО
			|	ДанныеУчета.ФизическоеЛицо,
			|	ДанныеУчета.ДатаПолученияДохода,
			|	ДанныеУчета.Доля,
			|	ДанныеУчета.ДокументОснование
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода,
			|	Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ИсходныеДанные.ДокументОснование КАК Регистратор,
			|	ИсходныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ИсходныеДанные.ДатаУдержания КАК ДатаУдержания,
			|	ИсходныеДанные.СрокПеречисления КАК СрокПеречисления,
			|	ИсходныеДанные.Сумма КАК Сумма,
			|	0 КАК СуммаФактическиПолученногоДохода
			|ИЗ
			|	ВТИсходныеДанныеПоСтарымДокументамОснованиям КАК ИсходныеДанные
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода,
			|	Регистратор";
			Если ОкончаниеПериода < '20160701' Тогда
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода");
			Иначе
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода И НалогиПоДатам.ДатаУдержания >= ДАТАВРЕМЯ(2016, 7, 1, 0, 0, 0)");
			КонецЕсли;
			Результаты = Запрос.ВыполнитьПакет();
			ВсегоРезультатов = Результаты.Количество();
			НеОбработанныеДанные = Результаты[ВсегоРезультатов - 1].Выгрузить();
			ОбработанныеДанные = НеОбработанныеДанные.СкопироватьКолонки();
			СуммыДоходов = Результаты[ВсегоРезультатов - 2].Выгрузить();
			СтруктураПоиска = Новый Структура("ФизическоеЛицо,ДатаПолученияДохода,Регистратор");
			Для каждого СтрокаДохода Из СуммыДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаДохода);
				ВременнаяТаблица = НеОбработанныеДанные.Скопировать(НеОбработанныеДанные.НайтиСтроки(СтруктураПоиска));
				Если ВременнаяТаблица.Количество() = 0 Тогда
					Продолжить;
				КонецЕсли;
				Если ЗначениеЗаполнено(СтрокаДохода.СуммаДохода) Тогда
					Если ВременнаяТаблица.Количество() = 1 Тогда
						ВременнаяТаблица[0].СуммаФактическиПолученногоДохода = СтрокаДохода.СуммаДохода
					Иначе
						КоэффициентыРаспределения = ВременнаяТаблица.ВыгрузитьКолонку("Сумма");
						РаспределениеРесурса = ЗарплатаКадрыКлиентСервер.РаспределитьПропорциональноКоэффициентам(СтрокаДохода.СуммаДохода, КоэффициентыРаспределения);
						Если РаспределениеРесурса <> Неопределено Тогда
							ВременнаяТаблица.ЗагрузитьКолонку(РаспределениеРесурса, "СуммаФактическиПолученногоДохода");
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
				ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВременнаяТаблица, ОбработанныеДанные)
			КонецЦикла;
			Запрос.УстановитьПараметр("ОбработанныеДанные", ОбработанныеДанные); НеОбработанныеДанные = Неопределено; СуммыДоходов = Неопределено; ОбработанныеДанные = Неопределено; ВременнаяТаблица = Неопределено;
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	Данные.Регистратор,
			|	Данные.ФизическоеЛицо,
			|	Данные.ДатаПолученияДохода,
			|	Данные.ДатаУдержания,
			|	Данные.СрокПеречисления,
			|	Данные.СуммаФактическиПолученногоДохода,
			|	Данные.Сумма
			|ПОМЕСТИТЬ ВТОбработанныеДанныеПоДокументамОснованиям
			|ИЗ
			|	&ОбработанныеДанные КАК Данные
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	ВЫБОР
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 0
			|		КОГДА СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) = 0
			|			ТОГДА 1
			|		ИНАЧЕ СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|							И &УсловиеОтбораПоДатам
			|						ТОГДА НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ) / СУММА(ВЫБОР
			|					КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|						ТОГДА НалогиПоДатам.Сумма
			|					КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|						ТОГДА -НалогиПоДатам.Сумма
			|					ИНАЧЕ 0
			|				КОНЕЦ)
			|	КОНЕЦ КАК Доля
			|ПОМЕСТИТЬ ВТДолиПолученногоДохода
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМежрасчетныеДокументыОснования КАК МежрасчетныеДокументыОснования
			|		ПО НалогиПоДатам.ДокументОснование = МежрасчетныеДокументыОснования.ДокументОснование
			|ГДЕ
			|	НалогиПоДатам.ДатаУдержания <= &ОкончаниеПериода
			|	И МежрасчетныеДокументыОснования.ДокументОснование ЕСТЬ NULL 
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ИсходныеДанные.ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода,
			|	МАКСИМУМ(ИсходныеДанные.ДатаУдержания) КАК ДатаУдержания
			|ПОМЕСТИТЬ ВТДатыУчета
			|ИЗ
			|	ВТИсходныеДанныеПоСтарымДокументамОснованиям КАК ИсходныеДанные
			|ГДЕ
			|	НЕ ИсходныеДанные.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ИсходныеДанные.ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДатыУчета.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор
			|ПОМЕСТИТЬ ВТОснованияСУдержаннымНалогом
			|ИЗ
			|	ВТДатыУчета КАК ДатыУчета
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ДатыУчета.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ДатыУчета.ДатаПолученияДохода = СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|			И (ВЫБОР
			|				КОГДА ДатыУчета.ДатаУдержания > ДатыУчета.ДатаПолученияДохода
			|					ТОГДА ДатыУчета.ДатаУдержания
			|				ИНАЧЕ ДатыУчета.ДатаПолученияДохода
			|			КОНЕЦ >= НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, ДЕНЬ))
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДолиПолученногоДохода КАК ДолиПолученногоДохода
			|		ПО ДатыУчета.ДатаПолученияДохода = ДолиПолученногоДохода.ДатаПолученияДохода
			|			И ДатыУчета.ФизическоеЛицо = ДолиПолученногоДохода.ФизическоеЛицо
			|ГДЕ
			|	НЕ СведенияОДоходахНДФЛ.Регистратор В
			|				(ВЫБРАТЬ
			|					ДанныеПоДокументамОснованиям.Регистратор
			|				ИЗ
			|					ВТОбработанныеДанныеПоДокументамОснованиям КАК ДанныеПоДокументамОснованиям
			|				ГДЕ
			|					ДанныеПоДокументамОснованиям.СуммаФактическиПолученногоДохода <> 0)
			|	И ЕСТЬNULL(ДолиПолученногоДохода.Доля, 0) <> 0
			|	И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ОбработанныеДанныеПоДокументамОснованиям.ФизическоеЛицо,
			|	ОбработанныеДанныеПоДокументамОснованиям.Регистратор
			|ИЗ
			|	ВТОбработанныеДанныеПоДокументамОснованиям КАК ОбработанныеДанныеПоДокументамОснованиям
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	МАКСИМУМ(СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода) КАК ЭтоМежрасчетныйДокумент
			|ПОМЕСТИТЬ ВТОснованияНачислений
			|ИЗ
			|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор
			|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ВзаиморасчетыССотрудниками КАК ВзаиморасчетыССотрудниками
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ВзаиморасчетыССотрудниками.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ВзаиморасчетыССотрудниками.Регистратор
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|	И СведенияОДоходахНДФЛ.СуммаДохода > 0
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|	И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|	И ВзаиморасчетыССотрудниками.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Регистратор,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	Основания.ФизическоеЛицо,
			|	Основания.Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиям
			|ИЗ
			|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
			|		Основания.ФизическоеЛицо КАК ФизическоеЛицо,
			|		Основания.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТОснованияНачислений КАК Основания) КАК Основания
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО Основания.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И Основания.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|
			|СГРУППИРОВАТЬ ПО
			|	Основания.ФизическоеЛицо,
			|	Основания.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ОснованияНачислений.ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор
			|ПОМЕСТИТЬ ВТОснованияСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияНачислений КАК ОснованияНачислений
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК НалогиПоДатам
			|		ПО ОснованияНачислений.ФизическоеЛицо = НалогиПоДатам.ФизическоеЛицо
			|			И ОснованияНачислений.Регистратор = НалогиПоДатам.ДокументОснование
			|			И ОснованияНачислений.ДатаПолученияДохода = НалогиПоДатам.ДатаПолученияДохода
			|ГДЕ
			|	ОснованияНачислений.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияНачислений.ФизическоеЛицо,
			|	ОснованияНачислений.Регистратор
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				ТОГДА НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо,
			|	ОснованияСНеудержаннымНалогом.Регистратор
			|ПОМЕСТИТЬ ВТДоходыПоОснованиямСНеудержаннымНалогом
			|ИЗ
			|	ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ОснованияСНеудержаннымНалогом.Регистратор = СведенияОДоходахНДФЛ.Регистратор
			|			И (СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода)
			|			И (СведенияОДоходахНДФЛ.СуммаДохода > 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	ОснованияСНеудержаннымНалогом.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МаксимальныеСуммы.ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор,
			|	МИНИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.ДатаПолученияДохода) КАК ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТДатыОснованийСНеудержаннымНалогом
			|ИЗ
			|	(ВЫБРАТЬ
			|		МАКСИМУМ(ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода) КАК СуммаДохода,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|	
			|	СГРУППИРОВАТЬ ПО
			|		ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо,
			|		ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор) КАК МаксимальныеСуммы
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиямСНеудержаннымНалогом КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|		ПО МаксимальныеСуммы.СуммаДохода = ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода
			|			И МаксимальныеСуммы.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|			И МаксимальныеСуммы.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|
			|СГРУППИРОВАТЬ ПО
			|	МаксимальныеСуммы.ФизическоеЛицо,
			|	МаксимальныеСуммы.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ОснованияНачислений.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОснованияНачислений.ДатаПолученияДохода КАК ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТОставшиесяДатыПолученияДохода
			|ИЗ
			|	ВТОснованияНачислений КАК ОснованияНачислений
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|		ПО ОснованияНачислений.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|			И ОснованияНачислений.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|ГДЕ
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДатыПолученияДохода.ФизическоеЛицо,
			|	ДатыПолученияДохода.ДатаПолученияДохода
			|ПОМЕСТИТЬ ВТДатыПолученияДоходаБезНалогов
			|ИЗ
			|	ВТОставшиесяДатыПолученияДохода КАК ДатыПолученияДохода
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК НалогиПоДатам
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|			ПО НалогиПоДатам.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|				И НалогиПоДатам.ДокументОснование = ОснованияСУдержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|			ПО НалогиПоДатам.ДокументОснование = ОснованияСНеудержаннымНалогом.Регистратор
			|				И НалогиПоДатам.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|		ПО ДатыПолученияДохода.ФизическоеЛицо = НалогиПоДатам.ФизическоеЛицо
			|			И ДатыПолученияДохода.ДатаПолученияДохода = НалогиПоДатам.ДатаПолученияДохода
			|	И НЕ НалогиПоДатам.УчитыватьВыплаченныйДоходВ6НДФЛ
			|ГДЕ
			|	ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|	И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	ДатыПолученияДохода.ФизическоеЛицо,
			|	ДатыПолученияДохода.ДатаПолученияДохода
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|				ТОГДА НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0 И
			|	СУММА(ВЫБОР
			|			КОГДА НалогиПоДатам.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|				ТОГДА НалогиПоДатам.Сумма
			|			КОГДА НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
			|				ТОГДА -НалогиПоДатам.Сумма
			|			ИНАЧЕ 0
			|		КОНЕЦ) = 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
			|	Доходы.ФизическоеЛицо,
			|	Доходы.ДатаПолученияДохода,
			|	Доходы.Регистратор
			|ПОМЕСТИТЬ ВТДоходыБезНалогов
			|ИЗ
			|	(ВЫБРАТЬ
			|		СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|		СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|		СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|		СведенияОДоходахНДФЛ.Регистратор КАК Регистратор
			|	ИЗ
			|		ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиям КАК ДоходыПоОснованиям
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДоходыПоОснованиям.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ДоходыПоОснованиям.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДатыПолученияДоходаБезНалогов КАК ДатыПолученияДоходаБезНалогов
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДатыПолученияДоходаБезНалогов.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода = ДатыПолученияДоходаБезНалогов.ДатаПолученияДохода
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|	ГДЕ
			|		СведенияОДоходахНДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|		И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|		И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|		И ДатыПолученияДоходаБезНалогов.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|		И ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|		И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|		И ДоходыПоОснованиям.СуммаДохода > 0
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		СведенияОДоходахНДФЛ.СуммаДохода,
			|		СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|		ДатыОснованийСНеудержаннымНалогом.ДатаПолученияДохода,
			|		СведенияОДоходахНДФЛ.Регистратор
			|	ИЗ
			|		ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСУдержаннымНалогом КАК ОснованияСУдержаннымНалогом
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСУдержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСУдержаннымНалогом.Регистратор
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияСНеудержаннымНалогом КАК ОснованияСНеудержаннымНалогом
			|				ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоОснованиям КАК ДоходыПоОснованиямСНеудержаннымНалогом
			|				ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДоходыПоОснованиямСНеудержаннымНалогом.ФизическоеЛицо
			|					И ОснованияСНеудержаннымНалогом.Регистратор = ДоходыПоОснованиямСНеудержаннымНалогом.Регистратор
			|				ЛЕВОЕ СОЕДИНЕНИЕ ВТДатыОснованийСНеудержаннымНалогом КАК ДатыОснованийСНеудержаннымНалогом
			|				ПО ОснованияСНеудержаннымНалогом.ФизическоеЛицо = ДатыОснованийСНеудержаннымНалогом.ФизическоеЛицо
			|					И ОснованияСНеудержаннымНалогом.Регистратор = ДатыОснованийСНеудержаннымНалогом.Регистратор
			|			ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ОснованияСНеудержаннымНалогом.ФизическоеЛицо
			|				И СведенияОДоходахНДФЛ.Регистратор = ОснованияСНеудержаннымНалогом.Регистратор
			|	ГДЕ
			|		СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ОкончаниеПериода
			|		И СведенияОДоходахНДФЛ.Период <= &ОкончаниеПериода
			|		И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|		И ОснованияСНеудержаннымНалогом.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|		И ОснованияСУдержаннымНалогом.ФизическоеЛицо ЕСТЬ NULL 
			|		И ДоходыПоОснованиямСНеудержаннымНалогом.СуммаДохода > 0) КАК Доходы
			|
			|СГРУППИРОВАТЬ ПО
			|	Доходы.ФизическоеЛицо,
			|	Доходы.ДатаПолученияДохода,
			|	Доходы.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДатыУчета.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДатыУчета.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ЕСТЬNULL(ВЫРАЗИТЬ(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) * ВЫБОР
			|				КОГДА ДолиПолученногоДохода.Доля > 1
			|					ТОГДА 1
			|				ИНАЧЕ ДолиПолученногоДохода.Доля
			|			КОНЕЦ КАК ЧИСЛО(15, 2)), 0) КАК СуммаДохода
			|ИЗ
			|	ВТДатыУчета КАК ДатыУчета
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ПО ДатыУчета.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
			|			И ДатыУчета.ДатаПолученияДохода = СведенияОДоходахНДФЛ.ДатаПолученияДохода
			|			И (ВЫБОР
			|				КОГДА ДатыУчета.ДатаУдержания > ДатыУчета.ДатаПолученияДохода
			|					ТОГДА ДатыУчета.ДатаУдержания
			|				ИНАЧЕ ДатыУчета.ДатаПолученияДохода
			|			КОНЕЦ >= НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, ДЕНЬ))
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДолиПолученногоДохода КАК ДолиПолученногоДохода
			|		ПО ДатыУчета.ДатаПолученияДохода = ДолиПолученногоДохода.ДатаПолученияДохода
			|			И ДатыУчета.ФизическоеЛицо = ДолиПолученногоДохода.ФизическоеЛицо
			|ГДЕ
			|	НЕ СведенияОДоходахНДФЛ.Регистратор В
			|				(ВЫБРАТЬ
			|					ДанныеПоДокументамОснованиям.Регистратор
			|				ИЗ
			|					ВТОбработанныеДанныеПоДокументамОснованиям КАК ДанныеПоДокументамОснованиям
			|				ГДЕ
			|					ДанныеПоДокументамОснованиям.СуммаФактическиПолученногоДохода <> 0)
			|	И НЕ СведенияОДоходахНДФЛ.НеУчитыватьДоходВ6НДФЛ
			|
			|СГРУППИРОВАТЬ ПО
			|	ДатыУчета.ФизическоеЛицо,
			|	ДатыУчета.ДатаПолученияДохода,
			|	ДолиПолученногоДохода.Доля
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ИсходныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ИсходныеДанные.ДатаУдержания,
			|	ИсходныеДанные.СрокПеречисления,
			|	СУММА(ИсходныеДанные.Сумма) КАК Сумма,
			|	0 КАК СуммаФактическиПолученногоДохода
			|ИЗ
			|	ВТИсходныеДанныеПоСтарымДокументамОснованиям КАК ИсходныеДанные
			|ГДЕ
			|	НЕ ИсходныеДанные.ЭтоМежрасчетныйДокумент
			|
			|СГРУППИРОВАТЬ ПО
			|	ИсходныеДанные.ФизическоеЛицо,
			|	ИсходныеДанные.ДатаПолученияДохода,
			|	ИсходныеДанные.ДатаУдержания,
			|	ИсходныеДанные.СрокПеречисления
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	ДатаПолученияДохода";
			Если ОкончаниеПериода < '20160701' Тогда
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода");
			Иначе
				Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбораПоДатам", "НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода И НалогиПоДатам.ДатаУдержания >= ДАТАВРЕМЯ(2016, 7, 1, 0, 0, 0)");
			КонецЕсли;
			
			Результаты = Запрос.ВыполнитьПакет();
			ВсегоРезультатов = Результаты.Количество();
			НеОбработанныеДанные = Результаты[ВсегоРезультатов - 1].Выгрузить();
			СуммыДоходов = Результаты[ВсегоРезультатов - 2].Выгрузить();
			ОбработанныеДанные = НеОбработанныеДанные.СкопироватьКолонки();
			СтруктураПоиска = Новый Структура("ФизическоеЛицо,ДатаПолученияДохода");
			Для каждого СтрокаДохода Из СуммыДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаДохода);
				ВременнаяТаблица = НеОбработанныеДанные.Скопировать(НеОбработанныеДанные.НайтиСтроки(СтруктураПоиска));
				Если ВременнаяТаблица.Количество() = 0 Тогда
					Продолжить;
				КонецЕсли;
				Если ЗначениеЗаполнено(СтрокаДохода.СуммаДохода) Тогда
					Если ВременнаяТаблица.Количество() = 1 Тогда
						ВременнаяТаблица[0].СуммаФактическиПолученногоДохода = СтрокаДохода.СуммаДохода
					Иначе
						КоэффициентыРаспределения = ВременнаяТаблица.ВыгрузитьКолонку("Сумма");
						РаспределениеРесурса = ЗарплатаКадрыКлиентСервер.РаспределитьПропорциональноКоэффициентам(СтрокаДохода.СуммаДохода, КоэффициентыРаспределения);
						Если РаспределениеРесурса <> Неопределено Тогда
							ВременнаяТаблица.ЗагрузитьКолонку(РаспределениеРесурса, "СуммаФактическиПолученногоДохода");
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
				ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВременнаяТаблица, ОбработанныеДанные)
			КонецЦикла;
			
			Запрос.УстановитьПараметр("ОбработанныеДанные", ОбработанныеДанные); 
			Запрос.Текст =
			"ВЫБРАТЬ
			|	Данные.ФизическоеЛицо,
			|	Данные.ДатаПолученияДохода,
			|	Данные.ДатаУдержания,
			|	Данные.СрокПеречисления,
			|	Данные.СуммаФактическиПолученногоДохода
			|ПОМЕСТИТЬ ВТОбработанныеДанные
			|ИЗ
			|	&ОбработанныеДанные КАК Данные";
			Запрос.Выполнить();
			
			НеОбработанныеДанные = Неопределено; СуммыДоходов = Неопределено; ОбработанныеДанные = Неопределено; ВременнаяТаблица = Неопределено;

			ТекстЗапроса =
			"ВЫБРАТЬ
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода КАК ДатаФактическогоПолученияДохода,
			|	НалогиПоДатам.ДатаПолученияДохода КАК П000020010001,
			|	НалогиПоДатам.ДатаУдержания КАК ДатаУдержанияНалога,
			|	НалогиПоДатам.ДатаУдержания КАК П000020011001,
			|	НалогиПоДатам.СрокПеречисления КАК СрокПеречисленияНалога,
			|	НалогиПоДатам.СрокПеречисления КАК П000020012001,
			|	СУММА(НалогиПоДатам.СуммаФактическиПолученногоДохода) < 0 КАК ОтрицательныйДоход,
			|	СУММА(НалогиПоДатам.СуммаФактическиПолученногоДохода) КАК П000020013001,
			|	СУММА(НалогиПоДатам.Сумма) КАК П000020014001
			|ИЗ
			|	(ВЫБРАТЬ
			|		Данные.ДокументОснование КАК Регистратор,
			|		Данные.ФизическоеЛицо КАК ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|		Данные.ДатаУдержания КАК ДатаУдержания,
			|		Данные.СрокПеречисления КАК СрокПеречисления,
			|		Данные.СуммаВыплаченногоДохода КАК СуммаФактическиПолученногоДохода,
			|		Данные.Сумма КАК Сумма
			|	ИЗ
			|		ВТИсходныеДанныеПоДокументамОснованиям КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Данные.Регистратор,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		Данные.СуммаДохода,
			|		0
			|	ИЗ
			|		ВТНатуральныеДоходы КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		НЕОПРЕДЕЛЕНО,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		Данные.ДатаУдержания,
			|		Данные.СрокПеречисления,
			|		Данные.СуммаФактическиПолученногоДохода,
			|		0
			|	ИЗ
			|		ВТОбработанныеДанные КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Данные.Регистратор,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0),
			|		Данные.СуммаДохода,
			|		0
			|	ИЗ
			|		ВТДоходыБезНалогов КАК Данные
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		Данные.Регистратор,
			|		Данные.ФизическоеЛицо,
			|		Данные.ДатаПолученияДохода,
			|		Данные.ДатаУдержания,
			|		Данные.СрокПеречисления,
			|		Данные.СуммаФактическиПолученногоДохода,
			|		Данные.Сумма
			|	ИЗ
			|		ВТОбработанныеДанныеПоДокументамОснованиям КАК Данные) КАК НалогиПоДатам
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДатаУдержания,
			|	НалогиПоДатам.СрокПеречисления,
			|	НалогиПоДатам.ДатаПолученияДохода,
			|	НалогиПоДатам.ДатаУдержания,
			|	НалогиПоДатам.СрокПеречисления
			|
			|УПОРЯДОЧИТЬ ПО
			|	ДатаУдержанияНалога,
			|	СрокПеречисленияНалога,
			|	ДатаФактическогоПолученияДохода";
			
			МассивПолей = Новый Массив;
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
			СводныйРезультат = Запрос.Выполнить().Выгрузить();
			
			Если СводныйРезультат.Найти(Истина,"ОтрицательныйДоход") <> Неопределено Тогда
				
				Запрос.Текст = ТекстЗапроса;
				ВременнаяТаблица = Запрос.Выполнить().Выгрузить();
				
				ОстатокПересчета = 0;
				ОстаткиПересчетаПоФизлицам = Новый Соответствие;
				ОстатокНалогов = 0;
				ОстаткиНалоговПоФизлицам = Новый Соответствие;
				Для каждого СтрокаТЗ Из ВременнаяТаблица Цикл
					Если СтрокаТЗ.П000020013001 = 0 Тогда
					ИначеЕсли СтрокаТЗ.П000020013001 > 0 Тогда
						Если ОстатокПересчета > 0 Тогда
							ОстатокФизлица = ОстаткиПересчетаПоФизлицам[СтрокаТЗ.ФизическоеЛицо];
							Если ЗначениеЗаполнено(ОстатокФизлица) Тогда
								КЗачету = Мин(СтрокаТЗ.П000020013001, ОстатокФизлица);
								СтрокаТЗ.П000020013001 = СтрокаТЗ.П000020013001 - КЗачету;
								ОстатокПересчета = ОстатокПересчета - КЗачету;
								ОстаткиПересчетаПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ОстатокФизлица - КЗачету);
							КонецЕсли;
						КонецЕсли;
						Если ОстатокНалогов > 0 Тогда
							ОстатокФизлица = ОстаткиНалоговПоФизлицам[СтрокаТЗ.ФизическоеЛицо];
							Если ЗначениеЗаполнено(ОстатокФизлица) Тогда
								КЗачету = Мин(СтрокаТЗ.П000020014001, ОстатокФизлица);
								СтрокаТЗ.П000020014001 = СтрокаТЗ.П000020014001 - КЗачету;
								ОстатокНалогов = ОстатокНалогов - КЗачету;
								ОстаткиНалоговПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ОстатокФизлица - КЗачету);
							КонецЕсли;
						КонецЕсли;
					Иначе
						ОстатокПересчета = ОстатокПересчета - СтрокаТЗ.П000020013001;
						ОстаткиПересчетаПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ?(ЗначениеЗаполнено(ОстаткиПересчетаПоФизлицам[СтрокаТЗ.ФизическоеЛицо]),ОстаткиПересчетаПоФизлицам[СтрокаТЗ.ФизическоеЛицо],0) - СтрокаТЗ.П000020013001);
						Если СтрокаТЗ.П000020014001 < 0 Тогда
							ОстатокНалогов = ОстатокНалогов - СтрокаТЗ.П000020014001;
							ОстаткиНалоговПоФизлицам.Вставить(СтрокаТЗ.ФизическоеЛицо, ?(ЗначениеЗаполнено(ОстаткиНалоговПоФизлицам[СтрокаТЗ.ФизическоеЛицо]),ОстаткиНалоговПоФизлицам[СтрокаТЗ.ФизическоеЛицо],0) - СтрокаТЗ.П000020014001);
						КонецЕсли;
					КонецЕсли;
				КонецЦикла;
				Если ОстатокПересчета > 0 Тогда
					ВсегоСтрок = ВременнаяТаблица.Количество();
					Для Счетчик = 1 По ВсегоСтрок Цикл
						СтрокаТЗ = ВременнаяТаблица[ВсегоСтрок - Счетчик];
						Если СтрокаТЗ.П000020013001 < 0 Тогда
							Если ОстатокПересчета = 0 Тогда
							ИначеЕсли СтрокаТЗ.П000020013001 < -ОстатокПересчета Тогда
								ОстатокПересчета = 0;
							Иначе
								ОстатокПересчета = ОстатокПересчета + СтрокаТЗ.П000020013001;
							КонецЕсли;
							СтрокаТЗ.П000020013001 = 0;
						КонецЕсли;
						Если ОстатокНалогов > 0 Тогда
							Если СтрокаТЗ.П000020014001 < 0 Тогда
								Если ОстатокНалогов = 0 Тогда
								ИначеЕсли СтрокаТЗ.П000020014001 < -ОстатокНалогов Тогда
									ОстатокНалогов = 0;
								Иначе
									ОстатокНалогов = ОстатокНалогов + СтрокаТЗ.П000020014001;
								КонецЕсли;
								СтрокаТЗ.П000020014001 = 0;
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
				Иначе
					Для каждого СтрокаТЗ Из ВременнаяТаблица Цикл
						Если СтрокаТЗ.П000020013001 < 0 Тогда
							СтрокаТЗ.П000020013001 = 0;
							Если ОстатокНалогов = 0 И СтрокаТЗ.П000020014001 < 0 Тогда
								СтрокаТЗ.П000020014001 = 0;
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				
				ОписаниеТаблиц.Раздел2 = ВременнаяТаблица.СкопироватьКолонки();
				ВременнаяТаблица.Свернуть("ДатаФактическогоПолученияДохода,П000020010001,ДатаУдержанияНалога,П000020011001,СрокПеречисленияНалога,П000020012001" + ?(ПодробныеДанные, ",ФизическоеЛицо", ""),"П000020014001,П000020013001");
				Для каждого СтрокаТЗ Из ВременнаяТаблица Цикл
					Если СтрокаТЗ.П000020013001 <> 0 Или СтрокаТЗ.П000020014001 <> 0 Тогда
						ЗаполнитьЗначенияСвойств(ОписаниеТаблиц.Раздел2.Добавить(), СтрокаТЗ);
					КонецЕсли;
				КонецЦикла;
				
			ИначеЕсли ПодробныеДанные Тогда
				Запрос.Текст = ТекстЗапроса;
				ОписаниеТаблиц.Раздел2 = Запрос.Выполнить().Выгрузить();
			Иначе
				ОписаниеТаблиц.Раздел2 = СводныйРезультат.СкопироватьКолонки();
				Для каждого СтрокаТЗ Из СводныйРезультат Цикл
					Если СтрокаТЗ.П000020013001 <> 0 Или СтрокаТЗ.П000020014001 <> 0 Тогда
						ЗаполнитьЗначенияСвойств(ОписаниеТаблиц.Раздел2.Добавить(), СтрокаТЗ);
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОписаниеПоказателей_6НДФЛ_2021Кв1(ПоказателиОтчета) Экспорт
	
	
	// Раздел 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010001001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М102101", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М102201", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М203101", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М203201", Истина, Истина);
	
	// Раздел 2
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010501", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011303", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020017003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020018003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019003", Истина, Истина);
	
	// Приложение 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000011", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000012", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600005", Истина, Ложь);

КонецПроцедуры

Процедура ЗначенияПоказателей_6НДФЛ_2021Кв1(ПараметрыОтчета, Контейнер) Экспорт
	
	ДатаКонцаПериодаОтчета = ПараметрыОтчета.ДатаКонцаПериодаОтчета;
	Организация = ПараметрыОтчета.Организация;
	НачалоПериода = НачалоГода(ДатаКонцаПериодаОтчета);
	ОкончаниеПериода = КонецМесяца(ДатаКонцаПериодаОтчета);
	НомерКорректировки = ПараметрыОтчета.НомерКорректировки;
	Если ПараметрыОтчета.Свойство("РегистрацииВНО") Тогда
		РегистрацияВНалоговомОргане = ПараметрыОтчета.РегистрацииВНО;
	Иначе
		ТитульныйЛист = Контейнер.Титульный;
		ПараметрыОтбораРегистрацийВНО = Новый Структура;
		ПараметрыОтбораРегистрацийВНО.Вставить("КодНО", ТитульныйЛист.НалоговыйОрган);
		ПараметрыОтбораРегистрацийВНО.Вставить("ОКТМО", ТитульныйЛист.ОКТМО);
		Если СтрДлина(ТитульныйЛист.ИНН) = 10 Тогда
			ПараметрыОтбораРегистрацийВНО.Вставить("КПП", ТитульныйЛист.КПП);
			ПараметрыОтбораРегистрацийВНО.Вставить("ИскатьПоПервымСимволамОКТМО", Истина);
		КонецЕсли;
		РегистрацияВНалоговомОргане = РегламентированнаяОтчетность.РегистрацииОрганизацииВНалоговомОргане(Организация, ПараметрыОтбораРегистрацийВНО);
	КонецЕсли;
	ЗаполнятьПриложение1 = КонецМесяца(ОкончаниеПериода) = КонецГода(ОкончаниеПериода);
	Если ПараметрыОтчета.Свойство("ЗаполнятьПриложение1") Тогда
		ЗаполнятьПриложение1 = ПараметрыОтчета.ЗаполнятьПриложение1;
	КонецЕсли;
	
	НомерПервойСправки = 1;
	
	Если Не ЗначениеЗаполнено(РегистрацияВНалоговомОргане) Тогда
		Возврат
	КонецЕсли;
	                         
	// Очистка отчета
	ПоказателиОтчета = Новый Структура;
	ОписаниеПоказателей_6НДФЛ_2021Кв1(ПоказателиОтчета);
	
	ДанныеРаздела1 = Контейнер.Раздел1.Строки;
	ПоляКБК = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].Данные); 
	ПоляСуммКПеречислению = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].ДанныеМногострочныхЧастей.П00001М1.Строки[0].Данные);
	ПоляСуммВозврата = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].ДанныеМногострочныхЧастей.П00001М2.Строки[0].Данные);
	ДанныеРаздела1.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляКБК);
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляСуммКПеречислению);
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляСуммВозврата);
	
	ДанныеРаздела2 = Контейнер.Раздел2.Строки;
	ПоляРаздела2 = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела2[0].Данные); 
	ДанныеРаздела2.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляРаздела2);
	
	Если ЗаполнятьПриложение1 Тогда
		
		ДанныеПриложение1 = Контейнер.Приложение1.Строки;
		ДанныеСправки = ДанныеПриложение1[0].ДанныеМногострочныхЧастей.П000П1М1.Строки;
		ПоляНалогоплательщика = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеПриложение1[0].Данные);
		ПоляИтогов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].Данные);
		ПоляВычетов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М2.Строки[0].Данные);
		ПоляУведомленийОВычетах = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М3.Строки[0].Данные);
		ПоляНеудержано = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М4.Строки[0].Данные);
		ПоляДоходов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].Данные);
		ПоляВычетовКДоходам = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].ДанныеМногострочныхЧастей.П000П1М6.Строки[0].Данные);
		ДанныеПриложение1.Очистить();
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляНалогоплательщика);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляИтогов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляУведомленийОВычетах);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляДоходов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетовКДоходам);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляНеудержано);
		
	КонецЕсли;
	
	// Сбор данных
	ОписаниеТаблиц = Новый Структура("КоличествоПолучателейДохода, Раздел1Налоги, Раздел1Возвраты, Раздел2Доходы, Раздел2Вычеты, Раздел2Налоги, КоличествоПолучателейДохода");
	Если ЗаполнятьПриложение1 Тогда
		ОписаниеТаблиц.Вставить("Приложение1Налогоплательщики");	
		Если НомерКорректировки <> 99 Тогда
			ОписаниеТаблиц.Вставить("Приложение1Итоги");	
			ОписаниеТаблиц.Вставить("Приложение1Доходы");	
			ОписаниеТаблиц.Вставить("Приложение1Вычеты");	
			ОписаниеТаблиц.Вставить("Приложение1УведомленияОВычетах");	
		КонецЕсли;
	КонецЕсли;
	РасчетПоказателей_6НДФЛ_2021Кв1(НачалоПериода, ОкончаниеПериода, ?(ПараметрыОтчета.ДатаПодписи > ОкончаниеПериода,ПараметрыОтчета.ДатаПодписи, ОкончаниеПериода), Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, Ложь, НомерКорректировки);	
	
	// Вывод данных в отчет
	
	ВсеКБК = Новый Массив;
	ВсеКБК.Добавить("18210102010011000110");
	ВсеКБК.Добавить("18210102060011000110");
	ВсеКБК.Добавить("18210102070011000110");
	ВсеКБК.Добавить("18210102080011000110");
	ПоискПоКБК = Новый Структура("КБК");
	
	// Раздел 1
	Налоги = ОписаниеТаблиц.Раздел1Налоги;
	Возвраты = ОписаниеТаблиц.Раздел1Возвраты;
	Для каждого КБК Из ВсеКБК Цикл
		
		ПоискПоКБК.КБК = КБК;
		СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБК);
		СтрокиВозвратов = Возвраты.НайтиСтроки(ПоискПоКБК);
		
		Если СтрокиНалогов.Количество() > 0 Или СтрокиВозвратов.Количество() > 0 Тогда
			СтраницаРаздела1 = ДанныеРаздела1.Добавить();
			СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
			СтраницаРаздела1.Данные.П000010001001 = КБК;
			СтраницаРаздела1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П00001М1,П00001М2");
			Если СтрокиНалогов.Количество() = 0 Тогда
				НоваяСтрокаСуммКПеречислению = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М1.Строки.Добавить();
				НоваяСтрокаСуммКПеречислению.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммКПеречислению);
			КонецЕсли;
			Если СтрокиВозвратов.Количество() = 0 Тогда
				НоваяСтрокаСуммВозврата = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить();
				НоваяСтрокаСуммВозврата.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
			КонецЕсли;
		КонецЕсли;
		Для каждого СтрокаНалогов Из СтрокиНалогов Цикл
			НоваяСтрокаСуммКПеречислению = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М1.Строки.Добавить();
			НоваяСтрокаСуммКПеречислению.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммКПеречислению);
			ЗаполнитьЗначенияСвойств(НоваяСтрокаСуммКПеречислению.Данные, СтрокаНалогов);
		КонецЦикла;
		Для каждого СтрокаВозвратов Из СтрокиВозвратов Цикл
			НоваяСтрокаСуммВозврата = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить();
			НоваяСтрокаСуммВозврата.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
			ЗаполнитьЗначенияСвойств(НоваяСтрокаСуммВозврата.Данные, СтрокаВозвратов);
		КонецЦикла;
		
	КонецЦикла;
	Если ДанныеРаздела1.Количество() = 0 Тогда
		СтраницаРаздела1 = ДанныеРаздела1.Добавить();
		СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
		СтраницаРаздела1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П00001М1,П00001М2");
		СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М1.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммКПеречислению);
		СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
	КонецЕсли;
	
	// Раздел 2
	Доходы = ОписаниеТаблиц.Раздел2Доходы;
	Вычеты = ОписаниеТаблиц.Раздел2Вычеты;
	Налоги = ОписаниеТаблиц.Раздел2Налоги;
	Количество = ОписаниеТаблиц.КоличествоПолучателейДохода;
	ПоискПоКБКиСтавке = Новый Структура("КБК,Ставка");
	Для каждого Ставка Из Перечисления.НДФЛСтавки Цикл
		ПоискПоКБКиСтавке.Ставка = Ставка;
		Для каждого КБК Из ВсеКБК Цикл
			
			ПоискПоКБКиСтавке.КБК = КБК;
			СтрокиДоходов = Доходы.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиВычетов = Вычеты.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиКоличества = Количество.НайтиСтроки(ПоискПоКБКиСтавке);
			
			Если СтрокиДоходов.Количество() > 0 Или СтрокиНалогов.Количество() > 0 Или СтрокиВычетов.Количество() > 0 Тогда
				СтраницаРаздела = ДанныеРаздела2.Добавить();
				СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
				СтраницаРаздела.Данные.П000020010501 = КБК;
				Если Ставка = Перечисления.НДФЛСтавки.Ставка03 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 3
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка05 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 5
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка06 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 6
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка07 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 7
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка09 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 9
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка10 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 10
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка12 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 12
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка13 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 13
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка15 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 15
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка30 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 30
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка35 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 35
				Иначе
					
				КонецЕсли;
				СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
			КонецЕсли;
			Для каждого СтрокаДанных Из СтрокиДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиНалогов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиВычетов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиКоличества Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			
		КонецЦикла;
	КонецЦикла;
	Если ДанныеРаздела2.Количество() = 0 Тогда
		СтраницаРаздела = ДанныеРаздела2.Добавить();
		СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
		СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
	КонецЕсли;
	
	// Приложение 1
	Если ЗаполнятьПриложение1 Тогда
		Если ОписаниеТаблиц.Приложение1Налогоплательщики.Количество() > 0 Тогда
			
			СоответствиеСтавокДоходов = УчетНДФЛ.СоответствиеДоходовСтавкам();
			СоответствиеКодовСтран = Новый Соответствие;
			СоответствиеИменСтран = Новый Соответствие;
			СоответствиеДокументовУдостоверяющихЛичность = Новый Соответствие;
			СоответствиеКодовДоходов = Новый Соответствие;
			СоответствиеКодовФНССтатусамНДФЛ = Новый Соответствие;
			УчетНДФЛ.ПрочитатьКлассификаторыВСоответствия(СоответствиеКодовСтран, 
				СоответствиеИменСтран, 
				СоответствиеДокументовУдостоверяющихЛичность,
				СоответствиеКодовДоходов, 
				СоответствиеКодовФНССтатусамНДФЛ);
			
			СоответствиеСтавок = Новый Соответствие;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка03] = 3;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка05] = 5;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка06] = 6;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка07] = 7;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка09] = 9;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка10] = 10;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка12] = 12;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка13] = 13;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка15] = 15;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка30] = 30;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка35] = 35;
			
			Если НомерКорректировки <> 99 Тогда
				Приложение1Итоги = ОписаниеТаблиц.Приложение1Итоги;
				Если Приложение1Итоги.Количество() > 100 Тогда
					Приложение1Итоги.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				Приложение1Доходы = ОписаниеТаблиц.Приложение1Доходы;
				Если Приложение1Доходы.Количество() > 100 Тогда
					Приложение1Доходы.Индексы.Добавить("ФизическоеЛицо,Ставка");
				КонецЕсли;
				Приложение1Вычеты = ОписаниеТаблиц.Приложение1Вычеты;
				Если Приложение1Вычеты.Количество() > 100 Тогда
					Приложение1Вычеты.Индексы.Добавить("ФизическоеЛицо,Ставка");
				КонецЕсли;
				Приложение1УведомленияОВычетах = ОписаниеТаблиц.Приложение1УведомленияОВычетах;
				Если Приложение1УведомленияОВычетах.Количество() > 100 Тогда
					Приложение1УведомленияОВычетах.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				ПоискПоФизлицу = Новый Структура("ФизическоеЛицо");
				ПоискПоФизлицуИСтавке = Новый Структура("ФизическоеЛицо,Ставка");
			КонецЕсли;
			
			Для каждого СтрокаДанных Из ОписаниеТаблиц.Приложение1Налогоплательщики Цикл
				
				СтраницаПриложение1 = ДанныеПриложение1.Добавить();
				СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
				СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
				СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
				НомерПервойСправки = НомерПервойСправки + 1;
				СтраницаПриложение1.Данные.П000П10000002 = "00";
				СтраницаПриложение1.Данные.П000П10000003 = СтрокаДанных.ИНН;
				СтраницаПриложение1.Данные.П000П10000004 = СокрЛП(СтрокаДанных.Фамилия);
				СтраницаПриложение1.Данные.П000П10000005 = СокрЛП(СтрокаДанных.Имя);
				СтраницаПриложение1.Данные.П000П10000006 = СокрЛП(СтрокаДанных.Отчество);
				Описание = СоответствиеКодовФНССтатусамНДФЛ.Получить(СтрокаДанных.СтатусНалогоплательщика);
				СтраницаПриложение1.Данные.П000П10000007 = ?(Описание = Неопределено, "", Описание.КодФНС_2015);
				СтраницаПриложение1.Данные.П000П10000008 = СтрокаДанных.ДатаРождения;
				СтраницаПриложение1.Данные.П000П10000009 = ФизическиеЛицаЗарплатаКадры.КодСтраныДляОтчетности(СоответствиеКодовСтран, СтрокаДанных.Гражданство, СтрокаДанных.СтранаВыдачиДокумента);
				Описание = СоответствиеДокументовУдостоверяющихЛичность.Получить(СтрокаДанных.ВидДокумента);
				СтраницаПриложение1.Данные.П000П10000010 = ?(Описание = Неопределено, "", Описание.КодМВД_2015);
				СтраницаПриложение1.Данные.П000П10000011 = СокрЛП(СтрокаДанных.СерияДокумента);
				СтраницаПриложение1.Данные.П000П10000012 = СокрЛП(СтрокаДанных.НомерДокумента);
				
				ВыводитьДоходы = НомерКорректировки <> 99;
				Если ВыводитьДоходы Тогда
					ПоискПоФизлицу.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					ПоискПоФизлицуИСтавке.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					СтрокиФизлица = Приложение1Итоги.НайтиСтроки(ПоискПоФизлицу);
					ВыводитьДоходы = СтрокиФизлица.Количество() > 0;
				КонецЕсли;
				Если ВыводитьДоходы Тогда
					Для каждого СтрокаИтоговПоСтавке Из СтрокиФизлица Цикл
						
						ПоискПоФизлицуИСтавке.Ставка = СтрокаИтоговПоСтавке.Ставка;
						СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
						СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
						ЗаполнитьЗначенияСвойств(СтраницаПоСтавке.Данные, СтрокаИтоговПоСтавке);
						СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
						СтрокиДанных = Приложение1Вычеты.НайтиСтроки(ПоискПоФизлицуИСтавке);
						ВыводитьИмущественныйВычет = Ложь;
						ВыводитьСоциальныйВычет = Ложь;
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если СтрокаДанных.П000П1М200002 <> 0 Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									Если Не ВыводитьИмущественныйВычет Тогда
										ВыводитьИмущественныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные 
									КонецЕсли;
									Если Не ВыводитьСоциальныйВычет Тогда
										ВыводитьСоциальныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.СоциальныеПоУведомлениюНО
									КонецЕсли;
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
						Если СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Количество() = 0 Тогда
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
						КонецЕсли;	
						
						СтрокиДанных = Приложение1УведомленияОВычетах.НайтиСтроки(ПоискПоФизлицу);
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ВыводитьИмущественныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "1"
								КонецЕсли;
								Если ВыводитьСоциальныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "2"
								КонецЕсли;
								Если СтрокаИтоговПоСтавке.П000П1М100006 > 0 И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.ПустаяСсылка() Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "3"
								КонецЕсли;
							КонецЦикла;
							Если СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Количество() = 0 Тогда
								СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
							КонецЕсли;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
						КонецЕсли;
						
						СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
						СтрокиДанных = Приложение1Доходы.Скопировать(Приложение1Доходы.НайтиСтроки(ПоискПоФизлицуИСтавке));
						Если СтрокиДанных.Количество() > 0 Тогда
							СтрокиДанных.Сортировать("Период,П000П1М500002");
							ТекущийКод = Неопределено;
							ТекущийПериод = Неопределено;
							ПредыдущаяСтрока = Неопределено; 
							СуммаДохода = 0;
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ТекущийПериод <> СтрокаДанных.Период Или ТекущийКод <> СтрокаДанных.П000П1М500002 Тогда
									Если ПредыдущаяСтрока <> Неопределено Тогда
										ПредыдущаяСтрока.Данные.П000П1М500003 = СуммаДохода;
										Если ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
											СтрокаВычета = ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
											СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
											СтрокаВычета.Данные.П000П1М600004 = "";
										КонецЕсли;
									КонецЕсли;
									ТекущийКод = СтрокаДанных.П000П1М500002; 
									ТекущийПериод = СтрокаДанных.Период;
									СуммаДохода = 0;
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
									ПредыдущаяСтрока = СтрокаПоСтавке;  
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М500001 = Формат(СтрокаДанных.Период, "ДФ=MM");
									СтрокаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
								КонецЕсли;
								СуммаДохода = СуммаДохода + СтрокаДанных.П000П1М500003;
								Если ЗначениеЗаполнено(СтрокаДанных.П000П1М600004) Тогда
									СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
									СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
									ЗаполнитьЗначенияСвойств(СтрокаВычета.Данные, СтрокаДанных);
								КонецЕсли;
							КонецЦикла;
							СтрокаПоСтавке.Данные.П000П1М500003 = СуммаДохода;
							Если СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
								СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
								СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
								СтрокаВычета.Данные.П000П1М600004 = "";
							КонецЕсли;
						Иначе
							СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
							СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
							СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
							СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
						КонецЕсли;
						
					КонецЦикла; 
				Иначе
					СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
					СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
					СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
					СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
					СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
					СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
				КонецЕсли;
				
			КонецЦикла;
			
		Иначе 
			СтраницаПриложение1 = ДанныеПриложение1.Добавить();
			СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
			СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
			СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
			СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
			СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
			СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
			СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
			СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
		КонецЕсли;
	КонецЕсли;
		
КонецПроцедуры

Процедура РасчетПоказателей_6НДФЛ_2021Кв1(НачалоПериода, ОкончаниеПериода, ДатаПодписи, Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, ПодробныеДанные, НомерКорректировки) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("НачалоПредыдущегоГода", ДобавитьМесяц(НачалоПериода, -12));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("ДатаПодписи", КонецДня(ДатаПодписи));
	Запрос.УстановитьПараметр("КБКсПревышения", "18210102080011000110");
	Запрос.УстановитьПараметр("ОсновнойКБК", "18210102010011000110");
	Запрос.УстановитьПараметр("КБКПоОблигациям", "18210102070011000110");
	Запрос.УстановитьПараметр("НачалоОтчетногоКвартала", НачалоКвартала(ОкончаниеПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериодаОсмотраДоходовВычетов", ?(КонецГода(ОкончаниеПериода) = ОкончаниеПериода Или ЗначениеЗаполнено(НомерКорректировки), Макс(ДатаПодписи, ОкончаниеПериода), ОкончаниеПериода));
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) КАК КатегорияДохода,
	|	&ОсновнойКБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходВНатуральнойФормеОтТрудовойДеятельности),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеНатуральныеДоходы),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыВДенежнойФормеОтТрудовойДеятельности),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходы),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыОтДолевогоУчастия),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоВыигрышам),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыЦБ),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыРЕПО),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыЗаймЦБ),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыИИС),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоОблигациям),
	|	&КБКПоОблигациям";
	Запрос.Выполнить();
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Раздел1Возвраты") Или ОписаниеТаблиц.Свойство("Приложение1Итоги") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения КАК ВидДвижения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода КАК РасчетМежрасчетногоПериода,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	ВЫБОР
		|		КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА ВЫБОР
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА 0
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов > 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов < 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Тогда
		
		Если НачалоКвартала(ОкончаниеПериода) = '20210101' Тогда
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СтрокиНалогов.КБК КАК КБК,
			|	СтрокиНалогов.Регистратор КАК Регистратор,
			|	СтрокиНалогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СтрокиНалогов.КрайнийСрокУплаты КАК СрокПеречисленияНалога,
			|	СтрокиНалогов.КрайнийСрокУплаты КАК П00001М102101,
			|	СтрокиНалогов.Сумма КАК П00001М102201
			|ПОМЕСТИТЬ ВТСтрокиНалогов
			|ИЗ
			|	ВТНалоги КАК СтрокиНалогов
			|ГДЕ
			|	СтрокиНалогов.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И СтрокиНалогов.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	&КБКсПревышения,
			|	СтрокиНалогов.Регистратор,
			|	СтрокиНалогов.ФизическоеЛицо,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.СуммаСПревышения
			|ИЗ
			|	ВТНалоги КАК СтрокиНалогов
			|ГДЕ
			|	СтрокиНалогов.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И СтрокиНалогов.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	СтрокиНалогов.КБК,
			|	СтрокиНалогов.Регистратор,
			|	СтрокиНалогов.ФизическоеЛицо,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.Сумма
			|ИЗ
			|	ВТНалоги КАК СтрокиНалогов
			|ГДЕ
			|	СтрокиНалогов.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И СтрокиНалогов.КрайнийСрокУплаты >= ДАТАВРЕМЯ(2021, 1, 1, 0, 0, 0)
			|	И СтрокиНалогов.ДатаУдержания < ДАТАВРЕМЯ(2021, 1, 1, 0, 0, 0)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.КБК КАК КБК,
			|	НалогиПоДатам.Регистратор КАК Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НалогиПоДатам.СрокПеречисленияНалога КАК СрокПеречисленияНалога,
			|	НалогиПоДатам.П00001М102101 КАК П00001М102101,
			|	СУММА(НалогиПоДатам.П00001М102201) КАК П00001М102201
			|ИЗ
			|	ВТСтрокиНалогов КАК НалогиПоДатам
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.КБК,
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.СрокПеречисленияНалога,
			|	НалогиПоДатам.П00001М102101
			|
			|ИМЕЮЩИЕ
			|	СУММА(НалогиПоДатам.П00001М102201) > 0
			|
			|УПОРЯДОЧИТЬ ПО
			|	СрокПеречисленияНалога";
			
		Иначе
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	НалогиПоДатам.КБК КАК КБК,
			|	НалогиПоДатам.Регистратор КАК Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисленияНалога,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК П00001М102101,
			|	СУММА(НалогиПоДатам.Сумма) КАК П00001М102201
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.КБК,
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	НалогиПоДатам.КрайнийСрокУплаты
			|
			|ИМЕЮЩИЕ
			|	СУММА(НалогиПоДатам.Сумма) > 0
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	&КБКсПревышения,
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	СУММА(НалогиПоДатам.СуммаСПревышения)
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	НалогиПоДатам.КрайнийСрокУплаты
			|
			|ИМЕЮЩИЕ
			|	СУММА(НалогиПоДатам.СуммаСПревышения) > 0
			|
			|УПОРЯДОЧИТЬ ПО
			|	СрокПеречисленияНалога";
			
		КонецЕсли;
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1Налоги = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Возвраты") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.Период КАК ДатаВозврата,
		|	НалогиПоДатам.Период КАК П00001М203101,
		|	-СУММА(НалогиПоДатам.Сумма) КАК П00001М203201
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.Период МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.Период,
		|	НалогиПоДатам.Период
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	&КБКсПревышения,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.Период,
		|	НалогиПоДатам.Период,
		|	-СУММА(НалогиПоДатам.СуммаСПревышения)
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.Период МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.Период,
		|	НалогиПоДатам.Период
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) < 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ДатаВозврата";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1Возвраты = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") 
		Или ОписаниеТаблиц.Свойство("Приложение1Доходы") Или ОписаниеТаблиц.Свойство("Приложение1Вычеты") Тогда
		
		ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТФизическиеЛицаОтчета
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента
		|ПОМЕСТИТЬ ВТСтрокиДоходов
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		Запрос.Выполнить();
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиДоходов", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
		
		Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза());
		Запрос.УстановитьПараметр("Предел", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел);
		Запрос.УстановитьПараметр("СтавкаСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Ставка);
		Запрос.УстановитьПараметр("СтавкаЧисломСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом * 100);
		Запрос.УстановитьПараметр("ГодПериода", Год(ОкончаниеПериода));
			
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ВЫБОР
		|		КОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КатегорияДохода
		|	КОНЕЦ КАК НалоговаяБаза,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ КАК КодВычета,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
		|ПОМЕСТИТЬ ВТДоходыПоСтавкам
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО СведенияОДоходахНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|			ИЛИ СведенияОДоходахНДФЛ.СуммаВычета <> 0)
		|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|
		|СГРУППИРОВАТЬ ПО
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане),
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор КАК Регистратор,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма КАК Сумма,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета
		|ПОМЕСТИТЬ ВТСтандартныеИмущественныеВычеты
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
		|ГДЕ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма <> 0
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ИмущественныеВычетыНДФЛ.Регистратор,
		|	ИмущественныеВычетыНДФЛ.ФизическоеЛицо,
		|	ИмущественныеВычетыНДФЛ.КодВычета,
		|	ИмущественныеВычетыНДФЛ.Сумма,
		|	ИмущественныеВычетыНДФЛ.Период,
		|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане)
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
		|ГДЕ
		|	ИмущественныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
		|	И ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычетыНДФЛ.Сумма <> 0
		|	И ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ИмущественныеВычетыНДФЛ.Год = &ГодПериода
		|	И ИмущественныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		УстановитьПривилегированныйРежим(Истина);
		Запрос.Выполнить();
		УстановитьПривилегированныйРежим(Ложь);
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	База.ФизическоеЛицо КАК ФизическоеЛицо,
		|	База.НалоговаяБаза КАК НалоговаяБаза
		|ПОМЕСТИТЬ ВТСотрудникиСПревышением
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
		|		ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
		|		ДоходыПоСтавкам.СуммаДохода - ДоходыПоСтавкам.СуммаВычета КАК ОблагаемаяБаза
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
		|	ГДЕ
		|		ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтандартныеИмущественныеВычеты.ФизическоеЛицо,
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		-СтандартныеИмущественныеВычеты.Сумма
		|	ИЗ
		|		ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты) КАК База
		|
		|СГРУППИРОВАТЬ ПО
		|	База.ФизическоеЛицо,
		|	База.НалоговаяБаза
		|
		|ИМЕЮЩИЕ
		|	СУММА(База.ОблагаемаяБаза) > &Предел";
		
		Если Запрос.Выполнить().Выгрузить()[0].Количество > 0 Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК НачалоМесяца,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза КАК НалоговаяБаза,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) КАК ОблагаемыйДоход,
			|	0 КАК ОблагаемыйДоходСНачалаГода,
			|	ЛОЖЬ КАК ЭтоДеньПревышенияПредела,
			|	ЛОЖЬ КАК ПределПревышен
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.НалоговаяБаза = СотрудникиСПревышением.НалоговаяБаза
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза
			|
			|ИМЕЮЩИЕ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) <> 0
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	Период";
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СУММА(СтандартныеИмущественныеВычеты.Сумма) КАК Сумма,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяца
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СтандартныеИмущественныеВычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) = СотрудникиСПревышением.НалоговаяБаза)
			|
			|СГРУППИРОВАТЬ ПО
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ)";
			ТаблицаВычетов = Запрос.Выполнить().Выгрузить();
			ИскатьВычеты = ТаблицаВычетов.Количество() > 0;
			Если ИскатьВычеты И ТаблицаВычетов.Количество() > 100 Тогда
				ТаблицаВычетов.Индексы.Добавить("ФизическоеЛицо,НачалоМесяца");
			КонецЕсли;
			ПоискВычетов = Новый Структура("ФизическоеЛицо,НачалоМесяца");
			
			// Расчет облагаемого дохода нарастающим итогом с учетом всех вычетов для каждой даты получения дохода.
			ОблагаемыйДоходСНачалаГода = 0;
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			ТекущееНачалоМесяца = Неопределено;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					ОблагаемыйДоходСНачалаГода = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
					ТекущееНачалоМесяца = Неопределено;
				КонецЕсли;
				// Стандартные, имущественные вычеты учтем один раз за каждый месяц - в первую дату получения дохода месяца.
				ПредоставленныеВычеты = 0;
				Если ИскатьВычеты И СтрокаТаблицы.НалоговаяБаза = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда И ТекущееНачалоМесяца <> СтрокаТаблицы.НачалоМесяца Тогда
					ЗаполнитьЗначенияСвойств(ПоискВычетов, СтрокаТаблицы);
					СтрокиВычетов = ТаблицаВычетов.НайтиСтроки(ПоискВычетов);
					Если СтрокиВычетов.Количество() > 0 Тогда
						ПредоставленныеВычеты = СтрокиВычетов[0].Сумма;
					КонецЕсли;
					ТекущееНачалоМесяца = СтрокаТаблицы.НачалоМесяца;
				КонецЕсли;
				СтрокаТаблицы.ЭтоДеньПревышенияПредела = ОблагаемыйДоходСНачалаГода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел И ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
				ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты;
				СтрокаТаблицы.ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода;
				СтрокаТаблицы.ПределПревышен = ОблагаемыйДоходСНачалаГода > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
			КонецЦикла;
			
			Запрос.УстановитьПараметр("РасчетНарастающимИтогом", ТаблицаРасчетаНарастающимИтогом); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РасчетНарастающимИтогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасчетНарастающимИтогом.Период КАК Период,
			|	РасчетНарастающимИтогом.НалоговаяБаза КАК НалоговаяБаза,
			|	РасчетНарастающимИтогом.ОблагаемыйДоход КАК ОблагаемыйДоход,
			|	РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела КАК ЭтоДеньПревышенияПредела,
			|	РасчетНарастающимИтогом.ПределПревышен КАК ПределПревышен
			|ПОМЕСТИТЬ ВТРасчетНарастающимИтогом
			|ИЗ
			|	&РасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыПоСтавкам.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыПоСтавкам.Ставка КАК Ставка,
			|	ДоходыПоСтавкам.Регистратор КАК Регистратор,
			|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыПоСтавкам.Начисление КАК Начисление,
			|	ДоходыПоСтавкам.Период КАК Период,
			|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыПоСтавкам.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыПоСтавкам.КБК КАК КБК,
			|	ДоходыПоСтавкам.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыПоСтавкам.КодДохода КАК КодДохода,
			|	ДоходыПоСтавкам.СуммаДохода КАК СуммаДохода,
			|	ДоходыПоСтавкам.КодВычета КАК КодВычета,
			|	ДоходыПоСтавкам.СуммаВычета КАК СуммаВычета,
			|	ДоходыПоСтавкам.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода, 0) КАК ОблагаемыйДоходСНачалаГода,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела, ЛОЖЬ) КАК ЭтоДеньПревышенияПредела,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ПределПревышен, ЛОЖЬ) КАК ПределПревышен,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоход, 0) КАК ОблагаемыйДоходЗаДень
			|ПОМЕСТИТЬ ВТРасширенныеДанныеОДоходах
			|ИЗ
			|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|		ПО ДоходыПоСтавкам.ФизическоеЛицо = РасчетНарастающимИтогом.ФизическоеЛицо
			|			И ДоходыПоСтавкам.Период = РасчетНарастающимИтогом.Период
			|			И ДоходыПоСтавкам.НалоговаяБаза = РасчетНарастающимИтогом.НалоговаяБаза
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.СтавкаНалога КАК СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка КАК Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	РасширенныеДанныеОДоходах.КБК КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода) КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаВычета) КАК СуммаВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода - РасширенныеДанныеОДоходах.СуммаВычета) КАК ОблагаемаяСумма,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень КАК ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление,
			|	РасширенныеДанныеОДоходах.Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода,
			|	РасширенныеДанныеОДоходах.КБК,
			|	РасширенныеДанныеОДоходах.КодДохода,
			|	РасширенныеДанныеОДоходах.КодВычета,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	КодДохода";
			
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			ДоходыСУточненнымиСтавками = ТаблицаРасчетаНарастающимИтогом.СкопироватьКолонки();
			
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			СтрокиРаспределения = Новый Массив;
			ОблагаемыйДоходДоПредела = 0;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					Если ОблагаемыйДоходДоПредела <> 0 Тогда
						ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
					КонецЕсли;
					СтрокиРаспределения = Новый Массив;
					ОблагаемыйДоходДоПредела = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
				КонецЕсли;
				Если ОблагаемыйДоходДоПредела = 0 Тогда
					ОблагаемыйДоходДоПредела = СтрокаТаблицы.ОблагаемыйДоходЗаДень - СтрокаТаблицы.ОблагаемыйДоходСНачалаГода + ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел
				КонецЕсли;
				СтрокиРаспределения.Добавить(СтрокаТаблицы);
			КонецЦикла;
			Если ОблагаемыйДоходДоПредела <> 0 Тогда
				ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
			КонецЕсли;
			
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРасчетаНарастающимИтогом, ДоходыСУточненнымиСтавками); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			
			Запрос.УстановитьПараметр("ДоходыСУточненнымиСтавками", ДоходыСУточненнымиСтавками); ДоходыСУточненнымиСтавками = Неопределено;
			Запрос.Текст =
			"УНИЧТОЖИТЬ ВТДоходыПоСтавкам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка КАК Ставка,
			|	ДоходыСУточненнымиСтавками.Регистратор КАК Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление КАК Начисление,
			|	ДоходыСУточненнымиСтавками.Период КАК Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|			ТОГДА &КБКсПревышения
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.КБК
			|	КОНЕЦ КАК КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода КАК КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода КАК СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета КАК КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыСУточненнымиСтавками
			|ИЗ
			|	&ДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаЧисломСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.СтавкаНалога
			|	КОНЕЦ КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.Ставка
			|	КОНЕЦ КАК Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &КБКсПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.КБК
			|	КОНЕЦ КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	РасширенныеДанныеОДоходах.СуммаДохода КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	РасширенныеДанныеОДоходах.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыПоСтавкам
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	НЕ РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка,
			|	ДоходыСУточненнымиСтавками.Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление,
			|	ДоходыСУточненнымиСтавками.Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2,
			|	ДоходыСУточненнымиСтавками.КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета
			|ИЗ
			|	ВТДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками";
			Запрос.Выполнить();
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0) КАК П000020012003,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.КБК КАК КБК
			|ИЗ
			|	(ВЫБРАТЬ
			|		СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|		СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|		СведенияОДоходахНДФЛ.КБК КАК КБК,
			|		СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода
			|	ИЗ
			|		ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|	ГДЕ
			|		СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|	
			|	СГРУППИРОВАТЬ ПО
			|		СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|		СведенияОДоходахНДФЛ.Ставка,
			|		СведенияОДоходахНДФЛ.КБК) КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаДохода <> 0
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.Ставка,
			|	СведенияОДоходахНДФЛ.КБК";
			
			ОписаниеТаблиц.КоличествоПолучателейДохода = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
	
		Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Тогда
			
			Запрос.УстановитьПараметр("СтрокиРаздела2ПоКодамДохода", УчетНДФЛПовтИсп.СтрокиРаздела2Расчета6НДФЛПоКодамДохода());
			
			ПоДатамТрудовыхДоговоров = Новый Массив;
			ПоДатамТрудовыхДоговоров.Добавить(УчетНДФЛПовтИсп.Доход2710());
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2720);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2760);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код4800);
			Запрос.УстановитьПараметр("ПоДатамДоговоров", ПоДатамТрудовыхДоговоров);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтрокиРаздела2ПоКодамДохода.КодДохода КАК КодДохода,
			|	СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТСтрокиРаздела2ПоКодамДохода
			|ИЗ
			|	&СтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 <> ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ПустаяСсылка)
			|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
			|		ИНАЧЕ СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2
			|	КОНЕЦ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|		ПО СведенияОДоходахНДФЛ.КодДохода = СтрокиРаздела2ПоКодамДохода.КодДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	&НачалоПериода КАК НачалоПериода,
			|	&ОкончаниеПериода КАК ОкончаниеПериода,
			|	&ГоловнаяОрганизация КАК ГоловнаяОрганизация
			|ИЗ
			|	ВТДоходыСоСтрокамиРаздела2 КАК ФизЛица
			|ГДЕ
			|	ФизЛица.СтрокаРаздела2 ЕСТЬ NULL";
			Результат = Запрос.Выполнить();
			Если Не Результат.Пустой() Тогда
				
				ФизЛицаОрганизаций = Результат.Выгрузить();
				Запрос.УстановитьПараметр("ТаблицаДоговоров", КадровыйУчет.ДоговорыФизическихЛиц(ФизЛицаОрганизаций)); ФизЛицаОрганизаций = Неопределено; 
				
				Запрос.Текст =
				"ВЫБРАТЬ
				|	ТаблицаДоговоров.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ТаблицаДоговоров.ВидДоговора КАК ВидДоговора,
				|	ТаблицаДоговоров.Окончание КАК Окончание,
				|	ТаблицаДоговоров.Начало КАК Начало
				|ПОМЕСТИТЬ ВТДоговоры
				|ИЗ
				|	&ТаблицаДоговоров КАК ТаблицаДоговоров
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период КАК Период,
				|	НЕ МИНИМУМ(ФизЛица.ВидДоговора) КАК ЕстьТрудовойДоговор
				|ПОМЕСТИТЬ ВТДниДоговоров
				|ИЗ
				|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоговоры КАК ФизЛица
				|		ПО (ФизЛица.Начало <= СведенияОДоходахНДФЛ.Период)
				|			И (ФизЛица.Окончание = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
				|				ИЛИ ФизЛица.Окончание >= СведенияОДоходахНДФЛ.Период)
				|			И СведенияОДоходахНДФЛ.ФизическоеЛицо = ФизЛица.ФизическоеЛицо
				|ГДЕ
				|	ФизЛица.ФизическоеЛицо ЕСТЬ НЕ NULL 
				|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
				|
				|СГРУППИРОВАТЬ ПО
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
				|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
				|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
				|	СведенияОДоходахНДФЛ.КБК КАК КБК,
				|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
				|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
				|	ВЫБОР
				|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 ЕСТЬ НЕ NULL 
				|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
				|		КОГДА СведенияОДоходахНДФЛ.КодДохода В (&ПоДатамДоговоров)
				|			ТОГДА ВЫБОР
				|					КОГДА ЕСТЬNULL(ДниДоговоров.ЕстьТрудовойДоговор, ЛОЖЬ)
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
				|					КОГДА НЕ ДниДоговоров.ЕстьТрудовойДоговор
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
				|					ИНАЧЕ НЕОПРЕДЕЛЕНО
				|				КОНЕЦ
				|		ИНАЧЕ НЕОПРЕДЕЛЕНО
				|	КОНЕЦ КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТПодробныеДоходы
				|ИЗ
				|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДниДоговоров КАК ДниДоговоров
				|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДниДоговоров.ФизическоеЛицо
				|			И СведенияОДоходахНДФЛ.Период = ДниДоговоров.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|УНИЧТОЖИТЬ ВТДоходыСоСтрокамиРаздела2
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ПодробныеДоходы.СтавкаНалога КАК СтавкаНалога,
				|	ПодробныеДоходы.Ставка КАК Ставка,
				|	ПодробныеДоходы.Регистратор КАК Регистратор,
				|	ПодробныеДоходы.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ПодробныеДоходы.Начисление КАК Начисление,
				|	ПодробныеДоходы.КБК КАК КБК,
				|	ПодробныеДоходы.КодДохода КАК КодДохода,
				|	ПодробныеДоходы.СуммаДохода КАК СуммаДохода,
				|	ПодробныеДоходы.СтрокаРаздела2 КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
				|ИЗ
				|	ВТПодробныеДоходы КАК ПодробныеДоходы";
				Запрос.Выполнить();
				
			КонецЕсли;
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.КодДохода КАК КодДохода,
			|	СведенияОДоходах.Начисление КАК Начисление,
			|	СведенияОДоходах.Регистратор КАК Регистратор,
			|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000020011003,
			|	СУММА(ВЫБОР
			|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.Дивиденды)
			|				ТОГДА СведенияОДоходах.СуммаДохода
			|			ИНАЧЕ 0
			|		КОНЕЦ) КАК П000020011103,
			|	СУММА(ВЫБОР
			|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
			|				ТОГДА СведенияОДоходах.СуммаДохода
			|			ИНАЧЕ 0
			|		КОНЕЦ) КАК П000020011203,
			|	СУММА(ВЫБОР
			|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
			|				ТОГДА СведенияОДоходах.СуммаДохода
			|			ИНАЧЕ 0
			|		КОНЕЦ) КАК П000020011303
			|ИЗ
			|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.КодДохода,
			|	СведенияОДоходах.Начисление,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога";
			
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
				МассивПолей.Добавить("КодДохода");
				МассивПолей.Добавить("Начисление");
				МассивПолей.Добавить("Регистратор");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
			ОписаниеТаблиц.Раздел2Доходы = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТВычетыПоСтавкам
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаВычета <> 0
			|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	&ОсновнойКБК,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
			|	13,
			|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13),
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
			|ГДЕ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ДанныеДляОтчета";
			Запрос.Выполнить();
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.КодВычета КАК КодВычета,
			|	СведенияОДоходах.Регистратор КАК Регистратор,
			|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
			|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000020013003
			|ИЗ
			|	ВТВычетыПоСтавкам КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодВычета,
			|	СведенияОДоходах.Регистратор,
			|	СведенияОДоходах.СтавкаНалога";
			
			МассивПолей = Новый Массив;
			Если Не ПодробныеДанные Тогда
				МассивПолей.Добавить("ФизическоеЛицо");
				МассивПолей.Добавить("КодВычета");
				МассивПолей.Добавить("Регистратор");
			КонецЕсли;
			Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
			ОписаниеТаблиц.Раздел2Вычеты = Запрос.Выполнить().Выгрузить()
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда

			НеобходимыеКадровыеДанные = Новый Массив();
			НеобходимыеКадровыеДанные.Добавить("ФизическоеЛицо");
			НеобходимыеКадровыеДанные.Добавить("ИНН");
			НеобходимыеКадровыеДанные.Добавить("Наименование");
			НеобходимыеКадровыеДанные.Добавить("Фамилия");
			НеобходимыеКадровыеДанные.Добавить("Имя");
			НеобходимыеКадровыеДанные.Добавить("Отчество");
			НеобходимыеКадровыеДанные.Добавить("СтатусНалогоплательщика");
			НеобходимыеКадровыеДанные.Добавить("ДатаРождения");	
			НеобходимыеКадровыеДанные.Добавить("ДокументВид");
			НеобходимыеКадровыеДанные.Добавить("ДокументСерия");
			НеобходимыеКадровыеДанные.Добавить("ДокументНомер");
			НеобходимыеКадровыеДанные.Добавить("ДокументСтранаВыдачи");
			НеобходимыеКадровыеДанные.Добавить("Страна");
			
			ОписаниеТаблиц.Приложение1Налогоплательщики = Новый ТаблицаЗначений;
			Если НомерКорректировки = 99 Тогда
			ИначеЕсли НомерКорректировки > 0 Тогда
			Иначе
				
				Запрос.Текст = 
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо
				|ИЗ
				|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах";
				КадровыйУчет.СоздатьНаДатуВТКадровыеДанныеФизическихЛиц(Запрос.МенеджерВременныхТаблиц, Истина, Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НеобходимыеКадровыеДанные, ОкончаниеПериода);

				Запрос.Текст = 
				"ВЫБРАТЬ
				|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
				|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
				|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
				|	КадровыеДанныеФизЛиц.Имя КАК Имя,
				|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
				|	КадровыеДанныеФизЛиц.СтатусНалогоплательщика КАК СтатусНалогоплательщика,
				|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
				|	ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна, ЗНАЧЕНИЕ(Справочник.СтраныМира.Россия)) КАК Гражданство,
				|	КадровыеДанныеФизЛиц.ДокументСтранаВыдачи КАК СтранаВыдачиДокумента,
				|	КадровыеДанныеФизЛиц.ДокументВид КАК ВидДокумента,
				|	КадровыеДанныеФизЛиц.ДокументСерия КАК СерияДокумента,
				|	КадровыеДанныеФизЛиц.ДокументНомер КАК НомерДокумента,
				|	КадровыеДанныеФизЛиц.Наименование КАК Наименование
				|ИЗ
				|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
				|
				|УПОРЯДОЧИТЬ ПО
				|	Наименование";	
				ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
				
			КонецЕсли;
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Приложение1Доходы") Тогда
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ) КАК Период,
			|	СведенияОДоходах.СтавкаНалога КАК Ставка,
			|	СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года КАК П000П1М500002,
			|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000П1М500003,
			|	СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года КАК П000П1М600004,
			|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходах
			|ГДЕ
			|	СведенияОДоходах.ДанныеДляОтчета
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года,
			|	СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года,
			|	СведенияОДоходах.СтавкаНалога,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ)
			|
			|ИМЕЮЩИЕ
			|	(СУММА(СведенияОДоходах.СуммаДохода) <> 0
			|		ИЛИ СУММА(СведенияОДоходах.СуммаВычета) <> 0)
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
		КонецЕсли;
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Приложение1Вычеты") Тогда
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходах.СтавкаНалога КАК Ставка,
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета.ГруппаВычета КАК ГруппаВычета,
		|	СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года КАК П000П1М200001,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000П1М200002
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОДоходах
		|ГДЕ
		|	СведенияОДоходах.КодВычета.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.СтавкаНалога,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета.ГруппаВычета,
		|	СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года";
		ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить()
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Приложение1Итоги") Или ОписаниеТаблиц.Свойство("Приложение1УведомленияОВычетах") Тогда
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТНалоги", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода, "ВТСтавкаНДФЛПоНалогам");
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	НДФЛ.КБК КАК КБК,
		|	НДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Начислено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НачисленоПоДивидендам,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ЗачтеноАвансов,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Удержано,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК УдержаноЗаНалоговыйПериод,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.Сумма
		|					КОГДА ВЫБОР
		|							КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|								ТОГДА ВЫБОР
		|										КОГДА НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|											ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|										ИНАЧЕ 0
		|									КОНЕЦ
		|							ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|						КОНЕЦ * НДФЛ.Сумма > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.Сумма > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.Сумма - ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА ВЫБОР
		|																			КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																				ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																			ИНАЧЕ 0
		|																		КОНЕЦ
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|												КОНЕЦ > 0
		|												ТОГДА НДФЛ.Сумма - ВЫБОР
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА ВЫБОР
		|																				КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																					ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																				ИНАЧЕ 0
		|																			КОНЕЦ
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|													КОНЕЦ
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.Сумма - ВЫБОР
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|									КОНЕЦ < 0
		|									ТОГДА НДФЛ.Сумма - ВЫБОР
		|											КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|												ТОГДА ВЫБОР
		|														КОГДА НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|															ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|														ИНАЧЕ 0
		|													КОНЕЦ
		|											ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|										КОНЕЦ
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.Сумма
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Сальдо,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Возвращено
		|ПОМЕСТИТЬ ВТНалогиПоСтавкам
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.Сумма <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	&КБКсПревышения,
		|	НДФЛ.ФизическоеЛицо,
		|	15,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15),
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.СуммаСПревышения
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.СуммаСПревышения > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов > 0
		|												ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов < 0
		|									ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|ГДЕ
		|	НДФЛ.СуммаСПревышения <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Сальдо) КАК НеУдержано,
		|	Налоги.КБК КАК КБК
		|ПОМЕСТИТЬ ВТНеУдержано
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.КБК КАК КБК,
		|	-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|ПОМЕСТИТЬ ВТИзлишнеУдержаноПоКБК
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Начислено) КАК Начислено,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК НачисленоПоДивидендам,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК ЗачтеноАвансов,
		|	СУММА(Налоги.Удержано) КАК Удержано,
		|	СУММА(Налоги.УдержаноЗаНалоговыйПериод) КАК УдержаноЗаНалоговыйПериод,
		|	СУММА(Налоги.Возвращено) КАК Возвращено,
		|	ЕСТЬNULL(МАКСИМУМ(ПоФизлицам.НеУдержано), 0) КАК НеУдержано,
		|	ЕСТЬNULL(МАКСИМУМ(ИзлишнеУдержаноПоКБК.ИзлишнеУдержано), 0) КАК ИзлишнеУдержано,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК
		|ПОМЕСТИТЬ ВТДанныеПоФизлицам
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНеУдержано КАК ПоФизлицам
		|		ПО Налоги.ФизическоеЛицо = ПоФизлицам.ФизическоеЛицо
		|			И Налоги.СтавкаНалога = ПоФизлицам.СтавкаНалога
		|			И Налоги.КБК = ПоФизлицам.КБК
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИзлишнеУдержаноПоКБК КАК ИзлишнеУдержаноПоКБК
		|		ПО Налоги.ФизическоеЛицо = ИзлишнеУдержаноПоКБК.ФизическоеЛицо
		|			И Налоги.КБК = ИзлишнеУдержаноПоКБК.КБК
		|			И Налоги.СтавкаНалога = ИзлишнеУдержаноПоКБК.СтавкаНалога
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.Возвращено <> 0
		|			ИЛИ ИзлишнеУдержаноПоКБК.ИзлишнеУдержано <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(Налоги.Начислено) КАК П000020014003,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК П000020014103,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК П000020015003,
		|	СУММА(Налоги.Удержано) КАК П000020016003,
		|	СУММА(Налоги.НеУдержано) КАК П000020017003,
		|	СУММА(Налоги.Возвращено) КАК П000020019003,
		|	СУММА(Налоги.ИзлишнеУдержано) КАК П000020018003,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.Возвращено <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	Налоги.ФизическоеЛицо";
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "Налоги");
		ОписаниеТаблиц.Раздел2Налоги = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Приложение1Итоги") Тогда
		
		УчетНДФЛ.СоздатьВТСтавкиНалогаЧислом(Запрос.МенеджерВременныхТаблиц);
		Запрос.Текст =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|ПОМЕСТИТЬ ВТИзлишнеУдержано
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ДанныеИтогов.Ставка КАК Ставка,
		|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
		|	СУММА(ДанныеИтогов.П000П1М100002) КАК П000П1М100002,
		|	СУММА(ДанныеИтогов.П000П1М100003) КАК П000П1М100003,
		|	СУММА(ДанныеИтогов.П000П1М100004) КАК П000П1М100004,
		|	СУММА(ДанныеИтогов.П000П1М100005) КАК П000П1М100005,
		|	СУММА(ДанныеИтогов.П000П1М100006) КАК П000П1М100006,
		|	СУММА(ДанныеИтогов.П000П1М100007) КАК П000П1М100007,
		|	СУММА(ДанныеИтогов.П000П1М100008) КАК П000П1М100008
		|ИЗ
		|	(ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|		Налоги.СтавкаНалога КАК Ставка,
		|		Налоги.СтавкаНалога КАК П000П1М100001,
		|		0 КАК П000П1М100002,
		|		0 КАК П000П1М100003,
		|		Налоги.Начислено КАК П000П1М100004,
		|		Налоги.УдержаноЗаНалоговыйПериод КАК П000П1М100005,
		|		Налоги.ЗачтеноАвансов КАК П000П1М100006,
		|		0 КАК П000П1М100007,
		|		0 КАК П000П1М100008
		|	ИЗ
		|		ВТДанныеПоФизлицам КАК Налоги
		|	ГДЕ
		|		(Налоги.Начислено <> 0
		|				ИЛИ Налоги.ЗачтеноАвансов <> 0
		|				ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.СуммаДохода,
		|		СведенияОДоходах.СуммаДохода,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК СведенияОДоходах
		|	ГДЕ
		|		СведенияОДоходах.ДанныеДляОтчета
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.СтавкаНалога,
		|		0,
		|		-СведенияОДоходах.СуммаВычета,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТВычетыПоСтавкам КАК СведенияОДоходах
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо,
		|		Налоги.СтавкаНалога,
		|		Налоги.СтавкаНалога,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		Налоги.ИзлишнеУдержано
		|	ИЗ
		|		ВТИзлишнеУдержано КАК Налоги
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.ФизическоеЛицо,
		|		СтавкиНалогаЧислом.Размер * 100,
		|		СтавкиНалогаЧислом.Размер * 100,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Сумма,
		|		0
		|	ИЗ
		|		РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛ
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкиНалогаЧислом КАК СтавкиНалогаЧислом
		|			ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Ставка = СтавкиНалогаЧислом.СтавкаНалогообложения
		|	ГДЕ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|		И РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|		И РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода) КАК ДанныеИтогов
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеИтогов.Ставка,
		|	ДанныеИтогов.ФизическоеЛицо,
		|	ДанныеИтогов.П000П1М100001
		|
		|ИМЕЮЩИЕ
		|	СУММА(ДанныеИтогов.П000П1М100002) <> 0";
					
		ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Приложение1УведомленияОВычетах") Тогда
		
		НалоговыйПериод = Год(ОкончаниеПериода);
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОДоходах
		|ГДЕ
		|	СведенияОДоходах.КодВычета.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)";
		ДанныеУведомлений = УчетНДФЛ.ДанныеУведомленийНаВычеты(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеУведомлений.Колонки.Сотрудник.Имя = "ФизическоеЛицо";
		ОписаниеТаблиц.Приложение1УведомленияОВычетах = ДанныеУведомлений;
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	Налоги.ЗачтеноАвансов <> 0";
		ДанныеУведомлений = УчетНДФЛ.ДанныеУведомленийНаЗачетАвансовыхПлатежей(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеУведомлений.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ДанныеУведомлений, ОписаниеТаблиц.Приложение1УведомленияОВычетах);
		ОписаниеТаблиц.Приложение1УведомленияОВычетах.Колонки.НомерУведомления.Имя = "П000П1М300002";
		ОписаниеТаблиц.Приложение1УведомленияОВычетах.Колонки.ДатаУведомления.Имя = "П000П1М300003";
		ОписаниеТаблиц.Приложение1УведомленияОВычетах.Колонки.КодНалоговогоОрганаУведомления.Имя = "П000П1М300004";
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОписаниеПоказателей_6НДФЛ_2021Кв4(ПоказателиОтчета) Экспорт
	
	
	// Раздел 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010001001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М102101", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М102201", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М203101", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М203201", Истина, Истина);
	
	// Раздел 2
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010501", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011303", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012103", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020017003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020018003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019003", Истина, Истина);
	
	// Приложение 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000011", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000012", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600005", Истина, Ложь);

КонецПроцедуры

Процедура ЗначенияПоказателей_6НДФЛ_2021Кв4(ПараметрыОтчета, Контейнер) Экспорт
	
	ДатаКонцаПериодаОтчета = ПараметрыОтчета.ДатаКонцаПериодаОтчета;
	Организация = ПараметрыОтчета.Организация;
	НачалоПериода = НачалоГода(ДатаКонцаПериодаОтчета);
	ОкончаниеПериода = КонецМесяца(ДатаКонцаПериодаОтчета);
	НомерКорректировки = ПараметрыОтчета.НомерКорректировки;
	Если ПараметрыОтчета.Свойство("РегистрацииВНО") Тогда
		РегистрацияВНалоговомОргане = ПараметрыОтчета.РегистрацииВНО;
	Иначе
		ТитульныйЛист = Контейнер.Титульный;
		ПараметрыОтбораРегистрацийВНО = Новый Структура;
		ПараметрыОтбораРегистрацийВНО.Вставить("КодНО", ТитульныйЛист.НалоговыйОрган);
		ПараметрыОтбораРегистрацийВНО.Вставить("ОКТМО", ТитульныйЛист.ОКТМО);
		Если СтрДлина(ТитульныйЛист.ИНН) = 10 Тогда
			ПараметрыОтбораРегистрацийВНО.Вставить("КПП", ТитульныйЛист.КПП);
			ПараметрыОтбораРегистрацийВНО.Вставить("ИскатьПоПервымСимволамОКТМО", Истина);
		КонецЕсли;
		РегистрацияВНалоговомОргане = РегламентированнаяОтчетность.РегистрацииОрганизацииВНалоговомОргане(Организация, ПараметрыОтбораРегистрацийВНО);
	КонецЕсли;
	ЗаполнятьПриложение1 = КонецМесяца(ОкончаниеПериода) = КонецГода(ОкончаниеПериода);
	Если ПараметрыОтчета.Свойство("ЗаполнятьПриложение1") Тогда
		ЗаполнятьПриложение1 = ПараметрыОтчета.ЗаполнятьПриложение1;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РегистрацияВНалоговомОргане) Тогда
		Возврат
	КонецЕсли;
	                         
	// Очистка отчета
	ПоказателиОтчета = Новый Структура;
	ОписаниеПоказателей_6НДФЛ_2021Кв4(ПоказателиОтчета);
	
	ДанныеРаздела1 = Контейнер.Раздел1.Строки;
	ПоляКБК = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].Данные); 
	ПоляСуммКПеречислению = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].ДанныеМногострочныхЧастей.П00001М1.Строки[0].Данные);
	ПоляСуммВозврата = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].ДанныеМногострочныхЧастей.П00001М2.Строки[0].Данные);
	ДанныеРаздела1.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляКБК);
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляСуммКПеречислению);
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляСуммВозврата);
	
	ДанныеРаздела2 = Контейнер.Раздел2.Строки;
	ПоляРаздела2 = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела2[0].Данные); 
	ДанныеРаздела2.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляРаздела2);
	
	Если ЗаполнятьПриложение1 Тогда
		
		ДанныеПриложение1 = Контейнер.Приложение1.Строки;
		ДанныеСправки = ДанныеПриложение1[0].ДанныеМногострочныхЧастей.П000П1М1.Строки;
		ПоляНалогоплательщика = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеПриложение1[0].Данные);
		ПоляИтогов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].Данные);
		ПоляВычетов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М2.Строки[0].Данные);
		ПоляУведомленийОВычетах = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М3.Строки[0].Данные);
		ПоляНеудержано = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М4.Строки[0].Данные);
		ПоляДоходов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].Данные);
		ПоляВычетовКДоходам = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].ДанныеМногострочныхЧастей.П000П1М6.Строки[0].Данные);
		ДанныеПриложение1.Очистить();
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляНалогоплательщика);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляИтогов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляУведомленийОВычетах);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляДоходов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетовКДоходам);
		Для каждого КлючИЗначение Из ПоляНеудержано Цикл
			ПоляНеудержано[КлючИЗначение.Ключ] = 0
		КонецЦикла;
		
	КонецЕсли;
	
	// Сбор данных
	ОписаниеТаблиц = Новый Структура("КоличествоПолучателейДохода, Раздел1Налоги, Раздел1Возвраты, Раздел2Доходы, Раздел2Вычеты, Раздел2Налоги, КоличествоПолучателейДохода");
	Если ЗаполнятьПриложение1 Тогда
		ОписаниеТаблиц.Вставить("Приложение1Налогоплательщики");	
		Если НомерКорректировки <> 99 Тогда
			ОписаниеТаблиц.Вставить("Приложение1Итоги");	
			ОписаниеТаблиц.Вставить("Приложение1Доходы");	
			ОписаниеТаблиц.Вставить("Приложение1Вычеты");	
			ОписаниеТаблиц.Вставить("Приложение1УведомленияОВычетах");	
		КонецЕсли;
	КонецЕсли;
	РасчетПоказателей_6НДФЛ_2021Кв4(НачалоПериода, ОкончаниеПериода, ?(ПараметрыОтчета.ДатаПодписи > ОкончаниеПериода,ПараметрыОтчета.ДатаПодписи, ОкончаниеПериода), Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, Ложь, НомерКорректировки);	
	
	// Вывод данных в отчет
	
	ВсеКБК = Новый Массив;
	ВсеКБК.Добавить("18210102010011000110");
	ВсеКБК.Добавить("18210102060011000110");
	ВсеКБК.Добавить("18210102070011000110");
	ВсеКБК.Добавить("18210102080011000110");
	ПоискПоКБК = Новый Структура("КБК");
	
	// Раздел 1
	Налоги = ОписаниеТаблиц.Раздел1Налоги;
	Возвраты = ОписаниеТаблиц.Раздел1Возвраты;
	Для каждого КБК Из ВсеКБК Цикл
		
		ПоискПоКБК.КБК = КБК;
		СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБК);
		СтрокиВозвратов = Возвраты.НайтиСтроки(ПоискПоКБК);
		
		Если СтрокиНалогов.Количество() > 0 Или СтрокиВозвратов.Количество() > 0 Тогда
			СтраницаРаздела1 = ДанныеРаздела1.Добавить();
			СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
			СтраницаРаздела1.Данные.П000010001001 = КБК;
			СтраницаРаздела1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П00001М1,П00001М2");
			Если СтрокиНалогов.Количество() = 0 Тогда
				НоваяСтрокаСуммКПеречислению = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М1.Строки.Добавить();
				НоваяСтрокаСуммКПеречислению.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммКПеречислению);
			КонецЕсли;
			Если СтрокиВозвратов.Количество() = 0 Тогда
				НоваяСтрокаСуммВозврата = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить();
				НоваяСтрокаСуммВозврата.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
			КонецЕсли;
		КонецЕсли;
		Для каждого СтрокаНалогов Из СтрокиНалогов Цикл
			НоваяСтрокаСуммКПеречислению = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М1.Строки.Добавить();
			НоваяСтрокаСуммКПеречислению.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммКПеречислению);
			ЗаполнитьЗначенияСвойств(НоваяСтрокаСуммКПеречислению.Данные, СтрокаНалогов);
		КонецЦикла;
		Для каждого СтрокаВозвратов Из СтрокиВозвратов Цикл
			НоваяСтрокаСуммВозврата = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить();
			НоваяСтрокаСуммВозврата.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
			ЗаполнитьЗначенияСвойств(НоваяСтрокаСуммВозврата.Данные, СтрокаВозвратов);
		КонецЦикла;
		
	КонецЦикла;
	Если ДанныеРаздела1.Количество() = 0 Тогда
		СтраницаРаздела1 = ДанныеРаздела1.Добавить();
		СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
		СтраницаРаздела1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П00001М1,П00001М2");
		СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М1.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммКПеречислению);
		СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
	КонецЕсли;
	
	// Раздел 2
	Доходы = ОписаниеТаблиц.Раздел2Доходы;
	Вычеты = ОписаниеТаблиц.Раздел2Вычеты;
	Налоги = ОписаниеТаблиц.Раздел2Налоги;
	Количество = ОписаниеТаблиц.КоличествоПолучателейДохода;
	ПоискПоКБКиСтавке = Новый Структура("КБК,Ставка");
	Для каждого Ставка Из Перечисления.НДФЛСтавки Цикл
		ПоискПоКБКиСтавке.Ставка = Ставка;
		Для каждого КБК Из ВсеКБК Цикл
			
			ПоискПоКБКиСтавке.КБК = КБК;
			СтрокиДоходов = Доходы.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиВычетов = Вычеты.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиКоличества = Количество.НайтиСтроки(ПоискПоКБКиСтавке);
			
			Если СтрокиДоходов.Количество() > 0 Или СтрокиНалогов.Количество() > 0 Или СтрокиВычетов.Количество() > 0 Тогда
				СтраницаРаздела = ДанныеРаздела2.Добавить();
				СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
				СтраницаРаздела.Данные.П000020010501 = КБК;
				Если Ставка = Перечисления.НДФЛСтавки.Ставка03 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 3
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка05 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 5
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка06 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 6
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка07 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 7
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка09 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 9
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка10 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 10
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка12 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 12
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка13 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 13
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка15 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 15
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка30 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 30
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка35 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 35
				Иначе
					
				КонецЕсли;
				СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
			КонецЕсли;
			Для каждого СтрокаДанных Из СтрокиДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиНалогов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиВычетов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиКоличества Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			
		КонецЦикла;
	КонецЦикла;
	Если ДанныеРаздела2.Количество() = 0 Тогда
		СтраницаРаздела = ДанныеРаздела2.Добавить();
		СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
		СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
	КонецЕсли;
	
	// Приложение 1
	Если ЗаполнятьПриложение1 Тогда
		Если ОписаниеТаблиц.Приложение1Налогоплательщики.Количество() > 0 Тогда
			
			СоответствиеСтавок = Новый Соответствие;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка03] = 3;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка05] = 5;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка06] = 6;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка07] = 7;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка09] = 9;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка10] = 10;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка12] = 12;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка13] = 13;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка15] = 15;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка30] = 30;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка35] = 35;
			
			Если НомерКорректировки <> 99 Тогда
				Приложение1Итоги = ОписаниеТаблиц.Приложение1Итоги;
				Если Приложение1Итоги.Количество() > 100 Тогда
					Приложение1Итоги.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				Приложение1Доходы = ОписаниеТаблиц.Приложение1Доходы;
				Если Приложение1Доходы.Количество() > 100 Тогда
					Приложение1Доходы.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1Вычеты = ОписаниеТаблиц.Приложение1Вычеты;
				Если Приложение1Вычеты.Количество() > 100 Тогда
					Приложение1Вычеты.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1УведомленияОВычетах = ОписаниеТаблиц.Приложение1УведомленияОВычетах;
				Если Приложение1УведомленияОВычетах.Количество() > 100 Тогда
					Приложение1УведомленияОВычетах.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				ПоискПоФизлицу = Новый Структура("ФизическоеЛицо");
				ПоискПоФизлицуИСтавке = Новый Структура("ФизическоеЛицо,Ставка,КБК");
			КонецЕсли;
			
			НомерПервойСправки = 1;
			Если Не ОписаниеТаблиц.Свойство("Приложение1МаксимальныйНомерИзПереданныхСправок", НомерПервойСправки) Тогда
				НомерПервойСправки = 1;
			КонецЕсли;
			Для каждого СтрокаДанных Из ОписаниеТаблиц.Приложение1Налогоплательщики Цикл
				
				СтраницаПриложение1 = ДанныеПриложение1.Добавить();
				СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
				СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
				Если НомерКорректировки = 0 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
					НомерПервойСправки = НомерПервойСправки + 1;
					СтраницаПриложение1.Данные.П000П10000002 = "00";
				ИначеЕсли НомерКорректировки < 99 Тогда
					Если ЗначениеЗаполнено(СтрокаДанных.НомерСправки) Тогда
						СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
						СтраницаПриложение1.Данные.П000П10000002 = ?(СтрокаДанных.НомерКорректировки = 99, "99", Формат(СтрокаДанных.НомерКорректировки + 1, "ЧЦ=2; ЧДЦ=0; ЧВН="));
					Иначе
						СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
						НомерПервойСправки = НомерПервойСправки + 1;
						СтраницаПриложение1.Данные.П000П10000002 = "00";
					КонецЕсли;
				ИначеЕсли НомерКорректировки = 99 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
					СтраницаПриложение1.Данные.П000П10000002 = "99";
				КонецЕсли;
				СтраницаПриложение1.Данные.П000П10000003 = СтрокаДанных.ИНН;
				СтраницаПриложение1.Данные.П000П10000004 = СокрЛП(СтрокаДанных.Фамилия);
				СтраницаПриложение1.Данные.П000П10000005 = СокрЛП(СтрокаДанных.Имя);
				СтраницаПриложение1.Данные.П000П10000006 = СокрЛП(СтрокаДанных.Отчество);
				СтраницаПриложение1.Данные.П000П10000007 = СтрокаДанных.КодФНС;
				СтраницаПриложение1.Данные.П000П10000008 = СтрокаДанных.ДатаРождения;
				СтраницаПриложение1.Данные.П000П10000009 = СтрокаДанных.КодСтраныДляОтчетности;
				СтраницаПриложение1.Данные.П000П10000010 = СтрокаДанных.КодМВД;
				СтраницаПриложение1.Данные.П000П10000011 = СокрЛП(СтрокаДанных.СерияДокумента);
				СтраницаПриложение1.Данные.П000П10000012 = СокрЛП(СтрокаДанных.НомерДокумента);
				
				ВыводитьДоходы = СтраницаПриложение1.Данные.П000П10000002 <> "99";
				Если ВыводитьДоходы Тогда
					ПоискПоФизлицу.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					ПоискПоФизлицуИСтавке.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					СтрокиФизлица = Приложение1Итоги.НайтиСтроки(ПоискПоФизлицу);
					ВыводитьДоходы = СтрокиФизлица.Количество() > 0;
				КонецЕсли;
				Если ВыводитьДоходы Тогда
					Для каждого СтрокаИтоговПоСтавке Из СтрокиФизлица Цикл
						
						ПоискПоФизлицуИСтавке.Ставка = СтрокаИтоговПоСтавке.Ставка;
						ПоискПоФизлицуИСтавке.КБК = СтрокаИтоговПоСтавке.КБК;
						СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
						СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
						ЗаполнитьЗначенияСвойств(СтраницаПоСтавке.Данные, СтрокаИтоговПоСтавке);
						СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
						СтрокиДанных = Приложение1Вычеты.НайтиСтроки(ПоискПоФизлицуИСтавке);
						ВыводитьИмущественныйВычет = Ложь;
						ВыводитьСоциальныйВычет = Ложь;
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить();
								СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
								ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
								Если Не ВыводитьИмущественныйВычет Тогда
									ВыводитьИмущественныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
								КонецЕсли;
								Если Не ВыводитьСоциальныйВычет Тогда
									ВыводитьСоциальныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.СоциальныеПоУведомлениюНО
								КонецЕсли;
							КонецЦикла;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
						КонецЕсли;
						
						СтрокиДанных = Приложение1УведомленияОВычетах.НайтиСтроки(ПоискПоФизлицу);
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ВыводитьИмущественныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "1"
								КонецЕсли;
								Если ВыводитьСоциальныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "2"
								КонецЕсли;
								Если СтрокаИтоговПоСтавке.П000П1М100006 > 0 И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.ПустаяСсылка() Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "3"
								КонецЕсли;
							КонецЦикла;
							Если СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Количество() = 0 Тогда
								СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
							КонецЕсли;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
						КонецЕсли;
						
						СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
						СтрокиДанных = Приложение1Доходы.Скопировать(Приложение1Доходы.НайтиСтроки(ПоискПоФизлицуИСтавке));
						Если СтрокиДанных.Количество() > 0 Тогда
							СтрокиДанных.Сортировать("Период,П000П1М500002");
							ТекущийКод = Неопределено;
							ТекущийПериод = Неопределено;
							ПредыдущаяСтрока = Неопределено; 
							СуммаДохода = 0;
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ТекущийПериод <> СтрокаДанных.Период Или ТекущийКод <> СтрокаДанных.П000П1М500002 Тогда
									Если ПредыдущаяСтрока <> Неопределено Тогда
										ПредыдущаяСтрока.Данные.П000П1М500003 = СуммаДохода;
										Если ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
											СтрокаВычета = ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
											СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
											СтрокаВычета.Данные.П000П1М600004 = "";
										КонецЕсли;
									КонецЕсли;
									ТекущийКод = СтрокаДанных.П000П1М500002; 
									ТекущийПериод = СтрокаДанных.Период;
									СуммаДохода = 0;
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
									ПредыдущаяСтрока = СтрокаПоСтавке;  
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М500001 = Формат(СтрокаДанных.Период, "ДФ=MM");
									СтрокаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
								КонецЕсли;
								СуммаДохода = СуммаДохода + СтрокаДанных.П000П1М500003;
								Если ЗначениеЗаполнено(СтрокаДанных.П000П1М600004) Тогда
									СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
									СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
									ЗаполнитьЗначенияСвойств(СтрокаВычета.Данные, СтрокаДанных);
								КонецЕсли;
							КонецЦикла;
							СтрокаПоСтавке.Данные.П000П1М500003 = СуммаДохода;
							Если СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
								СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
								СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
								СтрокаВычета.Данные.П000П1М600004 = "";
							КонецЕсли;
						Иначе
							СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
							СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
							СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
							СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
						КонецЕсли;
						
					КонецЦикла; 
				Иначе
					СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
					СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
					СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
					СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
					СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
					СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
				КонецЕсли;
				
			КонецЦикла;
			
		Иначе 
			СтраницаПриложение1 = ДанныеПриложение1.Добавить();
			СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
			СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
			СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
			СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
			СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
			СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
			СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
			СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
		КонецЕсли;
	КонецЕсли;
		
КонецПроцедуры

Процедура РасчетПоказателей_6НДФЛ_2021Кв4(НачалоПериода, ОкончаниеПериода, ДатаПодписи, Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, ПодробныеДанные, НомерКорректировки) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("НачалоПредыдущегоГода", ДобавитьМесяц(НачалоПериода, -12));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("ДатаПодписи", КонецДня(ДатаПодписи));
	Запрос.УстановитьПараметр("КБКсПревышения", "18210102080011000110");
	Запрос.УстановитьПараметр("ОсновнойКБК", "18210102010011000110");
	Запрос.УстановитьПараметр("КБКПоОблигациям", "18210102070011000110");
	Запрос.УстановитьПараметр("НачалоОтчетногоКвартала", НачалоКвартала(ОкончаниеПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериодаОсмотраДоходовВычетов", ?(КонецГода(ОкончаниеПериода) = ОкончаниеПериода Или ЗначениеЗаполнено(НомерКорректировки), Макс(ДатаПодписи, ОкончаниеПериода), ОкончаниеПериода));
	Запрос.УстановитьПараметр("ВКС", Перечисления.ВидыЗастрахованныхЛицОбязательногоСтрахования.ВысококвалифицированныеСпециалисты());
	
	ДатаАктуальности = Макс(ОкончаниеПериода, ДатаПодписи);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) КАК КатегорияДохода,
	|	&ОсновнойКБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходВНатуральнойФормеОтТрудовойДеятельности),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеНатуральныеДоходы),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыВДенежнойФормеОтТрудовойДеятельности),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходы),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыОтДолевогоУчастия),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоВыигрышам),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыЦБ),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыРЕПО),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыЗаймЦБ),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыИИС),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ),
	|	&ОсновнойКБК
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоОблигациям),
	|	&КБКПоОблигациям";
	Запрос.Выполнить();
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Или ОписаниеТаблиц.Свойство("Раздел1Возвраты") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения КАК ВидДвижения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаВозврата,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода КАК РасчетМежрасчетногоПериода,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	ВЫБОР
		|		КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА ВЫБОР
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА 0
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов > 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов < 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И НЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Тогда
		
		Если НачалоКвартала(ОкончаниеПериода) = '20210101' Тогда
			
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	СтрокиНалогов.КБК КАК КБК,
			|	СтрокиНалогов.Регистратор КАК Регистратор,
			|	СтрокиНалогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СтрокиНалогов.КрайнийСрокУплаты КАК СрокПеречисленияНалога,
			|	СтрокиНалогов.КрайнийСрокУплаты КАК П00001М102101,
			|	СтрокиНалогов.Сумма КАК П00001М102201
			|ПОМЕСТИТЬ ВТСтрокиНалогов
			|ИЗ
			|	ВТНалоги КАК СтрокиНалогов
			|ГДЕ
			|	СтрокиНалогов.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И СтрокиНалогов.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	&КБКсПревышения,
			|	СтрокиНалогов.Регистратор,
			|	СтрокиНалогов.ФизическоеЛицо,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.СуммаСПревышения
			|ИЗ
			|	ВТНалоги КАК СтрокиНалогов
			|ГДЕ
			|	СтрокиНалогов.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И СтрокиНалогов.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	СтрокиНалогов.КБК,
			|	СтрокиНалогов.Регистратор,
			|	СтрокиНалогов.ФизическоеЛицо,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.КрайнийСрокУплаты,
			|	СтрокиНалогов.Сумма
			|ИЗ
			|	ВТНалоги КАК СтрокиНалогов
			|ГДЕ
			|	СтрокиНалогов.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И СтрокиНалогов.КрайнийСрокУплаты >= ДАТАВРЕМЯ(2021, 1, 1, 0, 0, 0)
			|	И СтрокиНалогов.ДатаУдержания < ДАТАВРЕМЯ(2021, 1, 1, 0, 0, 0)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	НалогиПоДатам.КБК КАК КБК,
			|	НалогиПоДатам.Регистратор КАК Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НалогиПоДатам.СрокПеречисленияНалога КАК СрокПеречисленияНалога,
			|	НалогиПоДатам.П00001М102101 КАК П00001М102101,
			|	СУММА(НалогиПоДатам.П00001М102201) КАК П00001М102201
			|ИЗ
			|	ВТСтрокиНалогов КАК НалогиПоДатам
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.КБК,
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.СрокПеречисленияНалога,
			|	НалогиПоДатам.П00001М102101
			|
			|ИМЕЮЩИЕ
			|	СУММА(НалогиПоДатам.П00001М102201) > 0
			|
			|УПОРЯДОЧИТЬ ПО
			|	СрокПеречисленияНалога";
			
		Иначе
			ТекстЗапроса =
			"ВЫБРАТЬ
			|	НалогиПоДатам.КБК КАК КБК,
			|	НалогиПоДатам.Регистратор КАК Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисленияНалога,
			|	НалогиПоДатам.КрайнийСрокУплаты КАК П00001М102101,
			|	СУММА(НалогиПоДатам.Сумма) КАК П00001М102201
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.КБК,
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	НалогиПоДатам.КрайнийСрокУплаты
			|
			|ИМЕЮЩИЕ
			|	СУММА(НалогиПоДатам.Сумма) > 0
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	&КБКсПревышения,
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	СУММА(НалогиПоДатам.СуммаСПревышения)
			|ИЗ
			|	ВТНалоги КАК НалогиПоДатам
			|ГДЕ
			|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
			|	И НалогиПоДатам.ДатаУдержания МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
			|
			|СГРУППИРОВАТЬ ПО
			|	НалогиПоДатам.Регистратор,
			|	НалогиПоДатам.ФизическоеЛицо,
			|	НалогиПоДатам.КрайнийСрокУплаты,
			|	НалогиПоДатам.КрайнийСрокУплаты
			|
			|ИМЕЮЩИЕ
			|	СУММА(НалогиПоДатам.СуммаСПревышения) > 0
			|
			|УПОРЯДОЧИТЬ ПО
			|	СрокПеречисленияНалога";
			
		КонецЕсли;
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1Налоги = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Возвраты") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата КАК ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата КАК П00001М203101,
		|	-СУММА(НалогиПоДатам.Сумма) КАК П00001М203201
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.ДатаВозврата МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	&КБКсПревышения,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата,
		|	-СУММА(НалогиПоДатам.СуммаСПревышения)
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.ДатаВозврата МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) < 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ДатаВозврата";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1Возвраты = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТФизическиеЛицаОтчета
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента
		|ПОМЕСТИТЬ ВТСтрокиДоходов
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		Запрос.Выполнить();
		
		ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТСтрокиДоходов", "ФизическоеЛицо");
		ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
		ПараметрыПостроения.ВсеЗаписи = Истина;
	    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
			"СтатусыЗастрахованныхФизическихЛиц",
			Запрос.МенеджерВременныхТаблиц,
			Ложь,
			ОписаниеФильтра,
			ПараметрыПостроения);
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиДоходов", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
		
		Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза());
		Запрос.УстановитьПараметр("Предел", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел);
		Запрос.УстановитьПараметр("СтавкаСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Ставка);
		Запрос.УстановитьПараметр("СтавкаЧисломСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом * 100);
		Запрос.УстановитьПараметр("ГодПериода", Год(ОкончаниеПериода));
			
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист) КАК ЭтоВКС,
		|	ВЫБОР
		|		КОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КатегорияДохода
		|	КОНЕЦ КАК НалоговаяБаза,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ КАК КодВычета,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
		|ПОМЕСТИТЬ ВТДоходыПоСтавкам
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО СведенияОДоходахНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.ДатаПолученияДохода = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|			ИЛИ СведенияОДоходахНДФЛ.СуммаВычета <> 0)
		|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|
		|СГРУППИРОВАТЬ ПО
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане),
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист)
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор КАК Регистратор,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма КАК Сумма,
		|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета
		|ПОМЕСТИТЬ ВТСтандартныеИмущественныеВычеты
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
		|ГДЕ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма <> 0
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ИмущественныеВычетыНДФЛ.Регистратор,
		|	ИмущественныеВычетыНДФЛ.ФизическоеЛицо,
		|	ИмущественныеВычетыНДФЛ.КодВычета,
		|	ИмущественныеВычетыНДФЛ.Сумма,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
		|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане)
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
		|ГДЕ
		|	ИмущественныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
		|	И ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычетыНДФЛ.Сумма <> 0
		|	И ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ИмущественныеВычетыНДФЛ.Год = &ГодПериода
		|	И ИмущественныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		УстановитьПривилегированныйРежим(Истина);
		Запрос.Выполнить();
		УстановитьПривилегированныйРежим(Ложь);
		
		Запрос.Текст =
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
		|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) КАК НалоговаяБаза,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК МесяцНалоговогоПериода
		|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	База.ФизическоеЛицо КАК ФизическоеЛицо,
		|	База.НалоговаяБаза КАК НалоговаяБаза
		|ПОМЕСТИТЬ ВТСотрудникиСПревышением
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
		|		ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
		|		ДоходыПоСтавкам.СуммаДохода - ДоходыПоСтавкам.СуммаВычета КАК ОблагаемаяБаза
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
		|	ГДЕ
		|		ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтандартныеИмущественныеВычеты.ФизическоеЛицо,
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		-СтандартныеИмущественныеВычеты.Сумма
		|	ИЗ
		|		ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты) КАК База
		|
		|СГРУППИРОВАТЬ ПО
		|	База.ФизическоеЛицо,
		|	База.НалоговаяБаза
		|
		|ИМЕЮЩИЕ
		|	СУММА(База.ОблагаемаяБаза) > &Предел";
		
		Если Запрос.Выполнить().Выгрузить()[0].Количество > 0 Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК НачалоМесяца,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза КАК НалоговаяБаза,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) КАК ОблагаемыйДоход,
			|	0 КАК ОблагаемыйДоходСНачалаГода,
			|	ЛОЖЬ КАК ЭтоДеньПревышенияПредела,
			|	ЛОЖЬ КАК ПределПревышен
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.НалоговаяБаза = СотрудникиСПревышением.НалоговаяБаза
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза
			|
			|ИМЕЮЩИЕ
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) <> 0
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	Период";
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СУММА(СтандартныеИмущественныеВычеты.Сумма) КАК Сумма,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяца
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СтандартныеИмущественныеВычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) = СотрудникиСПревышением.НалоговаяБаза)
			|
			|СГРУППИРОВАТЬ ПО
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ)";
			ТаблицаВычетов = Запрос.Выполнить().Выгрузить();
			ИскатьВычеты = ТаблицаВычетов.Количество() > 0;
			Если ИскатьВычеты И ТаблицаВычетов.Количество() > 100 Тогда
				ТаблицаВычетов.Индексы.Добавить("ФизическоеЛицо,НачалоМесяца");
			КонецЕсли;
			ПоискВычетов = Новый Структура("ФизическоеЛицо,НачалоМесяца");
			
			// Расчет облагаемого дохода нарастающим итогом с учетом всех вычетов для каждой даты получения дохода.
			ОблагаемыйДоходСНачалаГода = 0;
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			ТекущееНачалоМесяца = Неопределено;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					ОблагаемыйДоходСНачалаГода = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
					ТекущееНачалоМесяца = Неопределено;
				КонецЕсли;
				// Стандартные, имущественные вычеты учтем один раз за каждый месяц - в первую дату получения дохода месяца.
				ПредоставленныеВычеты = 0;
				Если ИскатьВычеты И СтрокаТаблицы.НалоговаяБаза = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда И ТекущееНачалоМесяца <> СтрокаТаблицы.НачалоМесяца Тогда
					ЗаполнитьЗначенияСвойств(ПоискВычетов, СтрокаТаблицы);
					СтрокиВычетов = ТаблицаВычетов.НайтиСтроки(ПоискВычетов);
					Если СтрокиВычетов.Количество() > 0 Тогда
						ПредоставленныеВычеты = СтрокиВычетов[0].Сумма;
					КонецЕсли;
					ТекущееНачалоМесяца = СтрокаТаблицы.НачалоМесяца;
				КонецЕсли;
				СтрокаТаблицы.ЭтоДеньПревышенияПредела = ОблагаемыйДоходСНачалаГода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел И ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
				ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты;
				СтрокаТаблицы.ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода;
				СтрокаТаблицы.ПределПревышен = ОблагаемыйДоходСНачалаГода > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
			КонецЦикла;
			
			Запрос.УстановитьПараметр("РасчетНарастающимИтогом", ТаблицаРасчетаНарастающимИтогом); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РасчетНарастающимИтогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасчетНарастающимИтогом.Период КАК Период,
			|	РасчетНарастающимИтогом.НалоговаяБаза КАК НалоговаяБаза,
			|	РасчетНарастающимИтогом.ОблагаемыйДоход КАК ОблагаемыйДоход,
			|	РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела КАК ЭтоДеньПревышенияПредела,
			|	РасчетНарастающимИтогом.ПределПревышен КАК ПределПревышен
			|ПОМЕСТИТЬ ВТРасчетНарастающимИтогом
			|ИЗ
			|	&РасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыПоСтавкам.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыПоСтавкам.Ставка КАК Ставка,
			|	ДоходыПоСтавкам.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыПоСтавкам.Регистратор КАК Регистратор,
			|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыПоСтавкам.Начисление КАК Начисление,
			|	ДоходыПоСтавкам.Период КАК Период,
			|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыПоСтавкам.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыПоСтавкам.КБК КАК КБК,
			|	ДоходыПоСтавкам.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыПоСтавкам.КодДохода КАК КодДохода,
			|	ДоходыПоСтавкам.СуммаДохода КАК СуммаДохода,
			|	ДоходыПоСтавкам.КодВычета КАК КодВычета,
			|	ДоходыПоСтавкам.СуммаВычета КАК СуммаВычета,
			|	ДоходыПоСтавкам.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода, 0) КАК ОблагаемыйДоходСНачалаГода,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела, ЛОЖЬ) КАК ЭтоДеньПревышенияПредела,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ПределПревышен, ЛОЖЬ) КАК ПределПревышен,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоход, 0) КАК ОблагаемыйДоходЗаДень
			|ПОМЕСТИТЬ ВТРасширенныеДанныеОДоходах
			|ИЗ
			|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|		ПО ДоходыПоСтавкам.ФизическоеЛицо = РасчетНарастающимИтогом.ФизическоеЛицо
			|			И ДоходыПоСтавкам.Период = РасчетНарастающимИтогом.Период
			|			И ДоходыПоСтавкам.НалоговаяБаза = РасчетНарастающимИтогом.НалоговаяБаза
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.СтавкаНалога КАК СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	РасширенныеДанныеОДоходах.КБК КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода) КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаВычета) КАК СуммаВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода - РасширенныеДанныеОДоходах.СуммаВычета) КАК ОблагаемаяСумма,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень КАК ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление,
			|	РасширенныеДанныеОДоходах.Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода,
			|	РасширенныеДанныеОДоходах.КБК,
			|	РасширенныеДанныеОДоходах.КодДохода,
			|	РасширенныеДанныеОДоходах.КодВычета,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2,
			|	РасширенныеДанныеОДоходах.ЭтоВКС
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	КодДохода";
			
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			ДоходыСУточненнымиСтавками = ТаблицаРасчетаНарастающимИтогом.СкопироватьКолонки();
			
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			СтрокиРаспределения = Новый Массив;
			ОблагаемыйДоходДоПредела = 0;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					Если ОблагаемыйДоходДоПредела <> 0 Тогда
						ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
					КонецЕсли;
					СтрокиРаспределения = Новый Массив;
					ОблагаемыйДоходДоПредела = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
				КонецЕсли;
				Если ОблагаемыйДоходДоПредела = 0 Тогда
					ОблагаемыйДоходДоПредела = СтрокаТаблицы.ОблагаемыйДоходЗаДень - СтрокаТаблицы.ОблагаемыйДоходСНачалаГода + ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел
				КонецЕсли;
				СтрокиРаспределения.Добавить(СтрокаТаблицы);
			КонецЦикла;
			Если ОблагаемыйДоходДоПредела <> 0 Тогда
				ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
			КонецЕсли;
			
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРасчетаНарастающимИтогом, ДоходыСУточненнымиСтавками); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			
			Запрос.УстановитьПараметр("ДоходыСУточненнымиСтавками", ДоходыСУточненнымиСтавками); ДоходыСУточненнымиСтавками = Неопределено;
			Запрос.Текст =
			"УНИЧТОЖИТЬ ВТДоходыПоСтавкам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка КАК Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор КАК Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление КАК Начисление,
			|	ДоходыСУточненнымиСтавками.Период КАК Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|			ТОГДА &КБКсПревышения
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.КБК
			|	КОНЕЦ КАК КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода КАК КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода КАК СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета КАК КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыСУточненнымиСтавками
			|ИЗ
			|	&ДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаЧисломСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.СтавкаНалога
			|	КОНЕЦ КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.Ставка
			|	КОНЕЦ КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &КБКсПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.КБК
			|	КОНЕЦ КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	РасширенныеДанныеОДоходах.СуммаДохода КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	РасширенныеДанныеОДоходах.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыПоСтавкам
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	НЕ РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление,
			|	ДоходыСУточненнымиСтавками.Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2,
			|	ДоходыСУточненнымиСтавками.КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета
			|ИЗ
			|	ВТДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками";
			Запрос.Выполнить();
			
			Если ИскатьВычеты Тогда
				Запрос.Текст =
				"УНИЧТОЖИТЬ ВТМесяцыПослеПревышения
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыУникальныхКБК
				|ИЗ
				|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|ГДЕ
				|	ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
				|
				|СГРУППИРОВАТЬ ПО
				|	ДоходыПоСтавкам.НалоговаяБаза,
				|	ДоходыПоСтавкам.ФизическоеЛицо,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ)
				|
				|ИМЕЮЩИЕ
				|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДоходыПоСтавкам.КБК) = 1
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	МесяцыУникальныхКБК.ФизическоеЛицо КАК ФизическоеЛицо,
				|	МесяцыУникальныхКБК.НалоговаяБаза КАК НалоговаяБаза,
				|	МесяцыУникальныхКБК.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
				|ИЗ
				|	ВТМесяцыУникальныхКБК КАК МесяцыУникальныхКБК
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|		ПО МесяцыУникальныхКБК.ФизическоеЛицо = ДоходыПоСтавкам.ФизическоеЛицо
				|			И МесяцыУникальныхКБК.НалоговаяБаза = ДоходыПоСтавкам.НалоговаяБаза
				|			И (МесяцыУникальныхКБК.МесяцНалоговогоПериода = НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ))
				|ГДЕ
				|	ДоходыПоСтавкам.КБК = &КБКсПревышения";
				Запрос.Выполнить();
			КонецЕсли;
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.УстановитьПараметр("СтрокиРаздела2ПоКодамДохода", УчетНДФЛПовтИсп.СтрокиРаздела2Расчета6НДФЛПоКодамДохода());
			
			ПоДатамТрудовыхДоговоров = Новый Массив;
			ПоДатамТрудовыхДоговоров.Добавить(УчетНДФЛПовтИсп.Доход2710());
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2720);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2760);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код4800);
			Запрос.УстановитьПараметр("ПоДатамДоговоров", ПоДатамТрудовыхДоговоров);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтрокиРаздела2ПоКодамДохода.КодДохода КАК КодДохода,
			|	СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТСтрокиРаздела2ПоКодамДохода
			|ИЗ
			|	&СтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.ЭтоВКС КАК ЭтоВКС,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
			|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 <> ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ПустаяСсылка)
			|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
			|		ИНАЧЕ СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2
			|	КОНЕЦ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|		ПО СведенияОДоходахНДФЛ.КодДохода = СтрокиРаздела2ПоКодамДохода.КодДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	&НачалоПериода КАК НачалоПериода,
			|	&ОкончаниеПериода КАК ОкончаниеПериода,
			|	&ГоловнаяОрганизация КАК ГоловнаяОрганизация
			|ИЗ
			|	ВТДоходыСоСтрокамиРаздела2 КАК ФизЛица
			|ГДЕ
			|	ФизЛица.СтрокаРаздела2 ЕСТЬ NULL";
			Результат = Запрос.Выполнить();
			Если Не Результат.Пустой() Тогда
				
				ФизЛицаОрганизаций = Результат.Выгрузить();
				Запрос.УстановитьПараметр("ТаблицаДоговоров", КадровыйУчет.ДоговорыФизическихЛиц(ФизЛицаОрганизаций)); ФизЛицаОрганизаций = Неопределено; 
				
				Запрос.Текст =
				"ВЫБРАТЬ
				|	ТаблицаДоговоров.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ТаблицаДоговоров.ВидДоговора КАК ВидДоговора,
				|	ТаблицаДоговоров.Окончание КАК Окончание,
				|	ТаблицаДоговоров.Начало КАК Начало
				|ПОМЕСТИТЬ ВТДоговоры
				|ИЗ
				|	&ТаблицаДоговоров КАК ТаблицаДоговоров
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период КАК Период,
				|	НЕ МИНИМУМ(ФизЛица.ВидДоговора) КАК ЕстьТрудовойДоговор
				|ПОМЕСТИТЬ ВТДниДоговоров
				|ИЗ
				|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоговоры КАК ФизЛица
				|		ПО (ФизЛица.Начало <= СведенияОДоходахНДФЛ.Период)
				|			И (ФизЛица.Окончание = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
				|				ИЛИ ФизЛица.Окончание >= СведенияОДоходахНДФЛ.Период)
				|			И СведенияОДоходахНДФЛ.ФизическоеЛицо = ФизЛица.ФизическоеЛицо
				|ГДЕ
				|	ФизЛица.ФизическоеЛицо ЕСТЬ НЕ NULL 
				|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
				|
				|СГРУППИРОВАТЬ ПО
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.Период КАК Период,
				|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
				|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
				|	СведенияОДоходахНДФЛ.ЭтоВКС КАК ЭтоВКС,
				|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
				|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
				|	СведенияОДоходахНДФЛ.КБК КАК КБК,
				|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
				|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
				|	ВЫБОР
				|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 ЕСТЬ НЕ NULL 
				|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
				|		КОГДА СведенияОДоходахНДФЛ.КодДохода В (&ПоДатамДоговоров)
				|			ТОГДА ВЫБОР
				|					КОГДА ЕСТЬNULL(ДниДоговоров.ЕстьТрудовойДоговор, ЛОЖЬ)
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
				|					КОГДА НЕ ДниДоговоров.ЕстьТрудовойДоговор
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
				|					ИНАЧЕ НЕОПРЕДЕЛЕНО
				|				КОНЕЦ
				|		ИНАЧЕ НЕОПРЕДЕЛЕНО
				|	КОНЕЦ КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТПодробныеДоходы
				|ИЗ
				|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДниДоговоров КАК ДниДоговоров
				|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДниДоговоров.ФизическоеЛицо
				|			И СведенияОДоходахНДФЛ.Период = ДниДоговоров.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|УНИЧТОЖИТЬ ВТДоходыСоСтрокамиРаздела2
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ПодробныеДоходы.Период КАК Период,
				|	ПодробныеДоходы.СтавкаНалога КАК СтавкаНалога,
				|	ПодробныеДоходы.Ставка КАК Ставка,
				|	ПодробныеДоходы.ЭтоВКС КАК ЭтоВКС,
				|	ПодробныеДоходы.Регистратор КАК Регистратор,
				|	ПодробныеДоходы.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ПодробныеДоходы.Начисление КАК Начисление,
				|	ПодробныеДоходы.КатегорияДохода КАК КатегорияДохода,
				|	ПодробныеДоходы.КБК КАК КБК,
				|	ПодробныеДоходы.КодДохода КАК КодДохода,
				|	ПодробныеДоходы.СуммаДохода КАК СуммаДохода,
				|	ПодробныеДоходы.СтрокаРаздела2 КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
				|ИЗ
				|	ВТПодробныеДоходы КАК ПодробныеДоходы";
				Запрос.Выполнить();
				
			КонецЕсли;
		КонецЕсли;
			
		Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТВычетыПоСтавкам
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаВычета <> 0
			|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА &ОсновнойКБК
			|		ИНАЧЕ &КБКсПревышения
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА 13
			|		ИНАЧЕ 15
			|	КОНЕЦ,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
			|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМесяцыПослеПревышения КАК СотрудникиСПревышением
			|		ПО ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода = СотрудникиСПревышением.МесяцНалоговогоПериода
			|			И (СотрудникиСПревышением.НалоговаяБаза = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда))
			|ГДЕ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ДанныеДляОтчета";
			Запрос.Выполнить();
		КонецЕсли;
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодДохода КАК КодДохода,
		|	СведенияОДоходах.Начисление КАК Начисление,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000020011003,
		|	СУММА(ВЫБОР
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.Дивиденды)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011103,
		|	СУММА(ВЫБОР
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011203,
		|	СУММА(ВЫБОР
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011303,
		|	СУММА(ВЫБОР
		|			КОГДА НЕ СведенияОДоходах.ЭтоВКС
		|				ТОГДА 0
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011503
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.КодДохода,
		|	СведенияОДоходах.Начисление,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодДохода");
			МассивПолей.Добавить("Начисление");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Доходы = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СУММА(ДанныеОКоличествах.ВсегоПолучателей) КАК П000020012003,
		|	СУММА(ДанныеОКоличествах.ВсегоВКС) КАК П000020012103,
		|	ДанныеОКоличествах.Ставка КАК Ставка,
		|	ДанныеОКоличествах.КБК КАК КБК
		|ИЗ
		|	(ВЫБРАТЬ
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0) КАК ВсегоПолучателей,
		|		0 КАК ВсегоВКС,
		|		СведенияОДоходахНДФЛ.Ставка КАК Ставка,
		|		СведенияОДоходахНДФЛ.КБК КАК КБК
		|	ИЗ
		|		ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		0,
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0),
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	ИЗ
		|		ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|		И СведенияОДоходахНДФЛ.ЭтоВКС
		|		И (СведенияОДоходахНДФЛ.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ИЛИ СведенияОДоходахНДФЛ.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор))
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК) КАК ДанныеОКоличествах
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеОКоличествах.Ставка,
		|	ДанныеОКоличествах.КБК";
		
		ОписаниеТаблиц.КоличествоПолучателейДохода = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета КАК КодВычета,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000020013003
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодВычета");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Вычеты = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТНалоги", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода, "ВТСтавкаНДФЛПоНалогам");
		
		Если Не ЗарплатаКадры.ВТСуществует(Запрос.МенеджерВременныхТаблиц, "ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних") Тогда
			ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТНалоги", "ФизическоеЛицо");
			ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
			ПараметрыПостроения.ВсеЗаписи = Истина;
		    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
			ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
				"СтатусыЗастрахованныхФизическихЛиц",
				Запрос.МенеджерВременныхТаблиц,
				Ложь,
				ОписаниеФильтра,
				ПараметрыПостроения);
		КонецЕсли;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходах.Период КАК Период,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА НЕ СведенияОДоходах.ЭтоВКС
		|				ТОГДА ЛОЖЬ
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА ИСТИНА
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		КОНЕЦ) КАК ЭтоВКС
		|ПОМЕСТИТЬ ВТСведенияВКС
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода,
		|	СведенияОДоходах.Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛ.КБК КАК КБК,
		|	НДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Начислено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НачисленоПоДивидендам,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ЗачтеноАвансов,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Удержано,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК УдержаноЗаНалоговыйПериод,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.Сумма
		|					КОГДА ВЫБОР
		|							КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|								ТОГДА ВЫБОР
		|										КОГДА НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|											ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|										ИНАЧЕ 0
		|									КОНЕЦ
		|							ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|						КОНЕЦ * НДФЛ.Сумма > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.Сумма > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.Сумма - ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА ВЫБОР
		|																			КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																				ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																			ИНАЧЕ 0
		|																		КОНЕЦ
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|												КОНЕЦ > 0
		|												ТОГДА НДФЛ.Сумма - ВЫБОР
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА ВЫБОР
		|																				КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																					ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																				ИНАЧЕ 0
		|																			КОНЕЦ
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|													КОНЕЦ
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.Сумма - ВЫБОР
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|									КОНЕЦ < 0
		|									ТОГДА НДФЛ.Сумма - ВЫБОР
		|											КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|												ТОГДА ВЫБОР
		|														КОГДА НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|															ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|														ИНАЧЕ 0
		|													КОНЕЦ
		|											ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|										КОНЕЦ
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.Сумма
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Сальдо,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Возвращено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.Сумма > 0
		|			ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|									ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ НДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов,
		|	НДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода
		|ПОМЕСТИТЬ ВТНалогиПоСтавкам
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.Сумма <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	&КБКсПревышения,
		|	НДФЛ.ФизическоеЛицо,
		|	15,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15),
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.СуммаСПревышения
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.СуммаСПревышения > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов > 0
		|												ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов < 0
		|									ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|						ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	НДФЛ.КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.СуммаСПревышения <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Сальдо) КАК НеУдержано,
		|	Налоги.КБК КАК КБК
		|ПОМЕСТИТЬ ВТНеУдержано
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.КБК КАК КБК,
		|	-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|ПОМЕСТИТЬ ВТИзлишнеУдержаноПоКБК
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Начислено) КАК Начислено,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК НачисленоПоДивидендам,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК НалогНаПрибыльДляДивидендов,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК ЗачтеноАвансов,
		|	СУММА(Налоги.Удержано) КАК Удержано,
		|	СУММА(Налоги.УдержаноЗаНалоговыйПериод) КАК УдержаноЗаНалоговыйПериод,
		|	СУММА(Налоги.Возвращено) КАК Возвращено,
		|	ЕСТЬNULL(МАКСИМУМ(ПоФизлицам.НеУдержано), 0) КАК НеУдержано,
		|	ЕСТЬNULL(МАКСИМУМ(ИзлишнеУдержаноПоКБК.ИзлишнеУдержано), 0) КАК ИзлишнеУдержано,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ) КАК ЭтоВКС
		|ПОМЕСТИТЬ ВТДанныеПоФизлицам
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияВКС КАК СведенияВКС
		|		ПО Налоги.ФизическоеЛицо = СведенияВКС.ФизическоеЛицо
		|			И Налоги.КатегорияДохода = СведенияВКС.КатегорияДохода
		|			И Налоги.ДатаПолученияДохода = СведенияВКС.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНеУдержано КАК ПоФизлицам
		|		ПО Налоги.ФизическоеЛицо = ПоФизлицам.ФизическоеЛицо
		|			И Налоги.СтавкаНалога = ПоФизлицам.СтавкаНалога
		|			И Налоги.КБК = ПоФизлицам.КБК
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИзлишнеУдержаноПоКБК КАК ИзлишнеУдержаноПоКБК
		|		ПО Налоги.ФизическоеЛицо = ИзлишнеУдержаноПоКБК.ФизическоеЛицо
		|			И Налоги.КБК = ИзлишнеУдержаноПоКБК.КБК
		|			И Налоги.СтавкаНалога = ИзлишнеУдержаноПоКБК.СтавкаНалога
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0
		|			ИЛИ Налоги.Возвращено <> 0
		|			ИЛИ ИзлишнеУдержаноПоКБК.ИзлишнеУдержано <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(Налоги.Начислено) КАК П000020014003,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК П000020014103,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ЭтоВКС
		|				ТОГДА Налоги.Начислено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020014203,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК П000020015003,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК П000020015503,
		|	СУММА(Налоги.Удержано) КАК П000020016003,
		|	СУММА(Налоги.НеУдержано) КАК П000020017003,
		|	СУММА(Налоги.Возвращено) КАК П000020019003,
		|	СУММА(Налоги.ИзлишнеУдержано) КАК П000020018003,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.Возвращено <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	Налоги.ФизическоеЛицо";
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "Налоги");
		ОписаниеТаблиц.Раздел2Налоги = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		НеобходимыеКадровыеДанные = Новый Массив();
		НеобходимыеКадровыеДанные.Добавить("ФизическоеЛицо");
		НеобходимыеКадровыеДанные.Добавить("ИНН");
		НеобходимыеКадровыеДанные.Добавить("Наименование");
		НеобходимыеКадровыеДанные.Добавить("Фамилия");
		НеобходимыеКадровыеДанные.Добавить("Имя");
		НеобходимыеКадровыеДанные.Добавить("Отчество");
		НеобходимыеКадровыеДанные.Добавить("СтатусНалогоплательщика");
		НеобходимыеКадровыеДанные.Добавить("ВидЗастрахованногоЛица");
		НеобходимыеКадровыеДанные.Добавить("ДатаРождения");	
		НеобходимыеКадровыеДанные.Добавить("ДокументВид");
		НеобходимыеКадровыеДанные.Добавить("ДокументСерия");
		НеобходимыеКадровыеДанные.Добавить("ДокументНомер");
		НеобходимыеКадровыеДанные.Добавить("ДокументСтранаВыдачи");
		НеобходимыеКадровыеДанные.Добавить("Страна");
		
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах";
		ЗарплатаКадры.УничтожитьВТ(Запрос.МенеджерВременныхТаблиц,"ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних", Истина);
		КадровыйУчет.СоздатьНаДатуВТКадровыеДанныеФизическихЛиц(Запрос.МенеджерВременныхТаблиц, Истина, Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НеобходимыеКадровыеДанные, ДатаАктуальности);
		
		// Для корректирующей и отменяющей формы прочитаем переданные в предыдущих отчетах данные.
		Если НомерКорректировки > 0 Тогда
			ФормироватьПустыеДанные = ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив") И РегистрацияВНалоговомОргане.Количество() = 0;
			Если ФормироватьПустыеДанные Тогда
				СоздатьПустыеВТПереданныхДанныхОтчета2021(Запрос.МенеджерВременныхТаблиц)
			Иначе 
				РеквизитыРегистрации = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(?(ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив"), РегистрацияВНалоговомОргане[0], РегистрацияВНалоговомОргане), "КодПоОКТМО,КПП");
				ПолучитьПереданныеДанныеОтчета2021(Организация, СокрЛП(РеквизитыРегистрации.КодПоОКТМО), СокрЛП(РеквизитыРегистрации.КПП), ОкончаниеПериода, Запрос.МенеджерВременныхТаблиц, НомерКорректировки, "ФормаОтчета2021Кв4");
			КонецЕсли;
		КонецЕсли;
		
		// Для отменяющей формы нужен только перечень переданных справок.
		Если НомерКорректировки = 99 Тогда
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.НомерСправки КАК НомерСправки,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Фамилия + "" "" + КадровыеДанныеФизЛиц.Имя + "" "" + КадровыеДанныеФизЛиц.Отчество КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			Возврат
		КонецЕсли;
		
		// Для исходной и корректирующей форм соберем текущие данные.
		УчетНДФЛ.СоздатьВТСтавкиНалогаЧислом(Запрос.МенеджерВременныхТаблиц);
		Запрос.Текст =
		"ВЫБРАТЬ
		|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
		|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
		|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
		|	КадровыеДанныеФизЛиц.Имя КАК Имя,
		|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
		|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """") КАК СерияДокумента,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """") КАК НомерДокумента,
		|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|			ТОГДА ВЫБОР
		|					КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|						ТОГДА ""643""
		|					ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
		|				КОНЕЦ
		|		ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
		|	КОНЕЦ КАК КодСтраныДляОтчетности,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.ВидЗастрахованногоЛица В (&ВКС)
		|				И КадровыеДанныеФизЛиц.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ТОГДА ""7""
		|		ИНАЧЕ ЕСТЬNULL(СтатусыНалогоплательщиковПоНДФЛ.КодФНС_2015, """")
		|	КОНЕЦ КАК КодФНС,
		|	ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """") КАК КодМВД
		|ПОМЕСТИТЬ ВТФизлицаПоТекущимДанным
		|ИЗ
		|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
		|		ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтатусыНалогоплательщиковПоНДФЛ КАК СтатусыНалогоплательщиковПоНДФЛ
		|		ПО КадровыеДанныеФизЛиц.СтатусНалогоплательщика = СтатусыНалогоплательщиковПоНДФЛ.Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ДанныеИтогов.Ставка КАК Ставка,
		|	ДанныеИтогов.КБК КАК КБК,
		|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
		|	СУММА(ДанныеИтогов.П000П1М100002) КАК П000П1М100002,
		|	СУММА(ДанныеИтогов.П000П1М100003) КАК П000П1М100003,
		|	СУММА(ДанныеИтогов.П000П1М100004) КАК П000П1М100004,
		|	СУММА(ДанныеИтогов.П000П1М100005) КАК П000П1М100005,
		|	СУММА(ДанныеИтогов.П000П1М100006) КАК П000П1М100006,
		|	СУММА(ДанныеИтогов.П000П1М100007) КАК П000П1М100007,
		|	СУММА(ДанныеИтогов.П000П1М100008) КАК П000П1М100008,
		|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
		|	СУММА(ДанныеИтогов.П000П1М100010) КАК П000П1М100010
		|ПОМЕСТИТЬ ВТДанныеИтоговПоТекущимДанным
		|ИЗ
		|	(ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|		Налоги.СтавкаНалога КАК Ставка,
		|		Налоги.КБК КАК КБК,
		|		Налоги.СтавкаНалога КАК П000П1М100001,
		|		Налоги.КБК КАК П000П1М100009,
		|		0 КАК П000П1М100002,
		|		0 КАК П000П1М100003,
		|		Налоги.Начислено КАК П000П1М100004,
		|		Налоги.УдержаноЗаНалоговыйПериод КАК П000П1М100005,
		|		Налоги.ЗачтеноАвансов КАК П000П1М100006,
		|		0 КАК П000П1М100007,
		|		0 КАК П000П1М100008,
		|		Налоги.НалогНаПрибыльДляДивидендов КАК П000П1М100010
		|	ИЗ
		|		ВТДанныеПоФизлицам КАК Налоги
		|	ГДЕ
		|		(Налоги.Начислено <> 0
		|				ИЛИ Налоги.ЗачтеноАвансов <> 0
		|				ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СуммаДохода,
		|		СведенияОДоходах.СуммаДохода,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК СведенияОДоходах
		|	ГДЕ
		|		СведенияОДоходах.ДанныеДляОтчета
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		0,
		|		-СведенияОДоходах.СуммаВычета,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТВычетыПоСтавкам КАК СведенияОДоходах
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		Налоги.ИзлишнеУдержано,
		|		0
		|	ИЗ
		|		(ВЫБРАТЬ
		|			Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|			Налоги.СтавкаНалога КАК СтавкаНалога,
		|			Налоги.КБК КАК КБК,
		|			-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|		ИЗ
		|			ВТНалогиПоСтавкам КАК Налоги
		|		
		|		СГРУППИРОВАТЬ ПО
		|			Налоги.ФизическоеЛицо,
		|			Налоги.КБК,
		|			Налоги.СтавкаНалога
		|		
		|		ИМЕЮЩИЕ
		|			СУММА(Налоги.Сальдо) < 0) КАК Налоги
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.ФизическоеЛицо,
		|		СтавкиНалогаЧислом.Размер * 100,
		|		ВЫБОР
		|			КОГДА РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|				ТОГДА &КБКсПревышения
		|			ИНАЧЕ &ОсновнойКБК
		|		КОНЕЦ,
		|		СтавкиНалогаЧислом.Размер * 100,
		|		ВЫБОР
		|			КОГДА РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|				ТОГДА &КБКсПревышения
		|			ИНАЧЕ &ОсновнойКБК
		|		КОНЕЦ,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Сумма,
		|		0,
		|		0
		|	ИЗ
		|		РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛ
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкиНалогаЧислом КАК СтавкиНалогаЧислом
		|			ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Ставка = СтавкиНалогаЧислом.СтавкаНалогообложения
		|	ГДЕ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|		И РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|		И РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода) КАК ДанныеИтогов
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеИтогов.Ставка,
		|	ДанныеИтогов.КБК,
		|	ДанныеИтогов.ФизическоеЛицо,
		|	ДанныеИтогов.П000П1М100001,
		|	ДанныеИтогов.П000П1М100009
		|
		|ИМЕЮЩИЕ
		|	СУММА(ДанныеИтогов.П000П1М100002) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ) КАК Период,
		|	СведенияОДоходах.СтавкаНалога КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """") КАК П000П1М500002,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000П1М500003,
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года, """") КАК П000П1М600004,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000П1М600005
		|ПОМЕСТИТЬ ВТДоходыПоТекущимДанным
		|ИЗ
		|	ВТДоходыПоСтавкам КАК СведенияОДоходах
		|ГДЕ
		|	СведенияОДоходах.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """"),
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года, """"),
		|	СведенияОДоходах.СтавкаНалога,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходах.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходах.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОВычетах.СтавкаНалога КАК Ставка,
		|	СведенияОВычетах.КБК КАК КБК,
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета КАК ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года КАК П000П1М200001,
		|	СУММА(СведенияОВычетах.СуммаВычета) КАК П000П1М200002
		|ПОМЕСТИТЬ ВТВычетыПоТекущимДанным
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.КодВычета.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОВычетах.СтавкаНалога,
		|	СведенияОВычетах.КБК,
		|	СведенияОВычетах.ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2016Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(СведенияОВычетах.СуммаВычета) <> 0";
		Запрос.Выполнить();
		
		НалоговыйПериод = Год(ОкончаниеПериода);
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)";
		ДанныеУведомлений = УчетНДФЛ.ДанныеУведомленийНаВычеты(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеУведомлений.Колонки.Сотрудник.Имя = "ФизическоеЛицо";
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	Налоги.ЗачтеноАвансов <> 0";
		ДанныеЗачетаАвансовыхПлатежей = УчетНДФЛ.ДанныеУведомленийНаЗачетАвансовыхПлатежей(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеЗачетаАвансовыхПлатежей.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ДанныеЗачетаАвансовыхПлатежей, ДанныеУведомлений);
		
		Если НомерКорректировки = 0 Тогда
			
			// Для исходной формы дополнительных действий не требуется, возвращаем полученные данные.
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100007 КАК П000П1М100007,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	П000П1М200001";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			ДанныеУведомлений.Колонки.НомерУведомления.Имя = "П000П1М300002";
			ДанныеУведомлений.Колонки.ДатаУведомления.Имя = "П000П1М300003";
			ДанныеУведомлений.Колонки.КодНалоговогоОрганаУведомления.Имя = "П000П1М300004";
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = ДанныеУведомлений;
			
		Иначе
			
			// Для корректирующей формы определим перечень сотрудников, чьи данные отличаются от переданных ранее, и вернем данные учета только для них.
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(Запрос.МенеджерВременныхТаблиц, ДанныеУведомлений, "ВТУведомленияОВычетахПоТекущимДанным");
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СУММА(СведенияОДоходах.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТТолькоДоходыПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СУММА(СведенияОДоходах.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002,
			|	СведенияОДоходах.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(СведенияОДоходах.П000П1М600005) <> 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаВОтчет
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО ФизлицаПоТекущимДанным.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|			И ФизлицаПоТекущимДанным.ИНН = ФизлицаПереданные.ИНН
			|			И ФизлицаПоТекущимДанным.Фамилия = ФизлицаПереданные.Фамилия
			|			И ФизлицаПоТекущимДанным.Имя = ФизлицаПереданные.Имя
			|			И ФизлицаПоТекущимДанным.Отчество = ФизлицаПереданные.Отчество
			|			И ФизлицаПоТекущимДанным.ДатаРождения = ФизлицаПереданные.ДатаРождения
			|			И ФизлицаПоТекущимДанным.КодСтраныДляОтчетности = ФизлицаПереданные.КодСтраныДляОтчетности
			|			И ФизлицаПоТекущимДанным.СерияДокумента = ФизлицаПереданные.СерияДокумента
			|			И ФизлицаПоТекущимДанным.НомерДокумента = ФизлицаПереданные.НомерДокумента
			|			И ФизлицаПоТекущимДанным.КодФНС = ФизлицаПереданные.КодФНС
			|			И ФизлицаПоТекущимДанным.КодМВД = ФизлицаПереданные.КодМВД
			|ГДЕ
			|	ФизлицаПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДанныеИтогов.ФизическоеЛицо
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиПереданные КАК ИтогиПереданные
			|		ПО ДанныеИтогов.ФизическоеЛицо = ИтогиПереданные.ФизическоеЛицо
			|			И ДанныеИтогов.П000П1М100001 = ИтогиПереданные.П000П1М100001
			|			И ДанныеИтогов.П000П1М100002 = ИтогиПереданные.П000П1М100002
			|			И ДанныеИтогов.П000П1М100003 = ИтогиПереданные.П000П1М100003
			|			И ДанныеИтогов.П000П1М100004 = ИтогиПереданные.П000П1М100004
			|			И ДанныеИтогов.П000П1М100005 = ИтогиПереданные.П000П1М100005
			|			И ДанныеИтогов.П000П1М100006 = ИтогиПереданные.П000П1М100006
			|			И ДанныеИтогов.П000П1М100007 = ИтогиПереданные.П000П1М100007
			|			И ДанныеИтогов.П000П1М100008 = ИтогиПереданные.П000П1М100008
			|			И ДанныеИтогов.П000П1М100009 = ИтогиПереданные.П000П1М100009
			|			И ДанныеИтогов.П000П1М100010 = ИтогиПереданные.П000П1М100010
			|ГДЕ
			|	ИтогиПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ИтогиПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТИтогиПереданные КАК ИтогиПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ПО ИтогиПереданные.ФизическоеЛицо = ДанныеИтогов.ФизическоеЛицо
			|			И ИтогиПереданные.П000П1М100001 = ДанныеИтогов.П000П1М100001
			|			И ИтогиПереданные.П000П1М100002 = ДанныеИтогов.П000П1М100002
			|			И ИтогиПереданные.П000П1М100003 = ДанныеИтогов.П000П1М100003
			|			И ИтогиПереданные.П000П1М100004 = ДанныеИтогов.П000П1М100004
			|			И ИтогиПереданные.П000П1М100005 = ДанныеИтогов.П000П1М100005
			|			И ИтогиПереданные.П000П1М100006 = ДанныеИтогов.П000П1М100006
			|			И ИтогиПереданные.П000П1М100007 = ДанныеИтогов.П000П1М100007
			|			И ИтогиПереданные.П000П1М100008 = ДанныеИтогов.П000П1М100008
			|			И ИтогиПереданные.П000П1М100009 = ДанныеИтогов.П000П1М100009
			|			И ИтогиПереданные.П000П1М100010 = ДанныеИтогов.П000П1М100010
			|ГДЕ
			|	ДанныеИтогов.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходах.ФизическоеЛицо
			|ИЗ
			|	ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПереданные КАК ДоходыПереданные
			|		ПО СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо
			|			И СведенияОДоходах.Ставка = ДоходыПереданные.Ставка
			|			И СведенияОДоходах.КБК = ДоходыПереданные.КБК
			|			И СведенияОДоходах.Период = ДоходыПереданные.Период
			|			И СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002
			|			И СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003
			|ГДЕ
			|	ДоходыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДоходыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТДоходыПереданные КАК ДоходыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ПО (СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо)
			|			И (СведенияОДоходах.Ставка = ДоходыПереданные.Ставка)
			|			И (СведенияОДоходах.КБК = ДоходыПереданные.КБК)
			|			И (СведенияОДоходах.Период = ДоходыПереданные.Период)
			|			И (СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002)
			|			И (СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003)
			|ГДЕ
			|	СведенияОДоходах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.Ставка = ВычетыПереданные.Ставка
			|			И СведенияОВычетах.КБК = ВычетыПереданные.КБК
			|			И СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001
			|			И СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.Ставка = ВычетыПереданные.Ставка)
			|			И (СведенияОВычетах.КБК = ВычетыПереданные.КБК)
			|			И (СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001)
			|			И (СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета
			|			И СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002
			|			И СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003
			|			И СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета)
			|			И (СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002)
			|			И (СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003)
			|			И (СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(ФизлицаПереданные.НомерСправки, 0) КАК НомерСправки,
			|	ЕСТЬNULL(ФизлицаПереданные.НомерКорректировки, 0) КАК НомерКорректировки,
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеНалогоплательщиков
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПереданные.НомерСправки,
			|	99,
			|	ФизлицаПереданные.ФизическоеЛицо,
			|	ФизлицаПереданные.ИНН,
			|	ФизлицаПереданные.Фамилия,
			|	ФизлицаПереданные.Имя,
			|	ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.ДатаРождения,
			|	ФизлицаПереданные.СерияДокумента,
			|	ФизлицаПереданные.НомерДокумента,
			|	ФизлицаПереданные.Фамилия + "" "" + ФизлицаПереданные.Имя + "" "" + ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.КодСтраныДляОтчетности,
			|	ФизлицаПереданные.КодФНС,
			|	ФизлицаПереданные.КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ПО ФизлицаПереданные.ФизическоеЛицо = ФизлицаПоТекущимДанным.ФизическоеЛицо
			|			И ФизлицаПереданные.ИНН = ФизлицаПоТекущимДанным.ИНН
			|			И ФизлицаПереданные.Фамилия = ФизлицаПоТекущимДанным.Фамилия
			|			И ФизлицаПереданные.Имя = ФизлицаПоТекущимДанным.Имя
			|			И ФизлицаПереданные.Отчество = ФизлицаПоТекущимДанным.Отчество
			|			И ФизлицаПереданные.ДатаРождения = ФизлицаПоТекущимДанным.ДатаРождения
			|			И ФизлицаПереданные.КодСтраныДляОтчетности = ФизлицаПоТекущимДанным.КодСтраныДляОтчетности
			|			И ФизлицаПереданные.СерияДокумента = ФизлицаПоТекущимДанным.СерияДокумента
			|			И ФизлицаПереданные.НомерДокумента = ФизлицаПоТекущимДанным.НомерДокумента
			|			И ФизлицаПереданные.КодФНС = ФизлицаПоТекущимДанным.КодФНС
			|			И ФизлицаПереданные.КодМВД = ФизлицаПоТекущимДанным.КодМВД
			|ГДЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо ЕСТЬ NULL
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДанныеНалогоплательщиков.НомерСправки КАК НомерСправки,
			|	ДанныеНалогоплательщиков.НомерКорректировки КАК НомерКорректировки,
			|	ДанныеНалогоплательщиков.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеНалогоплательщиков.ИНН КАК ИНН,
			|	ДанныеНалогоплательщиков.Фамилия КАК Фамилия,
			|	ДанныеНалогоплательщиков.Имя КАК Имя,
			|	ДанныеНалогоплательщиков.Отчество КАК Отчество,
			|	ДанныеНалогоплательщиков.ДатаРождения КАК ДатаРождения,
			|	ДанныеНалогоплательщиков.СерияДокумента КАК СерияДокумента,
			|	ДанныеНалогоплательщиков.НомерДокумента КАК НомерДокумента,
			|	ВЫРАЗИТЬ(ДанныеНалогоплательщиков.Наименование КАК СТРОКА(1000)) КАК Наименование,
			|	ДанныеНалогоплательщиков.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ДанныеНалогоплательщиков.КодФНС КАК КодФНС,
			|	ДанныеНалогоплательщиков.КодМВД КАК КодМВД
			|ИЗ
			|	ВТДанныеНалогоплательщиков КАК ДанныеНалогоплательщиков
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(МАКСИМУМ(ДанныеНалогоплательщиков.НомерСправки), 0) КАК НомерСправки
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ДанныеНалогоплательщиков";
			Результаты = Запрос.ВыполнитьПакет();
			// АПК:96-вкл
			ВсегоРезультатов = Результаты.Количество();
			ОписаниеТаблиц.Приложение1Налогоплательщики = Результаты[ВсегоРезультатов - 2].Выгрузить();
			МаксимальныйНомерИзПереданныхСправок = 0;
			Если Не Результаты[ВсегоРезультатов - 1].Пустой() Тогда
				Выборка = Результаты[ВсегоРезультатов - 1].Выбрать();
				Выборка.Следующий();
				МаксимальныйНомерИзПереданныхСправок = Выборка.НомерСправки;
			КонецЕсли;
			ОписаниеТаблиц.Вставить("Приложение1МаксимальныйНомерИзПереданныхСправок", МаксимальныйНомерИзПереданныхСправок + 1);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100007 КАК П000П1М100007,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ДанныеИтогов.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОДоходах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОВычетах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.НомерУведомления КАК П000П1М300002,
			|	ВременнаяТаблица.ДатаУведомления КАК П000П1М300003,
			|	ВременнаяТаблица.КодНалоговогоОрганаУведомления КАК П000П1М300004
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ВременнаяТаблица.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL"; 
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = Запрос.Выполнить().Выгрузить();
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОписаниеПоказателей_6НДФЛ_2023Кв1(ПоказателиОтчета) Экспорт
	
	
	// Раздел 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010001001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002101", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002201", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002301", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002401", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М203101", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П00001М203201", Истина, Истина);
	
	// Раздел 2
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010501", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011303", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012103", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020017003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020018003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019003", Истина, Истина);
	
	// Приложение 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000011", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000012", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600005", Истина, Ложь);

КонецПроцедуры

Процедура ЗначенияПоказателей_6НДФЛ_2023Кв1(ПараметрыОтчета, Контейнер) Экспорт
	
	ДатаКонцаПериодаОтчета = ПараметрыОтчета.ДатаКонцаПериодаОтчета;
	Организация = ПараметрыОтчета.Организация;
	НачалоПериода = НачалоГода(ДатаКонцаПериодаОтчета);
	ОкончаниеПериода = КонецМесяца(ДатаКонцаПериодаОтчета);
	НомерКорректировки = ПараметрыОтчета.НомерКорректировки;
	Если ПараметрыОтчета.Свойство("РегистрацииВНО") Тогда
		РегистрацияВНалоговомОргане = ПараметрыОтчета.РегистрацииВНО;
	Иначе
		ТитульныйЛист = Контейнер.Титульный;
		ПараметрыОтбораРегистрацийВНО = Новый Структура;
		ПараметрыОтбораРегистрацийВНО.Вставить("КодНО", ТитульныйЛист.НалоговыйОрган);
		ПараметрыОтбораРегистрацийВНО.Вставить("ОКТМО", ТитульныйЛист.ОКТМО);
		Если СтрДлина(ТитульныйЛист.ИНН) = 10 Тогда
			ПараметрыОтбораРегистрацийВНО.Вставить("КПП", ТитульныйЛист.КПП);
			ПараметрыОтбораРегистрацийВНО.Вставить("ИскатьПоПервымСимволамОКТМО", Истина);
		КонецЕсли;
		РегистрацияВНалоговомОргане = РегламентированнаяОтчетность.РегистрацииОрганизацииВНалоговомОргане(Организация, ПараметрыОтбораРегистрацийВНО);
	КонецЕсли;
	ЗаполнятьПриложение1 = КонецМесяца(ОкончаниеПериода) = КонецГода(ОкончаниеПериода);
	Если ПараметрыОтчета.Свойство("ЗаполнятьПриложение1") Тогда
		ЗаполнятьПриложение1 = ПараметрыОтчета.ЗаполнятьПриложение1;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РегистрацияВНалоговомОргане) Тогда
		Возврат
	КонецЕсли;
	                         
	// Очистка отчета
	ПоказателиОтчета = Новый Структура;
	ОписаниеПоказателей_6НДФЛ_2023Кв1(ПоказателиОтчета);
	
	ДанныеРаздела1 = Контейнер.Раздел1.Строки;
	ПоляКБК = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].Данные); 
	ПоляСуммВозврата = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].ДанныеМногострочныхЧастей.П00001М2.Строки[0].Данные);
	ДанныеРаздела1.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляКБК);
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляСуммВозврата);
	
	ДанныеРаздела2 = Контейнер.Раздел2.Строки;
	ПоляРаздела2 = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела2[0].Данные); 
	ДанныеРаздела2.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляРаздела2);
	
	Если ЗаполнятьПриложение1 Тогда
		
		ДанныеПриложение1 = Контейнер.Приложение1.Строки;
		ДанныеСправки = ДанныеПриложение1[0].ДанныеМногострочныхЧастей.П000П1М1.Строки;
		ПоляНалогоплательщика = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеПриложение1[0].Данные);
		ПоляИтогов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].Данные);
		ПоляВычетов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М2.Строки[0].Данные);
		ПоляУведомленийОВычетах = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М3.Строки[0].Данные);
		ПоляНеудержано = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М4.Строки[0].Данные);
		ПоляДоходов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].Данные);
		ПоляВычетовКДоходам = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].ДанныеМногострочныхЧастей.П000П1М6.Строки[0].Данные);
		ДанныеПриложение1.Очистить();
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляНалогоплательщика);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляИтогов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляУведомленийОВычетах);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляДоходов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетовКДоходам);
		Для каждого КлючИЗначение Из ПоляНеудержано Цикл
			ПоляНеудержано[КлючИЗначение.Ключ] = 0
		КонецЦикла;
		
	КонецЕсли;
	
	// Сбор данных
	ОписаниеТаблиц = Новый Структура("КоличествоПолучателейДохода, Раздел1Налоги, Раздел1Возвраты, Раздел2Доходы, Раздел2Вычеты, Раздел2Налоги, КоличествоПолучателейДохода");
	Если ЗаполнятьПриложение1 Тогда
		ОписаниеТаблиц.Вставить("Приложение1Налогоплательщики");	
		Если НомерКорректировки <> 99 Тогда
			ОписаниеТаблиц.Вставить("Приложение1Итоги");	
			ОписаниеТаблиц.Вставить("Приложение1Доходы");	
			ОписаниеТаблиц.Вставить("Приложение1Вычеты");	
			ОписаниеТаблиц.Вставить("Приложение1УведомленияОВычетах");	
		КонецЕсли;
	КонецЕсли;
	РасчетПоказателей_6НДФЛ_2023Кв1(НачалоПериода, ОкончаниеПериода, ?(ПараметрыОтчета.ДатаПодписи > ОкончаниеПериода,ПараметрыОтчета.ДатаПодписи, ОкончаниеПериода), Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, Ложь, НомерКорректировки);	
	
	// Вывод данных в отчет
	ВсеКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	ПоискПоКБК = Новый Структура("КБК");
	
	// Раздел 1
	Налоги = ОписаниеТаблиц.Раздел1Налоги;
	Возвраты = ОписаниеТаблиц.Раздел1Возвраты;
	Для каждого КлючИЗначение Из ВсеКБК Цикл
		КБК = КлючИЗначение.Значение;
		ПоискПоКБК.КБК = КБК;
		СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБК);
		Если СтрокиНалогов.Количество() > 0 Тогда
			СтрокаНалогов = СтрокиНалогов[0]
	 	КонецЕсли;
		СтрокиВозвратов = Возвраты.НайтиСтроки(ПоискПоКБК);
		СоздаватьСтраницуКБК = СтрокиВозвратов.Количество() > 0 
			Или СтрокиНалогов.Количество() > 0 
				И (СтрокаНалогов.П000010002101 <> 0 Или СтрокаНалогов.П000010002201 <> 0 Или СтрокаНалогов.П000010002301 <> 0 Или СтрокаНалогов.П000010002401 <> 0);
		Если СоздаватьСтраницуКБК Тогда
			СтраницаРаздела1 = ДанныеРаздела1.Добавить();
			СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
			Если СтрокиНалогов.Количество() > 0 Тогда
				ЗаполнитьЗначенияСвойств(СтраницаРаздела1.Данные, СтрокаНалогов);
			КонецЕсли;
			СтраницаРаздела1.Данные.П000010001001 = КБК;
			СтраницаРаздела1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П00001М2");
			Если СтрокиВозвратов.Количество() > 0 Тогда
				Для каждого СтрокаВозвратов Из СтрокиВозвратов Цикл
					НоваяСтрокаСуммВозврата = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить();
					НоваяСтрокаСуммВозврата.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
					ЗаполнитьЗначенияСвойств(НоваяСтрокаСуммВозврата.Данные, СтрокаВозвратов);
				КонецЦикла;
			Иначе
				НоваяСтрокаСуммВозврата = СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить();
				НоваяСтрокаСуммВозврата.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	Если ДанныеРаздела1.Количество() = 0 Тогда
		СтраницаРаздела1 = ДанныеРаздела1.Добавить();
		СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
		СтраницаРаздела1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П00001М2");
		СтраницаРаздела1.ДанныеМногострочныхЧастей.П00001М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляСуммВозврата);
	КонецЕсли;
	
	// Раздел 2
	Доходы = ОписаниеТаблиц.Раздел2Доходы;
	Вычеты = ОписаниеТаблиц.Раздел2Вычеты;
	Налоги = ОписаниеТаблиц.Раздел2Налоги;
	Количество = ОписаниеТаблиц.КоличествоПолучателейДохода;
	ПоискПоКБКиСтавке = Новый Структура("КБК,Ставка");
	Для каждого Ставка Из Перечисления.НДФЛСтавки Цикл
		ПоискПоКБКиСтавке.Ставка = Ставка;
		Для каждого КлючИЗначение Из ВсеКБК Цикл
			КБК = КлючИЗначение.Значение;
			ПоискПоКБКиСтавке.КБК = КБК;
			СтрокиДоходов = Доходы.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиВычетов = Вычеты.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиКоличества = Количество.НайтиСтроки(ПоискПоКБКиСтавке);
			
			Если СтрокиДоходов.Количество() > 0 Или СтрокиНалогов.Количество() > 0 Или СтрокиВычетов.Количество() > 0 Тогда
				СтраницаРаздела = ДанныеРаздела2.Добавить();
				СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
				СтраницаРаздела.Данные.П000020010501 = КБК;
				Если Ставка = Перечисления.НДФЛСтавки.Ставка03 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 3
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка05 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 5
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка06 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 6
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка07 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 7
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка09 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 9
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка10 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 10
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка12 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 12
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка13 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 13
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка15 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 15
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка30 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 30
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка35 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 35
				Иначе
					
				КонецЕсли;
				СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
			КонецЕсли;
			Для каждого СтрокаДанных Из СтрокиДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиНалогов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиВычетов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиКоличества Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			
		КонецЦикла;
	КонецЦикла;
	Если ДанныеРаздела2.Количество() = 0 Тогда
		СтраницаРаздела = ДанныеРаздела2.Добавить();
		СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
		СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
	КонецЕсли;
	
	// Приложение 1
	Если ЗаполнятьПриложение1 Тогда
		Если ОписаниеТаблиц.Приложение1Налогоплательщики.Количество() > 0 Тогда
			
			СоответствиеСтавок = Новый Соответствие;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка03] = 3;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка05] = 5;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка06] = 6;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка07] = 7;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка09] = 9;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка10] = 10;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка12] = 12;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка13] = 13;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка15] = 15;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка30] = 30;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка35] = 35;
			
			Если НомерКорректировки <> 99 Тогда
				Приложение1Итоги = ОписаниеТаблиц.Приложение1Итоги;
				Если Приложение1Итоги.Количество() > 100 Тогда
					Приложение1Итоги.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				Приложение1Доходы = ОписаниеТаблиц.Приложение1Доходы;
				Если Приложение1Доходы.Количество() > 100 Тогда
					Приложение1Доходы.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1Вычеты = ОписаниеТаблиц.Приложение1Вычеты;
				Если Приложение1Вычеты.Количество() > 100 Тогда
					Приложение1Вычеты.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1УведомленияОВычетах = ОписаниеТаблиц.Приложение1УведомленияОВычетах;
				Если Приложение1УведомленияОВычетах.Количество() > 100 Тогда
					Приложение1УведомленияОВычетах.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				ПоискПоФизлицу = Новый Структура("ФизическоеЛицо");
				ПоискПоФизлицуИСтавке = Новый Структура("ФизическоеЛицо,Ставка,КБК");
			КонецЕсли;
			
			НомерПервойСправки = 1;
			Если Не ОписаниеТаблиц.Свойство("Приложение1МаксимальныйНомерИзПереданныхСправок", НомерПервойСправки) Тогда
				НомерПервойСправки = 1;
			КонецЕсли;
			Для каждого СтрокаДанных Из ОписаниеТаблиц.Приложение1Налогоплательщики Цикл
				
				СтраницаПриложение1 = ДанныеПриложение1.Добавить();
				СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
				СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
				Если НомерКорректировки = 0 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
					НомерПервойСправки = НомерПервойСправки + 1;
					СтраницаПриложение1.Данные.П000П10000002 = "00";
				ИначеЕсли НомерКорректировки < 99 Тогда
					Если ЗначениеЗаполнено(СтрокаДанных.НомерСправки) Тогда
						СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
						СтраницаПриложение1.Данные.П000П10000002 = ?(СтрокаДанных.НомерКорректировки = 99, "99", Формат(СтрокаДанных.НомерКорректировки + 1, "ЧЦ=2; ЧДЦ=0; ЧВН="));
					Иначе
						СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
						НомерПервойСправки = НомерПервойСправки + 1;
						СтраницаПриложение1.Данные.П000П10000002 = "00";
					КонецЕсли;
				ИначеЕсли НомерКорректировки = 99 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
					СтраницаПриложение1.Данные.П000П10000002 = "99";
				КонецЕсли;
				СтраницаПриложение1.Данные.П000П10000003 = СтрокаДанных.ИНН;
				СтраницаПриложение1.Данные.П000П10000004 = СокрЛП(СтрокаДанных.Фамилия);
				СтраницаПриложение1.Данные.П000П10000005 = СокрЛП(СтрокаДанных.Имя);
				СтраницаПриложение1.Данные.П000П10000006 = СокрЛП(СтрокаДанных.Отчество);
				СтраницаПриложение1.Данные.П000П10000007 = СтрокаДанных.КодФНС;
				СтраницаПриложение1.Данные.П000П10000008 = СтрокаДанных.ДатаРождения;
				СтраницаПриложение1.Данные.П000П10000009 = СтрокаДанных.КодСтраныДляОтчетности;
				СтраницаПриложение1.Данные.П000П10000010 = СтрокаДанных.КодМВД;
				СтраницаПриложение1.Данные.П000П10000011 = СокрЛП(СтрокаДанных.СерияДокумента);
				СтраницаПриложение1.Данные.П000П10000012 = СокрЛП(СтрокаДанных.НомерДокумента);
				
				ВыводитьДоходы = СтраницаПриложение1.Данные.П000П10000002 <> "99";
				Если ВыводитьДоходы Тогда
					ПоискПоФизлицу.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					ПоискПоФизлицуИСтавке.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					СтрокиФизлица = Приложение1Итоги.НайтиСтроки(ПоискПоФизлицу);
					ВыводитьДоходы = СтрокиФизлица.Количество() > 0;
				КонецЕсли;
				Если ВыводитьДоходы Тогда
					Для каждого СтрокаИтоговПоСтавке Из СтрокиФизлица Цикл
						
						ПоискПоФизлицуИСтавке.Ставка = СтрокаИтоговПоСтавке.Ставка;
						ПоискПоФизлицуИСтавке.КБК = СтрокаИтоговПоСтавке.КБК;
						СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
						СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
						ЗаполнитьЗначенияСвойств(СтраницаПоСтавке.Данные, СтрокаИтоговПоСтавке);
						СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
						СтрокиДанных = Приложение1Вычеты.НайтиСтроки(ПоискПоФизлицуИСтавке);
						ВыводитьИмущественныйВычет = Ложь;
						ВыводитьСоциальныйВычет = Ложь;
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить();
								СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
								ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
								Если Не ВыводитьИмущественныйВычет Тогда
									ВыводитьИмущественныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
								КонецЕсли;
								Если Не ВыводитьСоциальныйВычет Тогда
									ВыводитьСоциальныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.СоциальныеПоУведомлениюНО
								КонецЕсли;
							КонецЦикла;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
						КонецЕсли;
						
						СтрокиДанных = Приложение1УведомленияОВычетах.НайтиСтроки(ПоискПоФизлицу);
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ВыводитьИмущественныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "1"
								КонецЕсли;
								Если ВыводитьСоциальныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "2"
								КонецЕсли;
								Если СтрокаИтоговПоСтавке.П000П1М100006 > 0 И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.ПустаяСсылка() Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "3"
								КонецЕсли;
							КонецЦикла;
							Если СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Количество() = 0 Тогда
								СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
							КонецЕсли;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
						КонецЕсли;
						
						СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
						СтрокиДанных = Приложение1Доходы.Скопировать(Приложение1Доходы.НайтиСтроки(ПоискПоФизлицуИСтавке));
						Если СтрокиДанных.Количество() > 0 Тогда
							СтрокиДанных.Сортировать("Период,П000П1М500002");
							ТекущийКод = Неопределено;
							ТекущийПериод = Неопределено;
							ПредыдущаяСтрока = Неопределено; 
							СуммаДохода = 0;
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ТекущийПериод <> СтрокаДанных.Период Или ТекущийКод <> СтрокаДанных.П000П1М500002 Тогда
									Если ПредыдущаяСтрока <> Неопределено Тогда
										ПредыдущаяСтрока.Данные.П000П1М500003 = СуммаДохода;
										Если ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
											СтрокаВычета = ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
											СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
											СтрокаВычета.Данные.П000П1М600004 = "";
										КонецЕсли;
									КонецЕсли;
									ТекущийКод = СтрокаДанных.П000П1М500002; 
									ТекущийПериод = СтрокаДанных.Период;
									СуммаДохода = 0;
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
									ПредыдущаяСтрока = СтрокаПоСтавке;  
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М500001 = Формат(СтрокаДанных.Период, "ДФ=MM");
									СтрокаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
								КонецЕсли;
								СуммаДохода = СуммаДохода + СтрокаДанных.П000П1М500003;
								Если ЗначениеЗаполнено(СтрокаДанных.П000П1М600004) Тогда
									СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
									СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
									ЗаполнитьЗначенияСвойств(СтрокаВычета.Данные, СтрокаДанных);
								КонецЕсли;
							КонецЦикла;
							СтрокаПоСтавке.Данные.П000П1М500003 = СуммаДохода;
							Если СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
								СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
								СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
								СтрокаВычета.Данные.П000П1М600004 = "";
							КонецЕсли;
						Иначе
							СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
							СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
							СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
							СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
						КонецЕсли;
						
					КонецЦикла; 
				Иначе
					СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
					СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
					СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
					СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
					СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
					СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
				КонецЕсли;
				
			КонецЦикла;
			
		Иначе 
			СтраницаПриложение1 = ДанныеПриложение1.Добавить();
			СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
			СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
			СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
			СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
			СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
			СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
			СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
			СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
		КонецЕсли;
	КонецЕсли;
		
КонецПроцедуры

Процедура РасчетПоказателей_6НДФЛ_2023Кв1(НачалоПериода, ОкончаниеПериода, ДатаПодписи, Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, ПодробныеДанные, НомерКорректировки) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	СтруктураКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("НачалоПредыдущегоГода", ДобавитьМесяц(НачалоПериода, -12));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("ДатаПодписи", КонецДня(ДатаПодписи));
	Запрос.УстановитьПараметр("ОсновнойКБК", СтруктураКБК.Основной);
	Запрос.УстановитьПараметр("КБКсПревышения", СтруктураКБК.СПревышения);
	Запрос.УстановитьПараметр("Дивиденды", СтруктураКБК.Дивиденды);
	Запрос.УстановитьПараметр("ДивидендыСПревышения", СтруктураКБК.ДивидендыСПревышения);
	Запрос.УстановитьПараметр("СоответствиеКатегорийКБК", УчетНДФЛ.КБККатегорийДохода(НачалоПериода));
	Запрос.УстановитьПараметр("АУСН", Перечисления.КатегорииДоходовНДФЛ.ДоходыАУСН());
	Запрос.УстановитьПараметр("НачалоОтчетногоКвартала", НачалоКвартала(ОкончаниеПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериодаОсмотраДоходовВычетов", ?(КонецГода(ОкончаниеПериода) = ОкончаниеПериода Или ЗначениеЗаполнено(НомерКорректировки), Макс(ДатаПодписи, ОкончаниеПериода), ОкончаниеПериода));
	Запрос.УстановитьПараметр("ВКС", Перечисления.ВидыЗастрахованныхЛицОбязательногоСтрахования.ВысококвалифицированныеСпециалисты());
	
	ДатаАктуальности = Макс(ОкончаниеПериода, ДатаПодписи);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
	|	СоответствиеКатегорийКБК.КБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|ИЗ
	|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК";
	Запрос.Выполнить();
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Или ОписаниеТаблиц.Свойство("Раздел1Возвраты") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения КАК ВидДвижения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаВозврата,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода КАК РасчетМежрасчетногоПериода,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	ВЫБОР
		|		КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА ВЫБОР
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА 0
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов > 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов < 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И НЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&АУСН)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Налоги") Тогда
		
		ДвадцатьВосьмоеЧислоПервогоМесяца = НачалоКвартала(ОкончаниеПериода) + 27 * 86400;
		Запрос.УстановитьПараметр("ПервыйСрокПеречисления", ДвадцатьВосьмоеЧислоПервогоМесяца);
		Запрос.УстановитьПараметр("ВторойСрокПеречисления", ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 1));
		Запрос.УстановитьПараметр("ТретийСрокПеречисления", ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 2));
		Запрос.УстановитьПараметр("ЧетвертыйСрокПеречисления", ?(Месяц(ОкончаниеПериода) = 12, ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 2), ОкончаниеПериода));
	
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТОтборНеотрицательныхУдержаний
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ КАК КБК,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТОтборНеотрицательныхУдержанийСПревышения
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|				ТОГДА НалогиПоДатам.Сумма
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000010002101,
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|				ТОГДА НалогиПоДатам.Сумма
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000010002201,
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|				ТОГДА НалогиПоДатам.Сумма
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000010002301,
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты > &ЧетвертыйСрокПеречисления
		|				ТОГДА НалогиПоДатам.Сумма
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000010002401
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборНеотрицательныхУдержаний КАК ОтборНеотрицательныхУдержаний
		|		ПО НалогиПоДатам.КБК = ОтборНеотрицательныхУдержаний.КБК
		|			И НалогиПоДатам.ФизическоеЛицо = ОтборНеотрицательныхУдержаний.ФизическоеЛицо
		|			И НалогиПоДатам.КрайнийСрокУплаты = ОтборНеотрицательныхУдержаний.КрайнийСрокУплаты
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|				ТОГДА НалогиПоДатам.СуммаСПревышения
		|			ИНАЧЕ 0
		|		КОНЕЦ),
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|				ТОГДА НалогиПоДатам.СуммаСПревышения
		|			ИНАЧЕ 0
		|		КОНЕЦ),
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|				ТОГДА НалогиПоДатам.СуммаСПревышения
		|			ИНАЧЕ 0
		|		КОНЕЦ),
		|	СУММА(ВЫБОР
		|			КОГДА НалогиПоДатам.КрайнийСрокУплаты > &ЧетвертыйСрокПеречисления
		|				ТОГДА НалогиПоДатам.СуммаСПревышения
		|			ИНАЧЕ 0
		|		КОНЕЦ)
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборНеотрицательныхУдержанийСПревышения КАК ОтборНеотрицательныхУдержаний
		|		ПО НалогиПоДатам.ФизическоеЛицо = ОтборНеотрицательныхУдержаний.ФизическоеЛицо
		|			И (ВЫБОР
		|				КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|					ТОГДА &ДивидендыСПревышения
		|				ИНАЧЕ &КБКсПревышения
		|			КОНЕЦ = ОтборНеотрицательныхУдержаний.КБК)
		|			И НалогиПоДатам.КрайнийСрокУплаты = ОтборНеотрицательныхУдержаний.КрайнийСрокУплаты
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо
		|
		|УПОРЯДОЧИТЬ ПО
		|	КБК";
			
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1Налоги = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1Возвраты") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата КАК ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата КАК П00001М203101,
		|	-СУММА(НалогиПоДатам.Сумма) КАК П00001М203201
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.ДатаВозврата МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата,
		|	-СУММА(НалогиПоДатам.СуммаСПревышения)
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.ДатаВозврата МЕЖДУ &НачалоОтчетногоКвартала И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.ДатаВозврата,
		|	НалогиПоДатам.ДатаВозврата
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) < 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ДатаВозврата";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1Возвраты = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТФизическиеЛицаОтчета
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (&АУСН)
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента
		|ПОМЕСТИТЬ ВТСтрокиДоходов
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (&АУСН)
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		Запрос.Выполнить();
		
		ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТСтрокиДоходов", "ФизическоеЛицо");
		ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
		ПараметрыПостроения.ВсеЗаписи = Истина;
	    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
			"СтатусыЗастрахованныхФизическихЛиц",
			Запрос.МенеджерВременныхТаблиц,
			Ложь,
			ОписаниеФильтра,
			ПараметрыПостроения);
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиДоходов", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
		
		Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", ?(НачалоПериода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.ДатаОбъединенияНалоговыхБаз, Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза(), Перечисления.КатегорииДоходовНДФЛ.ПоОсновнойСтавке()));
		Запрос.УстановитьПараметр("Предел", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел);
		Запрос.УстановитьПараметр("СтавкаСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Ставка);
		Запрос.УстановитьПараметр("СтавкаЧисломСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом * 100);
		Запрос.УстановитьПараметр("ГодПериода", Год(ОкончаниеПериода));
			
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист) КАК ЭтоВКС,
		|	ВЫБОР
		|		КОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КатегорияДохода
		|	КОНЕЦ КАК НалоговаяБаза,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ КАК КодВычета,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
		|ПОМЕСТИТЬ ВТДоходыПоСтавкам
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО СведенияОДоходахНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.ДатаПолученияДохода = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (&АУСН)
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|			ИЛИ СведенияОДоходахНДФЛ.СуммаВычета <> 0)
		|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|
		|СГРУППИРОВАТЬ ПО
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане),
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист)
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор КАК Регистратор,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма КАК Сумма,
		|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета
		|ПОМЕСТИТЬ ВТСтандартныеИмущественныеВычеты
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
		|ГДЕ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма <> 0
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ИмущественныеВычетыНДФЛ.Регистратор,
		|	ИмущественныеВычетыНДФЛ.ФизическоеЛицо,
		|	ИмущественныеВычетыНДФЛ.КодВычета,
		|	ИмущественныеВычетыНДФЛ.Сумма,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
		|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане)
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
		|ГДЕ
		|	ИмущественныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
		|	И ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычетыНДФЛ.Сумма <> 0
		|	И ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ИмущественныеВычетыНДФЛ.Год = &ГодПериода
		|	И ИмущественныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		УстановитьПривилегированныйРежим(Истина);
		Запрос.Выполнить();
		УстановитьПривилегированныйРежим(Ложь);
		
		Запрос.Текст =
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
		|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) КАК НалоговаяБаза,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК МесяцНалоговогоПериода
		|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	База.ФизическоеЛицо КАК ФизическоеЛицо,
		|	База.НалоговаяБаза КАК НалоговаяБаза
		|ПОМЕСТИТЬ ВТСотрудникиСПревышением
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
		|		ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
		|		ДоходыПоСтавкам.СуммаДохода - ДоходыПоСтавкам.СуммаВычета КАК ОблагаемаяБаза
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
		|	ГДЕ
		|		ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтандартныеИмущественныеВычеты.ФизическоеЛицо,
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		-СтандартныеИмущественныеВычеты.Сумма
		|	ИЗ
		|		ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты) КАК База
		|
		|СГРУППИРОВАТЬ ПО
		|	База.ФизическоеЛицо,
		|	База.НалоговаяБаза
		|
		|ИМЕЮЩИЕ
		|	СУММА(База.ОблагаемаяБаза) > &Предел";
		
		Если Запрос.Выполнить().Выгрузить()[0].Количество > 0 Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК НачалоМесяца,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза КАК НалоговаяБаза,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) КАК ОблагаемыйДоход,
			|	0 КАК ОблагаемыйДоходСНачалаГода,
			|	ЛОЖЬ КАК ЭтоДеньПревышенияПредела,
			|	ЛОЖЬ КАК ПределПревышен
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.НалоговаяБаза = СотрудникиСПревышением.НалоговаяБаза
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	Период";
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СУММА(СтандартныеИмущественныеВычеты.Сумма) КАК Сумма,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяца
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СтандартныеИмущественныеВычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) = СотрудникиСПревышением.НалоговаяБаза)
			|
			|СГРУППИРОВАТЬ ПО
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ)";
			ТаблицаВычетов = Запрос.Выполнить().Выгрузить();
			ИскатьВычеты = ТаблицаВычетов.Количество() > 0;
			Если ИскатьВычеты И ТаблицаВычетов.Количество() > 100 Тогда
				ТаблицаВычетов.Индексы.Добавить("ФизическоеЛицо,НачалоМесяца");
			КонецЕсли;
			ПоискВычетов = Новый Структура("ФизическоеЛицо,НачалоМесяца");
			
			// Расчет облагаемого дохода нарастающим итогом с учетом всех вычетов для каждой даты получения дохода.
			ОблагаемыйДоходСНачалаГода = 0;
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			ТекущееНачалоМесяца = Неопределено;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					ОблагаемыйДоходСНачалаГода = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
					ТекущееНачалоМесяца = Неопределено;
				КонецЕсли;
				// Стандартные, имущественные вычеты учтем один раз за каждый месяц - в первую дату получения дохода месяца.
				ПредоставленныеВычеты = 0;
				Если ИскатьВычеты И СтрокаТаблицы.НалоговаяБаза = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда И ТекущееНачалоМесяца <> СтрокаТаблицы.НачалоМесяца Тогда
					ЗаполнитьЗначенияСвойств(ПоискВычетов, СтрокаТаблицы);
					СтрокиВычетов = ТаблицаВычетов.НайтиСтроки(ПоискВычетов);
					Если СтрокиВычетов.Количество() > 0 Тогда
						ПредоставленныеВычеты = СтрокиВычетов[0].Сумма;
					КонецЕсли;
					ТекущееНачалоМесяца = СтрокаТаблицы.НачалоМесяца;
				КонецЕсли;
				СтрокаТаблицы.ЭтоДеньПревышенияПредела = ОблагаемыйДоходСНачалаГода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел И ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
				ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты;
				СтрокаТаблицы.ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода;
				СтрокаТаблицы.ПределПревышен = ОблагаемыйДоходСНачалаГода > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
			КонецЦикла;
			
			Запрос.УстановитьПараметр("РасчетНарастающимИтогом", ТаблицаРасчетаНарастающимИтогом); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РасчетНарастающимИтогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасчетНарастающимИтогом.Период КАК Период,
			|	РасчетНарастающимИтогом.НалоговаяБаза КАК НалоговаяБаза,
			|	РасчетНарастающимИтогом.ОблагаемыйДоход КАК ОблагаемыйДоход,
			|	РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела КАК ЭтоДеньПревышенияПредела,
			|	РасчетНарастающимИтогом.ПределПревышен КАК ПределПревышен
			|ПОМЕСТИТЬ ВТРасчетНарастающимИтогом
			|ИЗ
			|	&РасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыПоСтавкам.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыПоСтавкам.Ставка КАК Ставка,
			|	ДоходыПоСтавкам.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыПоСтавкам.Регистратор КАК Регистратор,
			|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыПоСтавкам.Начисление КАК Начисление,
			|	ДоходыПоСтавкам.Период КАК Период,
			|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыПоСтавкам.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыПоСтавкам.КБК КАК КБК,
			|	ДоходыПоСтавкам.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыПоСтавкам.КодДохода КАК КодДохода,
			|	ДоходыПоСтавкам.СуммаДохода КАК СуммаДохода,
			|	ДоходыПоСтавкам.КодВычета КАК КодВычета,
			|	ДоходыПоСтавкам.СуммаВычета КАК СуммаВычета,
			|	ДоходыПоСтавкам.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода, 0) КАК ОблагаемыйДоходСНачалаГода,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела, ЛОЖЬ) КАК ЭтоДеньПревышенияПредела,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ПределПревышен, ЛОЖЬ) КАК ПределПревышен,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоход, 0) КАК ОблагаемыйДоходЗаДень
			|ПОМЕСТИТЬ ВТРасширенныеДанныеОДоходах
			|ИЗ
			|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|		ПО ДоходыПоСтавкам.ФизическоеЛицо = РасчетНарастающимИтогом.ФизическоеЛицо
			|			И ДоходыПоСтавкам.Период = РасчетНарастающимИтогом.Период
			|			И ДоходыПоСтавкам.НалоговаяБаза = РасчетНарастающимИтогом.НалоговаяБаза
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.СтавкаНалога КАК СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	РасширенныеДанныеОДоходах.КБК КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода) КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаВычета) КАК СуммаВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода - РасширенныеДанныеОДоходах.СуммаВычета) КАК ОблагаемаяСумма,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень КАК ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление,
			|	РасширенныеДанныеОДоходах.Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода,
			|	РасширенныеДанныеОДоходах.КБК,
			|	РасширенныеДанныеОДоходах.КодДохода,
			|	РасширенныеДанныеОДоходах.КодВычета,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2,
			|	РасширенныеДанныеОДоходах.ЭтоВКС
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	КодДохода";
			
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			ДоходыСУточненнымиСтавками = ТаблицаРасчетаНарастающимИтогом.СкопироватьКолонки();
			
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			СтрокиРаспределения = Новый Массив;
			ОблагаемыйДоходДоПредела = 0;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					Если ОблагаемыйДоходДоПредела <> 0 Тогда
						ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
					КонецЕсли;
					СтрокиРаспределения = Новый Массив;
					ОблагаемыйДоходДоПредела = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
				КонецЕсли;
				Если ОблагаемыйДоходДоПредела = 0 Тогда
					ОблагаемыйДоходДоПредела = СтрокаТаблицы.ОблагаемыйДоходЗаДень - СтрокаТаблицы.ОблагаемыйДоходСНачалаГода + ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел
				КонецЕсли;
				СтрокиРаспределения.Добавить(СтрокаТаблицы);
			КонецЦикла;
			Если ОблагаемыйДоходДоПредела <> 0 Тогда
				ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
			КонецЕсли;
			
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРасчетаНарастающимИтогом, ДоходыСУточненнымиСтавками); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			
			Запрос.УстановитьПараметр("ДоходыСУточненнымиСтавками", ДоходыСУточненнымиСтавками); ДоходыСУточненнымиСтавками = Неопределено;
			Запрос.Текст =
			"УНИЧТОЖИТЬ ВТДоходыПоСтавкам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка КАК Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор КАК Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление КАК Начисление,
			|	ДоходыСУточненнымиСтавками.Период КАК Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|			ТОГДА ВЫБОР
			|					КОГДА ДоходыСУточненнымиСтавками.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|						ТОГДА &ДивидендыСПревышения
			|					ИНАЧЕ &КБКсПревышения
			|				КОНЕЦ
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.КБК
			|	КОНЕЦ КАК КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода КАК КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода КАК СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета КАК КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыСУточненнымиСтавками
			|ИЗ
			|	&ДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаЧисломСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.СтавкаНалога
			|	КОНЕЦ КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.Ставка
			|	КОНЕЦ КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА ВЫБОР
			|					КОГДА РасширенныеДанныеОДоходах.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|						ТОГДА &ДивидендыСПревышения
			|					ИНАЧЕ &КБКсПревышения
			|				КОНЕЦ
			|		ИНАЧЕ РасширенныеДанныеОДоходах.КБК
			|	КОНЕЦ КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	РасширенныеДанныеОДоходах.СуммаДохода КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	РасширенныеДанныеОДоходах.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыПоСтавкам
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	НЕ РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление,
			|	ДоходыСУточненнымиСтавками.Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2,
			|	ДоходыСУточненнымиСтавками.КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета
			|ИЗ
			|	ВТДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками";
			Запрос.Выполнить();
			
			Если ИскатьВычеты Тогда
				Запрос.Текст =
				"УНИЧТОЖИТЬ ВТМесяцыПослеПревышения
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыУникальныхКБК
				|ИЗ
				|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|ГДЕ
				|	ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
				|	И ДоходыПоСтавкам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
				|
				|СГРУППИРОВАТЬ ПО
				|	ДоходыПоСтавкам.НалоговаяБаза,
				|	ДоходыПоСтавкам.ФизическоеЛицо,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ)
				|
				|ИМЕЮЩИЕ
				|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДоходыПоСтавкам.КБК) = 1
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	МесяцыУникальныхКБК.ФизическоеЛицо КАК ФизическоеЛицо,
				|	МесяцыУникальныхКБК.НалоговаяБаза КАК НалоговаяБаза,
				|	МесяцыУникальныхКБК.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
				|ИЗ
				|	ВТМесяцыУникальныхКБК КАК МесяцыУникальныхКБК
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|		ПО МесяцыУникальныхКБК.ФизическоеЛицо = ДоходыПоСтавкам.ФизическоеЛицо
				|			И МесяцыУникальныхКБК.НалоговаяБаза = ДоходыПоСтавкам.НалоговаяБаза
				|			И (МесяцыУникальныхКБК.МесяцНалоговогоПериода = НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ))
				|ГДЕ
				|	ДоходыПоСтавкам.КБК = &КБКсПревышения";
				Запрос.Выполнить();
			КонецЕсли;
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.УстановитьПараметр("СтрокиРаздела2ПоКодамДохода", УчетНДФЛПовтИсп.СтрокиРаздела2Расчета6НДФЛПоКодамДохода());
			
			ПоДатамТрудовыхДоговоров = Новый Массив;
			ПоДатамТрудовыхДоговоров.Добавить(УчетНДФЛПовтИсп.Доход2710());
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2720);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2760);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код4800);
			Запрос.УстановитьПараметр("ПоДатамДоговоров", ПоДатамТрудовыхДоговоров);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтрокиРаздела2ПоКодамДохода.КодДохода КАК КодДохода,
			|	СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТСтрокиРаздела2ПоКодамДохода
			|ИЗ
			|	&СтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.ЭтоВКС КАК ЭтоВКС,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
			|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 <> ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ПустаяСсылка)
			|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
			|		ИНАЧЕ СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2
			|	КОНЕЦ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|		ПО СведенияОДоходахНДФЛ.КодДохода = СтрокиРаздела2ПоКодамДохода.КодДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	&НачалоПериода КАК НачалоПериода,
			|	&ОкончаниеПериода КАК ОкончаниеПериода,
			|	&ГоловнаяОрганизация КАК ГоловнаяОрганизация
			|ИЗ
			|	ВТДоходыСоСтрокамиРаздела2 КАК ФизЛица
			|ГДЕ
			|	ФизЛица.СтрокаРаздела2 ЕСТЬ NULL";
			Результат = Запрос.Выполнить();
			Если Не Результат.Пустой() Тогда
				
				ФизЛицаОрганизаций = Результат.Выгрузить();
				Запрос.УстановитьПараметр("ТаблицаДоговоров", КадровыйУчет.ДоговорыФизическихЛиц(ФизЛицаОрганизаций)); ФизЛицаОрганизаций = Неопределено; 
				
				Запрос.Текст =
				"ВЫБРАТЬ
				|	ТаблицаДоговоров.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ТаблицаДоговоров.ВидДоговора КАК ВидДоговора,
				|	ТаблицаДоговоров.Окончание КАК Окончание,
				|	ТаблицаДоговоров.Начало КАК Начало
				|ПОМЕСТИТЬ ВТДоговоры
				|ИЗ
				|	&ТаблицаДоговоров КАК ТаблицаДоговоров
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период КАК Период,
				|	НЕ МИНИМУМ(ФизЛица.ВидДоговора) КАК ЕстьТрудовойДоговор
				|ПОМЕСТИТЬ ВТДниДоговоров
				|ИЗ
				|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоговоры КАК ФизЛица
				|		ПО (ФизЛица.Начало <= СведенияОДоходахНДФЛ.Период)
				|			И (ФизЛица.Окончание = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
				|				ИЛИ ФизЛица.Окончание >= СведенияОДоходахНДФЛ.Период)
				|			И СведенияОДоходахНДФЛ.ФизическоеЛицо = ФизЛица.ФизическоеЛицо
				|ГДЕ
				|	ФизЛица.ФизическоеЛицо ЕСТЬ НЕ NULL 
				|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
				|
				|СГРУППИРОВАТЬ ПО
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.Период КАК Период,
				|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
				|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
				|	СведенияОДоходахНДФЛ.ЭтоВКС КАК ЭтоВКС,
				|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
				|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
				|	СведенияОДоходахНДФЛ.КБК КАК КБК,
				|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
				|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
				|	ВЫБОР
				|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 ЕСТЬ НЕ NULL 
				|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
				|		КОГДА СведенияОДоходахНДФЛ.КодДохода В (&ПоДатамДоговоров)
				|			ТОГДА ВЫБОР
				|					КОГДА ЕСТЬNULL(ДниДоговоров.ЕстьТрудовойДоговор, ЛОЖЬ)
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
				|					КОГДА НЕ ДниДоговоров.ЕстьТрудовойДоговор
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
				|					ИНАЧЕ НЕОПРЕДЕЛЕНО
				|				КОНЕЦ
				|		ИНАЧЕ НЕОПРЕДЕЛЕНО
				|	КОНЕЦ КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТПодробныеДоходы
				|ИЗ
				|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДниДоговоров КАК ДниДоговоров
				|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДниДоговоров.ФизическоеЛицо
				|			И СведенияОДоходахНДФЛ.Период = ДниДоговоров.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|УНИЧТОЖИТЬ ВТДоходыСоСтрокамиРаздела2
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ПодробныеДоходы.Период КАК Период,
				|	ПодробныеДоходы.СтавкаНалога КАК СтавкаНалога,
				|	ПодробныеДоходы.Ставка КАК Ставка,
				|	ПодробныеДоходы.ЭтоВКС КАК ЭтоВКС,
				|	ПодробныеДоходы.Регистратор КАК Регистратор,
				|	ПодробныеДоходы.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ПодробныеДоходы.Начисление КАК Начисление,
				|	ПодробныеДоходы.КатегорияДохода КАК КатегорияДохода,
				|	ПодробныеДоходы.КБК КАК КБК,
				|	ПодробныеДоходы.КодДохода КАК КодДохода,
				|	ПодробныеДоходы.СуммаДохода КАК СуммаДохода,
				|	ПодробныеДоходы.СтрокаРаздела2 КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
				|ИЗ
				|	ВТПодробныеДоходы КАК ПодробныеДоходы";
				Запрос.Выполнить();
				
			КонецЕсли;
		КонецЕсли;
			
		Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТВычетыПоСтавкам
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаВычета <> 0
			|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА &ОсновнойКБК
			|		ИНАЧЕ &КБКсПревышения
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА 13
			|		ИНАЧЕ 15
			|	КОНЕЦ,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
			|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМесяцыПослеПревышения КАК СотрудникиСПревышением
			|		ПО ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода = СотрудникиСПревышением.МесяцНалоговогоПериода
			|			И (СотрудникиСПревышением.НалоговаяБаза = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда))
			|ГДЕ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ДанныеДляОтчета";
			Запрос.Выполнить();
		КонецЕсли;
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодДохода КАК КодДохода,
		|	СведенияОДоходах.Начисление КАК Начисление,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000020011003,
		|	СУММА(ВЫБОР
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.Дивиденды)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011103,
		|	СУММА(ВЫБОР
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011203,
		|	СУММА(ВЫБОР
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011303,
		|	СУММА(ВЫБОР
		|			КОГДА НЕ СведенияОДоходах.ЭтоВКС
		|				ТОГДА 0
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020011503
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.КодДохода,
		|	СведенияОДоходах.Начисление,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодДохода");
			МассивПолей.Добавить("Начисление");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Доходы = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СУММА(ДанныеОКоличествах.ВсегоПолучателей) КАК П000020012003,
		|	СУММА(ДанныеОКоличествах.ВсегоВКС) КАК П000020012103,
		|	ДанныеОКоличествах.Ставка КАК Ставка,
		|	ДанныеОКоличествах.КБК КАК КБК
		|ИЗ
		|	(ВЫБРАТЬ
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0) КАК ВсегоПолучателей,
		|		0 КАК ВсегоВКС,
		|		СведенияОДоходахНДФЛ.Ставка КАК Ставка,
		|		СведенияОДоходахНДФЛ.КБК КАК КБК
		|	ИЗ
		|		ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		0,
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0),
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	ИЗ
		|		ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|		И СведенияОДоходахНДФЛ.ЭтоВКС
		|		И (СведенияОДоходахНДФЛ.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ИЛИ СведенияОДоходахНДФЛ.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор))
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК) КАК ДанныеОКоличествах
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеОКоличествах.Ставка,
		|	ДанныеОКоличествах.КБК";
		
		ОписаниеТаблиц.КоличествоПолучателейДохода = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета КАК КодВычета,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000020013003
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодВычета");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Вычеты = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТНалоги", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода, "ВТСтавкаНДФЛПоНалогам");
		
		Если Не ЗарплатаКадры.ВТСуществует(Запрос.МенеджерВременныхТаблиц, "ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних") Тогда
			ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТНалоги", "ФизическоеЛицо");
			ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
			ПараметрыПостроения.ВсеЗаписи = Истина;
		    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
			ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
				"СтатусыЗастрахованныхФизическихЛиц",
				Запрос.МенеджерВременныхТаблиц,
				Ложь,
				ОписаниеФильтра,
				ПараметрыПостроения);
		КонецЕсли;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходах.Период КАК Период,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА НЕ СведенияОДоходах.ЭтоВКС
		|				ТОГДА ЛОЖЬ
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА ИСТИНА
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		КОНЕЦ) КАК ЭтоВКС
		|ПОМЕСТИТЬ ВТСведенияВКС
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода,
		|	СведенияОДоходах.Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛ.КБК КАК КБК,
		|	НДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Начислено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НачисленоПоДивидендам,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ЗачтеноАвансов,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Удержано,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК УдержаноЗаНалоговыйПериод,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.Сумма
		|					КОГДА ВЫБОР
		|							КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|								ТОГДА ВЫБОР
		|										КОГДА НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|											ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|										ИНАЧЕ 0
		|									КОНЕЦ
		|							ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|						КОНЕЦ * НДФЛ.Сумма > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.Сумма > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.Сумма - ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА ВЫБОР
		|																			КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																				ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																			ИНАЧЕ 0
		|																		КОНЕЦ
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|												КОНЕЦ > 0
		|												ТОГДА НДФЛ.Сумма - ВЫБОР
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА ВЫБОР
		|																				КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																					ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																				ИНАЧЕ 0
		|																			КОНЕЦ
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|													КОНЕЦ
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.Сумма - ВЫБОР
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|									КОНЕЦ < 0
		|									ТОГДА НДФЛ.Сумма - ВЫБОР
		|											КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|												ТОГДА ВЫБОР
		|														КОГДА НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|															ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|														ИНАЧЕ 0
		|													КОНЕЦ
		|											ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|										КОНЕЦ
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.Сумма
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Сальдо,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Возвращено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.Сумма > 0
		|			ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|									ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ НДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов,
		|	НДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода
		|ПОМЕСТИТЬ ВТНалогиПоСтавкам
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.Сумма <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НДФЛ.ФизическоеЛицо,
		|	15,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15),
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.СуммаСПревышения
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.СуммаСПревышения > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов > 0
		|												ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов < 0
		|									ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|						ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	НДФЛ.КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.СуммаСПревышения <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Сальдо) КАК НеУдержано,
		|	Налоги.КБК КАК КБК
		|ПОМЕСТИТЬ ВТНеУдержано
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.КБК КАК КБК,
		|	-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|ПОМЕСТИТЬ ВТИзлишнеУдержаноПоКБК
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Начислено) КАК Начислено,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК НачисленоПоДивидендам,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК НалогНаПрибыльДляДивидендов,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК ЗачтеноАвансов,
		|	СУММА(Налоги.Удержано) КАК Удержано,
		|	СУММА(Налоги.УдержаноЗаНалоговыйПериод) КАК УдержаноЗаНалоговыйПериод,
		|	СУММА(Налоги.Возвращено) КАК Возвращено,
		|	ЕСТЬNULL(МАКСИМУМ(ПоФизлицам.НеУдержано), 0) КАК НеУдержано,
		|	ЕСТЬNULL(МАКСИМУМ(ИзлишнеУдержаноПоКБК.ИзлишнеУдержано), 0) КАК ИзлишнеУдержано,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ) КАК ЭтоВКС
		|ПОМЕСТИТЬ ВТДанныеПоФизлицам
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияВКС КАК СведенияВКС
		|		ПО Налоги.ФизическоеЛицо = СведенияВКС.ФизическоеЛицо
		|			И Налоги.КатегорияДохода = СведенияВКС.КатегорияДохода
		|			И Налоги.ДатаПолученияДохода = СведенияВКС.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНеУдержано КАК ПоФизлицам
		|		ПО Налоги.ФизическоеЛицо = ПоФизлицам.ФизическоеЛицо
		|			И Налоги.СтавкаНалога = ПоФизлицам.СтавкаНалога
		|			И Налоги.КБК = ПоФизлицам.КБК
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИзлишнеУдержаноПоКБК КАК ИзлишнеУдержаноПоКБК
		|		ПО Налоги.ФизическоеЛицо = ИзлишнеУдержаноПоКБК.ФизическоеЛицо
		|			И Налоги.КБК = ИзлишнеУдержаноПоКБК.КБК
		|			И Налоги.СтавкаНалога = ИзлишнеУдержаноПоКБК.СтавкаНалога
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0
		|			ИЛИ Налоги.Возвращено <> 0
		|			ИЛИ ИзлишнеУдержаноПоКБК.ИзлишнеУдержано <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(Налоги.Начислено) КАК П000020014003,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК П000020014103,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ЭтоВКС
		|				ТОГДА Налоги.Начислено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020014203,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК П000020015003,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК П000020015503,
		|	СУММА(Налоги.Удержано) КАК П000020016003,
		|	СУММА(Налоги.НеУдержано) КАК П000020017003,
		|	СУММА(Налоги.Возвращено) КАК П000020019003,
		|	СУММА(Налоги.ИзлишнеУдержано) КАК П000020018003,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.Возвращено <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	Налоги.ФизическоеЛицо";
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "Налоги");
		ОписаниеТаблиц.Раздел2Налоги = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		НеобходимыеКадровыеДанные = Новый Массив();
		НеобходимыеКадровыеДанные.Добавить("ФизическоеЛицо");
		НеобходимыеКадровыеДанные.Добавить("ИНН");
		НеобходимыеКадровыеДанные.Добавить("Наименование");
		НеобходимыеКадровыеДанные.Добавить("Фамилия");
		НеобходимыеКадровыеДанные.Добавить("Имя");
		НеобходимыеКадровыеДанные.Добавить("Отчество");
		НеобходимыеКадровыеДанные.Добавить("СтатусНалогоплательщика");
		НеобходимыеКадровыеДанные.Добавить("ВидЗастрахованногоЛица");
		НеобходимыеКадровыеДанные.Добавить("ДатаРождения");	
		НеобходимыеКадровыеДанные.Добавить("ДокументВид");
		НеобходимыеКадровыеДанные.Добавить("ДокументСерия");
		НеобходимыеКадровыеДанные.Добавить("ДокументНомер");
		НеобходимыеКадровыеДанные.Добавить("ДокументСтранаВыдачи");
		НеобходимыеКадровыеДанные.Добавить("Страна");
		
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах";
		ЗарплатаКадры.УничтожитьВТ(Запрос.МенеджерВременныхТаблиц,"ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних", Истина);
		КадровыйУчет.СоздатьНаДатуВТКадровыеДанныеФизическихЛиц(Запрос.МенеджерВременныхТаблиц, Истина, Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НеобходимыеКадровыеДанные, ДатаАктуальности);
		
		// Для корректирующей и отменяющей формы прочитаем переданные в предыдущих отчетах данные.
		Если НомерКорректировки > 0 Тогда
			ФормироватьПустыеДанные = ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив") И РегистрацияВНалоговомОргане.Количество() = 0;
			Если ФормироватьПустыеДанные Тогда
				СоздатьПустыеВТПереданныхДанныхОтчета2023(Запрос.МенеджерВременныхТаблиц)
			Иначе 
				РеквизитыРегистрации = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(?(ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив"), РегистрацияВНалоговомОргане[0], РегистрацияВНалоговомОргане), "КодПоОКТМО,КПП");
				ПолучитьПереданныеДанныеОтчета2023(Организация, СокрЛП(РеквизитыРегистрации.КодПоОКТМО), СокрЛП(РеквизитыРегистрации.КПП), ОкончаниеПериода, Запрос.МенеджерВременныхТаблиц, НомерКорректировки, "ФормаОтчета2023Кв1");
			КонецЕсли;
		КонецЕсли;
		
		// Для отменяющей формы нужен только перечень переданных справок.
		Если НомерКорректировки = 99 Тогда
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.НомерСправки КАК НомерСправки,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Фамилия + "" "" + КадровыеДанныеФизЛиц.Имя + "" "" + КадровыеДанныеФизЛиц.Отчество КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			Возврат
		КонецЕсли;
		
		// Для исходной и корректирующей форм соберем текущие данные.
		УчетНДФЛ.СоздатьВТСтавкиНалогаЧислом(Запрос.МенеджерВременныхТаблиц);
		Запрос.Текст =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТУплатившиеАвансыПоНалогу
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.ЗачтеноАвансов) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
		|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
		|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
		|	КадровыеДанныеФизЛиц.Имя КАК Имя,
		|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
		|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """") КАК СерияДокумента,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """") КАК НомерДокумента,
		|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|			ТОГДА ВЫБОР
		|					КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|						ТОГДА ""643""
		|					ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
		|				КОНЕЦ
		|		ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
		|	КОНЕЦ КАК КодСтраныДляОтчетности,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.ВидЗастрахованногоЛица В (&ВКС)
		|				И КадровыеДанныеФизЛиц.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ТОГДА ""7""
		|		КОГДА УплатившиеАвансыПоНалогу.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И КадровыеДанныеФизЛиц.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ТОГДА ""6""
		|		ИНАЧЕ ЕСТЬNULL(СтатусыНалогоплательщиковПоНДФЛ.КодФНС_2015, """")
		|	КОНЕЦ КАК КодФНС,
		|	ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """") КАК КодМВД
		|ПОМЕСТИТЬ ВТФизлицаПоТекущимДанным
		|ИЗ
		|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
		|		ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтатусыНалогоплательщиковПоНДФЛ КАК СтатусыНалогоплательщиковПоНДФЛ
		|		ПО КадровыеДанныеФизЛиц.СтатусНалогоплательщика = СтатусыНалогоплательщиковПоНДФЛ.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУплатившиеАвансыПоНалогу КАК УплатившиеАвансыПоНалогу
		|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = УплатившиеАвансыПоНалогу.ФизическоеЛицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ДанныеИтогов.Ставка КАК Ставка,
		|	ДанныеИтогов.КБК КАК КБК,
		|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
		|	СУММА(ДанныеИтогов.П000П1М100002) КАК П000П1М100002,
		|	СУММА(ДанныеИтогов.П000П1М100003) КАК П000П1М100003,
		|	СУММА(ДанныеИтогов.П000П1М100004) КАК П000П1М100004,
		|	СУММА(ДанныеИтогов.П000П1М100005) КАК П000П1М100005,
		|	СУММА(ДанныеИтогов.П000П1М100006) КАК П000П1М100006,
		|	СУММА(ДанныеИтогов.П000П1М100007) КАК П000П1М100007,
		|	СУММА(ДанныеИтогов.П000П1М100008) КАК П000П1М100008,
		|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
		|	СУММА(ДанныеИтогов.П000П1М100010) КАК П000П1М100010
		|ПОМЕСТИТЬ ВТДанныеИтоговПоТекущимДанным
		|ИЗ
		|	(ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|		Налоги.СтавкаНалога КАК Ставка,
		|		Налоги.КБК КАК КБК,
		|		Налоги.СтавкаНалога КАК П000П1М100001,
		|		Налоги.КБК КАК П000П1М100009,
		|		0 КАК П000П1М100002,
		|		0 КАК П000П1М100003,
		|		Налоги.Начислено КАК П000П1М100004,
		|		Налоги.УдержаноЗаНалоговыйПериод КАК П000П1М100005,
		|		Налоги.ЗачтеноАвансов КАК П000П1М100006,
		|		0 КАК П000П1М100007,
		|		0 КАК П000П1М100008,
		|		Налоги.НалогНаПрибыльДляДивидендов КАК П000П1М100010
		|	ИЗ
		|		ВТДанныеПоФизлицам КАК Налоги
		|	ГДЕ
		|		(Налоги.Начислено <> 0
		|				ИЛИ Налоги.ЗачтеноАвансов <> 0
		|				ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СуммаДохода,
		|		СведенияОДоходах.СуммаДохода,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК СведенияОДоходах
		|	ГДЕ
		|		СведенияОДоходах.ДанныеДляОтчета
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		0,
		|		-СведенияОДоходах.СуммаВычета,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТВычетыПоСтавкам КАК СведенияОДоходах
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		Налоги.ИзлишнеУдержано,
		|		0
		|	ИЗ
		|		(ВЫБРАТЬ
		|			Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|			Налоги.СтавкаНалога КАК СтавкаНалога,
		|			Налоги.КБК КАК КБК,
		|			-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|		ИЗ
		|			ВТНалогиПоСтавкам КАК Налоги
		|		
		|		СГРУППИРОВАТЬ ПО
		|			Налоги.ФизическоеЛицо,
		|			Налоги.КБК,
		|			Налоги.СтавкаНалога
		|		
		|		ИМЕЮЩИЕ
		|			СУММА(Налоги.Сальдо) < 0) КАК Налоги) КАК ДанныеИтогов
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеИтогов.Ставка,
		|	ДанныеИтогов.КБК,
		|	ДанныеИтогов.ФизическоеЛицо,
		|	ДанныеИтогов.П000П1М100001,
		|	ДанныеИтогов.П000П1М100009
		|
		|ИМЕЮЩИЕ
		|	СУММА(ДанныеИтогов.П000П1М100002) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ) КАК Период,
		|	СведенияОДоходах.СтавкаНалога КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """") КАК П000П1М500002,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000П1М500003,
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года, """") КАК П000П1М600004,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000П1М600005
		|ПОМЕСТИТЬ ВТДоходыПоТекущимДанным
		|ИЗ
		|	ВТДоходыПоСтавкам КАК СведенияОДоходах
		|ГДЕ
		|	СведенияОДоходах.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """"),
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года, """"),
		|	СведенияОДоходах.СтавкаНалога,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходах.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходах.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОВычетах.СтавкаНалога КАК Ставка,
		|	СведенияОВычетах.КБК КАК КБК,
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета КАК ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года КАК П000П1М200001,
		|	СУММА(СведенияОВычетах.СуммаВычета) КАК П000П1М200002
		|ПОМЕСТИТЬ ВТВычетыПоТекущимДанным
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.КодВычета.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОВычетах.СтавкаНалога,
		|	СведенияОВычетах.КБК,
		|	СведенияОВычетах.ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(СведенияОВычетах.СуммаВычета) <> 0";
		Запрос.Выполнить();
		
		НалоговыйПериод = Год(ОкончаниеПериода);
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)";
		ДанныеУведомлений = УчетНДФЛ.ДанныеУведомленийНаВычеты(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеУведомлений.Колонки.Сотрудник.Имя = "ФизическоеЛицо";
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	Налоги.ЗачтеноАвансов <> 0";
		ДанныеЗачетаАвансовыхПлатежей = УчетНДФЛ.ДанныеУведомленийНаЗачетАвансовыхПлатежей(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеЗачетаАвансовыхПлатежей.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ДанныеЗачетаАвансовыхПлатежей, ДанныеУведомлений);
		
		Если НомерКорректировки = 0 Тогда
			
			// Для исходной формы дополнительных действий не требуется, возвращаем полученные данные.
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100007 КАК П000П1М100007,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	П000П1М200001";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			ДанныеУведомлений.Колонки.НомерУведомления.Имя = "П000П1М300002";
			ДанныеУведомлений.Колонки.ДатаУведомления.Имя = "П000П1М300003";
			ДанныеУведомлений.Колонки.КодНалоговогоОрганаУведомления.Имя = "П000П1М300004";
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = ДанныеУведомлений;
			
		Иначе
			
			// Для корректирующей формы определим перечень сотрудников, чьи данные отличаются от переданных ранее, и вернем данные учета только для них.
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(Запрос.МенеджерВременныхТаблиц, ДанныеУведомлений, "ВТУведомленияОВычетахПоТекущимДанным");
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СУММА(СведенияОДоходах.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТТолькоДоходыПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СУММА(СведенияОДоходах.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002,
			|	СведенияОДоходах.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(СведенияОДоходах.П000П1М600005) <> 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаВОтчет
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО ФизлицаПоТекущимДанным.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|			И ФизлицаПоТекущимДанным.ИНН = ФизлицаПереданные.ИНН
			|			И ФизлицаПоТекущимДанным.Фамилия = ФизлицаПереданные.Фамилия
			|			И ФизлицаПоТекущимДанным.Имя = ФизлицаПереданные.Имя
			|			И ФизлицаПоТекущимДанным.Отчество = ФизлицаПереданные.Отчество
			|			И ФизлицаПоТекущимДанным.ДатаРождения = ФизлицаПереданные.ДатаРождения
			|			И ФизлицаПоТекущимДанным.КодСтраныДляОтчетности = ФизлицаПереданные.КодСтраныДляОтчетности
			|			И ФизлицаПоТекущимДанным.СерияДокумента = ФизлицаПереданные.СерияДокумента
			|			И ФизлицаПоТекущимДанным.НомерДокумента = ФизлицаПереданные.НомерДокумента
			|			И ФизлицаПоТекущимДанным.КодФНС = ФизлицаПереданные.КодФНС
			|			И ФизлицаПоТекущимДанным.КодМВД = ФизлицаПереданные.КодМВД
			|ГДЕ
			|	ФизлицаПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДанныеИтогов.ФизическоеЛицо
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиПереданные КАК ИтогиПереданные
			|		ПО ДанныеИтогов.ФизическоеЛицо = ИтогиПереданные.ФизическоеЛицо
			|			И ДанныеИтогов.П000П1М100001 = ИтогиПереданные.П000П1М100001
			|			И ДанныеИтогов.П000П1М100002 = ИтогиПереданные.П000П1М100002
			|			И ДанныеИтогов.П000П1М100003 = ИтогиПереданные.П000П1М100003
			|			И ДанныеИтогов.П000П1М100004 = ИтогиПереданные.П000П1М100004
			|			И ДанныеИтогов.П000П1М100005 = ИтогиПереданные.П000П1М100005
			|			И ДанныеИтогов.П000П1М100006 = ИтогиПереданные.П000П1М100006
			|			И ДанныеИтогов.П000П1М100007 = ИтогиПереданные.П000П1М100007
			|			И ДанныеИтогов.П000П1М100008 = ИтогиПереданные.П000П1М100008
			|			И ДанныеИтогов.П000П1М100009 = ИтогиПереданные.П000П1М100009
			|			И ДанныеИтогов.П000П1М100010 = ИтогиПереданные.П000П1М100010
			|ГДЕ
			|	ИтогиПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ИтогиПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТИтогиПереданные КАК ИтогиПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ПО ИтогиПереданные.ФизическоеЛицо = ДанныеИтогов.ФизическоеЛицо
			|			И ИтогиПереданные.П000П1М100001 = ДанныеИтогов.П000П1М100001
			|			И ИтогиПереданные.П000П1М100002 = ДанныеИтогов.П000П1М100002
			|			И ИтогиПереданные.П000П1М100003 = ДанныеИтогов.П000П1М100003
			|			И ИтогиПереданные.П000П1М100004 = ДанныеИтогов.П000П1М100004
			|			И ИтогиПереданные.П000П1М100005 = ДанныеИтогов.П000П1М100005
			|			И ИтогиПереданные.П000П1М100006 = ДанныеИтогов.П000П1М100006
			|			И ИтогиПереданные.П000П1М100007 = ДанныеИтогов.П000П1М100007
			|			И ИтогиПереданные.П000П1М100008 = ДанныеИтогов.П000П1М100008
			|			И ИтогиПереданные.П000П1М100009 = ДанныеИтогов.П000П1М100009
			|			И ИтогиПереданные.П000П1М100010 = ДанныеИтогов.П000П1М100010
			|ГДЕ
			|	ДанныеИтогов.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходах.ФизическоеЛицо
			|ИЗ
			|	ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПереданные КАК ДоходыПереданные
			|		ПО СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо
			|			И СведенияОДоходах.Ставка = ДоходыПереданные.Ставка
			|			И СведенияОДоходах.КБК = ДоходыПереданные.КБК
			|			И СведенияОДоходах.Период = ДоходыПереданные.Период
			|			И СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002
			|			И СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003
			|ГДЕ
			|	ДоходыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДоходыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТДоходыПереданные КАК ДоходыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ПО (СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо)
			|			И (СведенияОДоходах.Ставка = ДоходыПереданные.Ставка)
			|			И (СведенияОДоходах.КБК = ДоходыПереданные.КБК)
			|			И (СведенияОДоходах.Период = ДоходыПереданные.Период)
			|			И (СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002)
			|			И (СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003)
			|ГДЕ
			|	СведенияОДоходах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.Ставка = ВычетыПереданные.Ставка
			|			И СведенияОВычетах.КБК = ВычетыПереданные.КБК
			|			И СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001
			|			И СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.Ставка = ВычетыПереданные.Ставка)
			|			И (СведенияОВычетах.КБК = ВычетыПереданные.КБК)
			|			И (СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001)
			|			И (СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета
			|			И СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002
			|			И СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003
			|			И СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета)
			|			И (СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002)
			|			И (СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003)
			|			И (СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(ФизлицаПереданные.НомерСправки, 0) КАК НомерСправки,
			|	ЕСТЬNULL(ФизлицаПереданные.НомерКорректировки, 0) КАК НомерКорректировки,
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеНалогоплательщиков
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПереданные.НомерСправки,
			|	99,
			|	ФизлицаПереданные.ФизическоеЛицо,
			|	ФизлицаПереданные.ИНН,
			|	ФизлицаПереданные.Фамилия,
			|	ФизлицаПереданные.Имя,
			|	ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.ДатаРождения,
			|	ФизлицаПереданные.СерияДокумента,
			|	ФизлицаПереданные.НомерДокумента,
			|	ФизлицаПереданные.Фамилия + "" "" + ФизлицаПереданные.Имя + "" "" + ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.КодСтраныДляОтчетности,
			|	ФизлицаПереданные.КодФНС,
			|	ФизлицаПереданные.КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ПО ФизлицаПереданные.ФизическоеЛицо = ФизлицаПоТекущимДанным.ФизическоеЛицо
			|			И ФизлицаПереданные.ИНН = ФизлицаПоТекущимДанным.ИНН
			|			И ФизлицаПереданные.Фамилия = ФизлицаПоТекущимДанным.Фамилия
			|			И ФизлицаПереданные.Имя = ФизлицаПоТекущимДанным.Имя
			|			И ФизлицаПереданные.Отчество = ФизлицаПоТекущимДанным.Отчество
			|			И ФизлицаПереданные.ДатаРождения = ФизлицаПоТекущимДанным.ДатаРождения
			|			И ФизлицаПереданные.КодСтраныДляОтчетности = ФизлицаПоТекущимДанным.КодСтраныДляОтчетности
			|			И ФизлицаПереданные.СерияДокумента = ФизлицаПоТекущимДанным.СерияДокумента
			|			И ФизлицаПереданные.НомерДокумента = ФизлицаПоТекущимДанным.НомерДокумента
			|			И ФизлицаПереданные.КодФНС = ФизлицаПоТекущимДанным.КодФНС
			|			И ФизлицаПереданные.КодМВД = ФизлицаПоТекущимДанным.КодМВД
			|ГДЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо ЕСТЬ NULL
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДанныеНалогоплательщиков.НомерСправки КАК НомерСправки,
			|	ДанныеНалогоплательщиков.НомерКорректировки КАК НомерКорректировки,
			|	ДанныеНалогоплательщиков.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеНалогоплательщиков.ИНН КАК ИНН,
			|	ДанныеНалогоплательщиков.Фамилия КАК Фамилия,
			|	ДанныеНалогоплательщиков.Имя КАК Имя,
			|	ДанныеНалогоплательщиков.Отчество КАК Отчество,
			|	ДанныеНалогоплательщиков.ДатаРождения КАК ДатаРождения,
			|	ДанныеНалогоплательщиков.СерияДокумента КАК СерияДокумента,
			|	ДанныеНалогоплательщиков.НомерДокумента КАК НомерДокумента,
			|	ВЫРАЗИТЬ(ДанныеНалогоплательщиков.Наименование КАК СТРОКА(1000)) КАК Наименование,
			|	ДанныеНалогоплательщиков.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ДанныеНалогоплательщиков.КодФНС КАК КодФНС,
			|	ДанныеНалогоплательщиков.КодМВД КАК КодМВД
			|ИЗ
			|	ВТДанныеНалогоплательщиков КАК ДанныеНалогоплательщиков
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(МАКСИМУМ(ДанныеНалогоплательщиков.НомерСправки), 0) КАК НомерСправки
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ДанныеНалогоплательщиков";
			Результаты = Запрос.ВыполнитьПакет();
			// АПК:96-вкл
			ВсегоРезультатов = Результаты.Количество();
			ОписаниеТаблиц.Приложение1Налогоплательщики = Результаты[ВсегоРезультатов - 2].Выгрузить();
			МаксимальныйНомерИзПереданныхСправок = 0;
			Если Не Результаты[ВсегоРезультатов - 1].Пустой() Тогда
				Выборка = Результаты[ВсегоРезультатов - 1].Выбрать();
				Выборка.Следующий();
				МаксимальныйНомерИзПереданныхСправок = Выборка.НомерСправки;
			КонецЕсли;
			ОписаниеТаблиц.Вставить("Приложение1МаксимальныйНомерИзПереданныхСправок", МаксимальныйНомерИзПереданныхСправок + 1);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100007 КАК П000П1М100007,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ДанныеИтогов.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОДоходах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОВычетах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.НомерУведомления КАК П000П1М300002,
			|	ВременнаяТаблица.ДатаУведомления КАК П000П1М300003,
			|	ВременнаяТаблица.КодНалоговогоОрганаУведомления КАК П000П1М300004
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ВременнаяТаблица.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL"; 
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = Запрос.Выполнить().Выгрузить();
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОписаниеПоказателей_6НДФЛ_2024Кв1(ПоказателиОтчета) Экспорт
	
	// Раздел 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010001001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002101", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002201", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002301", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002401", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003101", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003201", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003301", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003401", Истина, Истина);
	
	// Раздел 2
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010501", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012103", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016303", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016403", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020017003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020018003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019303", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019403", Истина, Истина);
	
	// Приложение 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000011", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000012", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600005", Истина, Ложь);

КонецПроцедуры

Процедура ЗначенияПоказателей_6НДФЛ_2024Кв1(ПараметрыОтчета, Контейнер) Экспорт
	
	ДатаКонцаПериодаОтчета = ПараметрыОтчета.ДатаКонцаПериодаОтчета;
	Организация = ПараметрыОтчета.Организация;
	НачалоПериода = НачалоГода(ДатаКонцаПериодаОтчета);
	ОкончаниеПериода = КонецМесяца(ДатаКонцаПериодаОтчета);
	НомерКорректировки = ПараметрыОтчета.НомерКорректировки;
	Если ПараметрыОтчета.Свойство("РегистрацииВНО") Тогда
		РегистрацияВНалоговомОргане = ПараметрыОтчета.РегистрацииВНО;
	Иначе
		ТитульныйЛист = Контейнер.Титульный;
		ПараметрыОтбораРегистрацийВНО = Новый Структура;
		ПараметрыОтбораРегистрацийВНО.Вставить("КодНО", ТитульныйЛист.НалоговыйОрган);
		ПараметрыОтбораРегистрацийВНО.Вставить("ОКТМО", ТитульныйЛист.ОКТМО);
		Если СтрДлина(ТитульныйЛист.ИНН) = 10 Тогда
			ПараметрыОтбораРегистрацийВНО.Вставить("КПП", ТитульныйЛист.КПП);
			ПараметрыОтбораРегистрацийВНО.Вставить("ИскатьПоПервымСимволамОКТМО", Истина);
		КонецЕсли;
		РегистрацияВНалоговомОргане = РегламентированнаяОтчетность.РегистрацииОрганизацииВНалоговомОргане(Организация, ПараметрыОтбораРегистрацийВНО);
	КонецЕсли;
	ЗаполнятьПриложение1 = КонецМесяца(ОкончаниеПериода) = КонецГода(ОкончаниеПериода);
	Если ПараметрыОтчета.Свойство("ЗаполнятьПриложение1") Тогда
		ЗаполнятьПриложение1 = ПараметрыОтчета.ЗаполнятьПриложение1;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РегистрацияВНалоговомОргане) Тогда
		Возврат
	КонецЕсли;
	                         
	// Очистка отчета
	ПоказателиОтчета = Новый Структура;
	ОписаниеПоказателей_6НДФЛ_2024Кв1(ПоказателиОтчета);
	
	ДанныеРаздела1 = Контейнер.Раздел1.Строки;
	ПоляКБК = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].Данные); 
	ДанныеРаздела1.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляКБК);
	
	ДанныеРаздела2 = Контейнер.Раздел2.Строки;
	ПоляРаздела2 = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела2[0].Данные); 
	ДанныеРаздела2.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляРаздела2);
	
	Если ЗаполнятьПриложение1 Тогда
		
		ДанныеПриложение1 = Контейнер.Приложение1.Строки;
		ДанныеСправки = ДанныеПриложение1[0].ДанныеМногострочныхЧастей.П000П1М1.Строки;
		ПоляНалогоплательщика = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеПриложение1[0].Данные);
		ПоляИтогов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].Данные);
		ПоляВычетов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М2.Строки[0].Данные);
		ПоляУведомленийОВычетах = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М3.Строки[0].Данные);
		ПоляНеудержано = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М4.Строки[0].Данные);
		ПоляДоходов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].Данные);
		ПоляВычетовКДоходам = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].ДанныеМногострочныхЧастей.П000П1М6.Строки[0].Данные);
		ДанныеПриложение1.Очистить();
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляНалогоплательщика);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляИтогов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляУведомленийОВычетах);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляДоходов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетовКДоходам);
		Для каждого КлючИЗначение Из ПоляНеудержано Цикл
			ПоляНеудержано[КлючИЗначение.Ключ] = 0
		КонецЦикла;
		
	КонецЕсли;
	
	// Сбор данных
	ОписаниеТаблиц = Новый Структура("КоличествоПолучателейДохода, Раздел1НалогиВозвраты, Раздел2Доходы, Раздел2Вычеты, Раздел2Налоги, КоличествоПолучателейДохода");
	Если ЗаполнятьПриложение1 Тогда
		ОписаниеТаблиц.Вставить("Приложение1Налогоплательщики");	
		Если НомерКорректировки <> 99 Тогда
			ОписаниеТаблиц.Вставить("Приложение1Итоги");	
			ОписаниеТаблиц.Вставить("Приложение1Доходы");	
			ОписаниеТаблиц.Вставить("Приложение1Вычеты");	
			ОписаниеТаблиц.Вставить("Приложение1УведомленияОВычетах");	
		КонецЕсли;
	КонецЕсли;
	РасчетПоказателей_6НДФЛ_2024Кв1(НачалоПериода, ОкончаниеПериода, ?(ПараметрыОтчета.ДатаПодписи > ОкончаниеПериода,ПараметрыОтчета.ДатаПодписи, ОкончаниеПериода), Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, Ложь, НомерКорректировки);	
	
	// Вывод данных в отчет
	ВсеКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	ПоискПоКБК = Новый Структура("КБК");
	
	// Раздел 1
	Налоги = ОписаниеТаблиц.Раздел1НалогиВозвраты;
	Для каждого КлючИЗначение Из ВсеКБК Цикл
		КБК = КлючИЗначение.Значение;
		ПоискПоКБК.КБК = КБК;
		СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБК);
		Если СтрокиНалогов.Количество() > 0 Тогда
			СтрокаНалогов = СтрокиНалогов[0]
	 	КонецЕсли;
		СоздаватьСтраницуКБК = СтрокиНалогов.Количество() > 0 
				И (СтрокаНалогов.П000010002001 <> 0 Или СтрокаНалогов.П000010002101 <> 0 Или СтрокаНалогов.П000010002201 <> 0 Или СтрокаНалогов.П000010002301 <> 0 Или СтрокаНалогов.П000010002401 <> 0
				Или СтрокаНалогов.П000010003001 <> 0 Или СтрокаНалогов.П000010003101 <> 0 Или СтрокаНалогов.П000010003201 <> 0 Или СтрокаНалогов.П000010003301 <> 0 Или СтрокаНалогов.П000010003401 <> 0);
		Если СоздаватьСтраницуКБК Тогда
			СтраницаРаздела1 = ДанныеРаздела1.Добавить();
			СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
			ЗаполнитьЗначенияСвойств(СтраницаРаздела1.Данные, СтрокаНалогов);
			СтраницаРаздела1.Данные.П000010001001 = КБК;
			СтраницаРаздела1.ДанныеМногострочныхЧастей = Новый Структура();
		КонецЕсли;
	КонецЦикла;
	Если ДанныеРаздела1.Количество() = 0 Тогда
		СтраницаРаздела1 = ДанныеРаздела1.Добавить();
		СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
		СтраницаРаздела1.Данные.П000010001001 = "18210102010011000110";
		СтраницаРаздела1.ДанныеМногострочныхЧастей = Новый Структура();
	КонецЕсли;
	
	// Раздел 2
	Доходы = ОписаниеТаблиц.Раздел2Доходы;
	Вычеты = ОписаниеТаблиц.Раздел2Вычеты;
	Налоги = ОписаниеТаблиц.Раздел2Налоги;
	Количество = ОписаниеТаблиц.КоличествоПолучателейДохода;
	ПоискПоКБКиСтавке = Новый Структура("КБК,Ставка");
	Для каждого Ставка Из Перечисления.НДФЛСтавки Цикл
		ПоискПоКБКиСтавке.Ставка = Ставка;
		Для каждого КлючИЗначение Из ВсеКБК Цикл
			КБК = КлючИЗначение.Значение;
			ПоискПоКБКиСтавке.КБК = КБК;
			СтрокиДоходов = Доходы.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиВычетов = Вычеты.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиКоличества = Количество.НайтиСтроки(ПоискПоКБКиСтавке);
			
			Если СтрокиДоходов.Количество() > 0 Или СтрокиНалогов.Количество() > 0 Или СтрокиВычетов.Количество() > 0 Тогда
				СтраницаРаздела = ДанныеРаздела2.Добавить();
				СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
				СтраницаРаздела.Данные.П000020010501 = КБК;
				Если Ставка = Перечисления.НДФЛСтавки.Ставка03 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 3
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка05 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 5
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка06 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 6
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка07 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 7
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка09 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 9
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка10 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 10
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка12 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 12
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка13 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 13
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка15 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 15
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка30 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 30
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка35 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 35
				Иначе
					
				КонецЕсли;
				СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
			КонецЕсли;
			Для каждого СтрокаДанных Из СтрокиДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				СтраницаРаздела.Данные.П000020013103 = СтраницаРаздела.Данные.П000020012003;
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиНалогов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиВычетов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				СтраницаРаздела.Данные.П000020013103 = СтраницаРаздела.Данные.П000020013103 - СтраницаРаздела.Данные.П000020013003;
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиКоличества Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			
		КонецЦикла;
	КонецЦикла;
	Если ДанныеРаздела2.Количество() = 0 Тогда
		СтраницаРаздела = ДанныеРаздела2.Добавить();
		СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
		СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
	КонецЕсли;
	
	// Приложение 1
	Если ЗаполнятьПриложение1 Тогда
		Если ОписаниеТаблиц.Приложение1Налогоплательщики.Количество() > 0 Тогда
			
			СоответствиеСтавок = Новый Соответствие;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка03] = 3;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка05] = 5;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка06] = 6;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка07] = 7;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка09] = 9;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка10] = 10;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка12] = 12;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка13] = 13;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка15] = 15;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка30] = 30;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка35] = 35;
			
			Если НомерКорректировки <> 99 Тогда
				Приложение1Итоги = ОписаниеТаблиц.Приложение1Итоги;
				Если Приложение1Итоги.Количество() > 100 Тогда
					Приложение1Итоги.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				Приложение1Доходы = ОписаниеТаблиц.Приложение1Доходы;
				Если Приложение1Доходы.Количество() > 100 Тогда
					Приложение1Доходы.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1Вычеты = ОписаниеТаблиц.Приложение1Вычеты;
				Если Приложение1Вычеты.Количество() > 100 Тогда
					Приложение1Вычеты.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1УведомленияОВычетах = ОписаниеТаблиц.Приложение1УведомленияОВычетах;
				Если Приложение1УведомленияОВычетах.Количество() > 100 Тогда
					Приложение1УведомленияОВычетах.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				ПоискПоФизлицу = Новый Структура("ФизическоеЛицо");
				ПоискПоФизлицуИСтавке = Новый Структура("ФизическоеЛицо,Ставка,КБК");
			КонецЕсли;
			
			НомерПервойСправки = 1;
			Если Не ОписаниеТаблиц.Свойство("Приложение1МаксимальныйНомерИзПереданныхСправок", НомерПервойСправки) Тогда
				НомерПервойСправки = 1;
			КонецЕсли;
			Для каждого СтрокаДанных Из ОписаниеТаблиц.Приложение1Налогоплательщики Цикл
				
				СтраницаПриложение1 = ДанныеПриложение1.Добавить();
				СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
				СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
				Если НомерКорректировки = 0 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
					НомерПервойСправки = НомерПервойСправки + 1;
					СтраницаПриложение1.Данные.П000П10000002 = "00";
				ИначеЕсли НомерКорректировки < 99 Тогда
					Если ЗначениеЗаполнено(СтрокаДанных.НомерСправки) Тогда
						СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
						СтраницаПриложение1.Данные.П000П10000002 = ?(СтрокаДанных.НомерКорректировки = 99, "99", Формат(СтрокаДанных.НомерКорректировки + 1, "ЧЦ=2; ЧДЦ=0; ЧВН="));
					Иначе
						СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
						НомерПервойСправки = НомерПервойСправки + 1;
						СтраницаПриложение1.Данные.П000П10000002 = "00";
					КонецЕсли;
				ИначеЕсли НомерКорректировки = 99 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
					СтраницаПриложение1.Данные.П000П10000002 = "99";
				КонецЕсли;
				СтраницаПриложение1.Данные.П000П10000003 = СтрокаДанных.ИНН;
				СтраницаПриложение1.Данные.П000П10000004 = СокрЛП(СтрокаДанных.Фамилия);
				СтраницаПриложение1.Данные.П000П10000005 = СокрЛП(СтрокаДанных.Имя);
				СтраницаПриложение1.Данные.П000П10000006 = СокрЛП(СтрокаДанных.Отчество);
				СтраницаПриложение1.Данные.П000П10000007 = СтрокаДанных.КодФНС;
				СтраницаПриложение1.Данные.П000П10000008 = СтрокаДанных.ДатаРождения;
				СтраницаПриложение1.Данные.П000П10000009 = СтрокаДанных.КодСтраныДляОтчетности;
				СтраницаПриложение1.Данные.П000П10000010 = СтрокаДанных.КодМВД;
				СтраницаПриложение1.Данные.П000П10000011 = СокрЛП(СтрокаДанных.СерияДокумента);
				СтраницаПриложение1.Данные.П000П10000012 = СокрЛП(СтрокаДанных.НомерДокумента);
				
				ВыводитьДоходы = СтраницаПриложение1.Данные.П000П10000002 <> "99";
				Если ВыводитьДоходы Тогда
					ПоискПоФизлицу.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					ПоискПоФизлицуИСтавке.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					СтрокиФизлица = Приложение1Итоги.НайтиСтроки(ПоискПоФизлицу);
					ВыводитьДоходы = СтрокиФизлица.Количество() > 0;
				КонецЕсли;
				Если ВыводитьДоходы Тогда
					Для каждого СтрокаИтоговПоСтавке Из СтрокиФизлица Цикл
						
						ПоискПоФизлицуИСтавке.Ставка = СтрокаИтоговПоСтавке.Ставка;
						ПоискПоФизлицуИСтавке.КБК = СтрокаИтоговПоСтавке.КБК;
						СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
						СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
						ЗаполнитьЗначенияСвойств(СтраницаПоСтавке.Данные, СтрокаИтоговПоСтавке);
						СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
						СтрокиДанных = Приложение1Вычеты.НайтиСтроки(ПоискПоФизлицуИСтавке);
						ВыводитьИмущественныйВычет = Ложь;
						ВыводитьСоциальныйВычет = Ложь;
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить();
								СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
								ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
								Если Не ВыводитьИмущественныйВычет Тогда
									ВыводитьИмущественныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
								КонецЕсли;
								Если Не ВыводитьСоциальныйВычет Тогда
									ВыводитьСоциальныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.СоциальныеПоУведомлениюНО
								КонецЕсли;
							КонецЦикла;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
						КонецЕсли;
						
						СтрокиДанных = Приложение1УведомленияОВычетах.НайтиСтроки(ПоискПоФизлицу);
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ВыводитьИмущественныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "1"
								КонецЕсли;
								Если ВыводитьСоциальныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "2"
								КонецЕсли;
								Если СтрокаИтоговПоСтавке.П000П1М100006 > 0 И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.ПустаяСсылка() Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "3"
								КонецЕсли;
							КонецЦикла;
							Если СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Количество() = 0 Тогда
								СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
							КонецЕсли;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
						КонецЕсли;
						
						СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
						СтрокиДанных = Приложение1Доходы.Скопировать(Приложение1Доходы.НайтиСтроки(ПоискПоФизлицуИСтавке));
						Если СтрокиДанных.Количество() > 0 Тогда
							СтрокиДанных.Сортировать("Период,П000П1М500002");
							ТекущийКод = Неопределено;
							ТекущийПериод = Неопределено;
							ПредыдущаяСтрока = Неопределено; 
							СуммаДохода = 0;
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ТекущийПериод <> СтрокаДанных.Период Или ТекущийКод <> СтрокаДанных.П000П1М500002 Тогда
									Если ПредыдущаяСтрока <> Неопределено Тогда
										ПредыдущаяСтрока.Данные.П000П1М500003 = СуммаДохода;
										Если ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
											СтрокаВычета = ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
											СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
											СтрокаВычета.Данные.П000П1М600004 = "";
										КонецЕсли;
									КонецЕсли;
									ТекущийКод = СтрокаДанных.П000П1М500002; 
									ТекущийПериод = СтрокаДанных.Период;
									СуммаДохода = 0;
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
									ПредыдущаяСтрока = СтрокаПоСтавке;  
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М500001 = Формат(СтрокаДанных.Период, "ДФ=MM");
									СтрокаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
								КонецЕсли;
								СуммаДохода = СуммаДохода + СтрокаДанных.П000П1М500003;
								Если ЗначениеЗаполнено(СтрокаДанных.П000П1М600004) Тогда
									СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
									СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
									ЗаполнитьЗначенияСвойств(СтрокаВычета.Данные, СтрокаДанных);
								КонецЕсли;
							КонецЦикла;
							СтрокаПоСтавке.Данные.П000П1М500003 = СуммаДохода;
							Если СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
								СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
								СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
								СтрокаВычета.Данные.П000П1М600004 = "";
							КонецЕсли;
						Иначе
							СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
							СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
							СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
							СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
						КонецЕсли;
						
					КонецЦикла; 
				Иначе
					СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
					СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
					СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
					СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
					СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
					СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
				КонецЕсли;
				
			КонецЦикла;
			
		Иначе 
			СтраницаПриложение1 = ДанныеПриложение1.Добавить();
			СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
			СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
			СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
			СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
			СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
			СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
			СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
			СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
		КонецЕсли;
	КонецЕсли;
		
КонецПроцедуры

Процедура РасчетПоказателей_6НДФЛ_2024Кв1(НачалоПериода, ОкончаниеПериода, ДатаПодписи, Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, ПодробныеДанные, НомерКорректировки) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	СтруктураКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("НачалоПредыдущегоГода", ДобавитьМесяц(НачалоПериода, -12));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("ДатаПодписи", КонецДня(ДатаПодписи));
	Запрос.УстановитьПараметр("ОсновнойКБК", СтруктураКБК.Основной);
	Запрос.УстановитьПараметр("КБКсПревышения", СтруктураКБК.СПревышения);
	Запрос.УстановитьПараметр("Дивиденды", СтруктураКБК.Дивиденды);
	Запрос.УстановитьПараметр("ДивидендыСПревышения", СтруктураКБК.ДивидендыСПревышения);
	Запрос.УстановитьПараметр("СоответствиеКатегорийКБК", УчетНДФЛ.КБККатегорийДохода(НачалоПериода));
	Запрос.УстановитьПараметр("ДоходыОтТрудовойДеятельности", Перечисления.КатегорииДоходовНДФЛ.ДоходыОтТрудовойДеятельности());
	Запрос.УстановитьПараметр("НачалоОтчетногоКвартала", НачалоКвартала(ОкончаниеПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериодаОсмотраДоходовВычетов", ?(КонецГода(ОкончаниеПериода) = ОкончаниеПериода Или ЗначениеЗаполнено(НомерКорректировки), Макс(ДатаПодписи, ОкончаниеПериода), ОкончаниеПериода));
	Запрос.УстановитьПараметр("ВКС", Перечисления.ВидыЗастрахованныхЛицОбязательногоСтрахования.ВысококвалифицированныеСпециалисты());
	
	ДатаАктуальности = Макс(ОкончаниеПериода, ДатаПодписи);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
	|	СоответствиеКатегорийКБК.Статус КАК Статус,
	|	СоответствиеКатегорийКБК.КБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|ИЗ
	|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК";
	Запрос.Выполнить();
	
	Если ОписаниеТаблиц.Свойство("Раздел1НалогиВозвраты") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения КАК ВидДвижения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаВозврата,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода КАК РасчетМежрасчетногоПериода,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	ВЫБОР
		|		КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА ВЫБОР
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА 0
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов > 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов < 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
		|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
		|			И (&ОкончаниеПериода МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|			И (ЕСТЬNULL(РезидентствоФизлиц.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = СоответствиеКатегорийКБК.Статус)
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И НЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1НалогиВозвраты") Тогда
		
		ДвадцатьВосьмоеЧислоПервогоМесяца = НачалоКвартала(ОкончаниеПериода) + 27 * 86400;
		Запрос.УстановитьПараметр("ПервыйСрокПеречисления", ДвадцатьВосьмоеЧислоПервогоМесяца);
		Запрос.УстановитьПараметр("ВторойСрокПеречисления", ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 1));
		Запрос.УстановитьПараметр("ТретийСрокПеречисления", ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 2));
		Запрос.УстановитьПараметр("ЧетвертыйСрокПеречисления", ?(Месяц(ОкончаниеПериода) = 12, ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 2), ОкончаниеПериода));
		Запрос.УстановитьПараметр("ПоследнийСрокПеречисленияГода", ?(Месяц(ОкончаниеПериода) = 12, ОкончаниеПериода, ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 2)));
	
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТОтборНеотрицательныхУдержаний
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ КАК КБК,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТОтборНеотрицательныхУдержанийСПревышения
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	-СУММА(НалогиПоДатам.Сумма) КАК Сумма,
		|	НалогиПоДатам.КрайнийСрокУплаты КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТВозвратыПоДатам
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	-СУММА(НалогиПоДатам.СуммаСПревышения),
		|	НалогиПоДатам.КрайнийСрокУплаты
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ОкончаниеПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты <= &ПоследнийСрокПеречисленияГода
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002001,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002101,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002201,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002301,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты > &ЧетвертыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002401,
		|	0 КАК П000010003001,
		|	0 КАК П000010003101,
		|	0 КАК П000010003201,
		|	0 КАК П000010003301,
		|	0 КАК П000010003401
		|ПОМЕСТИТЬ ВТНалогиПоДатам
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборНеотрицательныхУдержаний КАК ОтборНеотрицательныхУдержаний
		|		ПО НалогиПоДатам.КБК = ОтборНеотрицательныхУдержаний.КБК
		|			И НалогиПоДатам.ФизическоеЛицо = ОтборНеотрицательныхУдержаний.ФизическоеЛицо
		|			И НалогиПоДатам.КрайнийСрокУплаты = ОтборНеотрицательныхУдержаний.КрайнийСрокУплаты
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты <= &ПоследнийСрокПеречисленияГода
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты > &ЧетвертыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборНеотрицательныхУдержанийСПревышения КАК ОтборНеотрицательныхУдержаний
		|		ПО НалогиПоДатам.ФизическоеЛицо = ОтборНеотрицательныхУдержаний.ФизическоеЛицо
		|			И (ВЫБОР
		|				КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|					ТОГДА &ДивидендыСПревышения
		|				ИНАЧЕ &КБКсПревышения
		|			КОНЕЦ = ОтборНеотрицательныхУдержаний.КБК)
		|			И НалогиПоДатам.КрайнийСрокУплаты = ОтборНеотрицательныхУдержаний.КрайнийСрокУплаты
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВозвратыПоДатам.КБК,
		|	ВозвратыПоДатам.Регистратор,
		|	ВозвратыПоДатам.ФизическоеЛицо,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты <= &ПоследнийСрокПеречисленияГода
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты > &ЧетвертыйСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ
		|ИЗ
		|	ВТВозвратыПоДатам КАК ВозвратыПоДатам
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002001), 0) КАК П000010002001,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002101), 0) КАК П000010002101,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002201), 0) КАК П000010002201,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002301), 0) КАК П000010002301,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002401), 0) КАК П000010002401,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003001), 0) КАК П000010003001,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003101), 0) КАК П000010003101,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003201), 0) КАК П000010003201,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003301), 0) КАК П000010003301,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003401), 0) КАК П000010003401
		|ИЗ
		|	ВТНалогиПоДатам КАК НалогиПоДатам
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо";
			
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1НалогиВозвраты = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;

	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТФизическиеЛицаОтчета
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента
		|ПОМЕСТИТЬ ВТСтрокиДоходов
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		Запрос.Выполнить();
		
		ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТСтрокиДоходов", "ФизическоеЛицо");
		ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
		ПараметрыПостроения.ВсеЗаписи = Истина;
	    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
			"СтатусыЗастрахованныхФизическихЛиц",
			Запрос.МенеджерВременныхТаблиц,
			Ложь,
			ОписаниеФильтра,
			ПараметрыПостроения);
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиДоходов", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
		
		Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", ?(НачалоПериода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.ДатаОбъединенияНалоговыхБаз, Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза(), Перечисления.КатегорииДоходовНДФЛ.ПоОсновнойСтавке()));
		Запрос.УстановитьПараметр("Предел", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел);
		Запрос.УстановитьПараметр("СтавкаСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Ставка);
		Запрос.УстановитьПараметр("СтавкаЧисломСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом * 100);
		Запрос.УстановитьПараметр("ГодПериода", Год(ОкончаниеПериода));
			
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист) КАК ЭтоВКС,
		|	ВЫБОР
		|		КОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КатегорияДохода
		|	КОНЕЦ КАК НалоговаяБаза,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ КАК КодВычета,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
		|ПОМЕСТИТЬ ВТДоходыПоСтавкам
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.ДатаПолученияДохода = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО СведенияОДоходахНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|			И (СтавкаНДФЛПоСтавкеРезидента.Статус = СоответствиеКатегорийКБК.Статус)
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыАУСН))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|			ИЛИ СведенияОДоходахНДФЛ.СуммаВычета <> 0)
		|	И (НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ДистанционныйРаботник)
		|				И СведенияОДоходахНДФЛ.КатегорияДохода В (&ДоходыОтТрудовойДеятельности))
		|
		|СГРУППИРОВАТЬ ПО
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане),
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ,
		|	СведенияОДоходахНДФЛ.СтрокаРаздела2Расчета6НДФЛ,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист)
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор КАК Регистратор,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма КАК Сумма,
		|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета
		|ПОМЕСТИТЬ ВТСтандартныеИмущественныеВычеты
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
		|ГДЕ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма <> 0
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ИмущественныеВычетыНДФЛ.Регистратор,
		|	ИмущественныеВычетыНДФЛ.ФизическоеЛицо,
		|	ИмущественныеВычетыНДФЛ.КодВычета,
		|	ИмущественныеВычетыНДФЛ.Сумма,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
		|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане)
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
		|ГДЕ
		|	ИмущественныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
		|	И ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычетыНДФЛ.Сумма <> 0
		|	И ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ИмущественныеВычетыНДФЛ.Год = &ГодПериода
		|	И ИмущественныеВычетыНДФЛ.ФизическоеЛицо В
		|			(ВЫБРАТЬ
		|				ФизическиеЛицаОтчета.ФизическоеЛицо КАК ФизическоеЛицо
		|			ИЗ
		|				ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета)";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		УстановитьПривилегированныйРежим(Истина);
		Запрос.Выполнить();
		УстановитьПривилегированныйРежим(Ложь);
		
		Запрос.Текст =
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
		|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) КАК НалоговаяБаза,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК МесяцНалоговогоПериода
		|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	База.ФизическоеЛицо КАК ФизическоеЛицо,
		|	База.НалоговаяБаза КАК НалоговаяБаза
		|ПОМЕСТИТЬ ВТСотрудникиСПревышением
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
		|		ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
		|		ДоходыПоСтавкам.СуммаДохода - ДоходыПоСтавкам.СуммаВычета КАК ОблагаемаяБаза
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
		|	ГДЕ
		|		ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтандартныеИмущественныеВычеты.ФизическоеЛицо,
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		-СтандартныеИмущественныеВычеты.Сумма
		|	ИЗ
		|		ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты) КАК База
		|
		|СГРУППИРОВАТЬ ПО
		|	База.ФизическоеЛицо,
		|	База.НалоговаяБаза
		|
		|ИМЕЮЩИЕ
		|	СУММА(База.ОблагаемаяБаза) > &Предел";
		
		Если Запрос.Выполнить().Выгрузить()[0].Количество > 0 Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК НачалоМесяца,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза КАК НалоговаяБаза,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) КАК ОблагаемыйДоход,
			|	0 КАК ОблагаемыйДоходСНачалаГода,
			|	ЛОЖЬ КАК ЭтоДеньПревышенияПредела,
			|	ЛОЖЬ КАК ПределПревышен
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.НалоговаяБаза = СотрудникиСПревышением.НалоговаяБаза
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	Период";
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СУММА(СтандартныеИмущественныеВычеты.Сумма) КАК Сумма,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяца
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СтандартныеИмущественныеВычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) = СотрудникиСПревышением.НалоговаяБаза)
			|
			|СГРУППИРОВАТЬ ПО
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ)";
			ТаблицаВычетов = Запрос.Выполнить().Выгрузить();
			ИскатьВычеты = ТаблицаВычетов.Количество() > 0;
			Если ИскатьВычеты И ТаблицаВычетов.Количество() > 100 Тогда
				ТаблицаВычетов.Индексы.Добавить("ФизическоеЛицо,НачалоМесяца");
			КонецЕсли;
			ПоискВычетов = Новый Структура("ФизическоеЛицо,НачалоМесяца");
			
			// Расчет облагаемого дохода нарастающим итогом с учетом всех вычетов для каждой даты получения дохода.
			ОблагаемыйДоходСНачалаГода = 0;
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			ТекущееНачалоМесяца = Неопределено;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					ОблагаемыйДоходСНачалаГода = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
					ТекущееНачалоМесяца = Неопределено;
				КонецЕсли;
				// Стандартные, имущественные вычеты учтем один раз за каждый месяц - в первую дату получения дохода месяца.
				ПредоставленныеВычеты = 0;
				Если ИскатьВычеты И СтрокаТаблицы.НалоговаяБаза = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда И ТекущееНачалоМесяца <> СтрокаТаблицы.НачалоМесяца Тогда
					ЗаполнитьЗначенияСвойств(ПоискВычетов, СтрокаТаблицы);
					СтрокиВычетов = ТаблицаВычетов.НайтиСтроки(ПоискВычетов);
					Если СтрокиВычетов.Количество() > 0 Тогда
						ПредоставленныеВычеты = СтрокиВычетов[0].Сумма;
					КонецЕсли;
					ТекущееНачалоМесяца = СтрокаТаблицы.НачалоМесяца;
				КонецЕсли;
				СтрокаТаблицы.ЭтоДеньПревышенияПредела = ОблагаемыйДоходСНачалаГода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел И ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
				ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты;
				СтрокаТаблицы.ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода;
				СтрокаТаблицы.ПределПревышен = ОблагаемыйДоходСНачалаГода > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
			КонецЦикла;
			
			Запрос.УстановитьПараметр("РасчетНарастающимИтогом", ТаблицаРасчетаНарастающимИтогом); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РасчетНарастающимИтогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасчетНарастающимИтогом.Период КАК Период,
			|	РасчетНарастающимИтогом.НалоговаяБаза КАК НалоговаяБаза,
			|	РасчетНарастающимИтогом.ОблагаемыйДоход КАК ОблагаемыйДоход,
			|	РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела КАК ЭтоДеньПревышенияПредела,
			|	РасчетНарастающимИтогом.ПределПревышен КАК ПределПревышен
			|ПОМЕСТИТЬ ВТРасчетНарастающимИтогом
			|ИЗ
			|	&РасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыПоСтавкам.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыПоСтавкам.Ставка КАК Ставка,
			|	ДоходыПоСтавкам.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыПоСтавкам.Регистратор КАК Регистратор,
			|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыПоСтавкам.Начисление КАК Начисление,
			|	ДоходыПоСтавкам.Период КАК Период,
			|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыПоСтавкам.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыПоСтавкам.КБК КАК КБК,
			|	ДоходыПоСтавкам.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыПоСтавкам.КодДохода КАК КодДохода,
			|	ДоходыПоСтавкам.СуммаДохода КАК СуммаДохода,
			|	ДоходыПоСтавкам.КодВычета КАК КодВычета,
			|	ДоходыПоСтавкам.СуммаВычета КАК СуммаВычета,
			|	ДоходыПоСтавкам.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода, 0) КАК ОблагаемыйДоходСНачалаГода,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела, ЛОЖЬ) КАК ЭтоДеньПревышенияПредела,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ПределПревышен, ЛОЖЬ) КАК ПределПревышен,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоход, 0) КАК ОблагаемыйДоходЗаДень
			|ПОМЕСТИТЬ ВТРасширенныеДанныеОДоходах
			|ИЗ
			|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|		ПО ДоходыПоСтавкам.ФизическоеЛицо = РасчетНарастающимИтогом.ФизическоеЛицо
			|			И ДоходыПоСтавкам.Период = РасчетНарастающимИтогом.Период
			|			И ДоходыПоСтавкам.НалоговаяБаза = РасчетНарастающимИтогом.НалоговаяБаза
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.СтавкаНалога КАК СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	РасширенныеДанныеОДоходах.КБК КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода) КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаВычета) КАК СуммаВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода - РасширенныеДанныеОДоходах.СуммаВычета) КАК ОблагаемаяСумма,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень КАК ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление,
			|	РасширенныеДанныеОДоходах.Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода,
			|	РасширенныеДанныеОДоходах.КБК,
			|	РасширенныеДанныеОДоходах.КодДохода,
			|	РасширенныеДанныеОДоходах.КодВычета,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2,
			|	РасширенныеДанныеОДоходах.ЭтоВКС
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	КодДохода";
			
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			ДоходыСУточненнымиСтавками = ТаблицаРасчетаНарастающимИтогом.СкопироватьКолонки();
			
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			СтрокиРаспределения = Новый Массив;
			ОблагаемыйДоходДоПредела = 0;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					Если ОблагаемыйДоходДоПредела <> 0 Тогда
						ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
					КонецЕсли;
					СтрокиРаспределения = Новый Массив;
					ОблагаемыйДоходДоПредела = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
				КонецЕсли;
				Если ОблагаемыйДоходДоПредела = 0 Тогда
					ОблагаемыйДоходДоПредела = СтрокаТаблицы.ОблагаемыйДоходЗаДень - СтрокаТаблицы.ОблагаемыйДоходСНачалаГода + ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел
				КонецЕсли;
				СтрокиРаспределения.Добавить(СтрокаТаблицы);
			КонецЦикла;
			Если ОблагаемыйДоходДоПредела <> 0 Тогда
				ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
			КонецЕсли;
			
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРасчетаНарастающимИтогом, ДоходыСУточненнымиСтавками); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			
			Запрос.УстановитьПараметр("ДоходыСУточненнымиСтавками", ДоходыСУточненнымиСтавками); ДоходыСУточненнымиСтавками = Неопределено;
			Запрос.Текст =
			"УНИЧТОЖИТЬ ВТДоходыПоСтавкам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка КАК Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор КАК Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление КАК Начисление,
			|	ДоходыСУточненнымиСтавками.Период КАК Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|			ТОГДА ВЫБОР
			|					КОГДА ДоходыСУточненнымиСтавками.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|						ТОГДА &ДивидендыСПревышения
			|					ИНАЧЕ &КБКсПревышения
			|				КОНЕЦ
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.КБК
			|	КОНЕЦ КАК КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода КАК КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода КАК СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета КАК КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыСУточненнымиСтавками
			|ИЗ
			|	&ДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаЧисломСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.СтавкаНалога
			|	КОНЕЦ КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.Ставка
			|	КОНЕЦ КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.СтрокаРаздела2 КАК СтрокаРаздела2,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА ВЫБОР
			|					КОГДА РасширенныеДанныеОДоходах.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|						ТОГДА &ДивидендыСПревышения
			|					ИНАЧЕ &КБКсПревышения
			|				КОНЕЦ
			|		ИНАЧЕ РасширенныеДанныеОДоходах.КБК
			|	КОНЕЦ КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	РасширенныеДанныеОДоходах.СуммаДохода КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	РасширенныеДанныеОДоходах.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыПоСтавкам
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	НЕ РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление,
			|	ДоходыСУточненнымиСтавками.Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.СтрокаРаздела2,
			|	ДоходыСУточненнымиСтавками.КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета
			|ИЗ
			|	ВТДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками";
			Запрос.Выполнить();
			
			Если ИскатьВычеты Тогда
				Запрос.Текст =
				"УНИЧТОЖИТЬ ВТМесяцыПослеПревышения
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыУникальныхКБК
				|ИЗ
				|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|ГДЕ
				|	ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
				|	И ДоходыПоСтавкам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
				|
				|СГРУППИРОВАТЬ ПО
				|	ДоходыПоСтавкам.НалоговаяБаза,
				|	ДоходыПоСтавкам.ФизическоеЛицо,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ)
				|
				|ИМЕЮЩИЕ
				|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДоходыПоСтавкам.КБК) = 1
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	МесяцыУникальныхКБК.ФизическоеЛицо КАК ФизическоеЛицо,
				|	МесяцыУникальныхКБК.НалоговаяБаза КАК НалоговаяБаза,
				|	МесяцыУникальныхКБК.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
				|ИЗ
				|	ВТМесяцыУникальныхКБК КАК МесяцыУникальныхКБК
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|		ПО МесяцыУникальныхКБК.ФизическоеЛицо = ДоходыПоСтавкам.ФизическоеЛицо
				|			И МесяцыУникальныхКБК.НалоговаяБаза = ДоходыПоСтавкам.НалоговаяБаза
				|			И (МесяцыУникальныхКБК.МесяцНалоговогоПериода = НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ))
				|ГДЕ
				|	ДоходыПоСтавкам.КБК = &КБКсПревышения";
				Запрос.Выполнить();
			КонецЕсли;
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.УстановитьПараметр("СтрокиРаздела2ПоКодамДохода", УчетНДФЛПовтИсп.СтрокиРаздела2Расчета6НДФЛПоКодамДохода());
			
			ПоДатамТрудовыхДоговоров = Новый Массив;
			ПоДатамТрудовыхДоговоров.Добавить(УчетНДФЛПовтИсп.Доход2710());
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2720);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код2760);
			ПоДатамТрудовыхДоговоров.Добавить(Справочники.ВидыДоходовНДФЛ.Код4800);
			Запрос.УстановитьПараметр("ПоДатамДоговоров", ПоДатамТрудовыхДоговоров);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтрокиРаздела2ПоКодамДохода.КодДохода КАК КодДохода,
			|	СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2Расчета6НДФЛ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТСтрокиРаздела2ПоКодамДохода
			|ИЗ
			|	&СтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.ЭтоВКС КАК ЭтоВКС,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
			|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
			|	ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 <> ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ПустаяСсылка)
			|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
			|		ИНАЧЕ СтрокиРаздела2ПоКодамДохода.СтрокаРаздела2
			|	КОНЕЦ КАК СтрокаРаздела2
			|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиРаздела2ПоКодамДохода КАК СтрокиРаздела2ПоКодамДохода
			|		ПО СведенияОДоходахНДФЛ.КодДохода = СтрокиРаздела2ПоКодамДохода.КодДохода
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	&НачалоПериода КАК НачалоПериода,
			|	&ОкончаниеПериода КАК ОкончаниеПериода,
			|	&ГоловнаяОрганизация КАК ГоловнаяОрганизация
			|ИЗ
			|	ВТДоходыСоСтрокамиРаздела2 КАК ФизЛица
			|ГДЕ
			|	ФизЛица.СтрокаРаздела2 ЕСТЬ NULL";
			Результат = Запрос.Выполнить();
			Если Не Результат.Пустой() Тогда
				
				ФизЛицаОрганизаций = Результат.Выгрузить();
				Запрос.УстановитьПараметр("ТаблицаДоговоров", КадровыйУчет.ДоговорыФизическихЛиц(ФизЛицаОрганизаций)); ФизЛицаОрганизаций = Неопределено; 
				
				Запрос.Текст =
				"ВЫБРАТЬ
				|	ТаблицаДоговоров.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ТаблицаДоговоров.ВидДоговора КАК ВидДоговора,
				|	ТаблицаДоговоров.Окончание КАК Окончание,
				|	ТаблицаДоговоров.Начало КАК Начало
				|ПОМЕСТИТЬ ВТДоговоры
				|ИЗ
				|	&ТаблицаДоговоров КАК ТаблицаДоговоров
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период КАК Период,
				|	НЕ МИНИМУМ(ФизЛица.ВидДоговора) КАК ЕстьТрудовойДоговор
				|ПОМЕСТИТЬ ВТДниДоговоров
				|ИЗ
				|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоговоры КАК ФизЛица
				|		ПО (ФизЛица.Начало <= СведенияОДоходахНДФЛ.Период)
				|			И (ФизЛица.Окончание = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
				|				ИЛИ ФизЛица.Окончание >= СведенияОДоходахНДФЛ.Период)
				|			И СведенияОДоходахНДФЛ.ФизическоеЛицо = ФизЛица.ФизическоеЛицо
				|ГДЕ
				|	ФизЛица.ФизическоеЛицо ЕСТЬ НЕ NULL 
				|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
				|
				|СГРУППИРОВАТЬ ПО
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.Период КАК Период,
				|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
				|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
				|	СведенияОДоходахНДФЛ.ЭтоВКС КАК ЭтоВКС,
				|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
				|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
				|	СведенияОДоходахНДФЛ.КБК КАК КБК,
				|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
				|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
				|	ВЫБОР
				|		КОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2 ЕСТЬ НЕ NULL 
				|			ТОГДА СведенияОДоходахНДФЛ.СтрокаРаздела2
				|		КОГДА СведенияОДоходахНДФЛ.КодДохода В (&ПоДатамДоговоров)
				|			ТОГДА ВЫБОР
				|					КОГДА ЕСТЬNULL(ДниДоговоров.ЕстьТрудовойДоговор, ЛОЖЬ)
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
				|					КОГДА НЕ ДниДоговоров.ЕстьТрудовойДоговор
				|						ТОГДА ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
				|					ИНАЧЕ НЕОПРЕДЕЛЕНО
				|				КОНЕЦ
				|		ИНАЧЕ НЕОПРЕДЕЛЕНО
				|	КОНЕЦ КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТПодробныеДоходы
				|ИЗ
				|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДниДоговоров КАК ДниДоговоров
				|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДниДоговоров.ФизическоеЛицо
				|			И СведенияОДоходахНДФЛ.Период = ДниДоговоров.Период
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|УНИЧТОЖИТЬ ВТДоходыСоСтрокамиРаздела2
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ПодробныеДоходы.Период КАК Период,
				|	ПодробныеДоходы.СтавкаНалога КАК СтавкаНалога,
				|	ПодробныеДоходы.Ставка КАК Ставка,
				|	ПодробныеДоходы.ЭтоВКС КАК ЭтоВКС,
				|	ПодробныеДоходы.Регистратор КАК Регистратор,
				|	ПодробныеДоходы.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ПодробныеДоходы.Начисление КАК Начисление,
				|	ПодробныеДоходы.КатегорияДохода КАК КатегорияДохода,
				|	ПодробныеДоходы.КБК КАК КБК,
				|	ПодробныеДоходы.КодДохода КАК КодДохода,
				|	ПодробныеДоходы.СуммаДохода КАК СуммаДохода,
				|	ПодробныеДоходы.СтрокаРаздела2 КАК СтрокаРаздела2
				|ПОМЕСТИТЬ ВТДоходыСоСтрокамиРаздела2
				|ИЗ
				|	ВТПодробныеДоходы КАК ПодробныеДоходы";
				Запрос.Выполнить();
				
			КонецЕсли;
		КонецЕсли;
			
		Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТВычетыПоСтавкам
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаВычета <> 0
			|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА &ОсновнойКБК
			|		ИНАЧЕ &КБКсПревышения
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА 13
			|		ИНАЧЕ 15
			|	КОНЕЦ,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
			|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМесяцыПослеПревышения КАК СотрудникиСПревышением
			|		ПО ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода = СотрудникиСПревышением.МесяцНалоговогоПериода
			|			И (СотрудникиСПревышением.НалоговаяБаза = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда))
			|ГДЕ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ДанныеДляОтчета";
			Запрос.Выполнить();
		КонецЕсли;
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СУММА(ДанныеОКоличествах.ВсегоПолучателей) КАК П000020011003,
		|	СУММА(ДанныеОКоличествах.ВсегоВКС) КАК П000020011103,
		|	ДанныеОКоличествах.Ставка КАК Ставка,
		|	ДанныеОКоличествах.КБК КАК КБК
		|ИЗ
		|	(ВЫБРАТЬ
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0) КАК ВсегоПолучателей,
		|		0 КАК ВсегоВКС,
		|		СведенияОДоходахНДФЛ.Ставка КАК Ставка,
		|		СведенияОДоходахНДФЛ.КБК КАК КБК
		|	ИЗ
		|		ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		0,
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0),
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	ИЗ
		|		ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|		И СведенияОДоходахНДФЛ.ЭтоВКС
		|		И (СведенияОДоходахНДФЛ.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ИЛИ СведенияОДоходахНДФЛ.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор))
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК) КАК ДанныеОКоличествах
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеОКоличествах.Ставка,
		|	ДанныеОКоличествах.КБК";
		
		ОписаниеТаблиц.КоличествоПолучателейДохода = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодДохода КАК КодДохода,
		|	СведенияОДоходах.Начисление КАК Начисление,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000020012003,
		|	СУММА(ВЫБОР
		|			КОГДА НЕ СведенияОДоходах.ЭтоВКС
		|				ТОГДА 0
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020012103
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.КодДохода,
		|	СведенияОДоходах.Начисление,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодДохода");
			МассивПолей.Добавить("Начисление");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Доходы = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета КАК КодВычета,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000020013003
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодВычета");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Вычеты = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		НачалоОтчетногоКвартала = НачалоКвартала(ОкончаниеПериода);
		Запрос.УстановитьПараметр("ПервыйПериодС", НачалоОтчетногоКвартала);
		Запрос.УстановитьПараметр("ПервыйПериодПо", НачалоОтчетногоКвартала + 21 * 86400);
		Запрос.УстановитьПараметр("ВторойПериодС", НачалоОтчетногоКвартала + 22 * 86400);
		Запрос.УстановитьПараметр("ВторойПериодПо", ДобавитьМесяц(НачалоОтчетногоКвартала, 1) + 21 * 86400);
		Запрос.УстановитьПараметр("ТретийПериодС", ДобавитьМесяц(НачалоОтчетногоКвартала, 1) + 22 * 86400);
		Запрос.УстановитьПараметр("ТретийПериодПо", НачалоМесяца(ОкончаниеПериода) + 21 * 86400);
		Запрос.УстановитьПараметр("ЧетвертыйПериодС", НачалоМесяца(ОкончаниеПериода) + 22 * 86400);
		Запрос.УстановитьПараметр("ЧетвертыйПериодПо", ОкончаниеПериода);

		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТНалоги", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода, "ВТСтавкаНДФЛПоНалогам");
		
		Если Не ЗарплатаКадры.ВТСуществует(Запрос.МенеджерВременныхТаблиц, "ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних") Тогда
			ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТНалоги", "ФизическоеЛицо");
			ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
			ПараметрыПостроения.ВсеЗаписи = Истина;
		    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
			ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
				"СтатусыЗастрахованныхФизическихЛиц",
				Запрос.МенеджерВременныхТаблиц,
				Ложь,
				ОписаниеФильтра,
				ПараметрыПостроения);
		КонецЕсли;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходах.Период КАК Период,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА НЕ СведенияОДоходах.ЭтоВКС
		|				ТОГДА ЛОЖЬ
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ДоговорГПХ)
		|				ТОГДА ИСТИНА
		|			КОГДА СведенияОДоходах.СтрокаРаздела2 = ЗНАЧЕНИЕ(Перечисление.СтрокиРаздела2Расчета6НДФЛ.ТрудовойДоговор)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		КОНЕЦ) КАК ЭтоВКС
		|ПОМЕСТИТЬ ВТСведенияВКС
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода,
		|	СведенияОДоходах.Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛ.КБК КАК КБК,
		|	НДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Начислено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НачисленоПоДивидендам,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ЗачтеноАвансов,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Удержано,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК УдержаноЗаНалоговыйПериод,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.Сумма
		|					КОГДА ВЫБОР
		|							КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|								ТОГДА ВЫБОР
		|										КОГДА НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|											ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|										ИНАЧЕ 0
		|									КОНЕЦ
		|							ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|						КОНЕЦ * НДФЛ.Сумма > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.Сумма > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.Сумма - ВЫБОР
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА ВЫБОР
		|																			КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																				ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																			ИНАЧЕ 0
		|																		КОНЕЦ
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|												КОНЕЦ > 0
		|												ТОГДА НДФЛ.Сумма - ВЫБОР
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА ВЫБОР
		|																				КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																					ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																				ИНАЧЕ 0
		|																			КОНЕЦ
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|													КОНЕЦ
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.Сумма - ВЫБОР
		|										КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|														ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|									КОНЕЦ < 0
		|									ТОГДА НДФЛ.Сумма - ВЫБОР
		|											КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|												ТОГДА ВЫБОР
		|														КОГДА НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														КОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|															ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - НДФЛ.СуммаСПревышения
		|														ИНАЧЕ 0
		|													КОНЕЦ
		|											ИНАЧЕ НДФЛ.НалогНаПрибыльДляДивидендов
		|										КОНЕЦ
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.Сумма
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Сальдо,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Возвращено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.Сумма > 0
		|			ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|									ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ НДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов,
		|	НДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	НДФЛ.ДатаУдержания КАК ДатаУдержания
		|ПОМЕСТИТЬ ВТНалогиПоСтавкам
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.Сумма <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НДФЛ.ФизическоеЛицо,
		|	15,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15),
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА НДФЛ.СуммаСПревышения
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.СуммаСПревышения > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов > 0
		|												ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов < 0
		|									ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|						ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	НДФЛ.КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода,
		|	НДФЛ.ДатаУдержания
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.СуммаСПревышения <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Сальдо) КАК НеУдержано,
		|	Налоги.КБК КАК КБК
		|ПОМЕСТИТЬ ВТНеУдержано
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.КБК КАК КБК,
		|	-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|ПОМЕСТИТЬ ВТИзлишнеУдержаноПоКБК
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Начислено) КАК Начислено,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК НачисленоПоДивидендам,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК НалогНаПрибыльДляДивидендов,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК ЗачтеноАвансов,
		|	СУММА(Налоги.Удержано) КАК Удержано,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ПервыйПериодС И &ПервыйПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВПервыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ВторойПериодС И &ВторойПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВоВторойПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ТретийПериодС И &ТретийПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВТретийПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ЧетвертыйПериодС И &ЧетвертыйПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВЧетвертыйПериод,
		|	СУММА(Налоги.УдержаноЗаНалоговыйПериод) КАК УдержаноЗаНалоговыйПериод,
		|	СУММА(Налоги.Возвращено) КАК Возвращено,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ПервыйПериодС И &ПервыйПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВПервыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ВторойПериодС И &ВторойПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВоВторойПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ТретийПериодС И &ТретийПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВТретийПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ЧетвертыйПериодС И &ЧетвертыйПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВЧетвертыйПериод,
		|	ЕСТЬNULL(МАКСИМУМ(ПоФизлицам.НеУдержано), 0) КАК НеУдержано,
		|	ЕСТЬNULL(МАКСИМУМ(ИзлишнеУдержаноПоКБК.ИзлишнеУдержано), 0) КАК ИзлишнеУдержано,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ) КАК ЭтоВКС
		|ПОМЕСТИТЬ ВТДанныеПоФизлицам
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияВКС КАК СведенияВКС
		|		ПО Налоги.ФизическоеЛицо = СведенияВКС.ФизическоеЛицо
		|			И Налоги.КатегорияДохода = СведенияВКС.КатегорияДохода
		|			И Налоги.ДатаПолученияДохода = СведенияВКС.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНеУдержано КАК ПоФизлицам
		|		ПО Налоги.ФизическоеЛицо = ПоФизлицам.ФизическоеЛицо
		|			И Налоги.СтавкаНалога = ПоФизлицам.СтавкаНалога
		|			И Налоги.КБК = ПоФизлицам.КБК
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИзлишнеУдержаноПоКБК КАК ИзлишнеУдержаноПоКБК
		|		ПО Налоги.ФизическоеЛицо = ИзлишнеУдержаноПоКБК.ФизическоеЛицо
		|			И Налоги.КБК = ИзлишнеУдержаноПоКБК.КБК
		|			И Налоги.СтавкаНалога = ИзлишнеУдержаноПоКБК.СтавкаНалога
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0
		|			ИЛИ Налоги.Возвращено <> 0
		|			ИЛИ ИзлишнеУдержаноПоКБК.ИзлишнеУдержано <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги") Тогда
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(Налоги.Начислено) КАК П000020014003,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ЭтоВКС
		|				ТОГДА Налоги.Начислено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020014103,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК П000020015003,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК П000020015503,
		|	СУММА(Налоги.Удержано) КАК П000020016003,
		|	СУММА(Налоги.УдержаноВПервыйПериод) КАК П000020016103,
		|	СУММА(Налоги.УдержаноВоВторойПериод) КАК П000020016203,
		|	СУММА(Налоги.УдержаноВТретийПериод) КАК П000020016303,
		|	СУММА(Налоги.УдержаноВЧетвертыйПериод) КАК П000020016403,
		|	СУММА(Налоги.НеУдержано) КАК П000020017003,
		|	СУММА(Налоги.ИзлишнеУдержано) КАК П000020018003,
		|	СУММА(Налоги.Возвращено) КАК П000020019003,
		|	СУММА(Налоги.ВозвращеноВПервыйПериод) КАК П000020019103,
		|	СУММА(Налоги.ВозвращеноВоВторойПериод) КАК П000020019203,
		|	СУММА(Налоги.ВозвращеноВТретийПериод) КАК П000020019303,
		|	СУММА(Налоги.ВозвращеноВЧетвертыйПериод) КАК П000020019403,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.Возвращено <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	Налоги.ФизическоеЛицо";
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
		КонецЕсли;
		Запрос.Текст = УдалитьПоляРасшифровкиИзЗапроса(ТекстЗапроса, МассивПолей, "Налоги");
		ОписаниеТаблиц.Раздел2Налоги = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		НеобходимыеКадровыеДанные = Новый Массив();
		НеобходимыеКадровыеДанные.Добавить("ФизическоеЛицо");
		НеобходимыеКадровыеДанные.Добавить("ИНН");
		НеобходимыеКадровыеДанные.Добавить("Наименование");
		НеобходимыеКадровыеДанные.Добавить("Фамилия");
		НеобходимыеКадровыеДанные.Добавить("Имя");
		НеобходимыеКадровыеДанные.Добавить("Отчество");
		НеобходимыеКадровыеДанные.Добавить("СтатусНалогоплательщика");
		НеобходимыеКадровыеДанные.Добавить("ВидЗастрахованногоЛица");
		НеобходимыеКадровыеДанные.Добавить("ДатаРождения");	
		НеобходимыеКадровыеДанные.Добавить("ДокументВид");
		НеобходимыеКадровыеДанные.Добавить("ДокументСерия");
		НеобходимыеКадровыеДанные.Добавить("ДокументНомер");
		НеобходимыеКадровыеДанные.Добавить("ДокументСтранаВыдачи");
		НеобходимыеКадровыеДанные.Добавить("Страна");
		
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДоходыСоСтрокамиРаздела2 КАК СведенияОДоходах";
		ЗарплатаКадры.УничтожитьВТ(Запрос.МенеджерВременныхТаблиц,"ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних", Истина);
		КадровыйУчет.СоздатьНаДатуВТКадровыеДанныеФизическихЛиц(Запрос.МенеджерВременныхТаблиц, Истина, Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НеобходимыеКадровыеДанные, ДатаАктуальности);
		
		// Для корректирующей и отменяющей формы прочитаем переданные в предыдущих отчетах данные.
		Если НомерКорректировки > 0 Тогда
			ФормироватьПустыеДанные = ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив") И РегистрацияВНалоговомОргане.Количество() = 0;
			Если ФормироватьПустыеДанные Тогда
				СоздатьПустыеВТПереданныхДанныхОтчета2024Кв1(Запрос.МенеджерВременныхТаблиц)
			Иначе 
				РеквизитыРегистрации = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(?(ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив"), РегистрацияВНалоговомОргане[0], РегистрацияВНалоговомОргане), "КодПоОКТМО,КПП");
				ПолучитьПереданныеДанныеОтчета2024Кв1(Организация, СокрЛП(РеквизитыРегистрации.КодПоОКТМО), СокрЛП(РеквизитыРегистрации.КПП), ОкончаниеПериода, Запрос.МенеджерВременныхТаблиц, НомерКорректировки, "ФормаОтчета2024Кв1");
			КонецЕсли;
		КонецЕсли;
		
		// Для отменяющей формы нужен только перечень переданных справок.
		Если НомерКорректировки = 99 Тогда
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.НомерСправки КАК НомерСправки,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Фамилия + "" "" + КадровыеДанныеФизЛиц.Имя + "" "" + КадровыеДанныеФизЛиц.Отчество КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			Возврат
		КонецЕсли;
		
		// Для исходной и корректирующей форм соберем текущие данные.
		УчетНДФЛ.СоздатьВТСтавкиНалогаЧислом(Запрос.МенеджерВременныхТаблиц);
		Запрос.Текст =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТУплатившиеАвансыПоНалогу
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.ЗачтеноАвансов) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
		|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
		|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
		|	КадровыеДанныеФизЛиц.Имя КАК Имя,
		|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
		|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """") КАК СерияДокумента,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """") КАК НомерДокумента,
		|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|			ТОГДА ВЫБОР
		|					КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|						ТОГДА ""643""
		|					ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
		|				КОНЕЦ
		|		ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
		|	КОНЕЦ КАК КодСтраныДляОтчетности,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.ВидЗастрахованногоЛица В (&ВКС)
		|				И КадровыеДанныеФизЛиц.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ТОГДА ""7""
		|		КОГДА УплатившиеАвансыПоНалогу.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И КадровыеДанныеФизЛиц.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ТОГДА ""6""
		|		ИНАЧЕ ЕСТЬNULL(СтатусыНалогоплательщиковПоНДФЛ.КодФНС_2015, """")
		|	КОНЕЦ КАК КодФНС,
		|	ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """") КАК КодМВД
		|ПОМЕСТИТЬ ВТФизлицаПоТекущимДанным
		|ИЗ
		|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
		|		ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтатусыНалогоплательщиковПоНДФЛ КАК СтатусыНалогоплательщиковПоНДФЛ
		|		ПО КадровыеДанныеФизЛиц.СтатусНалогоплательщика = СтатусыНалогоплательщиковПоНДФЛ.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУплатившиеАвансыПоНалогу КАК УплатившиеАвансыПоНалогу
		|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = УплатившиеАвансыПоНалогу.ФизическоеЛицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ДанныеИтогов.Ставка КАК Ставка,
		|	ДанныеИтогов.КБК КАК КБК,
		|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
		|	СУММА(ДанныеИтогов.П000П1М100002) КАК П000П1М100002,
		|	СУММА(ДанныеИтогов.П000П1М100003) КАК П000П1М100003,
		|	СУММА(ДанныеИтогов.П000П1М100004) КАК П000П1М100004,
		|	СУММА(ДанныеИтогов.П000П1М100005) КАК П000П1М100005,
		|	СУММА(ДанныеИтогов.П000П1М100006) КАК П000П1М100006,
		|	СУММА(ДанныеИтогов.П000П1М100008) КАК П000П1М100008,
		|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
		|	СУММА(ДанныеИтогов.П000П1М100010) КАК П000П1М100010
		|ПОМЕСТИТЬ ВТДанныеИтоговПоТекущимДанным
		|ИЗ
		|	(ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|		Налоги.СтавкаНалога КАК Ставка,
		|		Налоги.КБК КАК КБК,
		|		Налоги.СтавкаНалога КАК П000П1М100001,
		|		Налоги.КБК КАК П000П1М100009,
		|		0 КАК П000П1М100002,
		|		0 КАК П000П1М100003,
		|		Налоги.Начислено КАК П000П1М100004,
		|		Налоги.УдержаноЗаНалоговыйПериод КАК П000П1М100005,
		|		Налоги.ЗачтеноАвансов КАК П000П1М100006,
		|		0 КАК П000П1М100008,
		|		Налоги.НалогНаПрибыльДляДивидендов КАК П000П1М100010
		|	ИЗ
		|		ВТДанныеПоФизлицам КАК Налоги
		|	ГДЕ
		|		(Налоги.Начислено <> 0
		|				ИЛИ Налоги.ЗачтеноАвансов <> 0
		|				ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СуммаДохода,
		|		СведенияОДоходах.СуммаДохода,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК СведенияОДоходах
		|	ГДЕ
		|		СведенияОДоходах.ДанныеДляОтчета
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		0,
		|		-СведенияОДоходах.СуммаВычета,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТВычетыПоСтавкам КАК СведенияОДоходах
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		Налоги.ИзлишнеУдержано,
		|		0
		|	ИЗ
		|		(ВЫБРАТЬ
		|			Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|			Налоги.СтавкаНалога КАК СтавкаНалога,
		|			Налоги.КБК КАК КБК,
		|			-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|		ИЗ
		|			ВТНалогиПоСтавкам КАК Налоги
		|		
		|		СГРУППИРОВАТЬ ПО
		|			Налоги.ФизическоеЛицо,
		|			Налоги.КБК,
		|			Налоги.СтавкаНалога
		|		
		|		ИМЕЮЩИЕ
		|			СУММА(Налоги.Сальдо) < 0) КАК Налоги) КАК ДанныеИтогов
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеИтогов.Ставка,
		|	ДанныеИтогов.КБК,
		|	ДанныеИтогов.ФизическоеЛицо,
		|	ДанныеИтогов.П000П1М100001,
		|	ДанныеИтогов.П000П1М100009
		|
		|ИМЕЮЩИЕ
		|	СУММА(ДанныеИтогов.П000П1М100002) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ) КАК Период,
		|	СведенияОДоходах.СтавкаНалога КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """") КАК П000П1М500002,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000П1М500003,
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года, """") КАК П000П1М600004,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000П1М600005
		|ПОМЕСТИТЬ ВТДоходыПоТекущимДанным
		|ИЗ
		|	ВТДоходыПоСтавкам КАК СведенияОДоходах
		|ГДЕ
		|	СведенияОДоходах.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """"),
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года, """"),
		|	СведенияОДоходах.СтавкаНалога,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходах.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходах.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОВычетах.СтавкаНалога КАК Ставка,
		|	СведенияОВычетах.КБК КАК КБК,
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета КАК ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года КАК П000П1М200001,
		|	СУММА(СведенияОВычетах.СуммаВычета) КАК П000П1М200002
		|ПОМЕСТИТЬ ВТВычетыПоТекущимДанным
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.КодВычета.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОВычетах.СтавкаНалога,
		|	СведенияОВычетах.КБК,
		|	СведенияОВычетах.ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(СведенияОВычетах.СуммаВычета) <> 0";
		Запрос.Выполнить();
		
		НалоговыйПериод = Год(ОкончаниеПериода);
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)";
		ДанныеУведомлений = УчетНДФЛ.ДанныеУведомленийНаВычеты(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеУведомлений.Колонки.Сотрудник.Имя = "ФизическоеЛицо";
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	Налоги.ЗачтеноАвансов <> 0";
		ДанныеЗачетаАвансовыхПлатежей = УчетНДФЛ.ДанныеУведомленийНаЗачетАвансовыхПлатежей(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеЗачетаАвансовыхПлатежей.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ДанныеЗачетаАвансовыхПлатежей, ДанныеУведомлений);
		
		Если НомерКорректировки = 0 Тогда
			
			// Для исходной формы дополнительных действий не требуется, возвращаем полученные данные.
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	П000П1М200001";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			ДанныеУведомлений.Колонки.НомерУведомления.Имя = "П000П1М300002";
			ДанныеУведомлений.Колонки.ДатаУведомления.Имя = "П000П1М300003";
			ДанныеУведомлений.Колонки.КодНалоговогоОрганаУведомления.Имя = "П000П1М300004";
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = ДанныеУведомлений;
			
		Иначе
			
			// Для корректирующей формы определим перечень сотрудников, чьи данные отличаются от переданных ранее, и вернем данные учета только для них.
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(Запрос.МенеджерВременныхТаблиц, ДанныеУведомлений, "ВТУведомленияОВычетахПоТекущимДанным");
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СУММА(СведенияОДоходах.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТТолькоДоходыПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СУММА(СведенияОДоходах.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002,
			|	СведенияОДоходах.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(СведенияОДоходах.П000П1М600005) <> 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаВОтчет
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО ФизлицаПоТекущимДанным.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|			И ФизлицаПоТекущимДанным.ИНН = ФизлицаПереданные.ИНН
			|			И ФизлицаПоТекущимДанным.Фамилия = ФизлицаПереданные.Фамилия
			|			И ФизлицаПоТекущимДанным.Имя = ФизлицаПереданные.Имя
			|			И ФизлицаПоТекущимДанным.Отчество = ФизлицаПереданные.Отчество
			|			И ФизлицаПоТекущимДанным.ДатаРождения = ФизлицаПереданные.ДатаРождения
			|			И ФизлицаПоТекущимДанным.КодСтраныДляОтчетности = ФизлицаПереданные.КодСтраныДляОтчетности
			|			И ФизлицаПоТекущимДанным.СерияДокумента = ФизлицаПереданные.СерияДокумента
			|			И ФизлицаПоТекущимДанным.НомерДокумента = ФизлицаПереданные.НомерДокумента
			|			И ФизлицаПоТекущимДанным.КодФНС = ФизлицаПереданные.КодФНС
			|			И ФизлицаПоТекущимДанным.КодМВД = ФизлицаПереданные.КодМВД
			|ГДЕ
			|	ФизлицаПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДанныеИтогов.ФизическоеЛицо
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиПереданные КАК ИтогиПереданные
			|		ПО ДанныеИтогов.ФизическоеЛицо = ИтогиПереданные.ФизическоеЛицо
			|			И ДанныеИтогов.П000П1М100001 = ИтогиПереданные.П000П1М100001
			|			И ДанныеИтогов.П000П1М100002 = ИтогиПереданные.П000П1М100002
			|			И ДанныеИтогов.П000П1М100003 = ИтогиПереданные.П000П1М100003
			|			И ДанныеИтогов.П000П1М100004 = ИтогиПереданные.П000П1М100004
			|			И ДанныеИтогов.П000П1М100005 = ИтогиПереданные.П000П1М100005
			|			И ДанныеИтогов.П000П1М100006 = ИтогиПереданные.П000П1М100006
			|			И ДанныеИтогов.П000П1М100008 = ИтогиПереданные.П000П1М100008
			|			И ДанныеИтогов.П000П1М100009 = ИтогиПереданные.П000П1М100009
			|			И ДанныеИтогов.П000П1М100010 = ИтогиПереданные.П000П1М100010
			|ГДЕ
			|	ИтогиПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ИтогиПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТИтогиПереданные КАК ИтогиПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ПО ИтогиПереданные.ФизическоеЛицо = ДанныеИтогов.ФизическоеЛицо
			|			И ИтогиПереданные.П000П1М100001 = ДанныеИтогов.П000П1М100001
			|			И ИтогиПереданные.П000П1М100002 = ДанныеИтогов.П000П1М100002
			|			И ИтогиПереданные.П000П1М100003 = ДанныеИтогов.П000П1М100003
			|			И ИтогиПереданные.П000П1М100004 = ДанныеИтогов.П000П1М100004
			|			И ИтогиПереданные.П000П1М100005 = ДанныеИтогов.П000П1М100005
			|			И ИтогиПереданные.П000П1М100006 = ДанныеИтогов.П000П1М100006
			|			И ИтогиПереданные.П000П1М100008 = ДанныеИтогов.П000П1М100008
			|			И ИтогиПереданные.П000П1М100009 = ДанныеИтогов.П000П1М100009
			|			И ИтогиПереданные.П000П1М100010 = ДанныеИтогов.П000П1М100010
			|ГДЕ
			|	ДанныеИтогов.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходах.ФизическоеЛицо
			|ИЗ
			|	ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПереданные КАК ДоходыПереданные
			|		ПО СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо
			|			И СведенияОДоходах.Ставка = ДоходыПереданные.Ставка
			|			И СведенияОДоходах.КБК = ДоходыПереданные.КБК
			|			И СведенияОДоходах.Период = ДоходыПереданные.Период
			|			И СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002
			|			И СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003
			|ГДЕ
			|	ДоходыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДоходыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТДоходыПереданные КАК ДоходыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ПО (СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо)
			|			И (СведенияОДоходах.Ставка = ДоходыПереданные.Ставка)
			|			И (СведенияОДоходах.КБК = ДоходыПереданные.КБК)
			|			И (СведенияОДоходах.Период = ДоходыПереданные.Период)
			|			И (СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002)
			|			И (СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003)
			|ГДЕ
			|	СведенияОДоходах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.Ставка = ВычетыПереданные.Ставка
			|			И СведенияОВычетах.КБК = ВычетыПереданные.КБК
			|			И СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001
			|			И СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.Ставка = ВычетыПереданные.Ставка)
			|			И (СведенияОВычетах.КБК = ВычетыПереданные.КБК)
			|			И (СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001)
			|			И (СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета
			|			И СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002
			|			И СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003
			|			И СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета)
			|			И (СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002)
			|			И (СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003)
			|			И (СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(ФизлицаПереданные.НомерСправки, 0) КАК НомерСправки,
			|	ЕСТЬNULL(ФизлицаПереданные.НомерКорректировки, 0) КАК НомерКорректировки,
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеНалогоплательщиков
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПереданные.НомерСправки,
			|	99,
			|	ФизлицаПереданные.ФизическоеЛицо,
			|	ФизлицаПереданные.ИНН,
			|	ФизлицаПереданные.Фамилия,
			|	ФизлицаПереданные.Имя,
			|	ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.ДатаРождения,
			|	ФизлицаПереданные.СерияДокумента,
			|	ФизлицаПереданные.НомерДокумента,
			|	ФизлицаПереданные.Фамилия + "" "" + ФизлицаПереданные.Имя + "" "" + ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.КодСтраныДляОтчетности,
			|	ФизлицаПереданные.КодФНС,
			|	ФизлицаПереданные.КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ПО ФизлицаПереданные.ФизическоеЛицо = ФизлицаПоТекущимДанным.ФизическоеЛицо
			|			И ФизлицаПереданные.ИНН = ФизлицаПоТекущимДанным.ИНН
			|			И ФизлицаПереданные.Фамилия = ФизлицаПоТекущимДанным.Фамилия
			|			И ФизлицаПереданные.Имя = ФизлицаПоТекущимДанным.Имя
			|			И ФизлицаПереданные.Отчество = ФизлицаПоТекущимДанным.Отчество
			|			И ФизлицаПереданные.ДатаРождения = ФизлицаПоТекущимДанным.ДатаРождения
			|			И ФизлицаПереданные.КодСтраныДляОтчетности = ФизлицаПоТекущимДанным.КодСтраныДляОтчетности
			|			И ФизлицаПереданные.СерияДокумента = ФизлицаПоТекущимДанным.СерияДокумента
			|			И ФизлицаПереданные.НомерДокумента = ФизлицаПоТекущимДанным.НомерДокумента
			|			И ФизлицаПереданные.КодФНС = ФизлицаПоТекущимДанным.КодФНС
			|			И ФизлицаПереданные.КодМВД = ФизлицаПоТекущимДанным.КодМВД
			|ГДЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо ЕСТЬ NULL
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДанныеНалогоплательщиков.НомерСправки КАК НомерСправки,
			|	ДанныеНалогоплательщиков.НомерКорректировки КАК НомерКорректировки,
			|	ДанныеНалогоплательщиков.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеНалогоплательщиков.ИНН КАК ИНН,
			|	ДанныеНалогоплательщиков.Фамилия КАК Фамилия,
			|	ДанныеНалогоплательщиков.Имя КАК Имя,
			|	ДанныеНалогоплательщиков.Отчество КАК Отчество,
			|	ДанныеНалогоплательщиков.ДатаРождения КАК ДатаРождения,
			|	ДанныеНалогоплательщиков.СерияДокумента КАК СерияДокумента,
			|	ДанныеНалогоплательщиков.НомерДокумента КАК НомерДокумента,
			|	ВЫРАЗИТЬ(ДанныеНалогоплательщиков.Наименование КАК СТРОКА(1000)) КАК Наименование,
			|	ДанныеНалогоплательщиков.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ДанныеНалогоплательщиков.КодФНС КАК КодФНС,
			|	ДанныеНалогоплательщиков.КодМВД КАК КодМВД
			|ИЗ
			|	ВТДанныеНалогоплательщиков КАК ДанныеНалогоплательщиков
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(МАКСИМУМ(ДанныеНалогоплательщиков.НомерСправки), 0) КАК НомерСправки
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ДанныеНалогоплательщиков";
			Результаты = Запрос.ВыполнитьПакет();
			// АПК:96-вкл
			ВсегоРезультатов = Результаты.Количество();
			ОписаниеТаблиц.Приложение1Налогоплательщики = Результаты[ВсегоРезультатов - 2].Выгрузить();
			МаксимальныйНомерИзПереданныхСправок = 0;
			Если Не Результаты[ВсегоРезультатов - 1].Пустой() Тогда
				Выборка = Результаты[ВсегоРезультатов - 1].Выбрать();
				Выборка.Следующий();
				МаксимальныйНомерИзПереданныхСправок = Выборка.НомерСправки;
			КонецЕсли;
			ОписаниеТаблиц.Вставить("Приложение1МаксимальныйНомерИзПереданныхСправок", МаксимальныйНомерИзПереданныхСправок + 1);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ДанныеИтогов.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОДоходах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОВычетах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.НомерУведомления КАК П000П1М300002,
			|	ВременнаяТаблица.ДатаУведомления КАК П000П1М300003,
			|	ВременнаяТаблица.КодНалоговогоОрганаУведомления КАК П000П1М300004
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ВременнаяТаблица.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL"; 
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = Запрос.Выполнить().Выгрузить();
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОписаниеПоказателей_6НДФЛ_2024Кв2(ПоказателиОтчета) Экспорт
	
	// Раздел 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010001001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002101", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002201", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002301", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002401", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002501", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010002601", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003001", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003101", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003201", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003301", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003401", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003501", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000010003601", Истина, Истина);
	
	// Раздел 2
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020010501", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020011103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020012103", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020013103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020014103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020015603", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016303", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016403", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020016603", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020017003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020018003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019003", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019103", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019203", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019303", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019403", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019503", Истина, Истина);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000020019603", Истина, Истина);
	
	// Приложение 1
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000007", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000011", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П10000012", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100005", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100006", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100008", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100009", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100010", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М100011", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М200002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М300004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М400001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М400002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500001", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500002", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М500003", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600004", Истина, Ложь);
	ЗарплатаКадры.ДобавитьПоказательРегламентированнойОтчетности(ПоказателиОтчета, "П000П1М600005", Истина, Ложь);

КонецПроцедуры

Процедура ЗначенияПоказателей_6НДФЛ_2024Кв2(ПараметрыОтчета, Контейнер) Экспорт
	
	ДатаКонцаПериодаОтчета = ПараметрыОтчета.ДатаКонцаПериодаОтчета;
	Организация = ПараметрыОтчета.Организация;
	НачалоПериода = НачалоГода(ДатаКонцаПериодаОтчета);
	ОкончаниеПериода = КонецМесяца(ДатаКонцаПериодаОтчета);
	НомерКорректировки = ПараметрыОтчета.НомерКорректировки;
	Если ПараметрыОтчета.Свойство("РегистрацииВНО") Тогда
		РегистрацияВНалоговомОргане = ПараметрыОтчета.РегистрацииВНО;
	Иначе
		ТитульныйЛист = Контейнер.Титульный;
		ПараметрыОтбораРегистрацийВНО = Новый Структура;
		ПараметрыОтбораРегистрацийВНО.Вставить("КодНО", ТитульныйЛист.НалоговыйОрган);
		ПараметрыОтбораРегистрацийВНО.Вставить("ОКТМО", ТитульныйЛист.ОКТМО);
		Если СтрДлина(ТитульныйЛист.ИНН) = 10 Тогда
			ПараметрыОтбораРегистрацийВНО.Вставить("КПП", ТитульныйЛист.КПП);
			ПараметрыОтбораРегистрацийВНО.Вставить("ИскатьПоПервымСимволамОКТМО", Истина);
		КонецЕсли;
		РегистрацияВНалоговомОргане = РегламентированнаяОтчетность.РегистрацииОрганизацииВНалоговомОргане(Организация, ПараметрыОтбораРегистрацийВНО);
	КонецЕсли;
	ЗаполнятьПриложение1 = КонецМесяца(ОкончаниеПериода) = КонецГода(ОкончаниеПериода);
	Если ПараметрыОтчета.Свойство("ЗаполнятьПриложение1") Тогда
		ЗаполнятьПриложение1 = ПараметрыОтчета.ЗаполнятьПриложение1;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РегистрацияВНалоговомОргане) Тогда
		Возврат
	КонецЕсли;
	                         
	// Очистка отчета
	ПоказателиОтчета = Новый Структура;
	ОписаниеПоказателей_6НДФЛ_2024Кв2(ПоказателиОтчета);
	
	ДанныеРаздела1 = Контейнер.Раздел1.Строки;
	ПоляКБК = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела1[0].Данные); 
	ДанныеРаздела1.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляКБК);
	
	ДанныеРаздела2 = Контейнер.Раздел2.Строки;
	ПоляРаздела2 = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеРаздела2[0].Данные); 
	ДанныеРаздела2.Очистить();
	ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляРаздела2);
	
	Если ЗаполнятьПриложение1 Тогда
		
		ДанныеПриложение1 = Контейнер.Приложение1.Строки;
		ДанныеСправки = ДанныеПриложение1[0].ДанныеМногострочныхЧастей.П000П1М1.Строки;
		ПоляНалогоплательщика = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеПриложение1[0].Данные);
		ПоляИтогов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].Данные);
		ПоляВычетов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М2.Строки[0].Данные);
		ПоляУведомленийОВычетах = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М3.Строки[0].Данные);
		ПоляНеудержано = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М4.Строки[0].Данные);
		ПоляДоходов = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].Данные);
		ПоляВычетовКДоходам = ОбщегоНазначения.СкопироватьРекурсивно(ДанныеСправки[0].ДанныеМногострочныхЧастей.П000П1М5.Строки[0].ДанныеМногострочныхЧастей.П000П1М6.Строки[0].Данные);
		ДанныеПриложение1.Очистить();
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляНалогоплательщика);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляИтогов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляУведомленийОВычетах);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляДоходов);
		ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, ПоляВычетовКДоходам);
		Для каждого КлючИЗначение Из ПоляНеудержано Цикл
			ПоляНеудержано[КлючИЗначение.Ключ] = 0
		КонецЦикла;
		
	КонецЕсли;
	
	// Сбор данных
	ОписаниеТаблиц = Новый Структура("КоличествоПолучателейДохода, Раздел1НалогиВозвраты, Раздел2Доходы, Раздел2Вычеты, Раздел2Налоги2024, КоличествоПолучателейДохода");
	Если ЗаполнятьПриложение1 Тогда
		ОписаниеТаблиц.Вставить("Приложение1Налогоплательщики");	
		Если НомерКорректировки <> 99 Тогда
			ОписаниеТаблиц.Вставить("Приложение1Итоги");	
			ОписаниеТаблиц.Вставить("Приложение1Доходы");	
			ОписаниеТаблиц.Вставить("Приложение1Вычеты");	
			ОписаниеТаблиц.Вставить("Приложение1УведомленияОВычетах");	
		КонецЕсли;
	КонецЕсли;
	РасчетПоказателей_6НДФЛ_2024Кв2(НачалоПериода, ОкончаниеПериода, ?(ПараметрыОтчета.ДатаПодписи > ОкончаниеПериода,ПараметрыОтчета.ДатаПодписи, ОкончаниеПериода), Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, Ложь, НомерКорректировки);	
	
	// Вывод данных в отчет
	ВсеКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	ПоискПоКБК = Новый Структура("КБК");
	
	// Раздел 1
	Налоги = ОписаниеТаблиц.Раздел1НалогиВозвраты;
	Для каждого КлючИЗначение Из ВсеКБК Цикл
		КБК = КлючИЗначение.Значение;
		ПоискПоКБК.КБК = КБК;
		СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБК);
		Если СтрокиНалогов.Количество() > 0 Тогда
			СтрокаНалогов = СтрокиНалогов[0]
	 	КонецЕсли;
		СоздаватьСтраницуКБК = СтрокиНалогов.Количество() > 0 
				И (СтрокаНалогов.П000010002001 <> 0 Или СтрокаНалогов.П000010002101 <> 0 Или СтрокаНалогов.П000010002201 <> 0 Или СтрокаНалогов.П000010002301 <> 0 Или СтрокаНалогов.П000010002401 <> 0 Или СтрокаНалогов.П000010002501 <> 0 Или СтрокаНалогов.П000010002601 <> 0
				Или СтрокаНалогов.П000010003001 <> 0 Или СтрокаНалогов.П000010003101 <> 0 Или СтрокаНалогов.П000010003201 <> 0 Или СтрокаНалогов.П000010003301 <> 0 Или СтрокаНалогов.П000010003401 <> 0 Или СтрокаНалогов.П000010003501 <> 0 Или СтрокаНалогов.П000010003601 <> 0);
		Если СоздаватьСтраницуКБК Тогда
			СтраницаРаздела1 = ДанныеРаздела1.Добавить();
			СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
			ЗаполнитьЗначенияСвойств(СтраницаРаздела1.Данные, СтрокаНалогов);
			СтраницаРаздела1.Данные.П000010001001 = КБК;
			СтраницаРаздела1.ДанныеМногострочныхЧастей = Новый Структура();
		КонецЕсли;
	КонецЦикла;
	Если ДанныеРаздела1.Количество() = 0 Тогда
		СтраницаРаздела1 = ДанныеРаздела1.Добавить();
		СтраницаРаздела1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляКБК);
		СтраницаРаздела1.Данные.П000010001001 = "18210102010011000110";
		СтраницаРаздела1.ДанныеМногострочныхЧастей = Новый Структура();
	КонецЕсли;
	
	// Раздел 2
	Доходы = ОписаниеТаблиц.Раздел2Доходы;
	Вычеты = ОписаниеТаблиц.Раздел2Вычеты;
	Налоги = ОписаниеТаблиц.Раздел2Налоги2024;
	Количество = ОписаниеТаблиц.КоличествоПолучателейДохода;
	ПоискПоКБКиСтавке = Новый Структура("КБК,Ставка");
	Для каждого Ставка Из Перечисления.НДФЛСтавки Цикл
		ПоискПоКБКиСтавке.Ставка = Ставка;
		Для каждого КлючИЗначение Из ВсеКБК Цикл
			КБК = КлючИЗначение.Значение;
			ПоискПоКБКиСтавке.КБК = КБК;
			СтрокиДоходов = Доходы.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиВычетов = Вычеты.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиНалогов = Налоги.НайтиСтроки(ПоискПоКБКиСтавке);
			СтрокиКоличества = Количество.НайтиСтроки(ПоискПоКБКиСтавке);
			
			Если СтрокиДоходов.Количество() > 0 Или СтрокиНалогов.Количество() > 0 Или СтрокиВычетов.Количество() > 0 Тогда
				СтраницаРаздела = ДанныеРаздела2.Добавить();
				СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
				СтраницаРаздела.Данные.П000020010501 = КБК;
				Если Ставка = Перечисления.НДФЛСтавки.Ставка03 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 3
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка05 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 5
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка06 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 6
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка07 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 7
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка09 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 9
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка10 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 10
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка12 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 12
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка13 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 13
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка15 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 15
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка30 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 30
				ИначеЕсли Ставка = Перечисления.НДФЛСтавки.Ставка35 Тогда
					 СтраницаРаздела.Данные.П000020010001 = 35
				Иначе
					
				КонецЕсли;
				СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
			КонецЕсли;
			Для каждого СтрокаДанных Из СтрокиДоходов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				СтраницаРаздела.Данные.П000020013103 = СтраницаРаздела.Данные.П000020012003;
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиНалогов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиВычетов Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				СтраницаРаздела.Данные.П000020013103 = СтраницаРаздела.Данные.П000020013103 - СтраницаРаздела.Данные.П000020013003;
				Прервать;
			КонецЦикла;
			Для каждого СтрокаДанных Из СтрокиКоличества Цикл
				ЗаполнитьЗначенияСвойств(СтраницаРаздела.Данные, СтрокаДанных);
				Прервать;
			КонецЦикла;
			
		КонецЦикла;
	КонецЦикла;
	Если ДанныеРаздела2.Количество() = 0 Тогда
		СтраницаРаздела = ДанныеРаздела2.Добавить();
		СтраницаРаздела.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляРаздела2);
		СтраницаРаздела.ДанныеМногострочныхЧастей = Новый Структура();
	КонецЕсли;
	
	// Приложение 1
	Если ЗаполнятьПриложение1 Тогда
		Если ОписаниеТаблиц.Приложение1Налогоплательщики.Количество() > 0 Тогда
			
			СоответствиеСтавок = Новый Соответствие;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка03] = 3;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка05] = 5;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка06] = 6;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка07] = 7;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка09] = 9;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка10] = 10;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка12] = 12;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка13] = 13;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка15] = 15;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка30] = 30;
			СоответствиеСтавок[Перечисления.НДФЛСтавки.Ставка35] = 35;
			
			Если НомерКорректировки <> 99 Тогда
				Приложение1Итоги = ОписаниеТаблиц.Приложение1Итоги;
				Если Приложение1Итоги.Количество() > 100 Тогда
					Приложение1Итоги.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				Приложение1Доходы = ОписаниеТаблиц.Приложение1Доходы;
				Если Приложение1Доходы.Количество() > 100 Тогда
					Приложение1Доходы.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1Вычеты = ОписаниеТаблиц.Приложение1Вычеты;
				Если Приложение1Вычеты.Количество() > 100 Тогда
					Приложение1Вычеты.Индексы.Добавить("ФизическоеЛицо,Ставка,КБК");
				КонецЕсли;
				Приложение1УведомленияОВычетах = ОписаниеТаблиц.Приложение1УведомленияОВычетах;
				Если Приложение1УведомленияОВычетах.Количество() > 100 Тогда
					Приложение1УведомленияОВычетах.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				ПоискПоФизлицу = Новый Структура("ФизическоеЛицо");
				ПоискПоФизлицуИСтавке = Новый Структура("ФизическоеЛицо,Ставка,КБК");
			КонецЕсли;
			
			НомерПервойСправки = 1;
			Если Не ОписаниеТаблиц.Свойство("Приложение1МаксимальныйНомерИзПереданныхСправок", НомерПервойСправки) Тогда
				НомерПервойСправки = 1;
			КонецЕсли;
			Для каждого СтрокаДанных Из ОписаниеТаблиц.Приложение1Налогоплательщики Цикл
				
				СтраницаПриложение1 = ДанныеПриложение1.Добавить();
				СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
				СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
				Если НомерКорректировки = 0 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
					НомерПервойСправки = НомерПервойСправки + 1;
					СтраницаПриложение1.Данные.П000П10000002 = "00";
				ИначеЕсли НомерКорректировки < 99 Тогда
					Если ЗначениеЗаполнено(СтрокаДанных.НомерСправки) Тогда
						СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
						СтраницаПриложение1.Данные.П000П10000002 = ?(СтрокаДанных.НомерКорректировки = 99, "99", Формат(СтрокаДанных.НомерКорректировки + 1, "ЧЦ=2; ЧДЦ=0; ЧВН="));
					Иначе
						СтраницаПриложение1.Данные.П000П10000001 = НомерПервойСправки;
						НомерПервойСправки = НомерПервойСправки + 1;
						СтраницаПриложение1.Данные.П000П10000002 = "00";
					КонецЕсли;
				ИначеЕсли НомерКорректировки = 99 Тогда
					СтраницаПриложение1.Данные.П000П10000001 = СтрокаДанных.НомерСправки;
					СтраницаПриложение1.Данные.П000П10000002 = "99";
				КонецЕсли;
				СтраницаПриложение1.Данные.П000П10000003 = СтрокаДанных.ИНН;
				СтраницаПриложение1.Данные.П000П10000004 = СокрЛП(СтрокаДанных.Фамилия);
				СтраницаПриложение1.Данные.П000П10000005 = СокрЛП(СтрокаДанных.Имя);
				СтраницаПриложение1.Данные.П000П10000006 = СокрЛП(СтрокаДанных.Отчество);
				СтраницаПриложение1.Данные.П000П10000007 = СтрокаДанных.КодФНС;
				СтраницаПриложение1.Данные.П000П10000008 = СтрокаДанных.ДатаРождения;
				СтраницаПриложение1.Данные.П000П10000009 = СтрокаДанных.КодСтраныДляОтчетности;
				СтраницаПриложение1.Данные.П000П10000010 = СтрокаДанных.КодМВД;
				СтраницаПриложение1.Данные.П000П10000011 = СокрЛП(СтрокаДанных.СерияДокумента);
				СтраницаПриложение1.Данные.П000П10000012 = СокрЛП(СтрокаДанных.НомерДокумента);
				
				ВыводитьДоходы = СтраницаПриложение1.Данные.П000П10000002 <> "99";
				Если ВыводитьДоходы Тогда
					ПоискПоФизлицу.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					ПоискПоФизлицуИСтавке.ФизическоеЛицо = СтрокаДанных.ФизическоеЛицо;
					СтрокиФизлица = Приложение1Итоги.НайтиСтроки(ПоискПоФизлицу);
					ВыводитьДоходы = СтрокиФизлица.Количество() > 0;
				КонецЕсли;
				Если ВыводитьДоходы Тогда
					Для каждого СтрокаИтоговПоСтавке Из СтрокиФизлица Цикл
						
						ПоискПоФизлицуИСтавке.Ставка = СтрокаИтоговПоСтавке.Ставка;
						ПоискПоФизлицуИСтавке.КБК = СтрокаИтоговПоСтавке.КБК;
						СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
						СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
						ЗаполнитьЗначенияСвойств(СтраницаПоСтавке.Данные, СтрокаИтоговПоСтавке);
						СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
						СтрокиДанных = Приложение1Вычеты.НайтиСтроки(ПоискПоФизлицуИСтавке);
						ВыводитьИмущественныйВычет = Ложь;
						ВыводитьСоциальныйВычет = Ложь;
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить();
								СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
								ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
								Если Не ВыводитьИмущественныйВычет Тогда
									ВыводитьИмущественныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
								КонецЕсли;
								Если Не ВыводитьСоциальныйВычет Тогда
									ВыводитьСоциальныйВычет = СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.СоциальныеПоУведомлениюНО
								КонецЕсли;
							КонецЦикла;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
						КонецЕсли;
						
						СтрокиДанных = Приложение1УведомленияОВычетах.НайтиСтроки(ПоискПоФизлицу);
						Если СтрокиДанных.Количество() > 0 Тогда
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ВыводитьИмущественныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "1"
								КонецЕсли;
								Если ВыводитьСоциальныйВычет И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "2"
								КонецЕсли;
								Если СтрокаИтоговПоСтавке.П000П1М100006 > 0 И СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.ПустаяСсылка() Тогда
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить();
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М300001 = "3"
								КонецЕсли;
							КонецЦикла;
							Если СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Количество() = 0 Тогда
								СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
							КонецЕсли;
						Иначе
							СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
						КонецЕсли;
						
						СтрокаНеудержано = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить();
						СтрокаНеудержано.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
						ЗаполнитьЗначенияСвойств(СтрокаНеудержано.Данные, СтрокаИтоговПоСтавке);
						
						СтрокиДанных = Приложение1Доходы.Скопировать(Приложение1Доходы.НайтиСтроки(ПоискПоФизлицуИСтавке));
						Если СтрокиДанных.Количество() > 0 Тогда
							СтрокиДанных.Сортировать("Период,П000П1М500002");
							ТекущийКод = Неопределено;
							ТекущийПериод = Неопределено;
							ПредыдущаяСтрока = Неопределено; 
							СуммаДохода = 0;
							Для каждого СтрокаДанных Из СтрокиДанных Цикл
								Если ТекущийПериод <> СтрокаДанных.Период Или ТекущийКод <> СтрокаДанных.П000П1М500002 Тогда
									Если ПредыдущаяСтрока <> Неопределено Тогда
										ПредыдущаяСтрока.Данные.П000П1М500003 = СуммаДохода;
										Если ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
											СтрокаВычета = ПредыдущаяСтрока.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
											СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
											СтрокаВычета.Данные.П000П1М600004 = "";
										КонецЕсли;
									КонецЕсли;
									ТекущийКод = СтрокаДанных.П000П1М500002; 
									ТекущийПериод = СтрокаДанных.Период;
									СуммаДохода = 0;
									СтрокаПоСтавке = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
									ПредыдущаяСтрока = СтрокаПоСтавке;  
									СтрокаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
									ЗаполнитьЗначенияСвойств(СтрокаПоСтавке.Данные, СтрокаДанных);
									СтрокаПоСтавке.Данные.П000П1М500001 = Формат(СтрокаДанных.Период, "ДФ=MM");
									СтрокаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
								КонецЕсли;
								СуммаДохода = СуммаДохода + СтрокаДанных.П000П1М500003;
								Если ЗначениеЗаполнено(СтрокаДанных.П000П1М600004) Тогда
									СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
									СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
									ЗаполнитьЗначенияСвойств(СтрокаВычета.Данные, СтрокаДанных);
								КонецЕсли;
							КонецЦикла;
							СтрокаПоСтавке.Данные.П000П1М500003 = СуммаДохода;
							Если СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Количество() = 0 Тогда
								СтрокаВычета = СтрокаПоСтавке.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить();
								СтрокаВычета.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
								СтрокаВычета.Данные.П000П1М600004 = "";
							КонецЕсли;
						Иначе
							СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
							СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
							СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
							СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
						КонецЕсли;
						
					КонецЦикла; 
				Иначе
					СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
					СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
					СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
					СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
					СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
					СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
					СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
				КонецЕсли;
				
			КонецЦикла;
			
		Иначе 
			СтраницаПриложение1 = ДанныеПриложение1.Добавить();
			СтраницаПриложение1.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНалогоплательщика);
			СтраницаПриложение1.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М1");
			СтраницаПоСтавке = СтраницаПриложение1.ДанныеМногострочныхЧастей.П000П1М1.Строки.Добавить();
			СтраницаПоСтавке.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляИтогов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М2,П000П1М3,П000П1М4,П000П1М5");
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М2.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетов);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М3.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляУведомленийОВычетах);
			СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М4.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляНеудержано);
			СтрокаДоходов = СтраницаПоСтавке.ДанныеМногострочныхЧастей.П000П1М5.Строки.Добавить();
			СтрокаДоходов.Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляДоходов);
			СтрокаДоходов.ДанныеМногострочныхЧастей = НовыеПустыеДанныеМногострочныхЧастей("П000П1М6");
			СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки.Добавить().Данные = ОбщегоНазначения.СкопироватьРекурсивно(ПоляВычетовКДоходам);
		КонецЕсли;
	КонецЕсли;
		
КонецПроцедуры

Процедура РасчетПоказателей_6НДФЛ_2024Кв2(НачалоПериода, ОкончаниеПериода, ДатаПодписи, Организация, РегистрацияВНалоговомОргане, ОписаниеТаблиц, ПодробныеДанные, НомерКорректировки) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	СтруктураКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("НачалоПредыдущегоГода", ДобавитьМесяц(НачалоПериода, -12));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("ДатаПодписи", КонецДня(ДатаПодписи));
	Запрос.УстановитьПараметр("ОсновнойКБК", СтруктураКБК.Основной);
	Запрос.УстановитьПараметр("КБКсПревышения", СтруктураКБК.СПревышения);
	Запрос.УстановитьПараметр("Дивиденды", СтруктураКБК.Дивиденды);
	Запрос.УстановитьПараметр("ДивидендыСПревышения", СтруктураКБК.ДивидендыСПревышения);
	Запрос.УстановитьПараметр("СоответствиеКатегорийКБК", УчетНДФЛ.КБККатегорийДохода(НачалоПериода));
	Запрос.УстановитьПараметр("ДоходыОтТрудовойДеятельности", Перечисления.КатегорииДоходовНДФЛ.ДоходыОтТрудовойДеятельности());
	Запрос.УстановитьПараметр("АУСН", Перечисления.КатегорииДоходовНДФЛ.ДоходыАУСН());
	Запрос.УстановитьПараметр("НачалоОтчетногоКвартала", НачалоКвартала(ОкончаниеПериода));
	Запрос.УстановитьПараметр("ОкончаниеПериодаОсмотраДоходовВычетов", ?(КонецГода(ОкончаниеПериода) = ОкончаниеПериода Или ЗначениеЗаполнено(НомерКорректировки), Макс(ДатаПодписи, ОкончаниеПериода), ОкончаниеПериода));
	Запрос.УстановитьПараметр("ВКС", Перечисления.ВидыЗастрахованныхЛицОбязательногоСтрахования.ВысококвалифицированныеСпециалисты());
	
	ДатаАктуальности = Макс(ОкончаниеПериода, ДатаПодписи);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
	|	СоответствиеКатегорийКБК.Статус КАК Статус,
	|	СоответствиеКатегорийКБК.КБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|ИЗ
	|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК";
	Запрос.Выполнить();
	
	Если ОписаниеТаблиц.Свойство("Раздел1НалогиВозвраты") Или ОписаниеТаблиц.Свойство("Раздел2Налоги2024") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения КАК ВидДвижения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаДоходаСКоторогоНеУдержанНалог КАК СуммаДоходаСКоторогоНеУдержанНалог,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаВозврата,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода КАК РасчетМежрасчетногоПериода,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	ВЫБОР
		|		КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
		|			ТОГДА ВЫБОР
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом = 0
		|									ТОГДА 0
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом > 0
		|										И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|									ТОГДА ВЫБОР
		|											КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|												ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|											ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|										КОНЕЦ
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом < 0
		|										И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|									ТОГДА ВЫБОР
		|											КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|												ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|											ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|										КОНЕЦ
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|						ТОГДА 0
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов > 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов < 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогДляДивидендов,
		|	ВЫБОР
		|		КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА ВЫБОР
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов = 0
		|						ТОГДА 0
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов > 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов < 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов,
		|	ВЫБОР
		|		КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
		|			ТОГДА ВЫБОР
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом = 0
		|						ТОГДА 0
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом > 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения >= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом < 0
		|							И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения < 0
		|						ТОГДА ВЫБОР
		|								КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <= РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|									ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|								ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма + РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогСДивидендовУплаченныйЗаРубежом
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
		|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
		|			И (&ОкончаниеПериода МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|			И (ЕСТЬNULL(РезидентствоФизлиц.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = СоответствиеКатегорийКБК.Статус)
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И НЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&АУСН)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел1НалогиВозвраты") Тогда
		
		ДвадцатьВосьмоеЧислоПервогоМесяца = НачалоКвартала(ОкончаниеПериода) + 27 * 86400;
		ДвадцатьТретьеДекабря = ДобавитьМесяц(НачалоГода(ОкончаниеПериода) + 22 * 86400, 11);
		ПятоеЧислоВторогоМесяца = ДобавитьМесяц(НачалоКвартала(ОкончаниеПериода) + 4 * 86400, 1);
		Запрос.УстановитьПараметр("ПервыйСрокПеречисления", ДвадцатьВосьмоеЧислоПервогоМесяца);
		Запрос.УстановитьПараметр("ВторойСрокПеречисления", ПятоеЧислоВторогоМесяца);
		Запрос.УстановитьПараметр("ТретийСрокПеречисления", ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 1));
		Запрос.УстановитьПараметр("ЧетвертыйСрокПеречисления", ДобавитьМесяц(ПятоеЧислоВторогоМесяца, 1));
		Запрос.УстановитьПараметр("ПятыйСрокПеречисления", ДобавитьМесяц(ДвадцатьВосьмоеЧислоПервогоМесяца, 2));
		Запрос.УстановитьПараметр("ШестойСрокПеречисления", ДобавитьМесяц(ПятоеЧислоВторогоМесяца, 2));
		Запрос.УстановитьПараметр("ДвадцатьТретьеДекабря", ДвадцатьТретьеДекабря);
	
		Запрос.Текст =
		"ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТОтборНеотрицательныхУдержаний
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ШестойСрокПеречисления
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ КАК КБК,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТОтборНеотрицательныхУдержанийСПревышения
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ШестойСрокПеречисления
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	НалогиПоДатам.КрайнийСрокУплаты
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	-СУММА(НалогиПоДатам.Сумма) КАК Сумма,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты < &ПятыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.КрайнийСрокУплаты
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПятыйСрокПеречисления
		|				И НалогиПоДатам.ДатаУдержания < &ДвадцатьТретьеДекабря
		|			ТОГДА &ПятыйСрокПеречисления
		|		ИНАЧЕ &ШестойСрокПеречисления
		|	КОНЕЦ КАК КрайнийСрокУплаты
		|ПОМЕСТИТЬ ВТВозвратыПоДатам
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ШестойСрокПеречисления
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты < &ПятыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.КрайнийСрокУплаты
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПятыйСрокПеречисления
		|				И НалогиПоДатам.ДатаУдержания < &ДвадцатьТретьеДекабря
		|			ТОГДА &ПятыйСрокПеречисления
		|		ИНАЧЕ &ШестойСрокПеречисления
		|	КОНЕЦ
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.Сумма) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	-СУММА(НалогиПоДатам.СуммаСПревышения),
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты < &ПятыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.КрайнийСрокУплаты
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПятыйСрокПеречисления
		|				И НалогиПоДатам.ДатаУдержания < &ДвадцатьТретьеДекабря
		|			ТОГДА &ПятыйСрокПеречисления
		|		ИНАЧЕ &ШестойСрокПеречисления
		|	КОНЕЦ
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|	И НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ШестойСрокПеречисления
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты < &ПятыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.КрайнийСрокУплаты
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПятыйСрокПеречисления
		|				И НалогиПоДатам.ДатаУдержания < &ДвадцатьТретьеДекабря
		|			ТОГДА &ПятыйСрокПеречисления
		|		ИНАЧЕ &ШестойСрокПеречисления
		|	КОНЕЦ
		|
		|ИМЕЮЩИЕ
		|	СУММА(НалогиПоДатам.СуммаСПревышения) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ШестойСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002001,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002101,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002201,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002301,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ЧетвертыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002401,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПятыйСрокПеречисления
		|				И НалогиПоДатам.ДатаУдержания < &ДвадцатьТретьеДекабря
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002501,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты > &ПятыйСрокПеречисления
		|				ИЛИ НалогиПоДатам.ДатаУдержания >= &ДвадцатьТретьеДекабря
		|			ТОГДА НалогиПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК П000010002601,
		|	0 КАК П000010003001,
		|	0 КАК П000010003101,
		|	0 КАК П000010003201,
		|	0 КАК П000010003301,
		|	0 КАК П000010003401,
		|	0 КАК П000010003501,
		|	0 КАК П000010003601
		|ПОМЕСТИТЬ ВТНалогиПоДатам
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборНеотрицательныхУдержаний КАК ОтборНеотрицательныхУдержаний
		|		ПО НалогиПоДатам.КБК = ОтборНеотрицательныхУдержаний.КБК
		|			И НалогиПоДатам.ФизическоеЛицо = ОтборНеотрицательныхУдержаний.ФизическоеЛицо
		|			И НалогиПоДатам.КрайнийСрокУплаты = ОтборНеотрицательныхУдержаний.КрайнийСрокУплаты
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ШестойСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ЧетвертыйСрокПеречисления
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты = &ПятыйСрокПеречисления
		|				И НалогиПоДатам.ДатаУдержания < &ДвадцатьТретьеДекабря
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НалогиПоДатам.КрайнийСрокУплаты > &ПятыйСрокПеречисления
		|				ИЛИ НалогиПоДатам.ДатаУдержания >= &ДвадцатьТретьеДекабря
		|			ТОГДА НалогиПоДатам.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0
		|ИЗ
		|	ВТНалоги КАК НалогиПоДатам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборНеотрицательныхУдержанийСПревышения КАК ОтборНеотрицательныхУдержаний
		|		ПО НалогиПоДатам.ФизическоеЛицо = ОтборНеотрицательныхУдержаний.ФизическоеЛицо
		|			И (ВЫБОР
		|				КОГДА НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|					ТОГДА &ДивидендыСПревышения
		|				ИНАЧЕ &КБКсПревышения
		|			КОНЕЦ = ОтборНеотрицательныхУдержаний.КБК)
		|			И НалогиПоДатам.КрайнийСрокУплаты = ОтборНеотрицательныхУдержаний.КрайнийСрокУплаты
		|ГДЕ
		|	НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВозвратыПоДатам.КБК,
		|	ВозвратыПоДатам.Регистратор,
		|	ВозвратыПоДатам.ФизическоеЛицо,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0,
		|	0,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты МЕЖДУ &НачалоГода И &ШестойСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ПервыйСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ВторойСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ТретийСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ЧетвертыйСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ПятыйСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВозвратыПоДатам.КрайнийСрокУплаты = &ШестойСрокПеречисления
		|			ТОГДА ВозвратыПоДатам.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ
		|ИЗ
		|	ВТВозвратыПоДатам КАК ВозвратыПоДатам"; 
		Запрос.Выполнить();
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	НалогиПоДатам.КБК КАК КБК,
		|	НалогиПоДатам.Регистратор КАК Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002001), 0) КАК П000010002001,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002101), 0) КАК П000010002101,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002201), 0) КАК П000010002201,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002301), 0) КАК П000010002301,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002401), 0) КАК П000010002401,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002501), 0) КАК П000010002501,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010002601), 0) КАК П000010002601,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003001), 0) КАК П000010003001,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003101), 0) КАК П000010003101,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003201), 0) КАК П000010003201,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003301), 0) КАК П000010003301,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003401), 0) КАК П000010003401,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003501), 0) КАК П000010003501,
		|	ЕСТЬNULL(СУММА(НалогиПоДатам.П000010003601), 0) КАК П000010003601
		|ИЗ
		|	ВТНалогиПоДатам КАК НалогиПоДатам
		|
		|СГРУППИРОВАТЬ ПО
		|	НалогиПоДатам.КБК,
		|	НалогиПоДатам.Регистратор,
		|	НалогиПоДатам.ФизическоеЛицо";
			
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = ЗапросБезПолейРасшифровки(ТекстЗапроса, МассивПолей, "НалогиПоДатам");
		ОписаниеТаблиц.Раздел1НалогиВозвраты = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;

	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги2024") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТФизическиеЛицаОтчета
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДоходовНДФЛ КАК ВидыДоходовНДФЛ
		|		ПО СведенияОДоходахНДФЛ.КодДохода = ВидыДоходовНДФЛ.Ссылка
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В(&РегистрацияВНалоговомОргане)
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (&АУСН)
		|	И ЕСТЬNULL(НЕ ВидыДоходовНДФЛ.НеОблагаетсяУНалоговогоАгента, ИСТИНА)
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	ЕСТЬNULL(ВидыДоходовНДФЛ.СтавкаНалогообложенияРезидента, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)) КАК СтавкаНалогообложенияРезидента
		|ПОМЕСТИТЬ ВТСтрокиДоходов
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДоходовНДФЛ КАК ВидыДоходовНДФЛ
		|		ПО СведенияОДоходахНДФЛ.КодДохода = ВидыДоходовНДФЛ.Ссылка
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ФизическиеЛицаОтчета.ФизическоеЛицо
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (&АУСН)
		|	И ЕСТЬNULL(НЕ ВидыДоходовНДФЛ.НеОблагаетсяУНалоговогоАгента, ИСТИНА)
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	ЕСТЬNULL(ВидыДоходовНДФЛ.СтавкаНалогообложенияРезидента, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13))
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)";
		Запрос.Выполнить();
		
		ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТСтрокиДоходов", "ФизическоеЛицо");
		ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
		ПараметрыПостроения.ВсеЗаписи = Истина;
	    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
			"СтатусыЗастрахованныхФизическихЛиц",
			Запрос.МенеджерВременныхТаблиц,
			Ложь,
			ОписаниеФильтра,
			ПараметрыПостроения);
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиДоходов", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода);
		
		Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", ?(НачалоПериода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.ДатаОбъединенияНалоговыхБаз, Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза(), Перечисления.КатегорииДоходовНДФЛ.ПоОсновнойСтавке()));
		Запрос.УстановитьПараметр("Предел", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел);
		Запрос.УстановитьПараметр("СтавкаСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Ставка);
		Запрос.УстановитьПараметр("СтавкаЧисломСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом * 100);
		Запрос.УстановитьПараметр("ГодПериода", Год(ОкончаниеПериода));
			
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	ЕСТЬNULL(ВидыДоходовНДФЛ.СтавкаНалогообложенияРезидента, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)) КАК СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
		|	ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
		|	КОНЕЦ КАК КодВычета,
		|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета,
		|	СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование,
		|	СведенияОДоходахНДФЛ.УстаревшаяДатаПолученияДохода <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|		И СведенияОДоходахНДФЛ.ДатаПолученияДохода <> СведенияОДоходахНДФЛ.УстаревшаяДатаПолученияДохода КАК ДатаПолученияДоходаПеренесена
		|ПОМЕСТИТЬ ВТДоходыБезСтавок
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДоходовНДФЛ КАК ВидыДоходовНДФЛ
		|		ПО СведенияОДоходахНДФЛ.КодДохода = ВидыДоходовНДФЛ.Ссылка
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ФизическиеЛицаОтчета.ФизическоеЛицо
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ДатаПодписи
		|	И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ИЛИ СведенияОДоходахНДФЛ.Регистратор <> СведенияОДоходахНДФЛ.ДокументОснование)
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И НЕ СведенияОДоходахНДФЛ.КатегорияДохода В (&АУСН)
		|	И ЕСТЬNULL(НЕ ВидыДоходовНДФЛ.НеОблагаетсяУНалоговогоАгента, ИСТИНА)
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|			ИЛИ СведенияОДоходахНДФЛ.СуммаВычета <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист) КАК ЭтоВКС,
		|	ВЫБОР
		|		КОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
		|		ИНАЧЕ СведенияОДоходахНДФЛ.КатегорияДохода
		|	КОНЕЦ КАК НалоговаяБаза,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.Период КАК Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
		|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК КАК КБК,
		|	СведенияОДоходахНДФЛ.ДанныеДляОтчета КАК ДанныеДляОтчета,
		|	СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДоходаПеренесена КАК ДатаПолученияДоходаПеренесена
		|ПОМЕСТИТЬ ВТДоходыПоСтавкам
		|ИЗ
		|	ВТДоходыБезСтавок КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И СведенияОДоходахНДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|		ПО СведенияОДоходахНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
		|			И (СтавкаНДФЛПоСтавкеРезидента.Статус = СоответствиеКатегорийКБК.Статус)
		|ГДЕ
		|	(НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ДистанционныйРаботник)
		|				И СведенияОДоходахНДФЛ.КатегорияДохода В (&ДоходыОтТрудовойДеятельности))
		|
		|СГРУППИРОВАТЬ ПО
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.Период,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.Регистратор,
		|	СведенияОДоходахНДФЛ.Начисление,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
		|	СоответствиеКатегорийКБК.КБК,
		|	СведенияОДоходахНДФЛ.ДанныеДляОтчета,
		|	СведенияОДоходахНДФЛ.КодВычета,
		|	ЕСТЬNULL(СтатусыЗастрахованныхФизическихЛиц.ВидЗастрахованногоЛица, ЗНАЧЕНИЕ(Перечисление.ВидыЗастрахованныхЛицОбязательногоСтрахования.ГражданеРФ)) В (&ВКС)
		|		ИЛИ ЕСТЬNULL(СтавкаНДФЛПоСтавкеРезидента.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ВысококвалифицированныйИностранныйСпециалист),
		|	СведенияОДоходахНДФЛ.ДокументОснование,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДоходаПеренесена
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор КАК Регистратор,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма КАК Сумма,
		|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане) КАК ДанныеДляОтчета
		|ПОМЕСТИТЬ ВТСтандартныеИмущественныеВычеты
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета
		|		ПО ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо = ФизическиеЛицаОтчета.ФизическоеЛицо
		|ГДЕ
		|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоПериода И &ОкончаниеПериода
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ИмущественныеВычетыНДФЛ.Регистратор,
		|	ИмущественныеВычетыНДФЛ.ФизическоеЛицо,
		|	ИмущественныеВычетыНДФЛ.КодВычета,
		|	ИмущественныеВычетыНДФЛ.Сумма,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
		|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане В (&РегистрацияВНалоговомОргане)
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизическиеЛицаОтчета КАК ФизическиеЛицаОтчета
		|		ПО ИмущественныеВычетыНДФЛ.ФизическоеЛицо = ФизическиеЛицаОтчета.ФизическоеЛицо
		|ГДЕ
		|	ИмущественныеВычетыНДФЛ.Период МЕЖДУ &НачалоПредыдущегоГода И &ОкончаниеПериода
		|	И ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|	И ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычетыНДФЛ.Сумма <> 0
		|	И ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ИмущественныеВычетыНДФЛ.Год = &ГодПериода";
		УстановитьПривилегированныйРежим(Истина);
		Запрос.Выполнить();
		УстановитьПривилегированныйРежим(Ложь);
		
		Запрос.Текст =
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
		|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) КАК НалоговаяБаза,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК МесяцНалоговогоПериода
		|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	База.ФизическоеЛицо КАК ФизическоеЛицо,
		|	База.НалоговаяБаза КАК НалоговаяБаза
		|ПОМЕСТИТЬ ВТСотрудникиСПревышением
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
		|		ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
		|		ДоходыПоСтавкам.СуммаДохода - ДоходыПоСтавкам.СуммаВычета КАК ОблагаемаяБаза
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
		|	ГДЕ
		|		ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтандартныеИмущественныеВычеты.ФизическоеЛицо,
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		-СтандартныеИмущественныеВычеты.Сумма
		|	ИЗ
		|		ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты) КАК База
		|
		|СГРУППИРОВАТЬ ПО
		|	База.ФизическоеЛицо,
		|	База.НалоговаяБаза
		|
		|ИМЕЮЩИЕ
		|	СУММА(База.ОблагаемаяБаза) > &Предел";
		
		Если Запрос.Выполнить().Выгрузить()[0].Количество > 0 Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК НачалоМесяца,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза КАК НалоговаяБаза,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) КАК ОблагаемыйДоход,
			|	0 КАК ОблагаемыйДоходСНачалаГода,
			|	ЛОЖЬ КАК ЭтоДеньПревышенияПредела,
			|	ЛОЖЬ КАК ПределПревышен
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.НалоговаяБаза = СотрудникиСПревышением.НалоговаяБаза
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Период,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	Период";
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СУММА(СтандартныеИмущественныеВычеты.Сумма) КАК Сумма,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяца
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК СтандартныеИмущественныеВычеты
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СтандартныеИмущественныеВычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) = СотрудникиСПревышением.НалоговаяБаза)
			|
			|СГРУППИРОВАТЬ ПО
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ)";
			ТаблицаВычетов = Запрос.Выполнить().Выгрузить();
			ИскатьВычеты = ТаблицаВычетов.Количество() > 0;
			Если ИскатьВычеты И ТаблицаВычетов.Количество() > 100 Тогда
				ТаблицаВычетов.Индексы.Добавить("ФизическоеЛицо,НачалоМесяца");
			КонецЕсли;
			ПоискВычетов = Новый Структура("ФизическоеЛицо,НачалоМесяца");
			
			// Расчет облагаемого дохода нарастающим итогом с учетом всех вычетов для каждой даты получения дохода.
			ОблагаемыйДоходСНачалаГода = 0;
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			ТекущееНачалоМесяца = Неопределено;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					ОблагаемыйДоходСНачалаГода = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
					ТекущееНачалоМесяца = Неопределено;
				КонецЕсли;
				// Стандартные, имущественные вычеты учтем один раз за каждый месяц - в первую дату получения дохода месяца.
				ПредоставленныеВычеты = 0;
				Если ИскатьВычеты И СтрокаТаблицы.НалоговаяБаза = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда И ТекущееНачалоМесяца <> СтрокаТаблицы.НачалоМесяца Тогда
					ЗаполнитьЗначенияСвойств(ПоискВычетов, СтрокаТаблицы);
					СтрокиВычетов = ТаблицаВычетов.НайтиСтроки(ПоискВычетов);
					Если СтрокиВычетов.Количество() > 0 Тогда
						ПредоставленныеВычеты = СтрокиВычетов[0].Сумма;
					КонецЕсли;
					ТекущееНачалоМесяца = СтрокаТаблицы.НачалоМесяца;
				КонецЕсли;
				СтрокаТаблицы.ЭтоДеньПревышенияПредела = ОблагаемыйДоходСНачалаГода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел И ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
				ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты;
				СтрокаТаблицы.ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода;
				СтрокаТаблицы.ПределПревышен = ОблагаемыйДоходСНачалаГода > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
			КонецЦикла;
			
			Запрос.УстановитьПараметр("РасчетНарастающимИтогом", ТаблицаРасчетаНарастающимИтогом); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РасчетНарастающимИтогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасчетНарастающимИтогом.Период КАК Период,
			|	РасчетНарастающимИтогом.НалоговаяБаза КАК НалоговаяБаза,
			|	РасчетНарастающимИтогом.ОблагаемыйДоход КАК ОблагаемыйДоход,
			|	РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела КАК ЭтоДеньПревышенияПредела,
			|	РасчетНарастающимИтогом.ПределПревышен КАК ПределПревышен
			|ПОМЕСТИТЬ ВТРасчетНарастающимИтогом
			|ИЗ
			|	&РасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыПоСтавкам.СтавкаНалога КАК СтавкаНалога,
			|	ДоходыПоСтавкам.Ставка КАК Ставка,
			|	ДоходыПоСтавкам.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыПоСтавкам.Регистратор КАК Регистратор,
			|	ДоходыПоСтавкам.ДокументОснование КАК ДокументОснование,
			|	ДоходыПоСтавкам.ДатаПолученияДоходаПеренесена КАК ДатаПолученияДоходаПеренесена,
			|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыПоСтавкам.Начисление КАК Начисление,
			|	ДоходыПоСтавкам.Период КАК Период,
			|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыПоСтавкам.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыПоСтавкам.КБК КАК КБК,
			|	ДоходыПоСтавкам.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыПоСтавкам.КодДохода КАК КодДохода,
			|	ДоходыПоСтавкам.СуммаДохода КАК СуммаДохода,
			|	ДоходыПоСтавкам.КодВычета КАК КодВычета,
			|	ДоходыПоСтавкам.СуммаВычета КАК СуммаВычета,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода, 0) КАК ОблагаемыйДоходСНачалаГода,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела, ЛОЖЬ) КАК ЭтоДеньПревышенияПредела,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ПределПревышен, ЛОЖЬ) КАК ПределПревышен,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоход, 0) КАК ОблагаемыйДоходЗаДень
			|ПОМЕСТИТЬ ВТРасширенныеДанныеОДоходах
			|ИЗ
			|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|		ПО ДоходыПоСтавкам.ФизическоеЛицо = РасчетНарастающимИтогом.ФизическоеЛицо
			|			И ДоходыПоСтавкам.Период = РасчетНарастающимИтогом.Период
			|			И ДоходыПоСтавкам.НалоговаяБаза = РасчетНарастающимИтогом.НалоговаяБаза
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза
			|ПОМЕСТИТЬ ВТФизлицаБезПереносаДат
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза
			|
			|ИМЕЮЩИЕ
			|	МАКСИМУМ(РасширенныеДанныеОДоходах.ДатаПолученияДоходаПеренесена) = ЛОЖЬ И
			|	МИНИМУМ(РасширенныеДанныеОДоходах.ДанныеДляОтчета) = ЛОЖЬ И
			|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ РасширенныеДанныеОДоходах.ДокументОснование) > 1
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаБезПереносаДат.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ФизлицаБезПереносаДат.Период КАК Период,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.ДокументОснование КАК ДокументОснование,
			|	ФизлицаБезПереносаДат.НалоговаяБаза КАК НалоговаяБаза
			|ПОМЕСТИТЬ ВТОтборОснований
			|ИЗ
			|	ВТФизлицаБезПереносаДат КАК ФизлицаБезПереносаДат
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|		ПО ФизлицаБезПереносаДат.ФизическоеЛицо = РасширенныеДанныеОДоходах.ФизическоеЛицо
			|			И ФизлицаБезПереносаДат.НалоговаяБаза = РасширенныеДанныеОДоходах.НалоговаяБаза
			|			И ФизлицаБезПереносаДат.Период = РасширенныеДанныеОДоходах.Период
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ОтборОснований.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОтборОснований.Период КАК ДатаПолученияДохода,
			|	ОтборОснований.НалоговаяБаза КАК НалоговаяБаза,
			|	ОтборОснований.ДокументОснование КАК ДокументОснование,
			|	ВЫБОР
			|		КОГДА СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) <> 0
			|				И СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) = 0
			|			ТОГДА 1
			|		КОГДА СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) <> 0
			|				И СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) = 0
			|			ТОГДА 2
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК ОписаниеДокумента
			|ПОМЕСТИТЬ ВТОснованияВДниПревышения
			|ИЗ
			|	ВТОтборОснований КАК ОтборОснований
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
			|		ПО ОтборОснований.ФизическоеЛицо = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо
			|			И ОтборОснований.КатегорияДохода = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода
			|			И ОтборОснований.Период = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода
			|			И ОтборОснований.ДокументОснование = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование
			|ГДЕ
			|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
			|
			|СГРУППИРОВАТЬ ПО
			|	ОтборОснований.ФизическоеЛицо,
			|	ОтборОснований.Период,
			|	ОтборОснований.НалоговаяБаза,
			|	ОтборОснований.ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.СтавкаНалога КАК СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.КБК КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода) КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаВычета) КАК СуммаВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода - РасширенныеДанныеОДоходах.СуммаВычета) КАК ОблагаемаяСумма,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень КАК ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.ДокументОснование КАК ДокументОснование,
			|	ЕСТЬNULL(ОснованияВДниПревышения.ОписаниеДокумента, 0) КАК ОписаниеДокументаСПревышением
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияВДниПревышения КАК ОснованияВДниПревышения
			|		ПО РасширенныеДанныеОДоходах.ФизическоеЛицо = ОснованияВДниПревышения.ФизическоеЛицо
			|			И РасширенныеДанныеОДоходах.НалоговаяБаза = ОснованияВДниПревышения.НалоговаяБаза
			|			И РасширенныеДанныеОДоходах.ДокументОснование = ОснованияВДниПревышения.ДокументОснование
			|			И РасширенныеДанныеОДоходах.Период = ОснованияВДниПревышения.ДатаПолученияДохода
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.СтавкаНалога,
			|	РасширенныеДанныеОДоходах.Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление,
			|	РасширенныеДанныеОДоходах.Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода,
			|	РасширенныеДанныеОДоходах.КБК,
			|	РасширенныеДанныеОДоходах.КодДохода,
			|	РасширенныеДанныеОДоходах.КодВычета,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.ЭтоВКС,
			|	РасширенныеДанныеОДоходах.ДокументОснование,
			|	ЕСТЬNULL(ОснованияВДниПревышения.ОписаниеДокумента, 0)
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	ОписаниеДокументаСПревышением,
			|	КодДохода";
			
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			ДоходыСУточненнымиСтавками = ТаблицаРасчетаНарастающимИтогом.СкопироватьКолонки();
			
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			СтрокиРаспределения = Новый Массив;
			ОблагаемыйДоходДоПредела = 0;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					Если ОблагаемыйДоходДоПредела <> 0 Тогда
						ВыделитьСуммыПревышенияПредела2024(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
					КонецЕсли;
					СтрокиРаспределения.Очистить();
					ОблагаемыйДоходДоПредела = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
				КонецЕсли;
				Если ОблагаемыйДоходДоПредела = 0 Тогда
					ОблагаемыйДоходДоПредела = СтрокаТаблицы.ОблагаемыйДоходЗаДень - СтрокаТаблицы.ОблагаемыйДоходСНачалаГода + ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел
				КонецЕсли;
				СтрокиРаспределения.Добавить(СтрокаТаблицы);
			КонецЦикла;
			Если ОблагаемыйДоходДоПредела <> 0 Тогда
				ВыделитьСуммыПревышенияПредела2024(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
			КонецЕсли;
			
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРасчетаНарастающимИтогом, ДоходыСУточненнымиСтавками); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			
			Запрос.УстановитьПараметр("ДоходыСУточненнымиСтавками", ДоходыСУточненнымиСтавками); ДоходыСУточненнымиСтавками = Неопределено;
			Запрос.Текст =
			"УНИЧТОЖИТЬ ВТДоходыПоСтавкам
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.ОписаниеДокументаСПревышением = 2
			|			ТОГДА &СтавкаЧисломСПревышения
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.СтавкаНалога
			|	КОНЕЦ КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.ОписаниеДокументаСПревышением = 2
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.Ставка
			|	КОНЕЦ КАК Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС КАК ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор КАК Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление КАК Начисление,
			|	ДоходыСУточненнымиСтавками.Период КАК Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода КАК КатегорияДохода,
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.ОписаниеДокументаСПревышением = 1
			|			ТОГДА ДоходыСУточненнымиСтавками.КБК
			|		КОГДА ДоходыСУточненнымиСтавками.ОписаниеДокументаСПревышением = 2
			|			ТОГДА ВЫБОР
			|					КОГДА ДоходыСУточненнымиСтавками.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|						ТОГДА &ДивидендыСПревышения
			|					ИНАЧЕ &КБКсПревышения
			|				КОНЕЦ
			|		КОГДА ДоходыСУточненнымиСтавками.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|			ТОГДА ВЫБОР
			|					КОГДА ДоходыСУточненнымиСтавками.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|						ТОГДА &ДивидендыСПревышения
			|					ИНАЧЕ &КБКсПревышения
			|				КОНЕЦ
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.КБК
			|	КОНЕЦ КАК КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода КАК КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода КАК СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета КАК КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыСУточненнымиСтавками
			|ИЗ
			|	&ДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаЧисломСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.СтавкаНалога
			|	КОНЕЦ КАК СтавкаНалога,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.Ставка
			|	КОНЕЦ КАК Ставка,
			|	РасширенныеДанныеОДоходах.ЭтоВКС КАК ЭтоВКС,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Начисление КАК Начисление,
			|	РасширенныеДанныеОДоходах.Период КАК Период,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА ВЫБОР
			|					КОГДА РасширенныеДанныеОДоходах.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|						ТОГДА &ДивидендыСПревышения
			|					ИНАЧЕ &КБКсПревышения
			|				КОНЕЦ
			|		ИНАЧЕ РасширенныеДанныеОДоходах.КБК
			|	КОНЕЦ КАК КБК,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	РасширенныеДанныеОДоходах.СуммаДохода КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	РасширенныеДанныеОДоходах.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыПоСтавкам
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	НЕ РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.СтавкаНалога,
			|	ДоходыСУточненнымиСтавками.Ставка,
			|	ДоходыСУточненнымиСтавками.ЭтоВКС,
			|	ДоходыСУточненнымиСтавками.Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Начисление,
			|	ДоходыСУточненнымиСтавками.Период,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.КБК,
			|	ДоходыСУточненнымиСтавками.КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета
			|ИЗ
			|	ВТДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками";
			Запрос.Выполнить();
			
			Если ИскатьВычеты Тогда
				Запрос.Текст =
				"УНИЧТОЖИТЬ ВТМесяцыПослеПревышения
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыУникальныхКБК
				|ИЗ
				|	ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|ГДЕ
				|	ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
				|	И ДоходыПоСтавкам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
				|
				|СГРУППИРОВАТЬ ПО
				|	ДоходыПоСтавкам.НалоговаяБаза,
				|	ДоходыПоСтавкам.ФизическоеЛицо,
				|	НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ)
				|
				|ИМЕЮЩИЕ
				|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДоходыПоСтавкам.КБК) = 1
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	МесяцыУникальныхКБК.ФизическоеЛицо КАК ФизическоеЛицо,
				|	МесяцыУникальныхКБК.НалоговаяБаза КАК НалоговаяБаза,
				|	МесяцыУникальныхКБК.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
				|ИЗ
				|	ВТМесяцыУникальныхКБК КАК МесяцыУникальныхКБК
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоСтавкам КАК ДоходыПоСтавкам
				|		ПО МесяцыУникальныхКБК.ФизическоеЛицо = ДоходыПоСтавкам.ФизическоеЛицо
				|			И МесяцыУникальныхКБК.НалоговаяБаза = ДоходыПоСтавкам.НалоговаяБаза
				|			И (МесяцыУникальныхКБК.МесяцНалоговогоПериода = НАЧАЛОПЕРИОДА(ДоходыПоСтавкам.Период, МЕСЯЦ))
				|ГДЕ
				|	ДоходыПоСтавкам.КБК = &КБКсПревышения";
				Запрос.Выполнить();
			КонецЕсли;
			
		КонецЕсли;
		
		Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Или ОписаниеТаблиц.Свойство("Раздел2Налоги2024") Или ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.ЭтоВКС КАК ЭтоВКС,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
			|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
			|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода
			|ПОМЕСТИТЬ ВТДоходыДляОтчета
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.ДанныеДляОтчета";
			Результат = Запрос.Выполнить();
		КонецЕсли;
			
		Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.КБК КАК КБК,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
			|	СведенияОДоходахНДФЛ.СтавкаНалога КАК СтавкаНалога,
			|	СведенияОДоходахНДФЛ.Ставка КАК Ставка,
			|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТВычетыПоСтавкам
			|ИЗ
			|	ВТДоходыПоСтавкам КАК СведенияОДоходахНДФЛ
			|ГДЕ
			|	СведенияОДоходахНДФЛ.СуммаВычета <> 0
			|	И СведенияОДоходахНДФЛ.ДанныеДляОтчета
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА &ОсновнойКБК
			|		ИНАЧЕ &КБКсПревышения
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА 13
			|		ИНАЧЕ 15
			|	КОНЕЦ,
			|	ВЫБОР
			|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
			|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
			|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
			|	КОНЕЦ,
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма
			|ИЗ
			|	ВТСтандартныеИмущественныеВычеты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМесяцыПослеПревышения КАК СотрудникиСПревышением
			|		ПО ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода = СотрудникиСПревышением.МесяцНалоговогоПериода
			|			И (СотрудникиСПревышением.НалоговаяБаза = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда))
			|ГДЕ
			|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ДанныеДляОтчета";
			Запрос.Выполнить();
		КонецЕсли;
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("КоличествоПолучателейДохода") Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СУММА(ДанныеОКоличествах.ВсегоПолучателей) КАК П000020011003,
		|	СУММА(ДанныеОКоличествах.ВсегоВКС) КАК П000020011103,
		|	ДанныеОКоличествах.Ставка КАК Ставка,
		|	ДанныеОКоличествах.КБК КАК КБК
		|ИЗ
		|	(ВЫБРАТЬ
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0) КАК ВсегоПолучателей,
		|		0 КАК ВсегоВКС,
		|		СведенияОДоходахНДФЛ.Ставка КАК Ставка,
		|		СведенияОДоходахНДФЛ.КБК КАК КБК
		|	ИЗ
		|		ВТДоходыДляОтчета КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		0,
		|		ЕСТЬNULL(КОЛИЧЕСТВО(РАЗЛИЧНЫЕ СведенияОДоходахНДФЛ.ФизическоеЛицо), 0),
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК
		|	ИЗ
		|		ВТДоходыДляОтчета КАК СведенияОДоходахНДФЛ
		|	ГДЕ
		|		СведенияОДоходахНДФЛ.СуммаДохода <> 0
		|		И СведенияОДоходахНДФЛ.ЭтоВКС
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СведенияОДоходахНДФЛ.Ставка,
		|		СведенияОДоходахНДФЛ.КБК) КАК ДанныеОКоличествах
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеОКоличествах.Ставка,
		|	ДанныеОКоличествах.КБК";
		
		ОписаниеТаблиц.КоличествоПолучателейДохода = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Доходы") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодДохода КАК КодДохода,
		|	СведенияОДоходах.Начисление КАК Начисление,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000020012003,
		|	СУММА(ВЫБОР
		|			КОГДА СведенияОДоходах.ЭтоВКС
		|				ТОГДА СведенияОДоходах.СуммаДохода
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020012103
		|ИЗ
		|	ВТДоходыДляОтчета КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.КодДохода,
		|	СведенияОДоходах.Начисление,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодДохода");
			МассивПолей.Добавить("Начисление");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = ЗапросБезПолейРасшифровки(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Доходы = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Вычеты") Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СведенияОДоходах.Ставка КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета КАК КодВычета,
		|	СведенияОДоходах.Регистратор КАК Регистратор,
		|	СведенияОДоходах.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000020013003
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.Ставка,
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КодВычета,
		|	СведенияОДоходах.Регистратор,
		|	СведенияОДоходах.СтавкаНалога";
		
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("КодВычета");
			МассивПолей.Добавить("Регистратор");
		КонецЕсли;
		Запрос.Текст = ЗапросБезПолейРасшифровки(ТекстЗапроса, МассивПолей);
		ОписаниеТаблиц.Раздел2Вычеты = Запрос.Выполнить().Выгрузить()
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги2024") Или ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		НачалоОтчетногоКвартала = НачалоКвартала(ОкончаниеПериода);
		Запрос.УстановитьПараметр("ПервыйПериодС", НачалоОтчетногоКвартала);
		Запрос.УстановитьПараметр("ПервыйПериодПо", НачалоОтчетногоКвартала + 21 * 86400);
		Запрос.УстановитьПараметр("ВторойПериодС", НачалоОтчетногоКвартала + 22 * 86400);
		Запрос.УстановитьПараметр("ВторойПериодПо", КонецМесяца(НачалоОтчетногоКвартала));
		Запрос.УстановитьПараметр("ТретийПериодС", ДобавитьМесяц(НачалоОтчетногоКвартала, 1));
		Запрос.УстановитьПараметр("ТретийПериодПо", ДобавитьМесяц(НачалоОтчетногоКвартала, 1) + 21 * 86400);
		Запрос.УстановитьПараметр("ЧетвертыйПериодС", ДобавитьМесяц(НачалоОтчетногоКвартала, 1) + 22 * 86400);
		Запрос.УстановитьПараметр("ЧетвертыйПериодПо", КонецМесяца(ДобавитьМесяц(НачалоОтчетногоКвартала, 1)));
		Запрос.УстановитьПараметр("ПятыйПериодС", НачалоМесяца(ОкончаниеПериода));
		Запрос.УстановитьПараметр("ПятыйПериодПо", НачалоМесяца(ОкончаниеПериода) + 21 * 86400);
		Запрос.УстановитьПараметр("ШестойПериодС", НачалоМесяца(ОкончаниеПериода) + 22 * 86400);
		Запрос.УстановитьПараметр("ШестойПериодПо", ОкончаниеПериода);

		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТНалоги", "УчитыватьИзмененияСтатусаДляОтчетности", ОкончаниеПериода, "ВТСтавкаНДФЛПоНалогам");
		
		Если Не ЗарплатаКадры.ВТСуществует(Запрос.МенеджерВременныхТаблиц, "ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних") Тогда
			ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТНалоги", "ФизическоеЛицо");
			ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
			ПараметрыПостроения.ВсеЗаписи = Истина;
		    ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "РегистрСведений.ДатаРегистрацииИзменений", "<=", "ДАТАВРЕМЯ(" + Формат(ДатаАктуальности,"ДФ=гггг") + ", " + Месяц(ДатаАктуальности) + ", " + День(ДатаАктуальности) + ", 23, 59, 59)", Ложь);
			ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
				"СтатусыЗастрахованныхФизическихЛиц",
				Запрос.МенеджерВременныхТаблиц,
				Ложь,
				ОписаниеФильтра,
				ПараметрыПостроения);
		КонецЕсли;
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходах.Период КАК Период,
		|	МАКСИМУМ(СведенияОДоходах.ЭтоВКС) КАК ЭтоВКС
		|ПОМЕСТИТЬ ВТСведенияВКС
		|ИЗ
		|	ВТДоходыДляОтчета КАК СведенияОДоходах
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.ФизическоеЛицо,
		|	СведенияОДоходах.КатегорияДохода,
		|	СведенияОДоходах.Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛ.КБК КАК КБК,
		|	НДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом * 100 КАК СтавкаНалога,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Начислено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НачисленоПоДивидендам,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ЗачтеноАвансов,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Удержано,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Передано,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.СуммаСПревышения = 0
		|			ТОГДА НДФЛ.СуммаДоходаСКоторогоНеУдержанНалог
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СуммаДоходаСКоторогоНеУдержанНалог,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК УдержаноЗаНалоговыйПериод,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогДляДивидендов = 0
		|						ТОГДА НДФЛ.Сумма
		|					КОГДА ВЫБОР
		|							КОГДА НДФЛ.НалогДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|								ТОГДА ВЫБОР
		|										КОГДА НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|														ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|											ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|										ИНАЧЕ 0
		|									КОНЕЦ
		|							ИНАЧЕ НДФЛ.НалогДляДивидендов
		|						КОНЕЦ * НДФЛ.Сумма > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.Сумма > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.Сумма - ВЫБОР
		|													КОГДА НДФЛ.НалогДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА ВЫБОР
		|																			КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																				ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|																			ИНАЧЕ 0
		|																		КОНЕЦ
		|																КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																	ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													ИНАЧЕ НДФЛ.НалогДляДивидендов
		|												КОНЕЦ > 0
		|												ТОГДА НДФЛ.Сумма - ВЫБОР
		|														КОГДА НДФЛ.НалогДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА ВЫБОР
		|																				КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																					ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|																				ИНАЧЕ 0
		|																			КОНЕЦ
		|																	КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|																		ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														ИНАЧЕ НДФЛ.НалогДляДивидендов
		|													КОНЕЦ
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.Сумма - ВЫБОР
		|										КОГДА НДФЛ.НалогДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|											ТОГДА ВЫБОР
		|													КОГДА НДФЛ.СуммаСПревышения > 0
		|														ТОГДА ВЫБОР
		|																КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																	ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|																ИНАЧЕ 0
		|															КОНЕЦ
		|													КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|														ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|													ИНАЧЕ 0
		|												КОНЕЦ
		|										ИНАЧЕ НДФЛ.НалогДляДивидендов
		|									КОНЕЦ < 0
		|									ТОГДА НДФЛ.Сумма - ВЫБОР
		|											КОГДА НДФЛ.НалогДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|												ТОГДА ВЫБОР
		|														КОГДА НДФЛ.СуммаСПревышения > 0
		|															ТОГДА ВЫБОР
		|																	КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения > 0
		|																		ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|																	ИНАЧЕ 0
		|																КОНЕЦ
		|														КОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения < 0
		|															ТОГДА НДФЛ.НалогДляДивидендов - НДФЛ.СуммаСПревышения
		|														ИНАЧЕ 0
		|													КОНЕЦ
		|											ИНАЧЕ НДФЛ.НалогДляДивидендов
		|										КОНЕЦ
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.Сумма
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Сальдо,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.Сумма
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Возвращено,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.Сумма > 0
		|			ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов - ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|									ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|								ИНАЧЕ НДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогСДивидендовУплаченныйЗаРубежом * НДФЛ.Сумма > 0
		|			ТОГДА НДФЛ.НалогСДивидендовУплаченныйЗаРубежом - ВЫБОР
		|					КОГДА НДФЛ.НалогСДивидендовУплаченныйЗаРубежом * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.НалогСДивидендовУплаченныйЗаРубежом * НДФЛ.НалогСДивидендовУплаченныйЗаРубежом < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|									ТОГДА НДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|								ИНАЧЕ НДФЛ.СуммаСПревышения
		|							КОНЕЦ
		|					ИНАЧЕ 0
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК НалогСДивидендовУплаченныйЗаРубежом,
		|	НДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	НДФЛ.ДатаУдержания КАК ДатаУдержания,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|			ТОГДА ГОД(НДФЛ.ДатаУдержания)
		|		ИНАЧЕ ГОД(НДФЛ.ДатаПолученияДохода)
		|	КОНЕЦ КАК НалоговыйПериод
		|ПОМЕСТИТЬ ВТНалогиПоСтавкам
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.Сумма <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|			ТОГДА &ДивидендыСПревышения
		|		ИНАЧЕ &КБКсПревышения
		|	КОНЕЦ,
		|	НДФЛ.ФизическоеЛицо,
		|	15,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15),
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
		|					ИЛИ НДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
		|						И НДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09))
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.СуммаСПревышения > 0
		|			ТОГДА НДФЛ.СуммаДоходаСКоторогоНеУдержанНалог
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогДляДивидендов = 0
		|						ТОГДА НДФЛ.СуммаСПревышения
		|					КОГДА НДФЛ.НалогДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|						ТОГДА ВЫБОР
		|								КОГДА НДФЛ.СуммаСПревышения > 0
		|									ТОГДА ВЫБОР
		|											КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогДляДивидендов > 0
		|												ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогДляДивидендов
		|											ИНАЧЕ 0
		|										КОНЕЦ
		|								КОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогДляДивидендов < 0
		|									ТОГДА НДФЛ.СуммаСПревышения - НДФЛ.НалогДляДивидендов
		|								ИНАЧЕ 0
		|							КОНЕЦ
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		КОГДА (НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				ИЛИ НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей))
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
		|				И (НДФЛ.ДатаУдержания МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|			ТОГДА -НДФЛ.СуммаСПревышения
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.СуммаСПревышения > 0
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогНаПрибыльДляДивидендов * НДФЛ.НалогНаПрибыльДляДивидендов < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|						ТОГДА НДФЛ.НалогНаПрибыльДляДивидендов
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И (НДФЛ.ДатаПолученияДохода МЕЖДУ &НачалоПериода И &ОкончаниеПериода)
		|				И (НДФЛ.ДатаУдержания <= &ОкончаниеПериодаОсмотраДоходовВычетов
		|					ИЛИ НДФЛ.Регистратор <> НДФЛ.ДокументОснование)
		|				И НДФЛ.НалогСДивидендовУплаченныйЗаРубежом * НДФЛ.СуммаСПревышения > 0
		|			ТОГДА ВЫБОР
		|					КОГДА НДФЛ.НалогСДивидендовУплаченныйЗаРубежом * НДФЛ.НалогСДивидендовУплаченныйЗаРубежом < НДФЛ.СуммаСПревышения * НДФЛ.СуммаСПревышения
		|						ТОГДА НДФЛ.НалогСДивидендовУплаченныйЗаРубежом
		|					ИНАЧЕ НДФЛ.СуммаСПревышения
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ,
		|	НДФЛ.КатегорияДохода,
		|	НДФЛ.ДатаПолученияДохода,
		|	НДФЛ.ДатаУдержания,
		|	ВЫБОР
		|		КОГДА НДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|			ТОГДА ГОД(НДФЛ.ДатаУдержания)
		|		ИНАЧЕ ГОД(НДФЛ.ДатаПолученияДохода)
		|	КОНЕЦ
		|ИЗ
		|	ВТНалоги КАК НДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних КАК СтатусыЗастрахованныхФизическихЛиц
		|		ПО НДФЛ.ФизическоеЛицо = СтатусыЗастрахованныхФизическихЛиц.ФизическоеЛицо
		|			И НДФЛ.Период = СтатусыЗастрахованныхФизическихЛиц.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоНалогам КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛ.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛ.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛ.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛ.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	НДФЛ.СуммаСПревышения <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Сальдо) КАК НеУдержано,
		|	Налоги.КБК КАК КБК
		|ПОМЕСТИТЬ ВТНеУдержано
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.КБК КАК КБК,
		|	-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|ПОМЕСТИТЬ ВТИзлишнеУдержаноПоКБК
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.КБК
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.Сальдо) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	СУММА(Налоги.Начислено) КАК Начислено,
		|	СУММА(Налоги.НачисленоПоДивидендам) КАК НачисленоПоДивидендам,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК НалогНаПрибыльДляДивидендов,
		|	СУММА(Налоги.НалогСДивидендовУплаченныйЗаРубежом) КАК НалогСДивидендовУплаченныйЗаРубежом,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК ЗачтеноАвансов,
		|	СУММА(Налоги.Удержано) КАК Удержано,
		|	СУММА(Налоги.УдержаноЗаНалоговыйПериод) КАК УдержаноЗаНалоговыйПериод,
		|	СУММА(Налоги.Возвращено) КАК Возвращено,
		|	СУММА(Налоги.Передано) КАК Передано,
		|	СУММА(Налоги.СуммаДоходаСКоторогоНеУдержанНалог) КАК СуммаДоходаСКоторогоНеУдержанНалог,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ПервыйПериодС И &ПервыйПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВПервыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ВторойПериодС И &ВторойПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВоВторойПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ТретийПериодС И &ТретийПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВТретийПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ЧетвертыйПериодС И &ЧетвертыйПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВЧетвертыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ПятыйПериодС И &ПятыйПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВПятыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ШестойПериодС И &ШестойПериодПо
		|				ТОГДА Налоги.Удержано
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК УдержаноВШестойПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ПервыйПериодС И &ПервыйПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВПервыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ВторойПериодС И &ВторойПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВоВторойПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ТретийПериодС И &ТретийПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВТретийПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ЧетвертыйПериодС И &ЧетвертыйПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВЧетвертыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ПятыйПериодС И &ПятыйПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВПятыйПериод,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ДатаУдержания МЕЖДУ &ШестойПериодС И &ШестойПериодПо
		|				ТОГДА Налоги.Возвращено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвращеноВШестойПериод,
		|	ЕСТЬNULL(МАКСИМУМ(ПоФизлицам.НеУдержано), 0) КАК НеУдержано,
		|	ЕСТЬNULL(МАКСИМУМ(ИзлишнеУдержаноПоКБК.ИзлишнеУдержано), 0) КАК ИзлишнеУдержано,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ) КАК ЭтоВКС,
		|	Налоги.НалоговыйПериод КАК НалоговыйПериод
		|ПОМЕСТИТЬ ВТДанныеПоФизлицам
		|ИЗ
		|	ВТНалогиПоСтавкам КАК Налоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияВКС КАК СведенияВКС
		|		ПО Налоги.ФизическоеЛицо = СведенияВКС.ФизическоеЛицо
		|			И Налоги.КатегорияДохода = СведенияВКС.КатегорияДохода
		|			И Налоги.ДатаПолученияДохода = СведенияВКС.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНеУдержано КАК ПоФизлицам
		|		ПО Налоги.ФизическоеЛицо = ПоФизлицам.ФизическоеЛицо
		|			И Налоги.СтавкаНалога = ПоФизлицам.СтавкаНалога
		|			И Налоги.КБК = ПоФизлицам.КБК
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИзлишнеУдержаноПоКБК КАК ИзлишнеУдержаноПоКБК
		|		ПО Налоги.ФизическоеЛицо = ИзлишнеУдержаноПоКБК.ФизическоеЛицо
		|			И Налоги.КБК = ИзлишнеУдержаноПоКБК.КБК
		|			И Налоги.СтавкаНалога = ИзлишнеУдержаноПоКБК.СтавкаНалога
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0
		|			ИЛИ Налоги.Возвращено <> 0
		|			ИЛИ Налоги.Передано <> 0
		|			ИЛИ ИзлишнеУдержаноПоКБК.ИзлишнеУдержано <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо,
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	ЕСТЬNULL(СведенияВКС.ЭтоВКС, ЛОЖЬ),
		|	Налоги.НалоговыйПериод";
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Раздел2Налоги2024") Тогда
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Налоги.НалоговыйПериод КАК НалоговыйПериод,
		|	СУММА(Налоги.Начислено) КАК П000020014003,
		|	СУММА(ВЫБОР
		|			КОГДА Налоги.ЭтоВКС
		|				ТОГДА Налоги.Начислено
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК П000020014103,
		|	СУММА(Налоги.ЗачтеноАвансов) КАК П000020015003,
		|	СУММА(Налоги.НалогНаПрибыльДляДивидендов) КАК П000020015503,
		|	СУММА(Налоги.НалогСДивидендовУплаченныйЗаРубежом) КАК П000020015603,
		|	СУММА(Налоги.Удержано) КАК П000020016003,
		|	СУММА(Налоги.УдержаноВПервыйПериод) КАК П000020016103,
		|	СУММА(Налоги.УдержаноВоВторойПериод) КАК П000020016203,
		|	СУММА(Налоги.УдержаноВТретийПериод) КАК П000020016303,
		|	СУММА(Налоги.УдержаноВЧетвертыйПериод) КАК П000020016403,
		|	СУММА(Налоги.УдержаноВПятыйПериод) КАК П000020016503,
		|	СУММА(Налоги.УдержаноВШестойПериод) КАК П000020016603,
		|	СУММА(Налоги.НеУдержано) КАК П000020017003,
		|	СУММА(Налоги.ИзлишнеУдержано) КАК П000020018003,
		|	СУММА(Налоги.Возвращено) КАК П000020019003,
		|	СУММА(Налоги.ВозвращеноВПервыйПериод) КАК П000020019103,
		|	СУММА(Налоги.ВозвращеноВоВторойПериод) КАК П000020019203,
		|	СУММА(Налоги.ВозвращеноВТретийПериод) КАК П000020019303,
		|	СУММА(Налоги.ВозвращеноВЧетвертыйПериод) КАК П000020019403,
		|	СУММА(Налоги.ВозвращеноВПятыйПериод) КАК П000020019503,
		|	СУММА(Налоги.ВозвращеноВШестойПериод) КАК П000020019603,
		|	Налоги.СтавкаНалога КАК СтавкаНалога,
		|	Налоги.Ставка КАК Ставка,
		|	Налоги.КБК КАК КБК
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	(Налоги.Начислено <> 0
		|			ИЛИ Налоги.ЗачтеноАвансов <> 0
		|			ИЛИ Налоги.Удержано <> 0
		|			ИЛИ Налоги.Возвращено <> 0)
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.НалоговыйПериод,
		|	Налоги.СтавкаНалога,
		|	Налоги.Ставка,
		|	Налоги.КБК,
		|	Налоги.ФизическоеЛицо";
		МассивПолей = Новый Массив;
		Если Не ПодробныеДанные Тогда
			МассивПолей.Добавить("ФизическоеЛицо");
			МассивПолей.Добавить("НалоговыйПериод");
		КонецЕсли;
		Запрос.Текст = ЗапросБезПолейРасшифровки(ТекстЗапроса, МассивПолей, "Налоги");
		ОписаниеТаблиц.Раздел2Налоги2024 = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	Если ОписаниеТаблиц.Свойство("Приложение1Налогоплательщики") Тогда
		
		НеобходимыеКадровыеДанные = Новый Массив();
		НеобходимыеКадровыеДанные.Добавить("ФизическоеЛицо");
		НеобходимыеКадровыеДанные.Добавить("ИНН");
		НеобходимыеКадровыеДанные.Добавить("Наименование");
		НеобходимыеКадровыеДанные.Добавить("Фамилия");
		НеобходимыеКадровыеДанные.Добавить("Имя");
		НеобходимыеКадровыеДанные.Добавить("Отчество");
		НеобходимыеКадровыеДанные.Добавить("СтатусНалогоплательщика");
		НеобходимыеКадровыеДанные.Добавить("ВидЗастрахованногоЛица");
		НеобходимыеКадровыеДанные.Добавить("ДатаРождения");	
		НеобходимыеКадровыеДанные.Добавить("ДокументВид");
		НеобходимыеКадровыеДанные.Добавить("ДокументСерия");
		НеобходимыеКадровыеДанные.Добавить("ДокументНомер");
		НеобходимыеКадровыеДанные.Добавить("ДокументСтранаВыдачи");
		НеобходимыеКадровыеДанные.Добавить("Страна");
		
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДоходыДляОтчета КАК СведенияОДоходах";
		ЗарплатаКадры.УничтожитьВТ(Запрос.МенеджерВременныхТаблиц,"ВТСтатусыЗастрахованныхФизическихЛицСрезПоследних", Истина);
		КадровыйУчет.СоздатьНаДатуВТКадровыеДанныеФизическихЛиц(Запрос.МенеджерВременныхТаблиц, Истина, Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НеобходимыеКадровыеДанные, ДатаАктуальности);
		
		// Для корректирующей и отменяющей формы прочитаем переданные в предыдущих отчетах данные.
		Если НомерКорректировки > 0 Тогда
			ФормироватьПустыеДанные = ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив") И РегистрацияВНалоговомОргане.Количество() = 0;
			Если ФормироватьПустыеДанные Тогда
				СоздатьПустыеВТПереданныхДанныхОтчета2024(Запрос.МенеджерВременныхТаблиц)
			Иначе 
				РеквизитыРегистрации = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(?(ТипЗнч(РегистрацияВНалоговомОргане) = Тип("Массив"), РегистрацияВНалоговомОргане[0], РегистрацияВНалоговомОргане), "КодПоОКТМО,КПП");
				ПолучитьПереданныеДанныеОтчета2024(Организация, СокрЛП(РеквизитыРегистрации.КодПоОКТМО), СокрЛП(РеквизитыРегистрации.КПП), ОкончаниеПериода, Запрос.МенеджерВременныхТаблиц, НомерКорректировки, "ФормаОтчета2024Кв2");
			КонецЕсли;
		КонецЕсли;
		
		// Для отменяющей формы нужен только перечень переданных справок.
		Если НомерКорректировки = 99 Тогда
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.НомерСправки КАК НомерСправки,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Фамилия + "" "" + КадровыеДанныеФизЛиц.Имя + "" "" + КадровыеДанныеФизЛиц.Отчество КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			Возврат
		КонецЕсли;
		
		// Для исходной и корректирующей форм соберем текущие данные.
		УчетНДФЛ.СоздатьВТСтавкиНалогаЧислом(Запрос.МенеджерВременныхТаблиц);
		Запрос.Текст =
		"ВЫБРАТЬ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТУплатившиеАвансыПоНалогу
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|
		|СГРУППИРОВАТЬ ПО
		|	Налоги.ФизическоеЛицо
		|
		|ИМЕЮЩИЕ
		|	СУММА(Налоги.ЗачтеноАвансов) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
		|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
		|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
		|	КадровыеДанныеФизЛиц.Имя КАК Имя,
		|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
		|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """") КАК СерияДокумента,
		|	ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """") КАК НомерДокумента,
		|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|			ТОГДА ВЫБОР
		|					КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
		|						ТОГДА ""643""
		|					ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
		|				КОНЕЦ
		|		ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
		|	КОНЕЦ КАК КодСтраныДляОтчетности,
		|	ВЫБОР
		|		КОГДА КадровыеДанныеФизЛиц.ВидЗастрахованногоЛица В (&ВКС)
		|				И КадровыеДанныеФизЛиц.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ТОГДА ""7""
		|		КОГДА УплатившиеАвансыПоНалогу.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И КадровыеДанныеФизЛиц.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ТОГДА ""6""
		|		ИНАЧЕ ЕСТЬNULL(СтатусыНалогоплательщиковПоНДФЛ.КодФНС_2015, """")
		|	КОНЕЦ КАК КодФНС,
		|	ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """") КАК КодМВД
		|ПОМЕСТИТЬ ВТФизлицаПоТекущимДанным
		|ИЗ
		|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
		|		ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтатусыНалогоплательщиковПоНДФЛ КАК СтатусыНалогоплательщиковПоНДФЛ
		|		ПО КадровыеДанныеФизЛиц.СтатусНалогоплательщика = СтатусыНалогоплательщиковПоНДФЛ.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУплатившиеАвансыПоНалогу КАК УплатившиеАвансыПоНалогу
		|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = УплатившиеАвансыПоНалогу.ФизическоеЛицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ДанныеИтогов.Ставка КАК Ставка,
		|	ДанныеИтогов.КБК КАК КБК,
		|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
		|	СУММА(ДанныеИтогов.П000П1М100002) КАК П000П1М100002,
		|	СУММА(ДанныеИтогов.П000П1М100003) КАК П000П1М100003,
		|	СУММА(ДанныеИтогов.П000П1М100004) КАК П000П1М100004,
		|	СУММА(ДанныеИтогов.П000П1М100005) КАК П000П1М100005,
		|	СУММА(ДанныеИтогов.П000П1М100006) КАК П000П1М100006,
		|	СУММА(ДанныеИтогов.П000П1М100008) КАК П000П1М100008,
		|	СУММА(ДанныеИтогов.П000П1М400001) КАК П000П1М400001,
		|	СУММА(ДанныеИтогов.П000П1М400002) КАК П000П1М400002,
		|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
		|	СУММА(ДанныеИтогов.П000П1М100010) КАК П000П1М100010,
		|	СУММА(ДанныеИтогов.П000П1М100011) КАК П000П1М100011
		|ПОМЕСТИТЬ ВТДанныеИтоговПоТекущимДанным
		|ИЗ
		|	(ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|		Налоги.СтавкаНалога КАК Ставка,
		|		Налоги.КБК КАК КБК,
		|		Налоги.СтавкаНалога КАК П000П1М100001,
		|		Налоги.КБК КАК П000П1М100009,
		|		0 КАК П000П1М100002,
		|		0 КАК П000П1М100003,
		|		Налоги.Начислено КАК П000П1М100004,
		|		Налоги.УдержаноЗаНалоговыйПериод КАК П000П1М100005,
		|		Налоги.ЗачтеноАвансов КАК П000П1М100006,
		|		0 КАК П000П1М100008,
		|		Налоги.НалогНаПрибыльДляДивидендов КАК П000П1М100010,
		|		Налоги.НалогСДивидендовУплаченныйЗаРубежом КАК П000П1М100011,
		|		Налоги.Передано КАК П000П1М400002,
		|		Налоги.СуммаДоходаСКоторогоНеУдержанНалог КАК П000П1М400001
		|	ИЗ
		|		ВТДанныеПоФизлицам КАК Налоги
		|	ГДЕ
		|		(Налоги.Начислено <> 0
		|				ИЛИ Налоги.ЗачтеноАвансов <> 0
		|				ИЛИ Налоги.УдержаноЗаНалоговыйПериод <> 0)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СуммаДохода,
		|		СведенияОДоходах.СуммаДохода,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТДоходыПоСтавкам КАК СведенияОДоходах
		|	ГДЕ
		|		СведенияОДоходах.ДанныеДляОтчета
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СведенияОДоходах.ФизическоеЛицо,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		СведенияОДоходах.СтавкаНалога,
		|		СведенияОДоходах.КБК,
		|		0,
		|		-СведенияОДоходах.СуммаВычета,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		ВТВычетыПоСтавкам КАК СведенияОДоходах
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Налоги.ФизическоеЛицо,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		Налоги.СтавкаНалога,
		|		Налоги.КБК,
		|		0,
		|		0,
		|		0,
		|		0,
		|		0,
		|		Налоги.ИзлишнеУдержано,
		|		0,
		|		0,
		|		0,
		|		0
		|	ИЗ
		|		(ВЫБРАТЬ
		|			Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
		|			Налоги.СтавкаНалога КАК СтавкаНалога,
		|			Налоги.КБК КАК КБК,
		|			-СУММА(Налоги.Сальдо) КАК ИзлишнеУдержано
		|		ИЗ
		|			ВТНалогиПоСтавкам КАК Налоги
		|		
		|		СГРУППИРОВАТЬ ПО
		|			Налоги.ФизическоеЛицо,
		|			Налоги.КБК,
		|			Налоги.СтавкаНалога
		|		
		|		ИМЕЮЩИЕ
		|			СУММА(Налоги.Сальдо) < 0) КАК Налоги) КАК ДанныеИтогов
		|
		|СГРУППИРОВАТЬ ПО
		|	ДанныеИтогов.Ставка,
		|	ДанныеИтогов.КБК,
		|	ДанныеИтогов.ФизическоеЛицо,
		|	ДанныеИтогов.П000П1М100001,
		|	ДанныеИтогов.П000П1М100009
		|
		|ИМЕЮЩИЕ
		|	СУММА(ДанныеИтогов.П000П1М100002) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ) КАК Период,
		|	СведенияОДоходах.СтавкаНалога КАК Ставка,
		|	СведенияОДоходах.КБК КАК КБК,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """") КАК П000П1М500002,
		|	СУММА(СведенияОДоходах.СуммаДохода) КАК П000П1М500003,
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года, """") КАК П000П1М600004,
		|	СУММА(СведенияОДоходах.СуммаВычета) КАК П000П1М600005
		|ПОМЕСТИТЬ ВТДоходыПоТекущимДанным
		|ИЗ
		|	ВТДоходыПоСтавкам КАК СведенияОДоходах
		|ГДЕ
		|	СведенияОДоходах.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходах.КБК,
		|	СведенияОДоходах.ФизическоеЛицо,
		|	ЕСТЬNULL(СведенияОДоходах.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года, """"),
		|	ЕСТЬNULL(СведенияОДоходах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года, """"),
		|	СведенияОДоходах.СтавкаНалога,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходах.Период, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходах.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходах.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОВычетах.СтавкаНалога КАК Ставка,
		|	СведенияОВычетах.КБК КАК КБК,
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета КАК ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года КАК П000П1М200001,
		|	СУММА(СведенияОВычетах.СуммаВычета) КАК П000П1М200002
		|ПОМЕСТИТЬ ВТВычетыПоТекущимДанным
		|ИЗ
		|	ВТВычетыПоСтавкам КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.КодВычета.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОВычетах.СтавкаНалога,
		|	СведенияОВычетах.КБК,
		|	СведенияОВычетах.ФизическоеЛицо,
		|	СведенияОВычетах.КодВычета.ГруппаВычета,
		|	СведенияОВычетах.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2023Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(СведенияОВычетах.СуммаВычета) <> 0";
		Запрос.Выполнить();
		
		НалоговыйПериод = Год(ОкончаниеПериода);
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
		|ГДЕ
		|	СведенияОВычетах.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка)";
		ДанныеУведомлений = УчетНДФЛ.ДанныеУведомленийНаВычеты(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеУведомлений.Колонки.Сотрудник.Имя = "ФизическоеЛицо";
		
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДанныеПоФизлицам КАК Налоги
		|ГДЕ
		|	Налоги.ЗачтеноАвансов <> 0";
		ДанныеЗачетаАвансовыхПлатежей = УчетНДФЛ.ДанныеУведомленийНаЗачетАвансовыхПлатежей(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо"), НалоговыйПериод, Организация);
		ДанныеЗачетаАвансовыхПлатежей.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ДанныеЗачетаАвансовыхПлатежей, ДанныеУведомлений);
		
		Если НомерКорректировки = 0 Тогда
			
			// Для исходной формы дополнительных действий не требуется, возвращаем полученные данные.
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование";
			ОписаниеТаблиц.Приложение1Налогоплательщики = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М400001 КАК П000П1М400001,
			|	ДанныеИтогов.П000П1М400002 КАК П000П1М400002,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010,
			|	ДанныеИтогов.П000П1М100011 КАК П000П1М100011
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	П000П1М200001";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			ДанныеУведомлений.Колонки.НомерУведомления.Имя = "П000П1М300002";
			ДанныеУведомлений.Колонки.ДатаУведомления.Имя = "П000П1М300003";
			ДанныеУведомлений.Колонки.КодНалоговогоОрганаУведомления.Имя = "П000П1М300004";
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = ДанныеУведомлений;
			
		Иначе
			
			// Для корректирующей формы определим перечень сотрудников, чьи данные отличаются от переданных ранее, и вернем данные учета только для них.
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(Запрос.МенеджерВременныхТаблиц, ДанныеУведомлений, "ВТУведомленияОВычетахПоТекущимДанным");
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СУММА(СведенияОДоходах.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТТолькоДоходыПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СУММА(СведенияОДоходах.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПоТекущимДанным
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходах.ФизическоеЛицо,
			|	СведенияОДоходах.Ставка,
			|	СведенияОДоходах.КБК,
			|	СведенияОДоходах.Период,
			|	СведенияОДоходах.П000П1М500002,
			|	СведенияОДоходах.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(СведенияОДоходах.П000П1М600005) <> 0
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаВОтчет
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО ФизлицаПоТекущимДанным.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|			И ФизлицаПоТекущимДанным.ИНН = ФизлицаПереданные.ИНН
			|			И ФизлицаПоТекущимДанным.Фамилия = ФизлицаПереданные.Фамилия
			|			И ФизлицаПоТекущимДанным.Имя = ФизлицаПереданные.Имя
			|			И ФизлицаПоТекущимДанным.Отчество = ФизлицаПереданные.Отчество
			|			И ФизлицаПоТекущимДанным.ДатаРождения = ФизлицаПереданные.ДатаРождения
			|			И ФизлицаПоТекущимДанным.КодСтраныДляОтчетности = ФизлицаПереданные.КодСтраныДляОтчетности
			|			И ФизлицаПоТекущимДанным.СерияДокумента = ФизлицаПереданные.СерияДокумента
			|			И ФизлицаПоТекущимДанным.НомерДокумента = ФизлицаПереданные.НомерДокумента
			|			И ФизлицаПоТекущимДанным.КодФНС = ФизлицаПереданные.КодФНС
			|			И ФизлицаПоТекущимДанным.КодМВД = ФизлицаПереданные.КодМВД
			|ГДЕ
			|	ФизлицаПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДанныеИтогов.ФизическоеЛицо
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиПереданные КАК ИтогиПереданные
			|		ПО ДанныеИтогов.ФизическоеЛицо = ИтогиПереданные.ФизическоеЛицо
			|			И ДанныеИтогов.П000П1М100001 = ИтогиПереданные.П000П1М100001
			|			И ДанныеИтогов.П000П1М100002 = ИтогиПереданные.П000П1М100002
			|			И ДанныеИтогов.П000П1М100003 = ИтогиПереданные.П000П1М100003
			|			И ДанныеИтогов.П000П1М100004 = ИтогиПереданные.П000П1М100004
			|			И ДанныеИтогов.П000П1М100005 = ИтогиПереданные.П000П1М100005
			|			И ДанныеИтогов.П000П1М100006 = ИтогиПереданные.П000П1М100006
			|			И ДанныеИтогов.П000П1М100008 = ИтогиПереданные.П000П1М100008
			|			И ДанныеИтогов.П000П1М100009 = ИтогиПереданные.П000П1М100009
			|			И ДанныеИтогов.П000П1М100010 = ИтогиПереданные.П000П1М100010
			|			И ДанныеИтогов.П000П1М100011 = ИтогиПереданные.П000П1М100011
			|ГДЕ
			|	ИтогиПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ИтогиПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТИтогиПереданные КАК ИтогиПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ПО ИтогиПереданные.ФизическоеЛицо = ДанныеИтогов.ФизическоеЛицо
			|			И ИтогиПереданные.П000П1М100001 = ДанныеИтогов.П000П1М100001
			|			И ИтогиПереданные.П000П1М100002 = ДанныеИтогов.П000П1М100002
			|			И ИтогиПереданные.П000П1М100003 = ДанныеИтогов.П000П1М100003
			|			И ИтогиПереданные.П000П1М100004 = ДанныеИтогов.П000П1М100004
			|			И ИтогиПереданные.П000П1М100005 = ДанныеИтогов.П000П1М100005
			|			И ИтогиПереданные.П000П1М100006 = ДанныеИтогов.П000П1М100006
			|			И ИтогиПереданные.П000П1М100008 = ДанныеИтогов.П000П1М100008
			|			И ИтогиПереданные.П000П1М100009 = ДанныеИтогов.П000П1М100009
			|			И ИтогиПереданные.П000П1М100010 = ДанныеИтогов.П000П1М100010
			|			И ИтогиПереданные.П000П1М100011 = ДанныеИтогов.П000П1М100011
			|ГДЕ
			|	ДанныеИтогов.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОДоходах.ФизическоеЛицо
			|ИЗ
			|	ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПереданные КАК ДоходыПереданные
			|		ПО СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо
			|			И СведенияОДоходах.Ставка = ДоходыПереданные.Ставка
			|			И СведенияОДоходах.КБК = ДоходыПереданные.КБК
			|			И СведенияОДоходах.Период = ДоходыПереданные.Период
			|			И СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002
			|			И СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003
			|ГДЕ
			|	ДоходыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДоходыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТДоходыПереданные КАК ДоходыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТТолькоДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ПО (СведенияОДоходах.ФизическоеЛицо = ДоходыПереданные.ФизическоеЛицо)
			|			И (СведенияОДоходах.Ставка = ДоходыПереданные.Ставка)
			|			И (СведенияОДоходах.КБК = ДоходыПереданные.КБК)
			|			И (СведенияОДоходах.Период = ДоходыПереданные.Период)
			|			И (СведенияОДоходах.П000П1М500002 = ДоходыПереданные.П000П1М500002)
			|			И (СведенияОДоходах.П000П1М500003 = ДоходыПереданные.П000П1М500003)
			|ГДЕ
			|	СведенияОДоходах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыКДоходамПереданные КАК ВычетыКДоходамПоТекущимДанным
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыКДоходамПоТекущимДанным КАК ВычетыКДоходамПереданные
			|		ПО ВычетыКДоходамПоТекущимДанным.ФизическоеЛицо = ВычетыКДоходамПереданные.ФизическоеЛицо
			|			И ВычетыКДоходамПоТекущимДанным.Ставка = ВычетыКДоходамПереданные.Ставка
			|			И ВычетыКДоходамПоТекущимДанным.КБК = ВычетыКДоходамПереданные.КБК
			|			И ВычетыКДоходамПоТекущимДанным.Период = ВычетыКДоходамПереданные.Период
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М500002 = ВычетыКДоходамПереданные.П000П1М500002
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600004 = ВычетыКДоходамПереданные.П000П1М600004
			|			И ВычетыКДоходамПоТекущимДанным.П000П1М600005 = ВычетыКДоходамПереданные.П000П1М600005
			|ГДЕ
			|	ВычетыКДоходамПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.Ставка = ВычетыПереданные.Ставка
			|			И СведенияОВычетах.КБК = ВычетыПереданные.КБК
			|			И СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001
			|			И СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТВычетыПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.Ставка = ВычетыПереданные.Ставка)
			|			И (СведенияОВычетах.КБК = ВычетыПереданные.КБК)
			|			И (СведенияОВычетах.П000П1М200001 = ВычетыПереданные.П000П1М200001)
			|			И (СведенияОВычетах.П000П1М200002 = ВычетыПереданные.П000П1М200002)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СведенияОВычетах.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ПО СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо
			|			И СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета
			|			И СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002
			|			И СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003
			|			И СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004
			|ГДЕ
			|	ВычетыПереданные.ФизическоеЛицо ЕСТЬ NULL
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВычетыПереданные.ФизическоеЛицо
			|ИЗ
			|	ВТУведомленияОВычетахПереданные КАК ВычетыПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУведомленияОВычетахПоТекущимДанным КАК СведенияОВычетах
			|		ПО (СведенияОВычетах.ФизическоеЛицо = ВычетыПереданные.ФизическоеЛицо)
			|			И (СведенияОВычетах.ГруппаВычета = ВычетыПереданные.ГруппаВычета)
			|			И (СведенияОВычетах.НомерУведомления = ВычетыПереданные.П000П1М300002)
			|			И (СведенияОВычетах.ДатаУведомления = ВычетыПереданные.П000П1М300003)
			|			И (СведенияОВычетах.КодНалоговогоОрганаУведомления = ВычетыПереданные.П000П1М300004)
			|ГДЕ
			|	СведенияОВычетах.ФизическоеЛицо ЕСТЬ NULL
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(ФизлицаПереданные.НомерСправки, 0) КАК НомерСправки,
			|	ЕСТЬNULL(ФизлицаПереданные.НомерКорректировки, 0) КАК НомерКорректировки,
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
			|	КадровыеДанныеФизЛиц.ИНН КАК ИНН,
			|	КадровыеДанныеФизЛиц.Фамилия КАК Фамилия,
			|	КадровыеДанныеФизЛиц.Имя КАК Имя,
			|	КадровыеДанныеФизЛиц.Отчество КАК Отчество,
			|	КадровыеДанныеФизЛиц.ДатаРождения КАК ДатаРождения,
			|	КадровыеДанныеФизЛиц.СерияДокумента КАК СерияДокумента,
			|	КадровыеДанныеФизЛиц.НомерДокумента КАК НомерДокумента,
			|	КадровыеДанныеФизЛиц.Наименование КАК Наименование,
			|	КадровыеДанныеФизЛиц.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	КадровыеДанныеФизЛиц.КодФНС КАК КодФНС,
			|	КадровыеДанныеФизЛиц.КодМВД КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеНалогоплательщиков
			|ИЗ
			|	ВТФизлицаПоТекущимДанным КАК КадровыеДанныеФизЛиц
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ПО КадровыеДанныеФизЛиц.ФизическоеЛицо = ФизлицаПереданные.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаПереданные.НомерСправки,
			|	99,
			|	ФизлицаПереданные.ФизическоеЛицо,
			|	ФизлицаПереданные.ИНН,
			|	ФизлицаПереданные.Фамилия,
			|	ФизлицаПереданные.Имя,
			|	ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.ДатаРождения,
			|	ФизлицаПереданные.СерияДокумента,
			|	ФизлицаПереданные.НомерДокумента,
			|	ФизлицаПереданные.Фамилия + "" "" + ФизлицаПереданные.Имя + "" "" + ФизлицаПереданные.Отчество,
			|	ФизлицаПереданные.КодСтраныДляОтчетности,
			|	ФизлицаПереданные.КодФНС,
			|	ФизлицаПереданные.КодМВД
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ФизлицаПереданные
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаПоТекущимДанным КАК ФизлицаПоТекущимДанным
			|		ПО ФизлицаПереданные.ФизическоеЛицо = ФизлицаПоТекущимДанным.ФизическоеЛицо
			|			И ФизлицаПереданные.ИНН = ФизлицаПоТекущимДанным.ИНН
			|			И ФизлицаПереданные.Фамилия = ФизлицаПоТекущимДанным.Фамилия
			|			И ФизлицаПереданные.Имя = ФизлицаПоТекущимДанным.Имя
			|			И ФизлицаПереданные.Отчество = ФизлицаПоТекущимДанным.Отчество
			|			И ФизлицаПереданные.ДатаРождения = ФизлицаПоТекущимДанным.ДатаРождения
			|			И ФизлицаПереданные.КодСтраныДляОтчетности = ФизлицаПоТекущимДанным.КодСтраныДляОтчетности
			|			И ФизлицаПереданные.СерияДокумента = ФизлицаПоТекущимДанным.СерияДокумента
			|			И ФизлицаПереданные.НомерДокумента = ФизлицаПоТекущимДанным.НомерДокумента
			|			И ФизлицаПереданные.КодФНС = ФизлицаПоТекущимДанным.КодФНС
			|			И ФизлицаПереданные.КодМВД = ФизлицаПоТекущимДанным.КодМВД
			|ГДЕ
			|	ФизлицаПоТекущимДанным.ФизическоеЛицо ЕСТЬ NULL
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДанныеНалогоплательщиков.НомерСправки КАК НомерСправки,
			|	ДанныеНалогоплательщиков.НомерКорректировки КАК НомерКорректировки,
			|	ДанныеНалогоплательщиков.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеНалогоплательщиков.ИНН КАК ИНН,
			|	ДанныеНалогоплательщиков.Фамилия КАК Фамилия,
			|	ДанныеНалогоплательщиков.Имя КАК Имя,
			|	ДанныеНалогоплательщиков.Отчество КАК Отчество,
			|	ДанныеНалогоплательщиков.ДатаРождения КАК ДатаРождения,
			|	ДанныеНалогоплательщиков.СерияДокумента КАК СерияДокумента,
			|	ДанныеНалогоплательщиков.НомерДокумента КАК НомерДокумента,
			|	ВЫРАЗИТЬ(ДанныеНалогоплательщиков.Наименование КАК СТРОКА(1000)) КАК Наименование,
			|	ДанныеНалогоплательщиков.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ДанныеНалогоплательщиков.КодФНС КАК КодФНС,
			|	ДанныеНалогоплательщиков.КодМВД КАК КодМВД
			|ИЗ
			|	ВТДанныеНалогоплательщиков КАК ДанныеНалогоплательщиков
			|
			|УПОРЯДОЧИТЬ ПО
			|	Наименование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ЕСТЬNULL(МАКСИМУМ(ДанныеНалогоплательщиков.НомерСправки), 0) КАК НомерСправки
			|ИЗ
			|	ВТНалогоплательщикиПереданные КАК ДанныеНалогоплательщиков";
			Результаты = Запрос.ВыполнитьПакет();
			// АПК:96-вкл
			ВсегоРезультатов = Результаты.Количество();
			ОписаниеТаблиц.Приложение1Налогоплательщики = Результаты[ВсегоРезультатов - 2].Выгрузить();
			МаксимальныйНомерИзПереданныхСправок = 0;
			Если Не Результаты[ВсегоРезультатов - 1].Пустой() Тогда
				Выборка = Результаты[ВсегоРезультатов - 1].Выбрать();
				Выборка.Следующий();
				МаксимальныйНомерИзПереданныхСправок = Выборка.НомерСправки;
			КонецЕсли;
			ОписаниеТаблиц.Вставить("Приложение1МаксимальныйНомерИзПереданныхСправок", МаксимальныйНомерИзПереданныхСправок + 1);
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	ДанныеИтогов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДанныеИтогов.Ставка КАК Ставка,
			|	ДанныеИтогов.КБК КАК КБК,
			|	ДанныеИтогов.П000П1М100001 КАК П000П1М100001,
			|	ДанныеИтогов.П000П1М100002 КАК П000П1М100002,
			|	ДанныеИтогов.П000П1М100003 КАК П000П1М100003,
			|	ДанныеИтогов.П000П1М100004 КАК П000П1М100004,
			|	ДанныеИтогов.П000П1М100005 КАК П000П1М100005,
			|	ДанныеИтогов.П000П1М100006 КАК П000П1М100006,
			|	ДанныеИтогов.П000П1М100008 КАК П000П1М100008,
			|	ДанныеИтогов.П000П1М100009 КАК П000П1М100009,
			|	ДанныеИтогов.П000П1М100010 КАК П000П1М100010,
			|	ДанныеИтогов.П000П1М100011 КАК П000П1М100011
			|ИЗ
			|	ВТДанныеИтоговПоТекущимДанным КАК ДанныеИтогов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ДанныеИтогов.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК"; 
			ОписаниеТаблиц.Приложение1Итоги = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходах.Ставка КАК Ставка,
			|	СведенияОДоходах.КБК КАК КБК,
			|	СведенияОДоходах.П000П1М500002 КАК П000П1М500002,
			|	СведенияОДоходах.Период КАК Период,
			|	СведенияОДоходах.П000П1М500003 КАК П000П1М500003,
			|	СведенияОДоходах.П000П1М600004 КАК П000П1М600004,
			|	СведенияОДоходах.П000П1М600005 КАК П000П1М600005
			|ИЗ
			|	ВТДоходыПоТекущимДанным КАК СведенияОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОДоходах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК,
			|	Период,
			|	П000П1М500002";
			ОписаниеТаблиц.Приложение1Доходы = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОВычетах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОВычетах.Ставка КАК Ставка,
			|	СведенияОВычетах.КБК КАК КБК,
			|	СведенияОВычетах.ГруппаВычета КАК ГруппаВычета,
			|	СведенияОВычетах.П000П1М200001 КАК П000П1М200001,
			|	СведенияОВычетах.П000П1М200002 КАК П000П1М200002
			|ИЗ
			|	ВТВычетыПоТекущимДанным КАК СведенияОВычетах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО СведенияОВычетах.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Ставка,
			|	КБК";
			ОписаниеТаблиц.Приложение1Вычеты = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.НомерУведомления КАК П000П1М300002,
			|	ВременнаяТаблица.ДатаУведомления КАК П000П1М300003,
			|	ВременнаяТаблица.КодНалоговогоОрганаУведомления КАК П000П1М300004
			|ИЗ
			|	ВТУведомленияОВычетахПоТекущимДанным КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизлицаВОтчет КАК ФизлицаВОтчет
			|		ПО ВременнаяТаблица.ФизическоеЛицо = ФизлицаВОтчет.ФизическоеЛицо
			|ГДЕ
			|	ФизлицаВОтчет.ФизическоеЛицо ЕСТЬ НЕ NULL"; 
			ОписаниеТаблиц.Приложение1УведомленияОВычетах = Запрос.Выполнить().Выгрузить();
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Функция ДанныеОДоходахНалогахВычетах2024(Сотрудники, НалоговыйПериод, Организация, РегистрацияВНалоговомОргане, ДатаАктуальности, КППОтправки, ВРазрезеРегистраторов, ДополнительныйОтбор) Экспорт
	
	Если НалоговыйПериод < 2021 Или ЗначениеЗаполнено(КППОтправки) Тогда
		Возврат ДанныеОДоходахНалогахВычетах2020(Сотрудники, НалоговыйПериод, Организация, РегистрацияВНалоговомОргане, ДатаАктуальности, КППОтправки, ВРазрезеРегистраторов, ДополнительныйОтбор)
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("Организация",Организация);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ГодНП",НалоговыйПериод);
	НачалоНалоговогоПериода = Дата(НалоговыйПериод, 1, 1);
	КонецНалоговогоПериода = КонецГода(НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("КонецНП",КонецНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоНП", НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоСледующегоНП", КонецНалоговогоПериода + 1); // Начало следующего налогового периода.
	Запрос.УстановитьПараметр("ДатаПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности));
	Запрос.УстановитьПараметр("ДатаДоПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности) - 1);
	Запрос.УстановитьПараметр("ЧитатьСводныеДанные", РегистрацияВНалоговомОргане = Неопределено Или ВРазрезеРегистраторов);
	Запрос.УстановитьПараметр("ДоходыОтТрудовойДеятельности", Перечисления.КатегорииДоходовНДФЛ.ДоходыОтТрудовойДеятельности());
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("Сотрудники", Сотрудники);
	Запрос.УстановитьПараметр("ДополнительныйОтбор", Истина);
	Запрос.УстановитьПараметр("ДатаВыделенияРКСН", УчетНДФЛ.ДатаЗакона176ФЗ());
	
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = УчетНДФЛ.ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
	Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", ?(НачалоНалоговогоПериода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.ДатаОбъединенияНалоговыхБаз, Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза(), Перечисления.КатегорииДоходовНДФЛ.ПоОсновнойСтавке()));
	Запрос.УстановитьПараметр("Предел", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел);
	Запрос.УстановитьПараметр("СтавкаСПревышения", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Ставка);
	
	// АПК:96-выкл Использование ОБЪЕДИНИТЬ для таблицы ВТСтрокиУчета необходимо
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	СписокСотрудников.Ссылка КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВТФизлица
	|ИЗ
	|	Справочник.ФизическиеЛица КАК СписокСотрудников
	|ГДЕ
	|	СписокСотрудников.Ссылка В(&Сотрудники)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МЕСЯЦ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК Месяц,
	|	КОНЕЦПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК КонецГода,
	|	СведенияОДоходахНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаВыделенияРКСН
	|				И СведенияОДоходахНДФЛ.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДовольствиеСВОвДенежнойФорме), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.РайонныеСеверныеНадбавки))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
	|		КОГДА СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаВыделенияРКСН
	|				И СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.РайонныеСеверныеНадбавкиАУСН)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТрудаАУСН)
	|		КОГДА СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаВыделенияРКСН
	|				И СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДовольствиеСВОвНатуральнойФорме)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходВНатуральнойФормеОтТрудовойДеятельности)
	|		ИНАЧЕ СведенияОДоходахНДФЛ.КатегорияДохода
	|	КОНЕЦ КАК КатегорияДохода,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаВыделенияРКСН
	|				И СведенияОДоходахНДФЛ.КодДохода В (ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.ДовольствиеСВО), ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.РайонныеСеверныеНадбавки))
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.КодДоходаПоУмолчанию)
	|		ИНАЧЕ СведенияОДоходахНДФЛ.КодДохода
	|	КОНЕЦ КАК КодДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2021Года КАК КодДоходаКодДляОтчетности,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|			ТОГДА 0
	|		ИНАЧЕ СведенияОДоходахНДФЛ.СуммаВычета
	|	КОНЕЦ КАК СуммаВычета,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
	|	КОНЕЦ КАК КодВычета,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
	|	СведенияОДоходахНДФЛ.Сотрудник КАК Сотрудник,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
	|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	&ЧитатьСводныеДанные
	|			И СведенияОДоходахНДФЛ.Организация = &Организация
	|		ИЛИ СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане КАК ДанныеДляОтчета,
	|	СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование,
	|	СведенияОДоходахНДФЛ.УстаревшаяДатаПолученияДохода КАК УстаревшаяДатаПолученияДохода
	|ПОМЕСТИТЬ ВТДоходы
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизлица КАК Сотрудники
	|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
	|			И (СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (СведенияОДоходахНДФЛ.Период <= &ДатаПодачиСведений)
	|			И (&ДополнительныйОтбор)
	|ГДЕ
	|	&УсловиеОблагаемостиУНалоговогоАгента
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
	|	СУММА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма) КАК СуммаОборот,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор КАК Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение КАК Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	&ЧитатьСводныеДанные
	|			И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Организация = &Организация
	|		ИЛИ ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане КАК ДанныеДляОтчета
	|ПОМЕСТИТЬ ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|ИЗ
	|	ВТФизлица КАК Сотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
	|		ПО Сотрудники.ФизическоеЛицо = ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо
	|ГДЕ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период <= &ДатаПодачиСведений
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП
	|	И &ДополнительныйОтбор
	|
	|СГРУППИРОВАТЬ ПО
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане,
	|	&ЧитатьСводныеДанные
	|			И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Организация = &Организация
	|		ИЛИ ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета КАК КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.СуммаОборот КАК СуммаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета.ГруппаВычета КАК КодВычетаГруппаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Регистратор КАК Регистратор,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ПериодРегистрации КАК ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Подразделение КАК Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ДанныеДляОтчета КАК ДанныеДляОтчета
	|ПОМЕСТИТЬ ВТВычеты
	|ИЗ
	|	ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ИмущественныеВычетыНДФЛ.КодВычета,
	|	ИмущественныеВычетыНДФЛ.Сумма,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	СотрудникиОрганизаций.ФизическоеЛицо,
	|	ИмущественныеВычетыНДФЛ.КодВычета.ГруппаВычета,
	|	ИмущественныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.МесяцРегистрации, МЕСЯЦ),
	|	ИмущественныеВычетыНДФЛ.Подразделение,
	|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане,
	|	&ЧитатьСводныеДанные
	|			И ИмущественныеВычетыНДФЛ.Организация = &Организация
	|		ИЛИ ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане
	|ИЗ
	|	ВТФизлица КАК СотрудникиОрганизаций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
	|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИмущественныеВычетыНДФЛ.ФизическоеЛицо
	|			И (ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход))
	|			И (ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ДатаПодачиСведений)
	|			И (ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (ИмущественныеВычетыНДФЛ.Год = &ГодНП)
	|			И (&ДополнительныйОтбор)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	НДФЛРасчетыСБюджетом.ВариантУдержания КАК ВариантУдержания,
	|	НДФЛРасчетыСБюджетом.ВидДвижения КАК ВидДвижения,
	|	НДФЛРасчетыСБюджетом.Сумма КАК Сумма,
	|	НДФЛРасчетыСБюджетом.СуммаСПревышения КАК СуммаСПревышения,
	|	НДФЛРасчетыСБюджетом.СуммаСПревышенияПоСтавке18 КАК СуммаСПревышенияПоСтавке18,
	|	НДФЛРасчетыСБюджетом.СуммаСПревышенияПоСтавке20 КАК СуммаСПревышенияПоСтавке20,
	|	НДФЛРасчетыСБюджетом.СуммаСПревышенияПоСтавке22 КАК СуммаСПревышенияПоСтавке22,
	|	ВЫБОР
	|		КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				И НДФЛРасчетыСБюджетом.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|				И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода >= ДАТАВРЕМЯ(2021, 1, 1, 0, 0, 0)
	|			ТОГДА ВЫБОР
	|					КОГДА НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов = 0
	|						ТОГДА 0
	|					КОГДА НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов > 0
	|							И НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения > 0
	|						ТОГДА ВЫБОР
	|								КОГДА НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения >= НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов
	|									ТОГДА НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов
	|								ИНАЧЕ НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения
	|							КОНЕЦ
	|					КОГДА НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов < 0
	|							И НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения < 0
	|						ТОГДА ВЫБОР
	|								КОГДА НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения <= НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов
	|									ТОГДА НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов
	|								ИНАЧЕ НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения
	|							КОНЕЦ
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК НалогНаПрибыльДляДивидендов,
	|	ВЫБОР
	|		КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				И НДФЛРасчетыСБюджетом.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
	|				И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода >= ДАТАВРЕМЯ(2024, 1, 1, 0, 0, 0)
	|			ТОГДА ВЫБОР
	|					КОГДА НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом = 0
	|						ТОГДА 0
	|					КОГДА НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом > 0
	|							И НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения > 0
	|						ТОГДА ВЫБОР
	|								КОГДА НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения >= НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом
	|									ТОГДА НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом
	|								ИНАЧЕ НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения
	|							КОНЕЦ
	|					КОГДА НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом < 0
	|							И НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения < 0
	|						ТОГДА ВЫБОР
	|								КОГДА НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения <= НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом
	|									ТОГДА НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом
	|								ИНАЧЕ НДФЛРасчетыСБюджетом.Сумма + НДФЛРасчетыСБюджетом.СуммаСПревышения
	|							КОНЕЦ
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК НалогСДивидендовУплаченныйЗаРубежом,
	|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	НДФЛРасчетыСБюджетом.КатегорияДохода КАК КатегорияДохода,
	|	НДФЛРасчетыСБюджетом.КодДохода КАК КодДохода,
	|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	НДФЛРасчетыСБюджетом.Регистратор КАК Регистратор,
	|	НАЧАЛОПЕРИОДА(НДФЛРасчетыСБюджетом.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	НДФЛРасчетыСБюджетом.Подразделение КАК Подразделение,
	|	НДФЛРасчетыСБюджетом.СуммаДоходаСКоторогоНеУдержанНалог КАК СуммаДоходаСКоторогоНеУдержанНалог
	|ПОМЕСТИТЬ ВТСтрокиНалогов
	|ИЗ
	|	ВТФизлица КАК СправкиОДоходах
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК НДФЛРасчетыСБюджетом
	|		ПО СправкиОДоходах.ФизическоеЛицо = НДФЛРасчетыСБюджетом.ФизическоеЛицо
	|			И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (НДФЛРасчетыСБюджетом.Период < &ДатаПодачиСведений)
	|			И (НДФЛРасчетыСБюджетом.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (&ЧитатьСводныеДанные
	|					И НДФЛРасчетыСБюджетом.Организация = &Организация
	|				ИЛИ НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|			И (&ДополнительныйОтбор)
	|ГДЕ
	|	НДФЛРасчетыСБюджетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Перечислено.Ставка КАК Ставка,
	|	Перечислено.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(Перечислено.СуммаРасход) КАК СуммаРасход,
	|	Перечислено.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ВЫБОР
	|		КОГДА Перечислено.ИсчисленоПоДивидендам
	|			ТОГДА ВЫБОР
	|					КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка05)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05)
	|					КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка10)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10)
	|					КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка12)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|				КОНЕЦ
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка03)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка05)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка06)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка07)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка10)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
	|	КОНЕЦ КАК КатегорияДохода,
	|	Перечислено.ИсчисленоПоДивидендам КАК ИсчисленоПоДивидендам
	|ПОМЕСТИТЬ ВТПеречисленоНДФЛПоМесяцам
	|ИЗ
	|	(ВЫБРАТЬ
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка КАК Ставка,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК СуммаРасход,
	|		КОНЕЦПЕРИОДА(РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам КАК ИсчисленоПоДивидендам
	|	ИЗ
	|		РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(
	|				&НачалоНП,
	|				&ДатаДоПодачиСведений,
	|				,
	|				ФизическоеЛицо В
	|						(ВЫБРАТЬ
	|							ФизическиеЛица.ФизическоеЛицо
	|						ИЗ
	|							ВТФизлица КАК ФизическиеЛица)
	|					И (МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|					И (&ЧитатьСводныеДанные
	|							И Организация = &Организация
	|						ИЛИ РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты) КАК Перечислено
	|ГДЕ
	|	Перечислено.МесяцНалоговогоПериода < ДАТАВРЕМЯ(2023, 1, 1, 0, 0, 0)
	|
	|СГРУППИРОВАТЬ ПО
	|	Перечислено.Ставка,
	|	Перечислено.ФизическоеЛицо,
	|	Перечислено.МесяцНалоговогоПериода,
	|	Перечислено.ИсчисленоПоДивидендам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Доходы.ДатаПолученияДохода КАК Период,
	|	Доходы.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Доходы.КатегорияДохода КАК КатегорияДохода
	|ПОМЕСТИТЬ ВТСтрокиУчета
	|ИЗ
	|	ВТДоходы КАК Доходы
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Вычеты.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
	|	Вычеты.ФизическоеЛицо,
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
	|ИЗ
	|	ВТВычеты КАК Вычеты
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтрокиНалогов.МесяцНалоговогоПериода,
	|	СтрокиНалогов.СтавкаНалогообложенияРезидента,
	|	СтрокиНалогов.ФизическоеЛицо,
	|	СтрокиНалогов.КатегорияДохода
	|ИЗ
	|	ВТСтрокиНалогов КАК СтрокиНалогов
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПеречисленоНДФЛПоМесяцам.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
	|	ПеречисленоНДФЛПоМесяцам.ФизическоеЛицо,
	|	ПеречисленоНДФЛПоМесяцам.КатегорияДохода
	|ИЗ
	|	ВТПеречисленоНДФЛПоМесяцам КАК ПеречисленоНДФЛПоМесяцам
	|ГДЕ
	|	НЕ ПеречисленоНДФЛПоМесяцам.ИсчисленоПоДивидендам
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПеречисленоНДФЛПоМесяцам.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09),
	|	ПеречисленоНДФЛПоМесяцам.ФизическоеЛицо,
	|	ПеречисленоНДФЛПоМесяцам.КатегорияДохода
	|ИЗ
	|	ВТПеречисленоНДФЛПоМесяцам КАК ПеречисленоНДФЛПоМесяцам
	|ГДЕ
	|	ПеречисленоНДФЛПоМесяцам.ИсчисленоПоДивидендам";
	// АПК:96-вкл 
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
	Запрос.Текст = ?(ЗначениеЗаполнено(ДополнительныйОтбор), СтрЗаменить(ТекстЗапроса, "&ДополнительныйОтбор", ДополнительныйОтбор), ТекстЗапроса);
	Запрос.Выполнить();
	
	УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета", "УчитыватьИзмененияСтатусаДляОтчетности");
	
	Если ВРазрезеРегистраторов Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	Доходы.ПериодРегистрации КАК ПериодРегистрации,
		|	Доходы.Сотрудник КАК Сотрудник,
		|	Доходы.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение КАК Подразделение,
		|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	Доходы.Регистратор КАК Регистратор,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодВычета КАК КодВычета,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета
		|ИЗ
		|	ВТДоходы КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	(НЕ Доходы.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ДистанционныйРаботник)
		|				И Доходы.КатегорияДохода В (&ДоходыОтТрудовойДеятельности)
		|				И Доходы.ДатаПолученияДохода >= ДАТАВРЕМЯ(2024, 1, 1, 0, 0, 0))
		|	И Доходы.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ПериодРегистрации,
		|	Доходы.Сотрудник,
		|	Доходы.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение,
		|	Доходы.КодВычета,
		|	Доходы.Регистратор,
		|	Доходы.ДатаПолученияДохода
		|
		|ИМЕЮЩИЕ
		|	(СУММА(Доходы.СуммаДохода) <> 0
		|		ИЛИ СУММА(Доходы.СуммаВычета) <> 0)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	Ставка,
		|	ПериодРегистрации,
		|	Сотрудник,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	ДатаПолученияДохода,
		|	КодДохода,
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Вычеты.ПериодРегистрации КАК ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК ДатаПолученияДохода,
		|	Вычеты.Подразделение КАК Подразделение,
		|	Вычеты.Регистратор КАК Регистратор,
		|	Вычеты.КодВычета КАК КодВычета,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|ГДЕ
		|	Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|	И Вычеты.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	Вычеты.КодВычета,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	Вычеты.ПериодРегистрации,
		|	Вычеты.Регистратор,
		|	Вычеты.ФизическоеЛицо,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	ДатаПолученияДохода,
		|	КодВычета,
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации КАК ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	НДФЛРасчетыСБюджетом.Регистратор КАК Регистратор,
		|	НДФЛРасчетыСБюджетом.Подразделение КАК Подразделение,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Начислено,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.СуммаСПревышения
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоСПревышения,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.СуммаСПревышенияПоСтавке18
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоСПревышенияПоСтавке18,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.СуммаСПревышенияПоСтавке20
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоСПревышенияПоСтавке20,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.СуммаСПревышенияПоСтавке22
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоСПревышенияПоСтавке22,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Зачтено,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.Регистратор,
		|	НДФЛРасчетыСБюджетом.Подразделение,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	Ставка,
		|	ПериодРегистрации,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	ДатаПолученияДохода,
		|	Регистратор";
		
	Иначе
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТаблицаНДФЛ.ФизическоеЛицо,
		|	ТаблицаНДФЛ.Статус,
		|	ТаблицаНДФЛ.Период,
		|	ТаблицаНДФЛ.КатегорияДохода,
		|	ТаблицаНДФЛ.СтавкаНалогообложенияРезидента,
		|	ТаблицаНДФЛ.СтавкаНДФЛ,
		|	ТаблицаНДФЛ.СтавкаЧислом
		|ПОМЕСТИТЬ ВТСтавкаНДФЛСУчетомИзмененияСтатуса
		|ИЗ
		|	ВТСтавкаНДФЛПоСтавкеРезидента КАК ТаблицаНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ВТСтавкаНДФЛПоСтавкеРезидента";
		Запрос.Выполнить();
		
		УчетНДФЛ.СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета", "НеУчитыватьИзмененияСтатуса");
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КатегорияДохода КАК КатегорияДохода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК СтавкаНДФЛ,
		|	ВЫБОР
		|		КОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА Доходы.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|		КОГДА Доходы.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
		|		ИНАЧЕ Доходы.КатегорияДохода
		|	КОНЕЦ КАК НалоговаяБаза,
		|	Доходы.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.СуммаДохода КАК СуммаДохода,
		|	Доходы.СуммаВычета КАК СуммаВычета,
		|	Доходы.КодВычета КАК КодВычета,
		|	Доходы.Регистратор КАК Регистратор,
		|	Доходы.ДокументОснование КАК ДокументОснование,
		|	Доходы.ДанныеДляОтчета КАК ДанныеДляОтчета,
		|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	Доходы.УстаревшаяДатаПолученияДохода <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|		И Доходы.ДатаПолученияДохода <> Доходы.УстаревшаяДатаПолученияДохода КАК ДатаПолученияДоходаПеренесена
		|ПОМЕСТИТЬ ВТДоходыОбъектаОбложения
		|ИЗ
		|	ВТДоходы КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛСУчетомИзмененияСтатуса КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	(НЕ Доходы.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ДистанционныйРаботник)
		|				И Доходы.КатегорияДохода В (&ДоходыОтТрудовойДеятельности)
		|				И Доходы.ДатаПолученияДохода >= ДАТАВРЕМЯ(2024, 1, 1, 0, 0, 0))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ ПЕРВЫЕ 0
		|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
		|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) КАК НалоговаяБаза,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК МесяцНалоговогоПериода
		|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	База.ФизическоеЛицо КАК ФизическоеЛицо,
		|	База.НалоговаяБаза КАК НалоговаяБаза
		|ПОМЕСТИТЬ ВТСотрудникиСПревышением
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
		|		ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
		|		ДоходыПоСтавкам.СуммаДохода - ДоходыПоСтавкам.СуммаВычета КАК ОблагаемаяБаза
		|	ИЗ
		|		ВТДоходыОбъектаОбложения КАК ДоходыПоСтавкам
		|	ГДЕ
		|		ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтандартныеИмущественныеВычеты.ФизическоеЛицо,
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		-СтандартныеИмущественныеВычеты.СуммаВычета
		|	ИЗ
		|		ВТВычеты КАК СтандартныеИмущественныеВычеты) КАК База
		|
		|СГРУППИРОВАТЬ ПО
		|	База.ФизическоеЛицо,
		|	База.НалоговаяБаза
		|
		|ИМЕЮЩИЕ
		|	СУММА(База.ОблагаемаяБаза) > &Предел";
		Если Запрос.Выполнить().Выгрузить()[0].Количество > 0 Тогда
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.ДатаПолученияДохода, МЕСЯЦ) КАК НачалоМесяца,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза КАК НалоговаяБаза,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода - СведенияОДоходахНДФЛ.СуммаВычета) КАК ОблагаемыйДоход,
			|	0 КАК ОблагаемыйДоходСНачалаГода,
			|	ЛОЖЬ КАК ЭтоДеньПревышенияПредела,
			|	ЛОЖЬ КАК ПределПревышен
			|ИЗ
			|	ВТДоходыОбъектаОбложения КАК СведенияОДоходахНДФЛ
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.НалоговаяБаза = СотрудникиСПревышением.НалоговаяБаза
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.НалоговаяБаза
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	НалоговаяБаза,
			|	Период";
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СУММА(СтандартныеИмущественныеВычеты.СуммаВычета) КАК Сумма,
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяца
			|ИЗ
			|	ВТВычеты КАК СтандартныеИмущественныеВычеты
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСПревышением КАК СотрудникиСПревышением
			|		ПО СтандартныеИмущественныеВычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
			|			И (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда) = СотрудникиСПревышением.НалоговаяБаза)
			|
			|СГРУППИРОВАТЬ ПО
			|	СтандартныеИмущественныеВычеты.ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СтандартныеИмущественныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ)";
			ТаблицаВычетов = Запрос.Выполнить().Выгрузить();
			ИскатьВычеты = ТаблицаВычетов.Количество() > 0;
			Если ИскатьВычеты И ТаблицаВычетов.Количество() > 100 Тогда
				ТаблицаВычетов.Индексы.Добавить("ФизическоеЛицо,НачалоМесяца");
			КонецЕсли;
			ПоискВычетов = Новый Структура("ФизическоеЛицо,НачалоМесяца");
			
			// Расчет облагаемого дохода нарастающим итогом с учетом всех вычетов для каждой даты получения дохода.
			ОблагаемыйДоходСНачалаГода = 0;
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			ТекущееНачалоМесяца = Неопределено;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					ОблагаемыйДоходСНачалаГода = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
					ТекущееНачалоМесяца = Неопределено;
				КонецЕсли;
				// Стандартные, имущественные вычеты учтем один раз за каждый месяц - в первую дату получения дохода месяца.
				ПредоставленныеВычеты = 0;
				Если ИскатьВычеты И СтрокаТаблицы.НалоговаяБаза = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда И ТекущееНачалоМесяца <> СтрокаТаблицы.НачалоМесяца Тогда
					ЗаполнитьЗначенияСвойств(ПоискВычетов, СтрокаТаблицы);
					СтрокиВычетов = ТаблицаВычетов.НайтиСтроки(ПоискВычетов);
					Если СтрокиВычетов.Количество() > 0 Тогда
						ПредоставленныеВычеты = СтрокиВычетов[0].Сумма;
					КонецЕсли;
					ТекущееНачалоМесяца = СтрокаТаблицы.НачалоМесяца;
				КонецЕсли;
				СтрокаТаблицы.ЭтоДеньПревышенияПредела = ОблагаемыйДоходСНачалаГода < ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел И ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
				ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода + СтрокаТаблицы.ОблагаемыйДоход - ПредоставленныеВычеты;
				СтрокаТаблицы.ОблагаемыйДоходСНачалаГода = ОблагаемыйДоходСНачалаГода;
				СтрокаТаблицы.ПределПревышен = ОблагаемыйДоходСНачалаГода > ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
			КонецЦикла;
			
			Запрос.УстановитьПараметр("РасчетНарастающимИтогом", ТаблицаРасчетаНарастающимИтогом); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РасчетНарастающимИтогом.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасчетНарастающимИтогом.Период КАК Период,
			|	РасчетНарастающимИтогом.НалоговаяБаза КАК НалоговаяБаза,
			|	РасчетНарастающимИтогом.ОблагаемыйДоход КАК ОблагаемыйДоход,
			|	РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела КАК ЭтоДеньПревышенияПредела,
			|	РасчетНарастающимИтогом.ПределПревышен КАК ПределПревышен
			|ПОМЕСТИТЬ ВТРасчетНарастающимИтогом
			|ИЗ
			|	&РасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДоходыПоСтавкам.СтавкаНДФЛ КАК Ставка,
			|	ДоходыПоСтавкам.Регистратор КАК Регистратор,
			|	ДоходыПоСтавкам.ДокументОснование КАК ДокументОснование,
			|	ДоходыПоСтавкам.ДатаПолученияДоходаПеренесена КАК ДатаПолученияДоходаПеренесена,
			|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыПоСтавкам.Месяц КАК Месяц,
			|	ДоходыПоСтавкам.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
			|	ДоходыПоСтавкам.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыПоСтавкам.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыПоСтавкам.КодДохода КАК КодДохода,
			|	ДоходыПоСтавкам.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
			|	ДоходыПоСтавкам.КодДоходаСтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
			|	ДоходыПоСтавкам.СуммаДохода КАК СуммаДохода,
			|	ДоходыПоСтавкам.КодВычета КАК КодВычета,
			|	ДоходыПоСтавкам.СуммаВычета КАК СуммаВычета,
			|	ДоходыПоСтавкам.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоходСНачалаГода, 0) КАК ОблагаемыйДоходСНачалаГода,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ЭтоДеньПревышенияПредела, ЛОЖЬ) КАК ЭтоДеньПревышенияПредела,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ПределПревышен, ЛОЖЬ) КАК ПределПревышен,
			|	ЕСТЬNULL(РасчетНарастающимИтогом.ОблагаемыйДоход, 0) КАК ОблагаемыйДоходЗаДень
			|ПОМЕСТИТЬ ВТРасширенныеДанныеОДоходах
			|ИЗ
			|	ВТДоходыОбъектаОбложения КАК ДоходыПоСтавкам
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетНарастающимИтогом КАК РасчетНарастающимИтогом
			|		ПО ДоходыПоСтавкам.ФизическоеЛицо = РасчетНарастающимИтогом.ФизическоеЛицо
			|			И ДоходыПоСтавкам.ДатаПолученияДохода = РасчетНарастающимИтогом.Период
			|			И ДоходыПоСтавкам.НалоговаяБаза = РасчетНарастающимИтогом.НалоговаяБаза
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.ДатаПолученияДохода КАК Период,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза
			|ПОМЕСТИТЬ ВТФизлицаБезПереносаДат
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.ДатаПолученияДохода,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза
			|
			|ИМЕЮЩИЕ
			|	МАКСИМУМ(РасширенныеДанныеОДоходах.ДатаПолученияДоходаПеренесена) = ЛОЖЬ И
			|	МИНИМУМ(РасширенныеДанныеОДоходах.ДанныеДляОтчета) = ЛОЖЬ И
			|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ РасширенныеДанныеОДоходах.ДокументОснование) > 1
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизлицаБезПереносаДат.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ФизлицаБезПереносаДат.Период КАК Период,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.ДокументОснование КАК ДокументОснование,
			|	ФизлицаБезПереносаДат.НалоговаяБаза КАК НалоговаяБаза
			|ПОМЕСТИТЬ ВТОтборОснований
			|ИЗ
			|	ВТФизлицаБезПереносаДат КАК ФизлицаБезПереносаДат
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|		ПО ФизлицаБезПереносаДат.ФизическоеЛицо = РасширенныеДанныеОДоходах.ФизическоеЛицо
			|			И ФизлицаБезПереносаДат.НалоговаяБаза = РасширенныеДанныеОДоходах.НалоговаяБаза
			|			И ФизлицаБезПереносаДат.Период = РасширенныеДанныеОДоходах.ДатаПолученияДохода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ОтборОснований.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ОтборОснований.Период КАК ДатаПолученияДохода,
			|	ОтборОснований.НалоговаяБаза КАК НалоговаяБаза,
			|	ОтборОснований.ДокументОснование КАК ДокументОснование,
			|	ВЫБОР
			|		КОГДА СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) <> 0
			|				И СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) = 0
			|			ТОГДА 1
			|		КОГДА СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) <> 0
			|				И СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) = 0
			|			ТОГДА 2
			|		ИНАЧЕ 0
			|	КОНЕЦ КАК ОписаниеДокумента
			|ПОМЕСТИТЬ ВТОснованияВДниПревышения
			|ИЗ
			|	ВТОтборОснований КАК ОтборОснований
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
			|		ПО ОтборОснований.ФизическоеЛицо = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо
			|			И ОтборОснований.КатегорияДохода = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода
			|			И ОтборОснований.Период = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода
			|			И ОтборОснований.ДокументОснование = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование
			|ГДЕ
			|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
			|
			|СГРУППИРОВАТЬ ПО
			|	ОтборОснований.ФизическоеЛицо,
			|	ОтборОснований.Период,
			|	ОтборОснований.НалоговаяБаза,
			|	ОтборОснований.ДокументОснование
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	РасширенныеДанныеОДоходах.Ставка КАК Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.Месяц КАК Месяц,
			|	РасширенныеДанныеОДоходах.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
			|	РасширенныеДанныеОДоходах.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	РасширенныеДанныеОДоходах.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
			|	РасширенныеДанныеОДоходах.КодДоходаСтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода КАК ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень КАК ОблагаемыйДоходЗаДень,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода) КАК СуммаДохода,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаВычета) КАК СуммаВычета,
			|	СУММА(РасширенныеДанныеОДоходах.СуммаДохода - РасширенныеДанныеОДоходах.СуммаВычета) КАК ОблагаемаяСумма,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ЕСТЬNULL(ОснованияВДниПревышения.ОписаниеДокумента, 0) КАК ОписаниеДокументаСПревышением
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияВДниПревышения КАК ОснованияВДниПревышения
			|		ПО РасширенныеДанныеОДоходах.ФизическоеЛицо = ОснованияВДниПревышения.ФизическоеЛицо
			|			И РасширенныеДанныеОДоходах.НалоговаяБаза = ОснованияВДниПревышения.НалоговаяБаза
			|			И РасширенныеДанныеОДоходах.ДокументОснование = ОснованияВДниПревышения.ДокументОснование
			|			И РасширенныеДанныеОДоходах.ДатаПолученияДохода = ОснованияВДниПревышения.ДатаПолученияДохода
			|ГДЕ
			|	РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|СГРУППИРОВАТЬ ПО
			|	РасширенныеДанныеОДоходах.Ставка,
			|	РасширенныеДанныеОДоходах.Регистратор,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.ДатаПолученияДохода,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода,
			|	РасширенныеДанныеОДоходах.МесяцНалоговогоПериода,
			|	РасширенныеДанныеОДоходах.Месяц,
			|	РасширенныеДанныеОДоходах.КодДохода,
			|	РасширенныеДанныеОДоходах.КодВычета,
			|	РасширенныеДанныеОДоходах.КодДоходаКодДляОтчетности,
			|	РасширенныеДанныеОДоходах.КодДоходаСтавкаНалогообложенияРезидента,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходСНачалаГода,
			|	РасширенныеДанныеОДоходах.ОблагаемыйДоходЗаДень,
			|	ЕСТЬNULL(ОснованияВДниПревышения.ОписаниеДокумента, 0),
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета
			|
			|УПОРЯДОЧИТЬ ПО
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КодДохода";
			
			ТаблицаРасчетаНарастающимИтогом = Запрос.Выполнить().Выгрузить();
			ДоходыСУточненнымиСтавками = ТаблицаРасчетаНарастающимИтогом.СкопироватьКолонки();
			
			ТекущееФизлицо = Неопределено;
			ТекущаяНалоговаяБаза = Неопределено;
			СтрокиРаспределения = Новый Массив;
			ОблагаемыйДоходДоПредела = 0;
			Для каждого СтрокаТаблицы Из ТаблицаРасчетаНарастающимИтогом Цикл
				Если ТекущееФизлицо <> СтрокаТаблицы.ФизическоеЛицо Или ТекущаяНалоговаяБаза <> СтрокаТаблицы.НалоговаяБаза Тогда
					Если ОблагаемыйДоходДоПредела <> 0 Тогда
						ВыделитьСуммыПревышенияПредела2024(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
					КонецЕсли;
					СтрокиРаспределения = Новый Массив;
					ОблагаемыйДоходДоПредела = 0;
					ТекущееФизлицо = СтрокаТаблицы.ФизическоеЛицо;
					ТекущаяНалоговаяБаза = СтрокаТаблицы.НалоговаяБаза;
				КонецЕсли;
				Если ОблагаемыйДоходДоПредела = 0 Тогда
					ОблагаемыйДоходДоПредела = СтрокаТаблицы.ОблагаемыйДоходЗаДень - СтрокаТаблицы.ОблагаемыйДоходСНачалаГода + ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел
				КонецЕсли;
				СтрокиРаспределения.Добавить(СтрокаТаблицы);
			КонецЦикла;
			Если ОблагаемыйДоходДоПредела <> 0 Тогда
				ВыделитьСуммыПревышенияПредела2024(ОблагаемыйДоходДоПредела, СтрокиРаспределения, ДоходыСУточненнымиСтавками)				
			КонецЕсли;
			
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРасчетаНарастающимИтогом, ДоходыСУточненнымиСтавками); ТаблицаРасчетаНарастающимИтогом = Неопределено;
			
			Запрос.УстановитьПараметр("ДоходыСУточненнымиСтавками", ДоходыСУточненнымиСтавками); ДоходыСУточненнымиСтавками = Неопределено;
			Запрос.Текст =
			"УНИЧТОЖИТЬ ВТДоходыОбъектаОбложения
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА ДоходыСУточненнымиСтавками.ОписаниеДокументаСПревышением = 2
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ ДоходыСУточненнымиСтавками.Ставка
			|	КОНЕЦ КАК Ставка,
			|	ДоходыСУточненнымиСтавками.Регистратор КАК Регистратор,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.Месяц КАК Месяц,
			|	ДоходыСУточненнымиСтавками.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
			|	ДоходыСУточненнымиСтавками.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза КАК НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода КАК КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
			|	ДоходыСУточненнымиСтавками.КодДоходаСтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
			|	ДоходыСУточненнымиСтавками.КодДохода КАК КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода КАК СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета КАК КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыСУточненнымиСтавками
			|ИЗ
			|	&ДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА РасширенныеДанныеОДоходах.ПределПревышен
			|			ТОГДА &СтавкаСПревышения
			|		ИНАЧЕ РасширенныеДанныеОДоходах.Ставка
			|	КОНЕЦ КАК СтавкаНДФЛ,
			|	РасширенныеДанныеОДоходах.Регистратор КАК Регистратор,
			|	РасширенныеДанныеОДоходах.Месяц КАК Месяц,
			|	РасширенныеДанныеОДоходах.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
			|	РасширенныеДанныеОДоходах.ФизическоеЛицо КАК ФизическоеЛицо,
			|	РасширенныеДанныеОДоходах.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	РасширенныеДанныеОДоходах.НалоговаяБаза КАК НалоговаяБаза,
			|	РасширенныеДанныеОДоходах.КатегорияДохода КАК КатегорияДохода,
			|	РасширенныеДанныеОДоходах.ДанныеДляОтчета КАК ДанныеДляОтчета,
			|	РасширенныеДанныеОДоходах.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
			|	РасширенныеДанныеОДоходах.КодДоходаСтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
			|	РасширенныеДанныеОДоходах.КодДохода КАК КодДохода,
			|	РасширенныеДанныеОДоходах.СуммаДохода КАК СуммаДохода,
			|	РасширенныеДанныеОДоходах.КодВычета КАК КодВычета,
			|	РасширенныеДанныеОДоходах.СуммаВычета КАК СуммаВычета
			|ПОМЕСТИТЬ ВТДоходыОбъектаОбложения
			|ИЗ
			|	ВТРасширенныеДанныеОДоходах КАК РасширенныеДанныеОДоходах
			|ГДЕ
			|	НЕ РасширенныеДанныеОДоходах.ЭтоДеньПревышенияПредела
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ДоходыСУточненнымиСтавками.Ставка,
			|	ДоходыСУточненнымиСтавками.Регистратор,
			|	ДоходыСУточненнымиСтавками.Месяц,
			|	ДоходыСУточненнымиСтавками.МесяцНалоговогоПериода,
			|	ДоходыСУточненнымиСтавками.ФизическоеЛицо,
			|	ДоходыСУточненнымиСтавками.ДатаПолученияДохода,
			|	ДоходыСУточненнымиСтавками.НалоговаяБаза,
			|	ДоходыСУточненнымиСтавками.КатегорияДохода,
			|	ДоходыСУточненнымиСтавками.ДанныеДляОтчета,
			|	ДоходыСУточненнымиСтавками.КодДоходаКодДляОтчетности,
			|	ДоходыСУточненнымиСтавками.КодДоходаСтавкаНалогообложенияРезидента,
			|	ДоходыСУточненнымиСтавками.КодДохода,
			|	ДоходыСУточненнымиСтавками.СуммаДохода,
			|	ДоходыСУточненнымиСтавками.КодВычета,
			|	ДоходыСУточненнымиСтавками.СуммаВычета
			|ИЗ
			|	ВТДоходыСУточненнымиСтавками КАК ДоходыСУточненнымиСтавками";
			Запрос.Выполнить();
			
			Если ИскатьВычеты Тогда
				Запрос.Текст =
				"УНИЧТОЖИТЬ ВТМесяцыПослеПревышения
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ДоходыПоСтавкам.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ДоходыПоСтавкам.НалоговаяБаза КАК НалоговаяБаза,
				|	ДоходыПоСтавкам.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТУникальныеМесяцы
				|ИЗ
				|	ВТДоходыОбъектаОбложения КАК ДоходыПоСтавкам
				|ГДЕ
				|	ДоходыПоСтавкам.НалоговаяБаза <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)
				|
				|СГРУППИРОВАТЬ ПО
				|	ДоходыПоСтавкам.НалоговаяБаза,
				|	ДоходыПоСтавкам.ФизическоеЛицо,
				|	ДоходыПоСтавкам.МесяцНалоговогоПериода
				|
				|ИМЕЮЩИЕ
				|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДоходыПоСтавкам.СтавкаНДФЛ) = 1
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	МесяцыУникальныхКБК.ФизическоеЛицо КАК ФизическоеЛицо,
				|	МесяцыУникальныхКБК.НалоговаяБаза КАК НалоговаяБаза,
				|	МесяцыУникальныхКБК.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
				|ПОМЕСТИТЬ ВТМесяцыПослеПревышения
				|ИЗ
				|	ВТУникальныеМесяцы КАК МесяцыУникальныхКБК
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыОбъектаОбложения КАК ДоходыПоСтавкам
				|		ПО МесяцыУникальныхКБК.ФизическоеЛицо = ДоходыПоСтавкам.ФизическоеЛицо
				|			И МесяцыУникальныхКБК.НалоговаяБаза = ДоходыПоСтавкам.НалоговаяБаза
				|			И МесяцыУникальныхКБК.МесяцНалоговогоПериода = ДоходыПоСтавкам.МесяцНалоговогоПериода
				|ГДЕ
				|	ДоходыПоСтавкам.СтавкаНДФЛ = &СтавкаСПревышения";
				Запрос.Выполнить();
			КонецЕсли;
		КонецЕсли;
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоходыИВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(ДоходыИВычеты.ОбщаяСуммаДохода) КАК ОбщаяСуммаДохода,
		|	СУММА(ДоходыИВычеты.ОблагаемаяСуммаДохода) КАК ОблагаемаяСуммаДохода,
		|	ДоходыИВычеты.СтавкаНДФЛ КАК Ставка
		|ПОМЕСТИТЬ ВТИтогиДоходов
		|ИЗ
		|	(ВЫБРАТЬ
		|		Доходы.ДатаПолученияДохода КАК Период,
		|		Доходы.СуммаДохода КАК ОбщаяСуммаДохода,
		|		Доходы.СуммаДохода - Доходы.СуммаВычета КАК ОблагаемаяСуммаДохода,
		|		Доходы.СтавкаНДФЛ КАК СтавкаНДФЛ,
		|		Доходы.КатегорияДохода КАК КатегорияДохода,
		|		Доходы.ФизическоеЛицо КАК ФизическоеЛицо
		|	ИЗ
		|		ВТДоходыОбъектаОбложения КАК Доходы
		|	ГДЕ
		|		Доходы.ДанныеДляОтчета
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Вычеты.МесяцНалоговогоПериода,
		|		0,
		|		-Вычеты.СуммаВычета,
		|		ВЫБОР
		|			КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|		КОНЕЦ,
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		Вычеты.ФизическоеЛицо
		|	ИЗ
		|		ВТВычеты КАК Вычеты
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТМесяцыПослеПревышения КАК СотрудникиСПревышением
		|			ПО Вычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
		|				И (НАЧАЛОПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ) = СотрудникиСПревышением.МесяцНалоговогоПериода)
		|				И (СотрудникиСПревышением.НалоговаяБаза = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда))
		|	ГДЕ
		|		Вычеты.ДанныеДляОтчета) КАК ДоходыИВычеты
		|
		|СГРУППИРОВАТЬ ПО
		|	ДоходыИВычеты.ФизическоеЛицо,
		|	ДоходыИВычеты.СтавкаНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ЗачтеноАвансовыхПлатежейЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА (НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|						ИЛИ НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК УдержаноЗаТекущийГод,
		|	0 КАК ВозвращеноЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|						И (НДФЛРасчетыСБюджетом.ПериодРегистрации МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПереданоНаВзысканиеЗаТекущийГод,
		|	НДФЛРасчетыСБюджетом.СтавкаНДФЛ КАК Ставка,
		|	ЕСТЬNULL(СУММА(НДФЛРасчетыСБюджетом.НалогНаПрибыльДляДивидендов), 0) КАК НалогНаПрибыльДляДивидендов,
		|	ЕСТЬNULL(СУММА(НДФЛРасчетыСБюджетом.НалогСДивидендовУплаченныйЗаРубежом), 0) КАК НалогСДивидендовУплаченныйЗаРубежом,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|						И (НДФЛРасчетыСБюджетом.ПериодРегистрации МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.СуммаДоходаСКоторогоНеУдержанНалог
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК СуммаДоходаСКоторогоНеУдержанНалог
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	(ВЫБРАТЬ
		|		СтрокиНалогов.ВидДвижения КАК ВидДвижения,
		|		СтрокиНалогов.ВариантУдержания КАК ВариантУдержания,
		|		СтрокиНалогов.Сумма КАК Сумма,
		|		СтрокиНалогов.ФизическоеЛицо КАК ФизическоеЛицо,
		|		СтрокиНалогов.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|		СтрокиНалогов.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		СтрокиНалогов.ПериодРегистрации КАК ПериодРегистрации,
		|		СтрокиНалогов.КатегорияДохода КАК КатегорияДохода,
		|		ВЫБОР
		|			КОГДА СтрокиНалогов.СуммаСПревышения = 0
		|				ТОГДА СтрокиНалогов.СуммаДоходаСКоторогоНеУдержанНалог
		|			ИНАЧЕ 0
		|		КОНЕЦ КАК СуммаДоходаСКоторогоНеУдержанНалог,
		|		СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК СтавкаНДФЛ,
		|		ВЫБОР
		|			КОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов * СтрокиНалогов.Сумма > 0
		|				ТОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов - ВЫБОР
		|						КОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов * СтрокиНалогов.СуммаСПревышения > 0
		|							ТОГДА ВЫБОР
		|									КОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов * СтрокиНалогов.НалогНаПрибыльДляДивидендов < СтрокиНалогов.СуммаСПревышения * СтрокиНалогов.СуммаСПревышения
		|										ТОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов
		|									ИНАЧЕ СтрокиНалогов.СуммаСПревышения
		|								КОНЕЦ
		|						ИНАЧЕ 0
		|					КОНЕЦ
		|			ИНАЧЕ 0
		|		КОНЕЦ КАК НалогНаПрибыльДляДивидендов,
		|		ВЫБОР
		|			КОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом * СтрокиНалогов.Сумма > 0
		|				ТОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом - ВЫБОР
		|						КОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом * СтрокиНалогов.СуммаСПревышения > 0
		|							ТОГДА ВЫБОР
		|									КОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом * СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом < СтрокиНалогов.СуммаСПревышения * СтрокиНалогов.СуммаСПревышения
		|										ТОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом
		|									ИНАЧЕ СтрокиНалогов.СуммаСПревышения
		|								КОНЕЦ
		|						ИНАЧЕ 0
		|					КОНЕЦ
		|			ИНАЧЕ 0
		|		КОНЕЦ КАК НалогСДивидендовУплаченныйЗаРубежом
		|	ИЗ
		|		ВТСтрокиНалогов КАК СтрокиНалогов
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛСУчетомИзмененияСтатуса КАК СтавкаНДФЛПоСтавкеРезидента
		|			ПО СтрокиНалогов.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|				И СтрокиНалогов.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|				И СтрокиНалогов.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|				И СтрокиНалогов.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтрокиНалогов.ВидДвижения,
		|		СтрокиНалогов.ВариантУдержания,
		|		СтрокиНалогов.СуммаСПревышения,
		|		СтрокиНалогов.ФизическоеЛицо,
		|		СтрокиНалогов.СтавкаНалогообложенияРезидента,
		|		СтрокиНалогов.МесяцНалоговогоПериода,
		|		СтрокиНалогов.ПериодРегистрации,
		|		СтрокиНалогов.КатегорияДохода,
		|		ВЫБОР
		|			КОГДА СтрокиНалогов.СуммаСПревышения > 0
		|				ТОГДА СтрокиНалогов.СуммаДоходаСКоторогоНеУдержанНалог
		|			ИНАЧЕ 0
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Нерезидент)
		|				ТОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов * СтрокиНалогов.СуммаСПревышения > 0
		|				ТОГДА ВЫБОР
		|						КОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов * СтрокиНалогов.НалогНаПрибыльДляДивидендов < СтрокиНалогов.СуммаСПревышения * СтрокиНалогов.СуммаСПревышения
		|							ТОГДА СтрокиНалогов.НалогНаПрибыльДляДивидендов
		|						ИНАЧЕ СтрокиНалогов.СуммаСПревышения
		|					КОНЕЦ
		|			ИНАЧЕ 0
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом * СтрокиНалогов.СуммаСПревышения > 0
		|				ТОГДА ВЫБОР
		|						КОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом * СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом < СтрокиНалогов.СуммаСПревышения * СтрокиНалогов.СуммаСПревышения
		|							ТОГДА СтрокиНалогов.НалогСДивидендовУплаченныйЗаРубежом
		|						ИНАЧЕ СтрокиНалогов.СуммаСПревышения
		|					КОНЕЦ
		|			ИНАЧЕ 0
		|		КОНЕЦ
		|	ИЗ
		|		ВТСтрокиНалогов КАК СтрокиНалогов
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛСУчетомИзмененияСтатуса КАК СтавкаНДФЛПоСтавкеРезидента
		|			ПО СтрокиНалогов.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|				И СтрокиНалогов.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|				И СтрокиНалогов.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|				И СтрокиНалогов.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода) КАК НДФЛРасчетыСБюджетом
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.СтавкаНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	КОНЕЦПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(НДФЛРасчетыСБюджетом.Сумма) КАК Налог
		|ПОМЕСТИТЬ ВТУдержаноНДФЛПо13или30ПоМесяцам
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛСУчетомИзмененияСтатуса КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛБезУчетаИзмененияСтатуса
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛБезУчетаИзмененияСтатуса.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛБезУчетаИзмененияСтатуса.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛБезУчетаИзмененияСтатуса.Период
		|			И НДФЛРасчетыСБюджетом.КатегорияДохода = СтавкаНДФЛБезУчетаИзмененияСтатуса.КатегорияДохода
		|ГДЕ
		|	НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НДФЛРасчетыСБюджетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|	И НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане
		|	И СтавкаНДФЛБезУчетаИзмененияСтатуса.СтавкаНДФЛ В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30))
		|
		|СГРУППИРОВАТЬ ПО
		|	КОНЕЦПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, МЕСЯЦ),
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК СтавкаПоСтатусу,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке30.Налог, 0) КАК УдержаноНДФЛПоСтавке30,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке13.Налог, 0) КАК УдержаноНДФЛПоСтавке13,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК СуммаРасход
		|ПОМЕСТИТЬ ВТПеречисленоПоСтавке13_30
		|ИЗ
		|	ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке13
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке13.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке13.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке13.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке30
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке30.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке30.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке30.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30))
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛСУчетомИзмененияСтатуса КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|			И (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13) = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента)
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|	И НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам";
        Запрос.Выполнить();
		
		Если НалоговыйПериод < 2023 Тогда
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	Перечислено.Ставка КАК Ставка,
			|	СУММА(Перечислено.Сумма) КАК Сумма,
			|	Перечислено.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТПеречисленоНДФЛ
			|ИЗ
			|	(ВЫБРАТЬ
			|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка КАК Ставка,
			|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
			|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК Сумма
			|	ИЗ
			|		ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
			|	ГДЕ
			|		НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
			|		И НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ВЫБОР
			|			КОГДА РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
			|				ТОГДА ВЫБОР
			|						КОГДА РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода < ДАТАВРЕМЯ(2021, 1, 1, 0, 0, 0)
			|							ТОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
			|						КОГДА СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
			|							ТОГДА РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка
			|						ИНАЧЕ СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
			|					КОНЕЦ
			|			ИНАЧЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка
			|		КОНЕЦ,
			|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо,
			|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход
			|	ИЗ
			|		ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
			|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛСУчетомИзмененияСтатуса КАК СтавкаНДФЛПоСтавкеРезидента
			|			ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
			|				И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
			|				И (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09) = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента)
			|				И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
			|	ГДЕ
			|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30),
			|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
			|		ВЫБОР
			|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
			|				ТОГДА 0
			|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
			|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
			|			ИНАЧЕ ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0))
			|		КОНЕЦ
			|	ИЗ
			|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13),
			|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
			|		ВЫБОР
			|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
			|				ТОГДА 0
			|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 = 0
			|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
			|			ИНАЧЕ ПеречисленоПоСтавке13_30.СуммаРасход - (ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0)))
			|		КОНЕЦ
			|	ИЗ
			|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
			|	
			|	ОБЪЕДИНИТЬ ВСЕ
			|	
			|	ВЫБРАТЬ
			|		ПеречисленоПоСтавке13_30.СтавкаПоСтатусу,
			|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
			|		ВЫБОР
			|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
			|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
			|			ИНАЧЕ 0
			|		КОНЕЦ
			|	ИЗ
			|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30) КАК Перечислено
			|
			|СГРУППИРОВАТЬ ПО
			|	Перечислено.Ставка,
			|	Перечислено.ФизическоеЛицо
			|
			|ИМЕЮЩИЕ
			|	СУММА(Перечислено.Сумма) <> 0
			|";
		Иначе
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	НЕОПРЕДЕЛЕНО КАК Ставка,
			|	0 КАК Сумма,
			|	НЕОПРЕДЕЛЕНО КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТПеречисленоНДФЛ"
			
		КонецЕсли;
		Запрос.Выполнить();
			
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	Доходы.СтавкаНДФЛ КАК Ставка,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
		|	Доходы.КодВычета КАК КодВычета,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.НалоговаяБаза КАК НалоговаяБаза
		|ПОМЕСТИТЬ ВТДоходыПоМесяцам
		|ИЗ
		|	ВТДоходыОбъектаОбложения КАК Доходы
		|ГДЕ
		|	Доходы.Месяц ЕСТЬ НЕ NULL 
		|	И Доходы.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.Месяц,
		|	Доходы.МесяцНалоговогоПериода,
		|	Доходы.СтавкаНДФЛ,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодВычета,
		|	Доходы.НалоговаяБаза
		|
		|ИМЕЮЩИЕ
		|	(СУММА(Доходы.СуммаДохода) <> 0
		|		ИЛИ СУММА(Доходы.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.Ставка КАК Ставка
		|ПОМЕСТИТЬ ВТОсобыеМесяцы
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодДохода,
		|	Доходы.Месяц,
		|	Доходы.Ставка
		|
		|ИМЕЮЩИЕ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
		|			КОГДА Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|				ТОГДА 0
		|			ИНАЧЕ 1
		|		КОНЕЦ) = 2
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода КАК КодДохода,
		|	МесяцыОсобыхВычетов.Месяц КАК Месяц,
		|	МАКСИМУМ(Доходы.КодВычета) КАК КодВычета,
		|	МесяцыОсобыхВычетов.Ставка КАК Ставка
		|ПОМЕСТИТЬ ВТСтрокиСУказаннымВычетом
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|			И МесяцыОсобыхВычетов.Ставка = Доходы.Ставка
		|ГДЕ
		|	Доходы.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	МесяцыОсобыхВычетов.Ставка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода КАК КодДохода,
		|	МесяцыОсобыхВычетов.Месяц КАК Месяц,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	МесяцыОсобыхВычетов.Ставка КАК Ставка
		|ПОМЕСТИТЬ ВТДоходыИзСтрокБезВычетов
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|			И МесяцыОсобыхВычетов.Ставка = Доходы.Ставка
		|ГДЕ
		|	Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	МесяцыОсобыхВычетов.Ставка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Доходы.Месяц КАК МесяцНалоговогоПериода,
		|	Доходы.Ставка КАК Ставка,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
		|	Доходы.КодВычета КАК КодВычета,
		|	Доходы.СуммаДохода + ВЫБОР
		|		КОГДА СтрокиСУказаннымВычетом.ФизическоеЛицо ЕСТЬ NULL
		|			ТОГДА 0
		|		ИНАЧЕ ЕСТЬNULL(ДоходыИзСтрокБезВычетов.СуммаДохода, 0)
		|	КОНЕЦ КАК СуммаДохода,
		|	Доходы.СуммаВычета КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо КАК Сотрудник,
		|	Доходы.НалоговаяБаза КАК НалоговаяБаза,
		|	ЛОЖЬ КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОсобыеМесяцы КАК СтрокиБезКодаВычета
		|		ПО Доходы.ФизическоеЛицо = СтрокиБезКодаВычета.ФизическоеЛицо
		|			И Доходы.КодДохода = СтрокиБезКодаВычета.КодДохода
		|			И Доходы.Месяц = СтрокиБезКодаВычета.Месяц
		|			И (Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))
		|			И Доходы.Ставка = СтрокиБезКодаВычета.Ставка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыИзСтрокБезВычетов КАК ДоходыИзСтрокБезВычетов
		|		ПО Доходы.ФизическоеЛицо = ДоходыИзСтрокБезВычетов.ФизическоеЛицо
		|			И Доходы.Месяц = ДоходыИзСтрокБезВычетов.Месяц
		|			И Доходы.КодДохода = ДоходыИзСтрокБезВычетов.КодДохода
		|			И Доходы.Ставка = ДоходыИзСтрокБезВычетов.Ставка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиСУказаннымВычетом КАК СтрокиСУказаннымВычетом
		|		ПО Доходы.ФизическоеЛицо = СтрокиСУказаннымВычетом.ФизическоеЛицо
		|			И Доходы.Месяц = СтрокиСУказаннымВычетом.Месяц
		|			И Доходы.КодДохода = СтрокиСУказаннымВычетом.КодДохода
		|			И Доходы.КодВычета = СтрокиСУказаннымВычетом.КодВычета
		|			И Доходы.Ставка = СтрокиСУказаннымВычетом.Ставка
		|ГДЕ
		|	СтрокиБезКодаВычета.ФизическоеЛицо ЕСТЬ NULL
		|
		|УПОРЯДОЧИТЬ ПО
		|	Ставка,
		|	МесяцНалоговогоПериода,
		|	Доходы.КодДоходаКодДляОтчетности
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.КодВычета КАК КодВычета,
		|	Вычеты.КодВычетаГруппаВычета КАК ГруппаВычета,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года КАК КодВычетаКод,
		|	ЛОЖЬ КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	ВЫБОР
		|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|	КОНЕЦ КАК Ставка,
		|	Вычеты.ФизическоеЛицо КАК Сотрудник
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМесяцыПослеПревышения КАК СотрудникиСПревышением
		|		ПО Вычеты.ФизическоеЛицо = СотрудникиСПревышением.ФизическоеЛицо
		|			И (НАЧАЛОПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ) = СотрудникиСПревышением.МесяцНалоговогоПериода)
		|			И (СотрудникиСПревышением.НалоговаяБаза = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда))
		|ГДЕ
		|	Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|	И Вычеты.ДанныеДляОтчета
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА СотрудникиСПревышением.ФизическоеЛицо ЕСТЬ NULL
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|	КОНЕЦ,
		|	Вычеты.КодВычета,
		|	Вычеты.КодВычетаГруппаВычета,
		|	Вычеты.ФизическоеЛицо,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	КодВычетаКод
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СотрудникиОрганизаций.ФизическоеЛицо КАК Сотрудник,
		|	ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) КАК Ставка,
		|	ИтогиДоходов.ОбщаяСуммаДохода КАК ОбщаяСуммаДохода,
		|	ИтогиДоходов.ОблагаемаяСуммаДохода КАК ОблагаемаяСуммаДохода,
		|	Налоги.НачисленоЗаТекущийГод КАК Исчислено,
		|	Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод КАК ЗачтеноАвансовыхПлатежей,
		|	Налоги.НалогНаПрибыльДляДивидендов КАК НалогНаПрибыльДляДивидендов,
		|	Налоги.НалогСДивидендовУплаченныйЗаРубежом КАК НалогСДивидендовУплаченныйЗаРубежом,
		|	Налоги.УдержаноЗаТекущийГод - Налоги.ВозвращеноЗаТекущийГод КАК Удержано,
		|	ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) КАК Перечислено,
		|	Налоги.ПереданоНаВзысканиеЗаТекущийГод КАК Задолженность,
		|	Налоги.СуммаДоходаСКоторогоНеУдержанНалог КАК СуммаДоходаНеудержанного,
		|	ВЫБОР
		|		КОГДА Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод - Налоги.НалогНаПрибыльДляДивидендов + Налоги.ВозвращеноЗаТекущийГод < 0
		|			ТОГДА -(Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод - Налоги.НалогНаПрибыльДляДивидендов + Налоги.ВозвращеноЗаТекущийГод)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ИзлишнеУдержано,
		|	ЛОЖЬ КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТФизлица КАК СотрудникиОрганизаций
		|		ЛЕВОЕ СОЕДИНЕНИЕ Перечисление.НДФЛСтавки КАК Ставки
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиДоходов КАК ИтогиДоходов
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИтогиДоходов.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ИтогиДоходов.Ставка)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК Налоги
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = Налоги.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = Налоги.Ставка)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПеречисленоНДФЛ КАК ПеречисленоНДФЛ
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ПеречисленоНДФЛ.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ПеречисленоНДФЛ.Ставка)
		|ГДЕ
		|	(ИтогиДоходов.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (ИтогиДоходов.ОбщаяСуммаДохода <> 0
		|					ИЛИ ИтогиДоходов.ОблагаемаяСуммаДохода <> 0)
		|			ИЛИ Налоги.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (Налоги.НачисленоЗаТекущийГод <> 0
		|					ИЛИ Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод <> 0)
		|			ИЛИ ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) <> 0)";		
		
	КонецЕсли;
	
	Результаты = Запрос.ВыполнитьПакет();
	ВсегоЗапросов = Результаты.Количество();
	
	Возврат Новый Структура("Доходы, Вычеты, Налоги", 
						Результаты[ВсегоЗапросов - 3].Выгрузить(), 
						Результаты[ВсегоЗапросов - 2].Выгрузить(), 
						Результаты[ВсегоЗапросов - 1].Выгрузить());
КонецФункции

Функция ДанныеОДоходахНалогахВычетах2020(Сотрудники, НалоговыйПериод, Организация, РегистрацияВНалоговомОргане, ДатаАктуальности, КППОтправки, ПодробныеДанные, ДополнительныйОтбор)
	
	Если НалоговыйПериод < 2017 Тогда
		Возврат ДанныеОДоходахНалогахВычетах2016(Сотрудники, НалоговыйПериод, Организация, РегистрацияВНалоговомОргане, ДатаАктуальности, КППОтправки, ПодробныеДанные)
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("Организация",Организация);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ГодНП",НалоговыйПериод);
	НачалоНалоговогоПериода = Дата(НалоговыйПериод, 1, 1);
	КонецНалоговогоПериода = КонецГода(НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("КонецНП",КонецНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоНП", НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоСледующегоНП", КонецНалоговогоПериода + 1); // Начало следующего налогового периода.
	Запрос.УстановитьПараметр("ДатаПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности));
	Запрос.УстановитьПараметр("ДатаДоПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности) - 1);
	Запрос.УстановитьПараметр("ЧитатьСводныеДанные", РегистрацияВНалоговомОргане = Неопределено Или ПодробныеДанные);
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	УчитыватьПереездВДругуюИФНС = ЗначениеЗаполнено(РегистрацияВНалоговомОргане) И ЗначениеЗаполнено(КППОтправки) И Не ПодробныеДанные И ОбщегоНазначения.ЗначениеРеквизитаОбъекта(РегистрацияВНалоговомОргане, "КПП") <> КППОтправки;
	Запрос.УстановитьПараметр("УчитыватьПереездВДругуюИФНС", УчитыватьПереездВДругуюИФНС);
	Запрос.УстановитьПараметр("КППОтправки", КППОтправки);
	Запрос.УстановитьПараметр("Сотрудники", Сотрудники);
	Запрос.УстановитьПараметр("ДополнительныйОтбор", Истина);
	Запрос.УстановитьПараметр("ДатаОбъединенияВсехСведений", УчетНДФЛ.ДатаВозвратаДоходовПоЦеннымБумагамИзДекларацииПоПрибыли());
	
	// АПК:96-выкл Использование ОБЪЕДИНИТЬ для таблицы ВТСтрокиУчета необходимо
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	СписокСотрудников.Ссылка КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВТФизлица
	|ИЗ
	|	Справочник.ФизическиеЛица КАК СписокСотрудников
	|ГДЕ
	|	СписокСотрудников.Ссылка В(&Сотрудники)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МЕСЯЦ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК Месяц,
	|	КОНЕЦПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК КонецГода,
	|	СведенияОДоходахНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2010Года КАК КодДоходаКодДляОтчетности,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|			ТОГДА 0
	|		ИНАЧЕ СведенияОДоходахНДФЛ.СуммаВычета
	|	КОНЕЦ КАК СуммаВычета,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
	|	КОНЕЦ КАК КодВычета,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаОбъединенияВсехСведений
	|		И СведенияОДоходахНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
	|	СведенияОДоходахНДФЛ.Сотрудник КАК Сотрудник,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
	|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТДоходы
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизлица КАК Сотрудники
	|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
	|			И (СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (&ЧитатьСводныеДанные
	|					И СведенияОДоходахНДФЛ.Организация = &Организация
	|				ИЛИ СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|			И (СведенияОДоходахНДФЛ.Период <= &ДатаПодачиСведений)
	|			И (&ДополнительныйОтбор)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
	|	СУММА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма) КАК СуммаОборот,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода < &ДатаОбъединенияВсехСведений
	|		И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор КАК Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение КАК Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|ИЗ
	|	ВТФизлица КАК Сотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
	|		ПО Сотрудники.ФизическоеЛицо = ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо
	|ГДЕ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период <= &ДатаПодачиСведений
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП
	|	И (&ЧитатьСводныеДанные
	|				И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Организация = &Организация
	|			ИЛИ ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|	И &ДополнительныйОтбор
	|
	|СГРУППИРОВАТЬ ПО
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода < &ДатаОбъединенияВсехСведений
	|		И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета КАК КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.СуммаОборот КАК СуммаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета.ГруппаВычета КАК КодВычетаГруппаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Регистратор КАК Регистратор,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ПериодРегистрации КАК ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Подразделение КАК Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТВычеты
	|ИЗ
	|	ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ИмущественныеВычетыНДФЛ.КодВычета,
	|	ИмущественныеВычетыНДФЛ.Сумма,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	СотрудникиОрганизаций.ФизическоеЛицо,
	|	ИмущественныеВычетыНДФЛ.КодВычета.ГруппаВычета,
	|	ЛОЖЬ,
	|	ИмущественныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.МесяцРегистрации, МЕСЯЦ),
	|	ИмущественныеВычетыНДФЛ.Подразделение,
	|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|ИЗ
	|	ВТФизлица КАК СотрудникиОрганизаций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
	|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИмущественныеВычетыНДФЛ.ФизическоеЛицо
	|			И (ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход))
	|			И (ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ДатаПодачиСведений)
	|			И (ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (ИмущественныеВычетыНДФЛ.Год = &ГодНП)
	|			И (&ЧитатьСводныеДанные
	|					И ИмущественныеВычетыНДФЛ.Организация = &Организация
	|				ИЛИ ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|			И (&ДополнительныйОтбор)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	НДФЛРасчетыСБюджетом.ВариантУдержания КАК ВариантУдержания,
	|	НДФЛРасчетыСБюджетом.ВидДвижения КАК ВидДвижения,
	|	НДФЛРасчетыСБюджетом.Сумма КАК Сумма,
	|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	НДФЛРасчетыСБюджетом.КатегорияДохода КАК КатегорияДохода,
	|	НДФЛРасчетыСБюджетом.КодДохода КАК КодДохода,
	|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода < &ДатаОбъединенияВсехСведений
	|		И НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	НДФЛРасчетыСБюджетом.Регистратор КАК Регистратор,
	|	НАЧАЛОПЕРИОДА(НДФЛРасчетыСБюджетом.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	НДФЛРасчетыСБюджетом.Подразделение КАК Подразделение
	|ПОМЕСТИТЬ ВТСтрокиНалогов
	|ИЗ
	|	ВТФизлица КАК СправкиОДоходах
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК НДФЛРасчетыСБюджетом
	|		ПО СправкиОДоходах.ФизическоеЛицо = НДФЛРасчетыСБюджетом.ФизическоеЛицо
	|			И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (НДФЛРасчетыСБюджетом.Период < &ДатаПодачиСведений)
	|			И (НДФЛРасчетыСБюджетом.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (&ЧитатьСводныеДанные
	|					И НДФЛРасчетыСБюджетом.Организация = &Организация
	|				ИЛИ НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|			И (&ДополнительныйОтбор)
	|ГДЕ
	|	НДФЛРасчетыСБюджетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Перечислено.Ставка КАК Ставка,
	|	Перечислено.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(Перечислено.СуммаРасход) КАК СуммаРасход,
	|	Перечислено.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ВЫБОР
	|		КОГДА Перечислено.ИсчисленоПоДивидендам
	|			ТОГДА ВЫБОР
	|					КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка05)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05)
	|					КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка10)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10)
	|					КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка12)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|				КОНЕЦ
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка03)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка05)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка06)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка07)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка10)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10)
	|		КОГДА Перечислено.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
	|	КОНЕЦ КАК КатегорияДохода,
	|	Перечислено.ИсчисленоПоДивидендам КАК ИсчисленоПоДивидендам
	|ПОМЕСТИТЬ ВТПеречисленоНДФЛПоМесяцам
	|ИЗ
	|	(ВЫБРАТЬ
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка КАК Ставка,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК СуммаРасход,
	|		КОНЕЦПЕРИОДА(РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода < &ДатаОбъединенияВсехСведений
	|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам КАК ИсчисленоПоДивидендам
	|	ИЗ
	|		РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(
	|				&НачалоНП,
	|				&ДатаДоПодачиСведений,
	|				,
	|				ФизическоеЛицо В
	|						(ВЫБРАТЬ
	|							ФизическиеЛица.ФизическоеЛицо
	|						ИЗ
	|							ВТФизлица КАК ФизическиеЛица)
	|					И (МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|					И (&ЧитатьСводныеДанные
	|							И Организация = &Организация
	|						ИЛИ РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты) КАК Перечислено
	|
	|СГРУППИРОВАТЬ ПО
	|	Перечислено.Ставка,
	|	Перечислено.ФизическоеЛицо,
	|	Перечислено.МесяцНалоговогоПериода,
	|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	Перечислено.ИсчисленоПоДивидендам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Доходы.ДатаПолученияДохода КАК Период,
	|	Доходы.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Доходы.КатегорияДохода КАК КатегорияДохода
	|ПОМЕСТИТЬ ВТСтрокиУчета
	|ИЗ
	|	ВТДоходы КАК Доходы
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Вычеты.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
	|	Вычеты.ФизическоеЛицо,
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда)
	|ИЗ
	|	ВТВычеты КАК Вычеты
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтрокиНалогов.МесяцНалоговогоПериода,
	|	СтрокиНалогов.СтавкаНалогообложенияРезидента,
	|	СтрокиНалогов.ФизическоеЛицо,
	|	СтрокиНалогов.КатегорияДохода
	|ИЗ
	|	ВТСтрокиНалогов КАК СтрокиНалогов
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПеречисленоНДФЛПоМесяцам.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
	|	ПеречисленоНДФЛПоМесяцам.ФизическоеЛицо,
	|	ПеречисленоНДФЛПоМесяцам.КатегорияДохода
	|ИЗ
	|	ВТПеречисленоНДФЛПоМесяцам КАК ПеречисленоНДФЛПоМесяцам
	|ГДЕ
	|	НЕ ПеречисленоНДФЛПоМесяцам.ИсчисленоПоДивидендам
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПеречисленоНДФЛПоМесяцам.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09),
	|	ПеречисленоНДФЛПоМесяцам.ФизическоеЛицо,
	|	ПеречисленоНДФЛПоМесяцам.КатегорияДохода
	|ИЗ
	|	ВТПеречисленоНДФЛПоМесяцам КАК ПеречисленоНДФЛПоМесяцам
	|ГДЕ
	|	ПеречисленоНДФЛПоМесяцам.ИсчисленоПоДивидендам";
	// АПК:96-вкл 
	Запрос.Текст = ?(ЗначениеЗаполнено(ДополнительныйОтбор), СтрЗаменить(ТекстЗапроса, "&ДополнительныйОтбор", ДополнительныйОтбор), ТекстЗапроса);
	Запрос.Выполнить();
	
	СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета", "НеУчитыватьИзмененияСтатуса");
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ТаблицаНДФЛ.ФизическоеЛицо,
	|	ТаблицаНДФЛ.Статус,
	|	ТаблицаНДФЛ.Период,
	|	ТаблицаНДФЛ.КатегорияДохода,
	|	ТаблицаНДФЛ.СтавкаНалогообложенияРезидента,
	|	ТаблицаНДФЛ.СтавкаНДФЛ,
	|	ТаблицаНДФЛ.СтавкаЧислом
	|ПОМЕСТИТЬ ВТСтавкаНДФЛБезУчетаИзмененияСтатуса
	|ИЗ
	|	ВТСтавкаНДФЛПоСтавкеРезидента КАК ТаблицаНДФЛ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТСтавкаНДФЛПоСтавкеРезидента";
	Запрос.Выполнить();
	
	СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета", "УчитыватьИзмененияСтатусаДляОтчетности");
	
	Если ПодробныеДанные Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	Доходы.ПериодРегистрации КАК ПериодРегистрации,
		|	Доходы.Сотрудник КАК Сотрудник,
		|	Доходы.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение КАК Подразделение,
		|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	Доходы.Регистратор КАК Регистратор,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодВычета,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета
		|ИЗ
		|	ВТДоходы КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	(НЕ Доходы.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ПериодРегистрации,
		|	Доходы.Сотрудник,
		|	Доходы.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение,
		|	Доходы.КодВычета,
		|	Доходы.Регистратор,
		|	Доходы.ДатаПолученияДохода
		|
		|ИМЕЮЩИЕ
		|	(СУММА(Доходы.СуммаДохода) <> 0
		|		ИЛИ СУММА(Доходы.СуммаВычета) <> 0)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	Ставка,
		|	ПериодРегистрации,
		|	Сотрудник,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	ДатаПолученияДохода,
		|	КодДохода,
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Вычеты.ПериодРегистрации КАК ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13) КАК Ставка,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК ДатаПолученияДохода,
		|	Вычеты.Подразделение,
		|	Вычеты.Регистратор КАК Регистратор,
		|	Вычеты.КодВычета КАК КодВычета,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|ГДЕ
		|	Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Вычеты.КодВычета,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	Вычеты.ПериодРегистрации,
		|	Вычеты.Регистратор,
		|	Вычеты.ФизическоеЛицо,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	ДатаПолученияДохода,
		|	КодВычета,
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации КАК ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	НДФЛРасчетыСБюджетом.Регистратор КАК Регистратор,
		|	НДФЛРасчетыСБюджетом.Подразделение КАК Подразделение,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Начислено,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Зачтено,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.Регистратор,
		|	НДФЛРасчетыСБюджетом.Подразделение,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	Ставка,
		|	ПериодРегистрации,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	ДатаПолученияДохода,
		|	Регистратор";
		
	Иначе
		
		Если УчитыватьПереездВДругуюИФНС Тогда
			
			СформироватьВТФизическиеЛицаСУчетомПереездаВИнойНО(КППОтправки, Запрос.МенеджерВременныхТаблиц, "ВТДоходы", "КонецГода");
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	Доходы.ФизическоеЛицо
			|ПОМЕСТИТЬ ВТЛишниеФизическиеЛица
			|ИЗ
			|	ВТФизлица КАК Доходы
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСУчетомПереездаВИнойНО КАК ФизическиеЛицаСУчетомПереездаВИнойНО
			|		ПО Доходы.ФизическоеЛицо = ФизическиеЛицаСУчетомПереездаВИнойНО.ФизическоеЛицо
			|ГДЕ
			|	ФизическиеЛицаСУчетомПереездаВИнойНО.ФизическоеЛицо ЕСТЬ NULL ";
			
		Иначе
			
			Запрос.Текст = 
			"ВЫБРАТЬ ПЕРВЫЕ 0
			|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТЛишниеФизическиеЛица";
			
		КонецЕсли;
		Запрос.Выполнить();
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КатегорияДохода КАК КатегорияДохода,
		|	Доходы.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.СуммаДохода КАК СуммаДохода,
		|	Доходы.СуммаВычета КАК СуммаВычета,
		|	Доходы.КодВычета КАК КодВычета,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Доходы.Регистратор КАК Регистратор,
		|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода
		|ПОМЕСТИТЬ ВТДоходыОбъектаОбложения
		|ИЗ
		|	ВТДоходы КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	(НЕ Доходы.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДоходыИВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(ДоходыИВычеты.ОбщаяСуммаДохода) КАК ОбщаяСуммаДохода,
		|	СУММА(ДоходыИВычеты.ОблагаемаяСуммаДохода) КАК ОблагаемаяСуммаДохода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ДоходыИВычеты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТИтогиДоходов
		|ИЗ
		|	(ВЫБРАТЬ
		|		Доходы.ДатаПолученияДохода КАК Период,
		|		Доходы.СуммаДохода КАК ОбщаяСуммаДохода,
		|		Доходы.СуммаДохода - Доходы.СуммаВычета КАК ОблагаемаяСуммаДохода,
		|		Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|		Доходы.КатегорияДохода КАК КатегорияДохода,
		|		Доходы.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|		Доходы.ФизическоеЛицо КАК ФизическоеЛицо
		|	ИЗ
		|		ВТДоходыОбъектаОбложения КАК Доходы
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Вычеты.МесяцНалоговогоПериода,
		|		0,
		|		-Вычеты.СуммаВычета,
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
		|		ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда),
		|		Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|		Вычеты.ФизическоеЛицо
		|	ИЗ
		|		ВТВычеты КАК Вычеты) КАК ДоходыИВычеты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО ДоходыИВычеты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И ДоходыИВычеты.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И ДоходыИВычеты.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И ДоходыИВычеты.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	ДоходыИВычеты.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	ДоходыИВычеты.ВключатьВДекларациюПоНалогуНаПрибыль
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ЗачтеноАвансовыхПлатежейЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА (НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|						ИЛИ НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК УдержаноЗаТекущийГод,
		|	0 КАК ВозвращеноЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПереданоНаВзысканиеЗаТекущийГод,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	КОНЕЦПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СУММА(НДФЛРасчетыСБюджетом.Сумма) КАК Налог,
		|	ВЫБОР
		|		КОГДА НДФЛРасчетыСБюджетом.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
		|			ТОГДА НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТУдержаноНДФЛПо13или30ПоМесяцам
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛБезУчетаИзмененияСтатуса КАК СтавкаНДФЛБезУчетаИзмененияСтатуса
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛБезУчетаИзмененияСтатуса.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛБезУчетаИзмененияСтатуса.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛБезУчетаИзмененияСтатуса.Период
		|			И НДФЛРасчетыСБюджетом.КатегорияДохода = СтавкаНДФЛБезУчетаИзмененияСтатуса.КатегорияДохода
		|ГДЕ
		|	НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НДФЛРасчетыСБюджетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|	И НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане
		|	И СтавкаНДФЛБезУчетаИзмененияСтатуса.СтавкаНДФЛ В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30))
		|
		|СГРУППИРОВАТЬ ПО
		|	КОНЕЦПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, МЕСЯЦ),
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	ВЫБОР
		|		КОГДА НДФЛРасчетыСБюджетом.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
		|			ТОГДА НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК СтавкаПоСтатусу,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке30.Налог, 0) КАК УдержаноНДФЛПоСтавке30,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке13.Налог, 0) КАК УдержаноНДФЛПоСтавке13,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК СуммаРасход,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТПеречисленоПоСтавке13_30
		|ИЗ
		|	ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке13
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке13.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке13.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке13.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль = УдержаноНДФЛПоСтавке13.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке30
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке30.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке30.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке30.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30))
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль = УдержаноНДФЛПоСтавке30.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|			И (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13) = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента)
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|	И НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Перечислено.Ставка КАК Ставка,
		|	СУММА(Перечислено.Сумма) КАК Сумма,
		|	Перечислено.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТПеречисленоНДФЛ
		|ИЗ
		|	(ВЫБРАТЬ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка КАК Ставка,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК Сумма,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|	ГДЕ
		|		НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|		И НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВЫБОР
		|			КОГДА РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
		|				ТОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
		|			ИНАЧЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка
		|		КОНЕЦ,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|			ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|				И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|				И (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09) = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента)
		|				И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|	ГДЕ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30),
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА 0
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0))
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13),
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА 0
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ ПеречисленоПоСтавке13_30.СуммаРасход - (ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0)))
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ПеречисленоПоСтавке13_30.СтавкаПоСтатусу,
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ 0
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30) КАК Перечислено
		|
		|СГРУППИРОВАТЬ ПО
		|	Перечислено.Ставка,
		|	Перечислено.ФизическоеЛицо,
		|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль
		|
		|ИМЕЮЩИЕ
		|	СУММА(Перечислено.Сумма) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.КодВычета КАК КодВычета,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТДоходыПоМесяцам
		|ИЗ
		|	ВТДоходыОбъектаОбложения КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
		|ГДЕ
		|	Доходы.Месяц ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.Месяц,
		|	Доходы.МесяцНалоговогоПериода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодВычета
		|
		|ИМЕЮЩИЕ
		|	(СУММА(Доходы.СуммаДохода) <> 0
		|		ИЛИ СУММА(Доходы.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.Ставка КАК Ставка
		|ПОМЕСТИТЬ ВТОсобыеМесяцы
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодДохода,
		|	Доходы.Месяц,
		|	Доходы.Ставка
		|
		|ИМЕЮЩИЕ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
		|			КОГДА Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|				ТОГДА 0
		|			ИНАЧЕ 1
		|		КОНЕЦ) = 2
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода КАК КодДохода,
		|	МесяцыОсобыхВычетов.Месяц КАК Месяц,
		|	МАКСИМУМ(Доходы.КодВычета) КАК КодВычета,
		|	МесяцыОсобыхВычетов.Ставка КАК Ставка
		|ПОМЕСТИТЬ ВТСтрокиСУказаннымВычетом
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|			И МесяцыОсобыхВычетов.Ставка = Доходы.Ставка
		|ГДЕ
		|	Доходы.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	МесяцыОсобыхВычетов.Ставка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода КАК КодДохода,
		|	МесяцыОсобыхВычетов.Месяц КАК Месяц,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	МесяцыОсобыхВычетов.Ставка КАК Ставка
		|ПОМЕСТИТЬ ВТДоходыИзСтрокБезВычетов
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|			И МесяцыОсобыхВычетов.Ставка = Доходы.Ставка
		|ГДЕ
		|	Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	МесяцыОсобыхВычетов.Ставка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Доходы.Месяц КАК МесяцНалоговогоПериода,
		|	Доходы.Ставка КАК Ставка,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности КАК КодДоходаКодДляОтчетности,
		|	Доходы.КодВычета КАК КодВычета,
		|	Доходы.СуммаДохода + ВЫБОР
		|		КОГДА СтрокиСУказаннымВычетом.ФизическоеЛицо ЕСТЬ NULL
		|			ТОГДА 0
		|		ИНАЧЕ ЕСТЬNULL(ДоходыИзСтрокБезВычетов.СуммаДохода, 0)
		|	КОНЕЦ КАК СуммаДохода,
		|	Доходы.СуммаВычета КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо КАК Сотрудник,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛишниеФизическиеЛица КАК ЛишниеФизическиеЛица
		|		ПО Доходы.ФизическоеЛицо = ЛишниеФизическиеЛица.ФизическоеЛицо
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОсобыеМесяцы КАК СтрокиБезКодаВычета
		|		ПО Доходы.ФизическоеЛицо = СтрокиБезКодаВычета.ФизическоеЛицо
		|			И Доходы.КодДохода = СтрокиБезКодаВычета.КодДохода
		|			И Доходы.Месяц = СтрокиБезКодаВычета.Месяц
		|			И (Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))
		|			И Доходы.Ставка = СтрокиБезКодаВычета.Ставка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыИзСтрокБезВычетов КАК ДоходыИзСтрокБезВычетов
		|		ПО Доходы.ФизическоеЛицо = ДоходыИзСтрокБезВычетов.ФизическоеЛицо
		|			И Доходы.Месяц = ДоходыИзСтрокБезВычетов.Месяц
		|			И Доходы.КодДохода = ДоходыИзСтрокБезВычетов.КодДохода
		|			И Доходы.ВключатьВДекларациюПоНалогуНаПрибыль = ДоходыИзСтрокБезВычетов.ВключатьВДекларациюПоНалогуНаПрибыль
		|			И Доходы.Ставка = ДоходыИзСтрокБезВычетов.Ставка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиСУказаннымВычетом КАК СтрокиСУказаннымВычетом
		|		ПО Доходы.ФизическоеЛицо = СтрокиСУказаннымВычетом.ФизическоеЛицо
		|			И Доходы.Месяц = СтрокиСУказаннымВычетом.Месяц
		|			И Доходы.КодДохода = СтрокиСУказаннымВычетом.КодДохода
		|			И Доходы.КодВычета = СтрокиСУказаннымВычетом.КодВычета
		|			И Доходы.Ставка = СтрокиСУказаннымВычетом.Ставка
		|ГДЕ
		|	ЛишниеФизическиеЛица.ФизическоеЛицо ЕСТЬ NULL
		|	И СтрокиБезКодаВычета.ФизическоеЛицо ЕСТЬ NULL
		|
		|УПОРЯДОЧИТЬ ПО
		|	Ставка,
		|	МесяцНалоговогоПериода,
		|	Доходы.КодДоходаКодДляОтчетности
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.КодВычета КАК КодВычета,
		|	Вычеты.КодВычетаГруппаВычета КАК ГруппаВычета,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13) КАК Ставка,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года КАК КодВычетаКод,
		|	Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Вычеты.ФизическоеЛицо КАК Сотрудник
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛишниеФизическиеЛица КАК ЛишниеФизическиеЛица
		|		ПО Вычеты.ФизическоеЛицо = ЛишниеФизическиеЛица.ФизическоеЛицо
		|ГДЕ
		|	ЛишниеФизическиеЛица.ФизическоеЛицо ЕСТЬ NULL
		|	И Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Вычеты.КодВычета,
		|	Вычеты.КодВычетаГруппаВычета,
		|	Вычеты.ФизическоеЛицо,
		|	Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	КодВычетаКод
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СотрудникиОрганизаций.ФизическоеЛицо КАК Сотрудник,
		|	ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) КАК Ставка,
		|	ИтогиДоходов.ОбщаяСуммаДохода КАК ОбщаяСуммаДохода,
		|	ИтогиДоходов.ОблагаемаяСуммаДохода КАК ОблагаемаяСуммаДохода,
		|	Налоги.НачисленоЗаТекущийГод КАК Исчислено,
		|	Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод КАК ЗачтеноАвансовыхПлатежей,
		|	Налоги.УдержаноЗаТекущийГод - Налоги.ВозвращеноЗаТекущийГод КАК Удержано,
		|	ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) КАК Перечислено,
		|	ВЫБОР
		|		КОГДА Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод > 0
		|			ТОГДА Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Задолженность,
		|	ВЫБОР
		|		КОГДА Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод < 0
		|			ТОГДА -(Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ИзлишнеУдержано,
		|	НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТФизлица КАК СотрудникиОрганизаций
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛишниеФизическиеЛица КАК ЛишниеФизическиеЛица
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ЛишниеФизическиеЛица.ФизическоеЛицо
		|		ЛЕВОЕ СОЕДИНЕНИЕ Перечисление.НДФЛСтавки КАК Ставки
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ИСТИНА КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|		
		|		ОБЪЕДИНИТЬ ВСЕ
		|		
		|		ВЫБРАТЬ
		|			ЛОЖЬ) КАК НалогНаПрибыль
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиДоходов КАК ИтогиДоходов
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИтогиДоходов.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ИтогиДоходов.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = ИтогиДоходов.ВключатьВДекларациюПоНалогуНаПрибыль)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК Налоги
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = Налоги.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = Налоги.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = Налоги.ВключатьВДекларациюПоНалогуНаПрибыль)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПеречисленоНДФЛ КАК ПеречисленоНДФЛ
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ПеречисленоНДФЛ.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ПеречисленоНДФЛ.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = ПеречисленоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль)
		|ГДЕ
		|	ЛишниеФизическиеЛица.ФизическоеЛицо ЕСТЬ NULL
		|	И (ИтогиДоходов.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (ИтогиДоходов.ОбщаяСуммаДохода <> 0
		|					ИЛИ ИтогиДоходов.ОблагаемаяСуммаДохода <> 0)
		|			ИЛИ Налоги.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (Налоги.НачисленоЗаТекущийГод <> 0
		|					ИЛИ Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод <> 0)
		|			ИЛИ ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) <> 0)";		
		
	КонецЕсли;
	
	Результаты = Запрос.ВыполнитьПакет();
	ВсегоЗапросов = Результаты.Количество();
	
	Возврат Новый Структура("Доходы, Вычеты, Налоги", 
						Результаты[ВсегоЗапросов - 3].Выгрузить(), 
						Результаты[ВсегоЗапросов - 2].Выгрузить(), 
						Результаты[ВсегоЗапросов - 1].Выгрузить());
КонецФункции

// Возвращает структуру, содержащую таблицы значений с
// данными о доходах, налогах, вычетах.
//
// Параметры:
// 	Сотрудники - Массив - содержит физических лиц, по которым необходимо получить данные.
//	НалоговыйПериод - Число - номер года налогового периода.
//	Организация - организация, по которой получать доходы.
//	РегистрацияВНалоговомОргане - (необязательный), ссылка на регистрацию в налоговом органе, 
//									по которой отбирать данные.
//	ДатаАктуальности - Дата - (необязательный), дата ограничивающая период получаемых данных о доходах налогах и вычетах
//			если не задана, ограничением будет выступать текущая дата сеанса.
//	ПодробныеДанные - Булево - определяет подробность возвращаемых данных.
//
// Возвращаемое значение:
//	В варианте ПодробныеДанные = Ложь. Структура со следующими полями:
//		Доходы - таблица значений с колонками:
//			Сотрудник,
//			Ставка,
//			МесяцНалоговогоПериода,
//			КодДохода,
//			КодДоходаКодДляОтчетности,
//			КодВычета,
//			СуммаДохода,
//			СуммаВычета,
//			ВключатьВДекларациюПоНалогуНаПрибыль,
//		Вычеты - таблица значений с колонками:
//			Сотрудник
//			КодВычета,
//			КодВычетаКод,
//			СуммаВычета,
//			ВключатьВДекларациюПоНалогуНаПрибыль,
//		Налоги - таблица значений с колонками:
//			Сотрудник,
//			Ставка,
//			ОбщаяСуммаДохода,
//			ОблагаемаяСуммаДохода,
//			Исчислено,
//			Удержано,
//			Задолженность,
//			ИзлишнеУдержано,
//			Перечислено,
//			ВключатьВДекларациюПоНалогуНаПрибыль
//
//	В варианте ПодробныеДанные = Истина. Структура со следующими полями:
//		Доходы - таблица значений с колонками:
//			ФизическоеЛицо,
//			Сотрудник,
//			Ставка,
//			КодДохода,
//			КодВычета,
//			СуммаДохода,
//			СуммаВычета,
//			ПериодРегистрации,
//			СтавкаНалогообложенияРезидента,
//			Регистратор,
//			РегистрацияВНалоговомОргане,
//			Подразделение,
//			ДатаПолученияДохода,
//		Вычеты - таблица значений с колонками:
//			ФизическоеЛицо
//			КодВычета,
//			СуммаВычета,
//			ПериодРегистрации,
//			Регистратор,
//			РегистрацияВНалоговомОргане,
//			Подразделение,
//			ДатаПолученияДохода,
//		Налоги - таблица значений с колонками:
//			ФизическоеЛицо,
//			Ставка,
//			СтавкаНалогообложенияРезидента,
//			Начислено,
//			Зачтено,
//			Регистратор,
//			ПериодРегистрации,
//			РегистрацияВНалоговомОргане,
//			Подразделение,
//			ДатаПолученияДохода
//
Функция ДанныеОДоходахНалогахВычетах2016(Сотрудники, НалоговыйПериод, Организация, РегистрацияВНалоговомОргане, ДатаАктуальности, КППОтправки, ПодробныеДанные)
	
	Если НалоговыйПериод < Год(УчетНДФЛ.ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев()) Тогда
		Возврат ДанныеОДоходахНалогахВычетахСПомесячнойСтавкой(Сотрудники, НалоговыйПериод, Организация, РегистрацияВНалоговомОргане, ДатаАктуальности, ПодробныеДанные)
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("Организация",Организация);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ГодНП",НалоговыйПериод);
	НачалоНалоговогоПериода = Дата(НалоговыйПериод, 1, 1);
	КонецНалоговогоПериода = КонецГода(НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("КонецНП",КонецНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоНП", НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоСледующегоНП", КонецНалоговогоПериода + 1); // Начало следующего налогового периода.
	Запрос.УстановитьПараметр("ДатаПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности));
	Запрос.УстановитьПараметр("ДатаДоПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности) - 1);
	Запрос.УстановитьПараметр("ЧитатьСводныеДанные", РегистрацияВНалоговомОргане = Неопределено Или ПодробныеДанные);
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	УчитыватьПереездВДругуюИФНС = ЗначениеЗаполнено(РегистрацияВНалоговомОргане) И ЗначениеЗаполнено(КППОтправки) И Не ПодробныеДанные И ОбщегоНазначения.ЗначениеРеквизитаОбъекта(РегистрацияВНалоговомОргане, "КПП") <> КППОтправки;
	Запрос.УстановитьПараметр("УчитыватьПереездВДругуюИФНС", УчитыватьПереездВДругуюИФНС);
	Запрос.УстановитьПараметр("КППОтправки", КППОтправки);
	Запрос.УстановитьПараметр("Сотрудники", Сотрудники);
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СписокСотрудников.Ссылка КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВТФизлица
	|ИЗ
	|	Справочник.ФизическиеЛица КАК СписокСотрудников
	|ГДЕ
	|	СписокСотрудников.Ссылка В(&Сотрудники)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МЕСЯЦ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК Месяц,
	|	КОНЕЦПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК КонецГода,
	|	СведенияОДоходахНДФЛ.МесяцНалоговогоПериода,
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
	|	СведенияОДоходахНДФЛ.КодДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2010Года КАК КодДоходаКодДляОтчетности,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|			ТОГДА 0
	|		ИНАЧЕ СведенияОДоходахНДФЛ.СуммаВычета
	|	КОНЕЦ КАК СуммаВычета,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
	|	КОНЕЦ КАК КодВычета,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.Регистратор,
	|	СведенияОДоходахНДФЛ.Сотрудник,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	СведенияОДоходахНДФЛ.Подразделение,
	|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТДоходы
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизлица КАК Сотрудники
	|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
	|			И (СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (&ЧитатьСводныеДанные
	|					И СведенияОДоходахНДФЛ.Организация = &Организация
	|				ИЛИ СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|			И (СведенияОДоходахНДФЛ.Период <= &ДатаПодачиСведений)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
	|	СУММА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма) КАК СуммаОборот,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|ИЗ
	|	ВТФизлица КАК Сотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
	|		ПО Сотрудники.ФизическоеЛицо = ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо
	|ГДЕ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период <= &ДатаПодачиСведений
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП
	|	И (&ЧитатьСводныеДанные
	|				И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Организация = &Организация
	|			ИЛИ ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|
	|СГРУППИРОВАТЬ ПО
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета КАК КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.СуммаОборот КАК СуммаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета.ГруппаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Регистратор,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТВычеты
	|ИЗ
	|	ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ИмущественныеВычетыНДФЛ.КодВычета,
	|	ИмущественныеВычетыНДФЛ.Сумма,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	СотрудникиОрганизаций.ФизическоеЛицо,
	|	ИмущественныеВычетыНДФЛ.КодВычета.ГруппаВычета,
	|	ЛОЖЬ,
	|	ИмущественныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.МесяцРегистрации, МЕСЯЦ),
	|	ИмущественныеВычетыНДФЛ.Подразделение,
	|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|ИЗ
	|	ВТФизлица КАК СотрудникиОрганизаций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
	|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИмущественныеВычетыНДФЛ.ФизическоеЛицо
	|			И (ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход))
	|			И (ИмущественныеВычетыНДФЛ.МесяцРегистрации <= &ДатаПодачиСведений)
	|			И (ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (ИмущественныеВычетыНДФЛ.Год = &ГодНП)
	|			И (&ЧитатьСводныеДанные
	|					И ИмущественныеВычетыНДФЛ.Организация = &Организация
	|				ИЛИ ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
	|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане,
	|	НДФЛРасчетыСБюджетом.ВариантУдержания,
	|	НДФЛРасчетыСБюджетом.ВидДвижения,
	|	НДФЛРасчетыСБюджетом.Сумма,
	|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента,
	|	НДФЛРасчетыСБюджетом.КодДохода,
	|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
	|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	НДФЛРасчетыСБюджетом.Регистратор,
	|	НАЧАЛОПЕРИОДА(НДФЛРасчетыСБюджетом.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	НДФЛРасчетыСБюджетом.Подразделение
	|ПОМЕСТИТЬ ВТСтрокиНалогов
	|ИЗ
	|	ВТФизлица КАК СправкиОДоходах
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК НДФЛРасчетыСБюджетом
	|		ПО СправкиОДоходах.ФизическоеЛицо = НДФЛРасчетыСБюджетом.ФизическоеЛицо
	|			И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (НДФЛРасчетыСБюджетом.Период < &ДатаПодачиСведений)
	|			И (НДФЛРасчетыСБюджетом.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (&ЧитатьСводныеДанные
	|					И НДФЛРасчетыСБюджетом.Организация = &Организация
	|				ИЛИ НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Перечислено.Ставка,
	|	Перечислено.ФизическоеЛицо,
	|	СУММА(Перечислено.СуммаРасход) КАК СуммаРасход,
	|	Перечислено.МесяцНалоговогоПериода,
	|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	Перечислено.ИсчисленоПоДивидендам
	|ПОМЕСТИТЬ ВТПеречисленоНДФЛПоМесяцам
	|ИЗ
	|	(ВЫБРАТЬ
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка КАК Ставка,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК СуммаРасход,
	|		КОНЕЦПЕРИОДА(РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам КАК ИсчисленоПоДивидендам
	|	ИЗ
	|		РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(
	|				&НачалоНП,
	|				&ДатаДоПодачиСведений,
	|				,
	|				ФизическоеЛицо В
	|						(ВЫБРАТЬ
	|							ФизическиеЛица.ФизическоеЛицо
	|						ИЗ
	|							ВТФизлица КАК ФизическиеЛица)
	|					И (МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|					И (&ЧитатьСводныеДанные
	|							И Организация = &Организация
	|						ИЛИ РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты) КАК Перечислено
	|
	|СГРУППИРОВАТЬ ПО
	|	Перечислено.Ставка,
	|	Перечислено.ФизическоеЛицо,
	|	Перечислено.МесяцНалоговогоПериода,
	|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	Перечислено.ИсчисленоПоДивидендам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Доходы.ДатаПолученияДохода КАК Период,
	|	Доходы.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	Доходы.КодДохода КАК КодДохода,
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВТСтрокиУчета
	|ИЗ
	|	ВТДоходы КАК Доходы
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Вычеты.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
	|	ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.КодДоходаПоУмолчанию),
	|	Вычеты.ФизическоеЛицо
	|ИЗ
	|	ВТВычеты КАК Вычеты
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтрокиНалогов.МесяцНалоговогоПериода,
	|	СтрокиНалогов.СтавкаНалогообложенияРезидента,
	|	СтрокиНалогов.КодДохода,
	|	СтрокиНалогов.ФизическоеЛицо
	|ИЗ
	|	ВТСтрокиНалогов КАК СтрокиНалогов
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПеречисленоНДФЛПоМесяцам.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
	|	ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.КодДоходаПоУмолчанию),
	|	ПеречисленоНДФЛПоМесяцам.ФизическоеЛицо
	|ИЗ
	|	ВТПеречисленоНДФЛПоМесяцам КАК ПеречисленоНДФЛПоМесяцам
	|ГДЕ
	|	НЕ ПеречисленоНДФЛПоМесяцам.ИсчисленоПоДивидендам
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПеречисленоНДФЛПоМесяцам.МесяцНалоговогоПериода,
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09),
	|	ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010),
	|	ПеречисленоНДФЛПоМесяцам.ФизическоеЛицо
	|ИЗ
	|	ВТПеречисленоНДФЛПоМесяцам КАК ПеречисленоНДФЛПоМесяцам
	|ГДЕ
	|	ПеречисленоНДФЛПоМесяцам.ИсчисленоПоДивидендам";
	Запрос.Выполнить();
	
	СоздатьВТСтавкаНДФЛПоСтавкеРезидента2016(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета", "НеУчитыватьИзмененияСтатуса");
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ТаблицаНДФЛ.ФизическоеЛицо,
	|	ТаблицаНДФЛ.Статус,
	|	ТаблицаНДФЛ.Период,
	|	ТаблицаНДФЛ.КодДохода,
	|	ТаблицаНДФЛ.СтавкаНалогообложенияРезидента,
	|	ТаблицаНДФЛ.СтавкаНДФЛ,
	|	ТаблицаНДФЛ.СтавкаЧислом
	|ПОМЕСТИТЬ ВТСтавкаНДФЛБезУчетаИзмененияСтатуса
	|ИЗ
	|	ВТСтавкаНДФЛПоСтавкеРезидента КАК ТаблицаНДФЛ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТСтавкаНДФЛПоСтавкеРезидента";
	Запрос.Выполнить();
	
	СоздатьВТСтавкаНДФЛПоСтавкеРезидента2016(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета", "УчитыватьИзмененияСтатусаДляОтчетности");
	
	Если ПодробныеДанные Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	Доходы.ПериодРегистрации КАК ПериодРегистрации,
		|	Доходы.Сотрудник КАК Сотрудник,
		|	Доходы.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение КАК Подразделение,
		|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	Доходы.Регистратор КАК Регистратор,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодВычета,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета
		|ИЗ
		|	ВТДоходы КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|ГДЕ
		|	(НЕ Доходы.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ПериодРегистрации,
		|	Доходы.Сотрудник,
		|	Доходы.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение,
		|	Доходы.КодВычета,
		|	Доходы.Регистратор,
		|	Доходы.ДатаПолученияДохода
		|
		|ИМЕЮЩИЕ
		|	(СУММА(Доходы.СуммаДохода) <> 0
		|		ИЛИ СУММА(Доходы.СуммаВычета) <> 0)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	Ставка,
		|	ПериодРегистрации,
		|	Сотрудник,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	ДатаПолученияДохода,
		|	КодДохода,
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Вычеты.ПериодРегистрации КАК ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК ДатаПолученияДохода,
		|	Вычеты.Подразделение,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13) КАК Ставка,
		|	Вычеты.Регистратор КАК Регистратор,
		|	Вычеты.КодВычета КАК КодВычета,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|ГДЕ
		|	Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Вычеты.КодВычета,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	Вычеты.ПериодРегистрации,
		|	Вычеты.Регистратор,
		|	Вычеты.ФизическоеЛицо,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	ДатаПолученияДохода,
		|	КодВычета,
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации КАК ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	НДФЛРасчетыСБюджетом.Регистратор КАК Регистратор,
		|	НДФЛРасчетыСБюджетом.Подразделение КАК Подразделение,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Начислено,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Зачтено,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.Регистратор,
		|	НДФЛРасчетыСБюджетом.Подразделение,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	Ставка,
		|	ПериодРегистрации,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	ДатаПолученияДохода,
		|	Регистратор";
		
	Иначе
		
		Если УчитыватьПереездВДругуюИФНС Тогда
			
			СформироватьВТФизическиеЛицаСУчетомПереездаВИнойНО(КППОтправки, Запрос.МенеджерВременныхТаблиц, "ВТДоходы", "КонецГода");
			
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	Доходы.ФизическоеЛицо
			|ПОМЕСТИТЬ ВТЛишниеФизическиеЛица
			|ИЗ
			|	ВТФизлица КАК Доходы
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСУчетомПереездаВИнойНО КАК ФизическиеЛицаСУчетомПереездаВИнойНО
			|		ПО Доходы.ФизическоеЛицо = ФизическиеЛицаСУчетомПереездаВИнойНО.ФизическоеЛицо
			|ГДЕ
			|	ФизическиеЛицаСУчетомПереездаВИнойНО.ФизическоеЛицо ЕСТЬ NULL ";
			
		Иначе
			
			Запрос.Текст = 
			"ВЫБРАТЬ ПЕРВЫЕ 0
			|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТЛишниеФизическиеЛица";
			
		КонецЕсли;
		Запрос.Выполнить();
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.Месяц,
		|	Доходы.МесяцНалоговогоПериода,
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.СуммаДохода,
		|	Доходы.СуммаВычета,
		|	Доходы.КодВычета,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Доходы.Регистратор,
		|	Доходы.ДатаПолученияДохода
		|ПОМЕСТИТЬ ВТДоходыОбъектаОбложения
		|ИЗ
		|	ВТДоходы КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|ГДЕ
		|	(НЕ Доходы.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДоходыИВычеты.ФизическоеЛицо,
		|	СУММА(ДоходыИВычеты.ОбщаяСуммаДохода) КАК ОбщаяСуммаДохода,
		|	СУММА(ДоходыИВычеты.ОблагаемаяСуммаДохода) КАК ОблагаемаяСуммаДохода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ДоходыИВычеты.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТИтогиДоходов
		|ИЗ
		|	(ВЫБРАТЬ
		|		Доходы.ДатаПолученияДохода КАК Период,
		|		Доходы.СуммаДохода КАК ОбщаяСуммаДохода,
		|		Доходы.СуммаДохода - Доходы.СуммаВычета КАК ОблагаемаяСуммаДохода,
		|		Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|		Доходы.КодДохода КАК КодДохода,
		|		Доходы.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|		Доходы.ФизическоеЛицо КАК ФизическоеЛицо
		|	ИЗ
		|		ВТДоходыОбъектаОбложения КАК Доходы
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Вычеты.МесяцНалоговогоПериода,
		|		0,
		|		-Вычеты.СуммаВычета,
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
		|		ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.КодДоходаПоУмолчанию),
		|		Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|		Вычеты.ФизическоеЛицо
		|	ИЗ
		|		ВТВычеты КАК Вычеты) КАК ДоходыИВычеты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО ДоходыИВычеты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И ДоходыИВычеты.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И ДоходыИВычеты.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И ДоходыИВычеты.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	ДоходыИВычеты.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	ДоходыИВычеты.ВключатьВДекларациюПоНалогуНаПрибыль
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ЗачтеноАвансовыхПлатежейЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА (НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|						ИЛИ НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК УдержаноЗаТекущийГод,
		|	0 КАК ВозвращеноЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПереданоНаВзысканиеЗаТекущийГод,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	КОНЕЦПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	СУММА(НДФЛРасчетыСБюджетом.Сумма) КАК Налог,
		|	ВЫБОР
		|		КОГДА НДФЛРасчетыСБюджетом.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
		|			ТОГДА НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТУдержаноНДФЛПо13или30ПоМесяцам
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛБезУчетаИзмененияСтатуса КАК СтавкаНДФЛБезУчетаИзмененияСтатуса
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛБезУчетаИзмененияСтатуса.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛБезУчетаИзмененияСтатуса.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода = СтавкаНДФЛБезУчетаИзмененияСтатуса.Период
		|			И НДФЛРасчетыСБюджетом.КодДохода = СтавкаНДФЛБезУчетаИзмененияСтатуса.КодДохода
		|ГДЕ
		|	НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НДФЛРасчетыСБюджетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|	И НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане
		|	И СтавкаНДФЛБезУчетаИзмененияСтатуса.СтавкаНДФЛ В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30))
		|
		|СГРУППИРОВАТЬ ПО
		|	КОНЕЦПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, МЕСЯЦ),
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	ВЫБОР
		|		КОГДА НДФЛРасчетыСБюджетом.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
		|			ТОГДА НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК СтавкаПоСтатусу,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке30.Налог, 0) КАК УдержаноНДФЛПоСтавке30,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке13.Налог, 0) КАК УдержаноНДФЛПоСтавке13,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТПеречисленоПоСтавке13_30
		|ИЗ
		|	ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке13
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке13.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке13.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке13.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль = УдержаноНДФЛПоСтавке13.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке30
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке30.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке30.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке30.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30))
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль = УдержаноНДФЛПоСтавке30.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13) = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента)
		|			И (ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.КодДоходаПоУмолчанию) = СтавкаНДФЛПоСтавкеРезидента.КодДохода)
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|	И НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Перечислено.Ставка,
		|	СУММА(Перечислено.Сумма) КАК Сумма,
		|	Перечислено.ФизическоеЛицо,
		|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТПеречисленоНДФЛ
		|ИЗ
		|	(ВЫБРАТЬ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка КАК Ставка,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК Сумма,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|	ГДЕ
		|		НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|		И НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|			ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|				И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = СтавкаНДФЛПоСтавкеРезидента.Период
		|				И (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09) = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента)
		|				И (ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010) = СтавкаНДФЛПоСтавкеРезидента.КодДохода)
		|	ГДЕ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ИсчисленоПоДивидендам
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30),
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА 0
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0))
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13),
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА 0
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ ПеречисленоПоСтавке13_30.СуммаРасход - (ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0)))
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ПеречисленоПоСтавке13_30.СтавкаПоСтатусу,
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ 0
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30) КАК Перечислено
		|
		|СГРУППИРОВАТЬ ПО
		|	Перечислено.Ставка,
		|	Перечислено.ФизическоеЛицо,
		|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль
		|
		|ИМЕЮЩИЕ
		|	СУММА(Перечислено.Сумма) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.МесяцНалоговогоПериода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.КодВычета,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо
		|ПОМЕСТИТЬ ВТДоходыПоМесяцам
		|ИЗ
		|	ВТДоходыОбъектаОбложения КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И Доходы.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И Доходы.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|ГДЕ
		|	Доходы.Месяц ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.Месяц,
		|	Доходы.МесяцНалоговогоПериода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодВычета
		|
		|ИМЕЮЩИЕ
		|	(СУММА(Доходы.СуммаДохода) <> 0
		|		ИЛИ СУММА(Доходы.СуммаВычета) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодДохода,
		|	Доходы.Месяц,
		|	Доходы.Ставка
		|ПОМЕСТИТЬ ВТОсобыеМесяцы
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодДохода,
		|	Доходы.Месяц,
		|	Доходы.Ставка
		|
		|ИМЕЮЩИЕ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
		|			КОГДА Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|				ТОГДА 0
		|			ИНАЧЕ 1
		|		КОНЕЦ) = 2
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	МАКСИМУМ(Доходы.КодВычета) КАК КодВычета,
		|	МесяцыОсобыхВычетов.Ставка
		|ПОМЕСТИТЬ ВТСтрокиСУказаннымВычетом
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|			И МесяцыОсобыхВычетов.Ставка = Доходы.Ставка
		|ГДЕ
		|	Доходы.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	МесяцыОсобыхВычетов.Ставка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	МесяцыОсобыхВычетов.Ставка
		|ПОМЕСТИТЬ ВТДоходыИзСтрокБезВычетов
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|			И МесяцыОсобыхВычетов.Ставка = Доходы.Ставка
		|ГДЕ
		|	Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	МесяцыОсобыхВычетов.Ставка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Доходы.Месяц КАК МесяцНалоговогоПериода,
		|	Доходы.Ставка КАК Ставка,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодВычета КАК КодВычета,
		|	Доходы.СуммаДохода + ВЫБОР
		|		КОГДА СтрокиСУказаннымВычетом.ФизическоеЛицо ЕСТЬ NULL 
		|			ТОГДА 0
		|		ИНАЧЕ ЕСТЬNULL(ДоходыИзСтрокБезВычетов.СуммаДохода, 0)
		|	КОНЕЦ КАК СуммаДохода,
		|	Доходы.СуммаВычета КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо КАК Сотрудник,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛишниеФизическиеЛица КАК ЛишниеФизическиеЛица
		|		ПО Доходы.ФизическоеЛицо = ЛишниеФизическиеЛица.ФизическоеЛицо
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОсобыеМесяцы КАК СтрокиБезКодаВычета
		|		ПО Доходы.ФизическоеЛицо = СтрокиБезКодаВычета.ФизическоеЛицо
		|			И Доходы.КодДохода = СтрокиБезКодаВычета.КодДохода
		|			И Доходы.Месяц = СтрокиБезКодаВычета.Месяц
		|			И (Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))
		|			И Доходы.Ставка = СтрокиБезКодаВычета.Ставка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыИзСтрокБезВычетов КАК ДоходыИзСтрокБезВычетов
		|		ПО Доходы.ФизическоеЛицо = ДоходыИзСтрокБезВычетов.ФизическоеЛицо
		|			И Доходы.Месяц = ДоходыИзСтрокБезВычетов.Месяц
		|			И Доходы.КодДохода = ДоходыИзСтрокБезВычетов.КодДохода
		|			И Доходы.ВключатьВДекларациюПоНалогуНаПрибыль = ДоходыИзСтрокБезВычетов.ВключатьВДекларациюПоНалогуНаПрибыль
		|			И Доходы.Ставка = ДоходыИзСтрокБезВычетов.Ставка
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиСУказаннымВычетом КАК СтрокиСУказаннымВычетом
		|		ПО Доходы.ФизическоеЛицо = СтрокиСУказаннымВычетом.ФизическоеЛицо
		|			И Доходы.Месяц = СтрокиСУказаннымВычетом.Месяц
		|			И Доходы.КодДохода = СтрокиСУказаннымВычетом.КодДохода
		|			И Доходы.КодВычета = СтрокиСУказаннымВычетом.КодВычета
		|			И Доходы.Ставка = СтрокиСУказаннымВычетом.Ставка
		|ГДЕ
		|	ЛишниеФизическиеЛица.ФизическоеЛицо ЕСТЬ NULL 
		|	И СтрокиБезКодаВычета.ФизическоеЛицо ЕСТЬ NULL 
		|
		|УПОРЯДОЧИТЬ ПО
		|	Ставка,
		|	МесяцНалоговогоПериода,
		|	Доходы.КодДоходаКодДляОтчетности
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.КодВычета,
		|	Вычеты.КодВычетаГруппаВычета КАК ГруппаВычета,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13) КАК Ставка,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года КАК КодВычетаКод,
		|	Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Вычеты.ФизическоеЛицо КАК Сотрудник
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛишниеФизическиеЛица КАК ЛишниеФизическиеЛица
		|		ПО Вычеты.ФизическоеЛицо = ЛишниеФизическиеЛица.ФизическоеЛицо
		|ГДЕ
		|	ЛишниеФизическиеЛица.ФизическоеЛицо ЕСТЬ NULL 
		|	И Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Вычеты.КодВычета,
		|	Вычеты.КодВычетаГруппаВычета,
		|	Вычеты.ФизическоеЛицо,
		|	Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	КодВычетаКод
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СотрудникиОрганизаций.ФизическоеЛицо КАК Сотрудник,
		|	ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) КАК Ставка,
		|	ИтогиДоходов.ОбщаяСуммаДохода,
		|	ИтогиДоходов.ОблагаемаяСуммаДохода,
		|	Налоги.НачисленоЗаТекущийГод КАК Исчислено,
		|	Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод КАК ЗачтеноАвансовыхПлатежей,
		|	Налоги.УдержаноЗаТекущийГод - Налоги.ВозвращеноЗаТекущийГод КАК Удержано,
		|	ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) КАК Перечислено,
		|	ВЫБОР
		|		КОГДА Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод > 0
		|			ТОГДА Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Задолженность,
		|	ВЫБОР
		|		КОГДА Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод < 0
		|			ТОГДА -(Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ИзлишнеУдержано,
		|	НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТФизлица КАК СотрудникиОрганизаций
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЛишниеФизическиеЛица КАК ЛишниеФизическиеЛица
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ЛишниеФизическиеЛица.ФизическоеЛицо
		|		ЛЕВОЕ СОЕДИНЕНИЕ Перечисление.НДФЛСтавки КАК Ставки
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ИСТИНА КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|		
		|		ОБЪЕДИНИТЬ ВСЕ
		|		
		|		ВЫБРАТЬ
		|			ЛОЖЬ) КАК НалогНаПрибыль
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиДоходов КАК ИтогиДоходов
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИтогиДоходов.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ИтогиДоходов.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = ИтогиДоходов.ВключатьВДекларациюПоНалогуНаПрибыль)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК Налоги
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = Налоги.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = Налоги.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = Налоги.ВключатьВДекларациюПоНалогуНаПрибыль)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПеречисленоНДФЛ КАК ПеречисленоНДФЛ
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ПеречисленоНДФЛ.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ПеречисленоНДФЛ.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = ПеречисленоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль)
		|ГДЕ
		|	ЛишниеФизическиеЛица.ФизическоеЛицо ЕСТЬ NULL 
		|	И (ИтогиДоходов.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (ИтогиДоходов.ОбщаяСуммаДохода <> 0
		|					ИЛИ ИтогиДоходов.ОблагаемаяСуммаДохода <> 0)
		|			ИЛИ Налоги.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (Налоги.НачисленоЗаТекущийГод <> 0
		|					ИЛИ Налоги.НачисленоЗаТекущийГод - Налоги.ЗачтеноАвансовыхПлатежейЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод <> 0)
		|			ИЛИ ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) <> 0)";		
		
	КонецЕсли;
	
	Результаты = Запрос.ВыполнитьПакет();
	ВсегоЗапросов = Результаты.Количество();
	
	Возврат Новый Структура("Доходы, Вычеты, Налоги", 
						Результаты[ВсегоЗапросов - 3].Выгрузить(), 
						Результаты[ВсегоЗапросов - 2].Выгрузить(), 
						Результаты[ВсегоЗапросов - 1].Выгрузить());
КонецФункции

// Возвращает структуру, содержащую таблицы значений с
// данными о доходах, налогах, вычетах.
//
// Параметры:
// 	Сотрудники - Массив - содержит физических лиц, по которым необходимо получить данные.
//	НалоговыйПериод - Число - номер года налогового периода.
//	Организация - организация, по которой получать доходы.
//	РегистрацияВНалоговомОргане - (необязательный), ссылка на регистрацию в налоговом органе, 
//									по которой отбирать данные.
//	Дата - Дата - (необязательный), дата ограничивающая период получаемых данных о доходах налогах и вычетах
//			если не задана, ограничением будет выступать текущая дата сеанса.
//
// Возвращаемое значение:
//	Структура со следующими полями:
//		Доходы - таблица значений с колонками:
//			Сотрудник,
//			МесяцНалоговогоПериода,
//			КодДохода,
//			КодДоходаКодДляОтчетности,
//			КодВычета,
//			СуммаДохода,
//			СуммаВычета,
//			ВключатьВДекларациюПоНалогуНаПрибыль,
//		Вычеты - таблица значений с колонками:
//			Сотрудник
//			КодВычета,
//			КодВычетаКод,
//			СуммаВычета,
//			ВключатьВДекларациюПоНалогуНаПрибыль,
//		Налоги - таблица значений с колонками:
//			Сотрудник,
//			Ставка,
//			ОбщаяСуммаДохода,
//			ОблагаемаяСуммаДохода,
//			Исчислено,
//			Удержано,
//			Задолженность,
//			ИзлишнеУдержано,
//			Перечислено,
//			ВключатьВДекларациюПоНалогуНаПрибыль
Функция ДанныеОДоходахНалогахВычетахСПомесячнойСтавкой(Сотрудники, НалоговыйПериод, Организация, РегистрацияВНалоговомОргане, ДатаАктуальности, ПодробныеДанные) 
	Запрос = Новый Запрос;
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ДатаЗакона229ФЗ", УчетНДФЛ.ДатаЗакона229ФЗ());
	Запрос.УстановитьПараметр("Организация",Организация);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ГодНП",НалоговыйПериод);
	НачалоНалоговогоПериода = Дата(НалоговыйПериод, 1, 1);
	КонецНалоговогоПериода = КонецГода(НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("КонецНП",КонецНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоНП", НачалоНалоговогоПериода);
	Запрос.УстановитьПараметр("НачалоСледующегоНП", КонецНалоговогоПериода + 1); // Начало следующего налогового периода.
	Запрос.УстановитьПараметр("ДатаПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности));
	Запрос.УстановитьПараметр("ДатаДоПодачиСведений", ?(Не ЗначениеЗаполнено(ДатаАктуальности), ТекущаяДатаСеанса(), ДатаАктуальности) - 1);
	Запрос.УстановитьПараметр("ЧитатьСводныеДанные", РегистрацияВНалоговомОргане = Неопределено);
	Запрос.УстановитьПараметр("РегистрацияВНалоговомОргане", РегистрацияВНалоговомОргане);
	Запрос.УстановитьПараметр("ДатаИзмененияНалогообложенияДивидендов", УчетНДФЛ.ДатаИзмененияНалогообложенияДивидендов());
	
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТПериоды(Запрос.МенеджерВременныхТаблиц, НачалоГода(Дата(НалоговыйПериод,1,1)), НачалоМесяца(КонецГода(Дата(НалоговыйПериод,1,1))),,, "ВТПериодыНалогаНаДоходы");
	
	КадровыйУчет.СоздатьНаДатуВТКадровыеДанныеФизическихЛиц(Запрос.МенеджерВременныхТаблиц, Ложь, Сотрудники, "СтатусНалогоплательщика", КонецНалоговогоПериода);
		
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СписокСотрудников.ФизическоеЛицо КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВТФизлица
	|ИЗ
	|	ВТКадровыеДанныеФизическихЛиц КАК СписокСотрудников
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Статусы.ФизическоеЛицо,
	|	Статусы.СтатусНалогоплательщика
	|ПОМЕСТИТЬ ВТРезидентствоФизлицНаКонецГода
	|ИЗ
	|	ВТКадровыеДанныеФизическихЛиц КАК Статусы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Физлица.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Периоды.Период КАК Период
	|ПОМЕСТИТЬ ВТПериодыСрезаСтатусов
	|ИЗ
	|	ВТФизлица КАК Физлица
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПериодыНалогаНаДоходы КАК Периоды
	|		ПО (ИСТИНА)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТКадровыеДанныеФизическихЛиц";
	
	Запрос.Выполнить();
	
	ОписательВременныхТаблиц = КадровыйУчет.ОписательВременныхТаблицДляСоздатьВТКадровыеДанныеФизическихЛиц(
		Запрос.МенеджерВременныхТаблиц,
		"ВТПериодыСрезаСтатусов");
	КадровыйУчет.СоздатьВТКадровыеДанныеФизическихЛиц(ОписательВременныхТаблиц, Ложь, "СтатусНалогоплательщика");
	
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	РезидентствоФизлицНаКонецМесяца.ФизическоеЛицо,
	|	РезидентствоФизлицНаКонецМесяца.Период КАК МесяцНалоговогоПериода,
	|	ВЫБОР
	|		КОГДА РезидентствоФизлицНаКонецМесяца.Период < &ДатаЗакона229ФЗ
	|			ТОГДА ЕСТЬNULL(РезидентствоФизлицНаКонецГода.СтатусНалогоплательщика, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
	|		ИНАЧЕ РезидентствоФизлицНаКонецМесяца.СтатусНалогоплательщика
	|	КОНЕЦ КАК ТекущийСтатус,
	|	ЕСТЬNULL(РезидентствоФизлицНаКонецГода.СтатусНалогоплательщика, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) КАК Статус
	|ПОМЕСТИТЬ ВТСтатусы
	|ИЗ
	|	ВТКадровыеДанныеФизическихЛиц КАК РезидентствоФизлицНаКонецМесяца
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРезидентствоФизлицНаКонецГода КАК РезидентствоФизлицНаКонецГода
	|		ПО РезидентствоФизлицНаКонецМесяца.ФизическоеЛицо = РезидентствоФизлицНаКонецГода.ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МЕСЯЦ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК Месяц,
	|	СведенияОДоходахНДФЛ.МесяцНалоговогоПериода,
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
	|	СведенияОДоходахНДФЛ.КодДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.КодПрименяемыйВНалоговойОтчетностиС2010Года КАК КодДоходаКодДляОтчетности,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК КодДоходаСтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|			ТОГДА 0
	|		ИНАЧЕ СведенияОДоходахНДФЛ.СуммаВычета
	|	КОНЕЦ КАК СуммаВычета,
	|	ВЫБОР
	|		КОГДА СведенияОДоходахНДФЛ.СуммаВычета = 0
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ СведенияОДоходахНДФЛ.КодВычета
	|	КОНЕЦ КАК КодВычета,
	|	СведенияОДоходахНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.Регистратор,
	|	СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане,
	|	СведенияОДоходахНДФЛ.Подразделение,
	|	СведенияОДоходахНДФЛ.Сотрудник
	|ПОМЕСТИТЬ ВТДоходы
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТФизлица КАК Сотрудники
	|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
	|			И (СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (&ЧитатьСводныеДанные
	|					И СведенияОДоходахНДФЛ.Организация = &Организация
	|				ИЛИ СведенияОДоходахНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|			И (СведенияОДоходахНДФЛ.Период <= &ДатаПодачиСведений)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета КАК КодВычета,
	|	СУММА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Сумма) КАК СуммаОборот,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|ИЗ
	|	ВТФизлица КАК Сотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ
	|		ПО Сотрудники.ФизическоеЛицо = ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо
	|ГДЕ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период <= &ДатаПодачиСведений
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП
	|	И (&ЧитатьСводныеДанные
	|				И ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Организация = &Организация
	|			ИЛИ ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|
	|СГРУППИРОВАТЬ ПО
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета КАК КодВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.СуммаОборот КАК СуммаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.КодВычета.ГруппаВычета,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Регистратор,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.ПериодРегистрации,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.Подразделение,
	|	ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты.РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТВычеты
	|ИЗ
	|	ВТПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты КАК ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛОбороты
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ИмущественныеВычетыНДФЛ.КодВычета,
	|	ИмущественныеВычетыНДФЛ.Сумма,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.Период, МЕСЯЦ),
	|	СотрудникиОрганизаций.ФизическоеЛицо,
	|	ИмущественныеВычетыНДФЛ.КодВычета.ГруппаВычета,
	|	ЛОЖЬ,
	|	ИмущественныеВычетыНДФЛ.Регистратор,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычетыНДФЛ.МесяцРегистрации, МЕСЯЦ),
	|	ИмущественныеВычетыНДФЛ.Подразделение,
	|	ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане
	|ИЗ
	|	ВТФизлица КАК СотрудникиОрганизаций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычетыНДФЛ
	|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИмущественныеВычетыНДФЛ.ФизическоеЛицо
	|			И (ИмущественныеВычетыНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход))
	|			И (ИмущественныеВычетыНДФЛ.Период <= &ДатаПодачиСведений)
	|			И (ИмущественныеВычетыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (ИмущественныеВычетыНДФЛ.Год = &ГодНП)
	|			И (&ЧитатьСводныеДанные
	|					И ИмущественныеВычетыНДФЛ.Организация = &Организация
	|				ИЛИ ИмущественныеВычетыНДФЛ.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
	|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане,
	|	НДФЛРасчетыСБюджетом.ВариантУдержания,
	|	НДФЛРасчетыСБюджетом.ВидДвижения,
	|	КОНЕЦПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, ГОД) КАК Период,
	|	НДФЛРасчетыСБюджетом.Сумма,
	|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента,
	|	НДФЛРасчетыСБюджетом.КодДохода,
	|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
	|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	НДФЛРасчетыСБюджетом.Регистратор,
	|	НАЧАЛОПЕРИОДА(НДФЛРасчетыСБюджетом.Период, МЕСЯЦ) КАК ПериодРегистрации,
	|	НДФЛРасчетыСБюджетом.Подразделение
	|ПОМЕСТИТЬ ВТСтрокиНалогов
	|ИЗ
	|	ВТФизлица КАК СправкиОДоходах
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК НДФЛРасчетыСБюджетом
	|		ПО СправкиОДоходах.ФизическоеЛицо = НДФЛРасчетыСБюджетом.ФизическоеЛицо
	|			И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
	|			И (НДФЛРасчетыСБюджетом.Период < &ДатаПодачиСведений)
	|			И (НДФЛРасчетыСБюджетом.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (&ЧитатьСводныеДанные
	|					И НДФЛРасчетыСБюджетом.Организация = &Организация
	|				ИЛИ НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	КОНЕЦПЕРИОДА(Доходы.МесяцНалоговогоПериода, ГОД) КАК Период,
	|	Доходы.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	Доходы.КодДохода КАК КодДохода,
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВТСтрокиУчета
	|ИЗ
	|	ВТДоходы КАК Доходы
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, ГОД),
	|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
	|	ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.КодДоходаПоУмолчанию),
	|	Вычеты.ФизическоеЛицо
	|ИЗ
	|	ВТВычеты КАК Вычеты
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтрокиНалогов.Период,
	|	СтрокиНалогов.СтавкаНалогообложенияРезидента,
	|	СтрокиНалогов.КодДохода,
	|	СтрокиНалогов.ФизическоеЛицо
	|ИЗ
	|	ВТСтрокиНалогов КАК СтрокиНалогов";
	Запрос.Выполнить();
	
	СоздатьВТСтавкаНДФЛПоСтавкеРезидента2016(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета");
	
	Если ПодробныеДанные Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Доходы.КодДохода КАК КодДохода,
		|	Доходы.КодВычета,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета,
		|	Доходы.ПериодРегистрации КАК ПериодРегистрации,
		|	Доходы.Регистратор КАК Регистратор,
		|	Доходы.РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение,
		|	Доходы.Сотрудник КАК Сотрудник,
		|	Доходы.МесяцНалоговогоПериода КАК ДатаПолученияДохода
		|ИЗ
		|	ВТДоходы КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И (КОНЕЦПЕРИОДА(Доходы.МесяцНалоговогоПериода, ГОД) = СтавкаНДФЛПоСтавкеРезидента.Период)
		|			И Доходы.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|ГДЕ
		|	(НЕ Доходы.ИсточникДоходаЗаПределамиРФ
		|			ИЛИ СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ПериодРегистрации,
		|	Доходы.Сотрудник,
		|	Доходы.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.РегистрацияВНалоговомОргане,
		|	Доходы.Подразделение,
		|	Доходы.КодВычета,
		|	Доходы.Регистратор,
		|	Доходы.МесяцНалоговогоПериода
		|
		|ИМЕЮЩИЕ
		|	(СУММА(Доходы.СуммаДохода) <> 0
		|		ИЛИ СУММА(Доходы.СуммаВычета) <> 0)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	Ставка,
		|	ПериодРегистрации,
		|	Регистратор,
		|	Сотрудник,
		|	ДатаПолученияДохода,
		|	КодДохода
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Вычеты.ПериодРегистрации КАК ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ) КАК ДатаПолученияДохода,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13) КАК Ставка,
		|	Вычеты.Подразделение,
		|	Вычеты.Регистратор КАК Регистратор,
		|	Вычеты.КодВычета КАК КодВычета,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|ГДЕ
		|	Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Вычеты.КодВычета,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	Вычеты.ПериодРегистрации,
		|	Вычеты.Регистратор,
		|	Вычеты.ФизическоеЛицо,
		|	КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, МЕСЯЦ)
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	ПериодРегистрации,
		|	Вычеты.РегистрацияВНалоговомОргане,
		|	Вычеты.Подразделение,
		|	ДатаПолученияДохода,
		|	КодВычета,
		|	Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.Регистратор,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане,
		|	НДФЛРасчетыСБюджетом.Подразделение,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Начислено,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК Зачтено,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.Подразделение,
		|	НДФЛРасчетыСБюджетом.ПериодРегистрации,
		|	НДФЛРасчетыСБюджетом.Регистратор,
		|	НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента";
		
	Иначе
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоходыИВычеты.ФизическоеЛицо,
		|	СУММА(ДоходыИВычеты.ОбщаяСуммаДохода) КАК ОбщаяСуммаДохода,
		|	СУММА(ДоходыИВычеты.ОблагаемаяСуммаДохода) КАК ОблагаемаяСуммаДохода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	ДоходыИВычеты.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТИтогиДоходов
		|ИЗ
		|	(ВЫБРАТЬ
		|		КОНЕЦПЕРИОДА(Доходы.МесяцНалоговогоПериода, ГОД) КАК Период,
		|		Доходы.СуммаДохода КАК ОбщаяСуммаДохода,
		|		Доходы.СуммаДохода - Доходы.СуммаВычета КАК ОблагаемаяСуммаДохода,
		|		Доходы.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|		Доходы.КодДохода КАК КодДохода,
		|		Доходы.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|		Доходы.ФизическоеЛицо КАК ФизическоеЛицо
		|	ИЗ
		|		ВТДоходы КАК Доходы
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		КОНЕЦПЕРИОДА(Вычеты.МесяцНалоговогоПериода, ГОД),
		|		0,
		|		-Вычеты.СуммаВычета,
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13),
		|		ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.КодДоходаПоУмолчанию),
		|		Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|		Вычеты.ФизическоеЛицо
		|	ИЗ
		|		ВТВычеты КАК Вычеты) КАК ДоходыИВычеты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО ДоходыИВычеты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И ДоходыИВычеты.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И ДоходыИВычеты.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И ДоходыИВычеты.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	ДоходыИВычеты.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	ДоходыИВычеты.ВключатьВДекларациюПоНалогуНаПрибыль
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК НачисленоЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА (НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|						ИЛИ НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК УдержаноЗаТекущийГод,
		|	0 КАК ВозвращеноЗаТекущийГод,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ПереданоНаВзысканиеВНалоговыйОрган)
		|						И (НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|					ТОГДА НДФЛРасчетыСБюджетом.Сумма
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПереданоНаВзысканиеЗаТекущийГод,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	СУММА(НДФЛРасчетыСБюджетом.Сумма) КАК Налог,
		|	ВЫБОР
		|		КОГДА НДФЛРасчетыСБюджетом.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
		|			ТОГДА НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТУдержаноНДФЛПо13или30ПоМесяцам
		|ИЗ
		|	ВТСтрокиНалогов КАК НДФЛРасчетыСБюджетом
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусы КАК Статусы
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = Статусы.ФизическоеЛицо
		|			И (НАЧАЛОПЕРИОДА(НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода, МЕСЯЦ) = Статусы.МесяцНалоговогоПериода)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО НДФЛРасчетыСБюджетом.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И НДФЛРасчетыСБюджетом.Период = СтавкаНДФЛПоСтавкеРезидента.Период
		|			И НДФЛРасчетыСБюджетом.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|ГДЕ
		|	НДФЛРасчетыСБюджетом.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И НДФЛРасчетыСБюджетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|	И НДФЛРасчетыСБюджетом.РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане
		|	И ВЫБОР
		|			КОГДА НДФЛРасчетыСБюджетом.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|				ТОГДА ИСТИНА
		|			КОГДА НДФЛРасчетыСБюджетом.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
		|				ТОГДА ВЫБОР
		|						КОГДА Статусы.ТекущийСтатус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|								И НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода >= &ДатаИзмененияНалогообложенияДивидендов
		|							ТОГДА ИСТИНА
		|						ИНАЧЕ ЛОЖЬ
		|					КОНЕЦ
		|			КОГДА Статусы.ТекущийСтатус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
		|				ТОГДА ЛОЖЬ
		|			ИНАЧЕ ИСТИНА
		|		КОНЕЦ
		|
		|СГРУППИРОВАТЬ ПО
		|	НДФЛРасчетыСБюджетом.МесяцНалоговогоПериода,
		|	НДФЛРасчетыСБюджетом.ФизическоеЛицо,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ,
		|	ВЫБОР
		|		КОГДА НДФЛРасчетыСБюджетом.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
		|			ТОГДА НДФЛРасчетыСБюджетом.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТПеречисленоНДФЛПоМесяцам
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(
		|			&НачалоНП,
		|			&ДатаДоПодачиСведений,
		|			,
		|			ФизическоеЛицо В
		|					(ВЫБРАТЬ
		|						ФизическиеЛица.ФизическоеЛицо
		|					ИЗ
		|						ВТФизлица КАК ФизическиеЛица)
		|				И (МесяцНалоговогоПериода МЕЖДУ &НачалоНП И &КонецНП)
		|				И (&ЧитатьСводныеДанные
		|						И Организация = &Организация
		|					ИЛИ РегистрацияВНалоговомОргане = &РегистрацияВНалоговомОргане)) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА Статусы.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Нерезидент)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|	КОНЕЦ КАК СтавкаПоСтатусу,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке30.Налог, 0) КАК УдержаноНДФЛПоСтавке30,
		|	ЕСТЬNULL(УдержаноНДФЛПоСтавке13.Налог, 0) КАК УдержаноНДФЛПоСтавке13,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТПеречисленоПоСтавке13_30
		|ИЗ
		|	ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке13
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке13.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке13.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке13.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль = УдержаноНДФЛПоСтавке13.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУдержаноНДФЛПо13или30ПоМесяцам КАК УдержаноНДФЛПоСтавке30
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = УдержаноНДФЛПоСтавке30.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = УдержаноНДФЛПоСтавке30.МесяцНалоговогоПериода
		|			И (УдержаноНДФЛПоСтавке30.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30))
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль = УдержаноНДФЛПоСтавке30.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусы КАК Статусы
		|		ПО РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо = Статусы.ФизическоеЛицо
		|			И РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.МесяцНалоговогоПериода = Статусы.МесяцНалоговогоПериода
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Перечислено.Ставка,
		|	СУММА(Перечислено.Сумма) КАК Сумма,
		|	Перечислено.ФизическоеЛицо,
		|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТПеречисленоНДФЛ
		|ИЗ
		|	(ВЫБРАТЬ
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка КАК Ставка,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаРасход КАК Сумма,
		|		РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоНДФЛПоМесяцам КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|	ГДЕ
		|		НЕ РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка В (ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30), ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13))
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30),
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА 0
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0))
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13),
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА 0
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ ПеречисленоПоСтавке13_30.СуммаРасход - (ВЫРАЗИТЬ(ПеречисленоПоСтавке13_30.СуммаРасход * ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 / (ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13) КАК ЧИСЛО(22, 0)))
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ПеречисленоПоСтавке13_30.СтавкаПоСтатусу,
		|		ПеречисленоПоСтавке13_30.ФизическоеЛицо,
		|		ВЫБОР
		|			КОГДА ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке30 + ПеречисленоПоСтавке13_30.УдержаноНДФЛПоСтавке13 = 0
		|				ТОГДА ПеречисленоПоСтавке13_30.СуммаРасход
		|			ИНАЧЕ 0
		|		КОНЕЦ,
		|		ПеречисленоПоСтавке13_30.ВключатьВДекларациюПоНалогуНаПрибыль
		|	ИЗ
		|		ВТПеречисленоПоСтавке13_30 КАК ПеречисленоПоСтавке13_30) КАК Перечислено
		|
		|СГРУППИРОВАТЬ ПО
		|	Перечислено.Ставка,
		|	Перечислено.ФизическоеЛицо,
		|	Перечислено.ВключатьВДекларациюПоНалогуНаПрибыль
		|
		|ИМЕЮЩИЕ
		|	СУММА(Перечислено.Сумма) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Доходы.Месяц КАК Месяц,
		|	Доходы.МесяцНалоговогоПериода,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.КодВычета,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	СУММА(Доходы.СуммаВычета) КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо
		|ПОМЕСТИТЬ ВТДоходыПоМесяцам
		|ИЗ
		|	ВТДоходы КАК Доходы
		|ГДЕ
		|	Доходы.Месяц ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.Месяц,
		|	Доходы.МесяцНалоговогоПериода,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодДоходаСтавкаНалогообложенияРезидента,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодВычета
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодДохода,
		|	Доходы.Месяц
		|ПОМЕСТИТЬ ВТОсобыеМесяцы
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|
		|СГРУППИРОВАТЬ ПО
		|	Доходы.ФизическоеЛицо,
		|	Доходы.КодДохода,
		|	Доходы.Месяц
		|
		|ИМЕЮЩИЕ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
		|			КОГДА Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|				ТОГДА 0
		|			ИНАЧЕ 1
		|		КОНЕЦ) = 2
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	МАКСИМУМ(Доходы.КодВычета) КАК КодВычета
		|ПОМЕСТИТЬ ВТСтрокиСУказаннымВычетом
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|ГДЕ
		|	Доходы.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль
		|ПОМЕСТИТЬ ВТДоходыИзСтрокБезВычетов
		|ИЗ
		|	ВТОсобыеМесяцы КАК МесяцыОсобыхВычетов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоМесяцам КАК Доходы
		|		ПО МесяцыОсобыхВычетов.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И МесяцыОсобыхВычетов.КодДохода = Доходы.КодДохода
		|			И МесяцыОсобыхВычетов.Месяц = Доходы.Месяц
		|ГДЕ
		|	Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	МесяцыОсобыхВычетов.ФизическоеЛицо,
		|	МесяцыОсобыхВычетов.КодДохода,
		|	МесяцыОсобыхВычетов.Месяц,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Доходы.Месяц КАК МесяцНалоговогоПериода,
		|	СтавкаНДФЛПоСтавкеРезидента.СтавкаНДФЛ КАК Ставка,
		|	Доходы.КодДохода,
		|	Доходы.КодДоходаКодДляОтчетности,
		|	Доходы.КодВычета КАК КодВычета,
		|	Доходы.СуммаДохода + ВЫБОР
		|		КОГДА СтрокиСУказаннымВычетом.ФизическоеЛицо ЕСТЬ NULL 
		|			ТОГДА 0
		|		ИНАЧЕ ЕСТЬNULL(ДоходыИзСтрокБезВычетов.СуммаДохода, 0)
		|	КОНЕЦ КАК СуммаДохода,
		|	Доходы.СуммаВычета КАК СуммаВычета,
		|	Доходы.ФизическоеЛицо КАК Сотрудник,
		|	Доходы.ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТДоходыПоМесяцам КАК Доходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОсобыеМесяцы КАК СтрокиБезКодаВычета
		|		ПО Доходы.ФизическоеЛицо = СтрокиБезКодаВычета.ФизическоеЛицо
		|			И Доходы.КодДохода = СтрокиБезКодаВычета.КодДохода
		|			И Доходы.Месяц = СтрокиБезКодаВычета.Месяц
		|			И (Доходы.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыИзСтрокБезВычетов КАК ДоходыИзСтрокБезВычетов
		|		ПО Доходы.ФизическоеЛицо = ДоходыИзСтрокБезВычетов.ФизическоеЛицо
		|			И Доходы.Месяц = ДоходыИзСтрокБезВычетов.Месяц
		|			И Доходы.КодДохода = ДоходыИзСтрокБезВычетов.КодДохода
		|			И Доходы.ВключатьВДекларациюПоНалогуНаПрибыль = ДоходыИзСтрокБезВычетов.ВключатьВДекларациюПоНалогуНаПрибыль
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтрокиСУказаннымВычетом КАК СтрокиСУказаннымВычетом
		|		ПО Доходы.ФизическоеЛицо = СтрокиСУказаннымВычетом.ФизическоеЛицо
		|			И Доходы.Месяц = СтрокиСУказаннымВычетом.Месяц
		|			И Доходы.КодДохода = СтрокиСУказаннымВычетом.КодДохода
		|			И Доходы.КодВычета = СтрокиСУказаннымВычетом.КодВычета
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
		|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
		|			И Доходы.КодДоходаСтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
		|			И (КОНЕЦПЕРИОДА(Доходы.МесяцНалоговогоПериода, ГОД) = СтавкаНДФЛПоСтавкеРезидента.Период)
		|			И Доходы.КодДохода = СтавкаНДФЛПоСтавкеРезидента.КодДохода
		|ГДЕ
		|	СтрокиБезКодаВычета.ФизическоеЛицо ЕСТЬ NULL 
		|
		|УПОРЯДОЧИТЬ ПО
		|	МесяцНалоговогоПериода,
		|	Доходы.КодДоходаКодДляОтчетности
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вычеты.КодВычета,
		|	Вычеты.КодВычетаГруппаВычета КАК ГруппаВычета,
		|	СУММА(Вычеты.СуммаВычета) КАК СуммаВычета,
		|	ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13) КАК Ставка,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года КАК КодВычетаКод,
		|	Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Вычеты.ФизическоеЛицо КАК Сотрудник
		|ИЗ
		|	ВТВычеты КАК Вычеты
		|ГДЕ
		|	Вычеты.КодВычета ЕСТЬ НЕ NULL 
		|
		|СГРУППИРОВАТЬ ПО
		|	Вычеты.КодВычета,
		|	Вычеты.КодВычетаГруппаВычета,
		|	Вычеты.ФизическоеЛицо,
		|	Вычеты.ВключатьВДекларациюПоНалогуНаПрибыль,
		|	Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2011Года + Вычеты.КодВычета.КодПрименяемыйВНалоговойОтчетностиС2010Года
		|
		|ИМЕЮЩИЕ
		|	СУММА(Вычеты.СуммаВычета) <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	КодВычетаКод
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СотрудникиОрганизаций.ФизическоеЛицо КАК Сотрудник,
		|	ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) КАК Ставка,
		|	ИтогиДоходов.ОбщаяСуммаДохода,
		|	ИтогиДоходов.ОблагаемаяСуммаДохода,
		|	Налоги.НачисленоЗаТекущийГод КАК Исчислено,
		|	Налоги.УдержаноЗаТекущийГод - Налоги.ВозвращеноЗаТекущийГод КАК Удержано,
		|	ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) КАК Перечислено,
		|	ВЫБОР
		|		КОГДА Налоги.НачисленоЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод - Налоги.ПереданоНаВзысканиеЗаТекущийГод > 0
		|			ТОГДА Налоги.НачисленоЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод - Налоги.ПереданоНаВзысканиеЗаТекущийГод
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Задолженность,
		|	ВЫБОР
		|		КОГДА Налоги.НачисленоЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод - Налоги.ПереданоНаВзысканиеЗаТекущийГод < 0
		|			ТОГДА -(Налоги.НачисленоЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод - Налоги.ПереданоНаВзысканиеЗаТекущийГод)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ИзлишнеУдержано,
		|	НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль
		|ИЗ
		|	ВТФизлица КАК СотрудникиОрганизаций
		|		ЛЕВОЕ СОЕДИНЕНИЕ Перечисление.НДФЛСтавки КАК Ставки
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ИСТИНА КАК ВключатьВДекларациюПоНалогуНаПрибыль
		|		
		|		ОБЪЕДИНИТЬ ВСЕ
		|		
		|		ВЫБРАТЬ
		|			ЛОЖЬ) КАК НалогНаПрибыль
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтогиДоходов КАК ИтогиДоходов
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ИтогиДоходов.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ИтогиДоходов.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = ИтогиДоходов.ВключатьВДекларациюПоНалогуНаПрибыль)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалоги КАК Налоги
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = Налоги.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = Налоги.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = Налоги.ВключатьВДекларациюПоНалогуНаПрибыль)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПеречисленоНДФЛ КАК ПеречисленоНДФЛ
		|		ПО СотрудникиОрганизаций.ФизическоеЛицо = ПеречисленоНДФЛ.ФизическоеЛицо
		|			И (ЕСТЬNULL(Ставки.Ссылка, ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)) = ПеречисленоНДФЛ.Ставка)
		|			И (НалогНаПрибыль.ВключатьВДекларациюПоНалогуНаПрибыль = ПеречисленоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль)
		|ГДЕ
		|	(ИтогиДоходов.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (ИтогиДоходов.ОбщаяСуммаДохода <> 0
		|					ИЛИ ИтогиДоходов.ОблагаемаяСуммаДохода <> 0)
		|			ИЛИ Налоги.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|				И (Налоги.НачисленоЗаТекущийГод <> 0
		|					ИЛИ Налоги.НачисленоЗаТекущийГод - Налоги.УдержаноЗаТекущийГод + Налоги.ВозвращеноЗаТекущийГод - Налоги.ПереданоНаВзысканиеЗаТекущийГод <> 0)
		|			ИЛИ ЕСТЬNULL(ПеречисленоНДФЛ.Сумма, 0) <> 0)";		
	КонецЕсли;
	
	Результаты = Запрос.ВыполнитьПакет();
	ВсегоЗапросов = Результаты.Количество();
	
	Возврат Новый Структура("Доходы, Вычеты, Налоги", 
						Результаты[ВсегоЗапросов - 3].Выгрузить(), 
						Результаты[ВсегоЗапросов - 2].Выгрузить(), 
						Результаты[ВсегоЗапросов - 1].Выгрузить());
	
КонецФункции

// Расчеты.

// Дополняет данные о ставке налогообложения, используемой для резидентов РФ, 
// сведениями о реальной ставке обложения с учетом налогового статуса физического лица.
// В менеджер временных таблиц помещается таблица ВТСтавкаНДФЛПоСтавкеРезидента 
// (или с иным именем - см. ИмяТаблицыРезультата) с уникальными записями с полями:
//		ФизическоеЛицо.
//		Период, переданная на вход дата
//    	КатегорияДохода, тип ПеречислениеСсылка.КатегорииДоходовНДФЛ
//		СтавкаНалогообложенияРезидента, тип ПеречислениеСсылка.НДФЛСтавкиНалогообложенияРезидента
//		Статус, тип СправочникСсылка.СтатусыНалогоплательщиковПоНДФЛ
//		СтавкаНДФЛ, тип ПеречислениеСсылка.НДФЛСтавки
//		СтавкаЧислом, тип Число, например, 0.13.
//
// Параметры:
//	МенеджерВременныхТаблиц - МенеджерВременныхТаблиц - менеджер временных таблиц, содержащий таблицу с полями:
//		ФизическоеЛицо
//		Период, дата на которую будет определен статус налогоплательщика
//    	КатегорияДохода, тип ПеречислениеСсылка.КатегорииДоходовНДФЛ: должно быть непустым
//		СтавкаНалогообложенияРезидента, тип ПеречислениеСсылка.НДФЛСтавкиНалогообложенияРезидента.
//	ИмяТаблицы - строка - имя обрабатываемой временной таблицы.
//	УчитыватьСтатусНаКонецГода - строка - необязательный, описание того, как следует учитывать изменение 
//		статуса на конец налогового периода, возможные значения:
//			"НеУчитыватьИзмененияСтатуса" (значение по умолчанию)
//			"УчитыватьИзмененияСтатусаДляРасчета"
//			"УчитыватьИзмененияСтатусаДляОтчетности"
//	ОкончаниеОтчетногоПериода - Дата - необязательный, значение будет учитываться в определение периода на которую будет определен статус налогоплательщика если необходимо учитывать изменение статуса
//	ИмяТаблицыРезультата - строка - имя создаваемой временной таблицы.
//
Процедура СоздатьВТСтавкаНДФЛПоСтавкеРезидента(МенеджерВременныхТаблиц, ИмяТаблицы, УчитыватьСтатусНаКонецГода = "НеУчитыватьИзмененияСтатуса", ОкончаниеОтчетногоПериода = '00010101', ИмяТаблицыРезультата = "ВТСтавкаНДФЛПоСтавкеРезидента") Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("ДатаИзмененияНалогообложенияДивидендов", УчетНДФЛ.ДатаИзмененияНалогообложенияДивидендов());
	Запрос.УстановитьПараметр("ДатаИзмененияПорядкаИсчисленияДляИностранцев", УчетНДФЛ.ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев());
	Запрос.УстановитьПараметр("УчитыватьИзмененияСтатусаДляРасчета", УчитыватьСтатусНаКонецГода = "УчитыватьИзмененияСтатусаДляРасчета");
	Запрос.УстановитьПараметр("НеУчитыватьИзмененияСтатуса", УчитыватьСтатусНаКонецГода <> "УчитыватьИзмененияСтатусаДляРасчета" И УчитыватьСтатусНаКонецГода <> "УчитыватьИзмененияСтатусаДляОтчетности");
	Запрос.УстановитьПараметр("ГодОтчетногоПериода", НачалоГода(ОкончаниеОтчетногоПериода));
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ТаблицаСоСтавками.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ТаблицаСоСтавками.Статус КАК Статус,
	|	ТаблицаСоСтавками.Период КАК Период,
	|	ТаблицаСоСтавками.КатегорияДохода КАК КатегорияДохода,
	|	ТаблицаСоСтавками.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	ТаблицаСоСтавками.СтавкаНДФЛ КАК СтавкаНДФЛ,
	|	ТаблицаСоСтавками.СтавкаЧислом КАК СтавкаЧислом
	|ПОМЕСТИТЬ ВТСтавкаНДФЛПоСтавкеРезидента
	|ИЗ
	|	(ВЫБРАТЬ
	|		ТаблицаСоСтатусами.ФизическоеЛицо КАК ФизическоеЛицо,
	|		ТаблицаСоСтатусами.Статус КАК Статус,
	|		ТаблицаСоСтатусами.Период КАК Период,
	|		ТаблицаСоСтатусами.КатегорияДохода КАК КатегорияДохода,
	|		ТаблицаСоСтатусами.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|		ВЫБОР
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка05)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка10)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка12)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка03)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка05)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка06)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка07)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка10)
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15)
	|					И ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
	|			КОГДА ТаблицаСоСтатусами.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|				ТОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Нерезидент)
	|							ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30)
	|						КОГДА ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|							ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|						КОГДА ТаблицаСоСтатусами.Период >= ДАТАВРЕМЯ(2018, 1, 1)
	|							ТОГДА ВЫБОР
	|									КОГДА ТаблицаСоСтатусами.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыВДенежнойФормеОтТрудовойДеятельности), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходВНатуральнойФормеОтТрудовойДеятельности), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций))
	|										ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|									ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30)
	|								КОНЕЦ
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|					КОНЕЦ
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12))
	|				ТОГДА ВЫБОР
	|						КОГДА ТаблицаСоСтатусами.Период >= &ДатаИзмененияНалогообложенияДивидендов
	|							ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка09)
	|					КОНЕЦ
	|			КОГДА ТаблицаСоСтатусами.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций)
	|					И ТаблицаСоСтатусами.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09)
	|				ТОГДА ВЫБОР
	|						КОГДА ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|							ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
	|						КОГДА ТаблицаСоСтатусами.Период >= &ДатаИзмененияНалогообложенияДивидендов
	|							ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка09)
	|					КОНЕЦ
	|			КОГДА ЕСТЬNULL(ТаблицаСоСтатусами.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ВЫБОР
	|						КОГДА ТаблицаСоСтатусами.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09)
	|							ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка09)
	|						КОГДА ТаблицаСоСтатусами.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка35)
	|							ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка35)
	|						ИНАЧЕ """"
	|					КОНЕЦ
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30)
	|		КОНЕЦ КАК СтавкаНДФЛ,
	|		0 КАК СтавкаЧислом
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ТаблицаНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|			ТаблицаНДФЛ.Период КАК Период,
	|			ТаблицаНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|			ТаблицаНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|			ЕСТЬNULL(ВЫБОР
	|					КОГДА &НеУчитыватьИзмененияСтатуса
	|						ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|					КОГДА ФизическиеЛицаСтатусыНДФЛ.Год < &ГодОтчетногоПериода
	|						ТОГДА ВЫБОР
	|								КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецГода
	|									ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|								КОГДА ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецГода = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|									ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|								КОГДА &УчитыватьИзмененияСтатусаДляРасчета
	|									ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|								КОГДА ТаблицаНДФЛ.Период < &ДатаИзмененияПорядкаИсчисленияДляИностранцев
	|									ТОГДА ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецГода
	|								КОГДА ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецГода = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|									ТОГДА ВЫБОР
	|											КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|												ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|											ИНАЧЕ ФизическиеЛицаСтатусыНДФЛ.Статус
	|										КОНЕЦ
	|								КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|									ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|								ИНАЧЕ ФизическиеЛицаСтатусыНДФЛ.Статус
	|							КОНЕЦ
	|					ИНАЧЕ ВЫБОР
	|							КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецКвартала1
	|								ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|							КОГДА ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецКвартала1 = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|								ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|							КОГДА &УчитыватьИзмененияСтатусаДляРасчета
	|								ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|							КОГДА ТаблицаНДФЛ.Период < &ДатаИзмененияПорядкаИсчисленияДляИностранцев
	|								ТОГДА ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецКвартала1
	|							КОГДА ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецГода = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|								ТОГДА ВЫБОР
	|										КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|											ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|										ИНАЧЕ ФизическиеЛицаСтатусыНДФЛ.Статус
	|									КОНЕЦ
	|							КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|								ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|							ИНАЧЕ ФизическиеЛицаСтатусыНДФЛ.Статус
	|						КОНЕЦ
	|				КОНЕЦ, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) КАК Статус
	|		ИЗ
	|			#ТаблицаНДФЛ КАК ТаблицаНДФЛ
	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК ФизическиеЛицаСтатусыНДФЛ
	|				ПО ТаблицаНДФЛ.ФизическоеЛицо = ФизическиеЛицаСтатусыНДФЛ.ФизическоеЛицо
	|					И (ВЫБОР
	|						КОГДА ТаблицаНДФЛ.Период < &ДатаИзмененияПорядкаИсчисленияДляИностранцев
	|							ТОГДА КОНЕЦПЕРИОДА(ТаблицаНДФЛ.Период, МЕСЯЦ)
	|						ИНАЧЕ ТаблицаНДФЛ.Период
	|					КОНЕЦ МЕЖДУ ФизическиеЛицаСтатусыНДФЛ.ДатаНачала И ФизическиеЛицаСтатусыНДФЛ.ДатаОкончания)) КАК ТаблицаСоСтатусами) КАК ТаблицаСоСтавками";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "#ТаблицаНДФЛ", ИмяТаблицы);
	Если МенеджерВременныхТаблиц.Таблицы[ИмяТаблицы].Колонки.Найти("КатегорияДохода") = Неопределено Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ТаблицаНДФЛ.КатегорияДохода", "ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка)");
	КонецЕсли;
	ВписатьТекстПолученияЗначенияСтавкиНДФЛЧислом(ТекстЗапроса, "ТаблицаСоСтавками.СтавкаЧислом", "ТаблицаСоСтавками", "СтавкаНДФЛ");
	
	НомерКвартала = ?(ОкончаниеОтчетногоПериода = '00010101', 4, Цел((Месяц(ОкончаниеОтчетногоПериода) + 2)/3));
	ТекстЗамены = "";
	Если НомерКвартала = 4 Тогда
		ТекстЗамены = "ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецГода";
	Иначе
		ТекстЗамены = "ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецКвартала" + НомерКвартала;
	КонецЕсли;
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ФизическиеЛицаСтатусыНДФЛ.СтатусНаКонецКвартала1", ТекстЗамены);
	
	Если ИмяТаблицыРезультата <> "ВТСтавкаНДФЛПоСтавкеРезидента" Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТСтавкаНДФЛПоСтавкеРезидента", ИмяТаблицыРезультата);
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура СоздатьВТСтавкаНДФЛПоСтавкеРезидента2016(МенеджерВременныхТаблиц, ИмяТаблицы, УчитыватьСтатусНаКонецГода = "НеУчитыватьИзмененияСтатуса", МесяцКонцаГода = 12) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("ДатаИзмененияНалогообложенияДивидендов", УчетНДФЛ.ДатаИзмененияНалогообложенияДивидендов());
	Запрос.УстановитьПараметр("ДатаЗакона285ФЗ", УчетНДФЛ.ДатаЗакона285ФЗ());
	Запрос.УстановитьПараметр("ДатаИзмененияПорядкаИсчисленияДляИностранцев", УчетНДФЛ.ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев());
	Запрос.УстановитьПараметр("УчитыватьИзмененияСтатусаДляРасчета", УчитыватьСтатусНаКонецГода = "УчитыватьИзмененияСтатусаДляРасчета");
	Запрос.УстановитьПараметр("НеУчитыватьИзмененияСтатуса", УчитыватьСтатусНаКонецГода <> "УчитыватьИзмененияСтатусаДляРасчета" И УчитыватьСтатусНаКонецГода <> "УчитыватьИзмененияСтатусаДляОтчетности");
	
	СоздатьВТСтавкиНалогаЧислом(Запрос.МенеджерВременныхТаблиц);
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ФизическиеЛицаПериоды.ФизическоеЛицо,
	|	ФизическиеЛицаПериоды.Период,
	|	ВЫБОР
	|		КОГДА ФизическиеЛицаПериоды.Период < &ДатаЗакона285ФЗ
	|				И СтатусФизическихЛицКакНалогоплательщиковНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Беженцы)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Нерезидент)
	|		ИНАЧЕ ЕСТЬNULL(СтатусФизическихЛицКакНалогоплательщиковНДФЛ.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
	|	КОНЕЦ КАК Статус
	|ПОМЕСТИТЬ ВТФизическиеЛицаСтатусыНДФЛ
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		СписокФизическихЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
	|		МАКСИМУМ(СтатусФизическихЛиц.Период) КАК ПериодСтатуса,
	|		СписокФизическихЛиц.Период КАК Период
	|	ИЗ
	|		#ТаблицаНДФЛ КАК СписокФизическихЛиц
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛ КАК СтатусФизическихЛиц
	|			ПО СписокФизическихЛиц.ФизическоеЛицо = СтатусФизическихЛиц.ФизическоеЛицо
	|				И (ВЫБОР
	|					КОГДА СписокФизическихЛиц.Период < &ДатаИзмененияПорядкаИсчисленияДляИностранцев
	|						ТОГДА КОНЕЦПЕРИОДА(СписокФизическихЛиц.Период, МЕСЯЦ)
	|					ИНАЧЕ СписокФизическихЛиц.Период
	|				КОНЕЦ >= СтатусФизическихЛиц.Период)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		СписокФизическихЛиц.ФизическоеЛицо,
	|		СписокФизическихЛиц.Период) КАК ФизическиеЛицаПериоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛ КАК СтатусФизическихЛицКакНалогоплательщиковНДФЛ
	|		ПО ФизическиеЛицаПериоды.ФизическоеЛицо = СтатусФизическихЛицКакНалогоплательщиковНДФЛ.ФизическоеЛицо
	|			И ФизическиеЛицаПериоды.ПериодСтатуса = СтатусФизическихЛицКакНалогоплательщиковНДФЛ.Период";
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "#ТаблицаНДФЛ", ИмяТаблицы);
	Запрос.Выполнить();
	
	Если УчитыватьСтатусНаКонецГода = "УчитыватьИзмененияСтатусаДляРасчета" Или УчитыватьСтатусНаКонецГода = "УчитыватьИзмененияСтатусаДляОтчетности" Тогда
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ФизическиеЛицаПериоды.ФизическоеЛицо,
		|	ФизическиеЛицаПериоды.Период,
		|	ВЫБОР
		|		КОГДА ФизическиеЛицаПериоды.Период < &ДатаЗакона285ФЗ
		|				И СтатусФизическихЛицКакНалогоплательщиковНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Беженцы)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Нерезидент)
		|		ИНАЧЕ ЕСТЬNULL(СтатусФизическихЛицКакНалогоплательщиковНДФЛ.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент))
		|	КОНЕЦ КАК Статус
		|ПОМЕСТИТЬ ВТСтатусыНаКонецГода
		|ИЗ
		|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		СписокФизическихЛиц.ФизическоеЛицо КАК ФизическоеЛицо,
		|		МАКСИМУМ(СтатусФизическихЛиц.Период) КАК ПериодСтатуса,
		|		СписокФизическихЛиц.Период КАК Период
		|	ИЗ
		|		#ТаблицаНДФЛ КАК СписокФизическихЛиц
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛ КАК СтатусФизическихЛиц
		|			ПО СписокФизическихЛиц.ФизическоеЛицо = СтатусФизическихЛиц.ФизическоеЛицо
		|				И (КОНЕЦПЕРИОДА(СписокФизическихЛиц.Период, ГОД) >= СтатусФизическихЛиц.Период)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		СписокФизическихЛиц.ФизическоеЛицо,
		|		СписокФизическихЛиц.Период) КАК ФизическиеЛицаПериоды
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛ КАК СтатусФизическихЛицКакНалогоплательщиковНДФЛ
		|		ПО ФизическиеЛицаПериоды.ФизическоеЛицо = СтатусФизическихЛицКакНалогоплательщиковНДФЛ.ФизическоеЛицо
		|			И ФизическиеЛицаПериоды.ПериодСтатуса = СтатусФизическихЛицКакНалогоплательщиковНДФЛ.Период";
		Если МесяцКонцаГода <> 12 Тогда
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "КОНЕЦПЕРИОДА(СписокФизическихЛиц.Период, ГОД)","ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(СписокФизическихЛиц.Период, ГОД), МЕСЯЦ, " + МесяцКонцаГода + "), СЕКУНДА, -1)")
		КонецЕсли;
	Иначе 	
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ФизическиеЛицаПериоды.ФизическоеЛицо,
		|	ФизическиеЛицаПериоды.Период,
		|	ФизическиеЛицаПериоды.Статус
		|ПОМЕСТИТЬ ВТСтатусыНаКонецГода
		|ИЗ
		|	ВТФизическиеЛицаСтатусыНДФЛ КАК ФизическиеЛицаПериоды";
	КонецЕсли;
	
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "#ТаблицаНДФЛ", ИмяТаблицы);
	Запрос.Выполнить();
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ТаблицаНДФЛ.ФизическоеЛицо,
	|	ТаблицаНДФЛ.Период,
	|	ЕСТЬNULL(ВЫБОР
	|			КОГДА &НеУчитыватьИзмененияСтатуса
	|				ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|			КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = СтатусыНаКонецГода.Статус
	|				ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|			КОГДА СтатусыНаКонецГода.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|			КОГДА &УчитыватьИзмененияСтатусаДляРасчета
	|				ТОГДА ФизическиеЛицаСтатусыНДФЛ.Статус
	|			КОГДА ТаблицаНДФЛ.Период < &ДатаИзмененияПорядкаИсчисленияДляИностранцев
	|				ТОГДА СтатусыНаКонецГода.Статус
	|			КОГДА СтатусыНаКонецГода.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|				ТОГДА ВЫБОР
	|						КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|							ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|						ИНАЧЕ ФизическиеЛицаСтатусыНДФЛ.Статус
	|					КОНЕЦ
	|			КОГДА ФизическиеЛицаСтатусыНДФЛ.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|				ТОГДА ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|			ИНАЧЕ ФизическиеЛицаСтатусыНДФЛ.Статус
	|		КОНЕЦ, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) КАК Статус
	|ПОМЕСТИТЬ ВТСтатусыСУчетомИзменений
	|ИЗ
	|	#ТаблицаНДФЛ КАК ТаблицаНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСтатусыНДФЛ КАК ФизическиеЛицаСтатусыНДФЛ
	|		ПО ТаблицаНДФЛ.ФизическоеЛицо = ФизическиеЛицаСтатусыНДФЛ.ФизическоеЛицо
	|			И ТаблицаНДФЛ.Период = ФизическиеЛицаСтатусыНДФЛ.Период
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыНаКонецГода КАК СтатусыНаКонецГода
	|		ПО ТаблицаНДФЛ.ФизическоеЛицо = СтатусыНаКонецГода.ФизическоеЛицо
	|			И ТаблицаНДФЛ.Период = СтатусыНаКонецГода.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ТаблицаНДФЛ.ФизическоеЛицо,
	|	ФизическиеЛицаСтатусыНДФЛ.Статус,
	|	ТаблицаНДФЛ.Период,
	|	ТаблицаНДФЛ.КодДохода,
	|	ТаблицаНДФЛ.СтавкаНалогообложенияРезидента,
	|	ВЫБОР
	|		КОГДА ТаблицаНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(ФизическиеЛицаСтатусыНДФЛ.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Нерезидент)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|				КОНЕЦ
	|		КОГДА ТаблицаНДФЛ.КодДохода = ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.Код1010)
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(ФизическиеЛицаСтатусыНДФЛ.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) <> ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
	|					КОГДА ТаблицаНДФЛ.Период >= &ДатаИзмененияНалогообложенияДивидендов
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка09)
	|				КОНЕЦ
	|		КОГДА ЕСТЬNULL(ФизическиеЛицаСтатусыНДФЛ.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|			ТОГДА ВЫБОР
	|					КОГДА ТаблицаНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка09)
	|					КОГДА ТаблицаНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка35)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка35)
	|					ИНАЧЕ """"
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30)
	|	КОНЕЦ КАК СтавкаНДФЛ
	|ПОМЕСТИТЬ ВТБезСтавкиНалогаЧислом
	|ИЗ
	|	#ТаблицаНДФЛ КАК ТаблицаНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыСУчетомИзменений КАК ФизическиеЛицаСтатусыНДФЛ
	|		ПО ТаблицаНДФЛ.ФизическоеЛицо = ФизическиеЛицаСтатусыНДФЛ.ФизическоеЛицо
	|			И ТаблицаНДФЛ.Период = ФизическиеЛицаСтатусыНДФЛ.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаНДФЛ.ФизическоеЛицо,
	|	ТаблицаНДФЛ.Статус,
	|	ТаблицаНДФЛ.Период,
	|	ТаблицаНДФЛ.КодДохода,
	|	ТаблицаНДФЛ.СтавкаНалогообложенияРезидента,
	|	ТаблицаНДФЛ.СтавкаНДФЛ,
	|	СтавкиНалогаЧислом.Размер КАК СтавкаЧислом
	|ПОМЕСТИТЬ ВТСтавкаНДФЛПоСтавкеРезидента
	|ИЗ
	|	ВТБезСтавкиНалогаЧислом КАК ТаблицаНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкиНалогаЧислом КАК СтавкиНалогаЧислом
	|		ПО ТаблицаНДФЛ.СтавкаНДФЛ = СтавкиНалогаЧислом.СтавкаНалогообложения
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТСтатусыНаКонецГода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТФизическиеЛицаСтатусыНДФЛ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТСтавкиНалогаЧислом
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТСтатусыСУчетомИзменений
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТБезСтавкиНалогаЧислом";
	
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "#ТаблицаНДФЛ", ИмяТаблицы);
	Запрос.Выполнить();

КонецПроцедуры

// АПК:581-выкл: Особенности иерархии библиотек

// Предназначена для расчета НДФЛ по записанным в учете данным.
// Параметры:
//      Регистратор - ДокументСсылка - регистратор для которого выполняется расчет НДФЛ.
//		Организация - СправочникСсылка.Организации -
//		МесяцРасчета - дата -
//      МенеджерВременныхТаблиц - МенеджерВременныхТаблиц - содержит вр. таблицу со списком людей, по которым выполняется 
//								расчет НДФЛ
//      	ВТФизическиеЛица 
//				ФизическоеЛицо
//		ПервыйМесяцНалоговогоПериода - дата -
//		ПоследнийМесяцНалоговогоПериода - дата -
//		ИсключатьДоходыРегистратора - булево - 
//		ОкончательныйРасчет - булево - признак того, надо ли при расчете учитывать все зарегистрированные доходы
//		                               (соответствует значению Истина).
//		ДатаУдержанияИсчисленногоНалога - дата - дата предполагаемого удержания налога, который был исчислен по
//		                                         Регистратору.
//
//  Возвращаемое значение - таблица значений с колонками
//			ФизическоеЛицо
//			МесяцНалоговогоПериода.
//			Подразделение
//			КатегорияДохода
//			КодВычетаЛичный
//			ПримененныйВычетЛичный
//			ПримененныйВычетНаДетей
//			ПримененныйВычетНаДетейДвойной
//			ПримененныйВычетНаДетейДвойнойВторой
//			ПримененныйВычетНаТретьегоРебенка
//			ПримененныйВычетНаТретьегоРебенкаДвойной
//			ПримененныйВычетНаТретьегоРебенкаДвойнойВторой
//			ПримененныйВычетНаВторогоРебенка
//			ПримененныйВычетНаВторогоРебенкаДвойной
//			ПримененныйВычетНаВторогоРебенкаДвойнойВторой
//			ПримененныйВычетНаДетейИнвалидов
//			ПримененныйВычетНаДетейИнвалидовДвойной
//			ПримененныйВычетНаДетейИнвалидовДвойнойВторой
//			ПримененныйВычетНаДетейОпекунов
//			ПримененныйВычетНаДетейДвойнойОпекунов
//			ПримененныйВычетНаДетейДвойнойВторойОпекунов
//			ПримененныйВычетНаТретьегоРебенкаОпекунов
//			ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов
//			ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов
//			ПримененныйВычетНаВторогоРебенкаОпекунов
//			ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов
//			ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов
//			ПримененныйВычетНаДетейИнвалидовОпекунов
//			ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов
//			ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов
//			НалогПоСтавке13
//			ЗачтеноАвансовыхПлатежейПоСтавке13
//			ПримененныйВычетИмущественныйРасходы
//			ПримененныйВычетИмущественныйПроцентыПоКредитам
//			ПримененныйВычетИмущественныйПроцентыПриПерекредитовании, ....
//
Функция РассчитатьНалогДо2015Года(Регистратор, Организация, МесяцРасчета, МенеджерВременныхТаблиц, Знач ПервыйМесяцНалоговогоПериода = Неопределено, Знач ПоследнийМесяцНалоговогоПериода = Неопределено, ИсключатьДоходыРегистратора = Истина, ОкончательныйРасчет = Истина, ДатаУдержанияИсчисленногоНалога = Неопределено) Экспорт
	
	Запрос = Новый Запрос();
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("Регистратор", Регистратор);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоМесяцаРасчета",НачалоМесяца(МесяцРасчета));
	Запрос.УстановитьПараметр("КонецМесяцаРасчета",КонецМесяца(МесяцРасчета));
	Запрос.УстановитьПараметр("НачалоГодаРасчета",НачалоГода(МесяцРасчета));
	Запрос.УстановитьПараметр("ИсключаемыйРегистратор", ?(ИсключатьДоходыРегистратора, Регистратор, Неопределено));
	Запрос.УстановитьПараметр("ОкончательныйРасчет", ОкончательныйРасчет);
	Запрос.УстановитьПараметр("ДатаЗакона285ФЗ", УчетНДФЛ.ДатаЗакона285ФЗ());
	ДатаИзмененияИсчисленияДляИностранцев = УчетНДФЛ.ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев();
	Запрос.УстановитьПараметр("ДатаИзмененияИсчисленияДляИностранцев", ДатаИзмененияИсчисленияДляИностранцев);
	Запрос.УстановитьПараметр("Код3010", УчетНДФЛПовтИсп.Доход3010());
	
	УдаляемыеВТ = Новый Массив;
	
	КодыВычетовРезидентов = Новый Массив;
	КодыВычетовРезидентов.Добавить(Справочники.ВидыВычетовНДФЛ.Код403);
	КодыВычетовРезидентов.Добавить(Справочники.ВидыВычетовНДФЛ.Код404);
	КодыВычетовРезидентов.Добавить(Справочники.ВидыВычетовНДФЛ.Код405);
	Запрос.УстановитьПараметр("КодыВычетовРезидентов", КодыВычетовРезидентов);
	
	ЭтоРасчетПоДоходамТекущегоМесяца = ПервыйМесяцНалоговогоПериода = Неопределено Или ПоследнийМесяцНалоговогоПериода = Неопределено;
	
	ЗарплатаКадры.СоздатьПустуюВТ(МенеджерВременныхТаблиц, "РегистрНакопления.СведенияОДоходахНДФЛ");
	ЗарплатаКадры.СоздатьПустуюВТ(МенеджерВременныхТаблиц, "РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ");
	ЗарплатаКадры.СоздатьПустуюВТ(МенеджерВременныхТаблиц, "РегистрНакопления.ИмущественныеВычетыНДФЛ");
	ЗарплатаКадры.СоздатьПустуюВТ(МенеджерВременныхТаблиц, "РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ");
	
	// Если мы рассчитываем налог только по одному физ.лицу, будем использовать условие ФизическоеЛицо = &ФизическоеЛицо
	Запрос.Текст = 
	"ВЫБРАТЬ ПЕРВЫЕ 2
	|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо
	|ИЗ
	|	ВТФизическиеЛица КАК ФизическиеЛица";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Количество() = 1 Тогда
		Выборка.Следующий();
		Запрос.УстановитьПараметр("ФизическоеЛицо", Выборка.ФизическоеЛицо);
		ТекстУсловияФизическоеЛицо = "ФизическоеЛицо = &ФизическоеЛицо";
	Иначе
		ТекстУсловияФизическоеЛицо = 
		"ФизическоеЛицо В
		|	(ВЫБРАТЬ
		|		СписокСотрудников.ФизическоеЛицо
		|	ИЗ
		|		ВТФизическиеЛица КАК СписокСотрудников)";
	КонецЕсли;
	
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		Запрос.УстановитьПараметр("МаксимальнаяДата", ЗарплатаКадрыПериодическиеРегистры.МаксимальнаяДата());
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПериодыДохода.ФизическоеЛицо КАК ФизическоеЛицо,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА ПериодыДохода.НеПодходит
		|				ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		|			ИНАЧЕ НАЧАЛОПЕРИОДА(ПериодыДохода.Период, МЕСЯЦ)
		|		КОНЕЦ) КАК ПериодМакс,
		|	МИНИМУМ(ВЫБОР
		|			КОГДА ПериодыДохода.НеПодходит
		|				ТОГДА &МаксимальнаяДата
		|			КОГДА НАЧАЛОПЕРИОДА(ПериодыДохода.ПериодРегистрации, МЕСЯЦ) = &НачалоМесяцаРасчета
		|				ТОГДА НАЧАЛОПЕРИОДА(ПериодыДохода.Период, ГОД)
		|			ИНАЧЕ &НачалоГодаРасчета
		|		КОНЕЦ) КАК ПериодМин,
		|	МИНИМУМ(ВЫБОР
		|			КОГДА ПериодыДохода.ДоходМежрасчетногоПериода
		|					И ПериодыДохода.ПериодРегистрации >= &НачалоМесяцаРасчета
		|				ТОГДА ПериодыДохода.Период
		|			ИНАЧЕ &МаксимальнаяДата
		|		КОНЕЦ) КАК ПервыйМесяцНалоговогоПериода,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА ПериодыДохода.ДоходМежрасчетногоПериода
		|					И ПериодыДохода.ПериодРегистрации >= &НачалоМесяцаРасчета
		|				ТОГДА ПериодыДохода.Период
		|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
		|		КОНЕЦ) КАК ПоследнийМесяцНалоговогоПериода
		|ПОМЕСТИТЬ ВТПериодыПоФизическимЛицам
		|ИЗ
		|	(ВЫБРАТЬ
		|		Доходы.МесяцНалоговогоПериода КАК Период,
		|		Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
		|		Доходы.Период КАК ПериодРегистрации,
		|		Доходы.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
		|		ВЫБОР
		|			КОГДА Доходы.КодДохода.НеОблагаетсяУНалоговогоАгента
		|					ИЛИ Доходы.Регистратор = &ИсключаемыйРегистратор
		|					ИЛИ Доходы.КодДохода.СтавкаНалогообложенияРезидента <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|					ИЛИ НЕ &ОкончательныйРасчетДоходы
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		КОНЕЦ КАК НеПодходит
		|	ИЗ
		|		РегистрНакопления.СведенияОДоходахНДФЛ КАК Доходы
		|	ГДЕ
		|		Доходы.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета
		|		И Доходы.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|		И &УсловиеФизическоеЛицо
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Доходы.МесяцНалоговогоПериода,
		|		Доходы.ФизическоеЛицо,
		|		Доходы.Период,
		|		Доходы.ДоходМежрасчетногоПериода,
		|		ВЫБОР
		|			КОГДА Доходы.КодДохода.НеОблагаетсяУНалоговогоАгента
		|					ИЛИ Доходы.Регистратор = &ИсключаемыйРегистратор
		|					ИЛИ Доходы.КодДохода.СтавкаНалогообложенияРезидента <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|					ИЛИ НЕ &ОкончательныйРасчетДоходы
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		КОНЕЦ
		|	ИЗ
		|		ВТРегистрНакопления_СведенияОДоходахНДФЛ КАК Доходы
		|	ГДЕ
		|		Доходы.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета
		|		И Доходы.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|		И Доходы.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|		И &УсловиеФизическоеЛицо) КАК ПериодыДохода
		|
		|СГРУППИРОВАТЬ ПО
		|	ПериодыДохода.ФизическоеЛицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МАКСИМУМ(МесяцыНалоговогоПериода.ПоследнийМесяцНалоговогоПериода) КАК ПоследнийМесяцНалоговогоПериода,
		|	МИНИМУМ(МесяцыНалоговогоПериода.ПервыйМесяцНалоговогоПериода) КАК ПервыйМесяцНалоговогоПериода
		|ИЗ
		|	ВТПериодыПоФизическимЛицам КАК МесяцыНалоговогоПериода
		|ГДЕ
		|	МесяцыНалоговогоПериода.ПоследнийМесяцНалоговогоПериода <> ДАТАВРЕМЯ(1, 1, 1)";
		Если ОкончательныйРасчет Тогда
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "ПериодыДохода.ДоходМежрасчетногоПериода", "ИСТИНА");
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетДоходы", "Истина");
		Иначе
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетДоходы","(Доходы.ДоходМежрасчетногоПериода ИЛИ Доходы.Период < &НачалоМесяцаРасчета)");
		КонецЕсли;
		
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеФизическоеЛицо", ТекстУсловияФизическоеЛицо);
		
		Выборка = Запрос.Выполнить().Выбрать();
		УдаляемыеВТ.Добавить("ВТПериодыПоФизическимЛицам");
		
		Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.ПоследнийМесяцНалоговогоПериода) Тогда
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(Выборка.ПоследнийМесяцНалоговогоПериода);
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(Выборка.ПервыйМесяцНалоговогоПериода);
		Иначе
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(МесяцРасчета);
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета);
		КонецЕсли;
	КонецЕсли;
	
	Запрос.УстановитьПараметр("КонецПериодаРасчета", КонецМесяца(ПоследнийМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("НачалоГодаПериодаРасчета", НачалоГода(ПервыйМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("КонецГодаПериодаРасчета", КонецГода(ПоследнийМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("НачалоПредшествующегоГода", ДобавитьМесяц(НачалоГода(ПервыйМесяцНалоговогоПериода), -12));
	
	// Таблица ВТДатыПоМесяцам: список дат налоговых периодов, в которых рассчитывается налог.
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТПериоды(Запрос.МенеджерВременныхТаблиц, НачалоГода(ПервыйМесяцНалоговогоПериода), НачалоМесяца(ПоследнийМесяцНалоговогоПериода),,,"ВТДатыПоМесяцам");
	УдаляемыеВТ.Добавить("ВТДатыПоМесяцам");
	
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПериодыДохода.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Месяцы.Период КАК МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(Месяцы.Период, ГОД) КАК НачалоГодаНалоговогоПериода,
		|	КОНЕЦПЕРИОДА(Месяцы.Период, ГОД) КАК КонецГодаНалоговогоПериода,
		|	МАКСИМУМ(ЕСТЬNULL(РезидентствоФизлиц.РезидентРФНаКонецМесяца, ИСТИНА)
		|			ИЛИ ЕСТЬNULL(РезидентствоФизлиц.РезидентРФНаКонецГода, ИСТИНА)) КАК Резидент,
		|	МАКСИМУМ(ЕСТЬNULL(РезидентствоФизлиц.ПрименяетсяСтавкаПункта1Статьи224НК, ИСТИНА)) КАК ПрименяетсяСтавкаПункта1Статьи224НК
		|ПОМЕСТИТЬ ВТПериодыФизлиц
		|ИЗ
		|	ВТПериодыПоФизическимЛицам КАК ПериодыДохода
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДатыПоМесяцам КАК Месяцы
		|		ПО (Месяцы.Период МЕЖДУ ПериодыДохода.ПериодМин И ПериодыДохода.ПериодМакс)
		|			И (ПериодыДохода.ПериодМин <> ДАТАВРЕМЯ(1, 1, 1))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
		|		ПО ПериодыДохода.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
		|			И (Месяцы.Период МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
		|
		|СГРУППИРОВАТЬ ПО
		|	ПериодыДохода.ФизическоеЛицо,
		|	Месяцы.Период,
		|	НАЧАЛОПЕРИОДА(Месяцы.Период, ГОД),
		|	КОНЕЦПЕРИОДА(Месяцы.Период, ГОД)";
		
	Иначе 
		// Расчет за конкретные месяцы налогового периода.
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Работники.ФизическоеЛицо КАК ФизическоеЛицо,
		|	Месяцы.Период КАК МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(Месяцы.Период, ГОД) КАК НачалоГодаНалоговогоПериода,
		|	КОНЕЦПЕРИОДА(Месяцы.Период, ГОД) КАК КонецГодаНалоговогоПериода,
		|	МАКСИМУМ(ЕСТЬNULL(РезидентствоФизлиц.РезидентРФНаКонецМесяца, ИСТИНА)
		|			ИЛИ ЕСТЬNULL(РезидентствоФизлиц.РезидентРФНаКонецГода, ИСТИНА)) КАК Резидент,
		|	МАКСИМУМ(ЕСТЬNULL(РезидентствоФизлиц.ПрименяетсяСтавкаПункта1Статьи224НК, ИСТИНА)) КАК ПрименяетсяСтавкаПункта1Статьи224НК
		|ПОМЕСТИТЬ ВТПериодыФизлиц
		|ИЗ
		|	ВТФизическиеЛица КАК Работники
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДатыПоМесяцам КАК Месяцы
		|		ПО (ИСТИНА)
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
		|		ПО Работники.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
		|			И (Месяцы.Период МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
		|
		|СГРУППИРОВАТЬ ПО
		|	Работники.ФизическоеЛицо,
		|	Месяцы.Период,
		|	НАЧАЛОПЕРИОДА(Месяцы.Период, ГОД),
		|	КОНЕЦПЕРИОДА(Месяцы.Период, ГОД)";
	КонецЕсли;
	Запрос.Выполнить();
	УдаляемыеВТ.Добавить("ВТПериодыФизлиц");
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Обороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Обороты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Обороты.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	Обороты.Регистратор КАК Регистратор,
	|	Обороты.Подразделение КАК Подразделение,
	|	Обороты.Период КАК Период,
	|	Обороты.СтавкаНалогообложения КАК СтавкаНалогообложения,
	|	Обороты.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
	|	Обороты.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	Обороты.КодВычета.НеПредоставляетсяНерезидентам КАК НеПредоставляетсяНерезидентам,
	|	Обороты.КодВычета КАК КодВычета,
	|	Обороты.КодДохода КАК КодДохода,
	|	&Сторно КАК Сторно,
	|	Обороты.КатегорияДохода КАК КатегорияДохода,
	|	Обороты.СуммаДохода КАК СуммаДохода,
	|	Обороты.СуммаВычета КАК СуммаВычета
	|ПОМЕСТИТЬ ВТСведенияОДоходахНДФЛ
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК Обороты
	|ГДЕ
	|	Обороты.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И Обороты.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И Обороты.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|	И Обороты.Регистратор <> &ИсключаемыйРегистратор
	|	И &УсловиеФизическоеЛицо
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Обороты.ФизическоеЛицо,
	|	Обороты.МесяцНалоговогоПериода,
	|	Обороты.ДатаПолученияДохода,
	|	&Регистратор,
	|	Обороты.Подразделение,
	|	Обороты.Период,
	|	Обороты.СтавкаНалогообложения,
	|	Обороты.ДоходМежрасчетногоПериода,
	|	Обороты.ИсточникДоходаЗаПределамиРФ,
	|	Обороты.КодВычета.НеПредоставляетсяНерезидентам,
	|	Обороты.КодВычета,
	|	Обороты.КодДохода,
	|	&Сторно,
	|	Обороты.КатегорияДохода,
	|	Обороты.СуммаДохода,
	|	Обороты.СуммаВычета
	|ИЗ
	|	ВТРегистрНакопления_СведенияОДоходахНДФЛ КАК Обороты
	|ГДЕ
	|	Обороты.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И Обороты.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И Обороты.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|	И &УсловиеФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК Период,
	|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода
	|ПОМЕСТИТЬ ВТСтрокиУчета
	|ИЗ
	|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|ГДЕ
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода >= &ДатаИзмененияИсчисленияДляИностранцев";
	Если Метаданные.РегистрыНакопления.СведенияОДоходахНДФЛ.Реквизиты.Найти("Сторно") = Неопределено Тогда
		Запрос.УстановитьПараметр("Сторно", Ложь);
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Сторно", "Обороты.Сторно");
	КонецЕсли;
	
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеФизическоеЛицо", ТекстУсловияФизическоеЛицо);
	Запрос.Выполнить();
	УдаляемыеВТ.Добавить("ВТСведенияОДоходахНДФЛ");
	УдаляемыеВТ.Добавить("ВТСтрокиУчета");
	
	СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТСтрокиУчета", "УчитыватьИзмененияСтатусаДляРасчета");
	УдаляемыеВТ.Добавить("ВТСтавкаНДФЛПоСтавкеРезидента");
	
	Запрос.УстановитьПараметр("ПериодСрезаПравНаВычеты",  НачалоМесяца(Макс(МесяцРасчета, ПоследнийМесяцНалоговогоПериода)));
	
	ОсобенностиУчетаВычетов = Перечисления.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	УчетнаяПолитикаПоНДФЛ.ОсобенностиИсчисленияНДФЛ КАК ОсобенностиИсчисленияНДФЛ
	|ИЗ
	|	РегистрСведений.УчетнаяПолитикаПоНДФЛ КАК УчетнаяПолитикаПоНДФЛ
	|ГДЕ
	|	УчетнаяПолитикаПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ОсобенностиУчетаВычетов = Выборка.ОсобенностиИсчисленияНДФЛ;
	КонецЕсли;
	
	Запрос.УстановитьПараметр("КонецПериодаИмущественныхВычетов", Макс(КонецМесяца(МесяцРасчета), КонецМесяца(ПоследнийМесяцНалоговогоПериода)));
	
	ПакетЗапросов = Новый Массив;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Вычеты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Вычеты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	НАЧАЛОПЕРИОДА(ВЫБОР
	|			КОГДА Вычеты.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА Вычеты.МесяцНалоговогоПериода
	|			ИНАЧЕ Вычеты.МесяцПериодаПредоставленияВычета
	|		КОНЕЦ, МЕСЯЦ) КАК МесяцПериодаПредоставленияВычета,
	|	Вычеты.КодВычета КАК КодВычета,
	|	Вычеты.Подразделение КАК Подразделение,
	|	СУММА(Вычеты.СуммаОборот) КАК СуммаОборот
	|ПОМЕСТИТЬ ВТПредоставленныеСтандартныеИСоциальныеВычеты
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВычетыБД.ФизическоеЛицо КАК ФизическоеЛицо,
	|		НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|		ВычетыБД.МесяцПериодаПредоставленияВычета КАК МесяцПериодаПредоставленияВычета,
	|		ВычетыБД.КодВычета КАК КодВычета,
	|		ВычетыБД.Подразделение КАК Подразделение,
	|		ВычетыБД.Сумма КАК СуммаОборот
	|	ИЗ
	|		РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ВычетыБД
	|	ГДЕ
	|		ВычетыБД.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|		И ВычетыБД.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И &УсловиеФизическоеЛицо
	|		И (ВычетыБД.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|				ИЛИ ВЫБОР
	|					КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|						ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|					ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
	|				КОНЕЦ МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|		И ВычетыБД.Регистратор <> &Регистратор
	|		И &ОкончательныйРасчетВычеты
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ВычетыВТ.ФизическоеЛицо,
	|		НАЧАЛОПЕРИОДА(ВычетыВТ.МесяцНалоговогоПериода, МЕСЯЦ),
	|		ВычетыВТ.МесяцПериодаПредоставленияВычета,
	|		ВычетыВТ.КодВычета,
	|		ВычетыВТ.Подразделение,
	|		ВычетыВТ.Сумма
	|	ИЗ
	|		ВТРегистрНакопления_ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ВычетыВТ
	|	ГДЕ
	|		ВычетыВТ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|		И ВычетыВТ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И &УсловиеФизическоеЛицо
	|		И ВычетыВТ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|		И ВычетыВТ.Регистратор <> &Регистратор
	|		И &ОкончательныйРасчетВычеты) КАК Вычеты
	|
	|СГРУППИРОВАТЬ ПО
	|	Вычеты.ФизическоеЛицо,
	|	Вычеты.МесяцНалоговогоПериода,
	|	Вычеты.КодВычета,
	|	Вычеты.Подразделение,
	|	НАЧАЛОПЕРИОДА(ВЫБОР
	|			КОГДА Вычеты.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА Вычеты.МесяцНалоговогоПериода
	|			ИНАЧЕ Вычеты.МесяцПериодаПредоставленияВычета
	|		КОНЕЦ, МЕСЯЦ)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(ВЫБОР
	|			КОГДА Периоды.Резидент
	|				ТОГДА ЕСТЬNULL(ПредоставленныеВычетыФизЛиц.СуммаОборот, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК СуммаОборот
	|ПОМЕСТИТЬ ВТСоциальныеВычетыПомесячно
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПредоставленныеСтандартныеИСоциальныеВычеты КАК ПредоставленныеВычетыФизЛиц
	|		ПО Периоды.ФизическоеЛицо = ПредоставленныеВычетыФизЛиц.ФизическоеЛицо
	|			И (ПредоставленныеВычетыФизЛиц.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные))
	|			И Периоды.МесяцНалоговогоПериода = ПредоставленныеВычетыФизЛиц.МесяцНалоговогоПериода
	|
	|СГРУППИРОВАТЬ ПО
	|	Периоды.МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Обороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(Обороты.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	Обороты.СтавкаНалогообложения КАК СтавкаНалогообложения,
	|	Обороты.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	Обороты.КодВычета КАК КодВычета,
	|	Обороты.НеПредоставляетсяНерезидентам КАК НеПредоставляетсяНерезидентам,
	|	Обороты.СуммаДохода КАК СуммаДоходаОборот,
	|	Обороты.СуммаВычета КАК СуммаВычетаОборот,
	|	Обороты.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	Обороты.КатегорияДохода КАК КатегорияДохода,
	|	Обороты.КодДохода КАК КодДохода,
	|	Обороты.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	Обороты.Подразделение КАК Подразделение,
	|	Обороты.Период КАК Период,
	|	Обороты.Регистратор КАК ДокументОснование,
	|	Обороты.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
	|	Обороты.Сторно КАК Сторно
	|ПОМЕСТИТЬ ВТДанныеУчета
	|ИЗ
	|	ВТСведенияОДоходахНДФЛ КАК Обороты
	|ГДЕ
	|	Обороты.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|	И НЕ Обороты.КодДохода.НеОблагаетсяУНалоговогоАгента
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
	|	СведенияОДоходахНДФЛ.СтавкаНалогообложения,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.КодВычета,
	|	СведенияОДоходахНДФЛ.НеПредоставляетсяНерезидентам,
	|	-СведенияОДоходахНДФЛ.СуммаДохода,
	|	-СведенияОДоходахНДФЛ.СуммаВычета,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.КатегорияДохода,
	|	СведенияОДоходахНДФЛ.КодДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.Подразделение,
	|	СведенияОДоходахНДФЛ.Период,
	|	СведенияОДоходахНДФЛ.Регистратор,
	|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
	|	СведенияОДоходахНДФЛ.Сторно
	|ИЗ
	|	ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|ГДЕ
	|	НЕ &ОкончательныйРасчет
	|	И НЕ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
	|	И СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|	И НЕ СведенияОДоходахНДФЛ.КодДохода.НеОблагаетсяУНалоговогоАгента
	|	И СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета";
	
	ПакетЗапросов.Добавить(ТекстЗапроса);
	УдаляемыеВТ.Добавить("ВТПредоставленныеСтандартныеИСоциальныеВычеты");
	УдаляемыеВТ.Добавить("ВТСоциальныеВычетыПомесячно");
	УдаляемыеВТ.Добавить("ВТДанныеУчета");
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ДанныеУчета.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ДанныеУчета.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ДанныеУчета.СтавкаНалогообложения КАК СтавкаНалогообложения,
	|	ДанныеУчета.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	ДанныеУчета.КодВычета КАК КодВычета,
	|	ДанныеУчета.НеПредоставляетсяНерезидентам КАК НеПредоставляетсяНерезидентам,
	|	СУММА(ДанныеУчета.СуммаДоходаОборот) КАК СуммаДоходаОборот,
	|	СУММА(ДанныеУчета.СуммаВычетаОборот) КАК СуммаВычетаОборот
	|ПОМЕСТИТЬ ВТДоходыФизлиц
	|ИЗ
	|	ВТДанныеУчета КАК ДанныеУчета
	|ГДЕ
	|	ДанныеУчета.МесяцНалоговогоПериода < &ДатаИзмененияИсчисленияДляИностранцев
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеУчета.ФизическоеЛицо,
	|	ДанныеУчета.МесяцНалоговогоПериода,
	|	ДанныеУчета.СтавкаНалогообложения,
	|	ДанныеУчета.ИсточникДоходаЗаПределамиРФ,
	|	ДанныеУчета.НеПредоставляетсяНерезидентам,
	|	ДанныеУчета.КодВычета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Периоды.Резидент КАК Резидент,
	|	ВЫБОР
	|		КОГДА Периоды.Резидент
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
	|		КОГДА Обороты.СтавкаНалогообложения = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.ПустаяСсылка)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка30)
	|		ИНАЧЕ Обороты.СтавкаНалогообложения
	|	КОНЕЦ КАК СтавкаНалогообложенияНеРезидента,
	|	ЕСТЬNULL(Обороты.СуммаДоходаОборот, 0) - ВЫБОР
	|		КОГДА Периоды.Резидент
	|			ТОГДА ЕСТЬNULL(Обороты.СуммаВычетаОборот, 0)
	|		КОГДА Обороты.НеПредоставляетсяНерезидентам
	|			ТОГДА 0
	|		ИНАЧЕ ЕСТЬNULL(Обороты.СуммаВычетаОборот, 0)
	|	КОНЕЦ КАК ДоходыБезВычетов
	|ПОМЕСТИТЬ ВТДоходыСУчетомВычетовКДоходам
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыФизлиц КАК Обороты
	|		ПО Периоды.ФизическоеЛицо = Обороты.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = Обороты.МесяцНалоговогоПериода
	|			И (Периоды.Резидент
	|				ИЛИ НЕ Обороты.ИсточникДоходаЗаПределамиРФ)
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода < &ДатаИзмененияИсчисленияДляИностранцев";
	
	Если ПервыйМесяцНалоговогоПериода < Запрос.Параметры.ДатаИзмененияИсчисленияДляИностранцев Тогда
		ПакетЗапросов.Добавить(ТекстЗапроса);
		УдаляемыеВТ.Добавить("ВТДоходыФизлиц");
		УдаляемыеВТ.Добавить("ВТДоходыСУчетомВычетовКДоходам");
	КонецЕсли;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Обороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Обороты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Обороты.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	Обороты.КодДохода КАК КодДохода,
	|	Обороты.Сторно,
	|	Обороты.КатегорияДохода КАК КатегорияДохода,
	|	ВЫБОР
	|		КОГДА Обороты.КодДохода = &Код3010
	|				И Обороты.ДатаПолученияДохода >= ДАТАВРЕМЯ(2018, 1, 1)
	|			ТОГДА ЛОЖЬ
	|		КОГДА Обороты.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|				И СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|			ТОГДА ИСТИНА
	|		КОГДА Обороты.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|				И СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ГражданинСтраныЕАЭС)
	|			ТОГДА ВЫБОР
	|					КОГДА Обороты.ДатаПолученияДохода < ДАТАВРЕМЯ(2018, 1, 1)
	|						ТОГДА ИСТИНА
	|					КОГДА Обороты.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыВДенежнойФормеОтТрудовойДеятельности), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходВНатуральнойФормеОтТрудовойДеятельности), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций))
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ ЛОЖЬ
	|				КОНЕЦ
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ИсчислятьНалогНарастающимИтогом,
	|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом КАК СтавкаЧислом,
	|	Обороты.Подразделение КАК Подразделение,
	|	СУММА(ВЫБОР
	|			КОГДА Обороты.ИсточникДоходаЗаПределамиРФ
	|				ТОГДА ВЫБОР
	|						КОГДА СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|							ТОГДА Обороты.СуммаДоходаОборот - Обороты.СуммаВычетаОборот
	|						ИНАЧЕ 0
	|					КОНЕЦ
	|			ИНАЧЕ Обороты.СуммаДоходаОборот - ВЫБОР
	|					КОГДА СтавкаНДФЛПоСтавкеРезидента.Статус В (ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент), ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ГражданинСтраныЕАЭС))
	|						ТОГДА Обороты.СуммаВычетаОборот
	|					КОГДА Обороты.НеПредоставляетсяНерезидентам
	|						ТОГДА 0
	|					ИНАЧЕ Обороты.СуммаВычетаОборот
	|				КОНЕЦ
	|		КОНЕЦ) КАК ДоходыБезВычетов,
	|	СУММА(Обороты.СуммаДоходаОборот) КАК ВсеДоходы,
	|	СтавкаНДФЛПоСтавкеРезидента.Статус КАК Статус,
	|	Обороты.Период КАК Период,
	|	Обороты.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
	|	Обороты.ДокументОснование КАК ДокументОснование
	|ПОМЕСТИТЬ ВТДоходыСоСтавками
	|ИЗ
	|	ВТДанныеУчета КАК Обороты
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
	|		ПО Обороты.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
	|			И Обороты.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
	|			И Обороты.ДатаПолученияДохода = СтавкаНДФЛПоСтавкеРезидента.Период
	|			И Обороты.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
	|ГДЕ
	|	Обороты.ДатаПолученияДохода >= &ДатаИзмененияИсчисленияДляИностранцев
	|
	|СГРУППИРОВАТЬ ПО
	|	Обороты.ФизическоеЛицо,
	|	Обороты.МесяцНалоговогоПериода,
	|	Обороты.ДатаПолученияДохода,
	|	Обороты.КодДохода,
	|	Обороты.Сторно,
	|	Обороты.Подразделение,
	|	СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом,
	|	СтавкаНДФЛПоСтавкеРезидента.Статус,
	|	ВЫБОР
	|		КОГДА Обороты.КодДохода = &Код3010
	|				И Обороты.ДатаПолученияДохода >= ДАТАВРЕМЯ(2018, 1, 1)
	|			ТОГДА ЛОЖЬ
	|		КОГДА Обороты.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|				И СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)
	|			ТОГДА ИСТИНА
	|		КОГДА Обороты.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|				И СтавкаНДФЛПоСтавкеРезидента.Статус = ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.ГражданинСтраныЕАЭС)
	|			ТОГДА ВЫБОР
	|					КОГДА Обороты.ДатаПолученияДохода < ДАТАВРЕМЯ(2018, 1, 1)
	|						ТОГДА ИСТИНА
	|					КОГДА Обороты.КатегорияДохода В (ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПрочиеДоходыВДенежнойФормеОтТрудовойДеятельности), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходВНатуральнойФормеОтТрудовойДеятельности), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ОплатаТруда), ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ДоходыПредыдущихРедакций))
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ ЛОЖЬ
	|				КОНЕЦ
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	Обороты.Период,
	|	Обороты.ДоходМежрасчетногоПериода,
	|	Обороты.КатегорияДохода,
	|	Обороты.ДокументОснование";
	
	ПакетЗапросов.Добавить(ТекстЗапроса);
	УдаляемыеВТ.Добавить("ВТДоходыСоСтавками");
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ЕСТЬNULL(СУММА(Доходы.ДоходыБезВычетов), 0) КАК ОблагаемыйДоходЗаГод,
	|	ЕСТЬNULL(СУММА(ВЫБОР
	|				КОГДА Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
	|					ТОГДА Доходы.ДоходыБезВычетов
	|				ИНАЧЕ 0
	|			КОНЕЦ), 0) КАК ОблагаемыйДоходЗаМесяц
	|ПОМЕСТИТЬ ВТДоходыРезидентовНарастающимЗаГод
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК Доходы
	|		ПО (Доходы.МесяцНалоговогоПериода МЕЖДУ Периоды.НачалоГодаНалоговогоПериода И Периоды.МесяцНалоговогоПериода)
	|			И Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
	|			И (Доходы.ИсчислятьНалогНарастающимИтогом)
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода >= &ДатаИзмененияИсчисленияДляИностранцев
	|
	|СГРУППИРОВАТЬ ПО
	|	Периоды.МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо";
	
	Если ПервыйМесяцНалоговогоПериода < Запрос.Параметры.ДатаИзмененияИсчисленияДляИностранцев Тогда
		ТекстЗапроса = ТекстЗапроса + Символы.ПС + 
		"ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Периоды.МесяцНалоговогоПериода,
		|	Периоды.ФизическоеЛицо,
		|	ЕСТЬNULL(СУММА(Доходы.ДоходыБезВычетов), 0),
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
		|					ТОГДА Доходы.ДоходыБезВычетов
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0)
		|ИЗ
		|	ВТПериодыФизлиц КАК Периоды
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСУчетомВычетовКДоходам КАК Доходы
		|		ПО (Доходы.МесяцНалоговогоПериода МЕЖДУ Периоды.НачалоГодаНалоговогоПериода И Периоды.МесяцНалоговогоПериода)
		|			И Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
		|			И (Периоды.Резидент)
		|ГДЕ
		|	Периоды.МесяцНалоговогоПериода < &ДатаИзмененияИсчисленияДляИностранцев
		|
		|СГРУППИРОВАТЬ ПО
		|	Периоды.МесяцНалоговогоПериода,
		|	Периоды.ФизическоеЛицо";
	КонецЕсли;
	
	ПакетЗапросов.Добавить(ТекстЗапроса);
	УдаляемыеВТ.Добавить("ВТДоходыРезидентовНарастающимЗаГод");
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Периоды.НачалоГодаНалоговогоПериода КАК НачалоГодаНалоговогоПериода,
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	Доходы.ДоходМежрасчетногоПериода КАК ЗарегистрированоДляПромежуточногоРасчета
	|ПОМЕСТИТЬ ВТДатыПолученияДоходаДляНарастающегоДохода
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК Доходы
	|		ПО Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
	|			И Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода >= &ДатаИзмененияИсчисленияДляИностранцев
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Периоды.НачалоГодаНалоговогоПериода,
	|	Периоды.МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(КОНЕЦПЕРИОДА(Периоды.МесяцНалоговогоПериода, МЕСЯЦ), ДЕНЬ),
	|	ЛОЖЬ
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК Доходы
	|		ПО Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
	|			И Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
	|			И (Доходы.ДатаПолученияДохода = НАЧАЛОПЕРИОДА(КОНЕЦПЕРИОДА(Периоды.МесяцНалоговогоПериода, МЕСЯЦ), ДЕНЬ))
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода >= &ДатаИзмененияИсчисленияДляИностранцев
	|	И Доходы.ДатаПолученияДохода ЕСТЬ NULL
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Периоды.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	Периоды.ЗарегистрированоДляПромежуточногоРасчета КАК ЗарегистрированоДляПромежуточногоРасчета,
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ЕСТЬNULL(СУММА(ВЫБОР
	|				КОГДА Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
	|						И Доходы.ИсчислятьНалогНарастающимИтогом
	|					ТОГДА Доходы.ДоходыБезВычетов
	|				ИНАЧЕ 0
	|			КОНЕЦ), 0) КАК ОблагаемыйДоходЗаМесяц,
	|	ЕСТЬNULL(СУММА(ВЫБОР
	|				КОГДА Доходы.ИсчислятьНалогНарастающимИтогом
	|					ТОГДА Доходы.ДоходыБезВычетов
	|				ИНАЧЕ 0
	|			КОНЕЦ), 0) КАК ОблагаемыйДоходЗаГод
	|ПОМЕСТИТЬ ВТДоходыПоДатамПолученияДоходаНарастающимЗаГод
	|ИЗ
	|	ВТДатыПолученияДоходаДляНарастающегоДохода КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК Доходы
	|		ПО (Доходы.ДатаПолученияДохода >= Периоды.НачалоГодаНалоговогоПериода
	|					И Доходы.ДатаПолученияДохода < Периоды.ДатаПолученияДохода
	|				ИЛИ Доходы.ДатаПолученияДохода = Периоды.ДатаПолученияДохода
	|					И Доходы.ДоходМежрасчетногоПериода = Периоды.ЗарегистрированоДляПромежуточногоРасчета
	|				ИЛИ Доходы.ДатаПолученияДохода = Периоды.ДатаПолученияДохода
	|					И НЕ Периоды.ЗарегистрированоДляПромежуточногоРасчета)
	|			И Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
	|
	|СГРУППИРОВАТЬ ПО
	|	Периоды.ДатаПолученияДохода,
	|	Периоды.ЗарегистрированоДляПромежуточногоРасчета,
	|	Периоды.МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код108)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаДетей,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код110)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаДетейДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код111)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаДетейДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код116)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаТретьегоРебенка,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код120)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаТретьегоРебенкаДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код124)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаТретьегоРебенкаДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код115)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаВторогоРебенка,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код119)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаВторогоРебенкаДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код123)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаВторогоРебенкаДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код109)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаРебенкаИнвалида,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код112)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаРебенкаИнвалидаДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код113)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаРебенкаИнвалидаДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код130)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаДетейДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код135)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаДетейДвойнойДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код143)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаДетейДвойнойВторойДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код132)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаТретьегоРебенкаДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код139)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаТретьегоРебенкаДвойнойДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код147)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаТретьегоРебенкаДвойнойВторойДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код131)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаВторогоРебенкаДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код137)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаВторогоРебенкаДвойнойДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код145)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаВторогоРебенкаДвойнойВторойДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код117о)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаРебенкаИнвалидаДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код121о)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаРебенкаИнвалидаДвойнойДляОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код125о)
	|				ТОГДА ЕСТЬNULL(ВычетыНаДетей.Количество, 0) * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетНаРебенкаИнвалидаДвойнойВторойДляОпекунов,
	|	ЕСТЬNULL(МАКСИМУМ(ВЫБОР
	|				КОГДА ЕСТЬNULL(НЕ ВычетыНаДетей.ЛичныйВычет, ИСТИНА)
	|					ТОГДА РазмерВычетовНаДетей.ОграничениеПоДоходам
	|				ИНАЧЕ 0
	|			КОНЕЦ), 0) КАК ОграничениеПоДоходам,
	|	СУММА(ВЫБОР
	|			КОГДА ВычетыНаДетей.ЛичныйВычет
	|				ТОГДА 1 * ЕСТЬNULL(РазмерВычетовНаДетей.Размер, 0)
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетЛичный,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА ЕСТЬNULL(ВычетыНаДетей.ЛичныйВычет, ЛОЖЬ)
	|				ТОГДА ВычетыНаДетей.КодВычета
	|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		КОНЕЦ) КАК КодВычетаЛичный,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА ЕСТЬNULL(ВычетыНаДетей.ЛичныйВычет, ЛОЖЬ)
	|				ТОГДА РазмерВычетовНаДетей.ОграничениеПоДоходам
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ОграничениеПоДоходамЛичныйВычет
	|ПОМЕСТИТЬ ВТВычетыНаДетейИЛичные
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтандартныеВычетыПоНДФЛВторичный КАК ВычетыНаДетей
	|		ПО Периоды.ФизическоеЛицо = ВычетыНаДетей.ФизическоеЛицо
	|			И (ВЫБОР
	|				КОГДА Периоды.МесяцНалоговогоПериода > &ПериодСрезаПравНаВычеты
	|					ТОГДА &ПериодСрезаПравНаВычеты
	|				ИНАЧЕ Периоды.МесяцНалоговогоПериода
	|			КОНЕЦ МЕЖДУ ВычетыНаДетей.ПериодРегистрацииНачало И ВычетыНаДетей.ПериодРегистрацииОкончание)
	|			И (Периоды.МесяцНалоговогоПериода МЕЖДУ ВычетыНаДетей.ДатаНачала И ВычетыНаДетей.ДатаОкончания)
	|			И (НЕ ВычетыНаДетей.ЛичныйВычет
	|				ИЛИ ВычетыНаДетей.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РазмерВычетовНДФЛВторичный КАК РазмерВычетовНаДетей
	|		ПО (ВычетыНаДетей.КодВычета = РазмерВычетовНаДетей.КодВычета)
	|			И (Периоды.НачалоГодаНалоговогоПериода МЕЖДУ РазмерВычетовНаДетей.ДатаНачала И РазмерВычетовНаДетей.ДатаОкончания)
	|
	|СГРУППИРОВАТЬ ПО
	|	Периоды.ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ВычетыНаДетей.КодВычетаЛичный КАК КодВычетаЛичный,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ЕСТЬNULL(ВычетыНаДетей.ОграничениеПоДоходамЛичныйВычет, 0)
	|					ИЛИ ЕСТЬNULL(ВычетыНаДетей.ОграничениеПоДоходамЛичныйВычет, 0) = 0)
	|			ТОГДА ЕСТЬNULL(ВычетыНаДетей.ВычетЛичный, 0)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыЛичные,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаДетей
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетские,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаДетейДвойной
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеДвойные,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаДетейДвойнойВторой
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеДвойныеВторые,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаТретьегоРебенка
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаТретьегоРебенка,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаТретьегоРебенкаДвойной
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаТретьегоРебенкаДвойные,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаТретьегоРебенкаДвойнойВторой
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаВторогоРебенка
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаВторогоРебенка,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаВторогоРебенкаДвойной
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаВторогоРебенкаДвойные,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаВторогоРебенкаДвойнойВторой
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаВторогоРебенкаДвойныеВторые,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаРебенкаИнвалида
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеИнвалидов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаРебенкаИнвалидаДвойной
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеИнвалидовДвойные,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаРебенкаИнвалидаДвойнойВторой
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеИнвалидовДвойныеВторые,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаДетейДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаДетейДвойнойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеДвойныеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаДетейДвойнойВторойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеДвойныеВторыеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаТретьегоРебенкаДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаТретьегоРебенкаОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаТретьегоРебенкаДвойнойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаТретьегоРебенкаДвойныеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаТретьегоРебенкаДвойнойВторойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаТретьегоРебенкаДвойныеВторыеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаВторогоРебенкаДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаВторогоРебенкаОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаВторогоРебенкаДвойнойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаВторогоРебенкаДвойныеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаВторогоРебенкаДвойнойВторойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыНаВторогоРебенкаДвойныеВторыеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаРебенкаИнвалидаДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеИнвалидовОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаРебенкаИнвалидаДвойнойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеИнвалидовДвойныеОпекунов,
	|	ВЫБОР
	|		КОГДА ПрименениеВычетов.ПрименятьВычеты
	|				И Периоды.ПрименяетсяСтавкаПункта1Статьи224НК
	|				И (ДоходыНарастающимИтогом.ОблагаемыйДоходЗаГод + ЕСТЬNULL(ДоходыСПредыдущегоМестаРаботы.Размер, 0) <= ВычетыНаДетей.ОграничениеПоДоходам
	|					ИЛИ ВычетыНаДетей.ОграничениеПоДоходам = 0)
	|			ТОГДА ВычетыНаДетей.ВычетНаРебенкаИнвалидаДвойнойВторойДляОпекунов
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СтандартныеВычетыДетскиеИнвалидовДвойныеВторыеОпекунов,
	|	ВычетыНаДетей.ОграничениеПоДоходамЛичныйВычет КАК ОграничениеПоДоходамЛичные,
	|	ВычетыНаДетей.ОграничениеПоДоходам КАК ОграничениеПоДоходамНаДетей
	|ПОМЕСТИТЬ ВТПраваНаСтандартныеВычетыПоМесяцам
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПрименениеСтандартныхВычетовПоНДФЛВторичный КАК ПрименениеВычетов
	|		ПО Периоды.ФизическоеЛицо = ПрименениеВычетов.ФизическоеЛицо
	|			И (ПрименениеВычетов.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|			И (Периоды.МесяцНалоговогоПериода МЕЖДУ ПрименениеВычетов.ДатаНачала И ПрименениеВычетов.ДатаОкончания)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДоходыПредыдущегоМестаРаботыНДФЛ КАК ДоходыСПредыдущегоМестаРаботы
	|		ПО Периоды.МесяцНалоговогоПериода = ДоходыСПредыдущегоМестаРаботы.МесяцНалоговогоПериода
	|			И Периоды.ФизическоеЛицо = ДоходыСПредыдущегоМестаРаботы.ФизическоеЛицо
	|			И (ДоходыСПредыдущегоМестаРаботы.ГоловнаяОрганизация = &ГоловнаяОрганизация)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыРезидентовНарастающимЗаГод КАК ДоходыНарастающимИтогом
	|		ПО Периоды.МесяцНалоговогоПериода = ДоходыНарастающимИтогом.МесяцНалоговогоПериода
	|			И Периоды.ФизическоеЛицо = ДоходыНарастающимИтогом.ФизическоеЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВычетыНаДетейИЛичные КАК ВычетыНаДетей
	|		ПО Периоды.ФизическоеЛицо = ВычетыНаДетей.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = ВычетыНаДетей.МесяцНалоговогоПериода";
	
	ПакетЗапросов.Добавить(ТекстЗапроса);
	УдаляемыеВТ.Добавить("ВТМесяцыПолученияДохода");
	УдаляемыеВТ.Добавить("ВТДатыПолученияДоходаДляНарастающегоДохода");
	УдаляемыеВТ.Добавить("ВТДоходыПоДатамПолученияДоходаНарастающимЗаГод");
	УдаляемыеВТ.Добавить("ВТВычетыНаДетейИЛичные");
	УдаляемыеВТ.Добавить("ВТПраваНаСтандартныеВычетыПоМесяцам");
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Доходы.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(ВЫРАЗИТЬ(ВЫБОР
	|				КОГДА Доходы.Резидент
	|					ТОГДА 0
	|				ИНАЧЕ Доходы.ДоходыБезВычетов
	|			КОНЕЦ * &СтавкиНалогаВПроцентахРазмер КАК ЧИСЛО(13, 0))) КАК НалогНерезидента
	|ПОМЕСТИТЬ ВТНалогНерезидентов
	|ИЗ
	|	ВТДоходыСУчетомВычетовКДоходам КАК Доходы
	|
	|СГРУППИРОВАТЬ ПО
	|	Доходы.ФизическоеЛицо,
	|	Доходы.МесяцНалоговогоПериода";
	ВписатьТекстПолученияЗначенияСтавкиНДФЛЧислом(ТекстЗапроса, "&СтавкиНалогаВПроцентахРазмер", "Доходы", "СтавкаНалогообложенияНеРезидента");
	Если ПервыйМесяцНалоговогоПериода < Запрос.Параметры.ДатаИзмененияИсчисленияДляИностранцев Тогда
		ПакетЗапросов.Добавить(ТекстЗапроса);
		УдаляемыеВТ.Добавить("ВТНалогНерезидентов");
	КонецЕсли;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ЕСТЬNULL(ДатыДохода.ДатаПолученияДохода, МАКСИМУМ(ЕСТЬNULL(Доходы.ДатаПолученияДохода, НАЧАЛОПЕРИОДА(КОНЕЦПЕРИОДА(Периоды.МесяцНалоговогоПериода, МЕСЯЦ), ДЕНЬ)))) КАК ДатаПолученияДохода,
	|	ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент) КАК Статус,
	|	ЗНАЧЕНИЕ(Справочник.ВидыДоходовНДФЛ.ПустаяСсылка) КАК КодДохода,
	|	ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.ПустаяСсылка) КАК КатегорияДохода,
	|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК Подразделение,
	|	ЕСТЬNULL(СУММА(Доходы.ВсеДоходы), 0) КАК СуммаДохода,
	|	0 КАК НалогНерезидента,
	|	ИСТИНА КАК ИсчислятьНалогНарастающимИтогом,
	|	ЕСТЬNULL(ДатыДохода.ДоходМежрасчетногоПериода, ЛОЖЬ) КАК ЗарегистрированоДляПромежуточногоРасчета,
	|	МАКСИМУМ(ЕСТЬNULL(Доходы.ДатаПолученияДохода, НАЧАЛОПЕРИОДА(КОНЕЦПЕРИОДА(Периоды.МесяцНалоговогоПериода, МЕСЯЦ), ДЕНЬ))) КАК МаксимальнаяДатаПолученияДохода
	|ПОМЕСТИТЬ ВТДоходыНалоги
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК Доходы
	|		ПО Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
	|			И (Доходы.ИсчислятьНалогНарастающимИтогом)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК ДатыДохода
	|		ПО Периоды.ФизическоеЛицо = ДатыДохода.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = ДатыДохода.МесяцНалоговогоПериода
	|			И (ДатыДохода.ИсчислятьНалогНарастающимИтогом)
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода >= &ДатаИзмененияИсчисленияДляИностранцев
	|
	|СГРУППИРОВАТЬ ПО
	|	Периоды.МесяцНалоговогоПериода,
	|	Периоды.ФизическоеЛицо,
	|	ДатыДохода.ДатаПолученияДохода,
	|	ДатыДохода.ДоходМежрасчетногоПериода
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Периоды.ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода,
	|	Доходы.ДатаПолученияДохода,
	|	Доходы.Статус,
	|	Доходы.КодДохода,
	|	Доходы.КатегорияДохода,
	|	Доходы.Подразделение,
	|	СУММА(Доходы.ДоходыБезВычетов),
	|	ВЫРАЗИТЬ(СУММА(Доходы.ДоходыБезВычетов) * Доходы.СтавкаЧислом КАК ЧИСЛО(13, 0)),
	|	ЛОЖЬ,
	|	Доходы.ДоходМежрасчетногоПериода,
	|	Доходы.ДатаПолученияДохода
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК Доходы
	|		ПО Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
	|			И Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
	|			И (НЕ Доходы.ИсчислятьНалогНарастающимИтогом)
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода >= &ДатаИзмененияИсчисленияДляИностранцев
	|	И Доходы.ФизическоеЛицо ЕСТЬ НЕ NULL 
	|
	|СГРУППИРОВАТЬ ПО
	|	Периоды.ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода,
	|	Доходы.ДатаПолученияДохода,
	|	Доходы.ДоходМежрасчетногоПериода,
	|	Доходы.КодДохода,
	|	Доходы.КатегорияДохода,
	|	Доходы.Подразделение,
	|	Доходы.СтавкаЧислом,
	|	Доходы.Статус,
	|	Доходы.ДатаПолученияДохода
	|
	|ИМЕЮЩИЕ
	|	СУММА(Доходы.ДоходыБезВычетов) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПериодыФизлиц.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПериодыФизлиц.ФизическоеЛицо КАК ФизическоеЛицо,
	|	МАКСИМУМ(НАЧАЛОПЕРИОДА(ДоходыРезидентовНарастающимЗаГод.ДатаПолученияДохода, МЕСЯЦ)) КАК СтаршийМесяцПолученияДохода
	|ПОМЕСТИТЬ ВТМесяцыПолученияДохода
	|ИЗ
	|	ВТПериодыФизлиц КАК ПериодыФизлиц
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыНалоги КАК ДоходыРезидентовНарастающимЗаГод
	|		ПО ПериодыФизлиц.ФизическоеЛицо = ДоходыРезидентовНарастающимЗаГод.ФизическоеЛицо
	|			И (ГОД(ПериодыФизлиц.МесяцНалоговогоПериода) = ГОД(ДоходыРезидентовНарастающимЗаГод.МесяцНалоговогоПериода))
	|			И (ДоходыРезидентовНарастающимЗаГод.СуммаДохода > 0)
	|			И (ДоходыРезидентовНарастающимЗаГод.ИсчислятьНалогНарастающимИтогом)
	|
	|СГРУППИРОВАТЬ ПО
	|	ПериодыФизлиц.МесяцНалоговогоПериода,
	|	ПериодыФизлиц.ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	ИмущественныеВычеты.ВидДвижения КАК ВидДвижения,
	|	ВЫБОР
	|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|			ТОГДА ИмущественныеВычеты.Подразделение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|	КОНЕЦ КАК Подразделение,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код320о)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетРасходыНаСвоеОбучение,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код321)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетРасходыНаОбучениеДетей,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код324)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетРасходыНаЛечение,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код325)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетСтраховыеВзносыНаМедУслуги,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код326)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетРасходыНаДорогостоящееЛечение,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код329)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетВзносыНаДобровольноеСтрахованиеЖизни,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код311)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетИмущественныйРасходы,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код312)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетИмущественныйПроцентыПоКредитам,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код318)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета)
	|				ТОГДА ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ВычетИмущественныйПроцентыПриПерекредитовании,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код320о)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетРасходыНаСвоеОбучение,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код321)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетРасходыНаОбучениеДетей,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код324)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетРасходыНаЛечение,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код325)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетСтраховыеВзносыНаМедУслуги,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код326)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетРасходыНаДорогостоящееЛечение,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код329)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетВзносыНаДобровольноеСтрахованиеЖизни,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код311)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетИмущественныйРасходы,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код312)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетИмущественныйПроцентыПоКредитам,
	|	СУММА(ВЫБОР
	|			КОГДА ИмущественныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код318)
	|					И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|					И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|				ТОГДА -ИмущественныеВычеты.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетИмущественныйПроцентыПриПерекредитовании
	|ИЗ
	|	(ВЫБРАТЬ
	|		ИмущественныеВычеты.Период КАК Период,
	|		ИмущественныеВычеты.ВидДвижения КАК ВидДвижения,
	|		ИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
	|		ИмущественныеВычеты.Подразделение КАК Подразделение,
	|		ИмущественныеВычеты.КодВычета КАК КодВычета,
	|		ИмущественныеВычеты.Сумма КАК Сумма
	|	ИЗ
	|		РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычеты
	|	ГДЕ
	|		ИмущественныеВычеты.Регистратор <> &Регистратор
	|		И ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаИмущественныхВычетов
	|		И ИмущественныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И &УсловиеФизическоеЛицо
	|		И ВЫБОР
	|				КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					ТОГДА ИмущественныеВычеты.Год = ГОД(ИмущественныеВычеты.Период)
	|				ИНАЧЕ &ОкончательныйРасчетВычеты
	|			КОНЕЦ
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ИмущественныеВычеты.Период,
	|		ИмущественныеВычеты.ВидДвижения,
	|		ИмущественныеВычеты.ФизическоеЛицо,
	|		ИмущественныеВычеты.Подразделение,
	|		ИмущественныеВычеты.КодВычета,
	|		ИмущественныеВычеты.Сумма
	|	ИЗ
	|		ВТРегистрНакопления_ИмущественныеВычетыНДФЛ КАК ИмущественныеВычеты
	|	ГДЕ
	|		ИмущественныеВычеты.Регистратор <> &Регистратор
	|		И ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаИмущественныхВычетов
	|		И ИмущественныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И &УсловиеФизическоеЛицо
	|		И ВЫБОР
	|				КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					ТОГДА ИмущественныеВычеты.Год = ГОД(ИмущественныеВычеты.Период)
	|				ИНАЧЕ &ОкончательныйРасчетВычеты
	|			КОНЕЦ) КАК ИмущественныеВычеты
	|
	|СГРУППИРОВАТЬ ПО
	|	ИмущественныеВычеты.ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ),
	|	ИмущественныеВычеты.ВидДвижения,
	|	ВЫБОР
	|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				И (ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|			ТОГДА ИмущественныеВычеты.Подразделение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|	КОНЕЦ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ГОД(Периоды.МесяцНалоговогоПериода) КАК НалоговыйПериод,
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Доходы.ИсчислятьНалогНарастающимИтогом КАК ИсчислятьНалогНарастающимИтогом,
	|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	Доходы.МаксимальнаяДатаПолученияДохода КАК МаксимальнаяДатаПолученияДоходаМесяца,
	|	Доходы.ЗарегистрированоДляПромежуточногоРасчета КАК ЗарегистрированоДляПромежуточногоРасчета,
	|	Доходы.Статус КАК Статус,
	|	ВЫБОР
	|		КОГДА Доходы.ИсчислятьНалогНарастающимИтогом
	|			ТОГДА 0
	|		ИНАЧЕ Доходы.СуммаДохода
	|	КОНЕЦ КАК СуммаДохода,
	|	Доходы.СуммаДохода КАК ВсеДоходыЗаМесяц,
	|	ЕСТЬNULL(ДоходыПоДатамПолученияДоходаНарастающимИтогом.ОблагаемыйДоходЗаМесяц, 0) КАК ОблагаемыйДоход,
	|	Доходы.НалогНерезидента КАК НалогНерезидента,
	|	Доходы.КатегорияДохода КАК КатегорияДохода,
	|	Доходы.Подразделение КАК Подразделение,
	|	ЕСТЬNULL(ДоходыРезидентовНарастающимЗаГод.ОблагаемыйДоходЗаМесяц, 0) КАК ОблагаемыйДоходЗаМесяц,
	|	ЕСТЬNULL(ДоходыРезидентовНарастающимЗаГод.ОблагаемыйДоходЗаГод, 0) КАК ОблагаемыйДоходНарастающимИтогом,
	|	ЕСТЬNULL(МесяцыПолученияДохода.СтаршийМесяцПолученияДохода, ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)) КАК СтаршийМесяцПолученияДохода,
	|	СоциальныеВычеты.СуммаОборот КАК СоциальныйВычет,
	|	0.13 КАК СтавкаДляРезидента,
	|	ПравоНаСтандартныеВычеты.КодВычетаЛичный КАК КодВычетаЛичный,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыЛичные КАК СтандартныеВычетыЛичные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетские КАК СтандартныеВычетыДетские,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеДвойные КАК СтандартныеВычетыДетскиеДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеДвойныеВторые КАК СтандартныеВычетыДетскиеДвойныеВторые,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенка КАК СтандартныеВычетыНаТретьегоРебенка,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенкаДвойные КАК СтандартныеВычетыНаТретьегоРебенкаДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые КАК СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенка КАК СтандартныеВычетыНаВторогоРебенка,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенкаДвойные КАК СтандартныеВычетыНаВторогоРебенкаДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенкаДвойныеВторые КАК СтандартныеВычетыНаВторогоРебенкаДвойныеВторые,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидов КАК СтандартныеВычетыДетскиеИнвалидов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидовДвойные КАК СтандартныеВычетыДетскиеИнвалидовДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидовДвойныеВторые КАК СтандартныеВычетыДетскиеИнвалидовДвойныеВторые,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидовОпекунов КАК СтандартныеВычетыДетскиеИнвалидовОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидовДвойныеОпекунов КАК СтандартныеВычетыДетскиеИнвалидовДвойныеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидовДвойныеВторыеОпекунов КАК СтандартныеВычетыДетскиеИнвалидовДвойныеВторыеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеОпекунов КАК СтандартныеВычетыДетскиеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеДвойныеОпекунов КАК СтандартныеВычетыДетскиеДвойныеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеДвойныеВторыеОпекунов КАК СтандартныеВычетыДетскиеДвойныеВторыеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенкаОпекунов КАК СтандартныеВычетыНаТретьегоРебенкаОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенкаДвойныеОпекунов КАК СтандартныеВычетыНаТретьегоРебенкаДвойныеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторыеОпекунов КАК СтандартныеВычетыНаТретьегоРебенкаДвойныеВторыеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенкаОпекунов КАК СтандартныеВычетыНаВторогоРебенкаОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенкаДвойныеОпекунов КАК СтандартныеВычетыНаВторогоРебенкаДвойныеОпекунов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенкаДвойныеВторыеОпекунов КАК СтандартныеВычетыНаВторогоРебенкаДвойныеВторыеОпекунов
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПраваНаСтандартныеВычетыПоМесяцам КАК ПравоНаСтандартныеВычеты
	|		ПО Периоды.ФизическоеЛицо = ПравоНаСтандартныеВычеты.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = ПравоНаСтандартныеВычеты.МесяцНалоговогоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоциальныеВычетыПомесячно КАК СоциальныеВычеты
	|		ПО Периоды.ФизическоеЛицо = СоциальныеВычеты.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = СоциальныеВычеты.МесяцНалоговогоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыРезидентовНарастающимЗаГод КАК ДоходыРезидентовНарастающимЗаГод
	|		ПО Периоды.ФизическоеЛицо = ДоходыРезидентовНарастающимЗаГод.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = ДоходыРезидентовНарастающимЗаГод.МесяцНалоговогоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМесяцыПолученияДохода КАК МесяцыПолученияДохода
	|		ПО Периоды.ФизическоеЛицо = МесяцыПолученияДохода.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = МесяцыПолученияДохода.МесяцНалоговогоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыНалоги КАК Доходы
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыПоДатамПолученияДоходаНарастающимЗаГод КАК ДоходыПоДатамПолученияДоходаНарастающимИтогом
	|			ПО Доходы.ФизическоеЛицо = ДоходыПоДатамПолученияДоходаНарастающимИтогом.ФизическоеЛицо
	|				И Доходы.МесяцНалоговогоПериода = ДоходыПоДатамПолученияДоходаНарастающимИтогом.МесяцНалоговогоПериода
	|				И Доходы.ДатаПолученияДохода = ДоходыПоДатамПолученияДоходаНарастающимИтогом.ДатаПолученияДохода
	|				И Доходы.ЗарегистрированоДляПромежуточногоРасчета = ДоходыПоДатамПолученияДоходаНарастающимИтогом.ЗарегистрированоДляПромежуточногоРасчета
	|		ПО Периоды.МесяцНалоговогоПериода = Доходы.МесяцНалоговогоПериода
	|			И Периоды.ФизическоеЛицо = Доходы.ФизическоеЛицо
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода >= &ДатаИзмененияИсчисленияДляИностранцев
	|	И (НЕ Доходы.ИсчислятьНалогНарастающимИтогом
	|			ИЛИ Доходы.ДатаПолученияДохода = Доходы.МаксимальнаяДатаПолученияДохода
	|			ИЛИ ЕСТЬNULL(ДоходыПоДатамПолученияДоходаНарастающимИтогом.ОблагаемыйДоходЗаМесяц, 0) <> 0)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ФизическоеЛицо,
	|	МесяцНалоговогоПериода,
	|	Доходы.ИсчислятьНалогНарастающимИтогом УБЫВ,
	|	ДатаПолученияДохода,
	|	ЗарегистрированоДляПромежуточногоРасчета УБЫВ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Доходы.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Доходы.Подразделение КАК Подразделение,
	|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода,
	|	Доходы.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	Доходы.КатегорияДохода КАК КатегорияДохода,
	|	Доходы.ЗарегистрированоДляПромежуточногоРасчета КАК ЗарегистрированоДляПромежуточногоРасчета,
	|	Доходы.ДоходТекущегоРасчета КАК ДоходТекущегоРасчета,
	|	Доходы.ДокументОснование КАК ДокументОснование,
	|	Доходы.ИсчислятьНалогНарастающимИтогом КАК ИсчислятьНалогНарастающимИтогом
	|ИЗ
	|	(ВЫБРАТЬ
	|		ПериодыФизлиц.ФизическоеЛицо КАК ФизическоеЛицо,
	|		ПериодыФизлиц.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|		СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
	|		СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|		СведенияОДоходахНДФЛ.ДоходыБезВычетов КАК СуммаДохода,
	|		СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|		НЕ СведенияОДоходахНДФЛ.Сторно
	|			И ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &Регистратор) = &Регистратор КАК ДоходТекущегоРасчета,
	|		СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода КАК ЗарегистрированоДляПромежуточногоРасчета,
	|		СведенияОДоходахНДФЛ.ИсчислятьНалогНарастающимИтогом КАК ИсчислятьНалогНарастающимИтогом,
	|		СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование
	|	ИЗ
	|		ВТПериодыФизлиц КАК ПериодыФизлиц
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыСоСтавками КАК СведенияОДоходахНДФЛ
	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДокументыУчтенныеПриРасчетеНДФЛ КАК ДокументыУчтенныеПриРасчетеНДФЛ
	|				ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДокументыУчтенныеПриРасчетеНДФЛ.ФизическоеЛицо
	|					И СведенияОДоходахНДФЛ.ДокументОснование = ДокументыУчтенныеПриРасчетеНДФЛ.ДокументОснование
	|			ПО ПериодыФизлиц.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
	|				И (ПериодыФизлиц.МесяцНалоговогоПериода = НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ))
	|				И (&ОкончательныйРасчетДоходы)
	|	ГДЕ
	|		ПериодыФизлиц.МесяцНалоговогоПериода >= &ДатаИзмененияИсчисленияДляИностранцев
	|		И СведенияОДоходахНДФЛ.ФизическоеЛицо ЕСТЬ НЕ NULL ) КАК Доходы
	|
	|СГРУППИРОВАТЬ ПО
	|	Доходы.ФизическоеЛицо,
	|	Доходы.МесяцНалоговогоПериода,
	|	Доходы.Подразделение,
	|	Доходы.ДатаПолученияДохода,
	|	Доходы.КатегорияДохода,
	|	Доходы.ЗарегистрированоДляПромежуточногоРасчета,
	|	Доходы.ДоходТекущегоРасчета,
	|	Доходы.ДокументОснование,
	|	Доходы.ИсчислятьНалогНарастающимИтогом
	|
	|ИМЕЮЩИЕ
	|	СУММА(Доходы.СуммаДохода) <> 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	ФизическоеЛицо";
	
	ПакетЗапросов.Добавить(ТекстЗапроса);
	УдаляемыеВТ.Добавить("ВТДоходыНалоги");
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Периоды.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Периоды.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Периоды.Резидент КАК Резидент,
	|	ДоходыРезидентовНарастающимЗаГод.ОблагаемыйДоходЗаМесяц КАК ОблагаемыйДоходЗаМесяц,
	|	ДоходыРезидентовНарастающимЗаГод.ОблагаемыйДоходЗаГод КАК ОблагаемыйДоходНарастающимИтогом,
	|	СоциальныеВычеты.СуммаОборот КАК СоциальныйВычет,
	|	ВЫБОР
	|		КОГДА Периоды.Резидент
	|			ТОГДА 0
	|		ИНАЧЕ ЕСТЬNULL(НалогНерезидентов.НалогНерезидента, 0)
	|	КОНЕЦ КАК НалогЗаМесяц,
	|	0.13 КАК СтавкаДляРезидента,
	|	ПравоНаСтандартныеВычеты.КодВычетаЛичный КАК КодВычетаЛичный,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыЛичные КАК СтандартныеВычетыЛичные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетские КАК СтандартныеВычетыДетские,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеДвойные КАК СтандартныеВычетыДетскиеДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеДвойныеВторые КАК СтандартныеВычетыДетскиеДвойныеВторые,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидов КАК СтандартныеВычетыДетскиеИнвалидов,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидовДвойные КАК СтандартныеВычетыДетскиеИнвалидовДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыДетскиеИнвалидовДвойныеВторые КАК СтандартныеВычетыДетскиеИнвалидовДвойныеВторые,
	|	ГОД(Периоды.МесяцНалоговогоПериода) КАК НалоговыйПериод,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенка КАК СтандартныеВычетыНаТретьегоРебенка,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенкаДвойные КАК СтандартныеВычетыНаТретьегоРебенкаДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые КАК СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые,
	|	ПравоНаСтандартныеВычеты.ОграничениеПоДоходамЛичные КАК ОграничениеПоДоходамЛичные,
	|	ПравоНаСтандартныеВычеты.ОграничениеПоДоходамНаДетей КАК ОграничениеПоДоходамНаДетей,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенка КАК СтандартныеВычетыНаВторогоРебенка,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенкаДвойные КАК СтандартныеВычетыНаВторогоРебенкаДвойные,
	|	ПравоНаСтандартныеВычеты.СтандартныеВычетыНаВторогоРебенкаДвойныеВторые КАК СтандартныеВычетыНаВторогоРебенкаДвойныеВторые
	|ИЗ
	|	ВТПериодыФизлиц КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогНерезидентов КАК НалогНерезидентов
	|		ПО Периоды.ФизическоеЛицо = НалогНерезидентов.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = НалогНерезидентов.МесяцНалоговогоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПраваНаСтандартныеВычетыПоМесяцам КАК ПравоНаСтандартныеВычеты
	|		ПО Периоды.ФизическоеЛицо = ПравоНаСтандартныеВычеты.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = ПравоНаСтандартныеВычеты.МесяцНалоговогоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДоходыРезидентовНарастающимЗаГод КАК ДоходыРезидентовНарастающимЗаГод
	|		ПО Периоды.ФизическоеЛицо = ДоходыРезидентовНарастающимЗаГод.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = ДоходыРезидентовНарастающимЗаГод.МесяцНалоговогоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоциальныеВычетыПомесячно КАК СоциальныеВычеты
	|		ПО Периоды.ФизическоеЛицо = СоциальныеВычеты.ФизическоеЛицо
	|			И Периоды.МесяцНалоговогоПериода = СоциальныеВычеты.МесяцНалоговогоПериода
	|ГДЕ
	|	Периоды.МесяцНалоговогоПериода < &ДатаИзмененияИсчисленияДляИностранцев
	|
	|УПОРЯДОЧИТЬ ПО
	|	ФизическоеЛицо,
	|	НалоговыйПериод,
	|	МесяцНалоговогоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Доходы.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Доходы.Подразделение КАК Подразделение,
	|	СУММА(Доходы.СуммаДохода) КАК СуммаДохода
	|ИЗ
	|	(ВЫБРАТЬ
	|		ПериодыФизлиц.ФизическоеЛицо КАК ФизическоеЛицо,
	|		ПериодыФизлиц.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|		СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
	|		ЕСТЬNULL(СведенияОДоходахНДФЛ.СуммаДохода, 0) - ВЫБОР
	|			КОГДА ПериодыФизлиц.Резидент
	|				ТОГДА ЕСТЬNULL(СведенияОДоходахНДФЛ.СуммаВычета, 0)
	|			КОГДА СведенияОДоходахНДФЛ.КодВычета В (&КодыВычетовРезидентов)
	|				ТОГДА 0
	|			ИНАЧЕ ЕСТЬNULL(СведенияОДоходахНДФЛ.СуммаВычета, 0)
	|		КОНЕЦ КАК СуммаДохода
	|	ИЗ
	|		ВТПериодыФизлиц КАК ПериодыФизлиц
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|			ПО ПериодыФизлиц.ФизическоеЛицо = СведенияОДоходахНДФЛ.ФизическоеЛицо
	|				И (ПериодыФизлиц.МесяцНалоговогоПериода = НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ))
	|				И (ПериодыФизлиц.Резидент
	|					ИЛИ НЕ СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ)
	|				И (СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13))
	|				И (НЕ СведенияОДоходахНДФЛ.КодДохода.НеОблагаетсяУНалоговогоАгента)
	|				И (&ОкончательныйРасчетДоходы)
	|	ГДЕ
	|		ПериодыФизлиц.МесяцНалоговогоПериода < &ДатаИзмененияИсчисленияДляИностранцев) КАК Доходы
	|
	|СГРУППИРОВАТЬ ПО
	|	Доходы.ФизическоеЛицо,
	|	Доходы.МесяцНалоговогоПериода,
	|	Доходы.Подразделение";
	
	Если ПервыйМесяцНалоговогоПериода < Запрос.Параметры.ДатаИзмененияИсчисленияДляИностранцев Тогда
		ПакетЗапросов.Добавить(ТекстЗапроса);
		Сдвиг = 0;
	Иначе
		Сдвиг = 2;
	КонецЕсли;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериодаДляПоиска,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	|	-СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК НалогПоСтавке13,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода
	|ИЗ
	|	(ВЫБРАТЬ
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода
	|	ИЗ
	|		РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|	ГДЕ
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &Регистратор
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|		И &УсловиеФизическоеЛицо
	|		И &ОкончательныйРасчетПоРасчетам
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение,
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода
	|	ИЗ
	|		ВТРегистрНакопления_РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|	ГДЕ
	|		РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &Регистратор
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|		И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|		И &УсловиеФизическоеЛицо
	|		И &ОкончательныйРасчетПоРасчетам) КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НДФЛПредоставленныеСтандартныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НДФЛПредоставленныеСтандартныеВычеты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	НДФЛПредоставленныеСтандартныеВычеты.МесяцПериодаПредоставленияВычета КАК МесяцПериодаПредоставленияВычета,
	|	НДФЛПредоставленныеСтандартныеВычеты.Подразделение КАК Подразделение,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета В (ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код103), ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код104), ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код105))
	|				ТОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета
	|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		КОНЕЦ) КАК КодВычетаЛичный,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета В (ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код103), ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код104), ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код105))
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетЛичный,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код108)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетей,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код110)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код111)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код116)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаТретьегоРебенка,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код120)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаТретьегоРебенкаДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код124)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаТретьегоРебенкаДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код115)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаВторогоРебенка,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код119)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаВторогоРебенкаДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код123)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаВторогоРебенкаДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код109)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейИнвалидов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код112)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейИнвалидовДвойной,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код113)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейИнвалидовДвойнойВторой,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код130)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код135)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейДвойнойОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код143)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейДвойнойВторойОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код131)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаВторогоРебенкаОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код137)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код145)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код132)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаТретьегоРебенкаОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код139)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код147)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код117о)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейИнвалидовОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код121о)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов,
	|	СУММА(ВЫБОР
	|			КОГДА НДФЛПредоставленныеСтандартныеВычеты.КодВычета = ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.Код125о)
	|				ТОГДА -НДФЛПредоставленныеСтандартныеВычеты.СуммаОборот
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов
	|ИЗ
	|	ВТПредоставленныеСтандартныеИСоциальныеВычеты КАК НДФЛПредоставленныеСтандартныеВычеты
	|
	|СГРУППИРОВАТЬ ПО
	|	НДФЛПредоставленныеСтандартныеВычеты.Подразделение,
	|	НДФЛПредоставленныеСтандартныеВычеты.МесяцНалоговогоПериода,
	|	НДФЛПредоставленныеСтандартныеВычеты.МесяцПериодаПредоставленияВычета,
	|	НДФЛПредоставленныеСтандартныеВычеты.ФизическоеЛицо
	|
	|УПОРЯДОЧИТЬ ПО
	|	ФизическоеЛицо,
	|	МесяцПериодаПредоставленияВычета,
	|	МесяцНалоговогоПериода";
	
	ПакетЗапросов.Добавить(ТекстЗапроса);
	
	ТекстЗапроса = СтрСоединить(ПакетЗапросов, Символы.ПС + ";" + Символы.ПС);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеФизическоеЛицо", ТекстУсловияФизическоеЛицо);
	
	Если Не ИсключатьДоходыРегистратора Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "И (СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор)", "");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор", "");
	КонецЕсли;
	
	Если ОкончательныйРасчет Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетВычеты", "Истина");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетДоходы", "Истина");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетПоРасчетам", "Истина");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетВычеты", 
		"(Период < &НачалоМесяцаРасчета
		|			ИЛИ ВычетМежрасчетногоПериода
		|				И (Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетДоходы", 
		"(СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
		|					ИЛИ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
		|						И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетПоРасчетам", 
		"(Период < &НачалоМесяцаРасчета
		|			ИЛИ РасчетМежрасчетногоПериода
		|				И (Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))");
		
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	
	Результат = Запрос.ВыполнитьПакет();
	
	ВсегоРезультатов = Результат.Количество();
	
	ИмущественныеВычеты = Результат[ВсегоРезультатов - 7 + Сдвиг].Выгрузить();
	ИсчисленоРанее = Результат[ВсегоРезультатов - 2].Выгрузить();
	СтандартныхВычетовРанее = Результат[ВсегоРезультатов - 1].Выгрузить();
	
	ПоляПоиска = "ФизическоеЛицо, МесяцНалоговогоПериода";
	СтруктураПоиска = Новый Структура(ПоляПоиска);
	ПоляПоискаИмущественныхВычетов = ПоляПоиска + ", ВидДвижения";
	СтруктураПоискаВычетов = Новый Структура(ПоляПоискаИмущественныхВычетов);
	ИмущественныеВычеты.Индексы.Добавить(ПоляПоискаИмущественныхВычетов);
	
	СтрокаРесурсов = РассчитываемыеРесурсыПоОсновнойСтавке();
	МассивРесурсов = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(СтрокаРесурсов);
	НазванияВычетовНаДетей = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(РассчитываемыеРесурсыВычетовНаДетей());
	
	РезультатыРасчетов = ТаблицаНДФЛ();
	
	ТекущийГод = Год(МесяцРасчета);
		
	// Помесячный расчет
	Если ПервыйМесяцНалоговогоПериода < ДатаИзмененияИсчисленияДляИностранцев Тогда
		
		ВспомогательнаяТаблицаМесяца = РезультатыРасчетов.СкопироватьКолонки();
		ВспомогательнаяТаблицаФизическогоЛица = РезультатыРасчетов.СкопироватьКолонки();
		
		СтандартныхВычетовРанее.Индексы.Добавить(ПоляПоиска);
		ИсчисленоРанее.Индексы.Добавить(ПоляПоиска);
		РаспределениеДоходовПоПодразделениям = Результат[ВсегоРезультатов - 3].Выгрузить();
		РаспределениеДоходовПоПодразделениям.Индексы.Добавить(ПоляПоиска);
		
		ВыборкаРасчетов = Результат[ВсегоРезультатов - 4].Выбрать();
		Пока ВыборкаРасчетов.СледующийПоЗначениюПоля("ФизическоеЛицо") Цикл
			
			ВспомогательнаяТаблицаФизическогоЛица.Очистить();
			
			// Подготовим распределение, которое будет использоваться при отсутствии базы соответствующего месяца.
			СтруктураПоиска.ФизическоеЛицо = ВыборкаРасчетов.ФизическоеЛицо;

			БазаРаспределения = 0;
			МесяцПоиска = НачалоМесяца(МесяцРасчета);
			Пока БазаРаспределения = 0 И Год(МесяцПоиска) = ТекущийГод Цикл
				СтруктураПоиска.МесяцНалоговогоПериода = МесяцПоиска;
				ДоходыМесяцаРасчета = РаспределениеДоходовПоПодразделениям.НайтиСтроки(СтруктураПоиска);
				БазаРаспределения = 0;
				Для каждого СтрокаРаспределения Из ДоходыМесяцаРасчета Цикл
					БазаРаспределения = БазаРаспределения + СтрокаРаспределения.СуммаДохода;
				КонецЦикла; 
				МесяцПоиска = ДобавитьМесяц(МесяцПоиска, -1);
			КонецЦикла;
			
			КоэффициентыПодразделенийМесяцаРасчета = ОбщегоНазначения.ВыгрузитьКолонку(ДоходыМесяцаРасчета, "СуммаДохода");
			
			Пока ВыборкаРасчетов.СледующийПоЗначениюПоля("НалоговыйПериод") Цикл
				
				ВычетЛичныйОстаток = 0;
				ВычетНаДетейОстаток = 0;
				ВычетНаДетейДвойнойОстаток = 0;
				ВычетНаДетейДвойнойВторойОстаток = 0;
				ВычетНаТретьегоРебенкаОстаток = 0;
				ВычетНаТретьегоРебенкаДвойнойОстаток = 0;
				ВычетНаТретьегоРебенкаДвойнойВторойОстаток = 0;
				ВычетНаВторогоРебенкаОстаток = 0;
				ВычетНаВторогоРебенкаДвойнойОстаток = 0;
				ВычетНаВторогоРебенкаДвойнойВторойОстаток = 0;
				ВычетНаДетейИнвалидовОстаток = 0;
				ВычетНаДетейИнвалидовДвойнойОстаток = 0;
				ВычетНаДетейИнвалидовДвойнойВторойОстаток = 0;
				ВычетИмущественныйРасходыОстаток = 0;
				ВычетИмущественныйПроцентыПоКредитамОстаток = 0;
				ВычетИмущественныйПроцентыПриПерекредитованииОстаток = 0;
				ВычетСоциальныйОстаток = 0;
				ОблагаемыйДоход = 0;
				ДоходЗаМесяцОстаток = 0;
				НалогИсчисленный = 0;
				
				Пока ВыборкаРасчетов.Следующий() Цикл
					
					Если ВыборкаРасчетов.МесяцНалоговогоПериода >= ДатаИзмененияИсчисленияДляИностранцев Тогда
						Продолжить;
					КонецЕсли;
					
					ВспомогательнаяТаблицаМесяца.Очистить();
					ЗаполнитьЗначенияСвойств(СтруктураПоиска,ВыборкаРасчетов);
					Доходы = РаспределениеДоходовПоПодразделениям.НайтиСтроки(СтруктураПоиска);
					
					БазаРаспределения = 0;
					Для каждого СтрокаРаспределения Из Доходы Цикл
						БазаРаспределения = БазаРаспределения + СтрокаРаспределения.СуммаДохода;
					КонецЦикла; 
					Если БазаРаспределения = 0 Тогда
						// Если доходов за прошлый месяц нет - будем использовать текущее распределение.
						Доходы = ДоходыМесяцаРасчета;
						КоэффициентыПодразделений = КоэффициентыПодразделенийМесяцаРасчета;
					Иначе
						КоэффициентыПодразделений = ОбщегоНазначения.ВыгрузитьКолонку(Доходы, "СуммаДохода");
					КонецЕсли;
					
					ЗаполнитьЗначенияСвойств(СтруктураПоискаВычетов, СтруктураПоиска);
					СтруктураПоискаВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;

					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленоРанее.НайтиСтроки(СтруктураПоиска), "НалогПоСтавке13");
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, СтандартныхВычетовРанее.НайтиСтроки(СтруктураПоиска), "ПримененныйВычетЛичный," + РассчитываемыеРесурсыВычетовНаДетей());
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИмущественныеВычеты.НайтиСтроки(СтруктураПоиска), РассчитываемыеРесурсыИмущественныхВычетов());
					
					Если ВыборкаРасчетов.Резидент Тогда
						
						// Расчет сумм примененных вычетов и налога.
						
						ВычетЛичныйЗаМесяц = 0;
						ВычетНаДетейЗаМесяц = 0;
						ВычетНаДетейЗаМесяц = 0;
						ВычетСоциальныйЗаМесяц = 0;
						ВычетНаДетейДвойнойЗаМесяц = 0;
						ВычетНаДетейДвойнойВторойЗаМесяц = 0;
						ВычетНаТретьегоРебенкаЗаМесяц = 0;
						ВычетНаТретьегоРебенкаДвойнойЗаМесяц = 0;
						ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц = 0;
						ВычетНаВторогоРебенкаЗаМесяц = 0;
						ВычетНаВторогоРебенкаДвойнойЗаМесяц = 0;
						ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц = 0;
						ВычетНаДетейИнвалидовЗаМесяц = 0;
						ВычетНаДетейИнвалидовДвойнойЗаМесяц = 0;
						ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц = 0;
						ВычетИмущественныйРасходыЗаМесяц = 0;
						ВычетИмущественныйПроцентыПоКредитамЗаМесяц = 0;
						ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц = 0;
						
						ВычетСоциальныйОстаток = ВычетСоциальныйОстаток + ВыборкаРасчетов.СоциальныйВычет;
						
						ЗаполнитьЗначенияСвойств(СтруктураПоискаВычетов, СтруктураПоиска);
						СтруктураПоискаВычетов.ВидДвижения = ВидДвиженияНакопления.Приход;
						СтрокиПравНаИмущественныеВычеты = ИмущественныеВычеты.НайтиСтроки(СтруктураПоиска);
						
						Если СтрокиПравНаИмущественныеВычеты.Количество() > 0 Тогда
							ВычетИмущественныйРасходыОстаток = ВычетИмущественныйРасходыОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетИмущественныйРасходы;
							ВычетИмущественныйПроцентыПоКредитамОстаток = ВычетИмущественныйПроцентыПоКредитамОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетИмущественныйПроцентыПоКредитам;
							ВычетИмущественныйПроцентыПриПерекредитованииОстаток = ВычетИмущественныйПроцентыПриПерекредитованииОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетИмущественныйПроцентыПриПерекредитовании;
						КонецЕсли;
						Если ОсобенностиУчетаВычетов = Перечисления.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц;
							ВычетЛичныйОстаток = ВычетЛичныйОстаток + ВыборкаРасчетов.СтандартныеВычетыЛичные;
							ВычетНаДетейОстаток = ВычетНаДетейОстаток + ВыборкаРасчетов.СтандартныеВычетыДетские;
							ВычетНаДетейДвойнойОстаток = ВычетНаДетейДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойные;
							ВычетНаДетейДвойнойВторойОстаток = ВычетНаДетейДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеВторые;
							ВычетНаТретьегоРебенкаОстаток = ВычетНаТретьегоРебенкаОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенка;
							ВычетНаТретьегоРебенкаДвойнойОстаток = ВычетНаТретьегоРебенкаДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойные;
							ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые;
							ВычетНаВторогоРебенкаОстаток = ВычетНаВторогоРебенкаОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенка;
							ВычетНаВторогоРебенкаДвойнойОстаток = ВычетНаВторогоРебенкаДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойные;
							ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВычетНаВторогоРебенкаДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеВторые;
							ВычетНаДетейИнвалидовОстаток = ВычетНаДетейИнвалидовОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидов;
							ВычетНаДетейИнвалидовДвойнойОстаток = ВычетНаДетейИнвалидовДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойные;
							ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВычетНаДетейИнвалидовДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеВторые;
						Иначе
							ДоходЗаМесяцОстаток = ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц;
							ВычетЛичныйОстаток = ВыборкаРасчетов.СтандартныеВычетыЛичные;
							ВычетНаДетейОстаток = ВыборкаРасчетов.СтандартныеВычетыДетские;
							ВычетНаДетейДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойные;
							ВычетНаДетейДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеВторые;
							ВычетНаТретьегоРебенкаОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенка;
							ВычетНаТретьегоРебенкаДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойные;
							ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые;
							ВычетНаВторогоРебенкаОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенка;
							ВычетНаВторогоРебенкаДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойные;
							ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеВторые;
							ВычетНаДетейИнвалидовОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидов;
							ВычетНаДетейИнвалидовДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойные;
							ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеВторые;
						КонецЕсли;
						
						Если ДоходЗаМесяцОстаток > 0 Тогда
							
							ВычетСоциальныйЗаМесяц = Мин(ДоходЗаМесяцОстаток, ВычетСоциальныйОстаток);
							ВычетСоциальныйОстаток = ВычетСоциальныйОстаток - ВычетСоциальныйЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетСоциальныйЗаМесяц;
							
							Если ВыборкаРасчетов.КодВычетаЛичный = Справочники.ВидыВычетовНДФЛ.Код103 Тогда
								ВычетЛичныйЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетЛичныйОстаток);
								ВычетЛичныйОстаток = ВычетЛичныйОстаток - ВычетЛичныйЗаМесяц;
								ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетЛичныйЗаМесяц;
							КонецЕсли;
							
							ВычетНаДетейЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейОстаток);
							ВычетНаДетейОстаток = ВычетНаДетейОстаток - ВычетНаДетейЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейЗаМесяц;
							
							ВычетНаДетейДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейДвойнойОстаток);
							ВычетНаДетейДвойнойОстаток = ВычетНаДетейДвойнойОстаток - ВычетНаДетейДвойнойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейДвойнойЗаМесяц;
							
							ВычетНаДетейДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейДвойнойВторойОстаток);
							ВычетНаДетейДвойнойВторойОстаток = ВычетНаДетейДвойнойВторойОстаток - ВычетНаДетейДвойнойВторойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейДвойнойВторойЗаМесяц;
							
							ВычетНаВторогоРебенкаЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаОстаток);
							ВычетНаВторогоРебенкаОстаток = ВычетНаВторогоРебенкаОстаток - ВычетНаВторогоРебенкаЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаЗаМесяц;
							
							ВычетНаВторогоРебенкаДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаДвойнойОстаток);
							ВычетНаВторогоРебенкаДвойнойОстаток = ВычетНаВторогоРебенкаДвойнойОстаток - ВычетНаВторогоРебенкаДвойнойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаДвойнойЗаМесяц;
							
							ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаДвойнойВторойОстаток);
							ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВычетНаВторогоРебенкаДвойнойВторойОстаток - ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц;

							ВычетНаТретьегоРебенкаЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаОстаток);
							ВычетНаТретьегоРебенкаОстаток = ВычетНаТретьегоРебенкаОстаток - ВычетНаТретьегоРебенкаЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаЗаМесяц;
							
							ВычетНаТретьегоРебенкаДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаДвойнойОстаток);
							ВычетНаТретьегоРебенкаДвойнойОстаток = ВычетНаТретьегоРебенкаДвойнойОстаток - ВычетНаТретьегоРебенкаДвойнойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаДвойнойЗаМесяц;
							
							ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаДвойнойВторойОстаток);
							ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОстаток - ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц;

							ВычетНаДетейИнвалидовЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовОстаток);
							ВычетНаДетейИнвалидовОстаток = ВычетНаДетейИнвалидовОстаток - ВычетНаДетейИнвалидовЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовЗаМесяц;
							
							ВычетНаДетейИнвалидовДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовДвойнойОстаток);
							ВычетНаДетейИнвалидовДвойнойОстаток = ВычетНаДетейИнвалидовДвойнойОстаток - ВычетНаДетейИнвалидовДвойнойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовДвойнойЗаМесяц;
							
							ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовДвойнойВторойОстаток);
							ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВычетНаДетейИнвалидовДвойнойВторойОстаток - ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц;
								
							Если ВыборкаРасчетов.КодВычетаЛичный <> Справочники.ВидыВычетовНДФЛ.Код103 Тогда
								ВычетЛичныйЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетЛичныйОстаток);
								ВычетЛичныйОстаток = ВычетЛичныйОстаток - ВычетЛичныйЗаМесяц;
								ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетЛичныйЗаМесяц;
							КонецЕсли;
							
							ДоходЗаМесяцДляИмущественныхВычетов = Макс(0, ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц - ВычетСоциальныйЗаМесяц - ВычетЛичныйЗаМесяц 
									- ВычетНаДетейЗаМесяц - ВычетНаДетейДвойнойЗаМесяц - ВычетНаДетейДвойнойВторойЗаМесяц 
									- ВычетНаВторогоРебенкаЗаМесяц - ВычетНаВторогоРебенкаДвойнойЗаМесяц - ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц 
									- ВычетНаТретьегоРебенкаЗаМесяц - ВычетНаТретьегоРебенкаДвойнойЗаМесяц - ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц 
									- ВычетНаДетейИнвалидовЗаМесяц - ВычетНаДетейИнвалидовДвойнойЗаМесяц - ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц);
							
							Если ДоходЗаМесяцДляИмущественныхВычетов > 0 Тогда
								
								ВычетИмущественныйПроцентыПоКредитамЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетИмущественныйПроцентыПоКредитамОстаток);
								ВычетИмущественныйПроцентыПоКредитамОстаток = ВычетИмущественныйПроцентыПоКредитамОстаток - ВычетИмущественныйПроцентыПоКредитамЗаМесяц;
								ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетИмущественныйПроцентыПоКредитамЗаМесяц;
								ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетИмущественныйПроцентыПоКредитамЗаМесяц;
								
								ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетИмущественныйПроцентыПриПерекредитованииОстаток);
								ВычетИмущественныйПроцентыПриПерекредитованииОстаток = ВычетИмущественныйПроцентыПриПерекредитованииОстаток - ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц;
								ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц;
								ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц;
								
								ВычетИмущественныйРасходыЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетИмущественныйРасходыОстаток);
								ВычетИмущественныйРасходыОстаток = ВычетИмущественныйРасходыОстаток - ВычетИмущественныйРасходыЗаМесяц;
								ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетИмущественныйРасходыЗаМесяц;
								
							КонецЕсли;
							
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетЛичныйЗаМесяц, "ПримененныйВычетЛичный", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаДетейЗаМесяц, "ПримененныйВычетНаДетей", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаДетейДвойнойЗаМесяц, "ПримененныйВычетНаДетейДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаДетейДвойнойВторойЗаМесяц, "ПримененныйВычетНаДетейДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаВторогоРебенкаЗаМесяц, "ПримененныйВычетНаВторогоРебенка", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаВторогоРебенкаДвойнойЗаМесяц, "ПримененныйВычетНаВторогоРебенкаДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц, "ПримененныйВычетНаВторогоРебенкаДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаТретьегоРебенкаЗаМесяц, "ПримененныйВычетНаТретьегоРебенка", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаТретьегоРебенкаДвойнойЗаМесяц, "ПримененныйВычетНаТретьегоРебенкаДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц, "ПримененныйВычетНаТретьегоРебенкаДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаДетейИнвалидовЗаМесяц, "ПримененныйВычетНаДетейИнвалидов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаДетейИнвалидовДвойнойЗаМесяц, "ПримененныйВычетНаДетейИнвалидовДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц, "ПримененныйВычетНаДетейИнвалидовДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетИмущественныйРасходыЗаМесяц, "ПримененныйВычетИмущественныйРасходы", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетИмущественныйПроцентыПоКредитамЗаМесяц, "ПримененныйВычетИмущественныйПроцентыПоКредитам", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
							ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц, "ПримененныйВычетИмущественныйПроцентыПриПерекредитовании", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
						КонецЕсли;
						
						ОблагаемыйДоход = Макс(0, ОблагаемыйДоход + ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц - (ВычетСоциальныйЗаМесяц + ВычетЛичныйЗаМесяц 
									+ ВычетНаДетейЗаМесяц + ВычетНаДетейДвойнойЗаМесяц + ВычетНаДетейДвойнойВторойЗаМесяц 
									+ ВычетНаТретьегоРебенкаЗаМесяц + ВычетНаТретьегоРебенкаДвойнойЗаМесяц + ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц 
									+ ВычетНаВторогоРебенкаЗаМесяц + ВычетНаВторогоРебенкаДвойнойЗаМесяц + ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц 
									+ ВычетНаДетейИнвалидовЗаМесяц + ВычетНаДетейИнвалидовДвойнойЗаМесяц + ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц 
									+ ВычетИмущественныйПроцентыПоКредитамЗаМесяц + ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц + ВычетИмущественныйРасходыЗаМесяц));
							
						НалогЗаМесяц = Окр(ОблагаемыйДоход * ВыборкаРасчетов.СтавкаДляРезидента) - НалогИсчисленный;
						НалогИсчисленный = НалогИсчисленный + НалогЗаМесяц;
						
					Иначе	
						
						НалогЗаМесяц = ВыборкаРасчетов.НалогЗаМесяц;
						
					КонецЕсли;
					
					ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.МесяцНалоговогоПериода, НалогЗаМесяц, "НалогПоСтавке13", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений, 0);
					
					ВспомогательнаяТаблицаМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, Подразделение, КатегорияДохода", СтрокаРесурсов);
					Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаМесяца Цикл
						ЕстьДанныеВСтроке = Ложь;
						Для каждого ИмяРесурса Из МассивРесурсов Цикл
							ЕстьДанныеВСтроке = СтрокаТЗ[ИмяРесурса] <> 0;
							Если ЕстьДанныеВСтроке Тогда
								Прервать;
							КонецЕсли;
						КонецЦикла;
						Если ЕстьДанныеВСтроке Тогда
							ЗаполнитьЗначенияСвойств(ВспомогательнаяТаблицаФизическогоЛица.Добавить(), СтрокаТЗ);
						КонецЕсли;
					КонецЦикла;
					
				КонецЦикла;
				
			КонецЦикла;
			
			Если Не ОкончательныйРасчет И ВспомогательнаяТаблицаФизическогоЛица.Количество() > 0 Тогда
				ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультатБО(РезультатыРасчетов, ВспомогательнаяТаблицаФизическогоЛица, ДатаУдержанияИсчисленногоНалога, МесяцРасчета);
			Иначе
				ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВспомогательнаяТаблицаФизическогоЛица, РезультатыРасчетов)
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	// Расчет по каждой дате получения дохода
	Если ПоследнийМесяцНалоговогоПериода >= ДатаИзмененияИсчисленияДляИностранцев Тогда
		
		ВспомогательнаяТаблицаМесяца = РезультатыРасчетов.СкопироватьКолонки();
		ВспомогательнаяТаблицаФизическогоЛица = РезультатыРасчетов.СкопироватьКолонки();
		ВспомогательнаяТаблицаВычетовМесяца = РезультатыРасчетов.СкопироватьКолонки();
		
		ЭтоПерерасчет = Не ЭтоРасчетПоДоходамТекущегоМесяца;
		ПереноситьДоходДляПримененияВычетовВМесяцРасчета = Не ОкончательныйРасчет И Год(МесяцРасчета) = Год(ДатаУдержанияИсчисленногоНалога) И МесяцРасчета < НачалоМесяца(ДатаУдержанияИсчисленногоНалога);
		ОсобыеКатегорииДохода = Новый Соответствие;
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.Дивиденды, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15, Истина);
		
		СтруктураПоискаИсчисленного = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериодаДляПоиска");
		ИсчисленоРанее.Индексы.Добавить("ФизическоеЛицо,МесяцНалоговогоПериодаДляПоиска"); 
		
		СтруктураПоискаПоФизлицу = Новый Структура("ФизическоеЛицо");
		СтруктураПоискаПоДатам = Новый Структура(ПоляПоиска + ", ДатаПолученияДохода, ЗарегистрированоДляПромежуточногоРасчета");
		СтруктураПоискаПоДатам.Вставить("ИсчислятьНалогНарастающимИтогом", Истина);
		СтруктураПоискаПоДатамИПодразделениям = Новый Структура("ДатаПолученияДохода,Подразделение");
		ПоляПоискаСтандартныхВычетов = "ФизическоеЛицо,МесяцПериодаПредоставленияВычета";
		СтруктураПоискаСтандартныхВычетов = Новый Структура(ПоляПоискаСтандартныхВычетов);
		СтандартныхВычетовРанее.Индексы.Добавить(ПоляПоискаСтандартныхВычетов);
		СтруктураПоискаДоходовПоДатам = Новый Структура("ДатаПолученияДохода");
		СтруктураПоискаТекущихДоходов = Новый Структура("ДоходТекущегоРасчета, ЗарегистрированоДляПромежуточногоРасчета", Истина, Не ОкончательныйРасчет);
		РаспределениеДоходовПоПодразделениям = Результат[ВсегоРезультатов - 5 + Сдвиг].Выгрузить();
		РаспределениеДоходовПоПодразделениям.Индексы.Добавить("ФизическоеЛицо");
		
		ВыборкаРасчетов = Результат[ВсегоРезультатов - 6 + Сдвиг].Выбрать();
		Пока ВыборкаРасчетов.СледующийПоЗначениюПоля("ФизическоеЛицо") Цикл
			
			СтруктураПоискаПоФизлицу.ФизическоеЛицо = ВыборкаРасчетов.ФизическоеЛицо;
			РаспределениеДоходовФизлица = РаспределениеДоходовПоПодразделениям.Скопировать(СтруктураПоискаПоФизлицу);
			
			ДоходыТекущегоРасчета = РаспределениеДоходовФизлица.Скопировать(СтруктураПоискаТекущихДоходов);
			ВсегоДоходовТекущегоРасчета = ДоходыТекущегоРасчета.Итог("СуммаДохода");
			Если Не ОкончательныйРасчет И ВсегоДоходовТекущегоРасчета <= 0 Тогда
				Продолжить;
			КонецЕсли;
			
			ВспомогательнаяТаблицаФизическогоЛица.Очистить();
			
			УчтенныеОснования = Новый Массив();
			ОбщегоНазначенияКлиентСервер.ДополнитьМассив(УчтенныеОснования, ДоходыТекущегоРасчета.ВыгрузитьКолонку("ДокументОснование"), Истина);
			ОбщегоНазначенияКлиентСервер.УдалитьЗначениеИзМассива(УчтенныеОснования, Регистратор);
			
			ДоходыТекущегоРасчета.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, Подразделение, ДатаПолученияДохода, КатегорияДохода", "СуммаДохода");
			
			// Подготовим распределение, которое будет использоваться при отсутствии базы соответствующего месяца.
			СтруктураПоиска.ФизическоеЛицо = ВыборкаРасчетов.ФизическоеЛицо;
			СтруктураПоискаИсчисленного.ФизическоеЛицо = ВыборкаРасчетов.ФизическоеЛицо;

			БазаРаспределения = 0;
			МесяцПоиска = НачалоМесяца(МесяцРасчета);
			Пока БазаРаспределения = 0 И Год(МесяцПоиска) = ТекущийГод Цикл
				СтруктураПоиска.МесяцНалоговогоПериода = МесяцПоиска;
				ДоходыМесяцаРасчета = РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоиска);
				БазаРаспределения = 0;
				Для каждого СтрокаРаспределения Из ДоходыМесяцаРасчета Цикл
					БазаРаспределения = БазаРаспределения + СтрокаРаспределения.СуммаДохода;
				КонецЦикла; 
				МесяцПоиска = ДобавитьМесяц(МесяцПоиска, -1);
			КонецЦикла;
			
			КоэффициентыПодразделенийМесяцаРасчета = ОбщегоНазначения.ВыгрузитьКолонку(ДоходыМесяцаРасчета, "СуммаДохода");
			
			Пока ВыборкаРасчетов.СледующийПоЗначениюПоля("НалоговыйПериод") Цикл
				
				ВычетЛичныйОстаток = 0;
				ВычетНаДетейОстаток = 0;
				ВычетНаДетейДвойнойОстаток = 0;
				ВычетНаДетейДвойнойВторойОстаток = 0;
				ВычетНаТретьегоРебенкаОстаток = 0;
				ВычетНаТретьегоРебенкаДвойнойОстаток = 0;
				ВычетНаТретьегоРебенкаДвойнойВторойОстаток = 0;
				ВычетНаВторогоРебенкаОстаток = 0;
				ВычетНаВторогоРебенкаДвойнойОстаток = 0;
				ВычетНаВторогоРебенкаДвойнойВторойОстаток = 0;
				ВычетНаДетейИнвалидовОстаток = 0;
				ВычетНаДетейИнвалидовДвойнойОстаток = 0;
				ВычетНаДетейИнвалидовДвойнойВторойОстаток = 0;
				ВычетНаДетейОпекуновОстаток = 0;
				ВычетНаДетейДвойнойОпекуновОстаток = 0;
				ВычетНаДетейДвойнойВторойОпекуновОстаток = 0;
				ВычетНаТретьегоРебенкаОпекуновОстаток = 0;
				ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток = 0;
				ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток = 0;
				ВычетНаВторогоРебенкаОпекуновОстаток = 0;
				ВычетНаВторогоРебенкаДвойнойОпекуновОстаток = 0;
				ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток = 0;
				ВычетНаДетейИнвалидовОпекуновОстаток = 0;
				ВычетНаДетейИнвалидовДвойнойОпекуновОстаток = 0;
				ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток = 0;
				ВычетИмущественныйРасходыОстаток = 0;
				ВычетИмущественныйПроцентыПоКредитамОстаток = 0;
				ВычетИмущественныйПроцентыПриПерекредитованииОстаток = 0;
				ВычетРасходыНаСвоеОбучениеОстаток = 0;
				ВычетРасходыНаОбучениеДетейОстаток = 0;
				ВычетРасходыНаЛечениеОстаток = 0;
				ВычетСтраховыеВзносыНаМедУслугиОстаток = 0;
				ВычетРасходыНаДорогостоящееЛечениеОстаток = 0;
				ВычетВзносыНаДобровольноеСтрахованиеЖизниОстаток = 0;
				ВычетСоциальныйОстаток = 0;
				ОблагаемыйДоход = 0;
				ДоходЗаМесяцОстаток = 0;
				НалогИсчисленный = 0;
				ВычетыПредыдущихМесяцев = Новый Соответствие;
				ОтложенныеПраваНаВычеты = Новый Соответствие;
				ВспомогательнаяТаблицаМесяца.Очистить();
				
				ВсеДатыТекущегоРасчета = Новый Соответствие;
				ВсеКатегорииТекущегоРасчета = Новый Соответствие;
				ДатыТекущегоРасчетаПоМесяцам = Новый Соответствие;
				Для СчМесяцев = 1 По 12 Цикл
					ДатыТекущегоРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
				КонецЦикла;
				Для каждого СтрокаТЗ Из ДоходыТекущегоРасчета Цикл
					Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ВыборкаРасчетов.НалоговыйПериод Тогда
						Продолжить;
					КонецЕсли;
					ВсеДатыТекущегоРасчета.Вставить(СтрокаТЗ.ДатаПолученияДохода, Истина);
					ВсеКатегорииТекущегоРасчета.Вставить(СтрокаТЗ.КатегорияДохода, Истина);
					МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
					ДатыТекущегоРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыТекущегоРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
				КонецЦикла;
				
				Если ОкончательныйРасчет Тогда
					ДатыРасчетаПоМесяцам = Новый Соответствие;
					ДатаНалоговогоПериода = '00010101';
					Для СчМесяцев = 1 По 12 Цикл
						ДатыРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
					КонецЦикла;
					Для каждого СтрокаТЗ Из РаспределениеДоходовФизлица Цикл
						Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ВыборкаРасчетов.НалоговыйПериод Тогда
							Продолжить;
						КонецЕсли;
						ДатаНалоговогоПериода = Макс(ДатаНалоговогоПериода, СтрокаТЗ.ДатаПолученияДохода); 
						МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
						ДатыРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
					КонецЦикла;
					
					ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцРасчета)];
					ОсновнаяДатаМесяцаРасчета = ?(Год(МесяцРасчета) = ВыборкаРасчетов.НалоговыйПериод, ДатыРасчетаПоМесяцам[Месяц(МесяцРасчета)], '00010101');
					
					ДоходыМесяцаРасчетаПоТекущимДоходам = Новый Массив;
					ДоходыКонцаМесяцаРасчета = Новый Массив;
					ДоходыНалоговогоПериода = Новый Массив;
					КоэффициентыПодразделенийМесяцаРасчетаПоТекущимДоходам = Новый Массив;
					КоэффициентыПодразделенийКонцаМесяцаРасчета = Новый Массив;
					КоэффициентыПодразделенийНалоговогоПериода = Новый Массив;
					Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
						СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
						ВыделитьРаспределениеДоходов(ДоходыТекущегоРасчета, СтруктураПоискаДоходовПоДатам, ДоходыМесяцаРасчетаПоТекущимДоходам, КоэффициентыПодразделенийМесяцаРасчетаПоТекущимДоходам, Новый Массив, Новый Массив);											
					КонецЕсли;
					Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
						СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчета;
						ВыделитьРаспределениеДоходов(РаспределениеДоходовФизлица, СтруктураПоискаДоходовПоДатам, ДоходыКонцаМесяцаРасчета, КоэффициентыПодразделенийКонцаМесяцаРасчета, Новый Массив, Новый Массив);											
					КонецЕсли;
					Если ЗначениеЗаполнено(ДатаНалоговогоПериода) Тогда
						СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = ДатаНалоговогоПериода;
						ВыделитьРаспределениеДоходов(РаспределениеДоходовФизлица, СтруктураПоискаДоходовПоДатам, ДоходыНалоговогоПериода, КоэффициентыПодразделенийНалоговогоПериода, Новый Массив, Новый Массив);											
					Иначе
						ДатаНалоговогоПериода = НачалоДня(КонецМесяца(МесяцРасчета))
					КонецЕсли;
				Иначе
					ОсновнаяДатаТекущегоРасчета = ДатаУдержанияИсчисленногоНалога;
					Если ВсеДатыТекущегоРасчета[ОсновнаяДатаТекущегоРасчета] = Неопределено Тогда
						Для СчМесяцев = 1 По 12 Цикл
							Если ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев]) Тогда
								ОсновнаяДатаТекущегоРасчета = ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев];
								Прервать;
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
				КонецЕсли;
				
				Пока ВыборкаРасчетов.СледующийПоЗначениюПоля("МесяцНалоговогоПериода") Цикл
					
					Если ВыборкаРасчетов.МесяцНалоговогоПериода < ДатаИзмененияИсчисленияДляИностранцев Тогда
						Продолжить;
					КонецЕсли;
					
					ВспомогательнаяТаблицаВычетовМесяца.Очистить();
					ЗаполнитьЗначенияСвойств(СтруктураПоиска,ВыборкаРасчетов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаСтандартныхВычетов,ВыборкаРасчетов);
					СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ВыборкаРасчетов.МесяцНалоговогоПериода;
					СтруктураПоискаСтандартныхВычетов.МесяцПериодаПредоставленияВычета = ВыборкаРасчетов.МесяцНалоговогоПериода;
					ЗаполнитьЗначенияСвойств(СтруктураПоискаВычетов, СтруктураПоиска);
					
					// Расчет сумм примененных вычетов
					
					ВсегоВычетовЗаМесяц = 0;
					
					ВычетСоциальныйЗаМесяц = 0;
					ВычетЛичныйЗаМесяц = 0;
					ВычетНаДетейЗаМесяц = 0;
					ВычетНаДетейДвойнойЗаМесяц = 0;
					ВычетНаДетейДвойнойВторойЗаМесяц = 0;
					ВычетНаТретьегоРебенкаЗаМесяц = 0;
					ВычетНаТретьегоРебенкаДвойнойЗаМесяц = 0;
					ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц = 0;
					ВычетНаВторогоРебенкаЗаМесяц = 0;
					ВычетНаВторогоРебенкаДвойнойЗаМесяц = 0;
					ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц = 0;
					ВычетНаДетейИнвалидовЗаМесяц = 0;
					ВычетНаДетейИнвалидовДвойнойЗаМесяц = 0;
					ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц = 0;
					ВычетНаДетейОпекуновЗаМесяц = 0;
					ВычетНаДетейДвойнойОпекуновЗаМесяц = 0;
					ВычетНаДетейДвойнойВторойОпекуновЗаМесяц = 0;
					ВычетНаТретьегоРебенкаОпекуновЗаМесяц = 0;
					ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц = 0;
					ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц = 0;
					ВычетНаВторогоРебенкаОпекуновЗаМесяц = 0;
					ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц = 0;
					ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц = 0;
					ВычетНаДетейИнвалидовОпекуновЗаМесяц = 0;
					ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц = 0;
					ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц = 0;
					ВычетИмущественныйРасходыЗаМесяц = 0;
					ВычетИмущественныйПроцентыПоКредитамЗаМесяц = 0;
					ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц = 0;
					ВычетРасходыНаСвоеОбучениеЗаМесяц = 0;
					ВычетРасходыНаОбучениеДетейЗаМесяц = 0;
					ВычетРасходыНаЛечениеЗаМесяц = 0;
					ВычетСтраховыеВзносыНаМедУслугиЗаМесяц = 0;
					ВычетРасходыНаДорогостоящееЛечениеЗаМесяц = 0;
					ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц = 0;
					
					ВычетСоциальныйОстаток = ВычетСоциальныйОстаток + ВыборкаРасчетов.СоциальныйВычет;

					СтруктураПоискаВычетов.ВидДвижения = ВидДвиженияНакопления.Приход;
					СтрокиПравНаИмущественныеВычеты = ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаВычетов);

					ЕстьВычетыЗаМесяц = Ложь;
					ЗапоминатьВычетыНаБудущее = Ложь;
					ПроводитьРасчетЗаОчереднойМесяц = ВыборкаРасчетов.ВсеДоходыЗаМесяц <> 0 Или ЭтоПерерасчет;
					Если СтрокиПравНаИмущественныеВычеты.Количество() > 0 Тогда
						ВычетРасходыНаСвоеОбучениеОстаток = ВычетРасходыНаСвоеОбучениеОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетРасходыНаСвоеОбучение;
						ВычетРасходыНаОбучениеДетейОстаток = ВычетРасходыНаОбучениеДетейОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетРасходыНаОбучениеДетей;
						ВычетРасходыНаЛечениеОстаток = ВычетРасходыНаЛечениеОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетРасходыНаЛечение;
						ВычетСтраховыеВзносыНаМедУслугиОстаток = ВычетСтраховыеВзносыНаМедУслугиОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетСтраховыеВзносыНаМедУслуги;
						ВычетРасходыНаДорогостоящееЛечениеОстаток = ВычетРасходыНаДорогостоящееЛечениеОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетРасходыНаДорогостоящееЛечение;
						ВычетВзносыНаДобровольноеСтрахованиеЖизниОстаток = ВычетВзносыНаДобровольноеСтрахованиеЖизниОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетВзносыНаДобровольноеСтрахованиеЖизни;
						ВычетИмущественныйРасходыОстаток = ВычетИмущественныйРасходыОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетИмущественныйРасходы;
						ВычетИмущественныйПроцентыПоКредитамОстаток = ВычетИмущественныйПроцентыПоКредитамОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетИмущественныйПроцентыПоКредитам;
						ВычетИмущественныйПроцентыПриПерекредитованииОстаток = ВычетИмущественныйПроцентыПриПерекредитованииОстаток + СтрокиПравНаИмущественныеВычеты[0].ВычетИмущественныйПроцентыПриПерекредитовании;
					КонецЕсли;
					Если ОсобенностиУчетаВычетов = Перечисления.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом Тогда
						Если ПереноситьДоходДляПримененияВычетовВМесяцРасчета И ВыборкаРасчетов.МесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц + ВсегоДоходовТекущегоРасчета;
							ЗапоминатьВычетыНаБудущее = Истина;
						ИначеЕсли ПереноситьДоходДляПримененияВычетовВМесяцРасчета И ВыборкаРасчетов.МесяцНалоговогоПериода = НачалоМесяца(ДатаУдержанияИсчисленногоНалога) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц - ВсегоДоходовТекущегоРасчета;
						Иначе
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц;
						КонецЕсли;
						ВычетЛичныйОстаток = ВычетЛичныйОстаток + ВыборкаРасчетов.СтандартныеВычетыЛичные;
						ВычетНаДетейОстаток = ВычетНаДетейОстаток + ВыборкаРасчетов.СтандартныеВычетыДетские;
						ВычетНаДетейДвойнойОстаток = ВычетНаДетейДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойные;
						ВычетНаДетейДвойнойВторойОстаток = ВычетНаДетейДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеВторые;
						ВычетНаТретьегоРебенкаОстаток = ВычетНаТретьегоРебенкаОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенка;
						ВычетНаТретьегоРебенкаДвойнойОстаток = ВычетНаТретьегоРебенкаДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойные;
						ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые;
						ВычетНаВторогоРебенкаОстаток = ВычетНаВторогоРебенкаОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенка;
						ВычетНаВторогоРебенкаДвойнойОстаток = ВычетНаВторогоРебенкаДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойные;
						ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВычетНаВторогоРебенкаДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеВторые;
						ВычетНаДетейИнвалидовОстаток = ВычетНаДетейИнвалидовОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидов;
						ВычетНаДетейИнвалидовДвойнойОстаток = ВычетНаДетейИнвалидовДвойнойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойные;
						ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВычетНаДетейИнвалидовДвойнойВторойОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеВторые;
						ВычетНаДетейОпекуновОстаток = ВычетНаДетейОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеОпекунов;
						ВычетНаДетейДвойнойОпекуновОстаток = ВычетНаДетейДвойнойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеОпекунов;
						ВычетНаДетейДвойнойВторойОпекуновОстаток = ВычетНаДетейДвойнойВторойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеВторыеОпекунов;
						ВычетНаТретьегоРебенкаОпекуновОстаток = ВычетНаТретьегоРебенкаОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаОпекунов;
						ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеОпекунов;
						ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторыеОпекунов;
						ВычетНаВторогоРебенкаОпекуновОстаток = ВычетНаВторогоРебенкаОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаОпекунов;
						ВычетНаВторогоРебенкаДвойнойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеОпекунов;
						ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеВторыеОпекунов;
						ВычетНаДетейИнвалидовОпекуновОстаток = ВычетНаДетейИнвалидовОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовОпекунов;
						ВычетНаДетейИнвалидовДвойнойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеОпекунов;
						ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток + ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеВторыеОпекунов;
					Иначе
						ДоходЗаМесяцОстаток = ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц;
						ВычетЛичныйОстаток = ВыборкаРасчетов.СтандартныеВычетыЛичные;
						ВычетНаДетейОстаток = ВыборкаРасчетов.СтандартныеВычетыДетские;
						ВычетНаДетейДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойные;
						ВычетНаДетейДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеВторые;
						ВычетНаТретьегоРебенкаОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенка;
						ВычетНаТретьегоРебенкаДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойные;
						ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторые;
						ВычетНаВторогоРебенкаОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенка;
						ВычетНаВторогоРебенкаДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойные;
						ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеВторые;
						ВычетНаДетейИнвалидовОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидов;
						ВычетНаДетейИнвалидовДвойнойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойные;
						ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеВторые;
						ВычетНаДетейОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеОпекунов;
						ВычетНаДетейДвойнойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеОпекунов;
						ВычетНаДетейДвойнойВторойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеДвойныеВторыеОпекунов;
						ВычетНаТретьегоРебенкаОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаОпекунов;
						ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеОпекунов;
						ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыНаТретьегоРебенкаДвойныеВторыеОпекунов;
						ВычетНаВторогоРебенкаОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаОпекунов;
						ВычетНаВторогоРебенкаДвойнойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеОпекунов;
						ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыНаВторогоРебенкаДвойныеВторыеОпекунов;
						ВычетНаДетейИнвалидовОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовОпекунов;
						ВычетНаДетейИнвалидовДвойнойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеОпекунов;
						ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток = ВыборкаРасчетов.СтандартныеВычетыДетскиеИнвалидовДвойныеВторыеОпекунов;
					КонецЕсли;
						
					// Перенесем ранее предоставленные при исчислении налога для будущих дат получения дохода вычеты 
					// текущего месяца на тот месяц, когда их предоставили на самом деле.
					// Манипуляции производим с правами на стандартные вычеты и со строками зарегистрированных вычетов.
					Для каждого Элемент Из ОтложенныеПраваНаВычеты Цикл
						ТекущийВычет = Элемент.Значение;
						Если Элемент.Ключ.МесяцНалоговогоПериода = ВыборкаРасчетов.МесяцНалоговогоПериода Тогда
							ВычетЛичныйОстаток = ВычетЛичныйОстаток + ТекущийВычет.ПримененныйВычетЛичный;
							ВычетНаДетейОстаток = ВычетНаДетейОстаток + ТекущийВычет.ПримененныйВычетНаДетей;
							ВычетНаДетейДвойнойОстаток = ВычетНаДетейДвойнойОстаток + ТекущийВычет.ПримененныйВычетНаДетейДвойной;
							ВычетНаДетейДвойнойВторойОстаток = ВычетНаДетейДвойнойВторойОстаток + ТекущийВычет.ПримененныйВычетНаДетейДвойнойВторой;
							ВычетНаВторогоРебенкаОстаток = ВычетНаВторогоРебенкаОстаток + ТекущийВычет.ПримененныйВычетНаВторогоРебенка;
							ВычетНаВторогоРебенкаДвойнойОстаток = ВычетНаВторогоРебенкаДвойнойОстаток + ТекущийВычет.ПримененныйВычетНаВторогоРебенкаДвойной;
							ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВычетНаВторогоРебенкаДвойнойВторойОстаток + ТекущийВычет.ПримененныйВычетНаВторогоРебенкаДвойнойВторой;
							ВычетНаТретьегоРебенкаОстаток = ВычетНаТретьегоРебенкаОстаток + ТекущийВычет.ПримененныйВычетНаТретьегоРебенка;
							ВычетНаТретьегоРебенкаДвойнойОстаток = ВычетНаТретьегоРебенкаДвойнойОстаток + ТекущийВычет.ПримененныйВычетНаТретьегоРебенкаДвойной;
							ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОстаток + ТекущийВычет.ПримененныйВычетНаТретьегоРебенкаДвойнойВторой;
							ВычетНаДетейИнвалидовОстаток = ВычетНаДетейИнвалидовОстаток + ТекущийВычет.ПримененныйВычетНаДетейИнвалидов;
							ВычетНаДетейИнвалидовДвойнойОстаток = ВычетНаДетейИнвалидовДвойнойОстаток + ТекущийВычет.ПримененныйВычетНаДетейИнвалидовДвойной;
							ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВычетНаДетейИнвалидовДвойнойВторойОстаток + ТекущийВычет.ПримененныйВычетНаДетейИнвалидовДвойнойВторой;
							ВычетНаДетейОпекуновОстаток = ВычетНаДетейОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаДетейОпекунов;
							ВычетНаДетейДвойнойОпекуновОстаток = ВычетНаДетейДвойнойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаДетейДвойнойОпекунов;
							ВычетНаДетейДвойнойВторойОпекуновОстаток = ВычетНаДетейДвойнойВторойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаДетейДвойнойВторойОпекунов;
							ВычетНаТретьегоРебенкаОпекуновОстаток = ВычетНаТретьегоРебенкаОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаТретьегоРебенкаОпекунов;
							ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов;
							ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов;
							ВычетНаВторогоРебенкаОпекуновОстаток = ВычетНаВторогоРебенкаОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаВторогоРебенкаОпекунов;
							ВычетНаВторогоРебенкаДвойнойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов;
							ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов;
							ВычетНаДетейИнвалидовОпекуновОстаток = ВычетНаДетейИнвалидовОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаДетейИнвалидовОпекунов;
							ВычетНаДетейИнвалидовДвойнойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов;
							ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток + ТекущийВычет.ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов;
							ОтложенныеПраваНаВычеты.Удалить(Элемент.Ключ);
						КонецЕсли;
					КонецЦикла;
					СтрокиСтандартныхВычетов = СтандартныхВычетовРанее.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
					Для каждого СтрокаТЗ Из СтрокиСтандартныхВычетов Цикл
						Если СтрокаТЗ.МесяцНалоговогоПериода <= ВыборкаРасчетов.МесяцНалоговогоПериода Тогда
							Продолжить;	
						КонецЕсли;
						ВычетыКЗачету = Новый Структура;
						Если СтрокаТЗ.ПримененныйВычетЛичный < 0 И ВычетЛичныйОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетЛичный, ВычетЛичныйОстаток);
							ВычетЛичныйОстаток = ВычетЛичныйОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетЛичный", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетей < 0 И ВычетНаДетейОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетей, ВычетНаДетейОстаток);
							ВычетНаДетейОстаток = ВычетНаДетейОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетей", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейДвойной < 0 И ВычетНаДетейДвойнойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейДвойной, ВычетНаДетейДвойнойОстаток);
							ВычетНаДетейДвойнойОстаток = ВычетНаДетейДвойнойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейДвойной", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейДвойнойВторой < 0 И ВычетНаДетейДвойнойВторойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейДвойнойВторой, ВычетНаДетейДвойнойВторойОстаток);
							ВычетНаДетейДвойнойВторойОстаток = ВычетНаДетейДвойнойВторойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейДвойнойВторой", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаВторогоРебенка < 0 И ВычетНаВторогоРебенкаОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаВторогоРебенка, ВычетНаВторогоРебенкаОстаток);
							ВычетНаВторогоРебенкаОстаток = ВычетНаВторогоРебенкаОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаВторогоРебенка", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойной < 0 И ВычетНаВторогоРебенкаДвойнойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойной, ВычетНаВторогоРебенкаДвойнойОстаток);
							ВычетНаВторогоРебенкаДвойнойОстаток = ВычетНаВторогоРебенкаДвойнойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаВторогоРебенкаДвойной", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойнойВторой < 0 И ВычетНаВторогоРебенкаДвойнойВторойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойнойВторой, ВычетНаВторогоРебенкаДвойнойВторойОстаток);
							ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВычетНаВторогоРебенкаДвойнойВторойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаВторогоРебенкаДвойнойВторой", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаТретьегоРебенка < 0 И ВычетНаТретьегоРебенкаОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаТретьегоРебенка, ВычетНаТретьегоРебенкаОстаток);
							ВычетНаТретьегоРебенкаОстаток = ВычетНаТретьегоРебенкаОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаТретьегоРебенка", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойной < 0 И ВычетНаТретьегоРебенкаДвойнойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойной, ВычетНаТретьегоРебенкаДвойнойОстаток);
							ВычетНаТретьегоРебенкаДвойнойОстаток = ВычетНаТретьегоРебенкаДвойнойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаТретьегоРебенкаДвойной", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойнойВторой < 0 И ВычетНаТретьегоРебенкаДвойнойВторойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойнойВторой, ВычетНаТретьегоРебенкаДвойнойВторойОстаток);
							ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаТретьегоРебенкаДвойнойВторой", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейИнвалидов < 0 И ВычетНаДетейИнвалидовОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейИнвалидов, ВычетНаДетейИнвалидовОстаток);
							ВычетНаДетейИнвалидовОстаток = ВычетНаДетейИнвалидовОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейИнвалидов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойной < 0 И ВычетНаДетейИнвалидовДвойнойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойной, ВычетНаДетейИнвалидовДвойнойОстаток);
							ВычетНаДетейИнвалидовДвойнойОстаток = ВычетНаДетейИнвалидовДвойнойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейИнвалидовДвойной", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойнойВторой < 0 И ВычетНаДетейИнвалидовДвойнойВторойОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойнойВторой, ВычетНаДетейИнвалидовДвойнойВторойОстаток);
							ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВычетНаДетейИнвалидовДвойнойВторойОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейИнвалидовДвойнойВторой", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейОпекунов < 0 И ВычетНаДетейОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейОпекунов, ВычетНаДетейОпекуновОстаток);
							ВычетНаДетейОпекуновОстаток = ВычетНаДетейОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейДвойнойОпекунов < 0 И ВычетНаДетейДвойнойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейДвойнойОпекунов, ВычетНаДетейДвойнойОпекуновОстаток);
							ВычетНаДетейДвойнойОпекуновОстаток = ВычетНаДетейДвойнойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейДвойнойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейДвойнойВторойОпекунов < 0 И ВычетНаДетейДвойнойВторойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейДвойнойВторойОпекунов, ВычетНаДетейДвойнойВторойОпекуновОстаток);
							ВычетНаДетейДвойнойВторойОпекуновОстаток = ВычетНаДетейДвойнойВторойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейДвойнойВторойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаОпекунов < 0 И ВычетНаТретьегоРебенкаОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаОпекунов, ВычетНаТретьегоРебенкаОпекуновОстаток);
							ВычетНаТретьегоРебенкаОпекуновОстаток = ВычетНаТретьегоРебенкаОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаТретьегоРебенкаОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов < 0 И ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов, ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток);
							ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов < 0 И ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов, ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток);
							ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаОпекунов < 0 И ВычетНаВторогоРебенкаОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаОпекунов, ВычетНаВторогоРебенкаОпекуновОстаток);
							ВычетНаВторогоРебенкаОпекуновОстаток = ВычетНаВторогоРебенкаОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаВторогоРебенкаОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов < 0 И ВычетНаВторогоРебенкаДвойнойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов, ВычетНаВторогоРебенкаДвойнойОпекуновОстаток);
							ВычетНаВторогоРебенкаДвойнойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов < 0 И ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов, ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток);
							ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовОпекунов < 0 И ВычетНаДетейИнвалидовОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовОпекунов, ВычетНаДетейИнвалидовОпекуновОстаток);
							ВычетНаДетейИнвалидовОпекуновОстаток = ВычетНаДетейИнвалидовОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейИнвалидовОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов < 0 И ВычетНаДетейИнвалидовДвойнойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов, ВычетНаДетейИнвалидовДвойнойОпекуновОстаток);
							ВычетНаДетейИнвалидовДвойнойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов < 0 И ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток > 0 Тогда
							ВычетКЗачету = Мин(-СтрокаТЗ.ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов, ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток);
							ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток - ВычетКЗачету;
							ВычетыКЗачету.Вставить("ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов", ВычетКЗачету)
						КонецЕсли;
						Если ВычетыКЗачету.Количество() > 0 Тогда
							СтрокаТЗ.МесяцПериодаПредоставленияВычета = СтрокаТЗ.МесяцНалоговогоПериода;
							Для каждого ИмяРесурса Из МассивРесурсов Цикл
								Если Не ВычетыКЗачету.Свойство(ИмяРесурса) Тогда
									ВычетыКЗачету.Вставить(ИмяРесурса, 0)
								КонецЕсли;
							КонецЦикла; 
							ОтложенныеПраваНаВычеты.Вставить(СтрокаТЗ, ВычетыКЗачету);
						КонецЕсли;
					КонецЦикла;
					// Если вычеты перенесли, надо обновить зарегистрированные вычеты текущего месяца.
					Если ОтложенныеПраваНаВычеты.Количество() > 0 Тогда
						СтрокиСтандартныхВычетов = Неопределено;
					КонецЕсли;
					
					Если ДоходЗаМесяцОстаток > 0 И ВыборкаРасчетов.МесяцНалоговогоПериода <= ВыборкаРасчетов.СтаршийМесяцПолученияДохода Тогда
						
						ВычетСоциальныйЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетСоциальныйОстаток);
						ВычетСоциальныйОстаток = ВычетСоциальныйОстаток - ВычетСоциальныйЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетСоциальныйЗаМесяц;
						
						ВычетНаДетейЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейОстаток);
						ВычетНаДетейОстаток = ВычетНаДетейОстаток - ВычетНаДетейЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейЗаМесяц;
						
						ВычетНаДетейДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейДвойнойОстаток);
						ВычетНаДетейДвойнойОстаток = ВычетНаДетейДвойнойОстаток - ВычетНаДетейДвойнойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейДвойнойЗаМесяц;
						
						ВычетНаДетейДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейДвойнойВторойОстаток);
						ВычетНаДетейДвойнойВторойОстаток = ВычетНаДетейДвойнойВторойОстаток - ВычетНаДетейДвойнойВторойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейДвойнойВторойЗаМесяц;
						
						ВычетНаВторогоРебенкаЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаОстаток);
						ВычетНаВторогоРебенкаОстаток = ВычетНаВторогоРебенкаОстаток - ВычетНаВторогоРебенкаЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаЗаМесяц;
						
						ВычетНаВторогоРебенкаДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаДвойнойОстаток);
						ВычетНаВторогоРебенкаДвойнойОстаток = ВычетНаВторогоРебенкаДвойнойОстаток - ВычетНаВторогоРебенкаДвойнойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаДвойнойЗаМесяц;
						
						ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаДвойнойВторойОстаток);
						ВычетНаВторогоРебенкаДвойнойВторойОстаток = ВычетНаВторогоРебенкаДвойнойВторойОстаток - ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц;
						
						ВычетНаТретьегоРебенкаЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаОстаток);
						ВычетНаТретьегоРебенкаОстаток = ВычетНаТретьегоРебенкаОстаток - ВычетНаТретьегоРебенкаЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаЗаМесяц;
						
						ВычетНаТретьегоРебенкаДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаДвойнойОстаток);
						ВычетНаТретьегоРебенкаДвойнойОстаток = ВычетНаТретьегоРебенкаДвойнойОстаток - ВычетНаТретьегоРебенкаДвойнойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаДвойнойЗаМесяц;
						
						ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаДвойнойВторойОстаток);
						ВычетНаТретьегоРебенкаДвойнойВторойОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОстаток - ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц;
						
						ВычетНаДетейИнвалидовЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовОстаток);
						ВычетНаДетейИнвалидовОстаток = ВычетНаДетейИнвалидовОстаток - ВычетНаДетейИнвалидовЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовЗаМесяц;
						
						ВычетНаДетейИнвалидовДвойнойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовДвойнойОстаток);
						ВычетНаДетейИнвалидовДвойнойОстаток = ВычетНаДетейИнвалидовДвойнойОстаток - ВычетНаДетейИнвалидовДвойнойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовДвойнойЗаМесяц;
						
						ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовДвойнойВторойОстаток);
						ВычетНаДетейИнвалидовДвойнойВторойОстаток = ВычетНаДетейИнвалидовДвойнойВторойОстаток - ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц;
						
						ВычетНаДетейОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейОпекуновОстаток);
						ВычетНаДетейОпекуновОстаток = ВычетНаДетейОпекуновОстаток - ВычетНаДетейОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейОпекуновЗаМесяц;
						
						ВычетНаДетейДвойнойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейДвойнойОпекуновОстаток);
						ВычетНаДетейДвойнойОпекуновОстаток = ВычетНаДетейДвойнойОпекуновОстаток - ВычетНаДетейДвойнойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейДвойнойОпекуновЗаМесяц;
						
						ВычетНаДетейДвойнойВторойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейДвойнойВторойОпекуновОстаток);
						ВычетНаДетейДвойнойВторойОпекуновОстаток = ВычетНаДетейДвойнойВторойОпекуновОстаток - ВычетНаДетейДвойнойВторойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейДвойнойВторойОпекуновЗаМесяц;
						
						ВычетНаВторогоРебенкаОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаОпекуновОстаток);
						ВычетНаВторогоРебенкаОпекуновОстаток = ВычетНаВторогоРебенкаОпекуновОстаток - ВычетНаВторогоРебенкаОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаОпекуновЗаМесяц;
						
						ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаДвойнойОпекуновОстаток);
						ВычетНаВторогоРебенкаДвойнойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойОпекуновОстаток - ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц;
						
						ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток);
						ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаВторогоРебенкаДвойнойВторойОпекуновОстаток - ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц;
						
						ВычетНаТретьегоРебенкаОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаОпекуновОстаток);
						ВычетНаТретьегоРебенкаОпекуновОстаток = ВычетНаТретьегоРебенкаОпекуновОстаток - ВычетНаТретьегоРебенкаОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаОпекуновЗаМесяц;
						
						ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток);
						ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойОпекуновОстаток - ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц;
						
						ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток);
						ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток = ВычетНаТретьегоРебенкаДвойнойВторойОпекуновОстаток - ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц;
						
						ВычетНаДетейИнвалидовОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовОпекуновОстаток);
						ВычетНаДетейИнвалидовОпекуновОстаток = ВычетНаДетейИнвалидовОпекуновОстаток - ВычетНаДетейИнвалидовОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовОпекуновЗаМесяц;
						
						ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовДвойнойОпекуновОстаток);
						ВычетНаДетейИнвалидовДвойнойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойОпекуновОстаток - ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц;
						
						ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток);
						ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток = ВычетНаДетейИнвалидовДвойнойВторойОпекуновОстаток - ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц;
						
						ВычетЛичныйЗаМесяц = Мин(ДоходЗаМесяцОстаток,ВычетЛичныйОстаток);
						ВычетЛичныйОстаток = ВычетЛичныйОстаток - ВычетЛичныйЗаМесяц;
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетЛичныйЗаМесяц;
						
						ДоходЗаМесяцДляИмущественныхВычетов = Макс(0, ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц - ВычетСоциальныйЗаМесяц - ВычетЛичныйЗаМесяц 
							- ВычетНаДетейЗаМесяц - ВычетНаДетейДвойнойЗаМесяц - ВычетНаДетейДвойнойВторойЗаМесяц 
							- ВычетНаТретьегоРебенкаЗаМесяц - ВычетНаТретьегоРебенкаДвойнойЗаМесяц - ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц 
							- ВычетНаВторогоРебенкаЗаМесяц - ВычетНаВторогоРебенкаДвойнойЗаМесяц - ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц 
							- ВычетНаДетейИнвалидовЗаМесяц - ВычетНаДетейИнвалидовДвойнойЗаМесяц - ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц
							- ВычетНаДетейОпекуновЗаМесяц - ВычетНаДетейДвойнойОпекуновЗаМесяц - ВычетНаДетейДвойнойВторойОпекуновЗаМесяц 
							- ВычетНаТретьегоРебенкаОпекуновЗаМесяц - ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц - ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц 
							- ВычетНаВторогоРебенкаОпекуновЗаМесяц - ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц - ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц 
							- ВычетНаДетейИнвалидовОпекуновЗаМесяц - ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц - ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц);
						
						// Для расчета имущественных вычетов учтем ранее не учтенные из-за отсутствия дохода в предшествующих месяцах
						// налогового периода вычеты.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < ВыборкаРасчетов.МесяцНалоговогоПериода Тогда
								ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - Мин(ДоходЗаМесяцДляИмущественныхВычетов, Элемент.Значение);
								Если ДоходЗаМесяцДляИмущественныхВычетов = 0 Тогда
									Прервать;
								КонецЕсли;	
							КонецЕсли;
						КонецЦикла;
							
						Если ДоходЗаМесяцДляИмущественныхВычетов > 0 И (ВыборкаРасчетов.ВсеДоходыЗаМесяц <> 0 Или ЭтоПерерасчет) Тогда
							
							ВычетРасходыНаДорогостоящееЛечениеЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетРасходыНаДорогостоящееЛечениеОстаток);
							ВычетРасходыНаДорогостоящееЛечениеОстаток = ВычетРасходыНаДорогостоящееЛечениеОстаток - ВычетРасходыНаДорогостоящееЛечениеЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетРасходыНаДорогостоящееЛечениеЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетРасходыНаДорогостоящееЛечениеЗаМесяц;
							
							ВычетСтраховыеВзносыНаМедУслугиЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетСтраховыеВзносыНаМедУслугиОстаток);
							ВычетСтраховыеВзносыНаМедУслугиОстаток = ВычетСтраховыеВзносыНаМедУслугиОстаток - ВычетСтраховыеВзносыНаМедУслугиЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетСтраховыеВзносыНаМедУслугиЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетСтраховыеВзносыНаМедУслугиЗаМесяц;
							
							ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетВзносыНаДобровольноеСтрахованиеЖизниОстаток);
							ВычетВзносыНаДобровольноеСтрахованиеЖизниОстаток = ВычетВзносыНаДобровольноеСтрахованиеЖизниОстаток - ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц;
							
							ВычетРасходыНаЛечениеЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетРасходыНаЛечениеОстаток);
							ВычетРасходыНаЛечениеОстаток = ВычетРасходыНаЛечениеОстаток - ВычетРасходыНаЛечениеЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетРасходыНаЛечениеЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетРасходыНаЛечениеЗаМесяц;
							
							ВычетРасходыНаОбучениеДетейЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетРасходыНаОбучениеДетейОстаток);
							ВычетРасходыНаОбучениеДетейОстаток = ВычетРасходыНаОбучениеДетейОстаток - ВычетРасходыНаОбучениеДетейЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетРасходыНаОбучениеДетейЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетРасходыНаОбучениеДетейЗаМесяц;
							
							ВычетРасходыНаСвоеОбучениеЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетРасходыНаСвоеОбучениеОстаток);
							ВычетРасходыНаСвоеОбучениеОстаток = ВычетРасходыНаСвоеОбучениеОстаток - ВычетРасходыНаСвоеОбучениеЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетРасходыНаСвоеОбучениеЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетРасходыНаСвоеОбучениеЗаМесяц;
							
							ВычетИмущественныйПроцентыПоКредитамЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетИмущественныйПроцентыПоКредитамОстаток);
							ВычетИмущественныйПроцентыПоКредитамОстаток = ВычетИмущественныйПроцентыПоКредитамОстаток - ВычетИмущественныйПроцентыПоКредитамЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетИмущественныйПроцентыПоКредитамЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетИмущественныйПроцентыПоКредитамЗаМесяц;
							
							ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетИмущественныйПроцентыПриПерекредитованииОстаток);
							ВычетИмущественныйПроцентыПриПерекредитованииОстаток = ВычетИмущественныйПроцентыПриПерекредитованииОстаток - ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц;
							ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц;
							
							ВычетИмущественныйРасходыЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетИмущественныйРасходыОстаток);
							ВычетИмущественныйРасходыОстаток = ВычетИмущественныйРасходыОстаток - ВычетИмущественныйРасходыЗаМесяц;
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетИмущественныйРасходыЗаМесяц;
							
						КонецЕсли;
						
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + ВычетСоциальныйЗаМесяц + ВычетЛичныйЗаМесяц 
								+ ВычетНаДетейЗаМесяц + ВычетНаДетейДвойнойЗаМесяц + ВычетНаДетейДвойнойВторойЗаМесяц 
								+ ВычетНаТретьегоРебенкаЗаМесяц + ВычетНаТретьегоРебенкаДвойнойЗаМесяц + ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц 
								+ ВычетНаВторогоРебенкаЗаМесяц + ВычетНаВторогоРебенкаДвойнойЗаМесяц + ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц 
								+ ВычетНаДетейИнвалидовЗаМесяц + ВычетНаДетейИнвалидовДвойнойЗаМесяц + ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц 
								+ ВычетНаДетейОпекуновЗаМесяц + ВычетНаДетейДвойнойОпекуновЗаМесяц + ВычетНаДетейДвойнойВторойОпекуновЗаМесяц 
								+ ВычетНаТретьегоРебенкаОпекуновЗаМесяц + ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц + ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц 
								+ ВычетНаВторогоРебенкаОпекуновЗаМесяц + ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц + ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц 
								+ ВычетНаДетейИнвалидовОпекуновЗаМесяц + ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц + ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц 
								+ ВычетРасходыНаСвоеОбучениеЗаМесяц + ВычетРасходыНаОбучениеДетейЗаМесяц + ВычетРасходыНаЛечениеЗаМесяц + ВычетСтраховыеВзносыНаМедУслугиЗаМесяц + ВычетРасходыНаДорогостоящееЛечениеЗаМесяц + ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц
								+ ВычетИмущественныйПроцентыПоКредитамЗаМесяц + ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц + ВычетИмущественныйРасходыЗаМесяц;
						
						ЕстьВычетыЗаМесяц = ВычетСоциальныйЗаМесяц <> 0 Или ВычетЛичныйЗаМесяц <> 0 
								Или ВычетНаДетейЗаМесяц <> 0 Или ВычетНаДетейДвойнойЗаМесяц <> 0 Или ВычетНаДетейДвойнойВторойЗаМесяц <> 0 
								Или ВычетНаВторогоРебенкаЗаМесяц <> 0 Или ВычетНаВторогоРебенкаДвойнойЗаМесяц <> 0 Или ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц <> 0 
								Или ВычетНаТретьегоРебенкаЗаМесяц <> 0 Или ВычетНаТретьегоРебенкаДвойнойЗаМесяц <> 0 Или ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц <> 0 
								Или ВычетНаДетейИнвалидовЗаМесяц <> 0 Или ВычетНаДетейИнвалидовДвойнойЗаМесяц <> 0 Или ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц <> 0 
								Или ВычетНаДетейОпекуновЗаМесяц <> 0 Или ВычетНаДетейДвойнойОпекуновЗаМесяц <> 0 Или ВычетНаДетейДвойнойВторойОпекуновЗаМесяц <> 0 
								Или ВычетНаВторогоРебенкаОпекуновЗаМесяц <> 0 Или ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц <> 0 Или ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц <> 0 
								Или ВычетНаТретьегоРебенкаОпекуновЗаМесяц <> 0 Или ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц <> 0 Или ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц <> 0 
								Или ВычетНаДетейИнвалидовОпекуновЗаМесяц <> 0 Или ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц <> 0 Или ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц <> 0 
								Или ВычетРасходыНаСвоеОбучениеЗаМесяц <> 0 Или ВычетРасходыНаОбучениеДетейЗаМесяц <> 0 Или ВычетРасходыНаЛечениеЗаМесяц <> 0 Или ВычетСтраховыеВзносыНаМедУслугиЗаМесяц <> 0 Или ВычетРасходыНаДорогостоящееЛечениеЗаМесяц <> 0 Или ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц <> 0
								Или ВычетИмущественныйПроцентыПоКредитамЗаМесяц <> 0 Или ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц <> 0 Или ВычетИмущественныйРасходыЗаМесяц <> 0;
								
					КонецЕсли;
					
					// Перенесем некоторые суммы вычетов из других месяцев.
					Если ПроводитьРасчетЗаОчереднойМесяц Тогда
						// Учтем ранее не учтенные вычеты из-за отсутствия дохода в предшествующих месяцах налогового периода.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < ВыборкаРасчетов.МесяцНалоговогоПериода Тогда
								ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + Элемент.Значение;
								ВычетыПредыдущихМесяцев.Вставить(Элемент.Ключ, 0);
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
					Если ЗапоминатьВычетыНаБудущее Или ЕстьВычетыЗаМесяц И Не ПроводитьРасчетЗаОчереднойМесяц Тогда
						ВычетыПредыдущихМесяцев.Вставить(ВыборкаРасчетов.МесяцНалоговогоПериода, ?(ЗначениеЗаполнено(ВычетыПредыдущихМесяцев[ВыборкаРасчетов.МесяцНалоговогоПериода]), ВычетыПредыдущихМесяцев[ВыборкаРасчетов.МесяцНалоговогоПериода], 0) + Макс(ВсегоВычетовЗаМесяц - ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц, 0));
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц - Макс(ВсегоВычетовЗаМесяц - ВыборкаРасчетов.ОблагаемыйДоходЗаМесяц, 0);
					КонецЕсли;
					
					ДоходыДляРаспределенияВычетов = Новый Массив;
					КоэффициентыДляРаспределенияВычетов = Новый Массив;
					
					ВыполнятьМинимизациюПерерасчетов = Ложь;
					НалогЗаМесяц = 0;
					Пока ВыборкаРасчетов.СледующийПоЗначениюПоля("ИсчислятьНалогНарастающимИтогом") Цикл
						Если ВыборкаРасчетов.ИсчислятьНалогНарастающимИтогом Тогда
							Если ПроводитьРасчетЗаОчереднойМесяц Тогда
								// Расчет сумм налога
								ВыполнятьМинимизациюПерерасчетов = Истина;
								ОблагаемыйДоходНаНачалоМесяца = ОблагаемыйДоход;
								НалогЗаМесяц = 0;
								НачисленныйДоходЗаДату = 0;
								ИспользованоВычетовЗаМесяц = 0;
								Пока ВыборкаРасчетов.СледующийПоЗначениюПоля("ДатаПолученияДохода") Цикл

									ОблагаемыйДоходНаНачалоМесяца = ОблагаемыйДоход;
									ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = 0;
									ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = 0;
									ЕстьДоходыПромежуточногоРасчета = Ложь;
									ЕстьДоходыОкончательногоРасчета = Ложь;
									Пока ВыборкаРасчетов.Следующий() Цикл
										НачисленныйДоходЗаДату = ВыборкаРасчетов.ОблагаемыйДоход;
										Если ВыборкаРасчетов.ЗарегистрированоДляПромежуточногоРасчета  Тогда 
											ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = Мин(ВыборкаРасчетов.ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ВыборкаРасчетов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
											ЕстьДоходыПромежуточногоРасчета = Истина;
										Иначе
											ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = Мин(ВыборкаРасчетов.ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ВыборкаРасчетов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
											ЕстьДоходыОкончательногоРасчета = Истина;
										КонецЕсли;
										ЗаполнитьЗначенияСвойств(СтруктураПоискаПоДатам, ВыборкаРасчетов);
									КонецЦикла;
									
									// Расчет сумм налога
									Если ВыборкаРасчетов.ДатаПолученияДохода < ВыборкаРасчетов.МаксимальнаяДатаПолученияДоходаМесяца Тогда
										
										Если ЕстьДоходыПромежуточногоРасчета Тогда
											
											СтруктураПоискаПоДатам.ЗарегистрированоДляПромежуточногоРасчета = Истина;
											ВыделитьРаспределениеДоходов(РаспределениеДоходовФизлица, СтруктураПоискаПоДатам, Доходы, КоэффициентыПодразделений, ДоходыМесяцаРасчета, КоэффициентыПодразделенийМесяцаРасчета);
											
											ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
											НалогСДохода = Макс(Окр(ОблагаемыйДоходДляИсчисленияНалога * ВыборкаРасчетов.СтавкаДляРезидента) - НалогИсчисленный, 0);
											НалогИсчисленный = НалогИсчисленный + НалогСДохода;
											НалогЗаМесяц = НалогЗаМесяц + НалогСДохода;
											ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.ДатаПолученияДохода, НалогСДохода, "НалогПоСтавке13", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений, 0, "Подразделение, КатегорияДохода");
											
										КонецЕсли;
										
										Если ЕстьДоходыОкончательногоРасчета Тогда
											
											СтруктураПоискаПоДатам.ЗарегистрированоДляПромежуточногоРасчета = Ложь;
											ВыделитьРаспределениеДоходов(РаспределениеДоходовФизлица, СтруктураПоискаПоДатам, Доходы, КоэффициентыПодразделений, ДоходыМесяцаРасчета, КоэффициентыПодразделенийМесяцаРасчета);											
											
											ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
											НалогСДохода = Окр(ОблагаемыйДоходДляИсчисленияНалога * ВыборкаРасчетов.СтавкаДляРезидента) - НалогИсчисленный;
											НалогИсчисленный = НалогИсчисленный + НалогСДохода;
											НалогЗаМесяц = НалогЗаМесяц + НалогСДохода;
											ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.ДатаПолученияДохода, НалогСДохода, "НалогПоСтавке13", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений, 0, "Подразделение, КатегорияДохода");
											
										КонецЕсли;
										
									Иначе
										
										Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
											
											СтруктураПоискаПоДатам.ЗарегистрированоДляПромежуточногоРасчета = Истина;
											ВыделитьРаспределениеДоходов(РаспределениеДоходовФизлица, СтруктураПоискаПоДатам, Доходы, КоэффициентыПодразделений, ДоходыМесяцаРасчета, КоэффициентыПодразделенийМесяцаРасчета);											
											ОбщегоНазначенияКлиентСервер.ДополнитьМассив(ДоходыДляРаспределенияВычетов, Доходы);
											ОбщегоНазначенияКлиентСервер.ДополнитьМассив(КоэффициентыДляРаспределенияВычетов, КоэффициентыПодразделений);
											
											ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
											НалогСДохода = Макс(Окр(ОблагаемыйДоходДляИсчисленияНалога * ВыборкаРасчетов.СтавкаДляРезидента) - НалогИсчисленный, 0);
											НалогИсчисленный = НалогИсчисленный + НалогСДохода;
											НалогЗаМесяц = НалогЗаМесяц + НалогСДохода;
											ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.ДатаПолученияДохода, НалогСДохода, "НалогПоСтавке13", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений, 0, "Подразделение, КатегорияДохода");
											
											СтруктураПоискаПоДатам.ЗарегистрированоДляПромежуточногоРасчета = Ложь;
											ВыделитьРаспределениеДоходов(РаспределениеДоходовФизлица, СтруктураПоискаПоДатам, Доходы, КоэффициентыПодразделений, ДоходыМесяцаРасчета, КоэффициентыПодразделенийМесяцаРасчета);											
											ОбщегоНазначенияКлиентСервер.ДополнитьМассив(ДоходыДляРаспределенияВычетов, Доходы);
											ОбщегоНазначенияКлиентСервер.ДополнитьМассив(КоэффициентыДляРаспределенияВычетов, КоэффициентыПодразделений);
											
											ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
											НалогСДохода = Окр(ОблагаемыйДоходДляИсчисленияНалога * ВыборкаРасчетов.СтавкаДляРезидента) - НалогИсчисленный;
											НалогИсчисленный = НалогИсчисленный + НалогСДохода;
											НалогЗаМесяц = НалогЗаМесяц + НалогСДохода;
											ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.ДатаПолученияДохода, НалогСДохода, "НалогПоСтавке13", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений, 0, "Подразделение, КатегорияДохода");
											
											ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
											
										Иначе
											
											ВыделитьРаспределениеДоходов(РаспределениеДоходовФизлица, СтруктураПоискаПоДатам, Доходы, КоэффициентыПодразделений, ДоходыМесяцаРасчета, КоэффициентыПодразделенийМесяцаРасчета);											
											ОбщегоНазначенияКлиентСервер.ДополнитьМассив(ДоходыДляРаспределенияВычетов, Доходы);
											ОбщегоНазначенияКлиентСервер.ДополнитьМассив(КоэффициентыДляРаспределенияВычетов, КоэффициентыПодразделений);
											
											ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
											НалогСДохода = Окр(ОблагаемыйДоходДляИсчисленияНалога * ВыборкаРасчетов.СтавкаДляРезидента) - НалогИсчисленный;
											НалогИсчисленный = НалогИсчисленный + НалогСДохода;
											НалогЗаМесяц = НалогЗаМесяц + НалогСДохода;
											ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ВыборкаРасчетов.ДатаПолученияДохода, НалогСДохода, "НалогПоСтавке13", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений, 0, "Подразделение, КатегорияДохода");
											
											ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
											
										КонецЕсли;
										
									КонецЕсли;
									
									Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
										ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
									Иначе
										ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
									КонецЕсли;
									ВсегоВычетовЗаДату = НачисленныйДоходЗаДату - (ОблагаемыйДоходЗаДату - ОблагаемыйДоходНаНачалоМесяца) - ИспользованоВычетовЗаМесяц;
									ИспользованоВычетовЗаМесяц = ИспользованоВычетовЗаМесяц + ВсегоВычетовЗаДату;
									
									Если ВсегоВычетовЗаДату * ВычетНаДетейЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетей", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейЗаМесяц = ВычетНаДетейЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейДвойнойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейДвойнойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейДвойнойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейДвойнойЗаМесяц = ВычетНаДетейДвойнойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейДвойнойВторойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейДвойнойВторойЗаМесяц = ВычетНаДетейДвойнойВторойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаВторогоРебенкаЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаВторогоРебенкаЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаВторогоРебенкаЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаВторогоРебенка", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаВторогоРебенкаЗаМесяц = ВычетНаВторогоРебенкаЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаВторогоРебенкаДвойнойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаВторогоРебенкаДвойнойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаВторогоРебенкаДвойнойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаВторогоРебенкаДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаВторогоРебенкаДвойнойЗаМесяц = ВычетНаВторогоРебенкаДвойнойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаВторогоРебенкаДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц = ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаТретьегоРебенкаЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаТретьегоРебенкаЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаТретьегоРебенкаЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаТретьегоРебенка", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаТретьегоРебенкаЗаМесяц = ВычетНаТретьегоРебенкаЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаТретьегоРебенкаДвойнойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаТретьегоРебенкаДвойнойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаТретьегоРебенкаДвойнойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаТретьегоРебенкаДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаТретьегоРебенкаДвойнойЗаМесяц = ВычетНаТретьегоРебенкаДвойнойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаТретьегоРебенкаДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц = ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейИнвалидовЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейИнвалидовЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейИнвалидовЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейИнвалидов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейИнвалидовЗаМесяц = ВычетНаДетейИнвалидовЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейИнвалидовДвойнойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейИнвалидовДвойнойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейИнвалидовДвойнойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейИнвалидовДвойной", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейИнвалидовДвойнойЗаМесяц = ВычетНаДетейИнвалидовДвойнойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейИнвалидовДвойнойВторой", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц = ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейОпекуновЗаМесяц = ВычетНаДетейОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейДвойнойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейДвойнойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейДвойнойОпекуновЗаМесяц = ВычетНаДетейДвойнойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейДвойнойВторойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейДвойнойВторойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейДвойнойВторойОпекуновЗаМесяц = ВычетНаДетейДвойнойВторойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаВторогоРебенкаОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаВторогоРебенкаОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаВторогоРебенкаОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаВторогоРебенкаОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаВторогоРебенкаОпекуновЗаМесяц = ВычетНаВторогоРебенкаОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц = ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц = ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаТретьегоРебенкаОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаТретьегоРебенкаОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаТретьегоРебенкаОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаТретьегоРебенкаОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаТретьегоРебенкаОпекуновЗаМесяц = ВычетНаТретьегоРебенкаОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц = ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц = ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейИнвалидовОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейИнвалидовОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейИнвалидовОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейИнвалидовОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейИнвалидовОпекуновЗаМесяц = ВычетНаДетейИнвалидовОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц = ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц = ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетЛичныйЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетЛичныйЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетЛичныйЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетЛичный", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетЛичныйЗаМесяц = ВычетЛичныйЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетРасходыНаДорогостоящееЛечениеЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетРасходыНаДорогостоящееЛечениеЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетРасходыНаДорогостоящееЛечениеЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетРасходыНаДорогостоящееЛечение", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетРасходыНаДорогостоящееЛечениеЗаМесяц = ВычетРасходыНаДорогостоящееЛечениеЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетВзносыНаДобровольноеСтрахованиеЖизни", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц = ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетСтраховыеВзносыНаМедУслугиЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетСтраховыеВзносыНаМедУслугиЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетСтраховыеВзносыНаМедУслугиЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетСтраховыеВзносыНаМедУслуги", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетСтраховыеВзносыНаМедУслугиЗаМесяц = ВычетСтраховыеВзносыНаМедУслугиЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетРасходыНаЛечениеЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетРасходыНаЛечениеЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетРасходыНаЛечениеЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетРасходыНаЛечение", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетРасходыНаЛечениеЗаМесяц = ВычетРасходыНаЛечениеЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетРасходыНаОбучениеДетейЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетРасходыНаОбучениеДетейЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетРасходыНаОбучениеДетейЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетРасходыНаОбучениеДетей", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетРасходыНаОбучениеДетейЗаМесяц = ВычетРасходыНаОбучениеДетейЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетРасходыНаСвоеОбучениеЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетРасходыНаСвоеОбучениеЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетРасходыНаСвоеОбучениеЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетРасходыНаСвоеОбучение", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетРасходыНаСвоеОбучениеЗаМесяц = ВычетРасходыНаСвоеОбучениеЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетИмущественныйПроцентыПоКредитамЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетИмущественныйПроцентыПоКредитамЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетИмущественныйПроцентыПоКредитамЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетИмущественныйПроцентыПоКредитам", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетИмущественныйПроцентыПоКредитамЗаМесяц = ВычетИмущественныйПроцентыПоКредитамЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетИмущественныйПроцентыПриПерекредитовании", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
										ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц = ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц - Учтено;
									КонецЕсли;
									Если ВсегоВычетовЗаДату * ВычетИмущественныйРасходыЗаМесяц > 0 Тогда
										Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ВычетИмущественныйРасходыЗаМесяц, ВсегоВычетовЗаДату), Макс(ВычетИмущественныйРасходыЗаМесяц, ВсегоВычетовЗаДату));
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', Учтено, "ПримененныйВычетИмущественныйРасходы", ВыборкаРасчетов, Доходы, КоэффициентыПодразделений);
										ВычетИмущественныйРасходыЗаМесяц = ВычетИмущественныйРасходыЗаМесяц - Учтено;
									КонецЕсли;
									
								КонецЦикла;
							КонецЕсли;
						Иначе	
							Пока ВыборкаРасчетов.Следующий() Цикл
								
								НалогСДохода = ВыборкаРасчетов.НалогНерезидента;
								НалогЗаМесяц = НалогЗаМесяц + НалогСДохода;
								
								СтрокаНалога = ВспомогательнаяТаблицаМесяца.Добавить();
								ЗаполнитьЗначенияСвойств(СтрокаНалога, ВыборкаРасчетов, "ФизическоеЛицо, Подразделение, КатегорияДохода");
								СтрокаНалога.НалогПоСтавке13 = НалогСДохода;
								СтрокаНалога.МесяцНалоговогоПериода = ВыборкаРасчетов.ДатаПолученияДохода;
								
							КонецЦикла;
						КонецЕсли;
					КонецЦикла;
					
					// Сбор вычетов в собственной таблице значений.
					СтруктураПоискаВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаВычетовМесяца, ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаВычетов), РассчитываемыеРесурсыИмущественныхВычетов());
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаВычетовМесяца, ?(СтрокиСтандартныхВычетов <> Неопределено, СтрокиСтандартныхВычетов, СтандартныхВычетовРанее.НайтиСтроки(СтруктураПоискаСтандартныхВычетов)), "ПримененныйВычетЛичный," + РассчитываемыеРесурсыВычетовНаДетей());
					Если ЕстьВычетыЗаМесяц Тогда
						
						Если Не ЗначениеЗаполнено(ДоходыДляРаспределенияВычетов) Тогда
							Если ОкончательныйРасчет Тогда
								Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
									ДатаМесяца = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
									ДоходыДляРаспределенияВычетов = ДоходыМесяцаРасчетаПоТекущимДоходам;
									КоэффициентыДляРаспределенияВычетов = КоэффициентыПодразделенийМесяцаРасчетаПоТекущимДоходам;
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
									ДатаМесяца = ОсновнаяДатаМесяцаРасчета;
									ДоходыДляРаспределенияВычетов = ДоходыКонцаМесяцаРасчета;
									КоэффициентыДляРаспределенияВычетов = КоэффициентыПодразделенийКонцаМесяцаРасчета;
								Иначе
									ДатаМесяца = ДатаНалоговогоПериода;
									ДоходыДляРаспределенияВычетов = ДоходыНалоговогоПериода;
									КоэффициентыДляРаспределенияВычетов = КоэффициентыПодразделенийНалоговогоПериода;
								КонецЕсли;
							Иначе
								ДатаМесяца = ОсновнаяДатаТекущегоРасчета;
								СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = ОсновнаяДатаТекущегоРасчета;
								ВыделитьРаспределениеДоходов(ДоходыТекущегоРасчета, СтруктураПоискаДоходовПоДатам, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов, Новый Массив, Новый Массив);											
							КонецЕсли;
						КонецЕсли;
						
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетЛичныйЗаМесяц, "ПримененныйВычетЛичный", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейЗаМесяц, "ПримененныйВычетНаДетей", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейДвойнойЗаМесяц, "ПримененныйВычетНаДетейДвойной", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейДвойнойВторойЗаМесяц, "ПримененныйВычетНаДетейДвойнойВторой", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаТретьегоРебенкаЗаМесяц, "ПримененныйВычетНаТретьегоРебенка", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаТретьегоРебенкаДвойнойЗаМесяц, "ПримененныйВычетНаТретьегоРебенкаДвойной", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаТретьегоРебенкаДвойнойВторойЗаМесяц, "ПримененныйВычетНаТретьегоРебенкаДвойнойВторой", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаВторогоРебенкаЗаМесяц, "ПримененныйВычетНаВторогоРебенка", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаВторогоРебенкаДвойнойЗаМесяц, "ПримененныйВычетНаВторогоРебенкаДвойной", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаВторогоРебенкаДвойнойВторойЗаМесяц, "ПримененныйВычетНаВторогоРебенкаДвойнойВторой", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейИнвалидовЗаМесяц, "ПримененныйВычетНаДетейИнвалидов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейИнвалидовДвойнойЗаМесяц, "ПримененныйВычетНаДетейИнвалидовДвойной", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейИнвалидовДвойнойВторойЗаМесяц, "ПримененныйВычетНаДетейИнвалидовДвойнойВторой", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейОпекуновЗаМесяц, "ПримененныйВычетНаДетейОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейДвойнойОпекуновЗаМесяц, "ПримененныйВычетНаДетейДвойнойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейДвойнойВторойОпекуновЗаМесяц, "ПримененныйВычетНаДетейДвойнойВторойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаТретьегоРебенкаОпекуновЗаМесяц, "ПримененныйВычетНаТретьегоРебенкаОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаТретьегоРебенкаДвойнойОпекуновЗаМесяц, "ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаТретьегоРебенкаДвойнойВторойОпекуновЗаМесяц, "ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаВторогоРебенкаОпекуновЗаМесяц, "ПримененныйВычетНаВторогоРебенкаОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаВторогоРебенкаДвойнойОпекуновЗаМесяц, "ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаВторогоРебенкаДвойнойВторойОпекуновЗаМесяц, "ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейИнвалидовОпекуновЗаМесяц, "ПримененныйВычетНаДетейИнвалидовОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейИнвалидовДвойнойОпекуновЗаМесяц, "ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетНаДетейИнвалидовДвойнойВторойОпекуновЗаМесяц, "ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетИмущественныйРасходыЗаМесяц, "ПримененныйВычетИмущественныйРасходы", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетИмущественныйПроцентыПоКредитамЗаМесяц, "ПримененныйВычетИмущественныйПроцентыПоКредитам", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетИмущественныйПроцентыПриПерекредитованииЗаМесяц, "ПримененныйВычетИмущественныйПроцентыПриПерекредитовании", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетРасходыНаСвоеОбучениеЗаМесяц, "ПримененныйВычетРасходыНаСвоеОбучение", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетРасходыНаОбучениеДетейЗаМесяц, "ПримененныйВычетРасходыНаОбучениеДетей", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетРасходыНаЛечениеЗаМесяц, "ПримененныйВычетРасходыНаЛечение", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетСтраховыеВзносыНаМедУслугиЗаМесяц, "ПримененныйВычетСтраховыеВзносыНаМедУслуги", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетРасходыНаДорогостоящееЛечениеЗаМесяц, "ПримененныйВычетРасходыНаДорогостоящееЛечение", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаВычетовМесяца, '00010101', ВычетВзносыНаДобровольноеСтрахованиеЖизниЗаМесяц, "ПримененныйВычетВзносыНаДобровольноеСтрахованиеЖизни", СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов);
						
					КонецЕсли;
					
					// Переписываем вычеты в таблицу результатов расчета за месяц.
					Если ЕстьДанныеВТаблицеФизическогоЛица(ВспомогательнаяТаблицаВычетовМесяца, МассивРесурсов) Тогда
						Если ОкончательныйРасчет Тогда
							Если ВыборкаРасчетов.ВсеДоходыЗаМесяц <> 0 Или ЭтоПерерасчет Тогда
								ДатаУчетаВычетов = КонецМесяца(ВыборкаРасчетов.МесяцНалоговогоПериода)
							Иначе
								ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(ВыборкаРасчетов.МесяцНалоговогоПериода)];
								Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
									ДатаУчетаВычетов = ОсновнаяДатаПолученияДохода;
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
									ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
									ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчета;
								Иначе
									ДатаУчетаВычетов = ДатаНалоговогоПериода;
								КонецЕсли;
							КонецЕсли;
						Иначе
							ДатаУчетаВычетов = ОсновнаяДатаТекущегоРасчета;
						КонецЕсли;
						Если Не ЕстьВычетыЗаМесяц Тогда
							ВспомогательнаяТаблицаВычетовМесяца.ЗаполнитьЗначения(ДатаУчетаВычетов, "МесяцНалоговогоПериода");
							ВспомогательнаяТаблицаВычетовМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода", СтрокаРесурсов);
							ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВспомогательнаяТаблицаВычетовМесяца, ВспомогательнаяТаблицаМесяца)
						Иначе
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица = ВспомогательнаяТаблицаВычетовМесяца.Скопировать( ,"ФизическоеЛицо, Подразделение, " + СтрокаРесурсов);
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Свернуть("ФизическоеЛицо, Подразделение", СтрокаРесурсов);
							Если ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Количество() = 1 Тогда
								СтрокаТЗ = ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица[0];
								Для каждого ИмяРесурса Из МассивРесурсов Цикл
									Если СтрокаТЗ[ИмяРесурса] <> 0 Тогда
										ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ДатаУчетаВычетов, СтрокаТЗ[ИмяРесурса], ИмяРесурса, СтруктураПоиска, ДоходыДляРаспределенияВычетов, КоэффициентыДляРаспределенияВычетов,, "Подразделение, КатегорияДохода");
									КонецЕсли;
								КонецЦикла;
							Иначе 	
								Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица Цикл
									Доходы = Новый Массив;
									Для каждого СтрокаРаспределения Из ДоходыДляРаспределенияВычетов Цикл
										Если СтрокаРаспределения.Подразделение = СтрокаТЗ.Подразделение Тогда
											Доходы.Добавить(СтрокаРаспределения)
										КонецЕсли;
									КонецЦикла;
									Коэффициенты = ОбщегоНазначения.ВыгрузитьКолонку(Доходы, "СуммаДохода");
									Для каждого ИмяРесурса Из МассивРесурсов Цикл
										Если СтрокаТЗ[ИмяРесурса] <> 0 Тогда
											ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаМесяца, ДатаУчетаВычетов, СтрокаТЗ[ИмяРесурса], ИмяРесурса, СтруктураПоиска, Доходы, Коэффициенты,, "Подразделение, КатегорияДохода");
										КонецЕсли;
									КонецЦикла;
								КонецЦикла;
							КонецЕсли;
						КонецЕсли;
					КонецЕсли;
					
					// Вычитаем ранее исчисленное.
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленоРанее.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13");
					
					// В "межрасчетном" варианте оставляем только те результаты, которые соответствуют месяцу (-ам) получения дохода
					// текущего акта расчета.
					Если ВыполнятьМинимизациюПерерасчетов И Не ОкончательныйРасчет И Не ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[Месяц(ВыборкаРасчетов.МесяцНалоговогоПериода)]) Тогда
						Если ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") <> 0 Тогда
							ВспомогательнаяТаблицаМесяца.Очистить();
							Продолжить;
						Иначе
							СтрокиКУдалению = Новый Соответствие;
							Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаМесяца Цикл
								Если ВсеДатыТекущегоРасчета[СтрокаТЗ.МесяцНалоговогоПериода] = Неопределено Тогда
									СтрокиКУдалению.Вставить(СтрокаТЗ, Истина)
								КонецЕсли;
							КонецЦикла;
							Если ВспомогательнаяТаблицаМесяца.Количество() = СтрокиКУдалению.Количество() Тогда
								ВспомогательнаяТаблицаМесяца.Очистить();
								Продолжить;
							Иначе
								Для каждого Элемент Из СтрокиКУдалению Цикл
									ВспомогательнаяТаблицаМесяца.Удалить(Элемент.Ключ);
								КонецЦикла;
							КонецЕсли;
						КонецЕсли;
					КонецЕсли;
					
					ВспомогательнаяТаблицаМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода", СтрокаРесурсов);
					ВспомогательнаяТаблицаМесяца.ЗаполнитьЗначения(ВыборкаРасчетов.МесяцНалоговогоПериода,"МесяцПериодаПредоставленияВычета");
					
					// Вычеркнем из результата строки по переброске некоторой суммы с одной категории на другую
					ТаблицаМесяцаБезКатегорийДохода = ВспомогательнаяТаблицаМесяца.Скопировать();
					ТаблицаМесяцаБезКатегорийДохода.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода,Подразделение", СтрокаРесурсов);
					Для каждого СтрокаТЗ Из ТаблицаМесяцаБезКатегорийДохода Цикл
						Если Не ЕстьДанныеВСтроке(СтрокаТЗ, МассивРесурсов) Тогда
							СтрокиКОбнулению = ВспомогательнаяТаблицаМесяца.НайтиСтроки(Новый Структура("МесяцНалоговогоПериода,Подразделение", СтрокаТЗ.МесяцНалоговогоПериода, СтрокаТЗ.Подразделение));
							Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
								Для каждого ИмяРесурса Из МассивРесурсов Цикл
									СтрокаКОбнулению[ИмяРесурса] = 0;
								КонецЦикла;
							КонецЦикла; 	
						КонецЕсли;
					КонецЦикла;
					
					// Для 2015 года парные записи с + и - за месяц из-за уточнения учета в результаты расчетов не пишем
					Если НачалоГода(ВыборкаРасчетов.МесяцНалоговогоПериода) = ДатаИзмененияИсчисленияДляИностранцев Тогда
						НачалоМесяца = НачалоМесяца(ВыборкаРасчетов.МесяцНалоговогоПериода);
						СтрокиНалогов = ВспомогательнаяТаблицаМесяца.Скопировать(,"Подразделение, НалогПоСтавке13");
						СтрокиНалогов.Свернуть("Подразделение", "НалогПоСтавке13");
						СтрокиОкругления = Новый Массив;
						СуммаСтрокОкругления = 0;
						Для каждого СтрокаТЗ Из СтрокиНалогов Цикл
							Если СтрокаТЗ.НалогПоСтавке13 * СтрокаТЗ.НалогПоСтавке13 = 1 Тогда
								СтрокиОкругления.Добавить(СтрокаТЗ);
								СуммаСтрокОкругления = СуммаСтрокОкругления + СтрокаТЗ.НалогПоСтавке13;
							КонецЕсли;
						КонецЦикла;
						Если СуммаСтрокОкругления = 0 Тогда
							Для каждого СтрокаТЗ Из СтрокиОкругления Цикл
								СтрокаТЗ.НалогПоСтавке13 = 0
							КонецЦикла;
						КонецЕсли;
						Для каждого СтрокаТЗ Из СтрокиНалогов Цикл
							СтрокиПодразделения = ВспомогательнаяТаблицаМесяца.НайтиСтроки(Новый Структура("Подразделение",СтрокаТЗ.Подразделение));
							Если СтрокиПодразделения.Количество() = 1 Тогда
								Продолжить;
							КонецЕсли;
							Если СтрокаТЗ.НалогПоСтавке13 = 0 Тогда
								Для каждого СтрокаПодразделения Из СтрокиПодразделения Цикл
									СтрокаПодразделения.НалогПоСтавке13 = 0
								КонецЦикла;
							Иначе
								СуммаПерерасчета = 0;
								Для каждого СтрокаПодразделения Из СтрокиПодразделения Цикл
									Если СтрокаПодразделения.МесяцНалоговогоПериода = НачалоМесяца И СтрокаПодразделения.НалогПоСтавке13 < 0 Тогда
										СуммаПерерасчета = СтрокаПодразделения.НалогПоСтавке13;
										СтрокаНачалаМесяца = СтрокаПодразделения;
										Прервать;
									КонецЕсли;
								КонецЦикла;
								Если СуммаПерерасчета < 0 Тогда
									Для каждого СтрокаПодразделения Из СтрокиПодразделения Цикл
										Если СуммаПерерасчета < 0 И СтрокаПодразделения.МесяцНалоговогоПериода > НачалоМесяца И СтрокаПодразделения.НалогПоСтавке13 > 0 Тогда
											СуммаЗачета = Мин(-СуммаПерерасчета, СтрокаПодразделения.НалогПоСтавке13);
											СтрокаНачалаМесяца.НалогПоСтавке13 = СтрокаНачалаМесяца.НалогПоСтавке13 + СуммаЗачета;
											СтрокаПодразделения.НалогПоСтавке13 = СтрокаПодразделения.НалогПоСтавке13 - СуммаЗачета;
											СуммаПерерасчета = СтрокаНачалаМесяца.НалогПоСтавке13;
										ИначеЕсли СуммаПерерасчета = 0 Тогда 
											Прервать;
										КонецЕсли;
									КонецЦикла;
								КонецЕсли;
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
					
					Если Не ЕстьДанныеВТаблицеФизическогоЛица(ВспомогательнаяТаблицаМесяца, МассивРесурсов) Тогда
						Продолжить;
					КонецЕсли;
					
					ВспомогательнаяТаблицаМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета,Подразделение, КатегорияДохода", СтрокаРесурсов);
					
					Если ВыполнятьМинимизациюПерерасчетов Тогда
						// Минимизируем появление отсутствующих в текущих доходах дат получения и категорий дохода:
						// 1. Определяем подходящую дату получения дохода и соответствующее ей распределение
						ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(ВыборкаРасчетов.МесяцНалоговогоПериода)];
						Если ОкончательныйРасчет Тогда
							
							Если Не ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда // перерасчет налога при отсутствии дохода текущего акта расчета
								ВсегоНалогаЗаМесяц = ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13");
								Если ВсегоНалогаЗаМесяц = 0 И ВыборкаРасчетов.МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Тогда // нашли предшествующий месяц с нулевым налогом
									ЕстьДанныеМесяца = Ложь;
									Для каждого ИмяРесурса Из МассивРесурсов Цикл
										ЕстьДанныеМесяца = ВспомогательнаяТаблицаМесяца.Итог(ИмяРесурса) <> 0;
										Если ЕстьДанныеМесяца Тогда
											Прервать;
										КонецЕсли;
									КонецЦикла;
									Если Не ЕстьДанныеМесяца Тогда // игнорируем различные переброски сумм в одной колонке, но не между колонками 
										ВспомогательнаяТаблицаМесяца.Очистить();
										Продолжить;
									КонецЕсли;
								КонецЕсли;
								Если ВыборкаРасчетов.МесяцНалоговогоПериода > КонецМесяца(МесяцРасчета) Тогда // перерасчет по будущим доходам не производим
									Продолжить;	
								КонецЕсли;
							КонецЕсли;
							
							ДоходыТекущегоМесяца = Неопределено;
							КоэффициентыПодразделенийТекущегоМесяца = Неопределено;
							Если ВыборкаРасчетов.МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Тогда
								Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
									СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
									ДатаМесяца = ОсновнаяДатаПолученияДохода;
									ВыделитьРаспределениеДоходов(ДоходыТекущегоРасчета, СтруктураПоискаДоходовПоДатам, ДоходыТекущегоМесяца, КоэффициентыПодразделенийТекущегоМесяца, Новый Массив, Новый Массив);											
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
									ДатаМесяца = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
									ДоходыТекущегоМесяца = ДоходыМесяцаРасчетаПоТекущимДоходам;
									КоэффициентыПодразделенийТекущегоМесяца = КоэффициентыПодразделенийМесяцаРасчетаПоТекущимДоходам;
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
									ДатаМесяца = ОсновнаяДатаМесяцаРасчета;
									ДоходыТекущегоМесяца = ДоходыКонцаМесяцаРасчета;
									КоэффициентыПодразделенийТекущегоМесяца = КоэффициентыПодразделенийКонцаМесяцаРасчета;
								Иначе
									ДатаМесяца = ДатаНалоговогоПериода;
									ДоходыТекущегоМесяца = ДоходыНалоговогоПериода;
									КоэффициентыПодразделенийТекущегоМесяца = КоэффициентыПодразделенийНалоговогоПериода;
								КонецЕсли;
							Иначе
								Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
									СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
									ДатаМесяца = ОсновнаяДатаПолученияДохода;
									ВыделитьРаспределениеДоходов(ДоходыТекущегоРасчета, СтруктураПоискаДоходовПоДатам, ДоходыТекущегоМесяца, КоэффициентыПодразделенийТекущегоМесяца, Новый Массив, Новый Массив);											
								Иначе
									ДатаМесяца = ДатаНалоговогоПериода;
									ДоходыТекущегоМесяца = ДоходыНалоговогоПериода;
									КоэффициентыПодразделенийТекущегоМесяца = КоэффициентыПодразделенийНалоговогоПериода;
								КонецЕсли;
							КонецЕсли;
							
						Иначе	
							ДоходыТекущегоМесяца = Неопределено;
							КоэффициентыПодразделенийТекущегоМесяца = Неопределено;
							ДатаМесяца = ОсновнаяДатаПолученияДохода;
							СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
							ВыделитьРаспределениеДоходов(ДоходыТекущегоРасчета, СтруктураПоискаДоходовПоДатам, ДоходыТекущегоМесяца, КоэффициентыПодразделенийТекущегоМесяца, Новый Массив, Новый Массив);											
						КонецЕсли;
						// 2. Заменяем даты получения дохода на подходящую и пересматриваем категорию дохода
						Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаМесяца Цикл
							Если ЕстьДанныеВСтроке(СтрокаТЗ, МассивРесурсов) Тогда
								
								ЗаменятьДатуПолученияДохода = ВсеДатыТекущегоРасчета[СтрокаТЗ.МесяцНалоговогоПериода] = Неопределено;
								ЗаменятьКатегориюДохода = ВсеКатегорииТекущегоРасчета[СтрокаТЗ.КатегорияДохода] = Неопределено;
								ЗаменятьПодразделение = ВыборкаРасчетов.МесяцНалоговогоПериода >= НачалоМесяца(МесяцРасчета) И НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода) = НачалоМесяца(ДатаМесяца);
								Если ЗаменятьПодразделение Тогда
									СтруктураПоискаПоДатамИПодразделениям.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
									ЗаполнитьЗначенияСвойств(СтруктураПоискаПоДатамИПодразделениям, СтрокаТЗ);
									ЗаменятьПодразделение = ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаПоДатамИПодразделениям).Количество() = 0;
								КонецЕсли;
								Если Не ЗаменятьДатуПолученияДохода И Не ЗаменятьПодразделение И Не ЗаменятьКатегориюДохода Тогда
									ЗаполнитьЗначенияСвойств(ВспомогательнаяТаблицаФизическогоЛица.Добавить(),СтрокаТЗ);
									Продолжить;
								КонецЕсли;
								Если ЗаменятьДатуПолученияДохода Тогда
									СтрокаТЗ.МесяцНалоговогоПериода = ДатаМесяца;
								КонецЕсли;
								Если ОсобыеКатегорииДохода[СтрокаТЗ.КатегорияДохода] = Истина Тогда
									ЗаполнитьЗначенияСвойств(ВспомогательнаяТаблицаФизическогоЛица.Добавить(),СтрокаТЗ);
									Продолжить;
								КонецЕсли;
								Если ЗаменятьДатуПолученияДохода Тогда
									Доходы = ДоходыТекущегоМесяца;
									КоэффициентыПодразделений = КоэффициентыПодразделенийТекущегоМесяца;
								Иначе
									СтруктураПоискаДоходовПоДатам.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
									ВыделитьРаспределениеДоходов(ДоходыТекущегоРасчета, СтруктураПоискаДоходовПоДатам, Доходы, КоэффициентыПодразделений, Новый Массив, Новый Массив);											
								КонецЕсли;
								Если Не ЗначениеЗаполнено(Доходы) Тогда
									ЗаполнитьЗначенияСвойств(ВспомогательнаяТаблицаФизическогоЛица.Добавить(),СтрокаТЗ);
									Продолжить;
								ИначеЕсли Доходы.Количество() = 1 Тогда
									Если ЗаменятьПодразделение Тогда
										СтрокаТЗ.Подразделение = Доходы[0].Подразделение;
									КонецЕсли;
									Если ЗаменятьКатегориюДохода Тогда
										СтрокаТЗ.КатегорияДохода = Доходы[0].КатегорияДохода;
									КонецЕсли;
									ЗаполнитьЗначенияСвойств(ВспомогательнаяТаблицаФизическогоЛица.Добавить(),СтрокаТЗ);
								Иначе
									СтрокДоРаспределения = ВспомогательнаяТаблицаФизическогоЛица.Количество();
									Для каждого ИмяРесурса Из МассивРесурсов Цикл
										Если СтрокаТЗ[ИмяРесурса] <> 0 Тогда
											ВписатьРесурсВРезультатыРасчетовБО(ВспомогательнаяТаблицаФизическогоЛица, СтрокаТЗ.МесяцНалоговогоПериода, СтрокаТЗ[ИмяРесурса], ИмяРесурса, СтруктураПоиска, Доходы, КоэффициентыПодразделений,?(ИмяРесурса = "НалогПоСтавке13",0,2), "Подразделение, КатегорияДохода");
										КонецЕсли;
									КонецЦикла;
									Если СтрокДоРаспределения < ВспомогательнаяТаблицаФизическогоЛица.Количество() Тогда
										Для Сч = СтрокДоРаспределения + 1 По ВспомогательнаяТаблицаФизическогоЛица.Количество() Цикл
											Если ЗаменятьДатуПолученияДохода Тогда
												// восстановим подразделение или категорию, если ранее это была чужая строка налога
												Если Не ЗаменятьПодразделение Тогда
													ВспомогательнаяТаблицаФизическогоЛица[Сч-1].Подразделение = СтрокаТЗ.Подразделение
												КонецЕсли;
												Если Не ЗаменятьКатегориюДохода Тогда
													ВспомогательнаяТаблицаФизическогоЛица[Сч-1].КатегорияДохода = СтрокаТЗ.КатегорияДохода
												КонецЕсли;
											КонецЕсли;
											ВспомогательнаяТаблицаФизическогоЛица[Сч-1].МесяцПериодаПредоставленияВычета = СтрокаТЗ.МесяцПериодаПредоставленияВычета
										КонецЦикла;
									КонецЕсли;
								КонецЕсли;
								
							КонецЕсли;
						КонецЦикла;
						ВспомогательнаяТаблицаМесяца.Очистить();
					Иначе
						// ненулевые строки переписываем в результат по физ.лицу
						Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаМесяца Цикл
							Если ЕстьДанныеВСтроке(СтрокаТЗ, МассивРесурсов) Тогда
								ЗаполнитьЗначенияСвойств(ВспомогательнаяТаблицаФизическогоЛица.Добавить(),СтрокаТЗ);
							КонецЕсли;
						КонецЦикла;
						ВспомогательнаяТаблицаМесяца.Очистить();
					КонецЕсли;
					
				КонецЦикла;
				
			КонецЦикла;
			
			Если Не ЕстьДанныеВТаблицеФизическогоЛица(ВспомогательнаяТаблицаФизическогоЛица, МассивРесурсов) Тогда
				Продолжить;	
			КонецЕсли;
			
			ВспомогательнаяТаблицаФизическогоЛица.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета,Подразделение, КатегорияДохода", СтрокаРесурсов);
			Если ОкончательныйРасчет Тогда
				Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаФизическогоЛица Цикл
					Если ЕстьДанныеВСтроке(СтрокаТЗ, МассивРесурсов) Тогда
						ЗаполнитьЗначенияСвойств(РезультатыРасчетов.Добавить(),СтрокаТЗ);
					КонецЕсли;
				КонецЦикла;
				КоличествоСтрок = РезультатыРасчетов.Количество();
				Если КоличествоСтрок > 0 Тогда
					РезультатыРасчетов[КоличествоСтрок - 1].УчтенныеОснования = УчтенныеОснования;
				КонецЕсли;
			Иначе 
				ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультатБО(РезультатыРасчетов, ВспомогательнаяТаблицаФизическогоЛица, ДатаУдержанияИсчисленногоНалога, МесяцРасчета, ВсегоДоходовТекущегоРасчета);
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	// Заполнение поля КодВычетаЛичный в результате расчета будем делать с минимальным использованием СУБД,
	// для чего выгрузим ВТВычетыНаДетейИЛичные в таблицу значений, проиндексируем ее и будем искать в ней личные вычеты.
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ПравоНаЛичныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПравоНаЛичныеВычеты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПравоНаЛичныеВычеты.КодВычетаЛичный КАК КодВычета
	|ИЗ
	|	ВТВычетыНаДетейИЛичные КАК ПравоНаЛичныеВычеты
	|ГДЕ
	|	ПравоНаЛичныеВычеты.КодВычетаЛичный <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)";
	
	ЛичныеВычеты = Запрос.Выполнить().Выгрузить();
	ЛичныеВычеты.Индексы.Добавить(ПоляПоиска);
	СтруктураПоиска = Новый Структура(ПоляПоиска);
	
	СтрокиЛичныхВычетов = Новый Массив;
	Для Каждого СтрокаРезультат Из РезультатыРасчетов Цикл
		Если Не ЗначениеЗаполнено(СтрокаРезультат.КатегорияДохода) Тогда
			СтрокаРезультат.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда;
		КонецЕсли;
		Если ЗначениеЗаполнено(СтрокаРезультат.ПримененныйВычетЛичный) Тогда
			СтрокиЛичныхВычетов.Добавить(СтрокаРезультат);
			ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаРезультат);
			СтруктураПоиска.МесяцНалоговогоПериода = НачалоМесяца(СтруктураПоиска.МесяцНалоговогоПериода);
			НайденныеСтроки = ЛичныеВычеты.НайтиСтроки(СтруктураПоиска);
			Если НайденныеСтроки.Количество() > 0 Тогда
				СтрокаРезультат.КодВычетаЛичный = НайденныеСтроки[0].КодВычета;
			КонецЕсли;
			Если Не ЗначениеЗаполнено(СтрокаРезультат.КодВычетаЛичный) Тогда
				Для каждого СтрокаВычетов Из СтандартныхВычетовРанее.НайтиСтроки(Новый Структура("ФизическоеЛицо",СтрокаРезультат.ФизическоеЛицо)) Цикл
					Если ЗначениеЗаполнено(СтрокаВычетов.КодВычетаЛичный) Тогда
						СтрокаРезультат.КодВычетаЛичный = СтрокаВычетов.КодВычетаЛичный;
						Прервать;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	Если СтрокиЛичныхВычетов.Количество() > 0 Тогда
		РезультатыРасчетов.Индексы.Добавить("ФизическоеЛицо, ПримененныйВычетЛичный");
		СтруктураПоиска = Новый Структура("ФизическоеЛицо, ПримененныйВычетЛичный", , 0);
		Для каждого СтрокаСВычетом Из СтрокиЛичныхВычетов Цикл
			СтруктураПоиска.ФизическоеЛицо = СтрокаСВычетом.ФизическоеЛицо;
			Для каждого СтрокаРезультат Из РезультатыРасчетов.НайтиСтроки(СтруктураПоиска) Цикл
				Если НачалоМесяца(СтрокаРезультат.МесяцНалоговогоПериода) = НачалоМесяца(СтрокаСВычетом.МесяцНалоговогоПериода) Тогда
					СтрокаРезультат.КодВычетаЛичный = СтрокаСВычетом.КодВычетаЛичный
				КонецЕсли;
			КонецЦикла;
		КонецЦикла;
	КонецЕсли;
	
	ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, УдаляемыеВТ);
	
	ВписатьВРезультатЗачтенныеАвансы(Регистратор, Организация, МесяцРасчета, РезультатыРасчетов, Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка13, "НалогПоСтавке13", "ЗачтеноАвансовыхПлатежейПоСтавке13", ИсключатьДоходыРегистратора, МенеджерВременныхТаблиц);
	
	Возврат РезультатыРасчетов;
	
КонецФункции

// АПК:581-вкл

Функция РассчитатьНалогПоПлоскойСтавке(ИсключаемыйРегистратор, Организация, МесяцРасчета, Знач СписокФизическихЛиц, Знач ПервыйМесяцНалоговогоПериода, Знач ПоследнийМесяцНалоговогоПериода, ОкончательныйРасчет, ДатаУдержанияИсчисленногоНалога, ДвиженияТекущегоРегистратора, ОграничиватьНалоговыйПериод = Ложь)
	
	// 0. Проверим, стОит ли вообще что-то считать: массив физ.лиц может быть пустым, либо доходы межрасчетного
	// регистратора могут быть нулевыми. В обоих случаях результатом расчетов окажется пустая таблица.
	Если Не ЗначениеЗаполнено(СписокФизическихЛиц) Тогда
		Возврат ТаблицаНДФЛ()
	КонецЕсли;
	ЕстьДвиженияТекущегоРегистратораПоДоходам = ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "СведенияОДоходахНДФЛ");
	Если Не ОкончательныйРасчет И Не ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		Возврат ТаблицаНДФЛ()
	КонецЕсли;
	Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		ДоходыТекущегоРегистратора = ДвиженияТекущегоРегистратора.СведенияОДоходахНДФЛ.Выгрузить();
		Если Не ОкончательныйРасчет Тогда
			ТаблицаДоходовТекущегоРегистратора = ДоходыТекущегоРегистратора.Скопировать(ДоходыТекущегоРегистратора.НайтиСтроки(Новый Структура("Сторно, ЗарегистрированоПриНачисленииАванса", Ложь, '00010101')), "ФизическоеЛицо, СуммаДохода, СуммаВычета");
			Если СписокФизическихЛиц.Количество() = 1 Тогда
				Если ТаблицаДоходовТекущегоРегистратора.Итог("СуммаДохода") - ТаблицаДоходовТекущегоРегистратора.Итог("СуммаВычета") = 0 Тогда
					Возврат ТаблицаНДФЛ()
				КонецЕсли;
			Иначе
				ТаблицаДоходовТекущегоРегистратора.Свернуть("ФизическоеЛицо", "СуммаДохода, СуммаВычета");
				Для каждого ТекущаяСтрока Из ТаблицаДоходовТекущегоРегистратора Цикл
					Если ТекущаяСтрока.СуммаДохода - ТекущаяСтрока.СуммаВычета = 0 Тогда
						ОбщегоНазначенияКлиентСервер.УдалитьЗначениеИзМассива(СписокФизическихЛиц, ТекущаяСтрока.ФизическоеЛицо)
					КонецЕсли;		
				КонецЦикла;
				Если Не ЗначениеЗаполнено(СписокФизическихЛиц) Тогда
					Возврат ТаблицаНДФЛ()
				КонецЕсли;
			КонецЕсли;  
		КонецЕсли;
	КонецЕсли;
	
	ГоловнаяОрганизация = ЗарплатаКадры.ГоловнаяОрганизация(Организация);
	ЭтоРасчетПоДоходамТекущегоМесяца = ПервыйМесяцНалоговогоПериода = Неопределено Или ПоследнийМесяцНалоговогоПериода = Неопределено;
	НачалоМесяцаРасчета = НачалоМесяца(МесяцРасчета);
	КонецМесяцаРасчета = КонецМесяца(МесяцРасчета); 
	СоответствиеФизическихЛиц = ОбщегоНазначенияБЗККлиентСервер.МассивВСоответствие(СписокФизическихЛиц);
	МаксимальнаяДата = ЗарплатаКадрыПериодическиеРегистры.МаксимальнаяДата();

	ПоляПоиска = "ФизическоеЛицо, МесяцНалоговогоПериода";
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ГоловнаяОрганизация);
	Запрос.УстановитьПараметр("НачалоМесяцаРасчета", НачалоМесяцаРасчета);
	Запрос.УстановитьПараметр("КонецМесяцаРасчета", КонецМесяцаРасчета);
	Запрос.УстановитьПараметр("СписокФизическихЛиц", СписокФизическихЛиц);
	Запрос.УстановитьПараметр("ИсключаемыйРегистратор", ИсключаемыйРегистратор);
	
	// 1.	Определим минимальные и максимальные периоды расчета в целом по всем физическим лицам
	//	Если на вход переданы первый и последний месяцы налогового периода (заказан перерасчет конкретного периода) - ничего не делаем.
	//	Среди записей регистра СведенияОДоходахНДФЛ, зарегистрированных в месяце расчета, получим минимальное и максимальное значение поля МесяцНалоговогоПериода
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		
		ПервыйМесяцНалоговогоПериода = МаксимальнаяДата;
		ПоследнийМесяцНалоговогоПериода = '00010101';
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	МАКСИМУМ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК ПоследнийМесяцНалоговогоПериода,
		|	МИНИМУМ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК ПервыйМесяцНалоговогоПериода
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
		|	И СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода";
		Если ОкончательныйРасчет Тогда
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "И СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода", "");
		КонецЕсли;
		
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.ПервыйМесяцНалоговогоПериода) Тогда
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(Выборка.ПервыйМесяцНалоговогоПериода);
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(Выборка.ПоследнийМесяцНалоговогоПериода);
		КонецЕсли;
		
		Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
			
			ДоходыТекущегоРегистратора.Сортировать("МесяцНалоговогоПериода");
			
			Для Каждого ТекущаяСтрока Из ДоходыТекущегоРегистратора Цикл
				Если ТекущаяСтрока.МесяцНалоговогоПериода >= ПервыйМесяцНалоговогоПериода Тогда
					Прервать;
				КонецЕсли;
				Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] = Истина
					И ТекущаяСтрока.ГоловнаяОрганизация = ГоловнаяОрганизация
					И ТекущаяСтрока.Период >= НачалоМесяцаРасчета
					И ТекущаяСтрока.Период <= КонецМесяцаРасчета	
					И (ОкончательныйРасчет Или ТекущаяСтрока.ДоходМежрасчетногоПериода)	Тогда
					
					ПервыйМесяцНалоговогоПериода = НачалоМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
					Прервать;
				КонецЕсли;		 			
			КонецЦикла;	 
			Для Сч = 1 По ДоходыТекущегоРегистратора.Количество() Цикл
				ТекущаяСтрока = ДоходыТекущегоРегистратора[ДоходыТекущегоРегистратора.Количество() - Сч];
				Если ТекущаяСтрока.МесяцНалоговогоПериода <= ПоследнийМесяцНалоговогоПериода Тогда
					Прервать;
				КонецЕсли;
				Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] = Истина
					И ТекущаяСтрока.ГоловнаяОрганизация = ГоловнаяОрганизация
					И ТекущаяСтрока.Период >= НачалоМесяцаРасчета
					И ТекущаяСтрока.Период <= КонецМесяцаРасчета	
					И (ОкончательныйРасчет Или ТекущаяСтрока.ДоходМежрасчетногоПериода)	Тогда
					
					ПоследнийМесяцНалоговогоПериода = КонецМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
					Прервать;
				КонецЕсли;	
			КонецЦикла;
			
		КонецЕсли;
		
		Если ПоследнийМесяцНалоговогоПериода = '00010101' Тогда
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета);
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(МесяцРасчета);
		КонецЕсли;	
		
	КонецЕсли;
	
	Если ОграничиватьНалоговыйПериод Тогда
		
		ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале().НачалоРасчетаНДФЛПоПрогрессивнойШкале;

		Если ПервыйМесяцНалоговогоПериода >= ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале Тогда
			Возврат ТаблицаНДФЛ()
		КонецЕсли;
		ПоследнийМесяцНалоговогоПериода = Мин(ПоследнийМесяцНалоговогоПериода, ДобавитьМесяц(ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале, -1))
		
	КонецЕсли;

	// В случае расчета за 2015 и предыдущие годы будем использовать архивный вариант алгоритма.
	Если ПервыйМесяцНалоговогоПериода < КонецГода(УчетНДФЛ.ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев()) Тогда
		
		МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		Если ДвиженияТекущегоРегистратора <> Неопределено Тогда
			Если ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "СведенияОДоходахНДФЛ") Тогда
				ЗарплатаКадры.СоздатьВТПоНаборуЗаписей(МенеджерВременныхТаблиц, ДвиженияТекущегоРегистратора.СведенияОДоходахНДФЛ);
			КонецЕсли;	
			Если ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "АвансовыеПлатежиИностранцевПоНДФЛ") Тогда
				ЗарплатаКадры.СоздатьВТПоНаборуЗаписей(МенеджерВременныхТаблиц, ДвиженияТекущегоРегистратора.АвансовыеПлатежиИностранцевПоНДФЛ);
			КонецЕсли;	
			Если ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ИмущественныеВычетыНДФЛ") Тогда
				ЗарплатаКадры.СоздатьВТПоНаборуЗаписей(МенеджерВременныхТаблиц, ДвиженияТекущегоРегистратора.ИмущественныеВычетыНДФЛ);
			КонецЕсли;	
			Если ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ") Тогда
				ЗарплатаКадры.СоздатьВТПоНаборуЗаписей(МенеджерВременныхТаблиц, ДвиженияТекущегоРегистратора.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ, Истина);
			КонецЕсли;	
			Если ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "РасчетыНалогоплательщиковСБюджетомПоНДФЛ") Тогда
				ЗарплатаКадры.СоздатьВТПоНаборуЗаписей(МенеджерВременныхТаблиц, ДвиженияТекущегоРегистратора.РасчетыНалогоплательщиковСБюджетомПоНДФЛ);
			КонецЕсли;	
		КонецЕсли;
		ТаблицаФизическихЛиц = Новый ТаблицаЗначений;
		ТаблицаФизическихЛиц.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
		Для Каждого ТекущееФизическоеЛицо Из СписокФизическихЛиц Цикл
			СтрокаТЗ = ТаблицаФизическихЛиц.Добавить();
			СтрокаТЗ.ФизическоеЛицо = ТекущееФизическоеЛицо;
		КонецЦикла;	
		ТаблицаФизическихЛиц.Свернуть("ФизическоеЛицо");
		ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, ТаблицаФизическихЛиц, "ВТФизическиеЛица"); 
		
		Возврат	РассчитатьНалогДо2015Года(ИсключаемыйРегистратор, Организация, МесяцРасчета, МенеджерВременныхТаблиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода, Истина, ОкончательныйРасчет, ДатаУдержанияИсчисленногоНалога)
	КонецЕсли;
	
	// 2.	Получим ТЗ данные о доходах 
	//	Из регистра накоплений СведенияОДоходахНДФЛ получим записи, соответствующие условиям:
	//	- записи, зарегистрированные между началом года, предшествующего полученному на предыдущем шаге минимальному месяцу налогового периода, и окончанием месяца расчета
	//	- месяц налогового периода у записей между началом года месяца минимального налогового периода и концом месяца максимального налогового периода
	//	- доход облагается у налогового агента
	//	- ставка налогообложения дохода для налоговых резидентов РФ - 13%
	//	- для месяца расчета также пропускаем записи, зарегистрированные при начислении аванса
	//	При этом, в случае если выполняется промежуточный расчет и доход зарегистрирован в месяце расчета не для промежуточного расчета (ДоходМежрасчетногоПериода = Ложь), сумму дохода и сумму вычета будем считать равными 0  
	//	Затем добавим записи текущего набора доходов, применив к ним те же условия (уже на языке 1С), что и в запросе.
	
	НачалоПредшествующегоГода = ДобавитьМесяц(НачалоГода(ПервыйМесяцНалоговогоПериода), -12);;
	НачалоГодаПериодаРасчета = НачалоГода(ПервыйМесяцНалоговогоПериода);
	КонецПериодаРасчета = КонецМесяца(ПоследнийМесяцНалоговогоПериода);
	НачалоГодаРасчета = НачалоГода(МесяцРасчета); 
	
	Запрос.УстановитьПараметр("НачалоПредшествующегоГода", НачалоПредшествующегоГода);
	Запрос.УстановитьПараметр("НачалоГодаПериодаРасчета", НачалоГодаПериодаРасчета);
	Запрос.УстановитьПараметр("НачалоГодаРасчета", НачалоГодаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаРасчета", КонецПериодаРасчета);
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
	|	СведенияОДоходахНДФЛ.Период КАК Период,
	|	СведенияОДоходахНДФЛ.СтавкаНалогообложения КАК СтавкаНалогообложения,
	|	&ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
	|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
	|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК НалоговыйПериод,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
	|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
	|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
	|	КОНЕЦ КАК ДокументОснование,
	|	ЕСТЬNULL(СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам, ЛОЖЬ) КАК НеПредоставляетсяНерезидентам,
	|	СУММА(ВЫБОР
	|			КОГДА &ОкончательныйРасчетДоходы
	|				ТОГДА СведенияОДоходахНДФЛ.СуммаДохода
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК СуммаДохода,
	|	СУММА(ВЫБОР
	|			КОГДА &ОкончательныйРасчетДоходы
	|				ТОГДА СведенияОДоходахНДФЛ.СуммаВычета
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК СуммаВычета,
	|	ВЫБОР
	|		КОГДА &ОкончательныйРасчетДоходы
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ИспользоватьДляРаспределения,
	|	&УчитыватьПериодПриРасчете КАК УчитыватьПериодПриРасчете,
	|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор КАК ДоходТекущегоРасчета,
	|	СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса КАК ЗарегистрированоПриНачисленииАванса
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДокументыУчтенныеПриРасчетеНДФЛ КАК ДокументыУчтенныеПриРасчетеНДФЛ
	|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДокументыУчтенныеПриРасчетеНДФЛ.ФизическоеЛицо
	|			И СведенияОДоходахНДФЛ.Регистратор = ДокументыУчтенныеПриРасчетеНДФЛ.ДокументОснование
	|ГДЕ
	|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
	|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|	И СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|	И &УсловиеОблагаемостиУНалоговогоАгента
	|	И СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса < &УсловиеНаНачисленноеВАванс
	|
	|СГРУППИРОВАТЬ ПО
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД),
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.Подразделение,
	|	СведенияОДоходахНДФЛ.Период,
	|	СведенияОДоходахНДФЛ.СтавкаНалогообложения,
	|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам,
	|	СведенияОДоходахНДФЛ.КодВычета,
	|	СведенияОДоходахНДФЛ.КодДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.КатегорияДохода,
	|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
	|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
	|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
	|	КОНЕЦ,
	|	СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса
	|
	|ИМЕЮЩИЕ
	|	(СУММА(ВЫБОР
	|				КОГДА &ОкончательныйРасчетДоходы
	|					ТОГДА СведенияОДоходахНДФЛ.СуммаДохода
	|				ИНАЧЕ 0
	|			КОНЕЦ) <> 0
	|		ИЛИ СУММА(ВЫБОР
	|				КОГДА &ОкончательныйРасчетДоходы
	|					ТОГДА СведенияОДоходахНДФЛ.СуммаВычета
	|				ИНАЧЕ 0
	|			КОНЕЦ) <> 0)";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "УсловиеНаНачисленноеВАванс", ?(ЭтоРасчетПоДоходамТекущегоМесяца, "НачалоМесяцаРасчета", "КонецМесяцаРасчета"));
	Если ОкончательныйРасчет Тогда
		Если Не ЭтоРасчетПоДоходамТекущегоМесяца Тогда
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.Период КАК Период", "&НачалоГодаРасчета КАК Период");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.Период,", "");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", "ЛОЖЬ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода", "ЛОЖЬ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", "Истина");
		Иначе 	
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", 
			"ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
			|			ТОГДА ЛОЖЬ
			|		ИНАЧЕ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
			|	КОНЕЦ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", "СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета");
		КонецЕсли;
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетДоходы", "Истина");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", 
		"ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
		|	КОНЕЦ");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", 
		"&ОкончательныйРасчетДоходы
		|				И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета)");
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетДоходы", 
		"(СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
		|					ИЛИ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
		|						И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))");
	КонецЕсли;
	ДанныеУчетаДоходов = Запрос.Выполнить().Выгрузить();
	
	МесяцыНачисленияЗарплаты = Новый Соответствие; 
	Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		// Определим месяцы, за которые начисляется з/пл в текущем расчете - по полю период.
		Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
			МесяцыНачисленияЗарплаты.Вставить(МесяцРасчета, Истина);
		КонецЕсли;
		ДоходыТекущегоРегистратора.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, Подразделение, Период, СтавкаНалогообложения, ДоходМежрасчетногоПериода, ИсточникДоходаЗаПределамиРФ, КодВычета, КодДохода, КатегорияДохода, Сторно, ЗарегистрированоПриНачисленииАванса", "СуммаДохода, СуммаВычета");
		СтавкаРезидента13 = Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка13;
		Для Каждого ТекущаяСтрока Из ДоходыТекущегоРегистратора Цикл
			Если ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;
			КонецЕсли;
			Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] = Истина
				И ТекущаяСтрока.КодДохода.СтавкаНалогообложенияРезидента = СтавкаРезидента13
				И УчетНДФЛ.ДоходОблагаетсяУНалоговогоАгента(ТекущаяСтрока.КодДохода, ТекущаяСтрока.ДатаПолученияДохода) Тогда
							
				НоваяСтрока = ДанныеУчетаДоходов.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
				НоваяСтрока.ДокументОснование = ИсключаемыйРегистратор;
				НоваяСтрока.НеПредоставляетсяНерезидентам = ТекущаяСтрока.КодВычета.НеПредоставляетсяНерезидентам;
				НоваяСтрока.СтавкаНалогообложенияРезидента = СтавкаРезидента13;
				НоваяСтрока.НалоговыйПериод = НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода);
				НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(НоваяСтрока.МесяцНалоговогоПериода);
				НоваяСтрока.УчитыватьПериодПриРасчете = НоваяСтрока.Период >= НачалоГодаРасчета И НоваяСтрока.Период <= КонецМесяцаРасчета;	
				НоваяСтрока.ДоходТекущегоРасчета = Не ТекущаяСтрока.Сторно;	
				НоваяСтрока.ИспользоватьДляРаспределения = Истина;
				МесяцыНачисленияЗарплаты.Вставить(НачалоМесяца(ТекущаяСтрока.Период), Истина);
			КонецЕсли;			
		КонецЦикла;	
	КонецЕсли;	
	НеучтенныеРанееОснования = ДанныеУчетаДоходов.Скопировать(Новый Структура("ДоходТекущегоРасчета", Истина), "ФизическоеЛицо, ДокументОснование");
	НеучтенныеРанееОснования.Свернуть("ФизическоеЛицо, ДокументОснование");
	НеучтенныеРанееОснования.Индексы.Добавить("ФизическоеЛицо");
	ДанныеУчетаДоходов.Сортировать("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода", Новый СравнениеЗначений);
	МесяцыНачисленияЗарплатыВЗапрос = Новый Массив;
	Для каждого Элемент Из МесяцыНачисленияЗарплаты Цикл
		МесяцыНачисленияЗарплатыВЗапрос.Добавить(Элемент.Ключ)
	КонецЦикла;
	Запрос.УстановитьПараметр("МесяцыНачисленияЗарплаты", МесяцыНачисленияЗарплатыВЗапрос);
	
	// 3.	Определим минимальные и максимальные месяцы налогового периода по физическим лицам. Результат работы метода - таблица значений (ПериодыРасчетаПоФизическимЛицам)
	ПериодыРасчетаПоФизическимЛицам = Новый ТаблицаЗначений;
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("НачалоГодаНалоговогоПериода", Новый ОписаниеТипов("Дата"));
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("ПоследнийМесяцНалоговогоПериода", Новый ОписаниеТипов("Дата"));
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		//	Среди записей о доходах, полученных на предыдущем шаге, отбираем строки к осмотру по условиям (ранее рассчитано в поле УчитыватьПериодПриРасчете):  
		//	- запись зарегистрирована между началом года месяца расчета и концом месяца расчета
		//	- если выполняется промежуточный расчет, доход зарегистрирован раньше месяца расчета, а в месяце расчета только промежуточного расчета (ДоходМежрасчетногоПериода = Истина)
		//	Минимальная дата (НачалоГодаНалоговогоПериода): если запись зарегистрирована в месяце расчета, возьмем начало года месяца налогового периода этой записи, 
		//		если зарегистрирована в предыдущих месяцах, возьмем начало года от месяца расчета.
		//	Максимальная дата (ПоследнийМесяцНалоговогоПериода): максимальный месяц налогового периода 
		
		// Дополнительно избавимся от "лишних" строк доходов, зарегистрированных начислениями авансов. 
		
		СтрокиКУдалению = Новый Соответствие;
		ТекущееФизическоеЛицо = Неопределено;
		Для Каждого СтрокаТаблицыДоходов Из ДанныеУчетаДоходов Цикл
			Если МесяцыНачисленияЗарплаты[СтрокаТаблицыДоходов.ЗарегистрированоПриНачисленииАванса] <> Неопределено Тогда
				СтрокиКУдалению.Вставить(СтрокаТаблицыДоходов);
				Продолжить;
			КонецЕсли;
			Если СтрокаТаблицыДоходов.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда  
				СтрокаПериодовПоФизическомуЛицу = ПериодыРасчетаПоФизическимЛицам.Добавить();
				СтрокаПериодовПоФизическомуЛицу.ФизическоеЛицо = СтрокаТаблицыДоходов.ФизическоеЛицо;
				СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода = МаксимальнаяДата;
				
				ТекущееФизическоеЛицо = СтрокаПериодовПоФизическомуЛицу.ФизическоеЛицо; 
			КонецЕсли;
			Если СтрокаТаблицыДоходов.УчитыватьПериодПриРасчете Тогда
				СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода = Мин(?(НачалоМесяца(СтрокаТаблицыДоходов.Период) = НачалоМесяцаРасчета, СтрокаТаблицыДоходов.НалоговыйПериод, НачалоГодаРасчета), СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода);
				СтрокаПериодовПоФизическомуЛицу.ПоследнийМесяцНалоговогоПериода = Макс(СтрокаТаблицыДоходов.МесяцНалоговогоПериода, СтрокаПериодовПоФизическомуЛицу.ПоследнийМесяцНалоговогоПериода);
			КонецЕсли;	
		КонецЦикла;	
		Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
			ДанныеУчетаДоходов.Удалить(УдаляемаяСтрока.Ключ);		
		КонецЦикла;	
	Иначе
		// В случае если расчет выполняется не по доходам текущего месяца, в качестве НачалоГодаНалоговогоПериода будем
		// использовать начала года первого месяца периода, переданного на вход алгоритма расчета, в качестве
		// ПоследнийМесяцНалоговогоПериода - первый день месяца окончания периода, переданного на вход алгоритма расчета
		НачалоПоследнегоМесяцаНалоговогоПериода = НачалоМесяца(ПоследнийМесяцНалоговогоПериода);
		Для Каждого ТекущееФизическоеЛицо Из СписокФизическихЛиц Цикл
			СтрокаТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.Добавить();
			СтрокаТаблицыПериодов.ФизическоеЛицо = ТекущееФизическоеЛицо;
			СтрокаТаблицыПериодов.НачалоГодаНалоговогоПериода = НачалоГодаПериодаРасчета;
			СтрокаТаблицыПериодов.ПоследнийМесяцНалоговогоПериода = НачалоПоследнегоМесяцаНалоговогоПериода;
		КонецЦикла;	
	КонецЕсли;	
	ПериодыРасчетаПоФизическимЛицам.Индексы.Добавить("ФизическоеЛицо");

	// 4.	Получим данные о статусе налогоплательщиков физических лиц (ТЗ СтатусыФизическихЛиц) из регистра сведений СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.
	//	Вход: список физических лиц,  ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода
	//	Выход: таблица значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, Статус, РезидентРФНаКонецМесяца, ПрименяетсяСтавкаПункта1Статьи224НК, РезидентРФНаКонецГода, СтатусНаКонецГода
	//			таблица индексирована по колонке ФизическоеЛицо 
	//	Описание алгоритма: 
	//		Читаем записи регистра СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный с отбором по списку физических лиц, действующие на начало года минимального месяца расчета, а также зарегистрированные между началом года минимального месяца расчета и концом максимального месяца расчета
	//		Применим отбор по списку физических лиц 
	СтатусыФизическихЛиц = СтатусыФизическихЛиц(СписокФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода);	

	// 5.	Для каждой строки полученных ранее данных учета доходов определим 
	//	- Ставку налогообложения (СтавкаЧислом)
	//	- Рассчитывать ли доход нарастающим итогом (ИсчислятьНалогНарастающимИтогом)
	//	- Сумму дохода за минусом вычета (ДоходыБезВычетов)
	//	- Сумму, используемую как коэффициент при распределении результатов расчета по подразделениям и категориям доходов (БазаРаспределения)
	//		... равна сумме дохода без вычета, для всех строк, если выполняется окончательный расчет, или для строк доходов, зарегистрированных для промежуточного расчета, и для всех строк, зарегистрированных раньше месяца расчета.
	ДополнитьДанныеУчетаСтавками(ДанныеУчетаДоходов, "УчитыватьИзмененияСтатусаДляРасчета", , СтатусыФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода);		
	ДанныеУчетаДоходов.Колонки.Добавить("ДоходыБезВычетов", Новый ОписаниеТипов("Число"));
	ДанныеУчетаДоходов.Колонки.Добавить("БазаРаспределения", Новый ОписаниеТипов("Число"));
	СтрокиКУдалению = Новый Соответствие;
	Для Каждого СтрокаТаблицыДоходов Из ДанныеУчетаДоходов Цикл
		Если СтрокаТаблицыДоходов.РезидентРФвНалоговомПериоде Или Не СтрокаТаблицыДоходов.ИсточникДоходаЗаПределамиРФ Тогда
			Если СтрокаТаблицыДоходов.ИсточникДоходаЗаПределамиРФ Тогда
				УчитыватьВычет = СтрокаТаблицыДоходов.УчитыватьВычетыКДоходамОтИсточникаВнеРФ;
			Иначе 
				УчитыватьВычет = СтрокаТаблицыДоходов.УчитыватьВсеВычетыКДоходамОтИсточникаРФ Или Не СтрокаТаблицыДоходов.НеПредоставляетсяНерезидентам 
			КонецЕсли;
			СтрокаТаблицыДоходов.ДоходыБезВычетов = СтрокаТаблицыДоходов.СуммаДохода - ?(УчитыватьВычет, СтрокаТаблицыДоходов.СуммаВычета, 0);
			Если СтрокаТаблицыДоходов.ИспользоватьДляРаспределения Тогда
				СтрокаТаблицыДоходов.БазаРаспределения = СтрокаТаблицыДоходов.ДоходыБезВычетов;
			КонецЕсли;				
		Иначе
			СтрокиКУдалению.Вставить(СтрокаТаблицыДоходов)
		КонецЕсли;
	КонецЦикла;
	Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
		ДанныеУчетаДоходов.Удалить(УдаляемаяСтрока.Ключ);		
	КонецЦикла;	
	ДанныеУчетаДоходов.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КодДохода, Подразделение, СтавкаЧислом, ИсчислятьНалогНарастающимИтогом, Период, ДоходМежрасчетногоПериода, КатегорияДохода, ДоходТекущегоРасчета", "ДоходыБезВычетов, СуммаДохода, БазаРаспределения");
 	ДанныеУчетаДоходов.Колонки.СуммаДохода.Имя = "ВсеДоходы";
	
	// 6.	Поделим доходы на две части: для расчета налога нарастающим итогом и по каждой сумме дохода отдельно (абзацы первый и второй пункта 3 статьи 226 НК РФ)

	//	Для выделения доходов с расчетом налога по каждой сумме дохода отдельно из таблицы значений с данными учета доходов (где ранее рассчитана ставка налогообложения и признак расчета налога нарастающим итогом) 
	//	скопируем все строки с ИсчислятьНалогНарастающимИтогом = Ложь
	ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно = ДанныеУчетаДоходов.Скопировать(Новый Структура("ИсчислятьНалогНарастающимИтогом", Ложь));	
	//	Под "каждой суммой", для которой будем исчислять налог, понимаем сумму доходов физ.лица в одну дату получения дохода, по одному коду дохода, подразделению, категории, начисленную по отдельному основанию.
	ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, Подразделение, КатегорияДохода, СтавкаЧислом, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", "ДоходыБезВычетов");

	// В основной таблице оставим только доходы, по которым налог исчисляется нарастающим итогом.
	СоответствиеНерезидентов = Новый Соответствие;
	СтрокОтдельныхСумм = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Количество();
	Если СтрокОтдельныхСумм > 0 Тогда
		
		ДанныеУчетаДоходов = ДанныеУчетаДоходов.Скопировать(Новый Структура("ИсчислятьНалогНарастающимИтогом", Истина));
		
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Индексы.Добавить(ПоляПоиска);
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Сортировать(ПоляПоиска, Новый СравнениеЗначений);
		
		СтрокиКУдалению = Новый Соответствие;
		ТекущееФизическоеЛицо = Неопределено; 
		ИндексОбрабатываемойСтроки = 0;
		Пока ИндексОбрабатываемойСтроки <= СтрокОтдельныхСумм - 1 Цикл
			
			ТекущаяСтрока = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно[ИндексОбрабатываемойСтроки];
			ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
			Если ТекущаяСтрока.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда // Начало обработки очередного физлица.
				ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо; 
				МесяцНачала = '00010101'; МесяцОкончания = '00010101';
				СтрокиТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.НайтиСтроки(Новый Структура("ФизическоеЛицо", ТекущееФизическоеЛицо));
				Если СтрокиТаблицыПериодов.Количество() > 0 Тогда
					МесяцНачала = СтрокиТаблицыПериодов[0].НачалоГодаНалоговогоПериода;
					МесяцОкончания = СтрокиТаблицыПериодов[0].ПоследнийМесяцНалоговогоПериода;
				КонецЕсли;
			КонецЕсли;	
			Если Не (ТекущаяСтрока.МесяцНалоговогоПериода >= МесяцНачала И ТекущаяСтрока.МесяцНалоговогоПериода <= МесяцОкончания) Тогда
				СтрокиКУдалению.Вставить(ТекущаяСтрока);
			КонецЕсли;	
			
		КонецЦикла;
		Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
			ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Удалить(УдаляемаяСтрока.Ключ);		
		КонецЦикла;	
		
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Индексы.Добавить("ФизическоеЛицо, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода");
		СоответствиеНерезидентов = ОбщегоНазначенияБЗККлиентСервер.МассивВСоответствие(ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.ВыгрузитьКолонку("ФизическоеЛицо"));
		
	КонецЕсли;
	
	РассчитыватьНалогНарастающимИтогом = ДанныеУчетаДоходов.Количество() > 0;
	
	// данные о праве на вычеты будем читать только при наличии резидентов
	Если РассчитыватьНалогНарастающимИтогом Тогда 
		
		// 7.	Получим таблицу с данными для распределения результатов расчета по подразделениям и категориям
		//	Из таблицы значений с данными учета доходов с дополнительно рассчитанной на предыдущем шаге колонкой БазаРаспределения
		//	копированием получаем новую таблицу значений, данные которой сгруппированы по полям 
		//	ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета
		ДоходыПоПодразделениямИКатегориям = ДанныеУчетаДоходов.Скопировать(, "ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета, ДоходыБезВычетов, БазаРаспределения");
		ДоходыПоПодразделениямИКатегориям.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета", "ДоходыБезВычетов, БазаРаспределения");
		ДоходыПоПодразделениямИКатегориям.Колонки.ДоходыБезВычетов.Имя = "СуммаДоходаТекущегоРасчета"; 
		ДоходыПоПодразделениямИКатегориям.Колонки.БазаРаспределения.Имя = "СуммаДохода"; 
		ДоходыПоПодразделениямИКатегориям.Индексы.Добавить("ФизическоеЛицо");
		
		// 8.	Дополним таблицу значений с данными учета доходов итогами по месяцам и датам получения дохода, в том числе нарастающим итогом с начала года. 
		//		В результате в таблице должно получиться как минимум по одной строке на каждый месяц, по которому выполняется расчет по физическому лицу. 
		//	В таблице данных учета оставляем колонки ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода, ДоходыБезВычетов, ВсеДоходы, БазаРаспределения
		//	и добавляем:
		//	- ОблагаемыйДоход - облагаемый доход нарастающим итогом с начала месяца этой даты по дату получения дохода из строки таблицы, причем строка с ДоходМежрасчетногоПериода = Истина предшествует строке "окончательного расчета" той же даты и не включает доход "окончательного расчета".
		//	- ОблагаемыйДоходНарастающимИтогом - облагаемый доход на конец месяца нарастающим итогом с начала года, заполняется только для первой строки за месяц.
		//	- ОблагаемыйДоходЗаМесяц - облагаемый доход месяца (доход - вычеты к доходам), заполняется только для первой строки за месяц.
		//	- ВсеДоходыЗаМесяц - сумма доходов месяца (без учета вычетов), служит флажком наличия доходов, заполняется только для первой строки за месяц.
		//	- СтаршийМесяцПолученияДохода - наибольший месяц налогового периода, за который имеется положительный доход (без учета вычетов), служит ограничением для расчета вычетов, заполняется только для первой строки за месяц.
		//	Для последующего удобства обхода таблицы добавляем признаки первой и последней строки по физическому лицу, налоговому периоду, месяцу налогового периода и дате получения дохода.
		ДанныеУчетаДоходов.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода", "ДоходыБезВычетов, ВсеДоходы");	
		ДанныеУчетаДоходов.Сортировать("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода УБЫВ", Новый СравнениеЗначений);
		
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоход", Новый ОписаниеТипов("Число")); 
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоходНарастающимИтогом", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоходЗаМесяц", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("ВсеДоходыЗаМесяц", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("СтаршийМесяцПолученияДохода", Новый ОписаниеТипов("Дата"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаДату", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаМесяц", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаГод", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаПоФизическомуЛицу", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаДату", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаМесяц", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаГод", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаПоФизическомуЛицу", Новый ОписаниеТипов("Булево"));
		
		//	Описание алгоритма:
		//	В результирующей таблице (для экономии памяти, модифицируем входную таблицу с доходами) будут строки на каждую дату получения дохода, причем если на дату зарегистрирован 
		//	доход для промежуточного и для окончательно расчета, на дату будет две строки с разными значениями ДоходМежрасчетногоПериода. 
		//	Если облагаемый доход нарастающим итогом с начала месяца по дату получения дохода равен 0 и эта строка не является последней за месяц, то не будем оставлять ее в таблице.
		//	Если за месяц, входящий в период расчета по физическому лицу, вообще не было зарегистрировано доходов, то добавим строку с датой получения дохода, равной концу месяца.
		//	При расчете поля ОблагаемыйДоход (доход нарастающим итогом с начала месяца этой даты по дату получения дохода):
		//		если в строке отражен доход межрасчетного периода (ДоходМежрасчетногоПериода = Истина), возьмем все доходы за предыдущие даты месяца и доход текущей строки
		//		если в строке отражен доход окончательного расчета (ДоходМежрасчетногоПериода = Ложь), возьмем все доходы за предыдущие даты месяца и все доходы за текущую дату
		//	Алгоритм реализуется оптимальным образом за счет сортировки предварительно свернутой таблицы с данными учета доходов  по полям ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода (по убыванию)  
		СтрокиКУдалению = Новый Соответствие;
		ИндексОбрабатываемойСтроки = 0;
		Пока ИндексОбрабатываемойСтроки <= ДанныеУчетаДоходов.Количество() - 1 Цикл
			
			СтрокиПоФизическомуЛицу = Новый Массив;
			ПервыеСтрокиМесяцев = Новый Массив;
			ТекущаяСтрока = ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки];
			ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо;
			
			МесяцНачала = '00010101';
			МесяцОкончания = '00010101';
			СтрокиТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.НайтиСтроки(Новый Структура("ФизическоеЛицо", ТекущееФизическоеЛицо));
			Если СтрокиТаблицыПериодов.Количество() > 0 Тогда
				МесяцНачала = СтрокиТаблицыПериодов[0].НачалоГодаНалоговогоПериода;
				МесяцОкончания = СтрокиТаблицыПериодов[0].ПоследнийМесяцНалоговогоПериода;
			КонецЕсли;
			
			ПоследнийОбработанныйМесяц = ТекущаяСтрока.МесяцНалоговогоПериода;
			ПоследнийМесяцДополнения = Мин(НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода), МесяцОкончания);
			ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, МесяцНачала, ПоследнийМесяцДополнения, ИндексОбрабатываемойСтроки);	
			
			ПредыдущаяСтрока = Неопределено;
			ПредыдущийНалоговыйПериод = Неопределено;
			Пока ИндексОбрабатываемойСтроки <= ДанныеУчетаДоходов.Количество() - 1 И ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки].ФизическоеЛицо = ТекущееФизическоеЛицо Цикл
				
				ТекущаяСтрока = ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки];
				ТекущийМесяцНалоговогоПериода = ТекущаяСтрока.МесяцНалоговогоПериода;
				
				Если Не (ТекущийМесяцНалоговогоПериода >= МесяцНачала И ТекущийМесяцНалоговогоПериода <= МесяцОкончания) Тогда
					ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
					СтрокиКУдалению.Вставить(ТекущаяСтрока);
					Продолжить;
				КонецЕсли;	
				
				УдалятьТекущуюСтроку = Ложь;
				ТекущийНалоговыйПериод = НачалоГода(ТекущийМесяцНалоговогоПериода);
				
				Если ТекущийНалоговыйПериод <> ПредыдущийНалоговыйПериод Или ПредыдущаяСтрока = Неопределено Тогда	
					
					Если ПредыдущаяСтрока <> Неопределено Тогда
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаГод = Истина;
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаМесяц = Истина;
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
						РассчитатьСтаршийМесяцПолученияДохода(ПервыеСтрокиМесяцев);
					КонецЕсли;	
					
					ПоследнийМесяцДополнения = Мин(ТекущийМесяцНалоговогоПериода, МесяцОкончания);
					ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод, ПоследнийМесяцДополнения, ИндексОбрабатываемойСтроки);			
					
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаГод = Месяц(ТекущийМесяцНалоговогоПериода) = 1;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаМесяц = Истина;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
					
					ОблагаемыйДоход = 0;
					ОблагаемыйДоходНарастающимИтогомЗаГод = 0;
					ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
					ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
					ПредыдущийНалоговыйПериод = ТекущийНалоговыйПериод;
					
				ИначеЕсли ТекущийМесяцНалоговогоПериода <> ПредыдущаяСтрока.МесяцНалоговогоПериода Тогда 			
					
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаМесяц = Истина;
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
					
					ПоследнийМесяцДополнения = Мин(ТекущийМесяцНалоговогоПериода, МесяцОкончания);
					ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, ДобавитьМесяц(ПредыдущаяСтрока.МесяцНалоговогоПериода, 1), ТекущийМесяцНалоговогоПериода, ИндексОбрабатываемойСтроки, ОблагаемыйДоходНарастающимИтогомЗаГод);
					
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаМесяц = Истина;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
					
					ОблагаемыйДоход = 0;		
					ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
					ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
					
				ИначеЕсли ТекущаяСтрока.ДатаПолученияДохода <> ПредыдущаяСтрока.ДатаПолученияДохода Тогда
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
					// Если на предыдущую дату доход нарастающим итогом с начала месяца равен 0, то соответствующая строка не нужна: в
					// месяце есть еще строки
					Если ПредыдущаяСтрока.ОблагаемыйДоход = 0 Тогда
						ЗаполнитьЗначенияСвойств(ТекущаяСтрока, ПредыдущаяСтрока, "ЭтоПерваяСтрокаПоФизическомуЛицу, ЭтоПерваяСтрокаЗаГод, ЭтоПерваяСтрокаЗаМесяц, ОблагаемыйДоходЗаМесяц, ВсеДоходыЗаМесяц");								
						СтрокиКУдалению.Вставить(ПредыдущаяСтрока);	
						СтрокиПоФизическомуЛицу.Удалить(СтрокиПоФизическомуЛицу.Количество() - 1);
						Если ПредыдущаяСтрока.ЭтоПерваяСтрокаЗаМесяц Тогда
							ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
							ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
						КонецЕсли;	
					КонецЕсли;		
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
				ИначеЕсли ОблагаемыйДоход + ТекущаяСтрока.ДоходыБезВычетов = 0 Тогда 
					УдалятьТекущуюСтроку = Истина;
				КонецЕсли;	
				
				ОблагаемыйДоход = ОблагаемыйДоход + ТекущаяСтрока.ДоходыБезВычетов;
				ОблагаемыйДоходНарастающимИтогомЗаГод = ОблагаемыйДоходНарастающимИтогомЗаГод + ТекущаяСтрока.ДоходыБезВычетов;
				ТекущаяСтрока.ОблагаемыйДоход = ОблагаемыйДоход;	
				ПерваяСтрокаЗаМесяц.ОблагаемыйДоходЗаМесяц = ПерваяСтрокаЗаМесяц.ОблагаемыйДоходЗаМесяц + ТекущаяСтрока.ДоходыБезВычетов;
				ПерваяСтрокаЗаМесяц.ВсеДоходыЗаМесяц = ПерваяСтрокаЗаМесяц.ВсеДоходыЗаМесяц + ТекущаяСтрока.ВсеДоходы;
				ПерваяСтрокаЗаМесяц.ОблагаемыйДоходНарастающимИтогом = ОблагаемыйДоходНарастающимИтогомЗаГод;
				
				ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
				
				Если УдалятьТекущуюСтроку Тогда
					СтрокиКУдалению.Вставить(ТекущаяСтрока);
				Иначе	
					ПредыдущаяСтрока = ТекущаяСтрока;
					СтрокиПоФизическомуЛицу.Добавить(ТекущаяСтрока);
				КонецЕсли;	
			КонецЦикла;	// по физ.лицу                        
			
			Если СтрокиПоФизическомуЛицу.Количество() > 0 Тогда
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаПоФизическомуЛицу = Истина;	
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаГод = Истина;
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаМесяц = Истина;
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаДату = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаПоФизическомуЛицу = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаГод = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаМесяц = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаДату = Истина;
				РассчитатьСтаршийМесяцПолученияДохода(ПервыеСтрокиМесяцев);
			КонецЕсли;	
			
		КонецЦикла;		
		Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
			ДанныеУчетаДоходов.Удалить(УдаляемаяСтрока.Ключ);		
		КонецЦикла;	
		
		// 9.	Получим доходы с предыдущего места работы
		//	Читаем регистр ДоходыПредыдущегоМестаРаботыНДФЛ с отбором по списку физических лиц, головной организации для всех месяцев периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, Размер
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.ФизическоеЛицо,
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.МесяцНалоговогоПериода,
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.Размер
		|ИЗ
		|	РегистрСведений.ДоходыПредыдущегоМестаРаботыНДФЛ КАК ДоходыПредыдущегоМестаРаботыНДФЛ
		|ГДЕ
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.ФизическоеЛицо В (&СписокФизическихЛиц)
		|	И ДоходыПредыдущегоМестаРаботыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ДоходыПредыдущегоМестаРаботыНДФЛ.МесяцНалоговогоПериода
		|		МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета";
		ДоходыСПредыдущегоМестаРаботы = Запрос.Выполнить().Выгрузить();
		ДоходыСПредыдущегоМестаРаботы.Индексы.Добавить(ПоляПоиска);
		
		// Признак из учетной политики, определяющий порядок накопления сумм стандартных вычетов. 
		ПрименятьСтандартныеВычетыНарастающимИтогом = Истина;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	УчетнаяПолитикаПоНДФЛ.ОсобенностиИсчисленияНДФЛ КАК ОсобенностиИсчисленияНДФЛ
		|ИЗ
		|	РегистрСведений.УчетнаяПолитикаПоНДФЛ КАК УчетнаяПолитикаПоНДФЛ
		|ГДЕ
		|	УчетнаяПолитикаПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация";
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ПрименятьСтандартныеВычетыНарастающимИтогом = Выборка.ОсобенностиИсчисленияНДФЛ = Перечисления.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом;
		КонецЕсли;
		
		// 10.	Информация о правах на стандартные вычеты
		//	Читаем из регистра СтандартныеВычетыПоНДФЛВторичный записи с отбором по списку физических лиц, действующие (определяем по ДатаНачала) на начало года первого месяца 
		//	налогового периода расчета или зарегистрированные между началом года первого месяца налогового периода расчета и последним месяцем налогового периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, ПериодРегистрацииНачало, ПериодРегистрацииОкончание, КодВычета, ЛичныйВычет, Количество.
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ВычетыНаДетей.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ВычетыНаДетей.ДатаНачала КАК ДатаНачала,
		|	ВычетыНаДетей.ДатаОкончания КАК ДатаОкончания,
		|	ВычетыНаДетей.ПериодРегистрацииНачало КАК ПериодРегистрацииНачало,
		|	ВычетыНаДетей.ПериодРегистрацииОкончание КАК ПериодРегистрацииОкончание,
		|	ВычетыНаДетей.КодВычета КАК КодВычета,
		|	ВычетыНаДетей.ЛичныйВычет КАК ЛичныйВычет,
		|	ВычетыНаДетей.Количество КАК Количество
		|ИЗ
		|	РегистрСведений.СтандартныеВычетыПоНДФЛВторичный КАК ВычетыНаДетей
		|ГДЕ
		|	ВычетыНаДетей.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И (&НачалоГодаПериодаРасчета МЕЖДУ ВычетыНаДетей.ДатаНачала И ВычетыНаДетей.ДатаОкончания
		|			ИЛИ ВычетыНаДетей.ДатаНачала МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
		|	И (НЕ ВычетыНаДетей.ЛичныйВычет
		|			ИЛИ ВычетыНаДетей.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))";
		ВычетыНаДетейИЛичные = Запрос.Выполнить().Выгрузить();
		ВычетыНаДетейИЛичные.Индексы.Добавить("ФизическоеЛицо"); 
		
		// 11.	Получим информацию о применении вычетов по физическим лицам в организации, для которой ведется расчет налога.
		//	Читаем записи регистра ПрименениеСтандартныхВычетовПоНДФЛВторичный по списку физических лиц и головной организации, действующие (определяем по ДатаНачала) на начало года первого месяца 
		//	налогового периода расчета или зарегистрированные между началом года первого месяца налогового периода расчета и последним месяцем налогового периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, ПрименятьВычеты
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала КАК ДатаНачала,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаОкончания КАК ДатаОкончания,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ПрименятьВычеты КАК ПрименятьВычеты
		|ИЗ
		|	РегистрСведений.ПрименениеСтандартныхВычетовПоНДФЛВторичный КАК ПрименениеСтандартныхВычетовПоНДФЛВторичный
		|ГДЕ
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И ПрименениеСтандартныхВычетовПоНДФЛВторичный.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (&НачалоГодаПериодаРасчета МЕЖДУ ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала И ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаОкончания
		|			ИЛИ ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)";
		ПрименениеСтандартныхВычетов = Запрос.Выполнить().Выгрузить();
		ПрименениеСтандартныхВычетов.Индексы.Добавить("ФизическоеЛицо");
		
		// Прочитаем размеры вычетов за каждый год периода расчета.
		// В качестве результата получаем соответствие, в котором по годам лежат соответствия, в которых каждому вычету
		// сопоставлена структура с полями Размер и ОграничениеПоДоходам.
		РазмерыВычетов = УчетНДФЛПовтИсп.РазмерыВычетов(НачалоГода(ПервыйМесяцНалоговогоПериода), НачалоГода(ПоследнийМесяцНалоговогоПериода));
		
	КонецЕсли;
	
	// 12.	Получим данные об имущественных вычетах (как ранее предоставленные, так и о праве на вычет)
	//	Читаем записи регистра накопления ИмущественныеВычетыНДФЛ по списку физических лиц и головной организации, зарегистрированные за весь период расчетов.
	//	Для записей прихода (права на вычеты) период дополнительно ограничиваем сверху окончанием месяца расчета (весь период расчетов может заканчиваться позже), а также учитываем только те записи, у которых год поля период совпадает со значением измерения Год.
	//	Для записей расхода (использованные вычеты) дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Полученный результат дополняем данными текущего регистратора о праве на вычеты и группируем.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, КодВычета, ВидДвижения, Подразделение, Сумма.
	КонецПериодаИмущественныхВычетов = Макс(КонецПериодаРасчета, КонецМесяцаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаИмущественныхВычетов", КонецПериодаИмущественныхВычетов);
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	ИмущественныеВычеты.КодВычета КАК КодВычета,
	|	ИмущественныеВычеты.ВидДвижения КАК ВидДвижения,
	|	ВЫБОР
	|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ИмущественныеВычеты.Подразделение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|	КОНЕЦ КАК Подразделение,
	|	СУММА(ИмущественныеВычеты.Сумма) КАК Сумма
	|ИЗ
	|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычеты
	|ГДЕ
	|	ИмущественныеВычеты.Регистратор <> &ИсключаемыйРегистратор
	|	И ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаИмущественныхВычетов
	|	И ИмущественныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ИмущественныеВычеты.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И НЕ ИмущественныеВычеты.ЗарегистрированоПриНачисленииАванса В (&МесяцыНачисленияЗарплаты)
	|	И ВЫБОР
	|			КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА ИмущественныеВычеты.Год = ГОД(ИмущественныеВычеты.Период)
	|						И ИмущественныеВычеты.Период <= &КонецМесяцаРасчета
	|			ИНАЧЕ ИмущественныеВычеты.Период <= &КонецПериодаРасчета
	|					И &ОкончательныйРасчетВычеты
	|		КОНЕЦ
	|
	|СГРУППИРОВАТЬ ПО
	|	ИмущественныеВычеты.ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ),
	|	ИмущественныеВычеты.КодВычета,
	|	ИмущественныеВычеты.ВидДвижения,
	|	ВЫБОР
	|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ИмущественныеВычеты.Подразделение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|	КОНЕЦ";	
	Если ОкончательныйРасчет Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетВычеты", "Истина");
	Иначе
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетВычеты", 
		"(Период < &НачалоМесяцаРасчета
		|			ИЛИ ВычетМежрасчетногоПериода
		|				И (Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))");
	КонецЕсли;
	
	ИмущественныеВычеты = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ИмущественныеВычетыНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого СтрокаВычетовТекущегоРегистратора Из ДвиженияТекущегоРегистратора.ИмущественныеВычетыНДФЛ Цикл
			Если СоответствиеФизическихЛиц[СтрокаВычетовТекущегоРегистратора.ФизическоеЛицо] <> Истина Тогда
				Продолжить;
			КонецЕсли;
			Если ЗначениеЗаполнено(СтрокаВычетовТекущегоРегистратора.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;
			КонецЕсли;
			
			НоваяСтрока = ИмущественныеВычеты.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаВычетовТекущегоРегистратора);
			НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(СтрокаВычетовТекущегоРегистратора.Период);
			НоваяСтрока.Подразделение = Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
			ЕстьНовыеЗаписи = Истина;
			
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Новые права и сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ИмущественныеВычеты.Свернуть("ФизическоеЛицо, Подразделение, МесяцНалоговогоПериода, ВидДвижения, КодВычета", "Сумма");
		КонецЕсли;
	КонецЕсли;	
	ИмущественныеВычеты.Индексы.Добавить("ФизическоеЛицо, МесяцНалоговогоПериода, ВидДвижения");
	
	// 13.	Получим информацию о предоставленных стандартных и социальных вычетах.
	//	Читаем записи регистра накопления ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛс по списку физических лиц и головной организации, зарегистрированные за 
	//	период между началом года первого месяца налогового периода и концом последнего месяца налогового периода.
	//	Дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Для стандартных вычетов заполняем поля Подразделение и КодВычета (для социальных вычетов берем пустые ссылки). 
	//	Рассчитываем поле ЭтоСоциальныйВычет (булево) исходя из группы вычета.
	//	Полученный результат дополняем данными текущего регистратора о праве на социальные вычеты и группируем.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, КодВычета, ЭтоСоциальныйВычет, Подразделение, Сумма.
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ВычетыБД.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.КодВычета
	|	КОНЕЦ КАК КодВычета,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоСоциальныйВычет,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.Подразделение
	|	КОНЕЦ КАК Подразделение,
	|	НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	НАЧАЛОПЕРИОДА(ВЫБОР
	|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
	|		КОНЕЦ, МЕСЯЦ) КАК МесяцПериодаПредоставленияВычета,
	|	СУММА(ВычетыБД.Сумма) КАК Сумма
	|ИЗ
	|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ВычетыБД
	|ГДЕ
	|	ВычетыБД.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И ВычетыБД.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ВычетыБД.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И (ВЫБОР
	|				КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|				КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|				ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
	|			КОНЕЦ МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|			ИЛИ ВычетыБД.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|	И ВычетыБД.Регистратор <> &ИсключаемыйРегистратор
	|	И НЕ ВычетыБД.ЗарегистрированоПриНачисленииАванса В (&МесяцыНачисленияЗарплаты)
	|	И &ОкончательныйРасчетВычеты
	|
	|СГРУППИРОВАТЬ ПО
	|	ВычетыБД.ФизическоеЛицо,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.Подразделение
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.КодВычета
	|	КОНЕЦ,
	|	НАЧАЛОПЕРИОДА(ВЫБОР
	|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
	|		КОНЕЦ, МЕСЯЦ),
	|	ВычетыБД.МесяцНалоговогоПериода";
	Если ОкончательныйРасчет Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетВычеты", "Истина");
	Иначе
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетВычеты", 
		"(Период < &НачалоМесяцаРасчета
		|			ИЛИ ВычетМежрасчетногоПериода
		|				И (Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))");		
	КонецЕсли;

	ПредоставленныеСтандартныеИСоциальныеВычеты = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого ТекущаяСтрока Из ДвиженияТекущегоРегистратора.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ Цикл
			Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] <> Истина Тогда
				Продолжить;	
			КонецЕсли;			
			Если ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;
			КонецЕсли;
				
			НоваяСтрока = ПредоставленныеСтандартныеИСоциальныеВычеты.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
			НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
			НоваяСтрока.ЭтоСоциальныйВычет = ТекущаяСтрока.КодВычета.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные;	
			Если НоваяСтрока.ЭтоСоциальныйВычет Тогда
				НоваяСтрока.МесяцПериодаПредоставленияВычета = НоваяСтрока.МесяцНалоговогоПериода;
				НоваяСтрока.Подразделение = Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
				НоваяСтрока.КодВычета = Справочники.ВидыВычетовНДФЛ.ПустаяСсылка();
			ИначеЕсли Не ЗначениеЗаполнено(НоваяСтрока.МесяцПериодаПредоставленияВычета) Тогда	
				НоваяСтрока.МесяцПериодаПредоставленияВычета = НоваяСтрока.МесяцНалоговогоПериода;
			КонецЕсли;
			НоваяСтрока.МесяцПериодаПредоставленияВычета = НачалоМесяца(НоваяСтрока.МесяцПериодаПредоставленияВычета);
			ЕстьНовыеЗаписи = Истина;
				
		КонецЦикла;
		Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ПредоставленныеСтандартныеИСоциальныеВычеты.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, КодВычета, Подразделение, ЭтоСоциальныйВычет", "Сумма");
		КонецЕсли;			
	КонецЕсли;	
	ПредоставленныеСтандартныеИСоциальныеВычеты.Индексы.Добавить("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, ЭтоСоциальныйВычет");
		
	// 14.	Получим информацию об исчисленном ранее налоге
	//	Читаем приходные записи (соответствуют налогу исчисленному) регистра накопления РасчетыНалогоплательщиковСБюджетомПоНДФЛ по списку физических лиц и головной организации со ставкой резидента 13%, 
	//	зарегистрированные за период между началом года первого месяца налогового периода и концом последнего месяца налогового периода.
	//	Дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Рассчитываем поле МесяцНалоговогоПериодаДляПоиска как начало месяца налогового периода.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо,  МесяцНалоговогоПериодаДляПоиска, МесяцНалоговогоПериода, Подразделение, КатегорияДохода и НалогПоСтавке13
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериодаДляПоиска,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	-СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК НалогПоСтавке13,
	|	0 КАК НалогСПревышения
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &ИсключаемыйРегистратор
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И НЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ЗарегистрированоПриНачисленииАванса В (&МесяцыНачисленияЗарплаты)
	|	И &ОкончательныйРасчетПоРасчетам
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода";
	Если ОкончательныйРасчет Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетПоРасчетам", "Истина");
	Иначе
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ОкончательныйРасчетПоРасчетам", 
		"(Период < &НачалоМесяцаРасчета
		|			ИЛИ РасчетМежрасчетногоПериода
		|				И (Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))");	
	КонецЕсли;
	ИсчисленныйРанееНалог = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "РасчетыНалогоплательщиковСБюджетомПоНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого СтрокаНалогаТекущегоРегистратора Из ДвиженияТекущегоРегистратора.РасчетыНалогоплательщиковСБюджетомПоНДФЛ Цикл
			
			Если ЗначениеЗаполнено(СтрокаНалогаТекущегоРегистратора.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;
			КонецЕсли;
			Если СоответствиеФизическихЛиц[СтрокаНалогаТекущегоРегистратора.ФизическоеЛицо] <> Истина 
				Или СтрокаНалогаТекущегоРегистратора.ВидДвижения = ВидДвиженияНакопления.Расход 
				Или СтрокаНалогаТекущегоРегистратора.СтавкаНалогообложенияРезидента <> Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка13 Тогда
				Продолжить;	
			КонецЕсли;			
				 
			НоваяСтрока = ИсчисленныйРанееНалог.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаНалогаТекущегоРегистратора);	
			НоваяСтрока.МесяцНалоговогоПериодаДляПоиска = НачалоМесяца(СтрокаНалогаТекущегоРегистратора.МесяцНалоговогоПериода);
			НоваяСтрока.НалогПоСтавке13 = -СтрокаНалогаТекущегоРегистратора.Сумма;
			ЕстьНовыеЗаписи = Истина;
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ИсчисленныйРанееНалог.Свернуть("Подразделение, ФизическоеЛицо, МесяцНалоговогоПериода, МесяцНалоговогоПериодаДляПоиска, КатегорияДохода", "НалогПоСтавке13");	
		КонецЕсли;	
	КонецЕсли;	
	ИсчисленныйРанееНалог.Индексы.Добавить("ФизическоеЛицо, МесяцНалоговогоПериодаДляПоиска"); 
	
	// 15.	Получим информацию об остатках авансовых платежей в бюджет
	//	Читаем остатки из регистра АвансовыеПлатежиИностранцевПоНДФЛ по списку физических лиц на конец месяца расчета за годы периода расчета.
	//	Отнимем движения исключаемого регистратора (удовлетворяющих тем же условиям что и данные остатков)
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, НалоговыйПериод (число, год), Остаток
	Запрос.УстановитьПараметр("МинимальныйГод", Год(ПервыйМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("МаксимальныйГод", Год(ПоследнийМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("КонецМесяцаРасчета", КонецМесяца(МесяцРасчета) + 1);
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Авансы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Авансы.НалоговыйПериод КАК НалоговыйПериод,
	|	СУММА(Авансы.Остаток) КАК Остаток
	|ИЗ
	|	(ВЫБРАТЬ
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.Год КАК НалоговыйПериод,
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.СуммаОстаток КАК Остаток
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ.Остатки(
	|				&КонецМесяцаРасчета,
	|				ФизическоеЛицо В (&СписокФизическихЛиц)
	|					И (Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод)
	|					И ГоловнаяОрганизация = &ГоловнаяОрганизация) КАК АвансовыеПлатежиИностранцевПоНДФЛОбороты
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДвиженияРегистратора.ФизическоеЛицо,
	|		ДвиженияРегистратора.Год,
	|		ВЫБОР
	|			КОГДА ДвиженияРегистратора.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА ДвиженияРегистратора.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ КАК ДвиженияРегистратора
	|	ГДЕ
	|		ДвиженияРегистратора.Регистратор = &ИсключаемыйРегистратор
	|		И ДвиженияРегистратора.ФизическоеЛицо В(&СписокФизическихЛиц)
	|		И ДвиженияРегистратора.Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод
	|		И ДвиженияРегистратора.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И НЕ ДвиженияРегистратора.ЗарегистрированоПриНачисленииАванса В (&МесяцыНачисленияЗарплаты)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		АвансовыеДвижения.ФизическоеЛицо,
	|		АвансовыеДвижения.Год,
	|		ВЫБОР
	|			КОГДА АвансовыеДвижения.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА АвансовыеДвижения.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ КАК АвансовыеДвижения
	|	ГДЕ
	|		АвансовыеДвижения.ЗарегистрированоПриНачисленииАванса В (&МесяцыНачисленияЗарплаты)
	|		И АвансовыеДвижения.ФизическоеЛицо В(&СписокФизическихЛиц)
	|		И АвансовыеДвижения.Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод
	|		И АвансовыеДвижения.ГоловнаяОрганизация = &ГоловнаяОрганизация) КАК Авансы
	|
	|СГРУППИРОВАТЬ ПО
	|	Авансы.ФизическоеЛицо,
	|	Авансы.НалоговыйПериод";
	ОстаткиПоАвансовымПлатежам = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "АвансовыеПлатежиИностранцевПоНДФЛ") Тогда 
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого СтрокаНабора Из ДвиженияТекущегоРегистратора.АвансовыеПлатежиИностранцевПоНДФЛ Цикл
			Если СоответствиеФизическихЛиц[СтрокаНабора.ФизическоеЛицо] <> Истина Или СтрокаНабора.ВидДвижения = ВидДвиженияНакопления.Приход Тогда
				Продолжить;	
			КонецЕсли;	
			Если ЗначениеЗаполнено(СтрокаНабора.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;
			КонецЕсли;
			СтрокаРезультат = ОстаткиПоАвансовымПлатежам.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРезультат, СтрокаНабора);
			СтрокаРезультат.НалоговыйПериод = СтрокаНабора.Год;
			СтрокаРезультат.Остаток = - СтрокаНабора.Сумма;
			ЕстьНовыеЗаписи = Истина;
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ОстаткиПоАвансовымПлатежам.Свернуть("ФизическоеЛицо, НалоговыйПериод", "Остаток");
		КонецЕсли;	
	КонецЕсли;	
	ОстаткиПоАвансовымПлатежам.Индексы.Добавить("ФизическоеЛицо, НалоговыйПериод");
	
	РезультатРасчета = ТаблицаНДФЛ();
	
	СтруктураПоискаПоФизическомуЛицу = Новый Структура("ФизическоеЛицо");
	СтруктураПоискаТекущихДоходов = Новый Структура("ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", Истина, Не ОкончательныйРасчет);
	СтруктураПоискаТекущихДоходовНерезидентов = Новый Структура("ФизическоеЛицо, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", , Истина, Не ОкончательныйРасчет);
	СтруктураПоискаИсчисленного = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериодаДляПоиска");
	СтруктураПоискаСтандартныхВычетов = Новый Структура("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, ЭтоСоциальныйВычет");
	СтруктураПоискаИмущественныхВычетов = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериода, ВидДвижения");
	ОписаниеВычетов = УчетНДФЛПовтИсп.ОписаниеВычетов();
	
	// инициализируем общие вспомогательные объекты
	РезультатРасчетаВспомогательный = РезультатРасчета;
	ВспомогательнаяТаблицаМесяца = РезультатРасчета.СкопироватьКолонки("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, МесяцНалоговогоПериода, Подразделение, КатегорияДохода, НалогПоСтавке13, ЗачтеноАвансовыхПлатежейПоСтавке13, НалогСПревышения, ЗачтеноАвансовыхПлатежейСПревышения");
	ВспомогательнаяТаблицаМесяца.Колонки.Добавить("КоличествоВычетов", Новый ОписаниеТипов("Число"));
	
	ВспомогательнаяТаблицаВычетовМесяца = Новый ТаблицаЗначений;
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("МесяцПериодаПредоставленияВычета", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("Подразделение", Метаданные.ОпределяемыеТипы.ТерриторияВыполненияРаботВОрганизации.Тип);
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("КатегорияДохода", Новый ОписаниеТипов("ПеречислениеСсылка.КатегорииДоходовНДФЛ"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("КодВычета", Новый ОписаниеТипов("СправочникСсылка.ВидыВычетовНДФЛ"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("РазмерВычета", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15,2)));
	
	// Начнем с расчета по резидентам и приравненным к ним.
	Если РассчитыватьНалогНарастающимИтогом Тогда
		
		ВспомогательныеДатыПодразделенияКатегории = Новый ТаблицаЗначений;
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("Подразделение", Метаданные.ОпределяемыеТипы.ТерриторияВыполненияРаботВОрганизации.Тип);
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("КатегорияДохода", Новый ОписаниеТипов("ПеречислениеСсылка.КатегорииДоходовНДФЛ"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("Распределение", Новый ОписаниеТипов("ТаблицаЗначений"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьДатуПолученияДохода", Новый ОписаниеТипов("Булево"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьПодразделение", Новый ОписаниеТипов("Булево"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьКатегориюДохода", Новый ОписаниеТипов("Булево"));
		
		ВычетыЗаМесяц = Новый ТаблицаЗначений;
		ВычетыЗаМесяц.Колонки.Добавить("КодВычета");
		ВычетыЗаМесяц.Колонки.Добавить("РазмерВычета", Новый ОписаниеТипов("Число"));
		
		СтавкаДляРезидента = 0.13; // Пункт 1 статьи 224 НК РФ.
		ОсобыеКатегорииДохода = Новый Соответствие; // Эти категории дохода определяют собственные ставки налога, поэтому их нельзя заменять текущими даже при перерасчете.
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.Дивиденды, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15, Истина);
		
		ПериодСрезаПравНаВычеты = НачалоМесяца(Макс(МесяцРасчета, ПоследнийМесяцНалоговогоПериода));
		ПереноситьДоходДляПримененияВычетовВМесяцРасчета = Не ОкончательныйРасчет И Год(МесяцРасчета) = Год(ДатаУдержанияИсчисленногоНалога) И МесяцРасчета < НачалоМесяца(ДатаУдержанияИсчисленногоНалога);
		
		// Инициализируем вспомогательные объекты.
		СтруктураПоиска = Новый Структура(ПоляПоиска);
		ПоляПоискаПоДатам = "ДатаПолученияДохода, ДоходМежрасчетногоПериода";
		СтруктураПоискаПоДатам = Новый Структура(ПоляПоискаПоДатам);
		СтруктураПоискаТолькоПоДатам = Новый Структура("ДатаПолученияДохода");
		СтруктураПоискаПоДатамИПодразделениям = Новый Структура("ДатаПолученияДохода,Подразделение");
		
		// Структуру описания остатков создаем однократно, в дальнейшем для каждого сочетания ФЛ+Налоговый период очищаем ее коллекции.
		ОстаткиВычетов = НовыйОстаткиВычетов();
		ТекущиеОстаткиВычетов = ОстаткиВычетов.Остатки; 
		
		ПараметрыЗаполненияРесурсаНалогПоСтавке13 = НовыйПараметрыЗаполненияРесурса("НалогПоСтавке13", "СуммаДохода", 0, "Подразделение, КатегорияДохода");
		ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению = НовыйПараметрыЗаполненияРесурса("РазмерВычета", "СуммаДохода", , , "КодВычета");
		ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории = НовыйПараметрыЗаполненияРесурса("РазмерВычета", "СуммаДохода", ,"Подразделение, КатегорияДохода", "КодВычета,МесяцПериодаПредоставленияВычета");
		
		// Однократный обход таблицы ДанныеУчетаДоходов организован двумя вложенными циклами; внутренний цикл выполняет расчет
		// налога за один налоговый период по одному физлицу. В качестве промежуточной структуры данных для результатов
		// расчета за месяц используем две таблицы: в одной оставляем только ресурсы НалогПоСтавке13,
		// ЗачтеноАвансовыхПлатежейПоСтавке13, во второй таблице храним результат расчета вычетов (измерение КодВычета и ресурс РазмерВычета).
		ИндексТекущейСтрокиТаблицыДоходов = 0;
		Пока ИндексТекущейСтрокиТаблицыДоходов <= ДанныеУчетаДоходов.Количество() - 1 Цикл		
			
			// будет инициализирована только в том случае, если она понадобится
			ТаблицаРаспределенияМесяцаРасчета = Неопределено;	
			
			ТекущаяСтрокаТаблицыДоходов = ДанныеУчетаДоходов[ИндексТекущейСтрокиТаблицыДоходов];
			// получим физическое лицо, по которому выполняется расчет
			ТекущееФизическоеЛицо = ТекущаяСтрокаТаблицыДоходов.ФизическоеЛицо;
			
			// получим налоговый период, по которому далее будет выполняться расчет.
			ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрокаТаблицыДоходов.МесяцНалоговогоПериода);
			РазмерыВычетовНаГод = РазмерыВычетов[ТекущийНалоговыйПериод];
			
			// обнулим остатки вычетов
			ТекущиеОстаткиВычетов.Очистить();
			ОстаткиВычетов.ТаблицаВычетов.Очистить();	
			ВычетыПредыдущихМесяцев = Новый Соответствие;
			ОтложенныеПраваНаВычеты = Новый Соответствие;
			ВспомогательнаяТаблицаМесяца.Очистить();
			
			ДействующаяИнформацияОСтандартныхВычетах = Неопределено;
			ДействующаяИнформацияОСтатусе = Неопределено;
			                                                                         	
			// инициализируем переменные, хранящие итоги за год
			СтрокиНДФЛЗаГод = Новый Массив;
			ОблагаемыйДоходНаНачалоМесяца = 0;  
			ОблагаемыйДоходНаКонецМесяца = 0;
			
			ДоходЗаМесяцОстаток = 0;	
			НалогИсчисленный = 0;
			ВычетСоциальныйОстаток = 0;
			ИсчисленоНДФЛЗаГод = 0;
			ОблагаемыйДоход = 0;
			ВсегоДоходовТекущегоРасчета = 0;
			
			Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаПоФизическомуЛицу Тогда // Начало обработки очередного физ.лица.
				
				СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
				СтруктураПоискаТекущихДоходовНерезидентов.ФизическоеЛицо = ТекущееФизическоеЛицо;
				
				// Получим данные, необходимые для определения прав на вычеты.
				СтрокиТаблицыСтатусов = СтатусыФизическихЛиц.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				СтрокиТаблицыПримененияВычетов = ПрименениеСтандартныхВычетов.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				СтрокиТаблицыПравНаВычеты = ВычетыНаДетейИЛичные.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				
				// Если выполняется окончательный расчет, будем вписывать результат расчета сразу в таблицы результата.
				// В случае с промежуточным расчетом будем использовать промежуточную таблицу, а потом переносить в результирующую с
				// учетом ограничений.
				Если Не ОкончательныйРасчет Тогда
					РезультатРасчетаВспомогательный = РезультатРасчета.СкопироватьКолонки();
				КонецЕсли;
				
				РаспределениеДоходовФизлица = ДоходыПоПодразделениямИКатегориям.Скопировать(СтруктураПоискаПоФизическомуЛицу);
				РаспределениеДоходовФизлица.Индексы.Добавить(ПоляПоискаПоДатам);
				ДоходыТекущегоРасчета = РаспределениеДоходовФизлица.Скопировать(СтруктураПоискаТекущихДоходов);
				Если Не ОкончательныйРасчет Тогда
					ВсегоДоходовТекущегоРасчета = ДоходыТекущегоРасчета.Итог("СуммаДоходаТекущегоРасчета");
					ДоходыТекущегоРасчетаНерезидента = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Скопировать(СтруктураПоискаТекущихДоходовНерезидентов);
				КонецЕсли;
				
			КонецЕсли;
				                                                                             				
			// Характеристики доходов "текущего" расчета за очередной налоговый период.
			ВсеДатыТекущегоРасчета = Новый Соответствие;
			ВсеКатегорииТекущегоРасчета = Новый Соответствие;
			ДатыТекущегоРасчетаПоМесяцам = Новый Соответствие;
			ТекущийГод = Год(ТекущийНалоговыйПериод);
			Для СчМесяцев = 1 По 12 Цикл
				ДатыТекущегоРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
			КонецЦикла;
			Для каждого СтрокаТЗ Из ДоходыТекущегоРасчета Цикл
				Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
					Продолжить;
				КонецЕсли;
				ВсеДатыТекущегоРасчета.Вставить(СтрокаТЗ.ДатаПолученияДохода, Истина);
				ВсеКатегорииТекущегоРасчета.Вставить(СтрокаТЗ.КатегорияДохода, Истина);
				МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
				ДатыТекущегоРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыТекущегоРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
			КонецЦикла;
			Если ОкончательныйРасчет Тогда
				ДатыРасчетаПоМесяцам = Новый Соответствие;
				ДатаНалоговогоПериода = '00010101';
				Для СчМесяцев = 1 По 12 Цикл
					ДатыРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
				КонецЦикла;
				Для каждого СтрокаТЗ Из РаспределениеДоходовФизлица Цикл
					Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
						Продолжить;
					КонецЕсли;
					ДатаНалоговогоПериода = Макс(ДатаНалоговогоПериода, СтрокаТЗ.ДатаПолученияДохода); 
					МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
					ДатыРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
				КонецЦикла;
				
				ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцРасчета)];
				ОсновнаяДатаМесяцаРасчета = ?(Год(МесяцРасчета) = ТекущийГод, ДатыРасчетаПоМесяцам[Месяц(МесяцРасчета)], '00010101');
				
				ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам = Новый Массив;
				ТаблицаРаспределенияКонцаМесяцаРасчета = Новый Массив;
				ТаблицаРаспределенияНалоговогоПериода = Новый Массив;
				Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
					ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				КонецЕсли;
				Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчета;
					ТаблицаРаспределенияКонцаМесяцаРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				КонецЕсли;
				Если ЗначениеЗаполнено(ДатаНалоговогоПериода) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ДатаНалоговогоПериода;
					ТаблицаРаспределенияНалоговогоПериода = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				Иначе
					ДатаНалоговогоПериода = НачалоДня(КонецМесяца(МесяцРасчета))
				КонецЕсли;
			Иначе
				ОсновнаяДатаТекущегоРасчета = ДатаУдержанияИсчисленногоНалога;
				Если ВсеДатыТекущегоРасчета[ОсновнаяДатаТекущегоРасчета] = Неопределено Тогда
					Для СчМесяцев = 1 По 12 Цикл
						Если ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев]) Тогда
							ОсновнаяДатаТекущегоРасчета = ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев];
							Прервать;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				ДатыТекущегоРасчетаНерезидента = Новый Соответствие;
				Для каждого СтрокаТЗ Из ДоходыТекущегоРасчетаНерезидента Цикл
					Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
						Продолжить;
					КонецЕсли;
					ДатыТекущегоРасчетаНерезидента.Вставить(Месяц(СтрокаТЗ.ДатаПолученияДохода), СтрокаТЗ.ДатаПолученияДохода);
				КонецЦикла;
			КонецЕсли;
			
			ПродолжатьРасчет = Истина;
			Пока ПродолжатьРасчет Цикл
				
				ТекущаяСтрокаТаблицыДоходов = ДанныеУчетаДоходов[ИндексТекущейСтрокиТаблицыДоходов]; 
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаЗаМесяц Тогда
					
					МесяцНалоговогоПериода = ТекущаяСтрокаТаблицыДоходов.МесяцНалоговогоПериода;
					ПроводитьРасчетЗаОчереднойМесяц = ТекущаяСтрокаТаблицыДоходов.ВсеДоходыЗаМесяц <> 0 Или Не ЭтоРасчетПоДоходамТекущегоМесяца;
					
					// Получаем информацию о статусе налогоплательщика на начало месяца.
					Если ДействующаяИнформацияОСтатусе = Неопределено
						Или Не (МесяцНалоговогоПериода >= ДействующаяИнформацияОСтатусе.ДатаНачала И МесяцНалоговогоПериода <= ДействующаяИнформацияОСтатусе.ДатаОкончания) Тогда
						ДействующаяИнформацияОСтатусе = ИнформацияОСтатусеНалогоплательщика(МесяцНалоговогоПериода, СтрокиТаблицыСтатусов);
					КонецЕсли;	
					
					// Получаем информацию об имеющихся правах на стандартные вычеты.
					Если ДействующаяИнформацияОСтандартныхВычетах = Неопределено 
						Или Не (МесяцНалоговогоПериода >= ДействующаяИнформацияОСтандартныхВычетах.ДатаНачала И МесяцНалоговогоПериода <= ДействующаяИнформацияОСтандартныхВычетах.ДатаОкончания) Тогда
						ДействующаяИнформацияОСтандартныхВычетах = ИнформацияОСтандартныхВычетахДействующихНаДату(МесяцНалоговогоПериода, ПериодСрезаПравНаВычеты, СтрокиТаблицыПравНаВычеты, СтрокиТаблицыПримененияВычетов, ДействующаяИнформацияОСтатусе);	
					КонецЕсли;
					
					ВспомогательнаяТаблицаВычетовМесяца.Очистить();
					ЗаполнитьЗначенияСвойств(СтруктураПоиска,ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаСтандартныхВычетов, ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаИмущественныхВычетов, ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаИсчисленного, ТекущаяСтрокаТаблицыДоходов);
					СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = МесяцНалоговогоПериода;
					СтруктураПоискаСтандартныхВычетов.МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода;
								
					// Вписываем во вспомогательную таблицу месяца исчисленные ранее налоги.
					СтрокиНалога = ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного);
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, СтрокиНалога, "КатегорияДохода, НалогПоСтавке13");	
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиНалога, ИсчисленныйРанееНалог);					
					
					// Получаем использованный в месяце социальный вычет.
					СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Истина;
					СтрокиПравНаСоциальныеВычеты = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
					ВычетСоциальныйОстаток = ВычетСоциальныйОстаток + ?(СтрокиПравНаСоциальныеВычеты.Количество() > 0 И ДействующаяИнформацияОСтатусе.ПрименяетсяСтавкаПункта1Статьи224НК, СтрокиПравНаСоциальныеВычеты[0].Сумма, 0);
					
					// Создадим набор сумм вычетов, которые могут уменьшить облагаемый доход, начнем с имущественных вычетов.
					СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Приход;
					СтрокиПравНаИмущественныеВычеты = ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаИмущественныхВычетов);
					Для Каждого СтрокаПрав Из СтрокиПравНаИмущественныеВычеты Цикл
						ДобавитьОстатокВычетов(ОстаткиВычетов, СтрокаПрав.КодВычета, СтрокаПрав.Сумма);		
					КонецЦикла;					
					
					// Добавим стандартные вычеты очередного месяца.
					ОблагаемыйДоходНарастающимИтогом = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоходНарастающимИтогом;
					ДоходСПредыдущегоМестаРаботы = 0;
					СтрокиДоходаСПредыдущегоМестаРаботы = ДоходыСПредыдущегоМестаРаботы.НайтиСтроки(СтруктураПоиска);
					Если СтрокиДоходаСПредыдущегоМестаРаботы.Количество() > 0 Тогда
						ДоходСПредыдущегоМестаРаботы = СтрокиДоходаСПредыдущегоМестаРаботы[0].Размер;
					КонецЕсли;	
					ОблагаемыйДоходДляВычетов = ОблагаемыйДоходНарастающимИтогом + ДоходСПредыдущегоМестаРаботы;	
					Для Каждого ТекущийВычет Из ДействующаяИнформацияОСтандартныхВычетах.Вычеты Цикл
						ОписаниеРазмераВычета = РазмерыВычетовНаГод[ТекущийВычет.Ключ];
						Если ОписаниеРазмераВычета = Неопределено Тогда
							Продолжить;
						КонецЕсли;	
						Если ОписаниеРазмераВычета.ОграничениеПоДоходам <> 0 И ОблагаемыйДоходДляВычетов > ОписаниеРазмераВычета.ОграничениеПоДоходам Тогда
							Продолжить;
						КонецЕсли;	
						ДобавитьОстатокВычетов(ОстаткиВычетов, ТекущийВычет.Ключ, ТекущийВычет.Значение * ОписаниеРазмераВычета.Размер, ПрименятьСтандартныеВычетыНарастающимИтогом);	
					КонецЦикла;		
					
					СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Ложь;
					СтрокиСтандартныхВычетов = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
						
					// Перенесем ранее предоставленные при исчислении налога для будущих дат получения дохода вычеты 
					// текущего месяца на тот месяц, когда их предоставили на самом деле.
					// Манипуляции производим с правами на стандартные вычеты и со строками зарегистрированных вычетов.
					Для каждого Элемент Из ОтложенныеПраваНаВычеты Цикл
						ТекущийВычет = Элемент.Ключ;
						Если ТекущийВычет.МесяцНалоговогоПериода = МесяцНалоговогоПериода Тогда
							ДобавитьОстатокВычетов(ОстаткиВычетов, ТекущийВычет.КодВычета, Элемент.Значение, Истина);
							ОтложенныеПраваНаВычеты.Удалить(ТекущийВычет);
						КонецЕсли;
					КонецЦикла;
					Для каждого СтрокаТЗ Из СтрокиСтандартныхВычетов Цикл
						Если СтрокаТЗ.МесяцНалоговогоПериода <= МесяцНалоговогоПериода Тогда
							Продолжить;	
						КонецЕсли;
						Если СтрокаТЗ.Сумма > 0 Тогда
							ОстатокВычета = ТекущиеОстаткиВычетов[СтрокаТЗ.КодВычета];
							Если ОстатокВычета <> Неопределено  Тогда
								ВычетКЗачету = Мин(СтрокаТЗ.Сумма, ОстатокВычета);
								ТекущиеОстаткиВычетов.Вставить(СтрокаТЗ.КодВычета, ОстатокВычета - ВычетКЗачету);
								СтрокаТЗ.МесяцПериодаПредоставленияВычета = СтрокаТЗ.МесяцНалоговогоПериода;
								ОтложенныеПраваНаВычеты.Вставить(СтрокаТЗ, ВычетКЗачету);
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
					// Если вычеты перенесли, надо обновить зарегистрированные вычеты текущего месяца.
					Если ОтложенныеПраваНаВычеты.Количество() > 0 Тогда
						СтрокиСтандартныхВычетов = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
					КонецЕсли;
					
					// Определим доход, который могут уменьшать вычеты.
					ЗапоминатьВычетыНаБудущее = Ложь;
					ОблагаемыйДоходЗаМесяц = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоходЗаМесяц;
					Если ПрименятьСтандартныеВычетыНарастающимИтогом Тогда
						Если ПереноситьДоходДляПримененияВычетовВМесяцРасчета И МесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц + ВсегоДоходовТекущегоРасчета;
							ЗапоминатьВычетыНаБудущее = Истина;
						ИначеЕсли ПереноситьДоходДляПримененияВычетовВМесяцРасчета И МесяцНалоговогоПериода = НачалоМесяца(ДатаУдержанияИсчисленногоНалога) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц - ВсегоДоходовТекущегоРасчета;
						Иначе
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц;
						КонецЕсли;
					Иначе
						ДоходЗаМесяцОстаток = ОблагаемыйДоходЗаМесяц;		
					КонецЕсли;	                                                     
					// Имущественные вычеты не могут уменьшать доходы месяцев, предшествующих месяцу начала применения.
					ДоходЗаМесяцДляИмущественныхВычетов = ОблагаемыйДоходЗаМесяц; 
					
					// Рассчитываем примененные за месяц вычеты.
					ВсегоВычетовЗаМесяц = 0;
					ЕстьВычетыЗаМесяц = Ложь;
					ВычетыЗаМесяц.Очистить();	
					Если ДоходЗаМесяцОстаток > 0 И МесяцНалоговогоПериода <= ТекущаяСтрокаТаблицыДоходов.СтаршийМесяцПолученияДохода Тогда
						
						ВычетСоциальныйЗаМесяц = Мин(ДоходЗаМесяцОстаток, ВычетСоциальныйОстаток);
						ВычетСоциальныйОстаток = ВычетСоциальныйОстаток - ВычетСоциальныйЗаМесяц;
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + ВычетСоциальныйЗаМесяц;
						ЕстьВычетыЗаМесяц = ВычетСоциальныйЗаМесяц <> 0;
						
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетСоциальныйЗаМесяц;
						ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетСоциальныйЗаМесяц;
						// Для расчета имущественных вычетов учтем ранее не учтенные из-за отсутствия дохода в предшествующих месяцах
						// налогового периода вычеты.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < МесяцНалоговогоПериода Тогда
								ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - Мин(ДоходЗаМесяцДляИмущественныхВычетов, Элемент.Значение);
								Если ДоходЗаМесяцДляИмущественныхВычетов = 0 Тогда
									Прервать;
								КонецЕсли;	
							КонецЕсли;
						КонецЦикла;
						
						Если ДоходЗаМесяцОстаток > 0 Тогда
							// Заполняем таблицу значений ВычетыЗаМесяц (с колонками КодВычета, Сумма) суммами вычетов, которые будут
							// применены в текущем месяце. Строки в таблицу помещаем в соответствии с наиболее выгодным для сотрудника
							// приоритетом применения вычетов (описанным непосредственно в справочнике вычетов), для чего. отсортируем
							// таблицу ТаблицаВычетов по полю ПорядокСписания. Применяемые суммы вычетов переписываем из таблицы Остатки,
							// содержащей права на вычеты, в пределах доходов, которые могут быть уменьшены на стандартные, имущественные
							// вычеты. Если положенных физ.лицу вычетов оказывается больше, чем начисленного дохода, в таблице Остатки
							// оказываются суммы неиспользованных в этом месяце вычетов для предоставления их в будущем.
							ОстаткиВычетов.ТаблицаВычетов.Сортировать("ПорядокСписания");
							Для Каждого ВычетКСписанию Из ОстаткиВычетов.ТаблицаВычетов Цикл
								
								Если ДоходЗаМесяцОстаток = 0 И ДоходЗаМесяцДляИмущественныхВычетов = 0 Тогда
									Прервать;
								КонецЕсли;
								Если ВычетКСписанию.ИмущественныйВычет И Не ПроводитьРасчетЗаОчереднойМесяц Тогда 
									Прервать;
								КонецЕсли;
								
								ВычетЗаМесяц = 0;
								ОстатокВычета = ТекущиеОстаткиВычетов[ВычетКСписанию.КодВычета];
								Если ВычетКСписанию.ИмущественныйВычет Тогда 
									Если ДоходЗаМесяцДляИмущественныхВычетов > 0 Тогда
										ВычетЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ОстатокВычета);	
										ТекущиеОстаткиВычетов.Вставить(ВычетКСписанию.КодВычета, ОстатокВычета - ВычетЗаМесяц);
									КонецЕсли;	
								Иначе	
									ВычетЗаМесяц = Мин(ДоходЗаМесяцОстаток, ОстатокВычета);
									ТекущиеОстаткиВычетов.Вставить(ВычетКСписанию.КодВычета, ОстатокВычета - ВычетЗаМесяц);
								КонецЕсли;	
								Если ВычетЗаМесяц <> 0 Тогда
									СтрокаТаблицыРезультата = ВычетыЗаМесяц.Добавить();	
									СтрокаТаблицыРезультата.КодВычета = ВычетКСписанию.КодВычета;
									СтрокаТаблицыРезультата.РазмерВычета = ВычетЗаМесяц;
									
									ЕстьВычетыЗаМесяц = Истина;
									ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетЗаМесяц;
									ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетЗаМесяц);
								КонецЕсли;
								
							КонецЦикла;	
						КонецЕсли;
						
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + ВычетыЗаМесяц.Итог("РазмерВычета");
					КонецЕсли;
					
					// Перенесем некоторые суммы вычетов из других месяцев.
					Если ПроводитьРасчетЗаОчереднойМесяц Тогда 
						// Учтем ранее не учтенные вычеты из-за отсутствия дохода в предшествующих месяцах налогового периода.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < МесяцНалоговогоПериода Тогда
								ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + Элемент.Значение;
								ВычетыПредыдущихМесяцев.Вставить(Элемент.Ключ, 0);
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;	
					Если ЗапоминатьВычетыНаБудущее Или ЕстьВычетыЗаМесяц И Не ПроводитьРасчетЗаОчереднойМесяц Тогда // Запомним вычеты на будущее.
						ВычетыПредыдущихМесяцев.Вставить(МесяцНалоговогоПериода, ?(ЗначениеЗаполнено(ВычетыПредыдущихМесяцев[МесяцНалоговогоПериода]), ВычетыПредыдущихМесяцев[МесяцНалоговогоПериода], 0) + Макс(ВсегоВычетовЗаМесяц - ОблагаемыйДоходЗаМесяц, 0));
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц - Макс(ВсегоВычетовЗаМесяц - ОблагаемыйДоходЗаМесяц, 0);
					КонецЕсли;	
					
					ТаблицаРаспределенияВычетов = РаспределениеДоходовФизлица.СкопироватьКолонки();

					НачисленныйДоходЗаДату = 0;
					ИспользованоВычетовЗаМесяц = 0;

					// Начнем расчет с вычитания уже зарегистрированных в учете вычетов, затем по мере расчета вычеты будут
					// "применяться" к конкретным доходам.
					
					// Строки примененных ранее стандартных вычетов отобрали ранее
					ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВспомогательнаяТаблицаВычетовМесяца, СтрокиСтандартныхВычетов);
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиСтандартныхВычетов, ПредоставленныеСтандартныеИСоциальныеВычеты);					
					// Строки примененных ранее имущественных вычетов отберем сейчас.
					СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;
					СтрокиВычетов = ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаИмущественныхВычетов);
					ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВспомогательнаяТаблицаВычетовМесяца, СтрокиВычетов);
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиВычетов, ИмущественныеВычеты);					
					
				КонецЕсли;	
				
				Если ПроводитьРасчетЗаОчереднойМесяц Тогда
					
					Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаЗаДату Тогда
						
						ОблагаемыйДоходНаНачалоМесяца = ОблагаемыйДоход;
						ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = 0;
						ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = 0;
						ЕстьДоходыПромежуточногоРасчета = Ложь;
						ЕстьДоходыОкончательногоРасчета = Ложь;
						
						СтруктураПоискаПоДатам.ДатаПолученияДохода = ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода;
						СтруктураПоискаПоДатам.ДоходМежрасчетногоПериода = Истина;
						ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаПоДатам)); 
						СтруктураПоискаПоДатам.ДоходМежрасчетногоПериода = Ложь;
						ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаПоДатам)); 
						
						ТаблицаРаспределенияНаДату = ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода.Скопировать();
						ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета, ТаблицаРаспределенияНаДату);
						Если ТаблицаРаспределенияНаДату.Итог("СуммаДохода") = 0 Тогда
							// если доходов за прошлый месяц нет - будем использовать текущее распределение
							Если ТаблицаРаспределенияМесяцаРасчета = Неопределено Тогда
								ТекущийГод = Год(МесяцРасчета);
								СтруктураПоискаРаспределения = Новый Структура("МесяцНалоговогоПериода");
								БазаРаспределения = 0;
								МесяцПоиска = НачалоМесяца(МесяцРасчета);                                             
								Пока БазаРаспределения = 0 И Год(МесяцПоиска) = ТекущийГод Цикл
									СтруктураПоискаРаспределения.МесяцНалоговогоПериода = МесяцПоиска;
									ТаблицаРаспределенияМесяцаРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаРаспределения));
									БазаРаспределения = ТаблицаРаспределенияМесяцаРасчета.Итог("СуммаДохода");
									МесяцПоиска = ДобавитьМесяц(МесяцПоиска, -1);
								КонецЦикла;
							КонецЕсли;
							ТаблицаРаспределенияНаДату = ТаблицаРаспределенияМесяцаРасчета;
						КонецЕсли;
						ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДату, ТаблицаРаспределенияВычетов);
						
					КонецЕсли;	
					
					НачисленныйДоходЗаДату = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход;
					Если ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода Тогда 
						ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
						ЕстьДоходыПромежуточногоРасчета = Истина;
					Иначе
						ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
						ЕстьДоходыОкончательногоРасчета = Истина;
					КонецЕсли;

					Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаДату Тогда
						
						// Расчет сумм налога
						Если Не ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаМесяц Тогда					
							Если ЕстьДоходыПромежуточногоРасчета Тогда
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
								НалогСДохода = Макс(Окр(ОблагаемыйДоходДляИсчисленияНалога * СтавкаДляРезидента) - НалогИсчисленный, 0);
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
							КонецЕсли;
							Если ЕстьДоходыОкончательногоРасчета Тогда
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(ОблагаемыйДоходДляИсчисленияНалога * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
							КонецЕсли;
						Иначе
							Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
								НалогСДохода = Макс(Окр(ОблагаемыйДоходДляИсчисленияНалога * СтавкаДляРезидента) - НалогИсчисленный, 0);
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(ОблагаемыйДоходДляИсчисленияНалога * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
								
								ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
								
							Иначе
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(ОблагаемыйДоходДляИсчисленияНалога * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ?(ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета));
								
								ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;	
							КонецЕсли;
						КонецЕсли;
						Если ВсеДатыТекущегоРасчета[ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода] = Неопределено Тогда
							СтрокиКУдалению.Очистить();
							РассчитаноНалогаЗаДату = 0;
							Для каждого СтрокаНалога Из ВспомогательнаяТаблицаМесяца Цикл
								Если СтрокаНалога.МесяцНалоговогоПериода = ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода Тогда
									РассчитаноНалогаЗаДату = РассчитаноНалогаЗаДату + СтрокаНалога.НалогПоСтавке13;
									СтрокиКУдалению.Вставить(СтрокаНалога);
								КонецЕсли;
							КонецЦикла;
							Если РассчитаноНалогаЗаДату = 0 Тогда
								Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
									ВспомогательнаяТаблицаМесяца.Удалить(УдаляемаяСтрока.Ключ);		
								КонецЦикла;	
							КонецЕсли;
						КонецЕсли;
						
						Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
							ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
						Иначе
							ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
						КонецЕсли;
						ВсегоВычетовЗаДату = НачисленныйДоходЗаДату - (ОблагаемыйДоходЗаДату - ОблагаемыйДоходНаНачалоМесяца) - ИспользованоВычетовЗаМесяц;
						ИспользованоВычетовЗаМесяц = ИспользованоВычетовЗаМесяц + ВсегоВычетовЗаДату;
						
						Если ВсегоВычетовЗаДату <> 0 Тогда
								
							// Таблица ВычетыЗаМесяц содержит строки с располагаемыми суммами вычетов, упорядоченные в соответствии с
							// наиболее выгодным для сотрудника приоритетом применения вычетов. Переписываем вычеты из таблицы ВычетыЗаМесяц
							// в таблицу ВспомогательнаяТаблицаВычетовМесяца (распределяя суммы по подразделениям из доходов этой даты
							// получения дохода) в пределах рассчитанного ранее примененного за дату вычета (если сумма вычета и остаток
							// вычета на дату одного знака, берем минимальное по модулю). Если располагаемая сумма вычета полностью исчерпана
							// (стала равна 0), удаляем строку из таблицы ВычетыЗаМесяц.
							ИндексПоследнейСтрокиТаблицыВычетов = ВычетыЗаМесяц.Количество() - 1;
							Индекс = 0;
							Пока Индекс <= ИндексПоследнейСтрокиТаблицыВычетов Цикл		
								ТекущийВычет = ВычетыЗаМесяц[Индекс];
								ЗначениеВычетаЗаМесяц = ТекущийВычет.РазмерВычета;
								Если ВсегоВычетовЗаДату * ЗначениеВычетаЗаМесяц > 0 Тогда		
									Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ЗначениеВычетаЗаМесяц, ВсегоВычетовЗаДату), Макс(ЗначениеВычетаЗаМесяц, ВсегоВычетовЗаДату));
									ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаВычетовМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению, '00010101', Учтено, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДату, ТекущийВычет);
									ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
									ТекущийВычет.РазмерВычета = ЗначениеВычетаЗаМесяц - Учтено;
									Если ТекущийВычет.РазмерВычета = 0 Тогда
										ВычетыЗаМесяц.Удалить(Индекс);
										ИндексПоследнейСтрокиТаблицыВычетов = ИндексПоследнейСтрокиТаблицыВычетов - 1;
										Индекс = Индекс - 1;
									КонецЕсли;
									Если ВсегоВычетовЗаДату = 0 Тогда
										Прервать;
									КонецЕсли;
								КонецЕсли;	
								Индекс = Индекс + 1;
							КонецЦикла;
							
							// Проверим не были ли ранее зарегистрированы в учете предоставленные сейчас вычеты;
							// если были, то при нулевом итоге таблицу очистим, а со следующей даты начнем накапливать вычеты "с чистого листа".
							Если ВспомогательнаяТаблицаВычетовМесяца.Итог("РазмерВычета") = 0 Тогда
								ИтогиПоВычетам = Новый Соответствие;
								Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									Значение = ИтогиПоВычетам[СтрокаТЗ.КодВычета];
									ИтогиПоВычетам.Вставить(СтрокаТЗ.КодВычета, ?(Значение = Неопределено, 0, Значение) + СтрокаТЗ.РазмерВычета)
								КонецЦикла;
								Если ИтогиПоВычетам.Количество() = 1 Тогда
									ВспомогательнаяТаблицаВычетовМесяца.Очистить();
								Иначе
									СтрокиКУдалению.Очистить();
									Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
										Если Не ЗначениеЗаполнено(ИтогиПоВычетам[СтрокаТЗ.КодВычета]) Тогда
											СтрокиКУдалению.Вставить(СтрокаТЗ, Истина)
										КонецЕсли;	
									КонецЦикла;
									Для каждого Элемент Из СтрокиКУдалению Цикл
										ВспомогательнаяТаблицаВычетовМесяца.Удалить(Элемент.Ключ)
									КонецЦикла;
								КонецЕсли;
							КонецЕсли;
						КонецЕсли;
						
					КонецЕсли;	
					
				КонецЕсли;	
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаМесяц Тогда				
					
					// Окончательный сбор вычетов в собственной таблице значений.
					
					Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
						Если Не ОписаниеВычетов[СтрокаТЗ.КодВычета].ИмущественныйВычет Тогда
							СтрокаТЗ.МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода
						КонецЕсли;
					КонецЦикла; 
					
					// Определяем дату получения дохода, к строке которой будут приписаны вычеты этого месяца.
					Если ОкончательныйРасчет Тогда
						Если ПроводитьРасчетЗаОчереднойМесяц Тогда
							ДатаУчетаВычетов = КонецМесяца(МесяцНалоговогоПериода)
						Иначе
							ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)];
							Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаПолученияДохода;
							ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
							ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчета;
							Иначе
								ДатаУчетаВычетов = ДатаНалоговогоПериода;
							КонецЕсли;
						КонецЕсли;
					Иначе
						ДатаУчетаВычетов = ОсновнаяДатаТекущегоРасчета;
					КонецЕсли;
					
					Если ЕстьВычетыЗаМесяц Тогда // Перераспределим итоговые суммы предоставленных вычетов по категориям, сохраняя подразделения.
						
						// Доходов в месяце может не быть, но вычеты приходится предоставлять, распределим их по доходам текущего расчета.
						Если Не ЗначениеЗаполнено(ТаблицаРаспределенияВычетов) Тогда
							Если ОкончательныйРасчет Тогда
								Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам;
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияКонцаМесяцаРасчета;
								Иначе
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияНалоговогоПериода;
								КонецЕсли;
							Иначе
								СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаТекущегоРасчета;
								ТаблицаРаспределенияВычетов = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							КонецЕсли;
						КонецЕсли;
						Если ЗначениеЗаполнено(ВычетыЗаМесяц) Тогда
							БылоСтрокВычетов = ВспомогательнаяТаблицаВычетовМесяца.Количество();
							Для Каждого ТекущийВычет Из ВычетыЗаМесяц Цикл
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаВычетовМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению, '00010101', ТекущийВычет.РазмерВычета, СтруктураПоиска, ТаблицаРаспределенияВычетов, ТекущийВычет);
							КонецЦикла;	
							Для Сч = БылоСтрокВычетов + 1 По ВспомогательнаяТаблицаВычетовМесяца.Количество() Цикл
								ВспомогательнаяТаблицаВычетовМесяца[Сч - 1].МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода
							КонецЦикла;
						КонецЕсли;
						
						ВычетыМесяца = ВспомогательнаяТаблицаВычетовМесяца.СкопироватьКолонки();
						
						ВспомогательнаяТаблицаВычетовМесяца.ЗаполнитьЗначения(ДатаУчетаВычетов, "МесяцНалоговогоПериода");
						ВспомогательнаяТаблицаВычетовМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода, КодВычета", "РазмерВычета");
						Если ВспомогательнаяТаблицаВычетовМесяца.Количество() > 0 Тогда
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица = ВспомогательнаяТаблицаВычетовМесяца.Скопировать( ,"Подразделение");
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Свернуть("Подразделение");
							Если ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Количество() = 1 Тогда
								Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									Если СтрокаТЗ.РазмерВычета <> 0 Тогда
										ВписатьРесурсВРезультатыРасчетов(ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатаУчетаВычетов, СтрокаТЗ.РазмерВычета, СтруктураПоиска, ТаблицаРаспределенияВычетов, СтрокаТЗ);
									КонецЕсли;
								КонецЦикла;
							Иначе 	
								ТаблицаДляРаспределенияПоПодразделению = ТаблицаРаспределенияВычетов.СкопироватьКолонки();
								СтрокиРаспределенияПоПодразделениям = Новый Соответствие;
								Для Каждого СтрокаТаблицыРаспределения Из ТаблицаРаспределенияВычетов Цикл
									СтрокиРаспределения = СтрокиРаспределенияПоПодразделениям[СтрокаТаблицыРаспределения.Подразделение];
									Если СтрокиРаспределения = Неопределено Тогда
										СтрокиРаспределения = Новый Массив;
										СтрокиРаспределенияПоПодразделениям.Вставить(СтрокаТаблицыРаспределения.Подразделение, СтрокиРаспределения);
									КонецЕсли;	
									СтрокиРаспределения.Добавить(СтрокаТаблицыРаспределения);
								КонецЦикла;	
								Для Каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									СтрокиРаспределения = СтрокиРаспределенияПоПодразделениям[СтрокаТЗ.Подразделение];
									Если СтрокиРаспределения = Неопределено Тогда
										ТаблицаРаспределения = ТаблицаРаспределенияВычетов.СкопироватьКолонки();
									Иначе
										ТаблицаРаспределения = ТаблицаРаспределенияВычетов.Скопировать(СтрокиРаспределения);
									КонецЕсли;	
									ВписатьРесурсВРезультатыРасчетов(ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатаУчетаВычетов, СтрокаТЗ.РазмерВычета, СтруктураПоиска, ТаблицаРаспределения, СтрокаТЗ);
								КонецЦикла;
							КонецЕсли;
						КонецЕсли;
						
					Иначе // У сторно-строк вычетов оставим имевшиеся ранее подразделения и категории.
						ВычетыМесяца = ВспомогательнаяТаблицаВычетовМесяца.Скопировать();
						Если ВспомогательнаяТаблицаВычетовМесяца.Количество() > 0 Тогда 
							ВычетыМесяца.ЗаполнитьЗначения(ДатаУчетаВычетов, "МесяцНалоговогоПериода");
						КонецЕсли;
					КонецЕсли;
					
					ВычетыМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода, КодВычета", "РазмерВычета");
					
					// Если у физ.лица также есть доходы, облагаемые не нарастающим итогом, - добавим и их тоже.
					ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельноПоФизическомуЛицу = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.НайтиСтроки(СтруктураПоиска);
					ДописыватьОсновнуюДатуПолученияДохода = Не ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)]);
					Для Каждого СтрокаТЗ Из ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельноПоФизическомуЛицу Цикл
						НалогСДохода = Окр(СтрокаТЗ.ДоходыБезВычетов * СтрокаТЗ.СтавкаЧислом);
						СтрокаНалога = ВспомогательнаяТаблицаМесяца.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаНалога, СтрокаТЗ, "ФизическоеЛицо, Подразделение, КатегорияДохода");
						СтрокаНалога.НалогПоСтавке13 = НалогСДохода;
						СтрокаНалога.МесяцНалоговогоПериода = СтрокаТЗ.ДатаПолученияДохода;
						Если ДописыватьОсновнуюДатуПолученияДохода И СтрокаТЗ.ДоходТекущегоРасчета Тогда
							МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
							ДатыТекущегоРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыТекущегоРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
						КонецЕсли;
						ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Удалить(СтрокаТЗ);
					КонецЦикла;	
					
					// В "межрасчетном" варианте оставляем только те результаты, которые соответствуют месяцу (-ам) получения дохода
					// текущего акта расчета.
					Если Не ОкончательныйРасчет И Не ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)]) И Не ЗначениеЗаполнено(ДатыТекущегоРасчетаНерезидента[Месяц(МесяцНалоговогоПериода)]) Тогда
						
						// В итоговую таблицу запишем только вычеты.
						ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
						
						Если МесяцНалоговогоПериода < КонецМесяца(МесяцРасчета) И ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") = 0 Тогда
							Для каждого СтрокаВычета Из ВычетыМесяца Цикл
								ДобавлятьРезультатМесяцаВИтогиФизлица = СтрокаВычета.РазмерВычета <> 0;
								Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
									Прервать;
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
						
						// Минимизируем появление отсутствующих в текущих доходах категорий дохода.
						Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
							
							ДатаМесяца = ОсновнаяДатаТекущегоРасчета;
							СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаТекущегоРасчета;
							ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							
							ДатыПодразделенияКатегории = ВспомогательныеДатыПодразделенияКатегории.СкопироватьКолонки();
							НаборИзмерений = ВычетыМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							НаборИзмерений.Свернуть("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НаборИзмерений, ДатыПодразделенияКатегории);
							Для каждого СтрокаТЗ Из ДатыПодразделенияКатегории Цикл
								СтрокаТЗ.ЗаменятьДатуПолученияДохода = Истина;
								СтрокаТЗ.ЗаменятьКатегориюДохода = ВсеКатегорииТекущегоРасчета[СтрокаТЗ.КатегорияДохода] = Неопределено;
								СтрокаТЗ.ЗаменятьПодразделение = МесяцНалоговогоПериода >= НачалоМесяца(МесяцРасчета) И НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода) = НачалоМесяца(ДатаМесяца);
								СтрокаТЗ.Распределение = ТаблицаРаспределенияТекущегоМесяца;
								Если ОсобыеКатегорииДохода[СтрокаТЗ.КатегорияДохода] = Истина Тогда
									СтрокаТЗ.ЗаменятьПодразделение = Ложь;
									СтрокаТЗ.ЗаменятьКатегориюДохода = Ложь;
								ИначеЕсли СтрокаТЗ.ЗаменятьПодразделение Тогда 	
									СтруктураПоискаПоДатамИПодразделениям.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
									СтруктураПоискаПоДатамИПодразделениям.Подразделение = СтрокаТЗ.Подразделение;
									СтрокаТЗ.ЗаменятьПодразделение = ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаПоДатамИПодразделениям).Количество() = 0;
								КонецЕсли;
							КонецЦикла;
							Если ДатыПодразделенияКатегории.Количество() > 2 Тогда
								ДатыПодразделенияКатегории.Индексы.Добавить("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							КонецЕсли;
							
							ВспомогательнаяТаблицаВычетовМесяца.Очистить();
							ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаВычетовМесяца, ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатыПодразделенияКатегории, ДатаМесяца, "МесяцПериодаПредоставленияВычета, КодВычета");
							
							// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
							ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаМесяца.СкопироватьКолонки(), ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов);
						КонецЕсли;
						
						ВспомогательнаяТаблицаМесяца.Очистить();
						
					Иначе 
					
						ИсчисленоНДФЛЗаГод = ИсчисленоНДФЛЗаГод + ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13");
						
						Если ПроводитьРасчетЗаОчереднойМесяц Тогда
							
							// Вычеркнем из результата строки по переброске некоторой суммы с одной категории на другую.
							ТаблицаМесяцаБезКатегорийДохода = ВспомогательнаяТаблицаМесяца.Скопировать();
							ТаблицаМесяцаБезКатегорийДохода.Свернуть("МесяцНалоговогоПериода, Подразделение", "НалогПоСтавке13");
							Для каждого СтрокаТЗ Из ТаблицаМесяцаБезКатегорийДохода Цикл
								Если СтрокаТЗ.НалогПоСтавке13 = 0 Тогда
									СтрокиКОбнулению = ВспомогательнаяТаблицаМесяца.НайтиСтроки(Новый Структура("МесяцНалоговогоПериода, Подразделение", СтрокаТЗ.МесяцНалоговогоПериода, СтрокаТЗ.Подразделение));
									Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
										ВспомогательнаяТаблицаМесяца.Удалить(СтрокаКОбнулению);
									КонецЦикла; 	
								КонецЕсли;
							КонецЦикла;
							
							// Минимизируем появление отсутствующих в текущих доходах дат получения и категорий дохода:
							// 1. Определяем подходящую дату получения дохода и соответствующее ей распределение
							// при этом некоторые результаты расчетов могут быть проигнорированы совсем.
							ДобавлятьРезультатМесяцаВИтогиФизлица = Истина;
							ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)];
							Если ОкончательныйРасчет Тогда
								Если Не ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда // перерасчет налога при отсутствии дохода текущего акта расчета
									Если МесяцНалоговогоПериода > КонецМесяца(МесяцРасчета) Тогда // перерасчет по будущим доходам не производим
										ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
									ИначеЕсли ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") = 0 И МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Тогда // нашли предшествующий месяц с нулевым налогом
										ВычетыДляПроверки = ВычетыМесяца.Скопировать(, "КодВычета, РазмерВычета");
										ВычетыДляПроверки.Свернуть("КодВычета", "РазмерВычета");
										ЕстьДанныеМесяца = Ложь;
										Для каждого СтрокаТЗ Из ВычетыДляПроверки Цикл
											ЕстьДанныеМесяца = СтрокаТЗ.РазмерВычета <> 0;
											Если ЕстьДанныеМесяца Тогда
												Прервать;
											КонецЕсли;
										КонецЦикла;
										Если Не ЕстьДанныеМесяца Тогда // игнорируем различные переброски сумм одного вычета, но не между вычетами 
											ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
											ВспомогательнаяТаблицаМесяца.Очистить();
										КонецЕсли;
									КонецЕсли;
								КонецЕсли;
								Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
									Если МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Тогда
										Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
											ДатаМесяца = ОсновнаяДатаПолученияДохода;
											СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
											ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
										ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
											ДатаМесяца = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам;
										ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
											ДатаМесяца = ОсновнаяДатаМесяцаРасчета;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияКонцаМесяцаРасчета;
										Иначе
											ДатаМесяца = ДатаНалоговогоПериода;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияНалоговогоПериода;
										КонецЕсли;
									Иначе
										Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
											ДатаМесяца = ОсновнаяДатаПолученияДохода;
											СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
											ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
										Иначе
											ДатаМесяца = ДатаНалоговогоПериода;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияНалоговогоПериода;
										КонецЕсли;
									КонецЕсли;
								КонецЕсли;
							Иначе	
								ДатаМесяца = ОсновнаяДатаПолученияДохода;
								СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
								ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							КонецЕсли;
							Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
								
								// 2. Заменяем даты получения дохода на подходящую и пересматриваем категорию дохода
								ДатыПодразделенияКатегории = ВспомогательныеДатыПодразделенияКатегории.СкопироватьКолонки();
								НаборИзмерений = ВспомогательнаяТаблицаМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВычетыМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение"), НаборИзмерений);
								НаборИзмерений.Свернуть("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НаборИзмерений, ДатыПодразделенияКатегории);
								Для каждого СтрокаТЗ Из ДатыПодразделенияКатегории Цикл
									СтрокаТЗ.ЗаменятьДатуПолученияДохода = ВсеДатыТекущегоРасчета[СтрокаТЗ.МесяцНалоговогоПериода] = Неопределено;
									СтрокаТЗ.ЗаменятьКатегориюДохода = ВсеКатегорииТекущегоРасчета[СтрокаТЗ.КатегорияДохода] = Неопределено;
									СтрокаТЗ.ЗаменятьПодразделение = МесяцНалоговогоПериода >= НачалоМесяца(МесяцРасчета) И НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода) = НачалоМесяца(ДатаМесяца);
									Если ОсобыеКатегорииДохода[СтрокаТЗ.КатегорияДохода] = Истина Тогда
										СтрокаТЗ.ЗаменятьПодразделение = Ложь;
										СтрокаТЗ.ЗаменятьКатегориюДохода = Ложь;
									ИначеЕсли СтрокаТЗ.ЗаменятьПодразделение Тогда 	
										СтруктураПоискаПоДатамИПодразделениям.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
										СтруктураПоискаПоДатамИПодразделениям.Подразделение = СтрокаТЗ.Подразделение;
										СтрокаТЗ.ЗаменятьПодразделение = ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаПоДатамИПодразделениям).Количество() = 0;
									КонецЕсли;
									Если СтрокаТЗ.ЗаменятьДатуПолученияДохода Тогда
										СтрокаТЗ.Распределение = ТаблицаРаспределенияТекущегоМесяца;
									Иначе
										СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
										СтрокаТЗ.Распределение = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
									КонецЕсли;
								КонецЦикла;
								Если ДатыПодразделенияКатегории.Количество() > 2 Тогда
									ДатыПодразделенияКатегории.Индексы.Добавить("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								КонецЕсли;
								
								ВспомогательнаяТаблицаФизическогоЛица = ВспомогательнаяТаблицаМесяца.СкопироватьКолонки();
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ДатыПодразделенияКатегории, ДатаМесяца);
								ВспомогательнаяТаблицаМесяца.Очистить();
								ВспомогательнаяТаблицаВычетовМесяца.Очистить();
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаВычетовМесяца, ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатыПодразделенияКатегории, ДатаМесяца, "МесяцПериодаПредоставленияВычета, КодВычета");
								
								// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
								ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов);
							КонецЕсли;
							
						Иначе
							
							// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
							ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаМесяца, ВычетыМесяца, ОписаниеВычетов);
							ВспомогательнаяТаблицаМесяца.Очистить();
							
						КонецЕсли;
						
					КонецЕсли;
					
				КонецЕсли;		
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаГод Тогда
					Если ИсчисленоНДФЛЗаГод <> 0 Тогда
						// вписываем зачтенные авансовые платежи иностранцев
						ВписатьАвансовыеПлатежиВРезультатРасчета(СтрокиНДФЛЗаГод, ОстаткиПоАвансовымПлатежам, ИсчисленоНДФЛЗаГод, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
					Иначе // игнорируем различные переброски сумм одного вычета, но не между вычетами
						НетДанных = Истина;
						Для каждого ЭлементОписания Из ОписаниеВычетов Цикл
							ИмяКолонки = ЭлементОписания.Значение.ИмяКолонки;
							СуммаВычета = 0; ЕстьЗначенияВКолонке = Ложь;
							Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
								СуммаВычета = СуммаВычета + СтрокаРезультата[ИмяКолонки];
								ЕстьЗначенияВКолонке = ЕстьЗначенияВКолонке Или СтрокаРезультата[ИмяКолонки] <> 0
							КонецЦикла;
							Если ЕстьЗначенияВКолонке И СуммаВычета = 0 Тогда
								Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
									Если ИмяКолонки = "ПримененныйВычетЛичный" Тогда
										СтрокаРезультата.КодВычетаЛичный = ""	
									КонецЕсли;
									СтрокаРезультата[ИмяКолонки] = 0
								КонецЦикла;
							КонецЕсли;
							НетДанных = НетДанных И СуммаВычета = 0;
						КонецЦикла;
						Если НетДанных Тогда // удаляем незначащие строки за год из результата
							Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
								РезультатРасчетаВспомогательный.Удалить(СтрокаРезультата)
							КонецЦикла;
						КонецЕсли;
					КонецЕсли;
					ПродолжатьРасчет = Ложь;
				Иначе
					ИндексТекущейСтрокиТаблицыДоходов = ИндексТекущейСтрокиТаблицыДоходов + 1;
				КонецЕсли;	
				
			КонецЦикла;  // по налоговым периодам физ.лиц
			
			Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаПоФизическомуЛицу Тогда // заканчиваем обработку физ.лица
				Если ОкончательныйРасчет Тогда
					// Допишем учтенные в расчете документы-основания.
					ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
					СоответствиеФизическихЛиц.Удалить(ТекущееФизическоеЛицо);
				Иначе 
					// Перенесем результаты расчета в основную таблицу с учетом ограничений.
					ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета, ВсегоДоходовТекущегоРасчета + ДоходыТекущегоРасчетаНерезидента.Итог("ДоходыБезВычетов"));	
				КонецЕсли;
			КонецЕсли;	
			
			ИндексТекущейСтрокиТаблицыДоходов = ИндексТекущейСтрокиТаблицыДоходов + 1;
			
		КонецЦикла;	
		
	КонецЕсли;
	
	// Продолжим расчет по нерезидентам.
	СтрокОтдельныхСумм = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Количество();
	Если СтрокОтдельныхСумм > 0 Тогда

		ИндексОбрабатываемойСтроки = 0;
		ТекущееФизическоеЛицо = Неопределено;
		ТекущийНалоговыйПериод = '00010101';
		МесяцНалоговогоПериодаПредыдущейСтроки = '00010101';
		СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Ложь;
		СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;
		// Если выполняется окончательный расчет, будем вписывать результат расчета сразу в таблицы результата.
		// В случае с промежуточным расчетом будем использовать промежуточную таблицу, а потом переносить в результирующую с
		// учетом ограничений.
		Если Не ОкончательныйРасчет Тогда
			РезультатРасчетаВспомогательный = РезультатРасчета.СкопироватьКолонки();
		КонецЕсли;	
		
		Пока ИндексОбрабатываемойСтроки <= СтрокОтдельныхСумм - 1 Цикл
			
			ТекущаяСтрока = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно[ИндексОбрабатываемойСтроки];
			
			Если ТекущаяСтрока.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда 
				
				Если ТекущееФизическоеЛицо <> Неопределено Тогда  // Завершение обработки предыдущего физлица.
					
					// вычтем ранее исчисленное
					СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
					Для СчМесяцев = 1 По Месяц(МесяцНалоговогоПериодаПредыдущейСтроки) Цикл
						СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев - 1);
						ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13");	
					КонецЦикла;
					
					// впишем засчитываемые авансовые платежи
					ВписатьАвансовыеПлатежиВРезультатРасчета(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
					
					// перепишем результаты за последний налоговый период
					ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов, Месяц(МесяцНалоговогоПериодаПредыдущейСтроки));
					
					// окончательно доработаем результаты
					Если ОкончательныйРасчет Тогда
						Если СоответствиеФизическихЛиц[ТекущееФизическоеЛицо] <> Неопределено Тогда // Допишем учтенные в расчете документы-основания.
							СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
							ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
						КонецЕсли;
					Иначе
						ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета);	
					КонецЕсли;
					
				КонецЕсли;
				
				ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо; // Начало обработки очередного физлица.
				ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода);
				ВспомогательнаяТаблицаМесяца.Очистить();
				Если Не ОкончательныйРасчет Тогда
					РезультатРасчетаВспомогательный.Очистить();
				КонецЕсли;	
				ЗаполнитьЗначенияСвойств(СтруктураПоискаСтандартныхВычетов, ТекущаяСтрока);
				ЗаполнитьЗначенияСвойств(СтруктураПоискаИмущественныхВычетов, ТекущаяСтрока);
			
			КонецЕсли;
			
			Если ТекущийНалоговыйПериод <> НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода) Тогда
				
				// Завершение обработки предыдущего налогового периода.
				
				// вычтем ранее исчисленное
				СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
				Для СчМесяцев = 0 По 11 Цикл
					СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев);
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13");	
				КонецЦикла;
				
				// впишем засчитываемые авансовые платежи
				ВписатьАвансовыеПлатежиВРезультатРасчета(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
				
				// перепишем результаты за налоговый период
				ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов);
				
				// Начало обработки очередного налогового периода.
				
				ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода); 
				ВспомогательнаяТаблицаМесяца.Очистить();
				
			КонецЕсли;
			
			// Расчет налога по очередной строке дохода.
			
			СтрокаНалога = ВспомогательнаяТаблицаМесяца.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНалога, ТекущаяСтрока, "ФизическоеЛицо, Подразделение, КатегорияДохода");
			СтрокаНалога.НалогПоСтавке13 = Окр(ТекущаяСтрока.ДоходыБезВычетов * ТекущаяСтрока.СтавкаЧислом);
			СтрокаНалога.МесяцНалоговогоПериода = ТекущаяСтрока.ДатаПолученияДохода;
			
			МесяцНалоговогоПериодаПредыдущейСтроки = ТекущаяСтрока.МесяцНалоговогоПериода;
			ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
			
		КонецЦикла;
		
		Если ТекущееФизическоеЛицо <> Неопределено Тогда  // Завершение обработки последнего по порядку физлица.
			
			// вычтем ранее исчисленное
			СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
			Для СчМесяцев = 1 По Месяц(ТекущаяСтрока.МесяцНалоговогоПериода) Цикл
				СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев - 1);
				ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13");	
			КонецЦикла;
			
			// впишем засчитываемые авансовые платежи
			ВписатьАвансовыеПлатежиВРезультатРасчета(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
			
			// перепишем результаты за последний налоговый период
			ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов, Месяц(ТекущаяСтрока.МесяцНалоговогоПериода));
					
			// окончательно доработаем результаты
			Если ОкончательныйРасчет Тогда
				Если СоответствиеФизическихЛиц[ТекущееФизическоеЛицо] <> Неопределено Тогда // Допишем учтенные в расчете документы-основания.
					СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
					ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
				КонецЕсли;
			Иначе
				ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета);	
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
	// Дозаполним категорию дохода значением по умолчанию.
	Для Каждого СтрокаРезультат Из РезультатРасчета Цикл
		Если Не ЗначениеЗаполнено(СтрокаРезультат.КатегорияДохода) Тогда
			СтрокаРезультат.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда;
		КонецЕсли;
	КонецЦикла;

	Возврат РезультатРасчета;
	
КонецФункции

Функция РассчитатьНалогДо2023Года(ИсключаемыйРегистратор, Организация, МесяцРасчета, Знач СписокФизическихЛиц, Знач ПервыйМесяцНалоговогоПериода = Неопределено, Знач ПоследнийМесяцНалоговогоПериода = Неопределено, Знач ОкончательныйРасчет = Истина, ДатаУдержанияИсчисленногоНалога = Неопределено, ДвиженияТекущегоРегистратора = Неопределено)
	
	// Прочитаем учетную политику.
	ГоловнаяОрганизация = ЗарплатаКадры.ГоловнаяОрганизация(Организация);
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ГоловнаяОрганизация);
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	УчетнаяПолитикаПоНДФЛ.ОсобенностиИсчисленияНДФЛ КАК ОсобенностиИсчисленияНДФЛ
	|ИЗ
	|	РегистрСведений.УчетнаяПолитикаПоНДФЛ КАК УчетнаяПолитикаПоНДФЛ
	|ГДЕ
	|	УчетнаяПолитикаПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация";
	Выборка = Запрос.Выполнить().Выбрать();
	// Признак, определяющий порядок накопления сумм стандартных вычетов. 
	ПрименятьСтандартныеВычетыНарастающимИтогом = Истина;
	Если Выборка.Следующий() Тогда
		ПрименятьСтандартныеВычетыНарастающимИтогом = Выборка.ОсобенностиИсчисленияНДФЛ = Перечисления.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом;
	КонецЕсли;
		
	// 0. Проверим, стОит ли вообще что-то считать: массив физ.лиц может быть пустым, либо доходы межрасчетного
	// регистратора могут быть нулевыми. В обоих случаях результатом расчетов окажется пустая таблица.
	Если Не ЗначениеЗаполнено(СписокФизическихЛиц) Тогда
		Возврат ТаблицаНДФЛ()
	КонецЕсли;
	ЕстьДвиженияТекущегоРегистратораПоДоходам = ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "СведенияОДоходахНДФЛ");
	Если Не ОкончательныйРасчет И Не ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		Возврат ТаблицаНДФЛ()
	КонецЕсли;
	Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		ДоходыТекущегоРегистратора = ДвиженияТекущегоРегистратора.СведенияОДоходахНДФЛ.Выгрузить();
		Если Не ОкончательныйРасчет Тогда
			ТаблицаДоходовТекущегоРегистратора = ДоходыТекущегоРегистратора.Скопировать(ДоходыТекущегоРегистратора.НайтиСтроки(Новый Структура("Сторно, ЗарегистрированоПриНачисленииАванса", Ложь, '00010101')), "ФизическоеЛицо, СуммаДохода, СуммаВычета");
			Если СписокФизическихЛиц.Количество() = 1 Тогда
				Если ТаблицаДоходовТекущегоРегистратора.Итог("СуммаДохода") - ТаблицаДоходовТекущегоРегистратора.Итог("СуммаВычета") = 0 Тогда
					Возврат ТаблицаНДФЛ()
				КонецЕсли;
			Иначе
				ТаблицаДоходовТекущегоРегистратора.Свернуть("ФизическоеЛицо", "СуммаДохода, СуммаВычета");
				Для каждого ТекущаяСтрока Из ТаблицаДоходовТекущегоРегистратора Цикл
					Если ТекущаяСтрока.СуммаДохода - ТекущаяСтрока.СуммаВычета = 0 Тогда
						ОбщегоНазначенияКлиентСервер.УдалитьЗначениеИзМассива(СписокФизическихЛиц, ТекущаяСтрока.ФизическоеЛицо)
					КонецЕсли;		
				КонецЦикла;
				Если Не ЗначениеЗаполнено(СписокФизическихЛиц) Тогда
					Возврат ТаблицаНДФЛ()
				КонецЕсли;
			КонецЕсли;  
			ОкончательныйРасчет = ДоходыТекущегоРегистратора.НайтиСтроки(Новый Структура("ЗарегистрированоПриНачисленииАванса", МесяцРасчета)).Количество() > 0;
		КонецЕсли;
	КонецЕсли;
	
	ЭтоРасчетПоДоходамТекущегоМесяца = ПервыйМесяцНалоговогоПериода = Неопределено Или ПоследнийМесяцНалоговогоПериода = Неопределено;
	НачалоМесяцаРасчета = НачалоМесяца(МесяцРасчета);
	КонецМесяцаРасчета = КонецМесяца(МесяцРасчета); 
	СоответствиеФизическихЛиц = ОбщегоНазначенияБЗККлиентСервер.МассивВСоответствие(СписокФизическихЛиц);
	МаксимальнаяДата = ЗарплатаКадрыПериодическиеРегистры.МаксимальнаяДата();
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
	
	ПоляПоиска = "ФизическоеЛицо, МесяцНалоговогоПериода";
	
	Запрос.УстановитьПараметр("НачалоМесяцаРасчета", НачалоМесяцаРасчета);
	Запрос.УстановитьПараметр("КонецМесяцаРасчета", КонецМесяцаРасчета);
	Запрос.УстановитьПараметр("СписокФизическихЛиц", СписокФизическихЛиц);
	Запрос.УстановитьПараметр("ИсключаемыйРегистратор", ИсключаемыйРегистратор);
	
	//  Порядок учета данных, зарегистрированных при начислении аванса 
	//  (порядок зачета авансов при проведении см. в описании метода ДополнитьДвиженияСписаниемАванса) 
	//  
	//	При отборе данных учитываем, что доходы по окончании месяца начисляются в полном размере, т.е. авансовые записи после окончательного расчета из учета "исчезают", 
	//	а все результаты (налог, зачтенные авансы и пр.) рассчитываются заново исходя из полных доходов. 
	//  Стандартные/имущественные вычеты после окончательного расчета повторно в результаты расчета не вписываем - эти авансовые данные считаем "настоящими".
	//  
	//  Таким образом:
	//  - авансовые движения прошлых месяцев (по значению поля ЗарегистрированоПриНачисленииАванса) учитываются во всех вариантах расчета как есть
	//  - при выполнении перерасчета по итогам периода учитываются все авансы пересчитываемого периода 
	//  - при выполнении промежуточного расчета данные авансов текущего месяца считаются данными другого промежуточного расчета
	//  - при выполнении окончательного расчета: 
	//		не читаем из учета авансовые движения текущего месяца по регистрам СведенияОДоходахНДФЛ, РасчетыНалогоплательщиковСБюджетомПоНДФЛ, 
	//			АвансовыеПлатежиИностранцевПоНДФЛ, из регистра ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ не читаем строки по социальному вычету 
	//			в размере удержаний на накопительную пенсию;
	//		корректируем данные о доходах текущего документа (по которому ведется расчет): "авансовую" часть доходов берем с датой фактической выплаты,   
	//			а невыплаченные на момент расчета авансы не учитываем совсем
	//  
	
	// 1.	Определим минимальные и максимальные периоды расчета в целом по всем физическим лицам
	//	Если на вход переданы первый и последний месяцы налогового периода (заказан перерасчет конкретного периода) - ничего не делаем.
	//	Среди записей регистра СведенияОДоходахНДФЛ, зарегистрированных в месяце расчета, получим минимальное и максимальное значение поля МесяцНалоговогоПериода
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		
		ПервыйМесяцНалоговогоПериода = МаксимальнаяДата;
		ПоследнийМесяцНалоговогоПериода = '00010101';
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	МАКСИМУМ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК ПоследнийМесяцНалоговогоПериода,
		|	МИНИМУМ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК ПервыйМесяцНалоговогоПериода
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
		|	И СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
		|	И &УсловиеОблагаемостиУНалоговогоАгента";
		Если ОкончательныйРасчет Тогда
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "И СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода", "");
		КонецЕсли;
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.ПервыйМесяцНалоговогоПериода) Тогда
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(Выборка.ПервыйМесяцНалоговогоПериода);
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(Выборка.ПоследнийМесяцНалоговогоПериода);
		КонецЕсли;
		
		Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
			
			ДоходыТекущегоРегистратора.Сортировать("МесяцНалоговогоПериода");
			
			Для Каждого ТекущаяСтрока Из ДоходыТекущегоРегистратора Цикл
				Если ТекущаяСтрока.МесяцНалоговогоПериода >= ПервыйМесяцНалоговогоПериода Тогда
					Прервать;
				КонецЕсли;
				Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] = Истина
					И ТекущаяСтрока.ГоловнаяОрганизация = ГоловнаяОрганизация
					И ТекущаяСтрока.Период >= НачалоМесяцаРасчета
					И ТекущаяСтрока.Период <= КонецМесяцаРасчета	
					И (ОкончательныйРасчет Или ТекущаяСтрока.ДоходМежрасчетногоПериода)	Тогда
					
					ПервыйМесяцНалоговогоПериода = НачалоМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
					Прервать;
				КонецЕсли;		 			
			КонецЦикла;	 
			Для Сч = 1 По ДоходыТекущегоРегистратора.Количество() Цикл
				ТекущаяСтрока = ДоходыТекущегоРегистратора[ДоходыТекущегоРегистратора.Количество() - Сч];
				Если ТекущаяСтрока.МесяцНалоговогоПериода <= ПоследнийМесяцНалоговогоПериода Тогда
					Прервать;
				КонецЕсли;
				Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] = Истина
					И ТекущаяСтрока.ГоловнаяОрганизация = ГоловнаяОрганизация
					И ТекущаяСтрока.Период >= НачалоМесяцаРасчета
					И ТекущаяСтрока.Период <= КонецМесяцаРасчета	
					И (ОкончательныйРасчет Или ТекущаяСтрока.ДоходМежрасчетногоПериода)	Тогда
					
					ПоследнийМесяцНалоговогоПериода = КонецМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
					Прервать;
				КонецЕсли;	
			КонецЦикла;
			
		КонецЕсли;
		
		Если ПоследнийМесяцНалоговогоПериода = '00010101' Тогда
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета);
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(МесяцРасчета);
		Иначе 	
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(Мин(ПоследнийМесяцНалоговогоПериода, '20221231'));
		КонецЕсли;	
		
	КонецЕсли;	
	
	// 1.1	Если расчет не затрагивает даже 2021 года, воспользуемся предыдущей реализацией алгоритма расчета
	ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.НачалоРасчетаНДФЛПоПрогрессивнойШкале;
	Если ПоследнийМесяцНалоговогоПериода < ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале Тогда
		Возврат РассчитатьНалогПоПлоскойСтавке(ИсключаемыйРегистратор, Организация, МесяцРасчета, СписокФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода, ОкончательныйРасчет, ДатаУдержанияИсчисленногоНалога, ДвиженияТекущегоРегистратора)
	КонецЕсли;
	
	// 1.2	Для пересмотра расчетов прошлых лет (2020 и ранее) воспользуемся предыдущей реализацией алгоритма расчета. 
	РезультатыПрошлыхЛет = ТаблицаНДФЛ();
	Если ПервыйМесяцНалоговогоПериода < ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале Тогда
		РезультатыПрошлыхЛет = РассчитатьНалогПоПлоскойСтавке(ИсключаемыйРегистратор, Организация, МесяцРасчета, СписокФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.НачалоРасчетаНДФЛПоПрогрессивнойШкале - 1, ОкончательныйРасчет, ДатаУдержанияИсчисленногоНалога, ДвиженияТекущегоРегистратора, Истина)
	КонецЕсли;
	ПервыйМесяцНалоговогоПериода = Макс(ПервыйМесяцНалоговогоПериода, ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале);
	
	// 2.	Получим ТЗ данные о доходах 
	//	Из регистра накоплений СведенияОДоходахНДФЛ получим записи, соответствующие условиям:
	//	- записи, зарегистрированные между началом года, предшествующего полученному на предыдущем шаге минимальному месяцу налогового периода, и окончанием месяца расчета
	//	- месяц налогового периода у записей между началом года месяца минимального налогового периода и концом месяца максимального налогового периода
	//	- доход облагается у налогового агента
	//	- ставка налогообложения дохода для налоговых резидентов РФ - 13%
	//	- записи с непустым значением в реквизите ЗарегистрированоПриНачисленииАванса (записи авансового расчета) учитываются по описанным выше правилам 
	//	Если выполняется промежуточный расчет, а доход зарегистрирован в месяце расчета только для окончательного расчета (ДоходМежрасчетногоПериода = Ложь), 
	//	сумму дохода и сумму вычета будем считать равными 0  
	//
	//	Затем добавим записи текущего набора доходов, применив к ним те же условия (уже на языке 1С), что и в запросе.
	
	НачалоПредшествующегоГода = ДобавитьМесяц(НачалоГода(ПервыйМесяцНалоговогоПериода), -12);;
	НачалоГодаПериодаРасчета = НачалоГода(ПервыйМесяцНалоговогоПериода);
	КонецПериодаРасчета = КонецМесяца(ПоследнийМесяцНалоговогоПериода);
	НачалоГодаРасчета = НачалоГода(МесяцРасчета); 
	
	Запрос.УстановитьПараметр("НачалоПредшествующегоГода", НачалоПредшествующегоГода);
	Запрос.УстановитьПараметр("НачалоГодаПериодаРасчета", НачалоГодаПериодаРасчета);
	Запрос.УстановитьПараметр("НачалоГодаРасчета", НачалоГодаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаРасчета", КонецПериодаРасчета);
	Запрос.УстановитьПараметр("ДатаОбъединенияНалоговыхБаз", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.ДатаОбъединенияНалоговыхБаз);
	Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза());
	Запрос.УстановитьПараметр("ПоОсновнойСтавке", Перечисления.КатегорииДоходовНДФЛ.ПоОсновнойСтавке());
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
	|	СведенияОДоходахНДФЛ.Период КАК Период,
	|	СведенияОДоходахНДФЛ.СтавкаНалогообложения КАК СтавкаНалогообложения,
	|	&ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
	|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
	|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК НалоговыйПериод,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
	|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
	|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
	|	КОНЕЦ КАК ДокументОснование,
	|	ЕСТЬNULL(СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам, ЛОЖЬ) КАК НеПредоставляетсяНерезидентам,
	|	СУММА(ВЫБОР
	|			КОГДА &ОкончательныйРасчетДоходы
	|				ТОГДА СведенияОДоходахНДФЛ.СуммаДохода
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК СуммаДохода,
	|	СУММА(ВЫБОР
	|			КОГДА &ОкончательныйРасчетДоходы
	|				ТОГДА СведенияОДоходахНДФЛ.СуммаВычета
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК СуммаВычета,
	|	ВЫБОР
	|		КОГДА &ОкончательныйРасчетДоходы
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ИспользоватьДляРаспределения,
	|	&УчитыватьПериодПриРасчете КАК УчитыватьПериодПриРасчете,
	|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор КАК ДоходТекущегоРасчета,
	|	СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса КАК ЗарегистрированоПриНачисленииАванса
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДокументыУчтенныеПриРасчетеНДФЛ КАК ДокументыУчтенныеПриРасчетеНДФЛ
	|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДокументыУчтенныеПриРасчетеНДФЛ.ФизическоеЛицо
	|			И СведенияОДоходахНДФЛ.Регистратор = ДокументыУчтенныеПриРасчетеНДФЛ.ДокументОснование
	|ГДЕ
	|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
	|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|	И (СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
	|	И &УсловиеОблагаемостиУНалоговогоАгента
	|	И &УсловиеНаНачисленноеВАванс
	|	И (СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
	|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаОбъединенияНалоговыхБаз
	|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода В (&ПоОсновнойСтавке)
	|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода >= &ДатаОбъединенияНалоговыхБаз)
	|
	|СГРУППИРОВАТЬ ПО
	|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
	|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД),
	|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
	|	СведенияОДоходахНДФЛ.Подразделение,
	|	СведенияОДоходахНДФЛ.Период,
	|	СведенияОДоходахНДФЛ.СтавкаНалогообложения,
	|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
	|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
	|	СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам,
	|	СведенияОДоходахНДФЛ.КодВычета,
	|	СведенияОДоходахНДФЛ.КодДохода,
	|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
	|	СведенияОДоходахНДФЛ.КатегорияДохода,
	|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
	|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
	|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
	|	КОНЕЦ,
	|	СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса
	|
	|ИМЕЮЩИЕ
	|	(СУММА(ВЫБОР
	|				КОГДА &ОкончательныйРасчетДоходы
	|					ТОГДА СведенияОДоходахНДФЛ.СуммаДохода
	|				ИНАЧЕ 0
	|			КОНЕЦ) <> 0
	|		ИЛИ СУММА(ВЫБОР
	|				КОГДА &ОкончательныйРасчетДоходы
	|					ТОГДА СведенияОДоходахНДФЛ.СуммаВычета
	|				ИНАЧЕ 0
	|			КОНЕЦ) <> 0)";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеНаНачисленноеВАванс", ?(Не ОкончательныйРасчет, "Истина", ?(ЭтоРасчетПоДоходамТекущегоМесяца, "СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса < &НачалоМесяцаРасчета", "СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса < &КонецМесяцаРасчета")));
	Если ОкончательныйРасчет Тогда
		Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", 
			"ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
			|			ТОГДА ЛОЖЬ
			|		ИНАЧЕ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
			|	КОНЕЦ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", "СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета");
		Иначе // перерасчет за период	
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.Период КАК Период", "&НачалоГодаРасчета КАК Период");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.Период,", "");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", "ЛОЖЬ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода", "ЛОЖЬ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", "Истина");
		КонецЕсли;
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетДоходы", "Истина");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", 
		"ВЫБОР
		|		КОГДА СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода ИЛИ СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|	КОНЕЦ");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", 
		"&ОкончательныйРасчетДоходы
		|				И (СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета)");
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетДоходы", 
		"(СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
		|					ИЛИ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода 
		|					ИЛИ СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0))");
	КонецЕсли;
	ДанныеУчетаДоходов = Запрос.Выполнить().Выгрузить();
	
	Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		ДоходыТекущегоРегистратора.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, Подразделение, Период, СтавкаНалогообложения, ДоходМежрасчетногоПериода, ИсточникДоходаЗаПределамиРФ, КодВычета, КодДохода, КатегорияДохода, Сторно, ЗарегистрированоПриНачисленииАванса, ДокументОснование", "СуммаДохода, СуммаВычета");
		СтавкаРезидента13 = Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка13;
		НеДобавлятьДанныеАвансов = Не УчетНДФЛ.ДоходыУчитываютсяТолькоПоДатеВыплаты(МесяцРасчета, -1);
		Для Каждого ТекущаяСтрока Из ДоходыТекущегоРегистратора Цикл
			Если ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
				Если НеДобавлятьДанныеАвансов Тогда
					Продолжить;
				КонецЕсли;
				Если ТекущаяСтрока.МесяцНалоговогоПериода < НачалоМесяцаРасчета Тогда
					// пропускаем движения авансов прошлых месяцев
					Продолжить;
				КонецЕсли;
				Если ЗначениеЗаполнено(ТекущаяСтрока.ДокументОснование) И ТекущаяСтрока.ДокументОснование <> ИсключаемыйРегистратор Тогда
					// пропускаем движения списания невыплаченных авансов текущего месяца
					Продолжить;
				КонецЕсли;
			КонецЕсли;
			Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] = Истина
				И (ТекущаяСтрока.КодДохода.СтавкаНалогообложенияРезидента = СтавкаРезидента13 Или ТекущаяСтрока.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.Дивиденды)
				И УчетНДФЛ.ДоходОблагаетсяУНалоговогоАгента(ТекущаяСтрока.КодДохода, ТекущаяСтрока.ДатаПолученияДохода) 
				И ТекущаяСтрока.МесяцНалоговогоПериода >= ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале
				И ТекущаяСтрока.МесяцНалоговогоПериода < ПоследнийМесяцНалоговогоПериода Тогда
				
				НоваяСтрока = ДанныеУчетаДоходов.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
				НоваяСтрока.ДокументОснование = ИсключаемыйРегистратор;
				НоваяСтрока.НеПредоставляетсяНерезидентам = Ложь;
				Если ЗначениеЗаполнено(ТекущаяСтрока.КодВычета) Тогда
					НоваяСтрока.НеПредоставляетсяНерезидентам = ТекущаяСтрока.КодВычета.НеПредоставляетсяНерезидентам;
				КонецЕсли;
				НоваяСтрока.СтавкаНалогообложенияРезидента = СтавкаРезидента13;
				НоваяСтрока.НалоговыйПериод = НачалоГода(НоваяСтрока.МесяцНалоговогоПериода);
				НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(НоваяСтрока.МесяцНалоговогоПериода);
				НоваяСтрока.УчитыватьПериодПриРасчете = ТекущаяСтрока.Период >= НачалоГодаРасчета И ТекущаяСтрока.Период <= КонецМесяцаРасчета;	
				НоваяСтрока.ДоходТекущегоРасчета = Не ТекущаяСтрока.Сторно;	
				НоваяСтрока.ИспользоватьДляРаспределения = Истина;
				Если ОкончательныйРасчет Тогда
					НоваяСтрока.ДоходМежрасчетногоПериода = Ложь
				КонецЕсли;
				
				Если ОкончательныйРасчет И ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
					// Зачтем выплаченное в аванс в счет начисленного в окончательном расчете с сохранением фактической даты получения дохода по выплаченному авансу.
					Если ДатаУдержанияИсчисленногоНалога > '20230101' Тогда
						НоваяСтрока.СуммаДохода = -НоваяСтрока.СуммаДохода;
						НоваяСтрока.СуммаВычета = -НоваяСтрока.СуммаВычета;
					Иначе
						ВтораяСтрока = ДанныеУчетаДоходов.Добавить();
						ЗаполнитьЗначенияСвойств(ВтораяСтрока, НоваяСтрока);
						НоваяСтрока.СуммаДохода = -НоваяСтрока.СуммаДохода;
						НоваяСтрока.СуммаВычета = -НоваяСтрока.СуммаВычета;
						ВтораяСтрока.ДатаПолученияДохода = ДатаУдержанияИсчисленногоНалога;
						ВтораяСтрока.НалоговыйПериод = НачалоГода(ВтораяСтрока.ДатаПолученияДохода);
						ВтораяСтрока.МесяцНалоговогоПериода = НачалоМесяца(ВтораяСтрока.ДатаПолученияДохода);
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;			
		КонецЦикла;	
	КонецЕсли;	
	НеучтенныеРанееОснования = ДанныеУчетаДоходов.Скопировать(Новый Структура("ДоходТекущегоРасчета", Истина), "ФизическоеЛицо, ДокументОснование");
	НеучтенныеРанееОснования.Свернуть("ФизическоеЛицо, ДокументОснование");
	НеучтенныеРанееОснования.Индексы.Добавить("ФизическоеЛицо");
	ДанныеУчетаДоходов.Сортировать("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода", Новый СравнениеЗначений);
	
	// 3.	Определим минимальные и максимальные месяцы налогового периода по физическим лицам. Результат работы метода - таблица значений (ПериодыРасчетаПоФизическимЛицам)
	ПериодыРасчетаПоФизическимЛицам = Новый ТаблицаЗначений;
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("НачалоГодаНалоговогоПериода", Новый ОписаниеТипов("Дата"));
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("ПоследнийМесяцНалоговогоПериода", Новый ОписаниеТипов("Дата"));
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		//	Среди записей о доходах, полученных на предыдущем шаге, отбираем строки к осмотру по условиям (ранее рассчитано в поле УчитыватьПериодПриРасчете):  
		//	- запись зарегистрирована между началом года месяца расчета и концом месяца расчета
		//	- если выполняется промежуточный расчет, доход зарегистрирован раньше месяца расчета, а в месяце расчета только промежуточного расчета (ДоходМежрасчетногоПериода = Истина)
		//	Минимальная дата (НачалоГодаНалоговогоПериода): если запись зарегистрирована в месяце расчета, возьмем начало года месяца налогового периода этой записи, 
		//		если зарегистрирована в предыдущих месяцах, возьмем начало года от месяца расчета.
		//	Максимальная дата (ПоследнийМесяцНалоговогоПериода): максимальный месяц налогового периода 
		ТекущееФизическоеЛицо = Неопределено;
		Для Каждого СтрокаТаблицыДоходов Из ДанныеУчетаДоходов Цикл
			Если СтрокаТаблицыДоходов.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда  
				СтрокаПериодовПоФизическомуЛицу = ПериодыРасчетаПоФизическимЛицам.Добавить();
				СтрокаПериодовПоФизическомуЛицу.ФизическоеЛицо = СтрокаТаблицыДоходов.ФизическоеЛицо;
				СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода = МаксимальнаяДата;
				
				ТекущееФизическоеЛицо = СтрокаПериодовПоФизическомуЛицу.ФизическоеЛицо; 
			КонецЕсли;
			Если СтрокаТаблицыДоходов.УчитыватьПериодПриРасчете Тогда
				СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода = Мин(?(НачалоМесяца(СтрокаТаблицыДоходов.Период) = НачалоМесяцаРасчета, СтрокаТаблицыДоходов.НалоговыйПериод, НачалоГодаРасчета), СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода);
				СтрокаПериодовПоФизическомуЛицу.ПоследнийМесяцНалоговогоПериода = Макс(СтрокаТаблицыДоходов.МесяцНалоговогоПериода, СтрокаПериодовПоФизическомуЛицу.ПоследнийМесяцНалоговогоПериода);
			КонецЕсли;	
		КонецЦикла;	
	Иначе
		// В случае если расчет выполняется не по доходам текущего месяца, в качестве НачалоГодаНалоговогоПериода будем
		// использовать начала года первого месяца периода, переданного на вход алгоритма расчета, в качестве
		// ПоследнийМесяцНалоговогоПериода - первый день месяца окончания периода, переданного на вход алгоритма расчета
		НачалоПоследнегоМесяцаНалоговогоПериода = НачалоМесяца(ПоследнийМесяцНалоговогоПериода);
		Для Каждого ТекущееФизическоеЛицо Из СписокФизическихЛиц Цикл
			СтрокаТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.Добавить();
			СтрокаТаблицыПериодов.ФизическоеЛицо = ТекущееФизическоеЛицо;
			СтрокаТаблицыПериодов.НачалоГодаНалоговогоПериода = НачалоГодаПериодаРасчета;
			СтрокаТаблицыПериодов.ПоследнийМесяцНалоговогоПериода = НачалоПоследнегоМесяцаНалоговогоПериода;
		КонецЦикла;	
	КонецЕсли;	
	ПериодыРасчетаПоФизическимЛицам.Индексы.Добавить("ФизическоеЛицо");

	// 4.	Получим данные о статусе налогоплательщиков физических лиц (ТЗ СтатусыФизическихЛиц) из регистра сведений СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.
	//	Вход: список физических лиц,  ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода
	//	Выход: таблица значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, Статус, РезидентРФНаКонецМесяца, ПрименяетсяСтавкаПункта1Статьи224НК, РезидентРФНаКонецГода, СтатусНаКонецГода
	//			таблица индексирована по колонке ФизическоеЛицо 
	//	Описание алгоритма: 
	//		Читаем записи регистра СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный с отбором по списку физических лиц, действующие на начало года минимального месяца расчета, а также зарегистрированные между началом года минимального месяца расчета и концом максимального месяца расчета
	//		Применим отбор по списку физических лиц 
	СтатусыФизическихЛиц = СтатусыФизическихЛиц(СписокФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода);	

	// 5.	Для каждой строки полученных ранее данных учета доходов определим 
	//	- Ставку налогообложения (СтавкаЧислом)
	//	- Рассчитывать ли доход нарастающим итогом (ИсчислятьНалогНарастающимИтогом)
	//	- Сумму дохода за минусом вычета (ДоходыБезВычетов)
	//	- Сумму, используемую как коэффициент при распределении результатов расчета по подразделениям и категориям доходов (БазаРаспределения)
	//		... равна сумме дохода без вычета, для всех строк, если выполняется окончательный расчет, или для строк доходов, зарегистрированных для промежуточного расчета, и для всех строк, зарегистрированных раньше месяца расчета.
	ДополнитьДанныеУчетаСтавками(ДанныеУчетаДоходов, "УчитыватьИзмененияСтатусаДляРасчета", , СтатусыФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода);		
	ДанныеУчетаДоходов.Колонки.Добавить("ДоходыБезВычетов", Новый ОписаниеТипов("Число"));
	ДанныеУчетаДоходов.Колонки.Добавить("БазаРаспределения", Новый ОписаниеТипов("Число"));
	СтрокиКУдалению = Новый Соответствие;
	Для Каждого СтрокаТаблицыДоходов Из ДанныеУчетаДоходов Цикл
		Если СтрокаТаблицыДоходов.РезидентРФвНалоговомПериоде Или Не СтрокаТаблицыДоходов.ИсточникДоходаЗаПределамиРФ Тогда
			Если СтрокаТаблицыДоходов.ИсточникДоходаЗаПределамиРФ Тогда
				УчитыватьВычет = СтрокаТаблицыДоходов.УчитыватьВычетыКДоходамОтИсточникаВнеРФ;
			Иначе 
				УчитыватьВычет = СтрокаТаблицыДоходов.УчитыватьВсеВычетыКДоходамОтИсточникаРФ Или Не СтрокаТаблицыДоходов.НеПредоставляетсяНерезидентам 
			КонецЕсли;
			СтрокаТаблицыДоходов.ДоходыБезВычетов = СтрокаТаблицыДоходов.СуммаДохода - ?(УчитыватьВычет, СтрокаТаблицыДоходов.СуммаВычета, 0);
			Если СтрокаТаблицыДоходов.ИспользоватьДляРаспределения Тогда
				СтрокаТаблицыДоходов.БазаРаспределения = СтрокаТаблицыДоходов.ДоходыБезВычетов;
			КонецЕсли;				
		Иначе
			СтрокиКУдалению.Вставить(СтрокаТаблицыДоходов)
		КонецЕсли;
	КонецЦикла;
	Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
		ДанныеУчетаДоходов.Удалить(УдаляемаяСтрока.Ключ);		
	КонецЦикла;	
	ДанныеУчетаДоходов.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КодДохода, Подразделение, СтавкаЧислом, ИсчислятьНалогНарастающимИтогом, ДоходМежрасчетногоПериода, КатегорияДохода, ДоходТекущегоРасчета", "ДоходыБезВычетов, СуммаДохода, БазаРаспределения");
 	ДанныеУчетаДоходов.Колонки.СуммаДохода.Имя = "ВсеДоходы";
	
	// 6.	Поделим доходы на две части: для расчета налога нарастающим итогом и по каждой сумме дохода отдельно (абзацы первый и второй пункта 3 статьи 226 НК РФ)

	//	Для выделения доходов с расчетом налога по каждой сумме дохода отдельно из таблицы значений с данными учета доходов (где ранее рассчитана ставка налогообложения и признак расчета налога нарастающим итогом) 
	//	скопируем все строки с ИсчислятьНалогНарастающимИтогом = Ложь
	ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно = ДанныеУчетаДоходов.Скопировать(Новый Структура("ИсчислятьНалогНарастающимИтогом", Ложь));	
	//	Под "каждой суммой", для которой будем исчислять налог, понимаем сумму доходов физ.лица в одну дату получения дохода, по одному коду дохода, подразделению, категории, начисленную по отдельному основанию.
	ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, Подразделение, КатегорияДохода, СтавкаЧислом, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", "ДоходыБезВычетов");

	// В основной таблице оставим только доходы, по которым налог исчисляется нарастающим итогом.
	СоответствиеНерезидентов = Новый Соответствие;
	СтрокОтдельныхСумм = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Количество();
	Если СтрокОтдельныхСумм > 0 Тогда
		
		ДанныеУчетаДоходов = ДанныеУчетаДоходов.Скопировать(Новый Структура("ИсчислятьНалогНарастающимИтогом", Истина));
		
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Индексы.Добавить(ПоляПоиска);
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Сортировать(ПоляПоиска, Новый СравнениеЗначений);
		
		СтрокиКУдалению = Новый Соответствие;
		ТекущееФизическоеЛицо = Неопределено; 
		ИндексОбрабатываемойСтроки = 0;
		Пока ИндексОбрабатываемойСтроки <= СтрокОтдельныхСумм - 1 Цикл
			
			ТекущаяСтрока = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно[ИндексОбрабатываемойСтроки];
			ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
			Если ТекущаяСтрока.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда // Начало обработки очередного физлица.
				ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо; 
				МесяцНачала = '00010101'; МесяцОкончания = '00010101';
				СтрокиТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.НайтиСтроки(Новый Структура("ФизическоеЛицо", ТекущееФизическоеЛицо));
				Если СтрокиТаблицыПериодов.Количество() > 0 Тогда
					МесяцНачала = СтрокиТаблицыПериодов[0].НачалоГодаНалоговогоПериода;
					МесяцОкончания = СтрокиТаблицыПериодов[0].ПоследнийМесяцНалоговогоПериода;
				КонецЕсли;
			КонецЕсли;	
			Если Не (ТекущаяСтрока.МесяцНалоговогоПериода >= МесяцНачала И ТекущаяСтрока.МесяцНалоговогоПериода <= МесяцОкончания) Тогда
				СтрокиКУдалению.Вставить(ТекущаяСтрока);
			КонецЕсли;	
			
		КонецЦикла;
		Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
			ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Удалить(УдаляемаяСтрока.Ключ);		
		КонецЦикла;	
		
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Индексы.Добавить("ФизическоеЛицо, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода");
		СоответствиеНерезидентов = ОбщегоНазначенияБЗККлиентСервер.МассивВСоответствие(ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.ВыгрузитьКолонку("ФизическоеЛицо"));
		
	КонецЕсли;
	
	РассчитыватьНалогНарастающимИтогом = ДанныеУчетаДоходов.Количество() > 0;
	
	// данные о праве на вычеты будем читать только при наличии резидентов
	Если РассчитыватьНалогНарастающимИтогом Тогда 
		
		// 7.	Получим таблицу с данными для распределения результатов расчета по подразделениям и категориям
		//	Из таблицы значений с данными учета доходов с дополнительно рассчитанной на предыдущем шаге колонкой БазаРаспределения
		//	копированием получаем новую таблицу значений, данные которой сгруппированы по полям 
		//	ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета
		ДоходыПоПодразделениямИКатегориям = ДанныеУчетаДоходов.Скопировать(, "ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета, ДоходыБезВычетов, БазаРаспределения");
		ДоходыПоПодразделениямИКатегориям.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета", "ДоходыБезВычетов, БазаРаспределения");
		ДоходыПоПодразделениямИКатегориям.Колонки.ДоходыБезВычетов.Имя = "СуммаДоходаТекущегоРасчета"; 
		ДоходыПоПодразделениямИКатегориям.Колонки.БазаРаспределения.Имя = "СуммаДохода"; 
		ДоходыПоПодразделениямИКатегориям.Индексы.Добавить("ФизическоеЛицо");
		
		// 8.	Дополним таблицу значений с данными учета доходов итогами по месяцам и датам получения дохода, в том числе нарастающим итогом с начала года. 
		//		В результате в таблице должно получиться как минимум по одной строке на каждый месяц, по которому выполняется расчет по физическому лицу. 
		//	В таблице данных учета оставляем колонки ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода, ДоходыБезВычетов, ВсеДоходы, БазаРаспределения
		//	и добавляем:
		//	- ОблагаемыйДоход - облагаемый доход нарастающим итогом с начала месяца этой даты по дату получения дохода из строки таблицы, причем строка с ДоходМежрасчетногоПериода = Истина предшествует строке "окончательного расчета" той же даты и не включает доход "окончательного расчета".
		//	- ОблагаемыйДоходНарастающимИтогом - облагаемый доход на конец месяца нарастающим итогом с начала года, заполняется только для первой строки за месяц.
		//	- ОблагаемыйДоходЗаМесяц - облагаемый доход месяца (доход - вычеты к доходам), заполняется только для первой строки за месяц.
		//	- ВсеДоходыЗаМесяц - сумма доходов месяца (без учета вычетов), служит флажком наличия доходов, заполняется только для первой строки за месяц.
		//	- СтаршийМесяцПолученияДохода - наибольший месяц налогового периода, за который имеется положительный доход (без учета вычетов), служит ограничением для расчета вычетов, заполняется только для первой строки за месяц.
		//	Для последующего удобства обхода таблицы добавляем признаки первой и последней строки по физическому лицу, налоговому периоду, месяцу налогового периода и дате получения дохода.
		ДанныеУчетаДоходов.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода", "ДоходыБезВычетов, ВсеДоходы");	
		ДанныеУчетаДоходов.Сортировать("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода УБЫВ", Новый СравнениеЗначений);
		
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоход", Новый ОписаниеТипов("Число")); 
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоходНарастающимИтогом", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоходЗаМесяц", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("ВсеДоходыЗаМесяц", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("СтаршийМесяцПолученияДохода", Новый ОписаниеТипов("Дата"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаДату", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаМесяц", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаГод", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаПоФизическомуЛицу", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаДату", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаМесяц", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаГод", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаПоФизическомуЛицу", Новый ОписаниеТипов("Булево"));
		
		//	Описание алгоритма:
		//	В результирующей таблице (для экономии памяти, модифицируем входную таблицу с доходами) будут строки на каждую дату получения дохода, причем если на дату зарегистрирован 
		//	доход для промежуточного и для окончательно расчета, на дату будет две строки с разными значениями ДоходМежрасчетногоПериода. 
		//	Если облагаемый доход нарастающим итогом с начала месяца по дату получения дохода равен 0 и эта строка не является последней за месяц, то не будем оставлять ее в таблице.
		//	Если за месяц, входящий в период расчета по физическому лицу, вообще не было зарегистрировано доходов, то добавим строку с датой получения дохода, равной концу месяца.
		//	При расчете поля ОблагаемыйДоход (доход нарастающим итогом с начала месяца этой даты по дату получения дохода):
		//		если в строке отражен доход межрасчетного периода (ДоходМежрасчетногоПериода = Истина), возьмем все доходы за предыдущие даты месяца и доход текущей строки
		//		если в строке отражен доход окончательного расчета (ДоходМежрасчетногоПериода = Ложь), возьмем все доходы за предыдущие даты месяца и все доходы за текущую дату
		//	Алгоритм реализуется оптимальным образом за счет сортировки предварительно свернутой таблицы с данными учета доходов  по полям ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода (по убыванию)  
		СтрокиКУдалению = Новый Соответствие;
		ИндексОбрабатываемойСтроки = 0;
		Пока ИндексОбрабатываемойСтроки <= ДанныеУчетаДоходов.Количество() - 1 Цикл
			
			СтрокиПоФизическомуЛицу = Новый Массив;
			ПервыеСтрокиМесяцев = Новый Массив;
			ТекущаяСтрока = ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки];
			ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо;
			
			МесяцНачала = '00010101';
			МесяцОкончания = '00010101';
			СтрокиТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.НайтиСтроки(Новый Структура("ФизическоеЛицо", ТекущееФизическоеЛицо));
			Если СтрокиТаблицыПериодов.Количество() > 0 Тогда
				МесяцНачала = СтрокиТаблицыПериодов[0].НачалоГодаНалоговогоПериода;
				МесяцОкончания = СтрокиТаблицыПериодов[0].ПоследнийМесяцНалоговогоПериода;
			КонецЕсли;
			
			ПоследнийОбработанныйМесяц = ТекущаяСтрока.МесяцНалоговогоПериода;
			ПоследнийМесяцДополнения = Мин(НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода), МесяцОкончания);
			ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, МесяцНачала, ПоследнийМесяцДополнения, ИндексОбрабатываемойСтроки);	
			
			ПредыдущаяСтрока = Неопределено;
			ПредыдущийНалоговыйПериод = Неопределено;
			Пока ИндексОбрабатываемойСтроки <= ДанныеУчетаДоходов.Количество() - 1 И ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки].ФизическоеЛицо = ТекущееФизическоеЛицо Цикл
				
				ТекущаяСтрока = ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки];
				ТекущийМесяцНалоговогоПериода = ТекущаяСтрока.МесяцНалоговогоПериода;
				
				Если Не (ТекущийМесяцНалоговогоПериода >= МесяцНачала И ТекущийМесяцНалоговогоПериода <= МесяцОкончания) Тогда
					ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
					СтрокиКУдалению.Вставить(ТекущаяСтрока);
					Продолжить;
				КонецЕсли;	
				
				УдалятьТекущуюСтроку = Ложь;
				ТекущийНалоговыйПериод = НачалоГода(ТекущийМесяцНалоговогоПериода);
				
				Если ТекущийНалоговыйПериод <> ПредыдущийНалоговыйПериод Или ПредыдущаяСтрока = Неопределено Тогда	
					
					Если ПредыдущаяСтрока <> Неопределено Тогда
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаГод = Истина;
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаМесяц = Истина;
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
						РассчитатьСтаршийМесяцПолученияДохода(ПервыеСтрокиМесяцев);
					КонецЕсли;	
					
					ПоследнийМесяцДополнения = Мин(ТекущийМесяцНалоговогоПериода, МесяцОкончания);
					ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод, ПоследнийМесяцДополнения, ИндексОбрабатываемойСтроки);			
					
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаГод = Месяц(ТекущийМесяцНалоговогоПериода) = 1;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаМесяц = Истина;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
					
					ОблагаемыйДоход = 0;
					ОблагаемыйДоходНарастающимИтогомЗаГод = 0;
					ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
					ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
					ПредыдущийНалоговыйПериод = ТекущийНалоговыйПериод;
					
				ИначеЕсли ТекущийМесяцНалоговогоПериода <> ПредыдущаяСтрока.МесяцНалоговогоПериода Тогда 			
					
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаМесяц = Истина;
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
					
					ПоследнийМесяцДополнения = Мин(ТекущийМесяцНалоговогоПериода, МесяцОкончания);
					ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, ДобавитьМесяц(ПредыдущаяСтрока.МесяцНалоговогоПериода, 1), ТекущийМесяцНалоговогоПериода, ИндексОбрабатываемойСтроки, ОблагаемыйДоходНарастающимИтогомЗаГод);
					
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаМесяц = Истина;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
					
					ОблагаемыйДоход = 0;		
					ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
					ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
					
				ИначеЕсли ТекущаяСтрока.ДатаПолученияДохода <> ПредыдущаяСтрока.ДатаПолученияДохода Тогда
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
					// Если на предыдущую дату доход нарастающим итогом с начала месяца равен 0, то соответствующая строка не нужна: в
					// месяце есть еще строки
					Если ПредыдущаяСтрока.ОблагаемыйДоход = 0 Тогда
						ЗаполнитьЗначенияСвойств(ТекущаяСтрока, ПредыдущаяСтрока, "ЭтоПерваяСтрокаПоФизическомуЛицу, ЭтоПерваяСтрокаЗаГод, ЭтоПерваяСтрокаЗаМесяц, ОблагаемыйДоходЗаМесяц, ВсеДоходыЗаМесяц");								
						СтрокиКУдалению.Вставить(ПредыдущаяСтрока);	
						СтрокиПоФизическомуЛицу.Удалить(СтрокиПоФизическомуЛицу.Количество() - 1);
						Если ПредыдущаяСтрока.ЭтоПерваяСтрокаЗаМесяц Тогда
							ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
							ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
						КонецЕсли;	
					КонецЕсли;		
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
				ИначеЕсли ОблагаемыйДоход + ТекущаяСтрока.ДоходыБезВычетов = 0 Тогда 
					УдалятьТекущуюСтроку = Истина;
				КонецЕсли;	
				
				ОблагаемыйДоход = ОблагаемыйДоход + ТекущаяСтрока.ДоходыБезВычетов;
				ОблагаемыйДоходНарастающимИтогомЗаГод = ОблагаемыйДоходНарастающимИтогомЗаГод + ТекущаяСтрока.ДоходыБезВычетов;
				ТекущаяСтрока.ОблагаемыйДоход = ОблагаемыйДоход;	
				ПерваяСтрокаЗаМесяц.ОблагаемыйДоходЗаМесяц = ПерваяСтрокаЗаМесяц.ОблагаемыйДоходЗаМесяц + ТекущаяСтрока.ДоходыБезВычетов;
				ПерваяСтрокаЗаМесяц.ВсеДоходыЗаМесяц = ПерваяСтрокаЗаМесяц.ВсеДоходыЗаМесяц + ТекущаяСтрока.ВсеДоходы;
				ПерваяСтрокаЗаМесяц.ОблагаемыйДоходНарастающимИтогом = ОблагаемыйДоходНарастающимИтогомЗаГод;
				
				ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
				
				Если УдалятьТекущуюСтроку Тогда
					СтрокиКУдалению.Вставить(ТекущаяСтрока);
				Иначе	
					ПредыдущаяСтрока = ТекущаяСтрока;
					СтрокиПоФизическомуЛицу.Добавить(ТекущаяСтрока);
				КонецЕсли;	
			КонецЦикла;	// по физ.лицу                        
			
			Если СтрокиПоФизическомуЛицу.Количество() > 0 Тогда
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаПоФизическомуЛицу = Истина;	
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаГод = Истина;
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаМесяц = Истина;
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаДату = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаПоФизическомуЛицу = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаГод = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаМесяц = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаДату = Истина;
				РассчитатьСтаршийМесяцПолученияДохода(ПервыеСтрокиМесяцев);
			КонецЕсли;	
			
		КонецЦикла;		
		Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
			ДанныеУчетаДоходов.Удалить(УдаляемаяСтрока.Ключ);		
		КонецЦикла;	
		
		// 9.	Получим доходы с предыдущего места работы
		//	Читаем регистр ДоходыПредыдущегоМестаРаботыНДФЛ с отбором по списку физических лиц, головной организации для всех месяцев периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, Размер
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.ФизическоеЛицо,
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.МесяцНалоговогоПериода,
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.Размер
		|ИЗ
		|	РегистрСведений.ДоходыПредыдущегоМестаРаботыНДФЛ КАК ДоходыПредыдущегоМестаРаботыНДФЛ
		|ГДЕ
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.ФизическоеЛицо В (&СписокФизическихЛиц)
		|	И ДоходыПредыдущегоМестаРаботыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ДоходыПредыдущегоМестаРаботыНДФЛ.МесяцНалоговогоПериода
		|		МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета";
		ДоходыСПредыдущегоМестаРаботы = Запрос.Выполнить().Выгрузить();
		ДоходыСПредыдущегоМестаРаботы.Индексы.Добавить(ПоляПоиска);
		
		// 10.	Информация о правах на стандартные вычеты
		//	Читаем из регистра СтандартныеВычетыПоНДФЛВторичный записи с отбором по списку физических лиц, действующие (определяем по ДатаНачала) на начало года первого месяца 
		//	налогового периода расчета или зарегистрированные между началом года первого месяца налогового периода расчета и последним месяцем налогового периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, ПериодРегистрацииНачало, ПериодРегистрацииОкончание, КодВычета, ЛичныйВычет, Количество.
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ВычетыНаДетей.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ВычетыНаДетей.ДатаНачала КАК ДатаНачала,
		|	ВычетыНаДетей.ДатаОкончания КАК ДатаОкончания,
		|	ВычетыНаДетей.ПериодРегистрацииНачало КАК ПериодРегистрацииНачало,
		|	ВычетыНаДетей.ПериодРегистрацииОкончание КАК ПериодРегистрацииОкончание,
		|	ВычетыНаДетей.КодВычета КАК КодВычета,
		|	ВычетыНаДетей.ЛичныйВычет КАК ЛичныйВычет,
		|	ВычетыНаДетей.Количество КАК Количество
		|ИЗ
		|	РегистрСведений.СтандартныеВычетыПоНДФЛВторичный КАК ВычетыНаДетей
		|ГДЕ
		|	ВычетыНаДетей.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И (&НачалоГодаПериодаРасчета МЕЖДУ ВычетыНаДетей.ДатаНачала И ВычетыНаДетей.ДатаОкончания
		|			ИЛИ ВычетыНаДетей.ДатаНачала МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
		|	И (НЕ ВычетыНаДетей.ЛичныйВычет
		|			ИЛИ ВычетыНаДетей.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))";
		ВычетыНаДетейИЛичные = Запрос.Выполнить().Выгрузить();
		ВычетыНаДетейИЛичные.Индексы.Добавить("ФизическоеЛицо"); 
		
		// 11.	Получим информацию о применении вычетов по физическим лицам в организации, для которой ведется расчет налога.
		//	Читаем записи регистра ПрименениеСтандартныхВычетовПоНДФЛВторичный по списку физических лиц и головной организации, действующие (определяем по ДатаНачала) на начало года первого месяца 
		//	налогового периода расчета или зарегистрированные между началом года первого месяца налогового периода расчета и последним месяцем налогового периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, ПрименятьВычеты
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала КАК ДатаНачала,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаОкончания КАК ДатаОкончания,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ПрименятьВычеты КАК ПрименятьВычеты
		|ИЗ
		|	РегистрСведений.ПрименениеСтандартныхВычетовПоНДФЛВторичный КАК ПрименениеСтандартныхВычетовПоНДФЛВторичный
		|ГДЕ
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И ПрименениеСтандартныхВычетовПоНДФЛВторичный.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (&НачалоГодаПериодаРасчета МЕЖДУ ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала И ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаОкончания
		|			ИЛИ ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)";
		ПрименениеСтандартныхВычетов = Запрос.Выполнить().Выгрузить();
		ПрименениеСтандартныхВычетов.Индексы.Добавить("ФизическоеЛицо");
		
		// Прочитаем размеры вычетов за каждый год периода расчета.
		// В качестве результата получаем соответствие, в котором по годам лежат соответствия, в которых каждому вычету
		// сопоставлена структура с полями Размер и ОграничениеПоДоходам.
		РазмерыВычетов = УчетНДФЛПовтИсп.РазмерыВычетов(НачалоГода(ПервыйМесяцНалоговогоПериода), НачалоГода(ПоследнийМесяцНалоговогоПериода));
		
	КонецЕсли;
	
	// 12.	Получим информацию об исчисленном ранее налоге
	//	Читаем приходные записи (соответствуют налогу исчисленному) регистра накопления РасчетыНалогоплательщиковСБюджетомПоНДФЛ по списку физических лиц и головной организации со ставкой резидента 13%, 
	//	зарегистрированные за период между началом года первого месяца налогового периода и концом последнего месяца налогового периода.
	//	Дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Рассчитываем поле МесяцНалоговогоПериодаДляПоиска как начало месяца налогового периода.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо,  МесяцНалоговогоПериодаДляПоиска, МесяцНалоговогоПериода, Подразделение, КатегорияДохода и НалогПоСтавке13, НалогСПревышения
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериодаДляПоиска,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	-СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК НалогПоСтавке13,
	|	-СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) КАК НалогСПревышения
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &ИсключаемыйРегистратор
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
	|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода < &ДатаОбъединенияНалоговыхБаз
	|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&ПоОсновнойСтавке)
	|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода >= &ДатаОбъединенияНалоговыхБаз)
	|	И &ОкончательныйРасчетПоРасчетам
	|	И &УсловиеНаНачисленноеВАванс
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода";
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеНаНачисленноеВАванс", ?(Не ОкончательныйРасчет, "Истина", ?(ЭтоРасчетПоДоходамТекущегоМесяца, "РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ЗарегистрированоПриНачисленииАванса < &НачалоМесяцаРасчета", "РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ЗарегистрированоПриНачисленииАванса < &КонецМесяцаРасчета")));
	Если ОкончательныйРасчет Тогда
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетПоРасчетам", "Истина");
	Иначе
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетПоРасчетам", 
		"(Период < &НачалоМесяцаРасчета
		|			ИЛИ РасчетМежрасчетногоПериода
		|			ИЛИ	ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0))");	
	КонецЕсли;
	ИсчисленныйРанееНалог = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "РасчетыНалогоплательщиковСБюджетомПоНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого СтрокаНалогаТекущегоРегистратора Из ДвиженияТекущегоРегистратора.РасчетыНалогоплательщиковСБюджетомПоНДФЛ Цикл
			
			Если ОкончательныйРасчет И ЗначениеЗаполнено(СтрокаНалогаТекущегоРегистратора.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;
			КонецЕсли;
			Если СоответствиеФизическихЛиц[СтрокаНалогаТекущегоРегистратора.ФизическоеЛицо] <> Истина 
				Или СтрокаНалогаТекущегоРегистратора.ВидДвижения = ВидДвиженияНакопления.Расход 
				Или (СтрокаНалогаТекущегоРегистратора.СтавкаНалогообложенияРезидента <> Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка13 И СтрокаНалогаТекущегоРегистратора.КатегорияДохода <> Перечисления.КатегорииДоходовНДФЛ.Дивиденды) Тогда
				Продолжить;	
			КонецЕсли;			
				 
			НоваяСтрока = ИсчисленныйРанееНалог.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаНалогаТекущегоРегистратора);	
			НоваяСтрока.МесяцНалоговогоПериодаДляПоиска = НачалоМесяца(СтрокаНалогаТекущегоРегистратора.МесяцНалоговогоПериода);
			НоваяСтрока.НалогПоСтавке13 = -СтрокаНалогаТекущегоРегистратора.Сумма;
			НоваяСтрока.НалогСПревышения = -СтрокаНалогаТекущегоРегистратора.СуммаСПревышения;
			ЕстьНовыеЗаписи = Истина;
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ИсчисленныйРанееНалог.Свернуть("Подразделение, ФизическоеЛицо, МесяцНалоговогоПериода, МесяцНалоговогоПериодаДляПоиска, КатегорияДохода", "НалогПоСтавке13, НалогСПревышения");	
		КонецЕсли;	
	КонецЕсли;	
	ИсчисленныйРанееНалог.Индексы.Добавить("ФизическоеЛицо, МесяцНалоговогоПериодаДляПоиска"); 
	
	// 13.	Получим данные об имущественных вычетах (как ранее предоставленные, так и о праве на вычет)
	//	Читаем записи регистра накопления ИмущественныеВычетыНДФЛ по списку физических лиц и головной организации, зарегистрированные за весь период расчетов.
	//	Для записей прихода (права на вычеты) период дополнительно ограничиваем сверху окончанием месяца расчета (весь период расчетов может заканчиваться позже), а также учитываем только те записи, у которых год поля период совпадает со значением измерения Год.
	//	Для записей расхода (использованные вычеты) дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Полученный результат дополняем данными текущего регистратора о праве на вычеты и группируем.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, КодВычета, ВидДвижения, Подразделение, Сумма.
	КонецПериодаИмущественныхВычетов = Макс(КонецПериодаРасчета, КонецМесяцаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаИмущественныхВычетов", КонецПериодаИмущественныхВычетов);
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	ИмущественныеВычеты.КодВычета КАК КодВычета,
	|	ИмущественныеВычеты.ВидДвижения КАК ВидДвижения,
	|	ВЫБОР
	|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ИмущественныеВычеты.Подразделение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|	КОНЕЦ КАК Подразделение,
	|	СУММА(ИмущественныеВычеты.Сумма) КАК Сумма
	|ИЗ
	|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычеты
	|ГДЕ
	|	ИмущественныеВычеты.Регистратор <> &ИсключаемыйРегистратор
	|	И ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаИмущественныхВычетов
	|	И ИмущественныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ИмущественныеВычеты.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И ВЫБОР
	|			КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА ИмущественныеВычеты.Год = ГОД(ИмущественныеВычеты.Период)
	|						И ИмущественныеВычеты.Период <= &КонецМесяцаРасчета
	|			ИНАЧЕ ИмущественныеВычеты.Период <= &КонецПериодаРасчета
	|					И &ОкончательныйРасчетВычеты
	|		КОНЕЦ
	|
	|СГРУППИРОВАТЬ ПО
	|	ИмущественныеВычеты.ФизическоеЛицо,
	|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ),
	|	ИмущественныеВычеты.КодВычета,
	|	ИмущественныеВычеты.ВидДвижения,
	|	ВЫБОР
	|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ТОГДА ИмущественныеВычеты.Подразделение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|	КОНЕЦ";	
	Если ОкончательныйРасчет Тогда
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетВычеты", "Истина");
	Иначе
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетВычеты", 
		"(Период < &НачалоМесяцаРасчета ИЛИ ВычетМежрасчетногоПериода ИЛИ ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0))");
	КонецЕсли;
	
	ИмущественныеВычеты = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ИмущественныеВычетыНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого СтрокаВычетовТекущегоРегистратора Из ДвиженияТекущегоРегистратора.ИмущественныеВычетыНДФЛ Цикл
			Если СоответствиеФизическихЛиц[СтрокаВычетовТекущегоРегистратора.ФизическоеЛицо] <> Истина Тогда
				Продолжить;
			КонецЕсли;
			
			НоваяСтрока = ИмущественныеВычеты.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаВычетовТекущегоРегистратора);
			НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(СтрокаВычетовТекущегоРегистратора.Период);
			НоваяСтрока.Подразделение = Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
			ЕстьНовыеЗаписи = Истина;
			
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Новые права и сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ИмущественныеВычеты.Свернуть("ФизическоеЛицо, Подразделение, МесяцНалоговогоПериода, ВидДвижения, КодВычета", "Сумма");
		КонецЕсли;
	КонецЕсли;	
	ИмущественныеВычеты.Индексы.Добавить("ФизическоеЛицо, МесяцНалоговогоПериода, ВидДвижения");
	
	// 14.	Получим информацию о предоставленных стандартных и социальных вычетах.
	//	Читаем записи регистра накопления ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛс по списку физических лиц и головной организации, зарегистрированные за 
	//	период между началом года первого месяца налогового периода и концом последнего месяца налогового периода.
	//	Дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Для стандартных вычетов заполняем поля Подразделение и КодВычета (для социальных вычетов берем пустые ссылки). 
	//	Рассчитываем поле ЭтоСоциальныйВычет (булево) исходя из группы вычета.
	//	Полученный результат дополняем данными текущего регистратора о праве на социальные вычеты и группируем.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, КодВычета, ЭтоСоциальныйВычет, Подразделение, Сумма.
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ВычетыБД.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.КодВычета
	|	КОНЕЦ КАК КодВычета,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоСоциальныйВычет,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.Подразделение
	|	КОНЕЦ КАК Подразделение,
	|	НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	НАЧАЛОПЕРИОДА(ВЫБОР
	|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
	|		КОНЕЦ, МЕСЯЦ) КАК МесяцПериодаПредоставленияВычета,
	|	СУММА(ВычетыБД.Сумма) КАК Сумма
	|ИЗ
	|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ВычетыБД
	|ГДЕ
	|	ВычетыБД.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
	|	И ВычетыБД.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И ВычетыБД.ФизическоеЛицо В(&СписокФизическихЛиц)
	|	И (ВЫБОР
	|				КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|				КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|				ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
	|			КОНЕЦ МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
	|			ИЛИ ВычетыБД.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
	|	И ВычетыБД.Регистратор <> &ИсключаемыйРегистратор
	|	И &ОкончательныйРасчетВычеты
	|	И &УсловиеНаНачисленноеВАванс
	|
	|СГРУППИРОВАТЬ ПО
	|	ВычетыБД.ФизическоеЛицо,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.Подразделение
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
	|		ИНАЧЕ ВычетыБД.КодВычета
	|	КОНЕЦ,
	|	НАЧАЛОПЕРИОДА(ВЫБОР
	|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
	|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
	|		КОНЕЦ, МЕСЯЦ),
	|	ВычетыБД.МесяцНалоговогоПериода";
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеНаНачисленноеВАванс", ?(ОкончательныйРасчет И ЭтоРасчетПоДоходамТекущегоМесяца, 
		"НЕ(ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
	|				И ВычетыБД.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				И (ВычетыБД.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))",
		"Истина"));
	Если ОкончательныйРасчет Тогда
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетВычеты", "Истина");
	Иначе
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&ОкончательныйРасчетВычеты", 
		"(Период < &НачалоМесяцаРасчета ИЛИ ВычетМежрасчетногоПериода ИЛИ ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0))");
	КонецЕсли;

	ПредоставленныеСтандартныеИСоциальныеВычеты = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого ТекущаяСтрока Из ДвиженияТекущегоРегистратора.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ Цикл
			Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] <> Истина Тогда
				Продолжить;	
			КонецЕсли;			
			
			ЭтоСоциальныйВычет = ТекущаяСтрока.КодВычета.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные;	
			Если ЭтоСоциальныйВычет И ОкончательныйРасчет И ЭтоРасчетПоДоходамТекущегоМесяца И ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;	
			КонецЕсли;
			
			НоваяСтрока = ПредоставленныеСтандартныеИСоциальныеВычеты.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
			НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
			НоваяСтрока.ЭтоСоциальныйВычет = ЭтоСоциальныйВычет;	
			Если ЭтоСоциальныйВычет Тогда
				НоваяСтрока.МесяцПериодаПредоставленияВычета = НоваяСтрока.МесяцНалоговогоПериода;
				НоваяСтрока.Подразделение = Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
				НоваяСтрока.КодВычета = Справочники.ВидыВычетовНДФЛ.ПустаяСсылка();
			ИначеЕсли Не ЗначениеЗаполнено(НоваяСтрока.МесяцПериодаПредоставленияВычета) Тогда	
				НоваяСтрока.МесяцПериодаПредоставленияВычета = НоваяСтрока.МесяцНалоговогоПериода;
			КонецЕсли;
			НоваяСтрока.МесяцПериодаПредоставленияВычета = НачалоМесяца(НоваяСтрока.МесяцПериодаПредоставленияВычета);
			ЕстьНовыеЗаписи = Истина;
				
		КонецЦикла;
		Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ПредоставленныеСтандартныеИСоциальныеВычеты.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, КодВычета, Подразделение, ЭтоСоциальныйВычет", "Сумма");
		КонецЕсли;			
	КонецЕсли;	
	ПредоставленныеСтандартныеИСоциальныеВычеты.Индексы.Добавить("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, ЭтоСоциальныйВычет");
		
	// 15.	Получим информацию об остатках авансовых платежей в бюджет
	//	Читаем остатки из регистра АвансовыеПлатежиИностранцевПоНДФЛ по списку физических лиц на конец месяца расчета за годы периода расчета.
	//	Отнимем движения исключаемого регистратора (удовлетворяющих тем же условиям что и данные остатков)
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, НалоговыйПериод (число, год), Остаток
	Запрос.УстановитьПараметр("МинимальныйГод", Год(ПервыйМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("МаксимальныйГод", Год(ПоследнийМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("КонецМесяцаРасчета", КонецМесяца(МесяцРасчета) + 1);
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Авансы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Авансы.НалоговыйПериод КАК НалоговыйПериод,
	|	СУММА(Авансы.Остаток) КАК Остаток
	|ИЗ
	|	(ВЫБРАТЬ
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.Год КАК НалоговыйПериод,
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.СуммаОстаток КАК Остаток
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ.Остатки(
	|				&КонецМесяцаРасчета,
	|				ФизическоеЛицо В (&СписокФизическихЛиц)
	|					И (Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод)
	|					И ГоловнаяОрганизация = &ГоловнаяОрганизация) КАК АвансовыеПлатежиИностранцевПоНДФЛОбороты
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДвиженияРегистратора.ФизическоеЛицо,
	|		ДвиженияРегистратора.Год,
	|		ВЫБОР
	|			КОГДА ДвиженияРегистратора.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА ДвиженияРегистратора.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ КАК ДвиженияРегистратора
	|	ГДЕ
	|		ДвиженияРегистратора.Регистратор = &ИсключаемыйРегистратор
	|		И ДвиженияРегистратора.ФизическоеЛицо В(&СписокФизическихЛиц)
	|		И ДвиженияРегистратора.Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод
	|		И ДвиженияРегистратора.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДвиженияРегистратора.ФизическоеЛицо,
	|		ДвиженияРегистратора.Год,
	|		ВЫБОР
	|			КОГДА ДвиженияРегистратора.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА ДвиженияРегистратора.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ КАК ДвиженияРегистратора
	|	ГДЕ
	|		ДвиженияРегистратора.Регистратор <> &ИсключаемыйРегистратор
	|		И &УсловиеНаНачисленноеВАванс
	|		И ДвиженияРегистратора.ФизическоеЛицо В(&СписокФизическихЛиц)
	|		И ДвиженияРегистратора.Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод
	|		И ДвиженияРегистратора.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И ДвиженияРегистратора.Период < &КонецМесяцаРасчета
	|		И ДвиженияРегистратора.Период >= &НачалоМесяцаРасчета) КАК Авансы
	|
	|СГРУППИРОВАТЬ ПО
	|	Авансы.ФизическоеЛицо,
	|	Авансы.НалоговыйПериод";
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеНаНачисленноеВАванс", ?(ОкончательныйРасчет И ЭтоРасчетПоДоходамТекущегоМесяца, "ДвиженияРегистратора.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)", "Ложь"));
	ОстаткиПоАвансовымПлатежам = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "АвансовыеПлатежиИностранцевПоНДФЛ") Тогда 
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого СтрокаНабора Из ДвиженияТекущегоРегистратора.АвансовыеПлатежиИностранцевПоНДФЛ Цикл
			Если СоответствиеФизическихЛиц[СтрокаНабора.ФизическоеЛицо] <> Истина Или СтрокаНабора.ВидДвижения = ВидДвиженияНакопления.Приход Тогда
				Продолжить;	
			КонецЕсли;
			Если ОкончательныйРасчет И ЭтоРасчетПоДоходамТекущегоМесяца И ЗначениеЗаполнено(СтрокаНабора.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;	
			КонецЕсли;
			СтрокаРезультат = ОстаткиПоАвансовымПлатежам.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРезультат, СтрокаНабора);
			СтрокаРезультат.НалоговыйПериод = СтрокаНабора.Год;
			СтрокаРезультат.Остаток = - СтрокаНабора.Сумма;
			ЕстьНовыеЗаписи = Истина;
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ОстаткиПоАвансовымПлатежам.Свернуть("ФизическоеЛицо, НалоговыйПериод", "Остаток");
		КонецЕсли;	
	КонецЕсли;	
	ОстаткиПоАвансовымПлатежам.Индексы.Добавить("ФизическоеЛицо, НалоговыйПериод");
	
	РезультатРасчета = ТаблицаНДФЛ();
	
	СтруктураПоискаПоФизическомуЛицу = Новый Структура("ФизическоеЛицо");
	СтруктураПоискаТекущихДоходов = Новый Структура("ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", Истина, Не ОкончательныйРасчет);
	СтруктураПоискаТекущихДоходовНерезидентов = Новый Структура("ФизическоеЛицо, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", , Истина, Не ОкончательныйРасчет);
	СтруктураПоискаИсчисленного = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериодаДляПоиска");
	СтруктураПоискаСтандартныхВычетов = Новый Структура("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, ЭтоСоциальныйВычет");
	СтруктураПоискаИмущественныхВычетов = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериода, ВидДвижения");
	ОписаниеВычетов = УчетНДФЛПовтИсп.ОписаниеВычетов();
	
	// инициализируем общие вспомогательные объекты
	РезультатРасчетаВспомогательный = РезультатРасчета;
	ВспомогательнаяТаблицаМесяца = РезультатРасчета.СкопироватьКолонки("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, МесяцНалоговогоПериода, Подразделение, КатегорияДохода, НалогПоСтавке13, ЗачтеноАвансовыхПлатежейПоСтавке13, НалогСПревышения, ЗачтеноАвансовыхПлатежейСПревышения");
	ВспомогательнаяТаблицаМесяца.Колонки.Добавить("КоличествоВычетов", Новый ОписаниеТипов("Число"));
	ВспомогательнаяТаблицаФизическогоЛица = ВспомогательнаяТаблицаМесяца.СкопироватьКолонки();
	ВспомогательнаяТаблицаПоДоходамПревышения = ВспомогательнаяТаблицаМесяца.СкопироватьКолонки();
	
	ВспомогательнаяТаблицаВычетовМесяца = Новый ТаблицаЗначений;
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("МесяцПериодаПредоставленияВычета", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("Подразделение", Метаданные.ОпределяемыеТипы.ТерриторияВыполненияРаботВОрганизации.Тип);
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("КатегорияДохода", Новый ОписаниеТипов("ПеречислениеСсылка.КатегорииДоходовНДФЛ"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("КодВычета", Новый ОписаниеТипов("СправочникСсылка.ВидыВычетовНДФЛ"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("РазмерВычета", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15,2)));
	
	// Начнем с расчета по резидентам и приравненным к ним.
	Если РассчитыватьНалогНарастающимИтогом Тогда
		
		ВспомогательныеДатыПодразделенияКатегории = Новый ТаблицаЗначений;
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("Подразделение", Метаданные.ОпределяемыеТипы.ТерриторияВыполненияРаботВОрганизации.Тип);
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("КатегорияДохода", Новый ОписаниеТипов("ПеречислениеСсылка.КатегорииДоходовНДФЛ"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("Распределение", Новый ОписаниеТипов("ТаблицаЗначений"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьДатуПолученияДохода", Новый ОписаниеТипов("Булево"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьПодразделение", Новый ОписаниеТипов("Булево"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьКатегориюДохода", Новый ОписаниеТипов("Булево"));
		
		ВычетыЗаМесяц = Новый ТаблицаЗначений;
		ВычетыЗаМесяц.Колонки.Добавить("КодВычета");
		ВычетыЗаМесяц.Колонки.Добавить("РазмерВычета", Новый ОписаниеТипов("Число"));
		
		СтавкаДляРезидента = 0.13; // Пункт 1 статьи 224 НК РФ.
		СтавкаСПревышения = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом;
		ПределПрогрессивнойШкалы = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
		
		ОсобыеКатегорииДохода = Новый Соответствие; // Эти категории дохода определяют собственные ставки налога, поэтому их нельзя заменять текущими даже при перерасчете.
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.Дивиденды, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15, Истина);
		
		ПериодСрезаПравНаВычеты = НачалоМесяца(Макс(МесяцРасчета, ПоследнийМесяцНалоговогоПериода));
		ПереноситьДоходДляПримененияВычетовВМесяцРасчета = Не ОкончательныйРасчет И Год(МесяцРасчета) = Год(ДатаУдержанияИсчисленногоНалога) И МесяцРасчета < НачалоМесяца(ДатаУдержанияИсчисленногоНалога);
		
		// Инициализируем вспомогательные объекты.
		СтруктураПоиска = Новый Структура(ПоляПоиска);
		ПоляПоискаПоДатам = "ДатаПолученияДохода, ДоходМежрасчетногоПериода";
		СтруктураПоискаПоДатам = Новый Структура(ПоляПоискаПоДатам);
		СтруктураПоискаТолькоПоДатам = Новый Структура("ДатаПолученияДохода");
		СтруктураПоискаПоДатамИПодразделениям = Новый Структура("ДатаПолученияДохода,Подразделение");
		
		// Структуру описания остатков создаем однократно, в дальнейшем для каждого сочетания ФЛ+Налоговый период очищаем ее коллекции.
		ОстаткиВычетов = НовыйОстаткиВычетов();
		ТекущиеОстаткиВычетов = ОстаткиВычетов.Остатки; 
		
		ПараметрыЗаполненияРесурсаНалогПоСтавке13 = НовыйПараметрыЗаполненияРесурса("НалогПоСтавке13", "СуммаДохода", 0, "Подразделение, КатегорияДохода", , "НалогСПревышения");
		ПараметрыЗаполненияРесурсаНалогСПревышения = НовыйПараметрыЗаполненияРесурса("НалогСПревышения", "СуммаДохода", 0, "Подразделение, КатегорияДохода", , "НалогПоСтавке13");
		ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению = НовыйПараметрыЗаполненияРесурса("РазмерВычета", "СуммаДохода", , , "КодВычета");
		ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории = НовыйПараметрыЗаполненияРесурса("РазмерВычета", "СуммаДохода", ,"Подразделение, КатегорияДохода", "КодВычета,МесяцПериодаПредоставленияВычета");
		
		// Однократный обход таблицы ДанныеУчетаДоходов организован двумя вложенными циклами; внутренний цикл выполняет расчет
		// налога за один налоговый период по одному физлицу. В качестве промежуточной структуры данных для результатов
		// расчета за месяц используем две таблицы: в одной оставляем только ресурсы НалогПоСтавке13, НалогСПревышения,
		// ЗачтеноАвансовыхПлатежейПоСтавке13, ЗачтеноАвансовыхПлатежейСПревышения, во второй таблице храним результат расчета вычетов (измерение КодВычета и ресурс РазмерВычета).
		ИндексТекущейСтрокиТаблицыДоходов = 0;
		Пока ИндексТекущейСтрокиТаблицыДоходов <= ДанныеУчетаДоходов.Количество() - 1 Цикл
			
			// будет инициализирована только в том случае, если она понадобится
			ТаблицаРаспределенияМесяцаРасчета = Неопределено;	
			
			ТекущаяСтрокаТаблицыДоходов = ДанныеУчетаДоходов[ИндексТекущейСтрокиТаблицыДоходов];
			// получим физическое лицо, по которому выполняется расчет
			ТекущееФизическоеЛицо = ТекущаяСтрокаТаблицыДоходов.ФизическоеЛицо;
			
			// получим налоговый период, по которому далее будет выполняться расчет.
			ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрокаТаблицыДоходов.МесяцНалоговогоПериода);
			РазмерыВычетовНаГод = РазмерыВычетов[ТекущийНалоговыйПериод];
			
			// обнулим остатки вычетов
			ТекущиеОстаткиВычетов.Очистить();
			ОстаткиВычетов.ТаблицаВычетов.Очистить();	
			ВычетыПредыдущихМесяцев = Новый Соответствие;
			ОтложенныеПраваНаВычеты = Новый Соответствие;
			ВспомогательнаяТаблицаМесяца.Очистить();
			
			ДействующаяИнформацияОСтандартныхВычетах = Неопределено;
			ДействующаяИнформацияОСтатусе = Неопределено;
			                                                                         	
			// инициализируем переменные, хранящие итоги за год
			СтрокиНДФЛЗаГод = Новый Массив;
			ОблагаемыйДоходНаНачалоМесяца = 0;  
			ОблагаемыйДоходНаКонецМесяца = 0;
			
			ДоходЗаМесяцОстаток = 0;	
			НалогИсчисленный = 0;
			НалогСПревышенияИсчисленный = 0;
			ВычетСоциальныйОстаток = 0;
			ИсчисленоНДФЛЗаГод = 0;
			ОблагаемыйДоход = 0;
			ВсегоДоходовТекущегоРасчета = 0;
			
			Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаПоФизическомуЛицу Тогда // Начало обработки очередного физ.лица.
				
				СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
				СтруктураПоискаТекущихДоходовНерезидентов.ФизическоеЛицо = ТекущееФизическоеЛицо;
				
				// Получим данные, необходимые для определения прав на вычеты.
				СтрокиТаблицыСтатусов = СтатусыФизическихЛиц.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				СтрокиТаблицыПримененияВычетов = ПрименениеСтандартныхВычетов.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				СтрокиТаблицыПравНаВычеты = ВычетыНаДетейИЛичные.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				
				// Если выполняется окончательный расчет, будем вписывать результат расчета сразу в таблицы результата.
				// В случае с промежуточным расчетом будем использовать промежуточную таблицу, а потом переносить в результирующую с
				// учетом ограничений.
				Если Не ОкончательныйРасчет Тогда
					РезультатРасчетаВспомогательный = РезультатРасчета.СкопироватьКолонки();
				КонецЕсли;
				
				РаспределениеДоходовФизлица = ДоходыПоПодразделениямИКатегориям.Скопировать(СтруктураПоискаПоФизическомуЛицу);
				РаспределениеДоходовФизлица.Индексы.Добавить(ПоляПоискаПоДатам);
				ДоходыТекущегоРасчета = РаспределениеДоходовФизлица.Скопировать(СтруктураПоискаТекущихДоходов);
				Если Не ОкончательныйРасчет Тогда
					ВсегоДоходовТекущегоРасчета = ДоходыТекущегоРасчета.Итог("СуммаДоходаТекущегоРасчета");
					ДоходыТекущегоРасчетаНерезидента = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Скопировать(СтруктураПоискаТекущихДоходовНерезидентов);
				КонецЕсли;
				
			КонецЕсли;
				                                                                             				
			// Характеристики доходов "текущего" расчета за очередной налоговый период.
			ВсеДатыТекущегоРасчета = Новый Соответствие;
			ВсеКатегорииТекущегоРасчета = Новый Соответствие;
			ДатыТекущегоРасчетаПоМесяцам = Новый Соответствие;
			ТекущийГод = Год(ТекущийНалоговыйПериод);
			Для СчМесяцев = 1 По 12 Цикл
				ДатыТекущегоРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
			КонецЦикла;
			Для каждого СтрокаТЗ Из ДоходыТекущегоРасчета Цикл
				Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
					Продолжить;
				КонецЕсли;
				ВсеДатыТекущегоРасчета.Вставить(СтрокаТЗ.ДатаПолученияДохода, Истина);
				ВсеКатегорииТекущегоРасчета.Вставить(СтрокаТЗ.КатегорияДохода, Истина);
				МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
				ДатыТекущегоРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыТекущегоРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
			КонецЦикла;
			Если ОкончательныйРасчет Тогда
				ДатыРасчетаПоМесяцам = Новый Соответствие;
				ДатаНалоговогоПериода = '00010101';
				Для СчМесяцев = 1 По 12 Цикл
					ДатыРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
				КонецЦикла;
				Для каждого СтрокаТЗ Из РаспределениеДоходовФизлица Цикл
					Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
						Продолжить;
					КонецЕсли;
					ДатаНалоговогоПериода = Макс(ДатаНалоговогоПериода, СтрокаТЗ.ДатаПолученияДохода); 
					МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
					ДатыРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
				КонецЦикла;
				
				ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцРасчета)];
				ОсновнаяДатаМесяцаРасчета = ?(Год(МесяцРасчета) = ТекущийГод, ДатыРасчетаПоМесяцам[Месяц(МесяцРасчета)], '00010101');
				
				ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам = Новый Массив;
				ТаблицаРаспределенияКонцаМесяцаРасчета = Новый Массив;
				ТаблицаРаспределенияНалоговогоПериода = Новый Массив;
				Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
					ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				КонецЕсли;
				Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчета;
					ТаблицаРаспределенияКонцаМесяцаРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				КонецЕсли;
				Если ЗначениеЗаполнено(ДатаНалоговогоПериода) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ДатаНалоговогоПериода;
					ТаблицаРаспределенияНалоговогоПериода = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				Иначе
					ДатаНалоговогоПериода = НачалоДня(КонецМесяца(МесяцРасчета))
				КонецЕсли;
			Иначе
				ОсновнаяДатаТекущегоРасчета = ДатаУдержанияИсчисленногоНалога;
				Если ВсеДатыТекущегоРасчета[ОсновнаяДатаТекущегоРасчета] = Неопределено Тогда
					Для СчМесяцев = 1 По 12 Цикл
						Если ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев]) Тогда
							ОсновнаяДатаТекущегоРасчета = ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев];
							Прервать;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				ДатыТекущегоРасчетаНерезидента = Новый Соответствие;
				Для каждого СтрокаТЗ Из ДоходыТекущегоРасчетаНерезидента Цикл
					Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
						Продолжить;
					КонецЕсли;
					ДатыТекущегоРасчетаНерезидента.Вставить(Месяц(СтрокаТЗ.ДатаПолученияДохода), СтрокаТЗ.ДатаПолученияДохода);
				КонецЦикла;
			КонецЕсли;
			
			ПродолжатьРасчет = Истина;
			Пока ПродолжатьРасчет Цикл
				
				ТекущаяСтрокаТаблицыДоходов = ДанныеУчетаДоходов[ИндексТекущейСтрокиТаблицыДоходов]; 
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаЗаМесяц Тогда
					
					МесяцНалоговогоПериода = ТекущаяСтрокаТаблицыДоходов.МесяцНалоговогоПериода;
					ПроводитьРасчетЗаОчереднойМесяц = ТекущаяСтрокаТаблицыДоходов.ВсеДоходыЗаМесяц <> 0 Или Не ЭтоРасчетПоДоходамТекущегоМесяца;
					
					// Получаем информацию о статусе налогоплательщика на начало месяца.
					Если ДействующаяИнформацияОСтатусе = Неопределено
						Или Не (МесяцНалоговогоПериода >= ДействующаяИнформацияОСтатусе.ДатаНачала И МесяцНалоговогоПериода <= ДействующаяИнформацияОСтатусе.ДатаОкончания) Тогда
						ДействующаяИнформацияОСтатусе = ИнформацияОСтатусеНалогоплательщика(МесяцНалоговогоПериода, СтрокиТаблицыСтатусов);
					КонецЕсли;	
					
					// Получаем информацию об имеющихся правах на стандартные вычеты.
					Если ДействующаяИнформацияОСтандартныхВычетах = Неопределено 
						Или Не (МесяцНалоговогоПериода >= ДействующаяИнформацияОСтандартныхВычетах.ДатаНачала И МесяцНалоговогоПериода <= ДействующаяИнформацияОСтандартныхВычетах.ДатаОкончания) Тогда
						ДействующаяИнформацияОСтандартныхВычетах = ИнформацияОСтандартныхВычетахДействующихНаДату(МесяцНалоговогоПериода, ПериодСрезаПравНаВычеты, СтрокиТаблицыПравНаВычеты, СтрокиТаблицыПримененияВычетов, ДействующаяИнформацияОСтатусе);	
					КонецЕсли;
					
					ВспомогательнаяТаблицаВычетовМесяца.Очистить();
					ЗаполнитьЗначенияСвойств(СтруктураПоиска,ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаСтандартныхВычетов, ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаИмущественныхВычетов, ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаИсчисленного, ТекущаяСтрокаТаблицыДоходов);
					СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = МесяцНалоговогоПериода;
					СтруктураПоискаСтандартныхВычетов.МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода;
								
					// Вписываем во вспомогательную таблицу месяца исчисленные ранее налоги.
					СтрокиНалога = ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного);
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, СтрокиНалога, "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиНалога, ИсчисленныйРанееНалог);					
					
					// Получаем использованный в месяце социальный вычет.
					СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Истина;
					СтрокиПравНаСоциальныеВычеты = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
					ВычетСоциальныйОстаток = ВычетСоциальныйОстаток + ?(СтрокиПравНаСоциальныеВычеты.Количество() > 0 И ДействующаяИнформацияОСтатусе.ПрименяетсяСтавкаПункта1Статьи224НК, СтрокиПравНаСоциальныеВычеты[0].Сумма, 0);
					
					// Создадим набор сумм вычетов, которые могут уменьшить облагаемый доход, начнем с имущественных вычетов.
					СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Приход;
					СтрокиПравНаИмущественныеВычеты = ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаИмущественныхВычетов);
					Для Каждого СтрокаПрав Из СтрокиПравНаИмущественныеВычеты Цикл
						ДобавитьОстатокВычетов(ОстаткиВычетов, СтрокаПрав.КодВычета, СтрокаПрав.Сумма);		
					КонецЦикла;					
					
					// Добавим стандартные вычеты очередного месяца.
					ОблагаемыйДоходНарастающимИтогом = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоходНарастающимИтогом;
					ДоходСПредыдущегоМестаРаботы = 0;
					СтрокиДоходаСПредыдущегоМестаРаботы = ДоходыСПредыдущегоМестаРаботы.НайтиСтроки(СтруктураПоиска);
					Если СтрокиДоходаСПредыдущегоМестаРаботы.Количество() > 0 Тогда
						ДоходСПредыдущегоМестаРаботы = СтрокиДоходаСПредыдущегоМестаРаботы[0].Размер;
					КонецЕсли;	
					ОблагаемыйДоходДляВычетов = ОблагаемыйДоходНарастающимИтогом + ДоходСПредыдущегоМестаРаботы;	
					Для Каждого ТекущийВычет Из ДействующаяИнформацияОСтандартныхВычетах.Вычеты Цикл
						ОписаниеРазмераВычета = РазмерыВычетовНаГод[ТекущийВычет.Ключ];
						Если ОписаниеРазмераВычета = Неопределено Тогда
							Продолжить;
						КонецЕсли;	
						Если ОписаниеРазмераВычета.ОграничениеПоДоходам <> 0 И ОблагаемыйДоходДляВычетов > ОписаниеРазмераВычета.ОграничениеПоДоходам Тогда
							Продолжить;
						КонецЕсли;	
						ДобавитьОстатокВычетов(ОстаткиВычетов, ТекущийВычет.Ключ, ТекущийВычет.Значение * ОписаниеРазмераВычета.Размер, ПрименятьСтандартныеВычетыНарастающимИтогом);	
					КонецЦикла;		
					
					СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Ложь;
					СтрокиСтандартныхВычетов = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
						
					// Перенесем ранее предоставленные при исчислении налога для будущих дат получения дохода вычеты 
					// текущего месяца на тот месяц, когда их предоставили на самом деле.
					// Манипуляции производим с правами на стандартные вычеты и со строками зарегистрированных вычетов.
					Для каждого Элемент Из ОтложенныеПраваНаВычеты Цикл
						ТекущийВычет = Элемент.Ключ;
						Если ТекущийВычет.МесяцНалоговогоПериода = МесяцНалоговогоПериода Тогда
							ДобавитьОстатокВычетов(ОстаткиВычетов, ТекущийВычет.КодВычета, Элемент.Значение, Истина);
							ОтложенныеПраваНаВычеты.Удалить(ТекущийВычет);
						КонецЕсли;
					КонецЦикла;
					Для каждого СтрокаТЗ Из СтрокиСтандартныхВычетов Цикл
						Если СтрокаТЗ.МесяцНалоговогоПериода <= МесяцНалоговогоПериода Тогда
							Продолжить;	
						КонецЕсли;
						Если СтрокаТЗ.Сумма > 0 Тогда
							ОстатокВычета = ТекущиеОстаткиВычетов[СтрокаТЗ.КодВычета];
							Если ОстатокВычета <> Неопределено  Тогда
								ВычетКЗачету = Мин(СтрокаТЗ.Сумма, ОстатокВычета);
								ТекущиеОстаткиВычетов.Вставить(СтрокаТЗ.КодВычета, ОстатокВычета - ВычетКЗачету);
								СтрокаТЗ.МесяцПериодаПредоставленияВычета = СтрокаТЗ.МесяцНалоговогоПериода;
								ОтложенныеПраваНаВычеты.Вставить(СтрокаТЗ, ВычетКЗачету);
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
					// Если вычеты перенесли, надо обновить зарегистрированные вычеты текущего месяца.
					Если ОтложенныеПраваНаВычеты.Количество() > 0 Тогда
						СтрокиСтандартныхВычетов = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
					КонецЕсли;
					
					// Определим доход, который могут уменьшать вычеты.
					ЗапоминатьВычетыНаБудущее = Ложь;
					ОблагаемыйДоходЗаМесяц = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоходЗаМесяц;
					Если ПрименятьСтандартныеВычетыНарастающимИтогом Тогда
						Если ПереноситьДоходДляПримененияВычетовВМесяцРасчета И МесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц + ВсегоДоходовТекущегоРасчета;
							ЗапоминатьВычетыНаБудущее = Истина;
						ИначеЕсли ПереноситьДоходДляПримененияВычетовВМесяцРасчета И МесяцНалоговогоПериода = НачалоМесяца(ДатаУдержанияИсчисленногоНалога) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц - ВсегоДоходовТекущегоРасчета;
						Иначе
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц;
						КонецЕсли;
					Иначе
						ДоходЗаМесяцОстаток = ОблагаемыйДоходЗаМесяц;		
					КонецЕсли;	                                                     
					// Имущественные вычеты не могут уменьшать доходы месяцев, предшествующих месяцу начала применения.
					ДоходЗаМесяцДляИмущественныхВычетов = ОблагаемыйДоходЗаМесяц; 
					
					// Рассчитываем примененные за месяц вычеты.
					ВсегоВычетовЗаМесяц = 0;
					ЕстьВычетыЗаМесяц = Ложь;
					ВычетыЗаМесяц.Очистить();	
					Если ДоходЗаМесяцОстаток > 0 И МесяцНалоговогоПериода <= ТекущаяСтрокаТаблицыДоходов.СтаршийМесяцПолученияДохода Тогда
						
						ВычетСоциальныйЗаМесяц = Мин(ДоходЗаМесяцОстаток, ВычетСоциальныйОстаток);
						ВычетСоциальныйОстаток = ВычетСоциальныйОстаток - ВычетСоциальныйЗаМесяц;
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + ВычетСоциальныйЗаМесяц;
						ЕстьВычетыЗаМесяц = ВычетСоциальныйЗаМесяц <> 0;
						
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетСоциальныйЗаМесяц;
						ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетСоциальныйЗаМесяц;
						// Для расчета имущественных вычетов учтем ранее не учтенные из-за отсутствия дохода в предшествующих месяцах
						// налогового периода вычеты.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < МесяцНалоговогоПериода Тогда
								ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - Мин(ДоходЗаМесяцДляИмущественныхВычетов, Элемент.Значение);
								Если ДоходЗаМесяцДляИмущественныхВычетов = 0 Тогда
									Прервать;
								КонецЕсли;	
							КонецЕсли;
						КонецЦикла;
						
						Если ДоходЗаМесяцОстаток > 0 Тогда
							// Заполняем таблицу значений ВычетыЗаМесяц (с колонками КодВычета, Сумма) суммами вычетов, которые будут
							// применены в текущем месяце. Строки в таблицу помещаем в соответствии с наиболее выгодным для сотрудника
							// приоритетом применения вычетов (описанным непосредственно в справочнике вычетов), для чего. отсортируем
							// таблицу ТаблицаВычетов по полю ПорядокСписания. Применяемые суммы вычетов переписываем из таблицы Остатки,
							// содержащей права на вычеты, в пределах доходов, которые могут быть уменьшены на стандартные, имущественные
							// вычеты. Если положенных физ.лицу вычетов оказывается больше, чем начисленного дохода, в таблице Остатки
							// оказываются суммы неиспользованных в этом месяце вычетов для предоставления их в будущем.
							ОстаткиВычетов.ТаблицаВычетов.Сортировать("ПорядокСписания");
							Для Каждого ВычетКСписанию Из ОстаткиВычетов.ТаблицаВычетов Цикл
								
								Если ДоходЗаМесяцОстаток = 0 И ДоходЗаМесяцДляИмущественныхВычетов = 0 Тогда
									Прервать;
								КонецЕсли;
								Если ВычетКСписанию.ИмущественныйВычет И Не ПроводитьРасчетЗаОчереднойМесяц Тогда 
									Прервать;
								КонецЕсли;
								
								ВычетЗаМесяц = 0;
								ОстатокВычета = ТекущиеОстаткиВычетов[ВычетКСписанию.КодВычета];
								Если ВычетКСписанию.ИмущественныйВычет Тогда 
									Если ДоходЗаМесяцДляИмущественныхВычетов > 0 Тогда
										ВычетЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ОстатокВычета);	
										ТекущиеОстаткиВычетов.Вставить(ВычетКСписанию.КодВычета, ОстатокВычета - ВычетЗаМесяц);
									КонецЕсли;	
								Иначе	
									ВычетЗаМесяц = Мин(ДоходЗаМесяцОстаток, ОстатокВычета);
									ТекущиеОстаткиВычетов.Вставить(ВычетКСписанию.КодВычета, ОстатокВычета - ВычетЗаМесяц);
								КонецЕсли;	
								Если ВычетЗаМесяц <> 0 Тогда
									СтрокаТаблицыРезультата = ВычетыЗаМесяц.Добавить();	
									СтрокаТаблицыРезультата.КодВычета = ВычетКСписанию.КодВычета;
									СтрокаТаблицыРезультата.РазмерВычета = ВычетЗаМесяц;
									
									ЕстьВычетыЗаМесяц = Истина;
									ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетЗаМесяц;
									ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетЗаМесяц);
								КонецЕсли;
								
							КонецЦикла;	
						КонецЕсли;
						
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + ВычетыЗаМесяц.Итог("РазмерВычета");
					КонецЕсли;
					
					// Перенесем некоторые суммы вычетов из других месяцев.
					Если ПроводитьРасчетЗаОчереднойМесяц Тогда 
						// Учтем ранее не учтенные вычеты из-за отсутствия дохода в предшествующих месяцах налогового периода.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < МесяцНалоговогоПериода Тогда
								ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + Элемент.Значение;
								ВычетыПредыдущихМесяцев.Вставить(Элемент.Ключ, 0);
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;	
					Если ЗапоминатьВычетыНаБудущее Или ЕстьВычетыЗаМесяц И Не ПроводитьРасчетЗаОчереднойМесяц Тогда // Запомним вычеты на будущее.
						ВычетыПредыдущихМесяцев.Вставить(МесяцНалоговогоПериода, ?(ЗначениеЗаполнено(ВычетыПредыдущихМесяцев[МесяцНалоговогоПериода]), ВычетыПредыдущихМесяцев[МесяцНалоговогоПериода], 0) + Макс(ВсегоВычетовЗаМесяц - ОблагаемыйДоходЗаМесяц, 0));
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц - Макс(ВсегоВычетовЗаМесяц - ОблагаемыйДоходЗаМесяц, 0);
					КонецЕсли;	
					
					ТаблицаРаспределенияВычетов = РаспределениеДоходовФизлица.СкопироватьКолонки();

					НачисленныйДоходЗаДату = 0;
					ИспользованоВычетовЗаМесяц = 0;

					// Начнем расчет с вычитания уже зарегистрированных в учете вычетов, затем по мере расчета вычеты будут
					// "применяться" к конкретным доходам.
					
					// Строки примененных ранее стандартных вычетов отобрали ранее
					ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВспомогательнаяТаблицаВычетовМесяца, СтрокиСтандартныхВычетов);
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиСтандартныхВычетов, ПредоставленныеСтандартныеИСоциальныеВычеты);					
					// Строки примененных ранее имущественных вычетов отберем сейчас.
					СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;
					СтрокиВычетов = ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаИмущественныхВычетов);
					ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВспомогательнаяТаблицаВычетовМесяца, СтрокиВычетов);
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиВычетов, ИмущественныеВычеты);					
					
				КонецЕсли;	
				
				Если ПроводитьРасчетЗаОчереднойМесяц Тогда
					
					Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаЗаДату Тогда
						
						ОблагаемыйДоходНаНачалоМесяца = ОблагаемыйДоход;
						ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = 0;
						ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = 0;
						ЕстьДоходыПромежуточногоРасчета = Ложь;
						ЕстьДоходыОкончательногоРасчета = Ложь;
						
						СтруктураПоискаПоДатам.ДатаПолученияДохода = ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода;
						СтруктураПоискаПоДатам.ДоходМежрасчетногоПериода = Истина;
						ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаПоДатам)); 
						СтруктураПоискаПоДатам.ДоходМежрасчетногоПериода = Ложь;
						ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаПоДатам)); 
						
						ТаблицаРаспределенияНаДату = ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода.Скопировать();
						ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета, ТаблицаРаспределенияНаДату);
						Если ТаблицаРаспределенияНаДату.Итог("СуммаДохода") = 0 Тогда
							// если доходов за прошлый месяц нет - будем использовать текущее распределение
							Если ТаблицаРаспределенияМесяцаРасчета = Неопределено Тогда
								ТекущийГод = Год(МесяцРасчета);
								СтруктураПоискаРаспределения = Новый Структура("МесяцНалоговогоПериода");
								БазаРаспределения = 0;
								МесяцПоиска = НачалоМесяца(МесяцРасчета);                                             
								Пока БазаРаспределения = 0 И Год(МесяцПоиска) = ТекущийГод Цикл
									СтруктураПоискаРаспределения.МесяцНалоговогоПериода = МесяцПоиска;
									ТаблицаРаспределенияМесяцаРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаРаспределения));
									БазаРаспределения = ТаблицаРаспределенияМесяцаРасчета.Итог("СуммаДохода");
									МесяцПоиска = ДобавитьМесяц(МесяцПоиска, -1);
								КонецЦикла;
							КонецЕсли;
							ТаблицаРаспределенияНаДату = ТаблицаРаспределенияМесяцаРасчета;
						КонецЕсли;
						ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДату, ТаблицаРаспределенияВычетов);
						
					КонецЕсли;	
					
					НачисленныйДоходЗаДату = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход;
					Если ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода Тогда 
						Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаДату Тогда
							ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
							ЕстьДоходыПромежуточногоРасчета = Истина;
						ИначеЕсли ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход >= ВсегоВычетовЗаМесяц Тогда
							ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
							ЕстьДоходыПромежуточногоРасчета = Истина;
						Иначе
							ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
							ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода.Очистить();
						КонецЕсли;
					Иначе
						ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
						ЕстьДоходыОкончательногоРасчета = Истина;
					КонецЕсли;

					Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаДату Тогда
						
						// Расчет сумм налога
						Если Не ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаМесяц Тогда					
							Если ЕстьДоходыПромежуточногоРасчета Тогда
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
								НалогСДохода = Макс(Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный, 0);
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Макс(Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный, 0);
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
							КонецЕсли;
							Если ЕстьДоходыОкончательногоРасчета Тогда
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный;
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
							КонецЕсли;
						Иначе
							Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
								НалогСДохода = Макс(Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный, 0);
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Макс(Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный, 0);
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный;
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
								
								ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
								
							Иначе
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный;
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ?(ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета));
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ?(ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета));
								
								ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;	
							КонецЕсли;
						КонецЕсли;
						Если ВсеДатыТекущегоРасчета[ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода] = Неопределено Тогда
							СтрокиКУдалению.Очистить();
							РассчитаноНалогаЗаДату = 0;
							РассчитаноНалогаСПревышенияЗаДату = 0;
							Для каждого СтрокаНалога Из ВспомогательнаяТаблицаМесяца Цикл
								Если СтрокаНалога.МесяцНалоговогоПериода = ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода Тогда
									РассчитаноНалогаЗаДату = РассчитаноНалогаЗаДату + СтрокаНалога.НалогПоСтавке13;
									РассчитаноНалогаСПревышенияЗаДату = РассчитаноНалогаСПревышенияЗаДату + СтрокаНалога.НалогСПревышения;
									СтрокиКУдалению.Вставить(СтрокаНалога);
								КонецЕсли;
							КонецЦикла;
							Если РассчитаноНалогаЗаДату * РассчитаноНалогаЗаДату + РассчитаноНалогаСПревышенияЗаДату * РассчитаноНалогаСПревышенияЗаДату = 0 Тогда
								Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
									ВспомогательнаяТаблицаМесяца.Удалить(УдаляемаяСтрока.Ключ);		
								КонецЦикла;	
							КонецЕсли;
						КонецЕсли;
						
						Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
							ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
						Иначе
							ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
						КонецЕсли;
						ВсегоВычетовЗаДату = НачисленныйДоходЗаДату - (ОблагаемыйДоходЗаДату - ОблагаемыйДоходНаНачалоМесяца) - ИспользованоВычетовЗаМесяц;
						ИспользованоВычетовЗаМесяц = ИспользованоВычетовЗаМесяц + ВсегоВычетовЗаДату;
						
						Если ВсегоВычетовЗаДату <> 0 Тогда
								
							// Таблица ВычетыЗаМесяц содержит строки с располагаемыми суммами вычетов, упорядоченные в соответствии с
							// наиболее выгодным для сотрудника приоритетом применения вычетов. Переписываем вычеты из таблицы ВычетыЗаМесяц
							// в таблицу ВспомогательнаяТаблицаВычетовМесяца (распределяя суммы по подразделениям из доходов этой даты
							// получения дохода) в пределах рассчитанного ранее примененного за дату вычета (если сумма вычета и остаток
							// вычета на дату одного знака, берем минимальное по модулю). Если располагаемая сумма вычета полностью исчерпана
							// (стала равна 0), удаляем строку из таблицы ВычетыЗаМесяц.
							ИндексПоследнейСтрокиТаблицыВычетов = ВычетыЗаМесяц.Количество() - 1;
							Индекс = 0;
							Пока Индекс <= ИндексПоследнейСтрокиТаблицыВычетов Цикл		
								ТекущийВычет = ВычетыЗаМесяц[Индекс];
								ЗначениеВычетаЗаМесяц = ТекущийВычет.РазмерВычета;
								Если ВсегоВычетовЗаДату * ЗначениеВычетаЗаМесяц > 0 Тогда		
									Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ЗначениеВычетаЗаМесяц, ВсегоВычетовЗаДату), Макс(ЗначениеВычетаЗаМесяц, ВсегоВычетовЗаДату));
									ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаВычетовМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению, '00010101', Учтено, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДату, ТекущийВычет);
									ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
									ТекущийВычет.РазмерВычета = ЗначениеВычетаЗаМесяц - Учтено;
									Если ТекущийВычет.РазмерВычета = 0 Тогда
										ВычетыЗаМесяц.Удалить(Индекс);
										ИндексПоследнейСтрокиТаблицыВычетов = ИндексПоследнейСтрокиТаблицыВычетов - 1;
										Индекс = Индекс - 1;
									КонецЕсли;
									Если ВсегоВычетовЗаДату = 0 Тогда
										Прервать;
									КонецЕсли;
								КонецЕсли;	
								Индекс = Индекс + 1;
							КонецЦикла;
							
							// Проверим не были ли ранее зарегистрированы в учете предоставленные сейчас вычеты;
							// если были, то при нулевом итоге таблицу очистим, а со следующей даты начнем накапливать вычеты "с чистого листа".
							Если ВспомогательнаяТаблицаВычетовМесяца.Итог("РазмерВычета") = 0 Тогда
								ИтогиПоВычетам = Новый Соответствие;
								Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									Значение = ИтогиПоВычетам[СтрокаТЗ.КодВычета];
									ИтогиПоВычетам.Вставить(СтрокаТЗ.КодВычета, ?(Значение = Неопределено, 0, Значение) + СтрокаТЗ.РазмерВычета)
								КонецЦикла;
								Если ИтогиПоВычетам.Количество() = 1 Тогда
									ВспомогательнаяТаблицаВычетовМесяца.Очистить();
								Иначе
									СтрокиКУдалению.Очистить();
									Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
										Если Не ЗначениеЗаполнено(ИтогиПоВычетам[СтрокаТЗ.КодВычета]) Тогда
											СтрокиКУдалению.Вставить(СтрокаТЗ, Истина)
										КонецЕсли;	
									КонецЦикла;
									Для каждого Элемент Из СтрокиКУдалению Цикл
										ВспомогательнаяТаблицаВычетовМесяца.Удалить(Элемент.Ключ)
									КонецЦикла;
								КонецЕсли;
							КонецЕсли;
						КонецЕсли;
						
					КонецЕсли;	
					
				КонецЕсли;	
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаМесяц Тогда				
					
					// Окончательный сбор вычетов в собственной таблице значений.
					
					Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
						Если Не ОписаниеВычетов[СтрокаТЗ.КодВычета].ИмущественныйВычет Тогда
							СтрокаТЗ.МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода
						КонецЕсли;
					КонецЦикла; 
					
					// Определяем дату получения дохода, к строке которой будут приписаны вычеты этого месяца.
					Если ОкончательныйРасчет Тогда
						Если ПроводитьРасчетЗаОчереднойМесяц Тогда
							ДатаУчетаВычетов = КонецМесяца(МесяцНалоговогоПериода)
						Иначе
							ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)];
							Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаПолученияДохода;
							ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
							ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчета;
							Иначе
								ДатаУчетаВычетов = ДатаНалоговогоПериода;
							КонецЕсли;
						КонецЕсли;
					Иначе
						ДатаУчетаВычетов = ОсновнаяДатаТекущегоРасчета;
					КонецЕсли;
					
					Если ЕстьВычетыЗаМесяц Тогда // Перераспределим итоговые суммы предоставленных вычетов по категориям, сохраняя подразделения.
						
						// Доходов в месяце может не быть, но вычеты приходится предоставлять, распределим их по доходам текущего расчета.
						Если Не ЗначениеЗаполнено(ТаблицаРаспределенияВычетов) Тогда
							Если ОкончательныйРасчет Тогда
								Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам;
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияКонцаМесяцаРасчета;
								Иначе
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияНалоговогоПериода;
								КонецЕсли;
							Иначе
								СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаТекущегоРасчета;
								ТаблицаРаспределенияВычетов = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							КонецЕсли;
						КонецЕсли;
						Если ЗначениеЗаполнено(ВычетыЗаМесяц) Тогда
							БылоСтрокВычетов = ВспомогательнаяТаблицаВычетовМесяца.Количество();
							Для Каждого ТекущийВычет Из ВычетыЗаМесяц Цикл
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаВычетовМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению, '00010101', ТекущийВычет.РазмерВычета, СтруктураПоиска, ТаблицаРаспределенияВычетов, ТекущийВычет);
							КонецЦикла;	
							Для Сч = БылоСтрокВычетов + 1 По ВспомогательнаяТаблицаВычетовМесяца.Количество() Цикл
								ВспомогательнаяТаблицаВычетовМесяца[Сч - 1].МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода
							КонецЦикла;
						КонецЕсли;
						
						ВычетыМесяца = ВспомогательнаяТаблицаВычетовМесяца.СкопироватьКолонки();
						
						ВспомогательнаяТаблицаВычетовМесяца.ЗаполнитьЗначения(ДатаУчетаВычетов, "МесяцНалоговогоПериода");
						ВспомогательнаяТаблицаВычетовМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода, КодВычета", "РазмерВычета");
						Если ВспомогательнаяТаблицаВычетовМесяца.Количество() > 0 Тогда
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица = ВспомогательнаяТаблицаВычетовМесяца.Скопировать( ,"Подразделение");
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Свернуть("Подразделение");
							Если ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Количество() = 1 Тогда
								Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									Если СтрокаТЗ.РазмерВычета <> 0 Тогда
										ВписатьРесурсВРезультатыРасчетов(ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатаУчетаВычетов, СтрокаТЗ.РазмерВычета, СтруктураПоиска, ТаблицаРаспределенияВычетов, СтрокаТЗ);
									КонецЕсли;
								КонецЦикла;
							Иначе 	
								ТаблицаДляРаспределенияПоПодразделению = ТаблицаРаспределенияВычетов.СкопироватьКолонки();
								СтрокиРаспределенияПоПодразделениям = Новый Соответствие;
								Для Каждого СтрокаТаблицыРаспределения Из ТаблицаРаспределенияВычетов Цикл
									СтрокиРаспределения = СтрокиРаспределенияПоПодразделениям[СтрокаТаблицыРаспределения.Подразделение];
									Если СтрокиРаспределения = Неопределено Тогда
										СтрокиРаспределения = Новый Массив;
										СтрокиРаспределенияПоПодразделениям.Вставить(СтрокаТаблицыРаспределения.Подразделение, СтрокиРаспределения);
									КонецЕсли;	
									СтрокиРаспределения.Добавить(СтрокаТаблицыРаспределения);
								КонецЦикла;	
								Для Каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									СтрокиРаспределения = СтрокиРаспределенияПоПодразделениям[СтрокаТЗ.Подразделение];
									Если СтрокиРаспределения = Неопределено Тогда
										ТаблицаРаспределения = ТаблицаРаспределенияВычетов.СкопироватьКолонки();
									Иначе
										ТаблицаРаспределения = ТаблицаРаспределенияВычетов.Скопировать(СтрокиРаспределения);
									КонецЕсли;	
									ВписатьРесурсВРезультатыРасчетов(ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатаУчетаВычетов, СтрокаТЗ.РазмерВычета, СтруктураПоиска, ТаблицаРаспределения, СтрокаТЗ);
								КонецЦикла;
							КонецЕсли;
						КонецЕсли;
						
					Иначе // У сторно-строк вычетов оставим имевшиеся ранее подразделения и категории.
						ВычетыМесяца = ВспомогательнаяТаблицаВычетовМесяца.Скопировать();
						Если ВспомогательнаяТаблицаВычетовМесяца.Количество() > 0 Тогда 
							ВычетыМесяца.ЗаполнитьЗначения(ДатаУчетаВычетов, "МесяцНалоговогоПериода");
						КонецЕсли;
					КонецЕсли;
					
					ВычетыМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода, КодВычета", "РазмерВычета");
					
					// Если у физ.лица также есть доходы, облагаемые не нарастающим итогом, - добавим и их тоже.
					ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельноПоФизическомуЛицу = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.НайтиСтроки(СтруктураПоиска);
					ДописыватьОсновнуюДатуПолученияДохода = Не ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)]);
					Для Каждого СтрокаТЗ Из ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельноПоФизическомуЛицу Цикл
						НалогСДохода = Окр(СтрокаТЗ.ДоходыБезВычетов * СтрокаТЗ.СтавкаЧислом);
						СтрокаНалога = ВспомогательнаяТаблицаМесяца.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаНалога, СтрокаТЗ, "ФизическоеЛицо, Подразделение, КатегорияДохода");
						СтрокаНалога.НалогПоСтавке13 = НалогСДохода;
						СтрокаНалога.МесяцНалоговогоПериода = СтрокаТЗ.ДатаПолученияДохода;
						ВсеКатегорииТекущегоРасчета.Вставить(СтрокаТЗ.КатегорияДохода, Истина);
						ВсеДатыТекущегоРасчета.Вставить(СтрокаТЗ.ДатаПолученияДохода, Истина);
						Если ДописыватьОсновнуюДатуПолученияДохода И СтрокаТЗ.ДоходТекущегоРасчета Тогда
							МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
							ДатыТекущегоРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыТекущегоРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
						КонецЕсли;
						ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Удалить(СтрокаТЗ);
					КонецЦикла;	
					
					// В "межрасчетном" варианте оставляем только те результаты, которые соответствуют месяцу (-ам) получения дохода
					// текущего акта расчета.
					Если Не ОкончательныйРасчет И Не ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)]) И Не ЗначениеЗаполнено(ДатыТекущегоРасчетаНерезидента[Месяц(МесяцНалоговогоПериода)]) Тогда
						
						// В итоговую таблицу запишем только вычеты.
						ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
						
						Если МесяцНалоговогоПериода < КонецМесяца(МесяцРасчета) И ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") + ВспомогательнаяТаблицаМесяца.Итог("НалогСПревышения") = 0 Тогда
							Для каждого СтрокаВычета Из ВычетыМесяца Цикл
								ДобавлятьРезультатМесяцаВИтогиФизлица = СтрокаВычета.РазмерВычета <> 0;
								Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
									Прервать;
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
						
						// Минимизируем появление отсутствующих в текущих доходах категорий дохода.
						Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
							
							ДатаМесяца = ОсновнаяДатаТекущегоРасчета;
							СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаТекущегоРасчета;
							ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							
							ДатыПодразделенияКатегории = ВспомогательныеДатыПодразделенияКатегории.СкопироватьКолонки();
							НаборИзмерений = ВычетыМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							НаборИзмерений.Свернуть("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НаборИзмерений, ДатыПодразделенияКатегории);
							Для каждого СтрокаТЗ Из ДатыПодразделенияКатегории Цикл
								СтрокаТЗ.ЗаменятьДатуПолученияДохода = Истина;
								СтрокаТЗ.ЗаменятьКатегориюДохода = ВсеКатегорииТекущегоРасчета[СтрокаТЗ.КатегорияДохода] = Неопределено;
								СтрокаТЗ.ЗаменятьПодразделение = МесяцНалоговогоПериода >= НачалоМесяца(МесяцРасчета) И НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода) = НачалоМесяца(ДатаМесяца);
								СтрокаТЗ.Распределение = ТаблицаРаспределенияТекущегоМесяца;
								Если ОсобыеКатегорииДохода[СтрокаТЗ.КатегорияДохода] = Истина Тогда
									СтрокаТЗ.ЗаменятьПодразделение = Ложь;
									СтрокаТЗ.ЗаменятьКатегориюДохода = Ложь;
								ИначеЕсли СтрокаТЗ.ЗаменятьПодразделение Тогда 	
									СтруктураПоискаПоДатамИПодразделениям.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
									СтруктураПоискаПоДатамИПодразделениям.Подразделение = СтрокаТЗ.Подразделение;
									СтрокаТЗ.ЗаменятьПодразделение = ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаПоДатамИПодразделениям).Количество() = 0;
								КонецЕсли;
							КонецЦикла;
							Если ДатыПодразделенияКатегории.Количество() > 2 Тогда
								ДатыПодразделенияКатегории.Индексы.Добавить("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							КонецЕсли;
							
							ВспомогательнаяТаблицаВычетовМесяца.Очистить();
							ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаВычетовМесяца, ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатыПодразделенияКатегории, ДатаМесяца, "МесяцПериодаПредоставленияВычета, КодВычета");
							
							// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
							ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаМесяца.СкопироватьКолонки(), ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов);
						КонецЕсли;
						
						ВспомогательнаяТаблицаМесяца.Очистить();
						
					Иначе 
					
						ИсчисленоНДФЛЗаГод = ИсчисленоНДФЛЗаГод + ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") + ВспомогательнаяТаблицаМесяца.Итог("НалогСПревышения");
						
						Если ПроводитьРасчетЗаОчереднойМесяц Тогда
							
							// Вычеркнем из результата строки по переброске некоторой суммы с одной категории на другую.
							ТаблицаМесяцаБезКатегорийДохода = ВспомогательнаяТаблицаМесяца.Скопировать();
							ТаблицаМесяцаБезКатегорийДохода.Свернуть("МесяцНалоговогоПериода, Подразделение", "НалогПоСтавке13, НалогСПревышения");
							Для каждого СтрокаТЗ Из ТаблицаМесяцаБезКатегорийДохода Цикл
								Если СтрокаТЗ.НалогПоСтавке13 = 0 Или СтрокаТЗ.НалогСПревышения = 0 Тогда
									СтрокиКОбнулению = ВспомогательнаяТаблицаМесяца.НайтиСтроки(Новый Структура("МесяцНалоговогоПериода, Подразделение", СтрокаТЗ.МесяцНалоговогоПериода, СтрокаТЗ.Подразделение));
									Если СтрокаТЗ.НалогПоСтавке13 = 0 И СтрокаТЗ.НалогСПревышения = 0 Тогда
										Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
											ВспомогательнаяТаблицаМесяца.Удалить(СтрокаКОбнулению);
										КонецЦикла; 	
									ИначеЕсли СтрокаТЗ.НалогПоСтавке13 = 0 Тогда
										Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
											 СтрокаКОбнулению.НалогПоСтавке13 = 0
										КонецЦикла; 	
									Иначе	
										Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
											 СтрокаКОбнулению.НалогСПревышения = 0
										КонецЦикла; 	
									КонецЕсли;
								КонецЕсли;
							КонецЦикла;
							
							// Минимизируем появление отсутствующих в текущих доходах дат получения и категорий дохода:
							// 1. Определяем подходящую дату получения дохода и соответствующее ей распределение
							// при этом некоторые результаты расчетов могут быть проигнорированы совсем.
							ДобавлятьРезультатМесяцаВИтогиФизлица = Истина;
							ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)];
							Если ОкончательныйРасчет Тогда
								Если Не ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда // перерасчет налога при отсутствии дохода текущего акта расчета
									Если МесяцНалоговогоПериода > КонецМесяца(МесяцРасчета) Тогда // перерасчет по будущим доходам не производим
										ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
									ИначеЕсли ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") = 0 И ВспомогательнаяТаблицаМесяца.Итог("НалогСПревышения") = 0 И МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Тогда // нашли предшествующий месяц с нулевым налогом
										ВычетыДляПроверки = ВычетыМесяца.Скопировать(, "КодВычета, РазмерВычета");
										ВычетыДляПроверки.Свернуть("КодВычета", "РазмерВычета");
										ЕстьДанныеМесяца = Ложь;
										Для каждого СтрокаТЗ Из ВычетыДляПроверки Цикл
											ЕстьДанныеМесяца = СтрокаТЗ.РазмерВычета <> 0;
											Если ЕстьДанныеМесяца Тогда
												Прервать;
											КонецЕсли;
										КонецЦикла;
										Если Не ЕстьДанныеМесяца Тогда // игнорируем различные переброски сумм одного вычета, но не между вычетами 
											ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
											ВспомогательнаяТаблицаМесяца.Очистить();
										КонецЕсли;
									КонецЕсли;
								КонецЕсли;
								Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
									Если МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Тогда
										Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
											ДатаМесяца = ОсновнаяДатаПолученияДохода;
											СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
											ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
										ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
											ДатаМесяца = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам;
										ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
											ДатаМесяца = ОсновнаяДатаМесяцаРасчета;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияКонцаМесяцаРасчета;
										Иначе
											ДатаМесяца = ДатаНалоговогоПериода;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияНалоговогоПериода;
										КонецЕсли;
									Иначе
										Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
											ДатаМесяца = ОсновнаяДатаПолученияДохода;
											СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
											ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
										Иначе
											ДатаМесяца = ДатаНалоговогоПериода;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияНалоговогоПериода;
										КонецЕсли;
									КонецЕсли;
								КонецЕсли;
							Иначе	
								ДатаМесяца = ОсновнаяДатаПолученияДохода;
								СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
								ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							КонецЕсли;
							Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
								
								// 2. Заменяем даты получения дохода на подходящую и пересматриваем категорию дохода
								ДатыПодразделенияКатегории = ВспомогательныеДатыПодразделенияКатегории.СкопироватьКолонки();
								НаборИзмерений = ВспомогательнаяТаблицаМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВычетыМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение"), НаборИзмерений);
								НаборИзмерений.Свернуть("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НаборИзмерений, ДатыПодразделенияКатегории);
								Для каждого СтрокаТЗ Из ДатыПодразделенияКатегории Цикл
									СтрокаТЗ.ЗаменятьДатуПолученияДохода = ВсеДатыТекущегоРасчета[СтрокаТЗ.МесяцНалоговогоПериода] = Неопределено;
									СтрокаТЗ.ЗаменятьКатегориюДохода = ВсеКатегорииТекущегоРасчета[СтрокаТЗ.КатегорияДохода] = Неопределено;
									СтрокаТЗ.ЗаменятьПодразделение = МесяцНалоговогоПериода >= НачалоМесяца(МесяцРасчета) И НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода) = НачалоМесяца(ДатаМесяца);
									Если ОсобыеКатегорииДохода[СтрокаТЗ.КатегорияДохода] = Истина Тогда
										СтрокаТЗ.ЗаменятьПодразделение = Ложь;
										СтрокаТЗ.ЗаменятьКатегориюДохода = Ложь;
									ИначеЕсли СтрокаТЗ.ЗаменятьПодразделение Тогда 	
										СтруктураПоискаПоДатамИПодразделениям.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
										СтруктураПоискаПоДатамИПодразделениям.Подразделение = СтрокаТЗ.Подразделение;
										СтрокаТЗ.ЗаменятьПодразделение = ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаПоДатамИПодразделениям).Количество() = 0;
									КонецЕсли;
									Если СтрокаТЗ.ЗаменятьДатуПолученияДохода Тогда
										СтрокаТЗ.Распределение = ТаблицаРаспределенияТекущегоМесяца;
									Иначе
										СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
										СтрокаТЗ.Распределение = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
									КонецЕсли;
								КонецЦикла;
								Если ДатыПодразделенияКатегории.Количество() > 2 Тогда
									ДатыПодразделенияКатегории.Индексы.Добавить("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								КонецЕсли;
								
								ВспомогательнаяТаблицаФизическогоЛица.Очистить();
								ВспомогательнаяТаблицаПоДоходамПревышения.Очистить();
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаПоДоходамПревышения);
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ДатыПодразделенияКатегории, ДатаМесяца);
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаПоДоходамПревышения, ПараметрыЗаполненияРесурсаНалогСПревышения, ДатыПодразделенияКатегории, ДатаМесяца);
								ВспомогательнаяТаблицаМесяца.Очистить();
								ВспомогательнаяТаблицаВычетовМесяца.Очистить();
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаВычетовМесяца, ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатыПодразделенияКатегории, ДатаМесяца, "МесяцПериодаПредоставленияВычета, КодВычета");
								
								// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
								ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов);
							КонецЕсли;
							
						Иначе
							
							// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
							ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаМесяца, ВычетыМесяца, ОписаниеВычетов);
							ВспомогательнаяТаблицаМесяца.Очистить();
							
						КонецЕсли;
						
					КонецЕсли;
					
				КонецЕсли;		
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаГод Тогда
					Если ИсчисленоНДФЛЗаГод <> 0 Тогда
						// вписываем зачтенные авансовые платежи иностранцев
						ВписатьАвансовыеПлатежиВРезультатРасчета(СтрокиНДФЛЗаГод, ОстаткиПоАвансовымПлатежам, ИсчисленоНДФЛЗаГод, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
					Иначе // игнорируем различные переброски сумм одного вычета, но не между вычетами
						НетДанных = Истина;
						Для каждого ЭлементОписания Из ОписаниеВычетов Цикл
							ИмяКолонки = ЭлементОписания.Значение.ИмяКолонки;
							СуммаВычета = 0; ЕстьЗначенияВКолонке = Ложь;
							Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
								СуммаВычета = СуммаВычета + СтрокаРезультата[ИмяКолонки];
								ЕстьЗначенияВКолонке = ЕстьЗначенияВКолонке Или СтрокаРезультата[ИмяКолонки] <> 0
							КонецЦикла;
							Если ЕстьЗначенияВКолонке И СуммаВычета = 0 Тогда
								Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
									Если ИмяКолонки = "ПримененныйВычетЛичный" Тогда
										СтрокаРезультата.КодВычетаЛичный = ""	
									КонецЕсли;
									СтрокаРезультата[ИмяКолонки] = 0
								КонецЦикла;
							КонецЕсли;
							НетДанных = НетДанных И СуммаВычета = 0;
						КонецЦикла;
						Если НетДанных Тогда // удаляем незначащие строки за год из результата
							Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
								РезультатРасчетаВспомогательный.Удалить(СтрокаРезультата)
							КонецЦикла;
						КонецЕсли;
					КонецЕсли;
					ПродолжатьРасчет = Ложь;
				Иначе
					ИндексТекущейСтрокиТаблицыДоходов = ИндексТекущейСтрокиТаблицыДоходов + 1;
				КонецЕсли;	
				
			КонецЦикла;  // по налоговым периодам физ.лиц
			
			Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаПоФизическомуЛицу Тогда // заканчиваем обработку физ.лица
				Если ОкончательныйРасчет Тогда
					// Допишем учтенные в расчете документы-основания.
					ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
					СоответствиеФизическихЛиц.Удалить(ТекущееФизическоеЛицо);
				Иначе 
					// Перенесем результаты расчета в основную таблицу с учетом ограничений.
					ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета, ВсегоДоходовТекущегоРасчета + ДоходыТекущегоРасчетаНерезидента.Итог("ДоходыБезВычетов"));	
				КонецЕсли;
			КонецЕсли;	
			
			ИндексТекущейСтрокиТаблицыДоходов = ИндексТекущейСтрокиТаблицыДоходов + 1;
			
		КонецЦикла;	
		
	КонецЕсли;
	
	// Продолжим расчет по нерезидентам.
	СтрокОтдельныхСумм = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Количество();
	Если СтрокОтдельныхСумм > 0 Тогда

		ИндексОбрабатываемойСтроки = 0;
		ТекущееФизическоеЛицо = Неопределено;
		ТекущийНалоговыйПериод = '00010101';
		МесяцНалоговогоПериодаПредыдущейСтроки = '00010101';
		СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Ложь;
		СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;
		// Если выполняется окончательный расчет, будем вписывать результат расчета сразу в таблицы результата.
		// В случае с промежуточным расчетом будем использовать промежуточную таблицу, а потом переносить в результирующую с
		// учетом ограничений.
		Если Не ОкончательныйРасчет Тогда
			РезультатРасчетаВспомогательный = РезультатРасчета.СкопироватьКолонки();
		КонецЕсли;	
		
		Пока ИндексОбрабатываемойСтроки <= СтрокОтдельныхСумм - 1 Цикл
			
			ТекущаяСтрока = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно[ИндексОбрабатываемойСтроки];
			
			Если ТекущаяСтрока.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда 
				
				Если ТекущееФизическоеЛицо <> Неопределено Тогда  // Завершение обработки предыдущего физлица.
					
					// вычтем ранее исчисленное
					СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
					Для СчМесяцев = 1 По Месяц(МесяцНалоговогоПериодаПредыдущейСтроки) Цикл
						СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев - 1);
						ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
					КонецЦикла;
					
					// впишем засчитываемые авансовые платежи
					ВписатьАвансовыеПлатежиВРезультатРасчета(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
					
					// перепишем результаты за последний налоговый период
					ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов, Месяц(МесяцНалоговогоПериодаПредыдущейСтроки));
					
					// окончательно доработаем результаты
					Если ОкончательныйРасчет Тогда
						Если СоответствиеФизическихЛиц[ТекущееФизическоеЛицо] <> Неопределено Тогда // Допишем учтенные в расчете документы-основания.
							СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
							ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
						КонецЕсли;
					Иначе
						ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета);	
					КонецЕсли;
					
				КонецЕсли;
				
				ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо; // Начало обработки очередного физлица.
				ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода);
				ВспомогательнаяТаблицаМесяца.Очистить();
				Если Не ОкончательныйРасчет Тогда
					РезультатРасчетаВспомогательный.Очистить();
				КонецЕсли;	
				ЗаполнитьЗначенияСвойств(СтруктураПоискаСтандартныхВычетов, ТекущаяСтрока);
				ЗаполнитьЗначенияСвойств(СтруктураПоискаИмущественныхВычетов, ТекущаяСтрока);
			
			КонецЕсли;
			
			Если ТекущийНалоговыйПериод <> НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода) Тогда
				
				// Завершение обработки предыдущего налогового периода.
				
				// вычтем ранее исчисленное
				СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
				Для СчМесяцев = 0 По 11 Цикл
					СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев);
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
				КонецЦикла;
				
				// впишем засчитываемые авансовые платежи
				ВписатьАвансовыеПлатежиВРезультатРасчета(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
				
				// перепишем результаты за налоговый период
				ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов);
				
				// Начало обработки очередного налогового периода.
				
				ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода); 
				ВспомогательнаяТаблицаМесяца.Очистить();
				
			КонецЕсли;
			
			// Расчет налога по очередной строке дохода.
			
			СтрокаНалога = ВспомогательнаяТаблицаМесяца.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНалога, ТекущаяСтрока, "ФизическоеЛицо, Подразделение, КатегорияДохода");
			СтрокаНалога.НалогПоСтавке13 = Окр(ТекущаяСтрока.ДоходыБезВычетов * ТекущаяСтрока.СтавкаЧислом);
			СтрокаНалога.МесяцНалоговогоПериода = ТекущаяСтрока.ДатаПолученияДохода;
			
			МесяцНалоговогоПериодаПредыдущейСтроки = ТекущаяСтрока.МесяцНалоговогоПериода;
			ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
			
		КонецЦикла;
		
		Если ТекущееФизическоеЛицо <> Неопределено Тогда  // Завершение обработки последнего по порядку физлица.
			
			// вычтем ранее исчисленное
			СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
			Для СчМесяцев = 1 По Месяц(ТекущаяСтрока.МесяцНалоговогоПериода) Цикл
				СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев - 1);
				ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
			КонецЦикла;
			
			// впишем засчитываемые авансовые платежи
			ВписатьАвансовыеПлатежиВРезультатРасчета(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
			
			// перепишем результаты за последний налоговый период
			ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов, Месяц(ТекущаяСтрока.МесяцНалоговогоПериода));
					
			// окончательно доработаем результаты
			Если ОкончательныйРасчет Тогда
				Если СоответствиеФизическихЛиц[ТекущееФизическоеЛицо] <> Неопределено Тогда // Допишем учтенные в расчете документы-основания.
					СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
					ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
				КонецЕсли;
			Иначе
				ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета);	
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
	// Дозаполним категорию дохода значением по умолчанию.
	Для Каждого СтрокаРезультат Из РезультатРасчета Цикл
		Если Не ЗначениеЗаполнено(СтрокаРезультат.КатегорияДохода) Тогда
			СтрокаРезультат.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда;
		КонецЕсли;
	КонецЦикла;

	// Допишем полученные ранее результаты расчета прошлых лет
	Для каждого СтрокаРезультат Из РезультатыПрошлыхЛет Цикл
		Если СтрокаРезультат.МесяцНалоговогоПериода < ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале Тогда
			ЗаполнитьЗначенияСвойств(РезультатРасчета.Добавить(), СтрокаРезультат);
		КонецЕсли;
	КонецЦикла;
	
	Возврат РезультатРасчета;
	
КонецФункции

Функция РассчитатьНалогДо2025Года(ИсключаемыйРегистратор, Организация, МесяцРасчета, Знач СписокФизическихЛиц, Знач ПервыйМесяцНалоговогоПериода = Неопределено, Знач ПоследнийМесяцНалоговогоПериода = Неопределено, Знач ОкончательныйРасчет = Истина, Знач ДатаУдержанияИсчисленногоНалога = Неопределено, ДвиженияТекущегоРегистратора = Неопределено) Экспорт	
	
	// 0. Проверим, стОит ли вообще что-то считать: массив физ.лиц может быть пустым, либо доходы межрасчетного
	// регистратора могут быть нулевыми. В обоих случаях результатом расчетов окажется пустая таблица.
	Если Не ЗначениеЗаполнено(СписокФизическихЛиц) Тогда
		Возврат ТаблицаНДФЛ()
	КонецЕсли;
	ЕстьДвиженияТекущегоРегистратораПоДоходам = ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "СведенияОДоходахНДФЛ");
	Если Не ОкончательныйРасчет И Не ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		Возврат ТаблицаНДФЛ()
	КонецЕсли;
	Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		ДоходыТекущегоРегистратора = ДвиженияТекущегоРегистратора.СведенияОДоходахНДФЛ.Выгрузить();
		Если Не ОкончательныйРасчет Тогда
			ТаблицаДоходовТекущегоРегистратора = ДоходыТекущегоРегистратора.Скопировать(ДоходыТекущегоРегистратора.НайтиСтроки(Новый Структура("Сторно, ЗарегистрированоПриНачисленииАванса", Ложь, '00010101')), "ФизическоеЛицо, СуммаДохода, СуммаВычета");
 			Если СписокФизическихЛиц.Количество() = 1 Тогда
				Если ТаблицаДоходовТекущегоРегистратора.Итог("СуммаДохода") - ТаблицаДоходовТекущегоРегистратора.Итог("СуммаВычета") = 0 Тогда
					Возврат ТаблицаНДФЛ()
				КонецЕсли;
			Иначе
				ТаблицаДоходовТекущегоРегистратора.Свернуть("ФизическоеЛицо", "СуммаДохода, СуммаВычета");
				Для каждого ТекущаяСтрока Из ТаблицаДоходовТекущегоРегистратора Цикл
					Если ТекущаяСтрока.СуммаДохода - ТекущаяСтрока.СуммаВычета = 0 Тогда
						ОбщегоНазначенияКлиентСервер.УдалитьЗначениеИзМассива(СписокФизическихЛиц, ТекущаяСтрока.ФизическоеЛицо)
					КонецЕсли;		
				КонецЦикла;
				Если Не ЗначениеЗаполнено(СписокФизическихЛиц) Тогда
					Возврат ТаблицаНДФЛ()
				КонецЕсли;
			КонецЕсли;  
			ОкончательныйРасчет = ДоходыТекущегоРегистратора.НайтиСтроки(Новый Структура("ЗарегистрированоПриНачисленииАванса", МесяцРасчета)).Количество() > 0;
		КонецЕсли;
	КонецЕсли;
	
	ГоловнаяОрганизация = ЗарплатаКадры.ГоловнаяОрганизация(Организация);
	НачалоМесяцаРасчета = НачалоМесяца(МесяцРасчета);
	КонецМесяцаРасчета = КонецМесяца(МесяцРасчета); 
	СоответствиеФизическихЛиц = Новый Соответствие;
	Для Каждого ЭлементМассива Из СписокФизическихЛиц Цикл
		СоответствиеФизическихЛиц.Вставить(ЭлементМассива, ОкончательныйРасчет);
	КонецЦикла;	
	МаксимальнаяДата = ЗарплатаКадрыПериодическиеРегистры.МаксимальнаяДата();
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ГоловнаяОрганизация);
	Запрос.УстановитьПараметр("НачалоМесяцаРасчета", НачалоМесяцаРасчета);
	Запрос.УстановитьПараметр("КонецМесяцаРасчета", КонецМесяцаРасчета);
	Запрос.УстановитьПараметр("СписокФизическихЛиц", СписокФизическихЛиц);
	Запрос.УстановитьПараметр("ИсключаемыйРегистратор", ИсключаемыйРегистратор);
	
	// 1.	Определим минимальные и максимальные периоды расчета в целом по всем физическим лицам
	//	Если на вход переданы первый и последний месяцы налогового периода (заказан перерасчет конкретного периода) - ничего не делаем.
	//	Среди записей регистра СведенияОДоходахНДФЛ, зарегистрированных в месяце расчета, получим минимальное и максимальное значение поля МесяцНалоговогоПериода
	ИсходныйПервыйМесяцНалоговогоПериода = ПервыйМесяцНалоговогоПериода;
	ИсходныйПоследнийМесяцНалоговогоПериода = ПоследнийМесяцНалоговогоПериода;
	ЭтоРасчетПоДоходамТекущегоМесяца = ПервыйМесяцНалоговогоПериода = Неопределено Или ПоследнийМесяцНалоговогоПериода = Неопределено;
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		
		ПервыйМесяцНалоговогоПериода = МаксимальнаяДата;
		ПоследнийМесяцНалоговогоПериода = '00010101';
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	МАКСИМУМ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК ПоследнийМесяцНалоговогоПериода,
		|	МИНИМУМ(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода) КАК ПервыйМесяцНалоговогоПериода
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
		|	И СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
		|	И &УсловиеОблагаемостиУНалоговогоАгента";
		Если ОкончательныйРасчет Тогда
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "И СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода", "");
		КонецЕсли;
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.ПервыйМесяцНалоговогоПериода) Тогда
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(Выборка.ПервыйМесяцНалоговогоПериода);
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(Выборка.ПоследнийМесяцНалоговогоПериода);
		КонецЕсли;
		
		Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
			
			ДоходыТекущегоРегистратора.Сортировать("МесяцНалоговогоПериода");
			
			Для Каждого ТекущаяСтрока Из ДоходыТекущегоРегистратора Цикл
				Если ТекущаяСтрока.МесяцНалоговогоПериода >= ПервыйМесяцНалоговогоПериода Тогда
					Прервать;
				КонецЕсли;
				Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] <> Неопределено
					И ТекущаяСтрока.ГоловнаяОрганизация = ГоловнаяОрганизация
					И ТекущаяСтрока.Период >= НачалоМесяцаРасчета
					И ТекущаяСтрока.Период <= КонецМесяцаРасчета	
					И (ОкончательныйРасчет Или ТекущаяСтрока.ДоходМежрасчетногоПериода)	Тогда
					
					ПервыйМесяцНалоговогоПериода = НачалоМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
					Прервать;
				КонецЕсли;		 			
			КонецЦикла;	 
			Для Сч = 1 По ДоходыТекущегоРегистратора.Количество() Цикл
				ТекущаяСтрока = ДоходыТекущегоРегистратора[ДоходыТекущегоРегистратора.Количество() - Сч];
				Если ТекущаяСтрока.МесяцНалоговогоПериода <= ПоследнийМесяцНалоговогоПериода Тогда
					Прервать;
				КонецЕсли;
				Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] <> Неопределено 
					И ТекущаяСтрока.ГоловнаяОрганизация = ГоловнаяОрганизация
					И ТекущаяСтрока.Период >= НачалоМесяцаРасчета
					И ТекущаяСтрока.Период <= КонецМесяцаРасчета	
					И (ОкончательныйРасчет Или ТекущаяСтрока.ДоходМежрасчетногоПериода)	Тогда
					
					ПоследнийМесяцНалоговогоПериода = КонецМесяца(ТекущаяСтрока.МесяцНалоговогоПериода);
					Прервать;
				КонецЕсли;	
			КонецЦикла;
			
		КонецЕсли;
		
		Если ПоследнийМесяцНалоговогоПериода = '00010101' Тогда
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета);
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(МесяцРасчета);
		КонецЕсли;	
	
	КонецЕсли;	
	
	// 1.1	Если расчет не затрагивает даже 2023 года, воспользуемся предыдущей реализацией алгоритма расчета
	ПервыйМесяцТекущегоАлгоритма = УчетНДФЛ.ДатаЗакона263ФЗ();
	Если ПоследнийМесяцНалоговогоПериода < ПервыйМесяцТекущегоАлгоритма Тогда
		Возврат РассчитатьНалогДо2023Года(ИсключаемыйРегистратор, Организация, МесяцРасчета, СписокФизическихЛиц, ИсходныйПервыйМесяцНалоговогоПериода, ИсходныйПоследнийМесяцНалоговогоПериода, ОкончательныйРасчет, ДатаУдержанияИсчисленногоНалога, ДвиженияТекущегоРегистратора)
	КонецЕсли;
	
	// 1.2	Для пересмотра расчетов прошлых лет (2022 и ранее) воспользуемся предыдущей реализацией алгоритма расчета. 
	РезультатыПрошлыхЛет = ТаблицаНДФЛ();
	Если ПервыйМесяцНалоговогоПериода < ПервыйМесяцТекущегоАлгоритма Тогда
		ПервыйМесяцНалоговогоПериода = ПервыйМесяцТекущегоАлгоритма;
		РезультатыПрошлыхЛет = РассчитатьНалогДо2023Года(ИсключаемыйРегистратор, Организация, МесяцРасчета, СписокФизическихЛиц, ИсходныйПервыйМесяцНалоговогоПериода, ПервыйМесяцТекущегоАлгоритма - 1, ОкончательныйРасчет, ДатаУдержанияИсчисленногоНалога, ДвиженияТекущегоРегистратора);
	КонецЕсли;
	ПоследнийМесяцНалоговогоПериода = Мин(УчетНДФЛ.ДатаЗакона176ФЗ() - 1, ПоследнийМесяцНалоговогоПериода);
	
	НачалоПредшествующегоГода = ДобавитьМесяц(НачалоГода(ПервыйМесяцНалоговогоПериода), -12);;
	НачалоГодаПериодаРасчета = НачалоГода(ПервыйМесяцНалоговогоПериода);
	КонецПериодаРасчета = КонецМесяца(ПоследнийМесяцНалоговогоПериода);
	НачалоГодаРасчета = НачалоГода(МесяцРасчета); 
	ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета = КонецМесяцаРасчета;
	Если Не ЭтоРасчетПоДоходамТекущегоМесяца И ЗначениеЗаполнено(ДатаУдержанияИсчисленногоНалога) Тогда
		ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета = Макс(ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета, КонецДня(ДатаУдержанияИсчисленногоНалога));
		ДатаУдержанияИсчисленногоНалога = Неопределено;
	КонецЕсли;
	
	Запрос.УстановитьПараметр("НачалоПредшествующегоГода", НачалоПредшествующегоГода);
	Запрос.УстановитьПараметр("НачалоГодаПериодаРасчета", НачалоГодаПериодаРасчета);
	Запрос.УстановитьПараметр("НачалоГодаРасчета", НачалоГодаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаРасчета", КонецПериодаРасчета);
	Запрос.УстановитьПараметр("ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета", ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета);
	Запрос.УстановитьПараметр("КонецПредшествующегоМесяца", НачалоМесяцаРасчета - 1);
	Запрос.УстановитьПараметр("ДатаОбъединенияНалоговыхБаз", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.ДатаОбъединенияНалоговыхБаз);
	Запрос.УстановитьПараметр("ОсновнаяНалоговаяБаза", Перечисления.КатегорииДоходовНДФЛ.ОсновнаяНалоговаяБаза());
	Запрос.УстановитьПараметр("ПоОсновнойСтавке", Перечисления.КатегорииДоходовНДФЛ.ПоОсновнойСтавке());
	
	//  Порядок учета данных, зарегистрированных при начислении аванса 
	//  (порядок зачета авансов при проведении см. в описании метода ДополнитьДвиженияСписаниемАванса) 
	//  
	//	При отборе данных учитываем, что доходы по окончании месяца начисляются в полном размере, т.е. авансовые записи после окончательного расчета из учета "исчезают", 
	//	а все результаты (налог, зачтенные авансы и пр.) рассчитываются заново исходя из полных доходов. 
	//  Стандартные/имущественные вычеты после окончательного расчета повторно в результаты расчета не вписываем - эти авансовые данные считаем "настоящими".
	//  
	//  Таким образом:
	//  - авансовые движения прошлых месяцев (по значению поля ЗарегистрированоПриНачисленииАванса) учитываются во всех вариантах расчета как есть
	//  - при выполнении перерасчета по итогам периода учитываются все авансы пересчитываемого периода 
	//  - при выполнении промежуточного расчета данные авансов текущего месяца считаются данными другого промежуточного расчета
	//  - при выполнении окончательного расчета: 
	//		не читаем из учета авансовые движения текущего месяца по регистрам СведенияОДоходахНДФЛ, РасчетыНалогоплательщиковСБюджетомПоНДФЛ, 
	//			АвансовыеПлатежиИностранцевПоНДФЛ, из регистра ИмущественныеВычетыНДФЛ (ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ) не читаем строки  
	//			по социальному вычету в размере удержаний на накопительную пенсию;
	//		корректируем данные о доходах текущего документа (по которому ведется расчет): "авансовую" часть доходов берем с датой фактической выплаты,   
	//			а невыплаченные на момент расчета авансы не учитываем совсем
	
	// 2.	Получаем информацию об исчисленном ранее налоге
	//	Читаем приходные записи (соответствуют налогу исчисленному) регистра накопления РасчетыНалогоплательщиковСБюджетомПоНДФЛ по списку физических лиц и головной организации со ставкой резидента 13%, 
	//	зарегистрированные за период между началом года первого месяца налогового периода и концом последнего месяца налогового периода.
	//	Дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Рассчитываем поле МесяцНалоговогоПериодаДляПоиска как начало месяца налогового периода.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо,  МесяцНалоговогоПериодаДляПоиска, МесяцНалоговогоПериода, Подразделение, КатегорияДохода и НалогПоСтавке13, НалогСПревышения
	
	// 3.	Получаем ТЗ данные о доходах 
	//	Из регистра накоплений СведенияОДоходахНДФЛ получим записи, соответствующие условиям:
	//	- записи, зарегистрированные между началом года, предшествующего полученному на предыдущем шаге минимальному месяцу налогового периода, и окончанием месяца расчета
	//	- месяц налогового периода у записей между началом года месяца минимального налогового периода и концом месяца максимального налогового периода
	//	- доход облагается у налогового агента
	//	- ставка налогообложения дохода для налоговых резидентов РФ - 13%
	//	- записи с непустым значением в реквизите ЗарегистрированоПриНачисленииАванса (записи авансового расчета) учитываются по описанным выше правилам 
	//	Если выполняется промежуточный расчет, а доход зарегистрирован в месяце расчета только для окончательного расчета (ДоходМежрасчетногоПериода = Ложь), 
	//	сумму дохода и сумму вычета будем считать равными 0  
	//
	//	Затем добавим записи текущего набора доходов, применив к ним те же условия (уже на языке 1С), что и в запросе.
	
	Если ОкончательныйРасчет Тогда
		
		// В варианте расчета "по окончании месяца" делим физических лиц, по которым производится расчет, на две группы: 
		//	- тех, у кого авансовые доходы полностью зачтены ранее, помещаем в массив ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора; 
		//		для них читаем данные "без оглядки" на существование авансов (как при полном перерасчете)
		//	- тех, у кого авансы были зачтены не полностью, либо еще не засчитывались, помещаем в массив ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора; 
		//		для них доходы текущего документа корректируются так, чтобы для сумм авансов использовать дату получения аванса 
		
		ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора = ОбщегоНазначения.СкопироватьРекурсивно(СписокФизическихЛиц);
		ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора = Новый Массив;
		ФизическиеЛицаДляЧтенияДополнительныхАвансов = Неопределено;
		ФизическиеЛицаБезДвиженийТекущегоРегистратора = Новый Массив;
		Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
			Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
				СоответствиеИмеющихЗачетАванса = Новый Соответствие;
				СоответствиеИмеющихДоходыТекущегоРегистратора = Новый Соответствие;
				Для каждого СтрокаДанных Из ДоходыТекущегоРегистратора Цикл
					Если ЗначениеЗаполнено(СтрокаДанных.ЗарегистрированоПриНачисленииАванса) Тогда
						СоответствиеИмеющихЗачетАванса.Вставить(СтрокаДанных.ФизическоеЛицо, Истина)
					КонецЕсли;
					СоответствиеИмеющихДоходыТекущегоРегистратора.Вставить(СтрокаДанных.ФизическоеЛицо, Истина)
				КонецЦикла;
				Для каждого КлючИЗначение Из СоответствиеИмеющихЗачетАванса Цикл
					ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора.Добавить(КлючИЗначение.Ключ)
				КонецЦикла; 
				ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора = ОбщегоНазначенияКлиентСервер.РазностьМассивов(СписокФизическихЛиц, ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора);
				Для каждого Элемент Из СписокФизическихЛиц Цикл
					Если СоответствиеИмеющихДоходыТекущегоРегистратора[Элемент] = Неопределено Тогда
						ФизическиеЛицаБезДвиженийТекущегоРегистратора.Добавить(Элемент)
					КонецЕсли;
				КонецЦикла; 
				ФизическиеЛицаДляЧтенияДополнительныхАвансов = ОбщегоНазначения.СкопироватьРекурсивно(ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора);
			Иначе
				ФизическиеЛицаБезДвиженийТекущегоРегистратора = ОбщегоНазначения.СкопироватьРекурсивно(СписокФизическихЛиц);
			КонецЕсли;
			Если ЗначениеЗаполнено(ФизическиеЛицаБезДвиженийТекущегоРегистратора) Тогда
				
				// В текущем регистраторе, который считает налог, может не быть новых доходов, но доходы могли быть зарегистрированы другими документами, не считавшими налог.
				// Сразу добавляем в движения текущего регистратора по регистру доходов суммы зачтенного другими документами аванса, чтобы расчет выполнялся с учетом даты выплаты аванса. 
				
				Запрос.УстановитьПараметр("ФизическиеЛицаБезДвиженийТекущегоРегистратора", ФизическиеЛицаБезДвиженийТекущегоРегистратора);
				Запрос.УстановитьПараметр("НачалоПредшествующегоМесяца", ДобавитьМесяц(НачалоМесяцаРасчета, -1));
				Запрос.Текст = 
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	Авансы.ФизическоеЛицо КАК ФизическоеЛицо,
				|	Авансы.ДокументОснование КАК ДокументОснование
				|ПОМЕСТИТЬ ВТДокументыОснования
				|ИЗ
				|	РегистрНакопления.ЗарплатаКВыплатеАвансом КАК Авансы
				|ГДЕ
				|	Авансы.Организация.ГоловнаяОрганизация = &ГоловнаяОрганизация
				|	И Авансы.Период МЕЖДУ &НачалоПредшествующегоМесяца И &КонецПериодаРасчета
				|	И Авансы.ФизическоеЛицо В(&ФизическиеЛицаБезДвиженийТекущегоРегистратора)
				|	И Авансы.ПериодВзаиморасчетов = &НачалоМесяцаРасчета
				|	И Авансы.Регистратор <> &ИсключаемыйРегистратор
				|	И Авансы.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
				|	ВЫБОР
				|		КОГДА ДокументыОснования.ДокументОснование ЕСТЬ НЕ NULL 
				|			ТОГДА СведенияОДоходахНДФЛ.СуммаДохода
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК АвансаНачислено,
				|	ВЫБОР
				|		КОГДА ДокументыОснования.ДокументОснование ЕСТЬ НЕ NULL 
				|			ТОГДА СведенияОДоходахНДФЛ.СуммаВычета
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК СуммаВычетаНачислено,
				|	ВЫБОР
				|		КОГДА ДокументыОснования.ДокументОснование ЕСТЬ NULL
				|			ТОГДА -СведенияОДоходахНДФЛ.СуммаДохода
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК АвансаПогашено,
				|	ВЫБОР
				|		КОГДА ДокументыОснования.ДокументОснование ЕСТЬ NULL
				|			ТОГДА -СведенияОДоходахНДФЛ.СуммаВычета
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК СуммаВычетаПогашено,
				|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
				|	СведенияОДоходахНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
				|	СведенияОДоходахНДФЛ.Начисление КАК Начисление,
				|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
				|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
				|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
				|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
				|	СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса КАК ЗарегистрированоПриНачисленииАванса
				|ПОМЕСТИТЬ ВТПогашениеАвансов
				|ИЗ
				|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДокументыОснования КАК ДокументыОснования
				|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДокументыОснования.ФизическоеЛицо
				|			И СведенияОДоходахНДФЛ.ДокументОснование = ДокументыОснования.ДокументОснование
				|ГДЕ
				|	СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
				|	И СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредшествующегоМесяца И &КонецПериодаРасчета
				|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
				|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&ФизическиеЛицаБезДвиженийТекущегоРегистратора)
				|	И НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса, МЕСЯЦ) = &НачалоМесяцаРасчета
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ПогашениеАвансов.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СУММА(ПогашениеАвансов.АвансаНачислено) КАК СуммаДохода,
				|	СУММА(ПогашениеАвансов.СуммаВычетаНачислено) КАК СуммаВычета,
				|	ПогашениеАвансов.ДатаПолученияДохода КАК ДатаПолученияДохода,
				|	ПогашениеАвансов.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
				|ИЗ
				|	ВТПогашениеАвансов КАК ПогашениеАвансов
				|
				|СГРУППИРОВАТЬ ПО
				|	ПогашениеАвансов.ФизическоеЛицо,
				|	ПогашениеАвансов.ДатаПолученияДохода,
				|	ПогашениеАвансов.МесяцНалоговогоПериода
				|
				|ИМЕЮЩИЕ
				|	СУММА(ПогашениеАвансов.АвансаНачислено) > 0
				|
				|УПОРЯДОЧИТЬ ПО
				|	ФизическоеЛицо
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ПогашениеАвансов.ФизическоеЛицо КАК ФизическоеЛицо,
				|	СУММА(ПогашениеАвансов.АвансаПогашено) КАК СуммаДохода,
				|	СУММА(ПогашениеАвансов.СуммаВычетаПогашено) КАК СуммаВычета,
				|	ПогашениеАвансов.Начисление КАК Начисление,
				|	ПогашениеАвансов.Подразделение КАК Подразделение,
				|	ПогашениеАвансов.КатегорияДохода КАК КатегорияДохода,
				|	ПогашениеАвансов.КодВычета КАК КодВычета,
				|	ПогашениеАвансов.КодДохода КАК КодДохода,
				|	ПогашениеАвансов.ЗарегистрированоПриНачисленииАванса КАК ЗарегистрированоПриНачисленииАванса,
				|	ПогашениеАвансов.ДатаПолученияДохода КАК ДатаПолученияДохода
				|ИЗ
				|	ВТПогашениеАвансов КАК ПогашениеАвансов
				|
				|СГРУППИРОВАТЬ ПО
				|	ПогашениеАвансов.ФизическоеЛицо,
				|	ПогашениеАвансов.Начисление,
				|	ПогашениеАвансов.Подразделение,
				|	ПогашениеАвансов.КатегорияДохода,
				|	ПогашениеАвансов.КодВычета,
				|	ПогашениеАвансов.КодДохода,
				|	ПогашениеАвансов.ЗарегистрированоПриНачисленииАванса,
				|	ПогашениеАвансов.ДатаПолученияДохода
				|
				|ИМЕЮЩИЕ
				|	СУММА(ПогашениеАвансов.АвансаПогашено) > 0
				|
				|УПОРЯДОЧИТЬ ПО
				|	ФизическоеЛицо,
				|	ДатаПолученияДохода";
				Результаты = Запрос.ВыполнитьПакет();
				Если Не Результаты[2].Пустой() И Не Результаты[3].Пустой() Тогда
					Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
						НаборЗаписей = ДоходыТекущегоРегистратора;
					Иначе
						НаборЗаписей = ДвиженияТекущегоРегистратора.СведенияОДоходахНДФЛ;
					КонецЕсли;
					АвансыКЗачету = Результаты[2].Выгрузить();
					ПоляОтбора = "ФизическоеЛицо";
					СтруктураОтбора = Новый Структура(ПоляОтбора);
					Если АвансыКЗачету.Количество() > 100 Тогда
						АвансыКЗачету.Индексы.Добавить(ПоляОтбора);
					КонецЕсли;
					Выборка = Результаты[3].Выбрать();
					ФизическиеЛицаСУточнениями = Новый Соответствие;
					Пока Выборка.Следующий() Цикл
						ЗаполнитьЗначенияСвойств(СтруктураОтбора, Выборка);
						СуммаДоходаВыборки = Выборка.СуммаДохода; СуммаВычетаВыборки = Выборка.СуммаВычета;
						Для каждого СтрокаНачисленногоАванса Из АвансыКЗачету.НайтиСтроки(СтруктураОтбора) Цикл
							Если СтрокаНачисленногоАванса.ДатаПолученияДохода > Выборка.ДатаПолученияДохода Тогда
								Продолжить;
							КонецЕсли;
							Если СтрокаНачисленногоАванса.СуммаДохода = 0 И СтрокаНачисленногоАванса.СуммаВычета = 0 Тогда
								Продолжить;
							КонецЕсли;
							СуммаДоходаКЗачету = Мин(СуммаДоходаВыборки, СтрокаНачисленногоАванса.СуммаДохода);
							СуммаВычетаКЗачету = Мин(СуммаВычетаВыборки, СтрокаНачисленногоАванса.СуммаВычета);
							Если СуммаДоходаКЗачету > 0 Или СуммаВычетаКЗачету > 0 Тогда
								ФизическиеЛицаСУточнениями.Вставить(Выборка.ФизическоеЛицо, Истина);
								НоваяСтрока = НаборЗаписей.Добавить();
								ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка, , "СуммаДохода,СуммаВычета");
								ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаНачисленногоАванса, "МесяцНалоговогоПериода,ДатаПолученияДохода");
								Если СуммаДоходаКЗачету > 0 Тогда
									НоваяСтрока.СуммаДохода = -СуммаДоходаКЗачету;
									СуммаДоходаВыборки = СуммаДоходаВыборки - СуммаДоходаКЗачету;
									СтрокаНачисленногоАванса.СуммаДохода = СтрокаНачисленногоАванса.СуммаДохода - СуммаДоходаКЗачету;					
								КонецЕсли;
								Если СуммаВычетаКЗачету > 0  Тогда
									НоваяСтрока.СуммаВычета = -СуммаВычетаКЗачету;
									СуммаВычетаВыборки = СуммаВычетаВыборки - СуммаВычетаКЗачету;
									СтрокаНачисленногоАванса.СуммаВычета = СтрокаНачисленногоАванса.СуммаВычета - СуммаВычетаКЗачету;					
								КонецЕсли;
							КонецЕсли;
							Если СуммаДоходаВыборки = 0 И СуммаВычетаВыборки = 0 Тогда
								Прервать;
							КонецЕсли;
						КонецЦикла;
					КонецЦикла;
					Для каждого КлючИЗначение Из ФизическиеЛицаСУточнениями Цикл
						ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора.Добавить(КлючИЗначение.Ключ);
						ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора.Удалить(ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора.Найти(КлючИЗначение.Ключ));
					КонецЦикла;
					Если ФизическиеЛицаСУточнениями.Количество() > 0 И Не ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
						ЕстьДвиженияТекущегоРегистратораПоДоходам = Истина;
						ДоходыТекущегоРегистратора = ДвиженияТекущегоРегистратора.СведенияОДоходахНДФЛ.Выгрузить();
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
		Иначе 	
			ФизическиеЛицаБезДвиженийТекущегоРегистратора = ОбщегоНазначения.СкопироватьРекурсивно(СписокФизическихЛиц);
		КонецЕсли;
		
		Запрос.УстановитьПараметр("ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора", ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора);
		Запрос.УстановитьПараметр("ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора", ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора);
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериодаДляПоиска,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	-СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК НалогПоСтавке13,
		|	-СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) КАК НалогСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &ИсключаемыйРегистратор
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода < &ДатаОбъединенияНалоговыхБаз
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&ПоОсновнойСтавке)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода >= &ДатаОбъединенияНалоговыхБаз)
		|	И &УсловиеЧтенияАвансовыхЗаписей
		|
		|СГРУППИРОВАТЬ ПО
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода";
		ТекстСАвансомВДвиженияхТекущегоРегистратора = ?(Не ЗначениеЗаполнено(ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора),
			"", 
			СтрЗаменить(ТекстЗапроса, "И &УсловиеЧтенияАвансовыхЗаписей", "И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо В(&ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора) И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ЗарегистрированоПриНачисленииАванса < &НачалоМесяцаРасчета"));		
		ТекстБезАвансаВДвиженияхТекущегоРегистратора = ?(Не ЗначениеЗаполнено(ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора),
			"", 
			СтрЗаменить(ТекстЗапроса, "И &УсловиеЧтенияАвансовыхЗаписей", "И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо В(&ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора) И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ЗарегистрированоПриНачисленииАванса < &КонецМесяцаРасчета"));

		Запрос.Текст = ТекстСАвансомВДвиженияхТекущегоРегистратора 
			+ ?(ТекстСАвансомВДвиженияхТекущегоРегистратора <> "" И ТекстБезАвансаВДвиженияхТекущегоРегистратора <> "", Символы.ПС + "ОБЪЕДИНИТЬ ВСЕ" + Символы.ПС, "") 
			+ ТекстБезАвансаВДвиженияхТекущегоРегистратора;
		ИсчисленныйРанееНалог = Запрос.Выполнить().Выгрузить();
		
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
		|	СведенияОДоходахНДФЛ.Период КАК Период,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложения КАК СтавкаНалогообложения,
		|	&ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК НалоговыйПериод,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
		|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
		|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
		|	КОНЕЦ КАК ДокументОснование,
		|	ЕСТЬNULL(СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам, ЛОЖЬ) КАК НеПредоставляетсяНерезидентам,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
		|	ИСТИНА КАК ИспользоватьДляРаспределения,
		|	&УчитыватьПериодПриРасчете КАК УчитыватьПериодПриРасчете,
		|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор КАК ДоходТекущегоРасчета
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДокументыУчтенныеПриРасчетеНДФЛ КАК ДокументыУчтенныеПриРасчетеНДФЛ
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДокументыУчтенныеПриРасчетеНДФЛ.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.Регистратор = ДокументыУчтенныеПриРасчетеНДФЛ.ДокументОснование
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
		|	И (СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И (СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаОбъединенияНалоговыхБаз
		|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода В (&ПоОсновнойСтавке)
		|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода >= &ДатаОбъединенияНалоговыхБаз)
		|	И &УсловиеЧтенияАвансовыхЗаписей
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
		|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД),
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.Подразделение,
		|	СведенияОДоходахНДФЛ.Период,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложения,
		|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
		|	СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам,
		|	СведенияОДоходахНДФЛ.КодВычета,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
		|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
		|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
		|	КОНЕЦ
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)";
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
		Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", 
			"ВЫБОР
			|		КОГДА СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
			|			ТОГДА ЛОЖЬ
			|		ИНАЧЕ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
			|	КОНЕЦ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", "СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета");
		Иначе // перерасчет за период	
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.Период КАК Период", "&НачалоГодаРасчета КАК Период");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.Период,", "");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДоходМежрасчетногоПериода", "ЛОЖЬ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода", "ЛОЖЬ");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УчитыватьПериодПриРасчете", "Истина");
		КонецЕсли;
		
		ТекстСАвансомВДвиженияхТекущегоРегистратора = ?(Не ЗначениеЗаполнено(ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора),
			"", 
			СтрЗаменить(ТекстЗапроса, "И &УсловиеЧтенияАвансовыхЗаписей", "И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&ФизическиеЛицаСАвансомВДвиженияхТекущегоРегистратора) И СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса < &НачалоМесяцаРасчета"));		
		ТекстБезАвансаВДвиженияхТекущегоРегистратора = ?(Не ЗначениеЗаполнено(ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора),
			"", 
			СтрЗаменить(ТекстЗапроса, "И &УсловиеЧтенияАвансовыхЗаписей","И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&ФизическиеЛицаБезАвансаВДвиженияхТекущегоРегистратора) И СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса < &КонецМесяцаРасчета"));

		Запрос.Текст = ТекстСАвансомВДвиженияхТекущегоРегистратора 
			+ ?(ТекстСАвансомВДвиженияхТекущегоРегистратора <> "" И ТекстБезАвансаВДвиженияхТекущегоРегистратора <> "", Символы.ПС + "ОБЪЕДИНИТЬ ВСЕ" + Символы.ПС, "") 
			+ ТекстБезАвансаВДвиженияхТекущегоРегистратора;
			
		КатегорииОплатыТруда = ОбщегоНазначенияБЗККлиентСервер.МассивВСоответствие(Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда());	
		ДанныеУчетаДоходов = Запрос.Выполнить().Выгрузить();
		ДатыПредыдущейОплатыТруда = Новый Соответствие;
		Если ФизическиеЛицаБезДвиженийТекущегоРегистратора.Количество() > 0 И ДанныеУчетаДоходов.Количество() > 0 Тогда
			ДанныеУчетаДоходов.Сортировать("ФизическоеЛицо, КатегорияДохода, ДатаПолученияДохода Убыв", Новый СравнениеЗначений);
			ТекущееФизическоеЛицо = Неопределено;
			Для Каждого ТекущаяСтрока Из ДанныеУчетаДоходов Цикл
				Если КатегорииОплатыТруда[ТекущаяСтрока.КатегорияДохода] <> Неопределено И ТекущееФизическоеЛицо <> ТекущаяСтрока.ФизическоеЛицо Тогда
					ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо;
					Если ФизическиеЛицаБезДвиженийТекущегоРегистратора.Найти(ТекущаяСтрока.ФизическоеЛицо) <> Неопределено Тогда
						ДатыПредыдущейОплатыТруда.Вставить(ТекущаяСтрока.ФизическоеЛицо, ТекущаяСтрока.ДатаПолученияДохода);
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;	
		КонецЕсли;
		
		
		// Для тех, у кого на момент расчета авансы зачтены не полностью, необходимо осмотреть имеющиеся в ИБ более ранние зачеты авансов 
		// с целью восстановить реальные даты выплаты аванса.
		Если ЗначениеЗаполнено(ФизическиеЛицаДляЧтенияДополнительныхАвансов) Тогда
			
			ТекстЗапроса = 
			"ВЫБРАТЬ
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
			|	СведенияОДоходахНДФЛ.Период КАК Период,
			|	СведенияОДоходахНДФЛ.СтавкаНалогообложения КАК СтавкаНалогообложения,
			|	ЛОЖЬ КАК ДоходМежрасчетногоПериода,
			|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
			|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
			|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
			|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК НалоговыйПериод,
			|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
			|	СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование,
			|	ЕСТЬNULL(СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам, ЛОЖЬ) КАК НеПредоставляетсяНерезидентам,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
			|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
			|	ИСТИНА КАК ИспользоватьДляРаспределения,
			|	ИСТИНА КАК УчитыватьПериодПриРасчете,
			|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор КАК ДоходТекущегоРасчета,
			|	СведенияОДоходахНДФЛ.УстаревшаяДатаПолученияДохода КАК УстаревшаяДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор
			|ПОМЕСТИТЬ ВТСтрокиАвансов
			|ИЗ
			|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
			|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДокументыУчтенныеПриРасчетеНДФЛ КАК ДокументыУчтенныеПриРасчетеНДФЛ
			|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДокументыУчтенныеПриРасчетеНДФЛ.ФизическоеЛицо
			|			И СведенияОДоходахНДФЛ.Регистратор = ДокументыУчтенныеПриРасчетеНДФЛ.ДокументОснование
			|ГДЕ
			|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоМесяцаРасчета И &ДатаОкончанияЧтенияДоходовНалоговОкончательногоРасчета
			|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
			|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
			|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
			|	И (СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
			|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
			|	И &УсловиеОблагаемостиУНалоговогоАгента
			|	И (СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
			|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаОбъединенияНалоговыхБаз
			|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода В (&ПоОсновнойСтавке)
			|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода >= &ДатаОбъединенияНалоговыхБаз)
			|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&ФизическиеЛицаДляЧтенияДополнительныхАвансов)
			|	И СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса = &НачалоМесяцаРасчета
			|
			|СГРУППИРОВАТЬ ПО
			|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ),
			|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД),
			|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Подразделение,
			|	СведенияОДоходахНДФЛ.Период,
			|	СведенияОДоходахНДФЛ.СтавкаНалогообложения,
			|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
			|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
			|	СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам,
			|	СведенияОДоходахНДФЛ.КодВычета,
			|	СведенияОДоходахНДФЛ.КодДохода,
			|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
			|	СведенияОДоходахНДФЛ.КатегорияДохода,
			|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор,
			|	СведенияОДоходахНДФЛ.ДокументОснование,
			|	СведенияОДоходахНДФЛ.УстаревшаяДатаПолученияДохода,
			|	СведенияОДоходахНДФЛ.Регистратор
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СтрокиАвансов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СтрокиАвансов.ДокументОснование КАК ДокументОснование
			|ПОМЕСТИТЬ ВТОснованияАвансов
			|ИЗ
			|	ВТСтрокиАвансов КАК СтрокиАвансов
			|ГДЕ
			|	СтрокиАвансов.УстаревшаяДатаПолученияДохода <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СтрокиАвансов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СтрокиАвансов.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	СУММА(СтрокиАвансов.СуммаДохода) КАК СуммаДохода,
			|	СУММА(СтрокиАвансов.СуммаВычета) КАК СуммаВычета,
			|	СтрокиАвансов.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
			|ИЗ
			|	ВТСтрокиАвансов КАК СтрокиАвансов
			|ГДЕ
			|	СтрокиАвансов.УстаревшаяДатаПолученияДохода <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			|
			|СГРУППИРОВАТЬ ПО
			|	СтрокиАвансов.ФизическоеЛицо,
			|	СтрокиАвансов.ДатаПолученияДохода,
			|	СтрокиАвансов.МесяцНалоговогоПериода
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СтрокиАвансов.ФизическоеЛицо КАК ФизическоеЛицо,
			|	СтрокиАвансов.ДатаПолученияДохода КАК ДатаПолученияДохода,
			|	СтрокиАвансов.Подразделение КАК Подразделение,
			|	СтрокиАвансов.Период КАК Период,
			|	СтрокиАвансов.СтавкаНалогообложения КАК СтавкаНалогообложения,
			|	СтрокиАвансов.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
			|	СтрокиАвансов.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
			|	СтрокиАвансов.КодВычета КАК КодВычета,
			|	СтрокиАвансов.КодДохода КАК КодДохода,
			|	СтрокиАвансов.КатегорияДохода КАК КатегорияДохода,
			|	СтрокиАвансов.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
			|	СтрокиАвансов.НалоговыйПериод КАК НалоговыйПериод,
			|	СтрокиАвансов.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
			|	ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка) КАК ДокументОснование,
			|	СтрокиАвансов.НеПредоставляетсяНерезидентам КАК НеПредоставляетсяНерезидентам,
			|	-СтрокиАвансов.СуммаДохода КАК СуммаДохода,
			|	-СтрокиАвансов.СуммаВычета КАК СуммаВычета,
			|	СтрокиАвансов.ИспользоватьДляРаспределения КАК ИспользоватьДляРаспределения,
			|	СтрокиАвансов.УчитыватьПериодПриРасчете КАК УчитыватьПериодПриРасчете,
			|	СтрокиАвансов.ДоходТекущегоРасчета КАК ДоходТекущегоРасчета,
			|	СтрокиАвансов.УстаревшаяДатаПолученияДохода КАК УстаревшаяДатаПолученияДохода,
			|	СтрокиАвансов.Регистратор КАК Регистратор
			|ИЗ
			|	ВТСтрокиАвансов КАК СтрокиАвансов
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОснованияАвансов КАК ОснованияАвансов
			|		ПО СтрокиАвансов.ФизическоеЛицо = ОснованияАвансов.ФизическоеЛицо
			|			И СтрокиАвансов.ДокументОснование = ОснованияАвансов.ДокументОснование
			|ГДЕ
			|	СтрокиАвансов.ДокументОснование = СтрокиАвансов.Регистратор
			|	И ОснованияАвансов.ДокументОснование ЕСТЬ NULL
			|
			|УПОРЯДОЧИТЬ ПО
			|	ФизическоеЛицо,
			|	Период";
			Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());
			Запрос.УстановитьПараметр("ФизическиеЛицаДляЧтенияДополнительныхАвансов", ФизическиеЛицаДляЧтенияДополнительныхАвансов);
			Результаты = Запрос.ВыполнитьПакет();
			Если Не Результаты[3].Пустой() Тогда // есть сотрудники с зачетами авансов в ИБ
				ДатыПолученияДохода = Результаты[2].Выгрузить();
				СтруктураПоиска = Новый Структура("ФизическоеЛицо");
				Если ДатыПолученияДохода.Количество() > 100 Тогда
					ДатыПолученияДохода.Индексы.Добавить("ФизическоеЛицо");
				КонецЕсли;
				Выборка = Результаты[3].Выбрать();
				Пока Выборка.Следующий() Цикл
					СуммаДоходаВыборки = Выборка.СуммаДохода; СуммаВычетаВыборки = Выборка.СуммаВычета;
					СтруктураПоиска.ФизическоеЛицо = Выборка.ФизическоеЛицо;
					СтрокиПравильныхДат = ДатыПолученияДохода.НайтиСтроки(СтруктураПоиска);
					Для каждого СтрокаНачисленногоАванса Из СтрокиПравильныхДат Цикл
						Если СтрокаНачисленногоАванса.СуммаДохода = 0 Тогда
							Продолжить;
						КонецЕсли;
						СуммаДоходаКЗачету = Мин(СуммаДоходаВыборки, СтрокаНачисленногоАванса.СуммаДохода);
						СуммаВычетаКЗачету = Мин(СуммаВычетаВыборки, СтрокаНачисленногоАванса.СуммаВычета);
						Если СуммаДоходаКЗачету > 0 Или СуммаВычетаКЗачету > 0 Тогда
							НоваяСтрока = ДанныеУчетаДоходов.Добавить();
							ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка, , "СуммаДохода,СуммаВычета");
							Если СуммаДоходаКЗачету > 0 Тогда
								НоваяСтрока.СуммаДохода = -СуммаДоходаКЗачету;
								СуммаДоходаВыборки = СуммаДоходаВыборки - СуммаДоходаКЗачету;
								СтрокаНачисленногоАванса.СуммаДохода = СтрокаНачисленногоАванса.СуммаДохода - СуммаДоходаКЗачету;					
							Иначе	
								НоваяСтрока.СуммаДохода = 0;
							КонецЕсли;
							Если СуммаВычетаКЗачету > 0  Тогда
								НоваяСтрока.СуммаВычета = -СуммаВычетаКЗачету;
								СуммаВычетаВыборки = СуммаВычетаВыборки - СуммаВычетаКЗачету;
								СтрокаНачисленногоАванса.СуммаВычета = СтрокаНачисленногоАванса.СуммаВычета - СуммаВычетаКЗачету;					
							Иначе	
								НоваяСтрока.СуммаВычета = 0;
							КонецЕсли;
							НоваяСтрока = ДанныеУчетаДоходов.Добавить();
							ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка, , "СуммаДохода,СуммаВычета");
							ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаНачисленногоАванса, "МесяцНалоговогоПериода,ДатаПолученияДохода");
							Если СуммаДоходаКЗачету > 0 Тогда
								НоваяСтрока.СуммаДохода = СуммаДоходаКЗачету;
							Иначе	
								НоваяСтрока.СуммаДохода = 0;
							КонецЕсли;
							Если СуммаВычетаКЗачету > 0  Тогда
								НоваяСтрока.СуммаВычета = СуммаВычетаКЗачету;
							Иначе	
								НоваяСтрока.СуммаВычета = 0;
							КонецЕсли;
						КонецЕсли;
						Если СуммаДоходаВыборки = 0 И СуммаВычетаВыборки = 0 Тогда
							Прервать;
						КонецЕсли;
					КонецЦикла;
				КонецЦикла;
			КонецЕсли;
		КонецЕсли;
		
	Иначе
		
		// В межрасчетном варианте соберем перечень физлиц, для которых ранее производился окончательный расчет за месяц текущего расчета, 
		// который соответствует ДатаУдержанияИсчисленногоНалога; для них при расчете имитируем поведение окончательного расчета,  
		// учитывая имеющиеся в учете данные до ДатаУдержанияИсчисленногоНалога
		// (в форме временной таблицы для использования в запросах сбора данных и в форме соответствия для алгоритма расчета)
	
		Запрос.УстановитьПараметр("ДатаПолученияМежрасчетногоДохода", ДатаУдержанияИсчисленногоНалога);
		Запрос.УстановитьПараметр("НачалоМесяцаПолученияМежрасчетногоДохода", НачалоМесяца(ДатаУдержанияИсчисленногоНалога));
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериодаДляПоиска,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	-РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК НалогПоСтавке13,
		|	-РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК НалогСПревышения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК Период,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ЗарегистрированоПриНачисленииАванса КАК ЗарегистрированоПриНачисленииАванса,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РасчетМежрасчетногоПериода КАК РасчетМежрасчетногоПериода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование
		|ПОМЕСТИТЬ ВТСтрокиИсчисленногоНалога
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &ИсключаемыйРегистратор
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода < &ДатаОбъединенияНалоговыхБаз
		|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода В (&ПоОсновнойСтавке)
		|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода >= &ДатаОбъединенияНалоговыхБаз)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
		|	СведенияОДоходахНДФЛ.Период КАК Период,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложения КАК СтавкаНалогообложения,
		|	СведенияОДоходахНДФЛ.Период >= &НачалоМесяцаРасчета
		|		И СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(СведенияОДоходахНДФЛ.МесяцНалоговогоПериода, ГОД) КАК НалоговыйПериод,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.ДокументОснование КАК ДокументОснование,
		|	ЕСТЬNULL(СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам, ЛОЖЬ) КАК НеПредоставляетсяНерезидентам,
		|	СведенияОДоходахНДФЛ.СуммаДохода КАК СуммаДохода,
		|	СведенияОДоходахНДФЛ.СуммаВычета КАК СуммаВычета,
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоГодаРасчета И &КонецМесяцаРасчета КАК УчитыватьПериодПриРасчете,
		|	СведенияОДоходахНДФЛ.Регистратор КАК Регистратор,
		|	СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса КАК ЗарегистрированоПриНачисленииАванса
		|ПОМЕСТИТЬ ВТСтрокиДоходов
		|ИЗ
		|	РегистрНакопления.СведенияОДоходахНДФЛ КАК СведенияОДоходахНДФЛ
		|ГДЕ
		|	СведенияОДоходахНДФЛ.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
		|	И СведенияОДоходахНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И СведенияОДоходахНДФЛ.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И СведенияОДоходахНДФЛ.Регистратор <> &ИсключаемыйРегистратор
		|	И СведенияОДоходахНДФЛ.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
		|	И (СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
		|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды))
		|	И &УсловиеОблагаемостиУНалоговогоАгента
		|	И (СведенияОДоходахНДФЛ.КатегорияДохода В (&ОсновнаяНалоговаяБаза)
		|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода < &ДатаОбъединенияНалоговыхБаз
		|			ИЛИ СведенияОДоходахНДФЛ.КатегорияДохода В (&ПоОсновнойСтавке)
		|				И СведенияОДоходахНДФЛ.ДатаПолученияДохода >= &ДатаОбъединенияНалоговыхБаз)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СтрокиИсчисленногоНалога.Регистратор КАК Регистратор,
		|	СтрокиИсчисленногоНалога.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТРегистраторыОкончательногоРасчета
		|ИЗ
		|	ВТСтрокиИсчисленногоНалога КАК СтрокиИсчисленногоНалога
		|ГДЕ
		|	НЕ СтрокиИсчисленногоНалога.РасчетМежрасчетногоПериода
		|	И СтрокиИсчисленногоНалога.ЗарегистрированоПриНачисленииАванса = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПредоставленныеСтандартныеИСоциальныеВычеты.Регистратор,
		|	ПредоставленныеСтандартныеИСоциальныеВычеты.ФизическоеЛицо
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ПредоставленныеСтандартныеИСоциальныеВычеты
		|ГДЕ
		|	ПредоставленныеСтандартныеИСоциальныеВычеты.Регистратор <> &ИсключаемыйРегистратор
		|	И ПредоставленныеСтандартныеИСоциальныеВычеты.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
		|	И ПредоставленныеСтандартныеИСоциальныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И НАЧАЛОПЕРИОДА(ПредоставленныеСтандартныеИСоциальныеВычеты.МесяцНалоговогоПериода, МЕСЯЦ) = &НачалоМесяцаПолученияМежрасчетногоДохода
		|	И ПредоставленныеСтандартныеИСоциальныеВычеты.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И НЕ ПредоставленныеСтандартныеИСоциальныеВычеты.ВычетМежрасчетногоПериода
		|	И ПредоставленныеСтандартныеИСоциальныеВычеты.ЗарегистрированоПриНачисленииАванса = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ИмущественныеВычеты.Регистратор,
		|	ИмущественныеВычеты.ФизическоеЛицо
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычеты
		|ГДЕ
		|	ИмущественныеВычеты.Регистратор <> &ИсключаемыйРегистратор
		|	И НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ) = &НачалоМесяцаПолученияМежрасчетногоДохода
		|	И ИмущественныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычеты.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И НЕ ИмущественныеВычеты.ВычетМежрасчетногоПериода
		|	И ИмущественныеВычеты.ЗарегистрированоПриНачисленииАванса = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|	И ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СтрокиДоходов.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СтрокиДоходов.ДокументОснование КАК ДокументОснование
		|ПОМЕСТИТЬ ВТФизическиеЛицаСОкончательнымРасчетомИДокументами
		|ИЗ
		|	ВТСтрокиДоходов КАК СтрокиДоходов
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРегистраторыОкончательногоРасчета КАК РегистраторыОкончательногоРасчета
		|		ПО СтрокиДоходов.ДокументОснование = РегистраторыОкончательногоРасчета.Регистратор
		|			И СтрокиДоходов.ФизическоеЛицо = РегистраторыОкончательногоРасчета.ФизическоеЛицо
		|ГДЕ
		|	СтрокиДоходов.ДатаПолученияДохода МЕЖДУ &НачалоМесяцаПолученияМежрасчетногоДохода И &ДатаПолученияМежрасчетногоДохода
		|	И РегистраторыОкончательногоРасчета.Регистратор ЕСТЬ НЕ NULL 
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СтрокиИсчисленногоНалога.ФизическоеЛицо,
		|	СтрокиИсчисленногоНалога.ДокументОснование
		|ИЗ
		|	ВТСтрокиИсчисленногоНалога КАК СтрокиИсчисленногоНалога
		|ГДЕ
		|	НЕ СтрокиИсчисленногоНалога.РасчетМежрасчетногоПериода
		|	И СтрокиИсчисленногоНалога.ЗарегистрированоПриНачисленииАванса = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|	И СтрокиИсчисленногоНалога.МесяцНалоговогоПериода МЕЖДУ &НачалоМесяцаПолученияМежрасчетногоДохода И &ДатаПолученияМежрасчетногоДохода
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ФизическоеЛицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТФизическиеЛицаСОкончательнымРасчетом
		|ИЗ
		|	ВТФизическиеЛицаСОкончательнымРасчетомИДокументами КАК ФизическиеЛицаСОкончательнымРасчетом
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РегистраторыОкончательногоРасчета.Регистратор КАК ДокументОснование,
		|	РегистраторыОкончательногоРасчета.ФизическоеЛицо КАК ФизическоеЛицо
		|ПОМЕСТИТЬ ВТИсключаемыеСтрокиОкончательногоРасчета
		|ИЗ
		|	ВТРегистраторыОкончательногоРасчета КАК РегистраторыОкончательногоРасчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСОкончательнымРасчетомИДокументами КАК ФизическиеЛицаСОкончательнымРасчетом
		|		ПО РегистраторыОкончательногоРасчета.Регистратор = ФизическиеЛицаСОкончательнымРасчетом.ДокументОснование
		|			И РегистраторыОкончательногоРасчета.ФизическоеЛицо = ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо
		|ГДЕ
		|	ФизическиеЛицаСОкончательнымРасчетом.ДокументОснование ЕСТЬ NULL
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТФизическиеЛицаСОкончательнымРасчетом КАК ФизическиеЛицаСОкончательнымРасчетом";
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеОблагаемостиУНалоговогоАгента", УчетНДФЛ.УсловиеОблагаемостиУНалоговогоАгента());

		ФизическиеЛицаСОкончательнымРасчетом = Запрос.Выполнить().Выгрузить();
		Для Каждого СтрокаРезультата Из ФизическиеЛицаСОкончательнымРасчетом Цикл
			СоответствиеФизическихЛиц.Вставить(СтрокаРезультата.ФизическоеЛицо, Истина)
		КонецЦикла;
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	СтрокиИсчисленногоНалога.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СтрокиИсчисленногоНалога.МесяцНалоговогоПериодаДляПоиска КАК МесяцНалоговогоПериодаДляПоиска,
		|	СтрокиИсчисленногоНалога.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	СтрокиИсчисленногоНалога.Подразделение КАК Подразделение,
		|	СтрокиИсчисленногоНалога.КатегорияДохода КАК КатегорияДохода,
		|	СУММА(СтрокиИсчисленногоНалога.НалогПоСтавке13) КАК НалогПоСтавке13,
		|	СУММА(СтрокиИсчисленногоНалога.НалогСПревышения) КАК НалогСПревышения
		|ИЗ
		|	ВТСтрокиИсчисленногоНалога КАК СтрокиИсчисленногоНалога
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСОкончательнымРасчетом КАК ФизическиеЛицаСОкончательнымРасчетом
		|		ПО СтрокиИсчисленногоНалога.ФизическоеЛицо = ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТИсключаемыеСтрокиОкончательногоРасчета КАК ИсключаемыеСтрокиОкончательногоРасчета
		|		ПО СтрокиИсчисленногоНалога.ФизическоеЛицо = ИсключаемыеСтрокиОкончательногоРасчета.ФизическоеЛицо
		|			И СтрокиИсчисленногоНалога.ДокументОснование = ИсключаемыеСтрокиОкончательногоРасчета.ДокументОснование
		|ГДЕ
		|	(СтрокиИсчисленногоНалога.Период < &НачалоМесяцаРасчета
		|			ИЛИ СтрокиИсчисленногоНалога.МесяцНалоговогоПериода <= &ДатаПолученияМежрасчетногоДохода
		|				И ИсключаемыеСтрокиОкончательногоРасчета.ФизическоеЛицо ЕСТЬ NULL
		|				И (ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|					ИЛИ СтрокиИсчисленногоНалога.РасчетМежрасчетногоПериода
		|					ИЛИ СтрокиИсчисленногоНалога.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)))
		|
		|СГРУППИРОВАТЬ ПО
		|	СтрокиИсчисленногоНалога.ФизическоеЛицо,
		|	СтрокиИсчисленногоНалога.МесяцНалоговогоПериодаДляПоиска,
		|	СтрокиИсчисленногоНалога.МесяцНалоговогоПериода,
		|	СтрокиИсчисленногоНалога.Подразделение,
		|	СтрокиИсчисленногоНалога.КатегорияДохода";
		ИсчисленныйРанееНалог = Запрос.Выполнить().Выгрузить();
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода КАК ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.Подразделение КАК Подразделение,
		|	СведенияОДоходахНДФЛ.Период КАК Период,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложения КАК СтавкаНалогообложения,
		|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода КАК ДоходМежрасчетногоПериода,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ КАК ИсточникДоходаЗаПределамиРФ,
		|	СведенияОДоходахНДФЛ.КодВычета КАК КодВычета,
		|	СведенияОДоходахНДФЛ.КодДохода КАК КодДохода,
		|	СведенияОДоходахНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	СведенияОДоходахНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	СведенияОДоходахНДФЛ.НалоговыйПериод КАК НалоговыйПериод,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
		|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
		|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
		|	КОНЕЦ КАК ДокументОснование,
		|	СведенияОДоходахНДФЛ.НеПредоставляетсяНерезидентам КАК НеПредоставляетсяНерезидентам,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаДохода) КАК СуммаДохода,
		|	СУММА(СведенияОДоходахНДФЛ.СуммаВычета) КАК СуммаВычета,
		|	ИСТИНА КАК ИспользоватьДляРаспределения,
		|	СведенияОДоходахНДФЛ.УчитыватьПериодПриРасчете КАК УчитыватьПериодПриРасчете,
		|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор КАК ДоходТекущегоРасчета
		|ИЗ
		|	ВТСтрокиДоходов КАК СведенияОДоходахНДФЛ
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСОкончательнымРасчетом КАК ФизическиеЛицаСОкончательнымРасчетом
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДокументыУчтенныеПриРасчетеНДФЛ КАК ДокументыУчтенныеПриРасчетеНДФЛ
		|		ПО СведенияОДоходахНДФЛ.ФизическоеЛицо = ДокументыУчтенныеПриРасчетеНДФЛ.ФизическоеЛицо
		|			И СведенияОДоходахНДФЛ.Регистратор = ДокументыУчтенныеПриРасчетеНДФЛ.ДокументОснование
		|ГДЕ
		|	(СведенияОДоходахНДФЛ.Период < &НачалоМесяцаРасчета
		|			ИЛИ СведенияОДоходахНДФЛ.ДатаПолученияДохода <= &ДатаПолученияМежрасчетногоДохода
		|				И (ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|					ИЛИ СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода
		|					ИЛИ СведенияОДоходахНДФЛ.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)))
		|
		|СГРУППИРОВАТЬ ПО
		|	СведенияОДоходахНДФЛ.ФизическоеЛицо,
		|	СведенияОДоходахНДФЛ.ДатаПолученияДохода,
		|	СведенияОДоходахНДФЛ.МесяцНалоговогоПериода,
		|	СведенияОДоходахНДФЛ.НалоговыйПериод,
		|	СведенияОДоходахНДФЛ.Подразделение,
		|	СведенияОДоходахНДФЛ.Период,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложения,
		|	СведенияОДоходахНДФЛ.ДоходМежрасчетногоПериода,
		|	СведенияОДоходахНДФЛ.ИсточникДоходаЗаПределамиРФ,
		|	СведенияОДоходахНДФЛ.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.КодВычета.НеПредоставляетсяНерезидентам,
		|	СведенияОДоходахНДФЛ.НеПредоставляетсяНерезидентам,
		|	СведенияОДоходахНДФЛ.КодВычета,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
		|			ТОГДА СведенияОДоходахНДФЛ.Регистратор
		|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НачислениеЗарплаты.ПустаяСсылка)
		|	КОНЕЦ,
		|	СведенияОДоходахНДФЛ.КодДохода,
		|	СведенияОДоходахНДФЛ.КодДохода.СтавкаНалогообложенияРезидента,
		|	СведенияОДоходахНДФЛ.КатегорияДохода,
		|	СведенияОДоходахНДФЛ.УчитыватьПериодПриРасчете,
		|	ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.Регистратор, &ИсключаемыйРегистратор) = &ИсключаемыйРегистратор
		|
		|ИМЕЮЩИЕ
		|	(СУММА(СведенияОДоходахНДФЛ.СуммаДохода) <> 0
		|		ИЛИ СУММА(СведенияОДоходахНДФЛ.СуммаВычета) <> 0)";
		ДанныеУчетаДоходов = Запрос.Выполнить().Выгрузить();
		
	КонецЕсли;
	
	ЕстьНовыеЗаписи = Ложь;
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "РасчетыНалогоплательщиковСБюджетомПоНДФЛ") Тогда
		Для Каждого СтрокаНалогаТекущегоРегистратора Из ДвиженияТекущегоРегистратора.РасчетыНалогоплательщиковСБюджетомПоНДФЛ Цикл
			
			Если ОкончательныйРасчет И ЗначениеЗаполнено(СтрокаНалогаТекущегоРегистратора.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;
			КонецЕсли;
			Если СоответствиеФизическихЛиц[СтрокаНалогаТекущегоРегистратора.ФизическоеЛицо] = Неопределено 
				Или СтрокаНалогаТекущегоРегистратора.ВидДвижения = ВидДвиженияНакопления.Расход 
				Или (СтрокаНалогаТекущегоРегистратора.СтавкаНалогообложенияРезидента <> Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка13 И СтрокаНалогаТекущегоРегистратора.КатегорияДохода <> Перечисления.КатегорииДоходовНДФЛ.Дивиденды) Тогда
				Продолжить;	
			КонецЕсли;			
				 
			НоваяСтрока = ИсчисленныйРанееНалог.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаНалогаТекущегоРегистратора);	
			НоваяСтрока.МесяцНалоговогоПериодаДляПоиска = НачалоМесяца(СтрокаНалогаТекущегоРегистратора.МесяцНалоговогоПериода);
			НоваяСтрока.НалогПоСтавке13 = -СтрокаНалогаТекущегоРегистратора.Сумма;
			НоваяСтрока.НалогСПревышения = -СтрокаНалогаТекущегоРегистратора.СуммаСПревышения;
			ЕстьНовыеЗаписи = Истина;
		КонецЦикла;	
	КонецЕсли;	
	Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
		ИсчисленныйРанееНалог.Свернуть("Подразделение, ФизическоеЛицо, МесяцНалоговогоПериода, МесяцНалоговогоПериодаДляПоиска, КатегорияДохода", "НалогПоСтавке13, НалогСПревышения");	
	КонецЕсли;	
	ИсчисленныйРанееНалог.Индексы.Добавить("ФизическоеЛицо, МесяцНалоговогоПериодаДляПоиска"); 
	
	Если ЕстьДвиженияТекущегоРегистратораПоДоходам Тогда
		ДоходыТекущегоРегистратора.Свернуть("ГоловнаяОрганизация,ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, Подразделение, Период, СтавкаНалогообложения, ДоходМежрасчетногоПериода, ИсточникДоходаЗаПределамиРФ, КодВычета, КодДохода, КатегорияДохода, Сторно, ЗарегистрированоПриНачисленииАванса, ДокументОснование", "СуммаДохода, СуммаВычета");
		СтавкаРезидента13 = Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка13;
		НеДобавлятьДанныеАвансов = Не УчетНДФЛ.ДоходыУчитываютсяТолькоПоДатеВыплаты(МесяцРасчета, -1);
		Для Каждого ТекущаяСтрока Из ДоходыТекущегоРегистратора Цикл
			Если ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
				Если НеДобавлятьДанныеАвансов Тогда
					Продолжить;
				КонецЕсли;
				Если ТекущаяСтрока.МесяцНалоговогоПериода < НачалоМесяцаРасчета Тогда
					// пропускаем движения авансов прошлых месяцев
					Продолжить;
				КонецЕсли;
				Если ЗначениеЗаполнено(ТекущаяСтрока.ДокументОснование) И ТекущаяСтрока.ДокументОснование <> ИсключаемыйРегистратор Тогда
					// пропускаем движения списания невыплаченных авансов текущего месяца
					Продолжить;
				КонецЕсли;
			КонецЕсли;
			Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] <> Неопределено
				И (ТекущаяСтрока.КодДохода.СтавкаНалогообложенияРезидента = СтавкаРезидента13 Или ТекущаяСтрока.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.Дивиденды)
				И УчетНДФЛ.ДоходОблагаетсяУНалоговогоАгента(ТекущаяСтрока.КодДохода, ТекущаяСтрока.ДатаПолученияДохода) 
				И ТекущаяСтрока.МесяцНалоговогоПериода <= ПоследнийМесяцНалоговогоПериода 
				И (ТекущаяСтрока.МесяцНалоговогоПериода >= ПервыйМесяцТекущегоАлгоритма Или (ДатаУдержанияИсчисленногоНалога >= ПервыйМесяцТекущегоАлгоритма И ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса))) Тогда
				
				НоваяСтрока = ДанныеУчетаДоходов.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
				НоваяСтрока.ДокументОснование = ИсключаемыйРегистратор;
				НоваяСтрока.НеПредоставляетсяНерезидентам = Ложь;
				Если ЗначениеЗаполнено(ТекущаяСтрока.КодВычета) Тогда
					НоваяСтрока.НеПредоставляетсяНерезидентам = ТекущаяСтрока.КодВычета.НеПредоставляетсяНерезидентам;
				КонецЕсли;
				НоваяСтрока.СтавкаНалогообложенияРезидента = СтавкаРезидента13;
				НоваяСтрока.НалоговыйПериод = НачалоГода(НоваяСтрока.МесяцНалоговогоПериода);
				НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(НоваяСтрока.МесяцНалоговогоПериода);
				НоваяСтрока.УчитыватьПериодПриРасчете = (ОкончательныйРасчет И ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса)) Или ТекущаяСтрока.Период >= НачалоГодаРасчета И ТекущаяСтрока.Период <= КонецМесяцаРасчета;	
				НоваяСтрока.ДоходТекущегоРасчета = Не ТекущаяСтрока.Сторно;	
				НоваяСтрока.ИспользоватьДляРаспределения = Истина;
				Если ОкончательныйРасчет Тогда
					НоваяСтрока.ДоходМежрасчетногоПериода = Ложь
				КонецЕсли;
				
				Если ОкончательныйРасчет И ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
					// Зачтем выплаченное в аванс в счет начисленного в окончательном расчете с сохранением фактической даты получения дохода по выплаченному авансу.
					Если ТекущаяСтрока.МесяцНалоговогоПериода < ПервыйМесяцТекущегоАлгоритма Тогда
						НоваяСтрока.ДатаПолученияДохода = ДатаУдержанияИсчисленногоНалога;
						НоваяСтрока.НалоговыйПериод = НачалоГода(НоваяСтрока.ДатаПолученияДохода);
						НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(НоваяСтрока.ДатаПолученияДохода);
					Иначе
						ДатаПолученияДоходаКомпенсационнойСтроки = ДатаУдержанияИсчисленногоНалога;
						МаксимальнаяДатаДоходов = ДатыПредыдущейОплатыТруда[ТекущаяСтрока.ФизическоеЛицо]; 
						Если МаксимальнаяДатаДоходов <> Неопределено Тогда
							Если НачалоМесяца(МаксимальнаяДатаДоходов) = НачалоМесяцаРасчета Тогда
								ДатаПолученияДоходаКомпенсационнойСтроки = МаксимальнаяДатаДоходов	
							КонецЕсли;
						КонецЕсли;
						Если ДатаПолученияДоходаКомпенсационнойСтроки <= ПоследнийМесяцНалоговогоПериода Тогда
							ВтораяСтрока = ДанныеУчетаДоходов.Добавить();
							ЗаполнитьЗначенияСвойств(ВтораяСтрока, НоваяСтрока);
							ВтораяСтрока.ДатаПолученияДохода = ДатаПолученияДоходаКомпенсационнойСтроки;
							ВтораяСтрока.НалоговыйПериод = НачалоГода(ВтораяСтрока.ДатаПолученияДохода);
							ВтораяСтрока.МесяцНалоговогоПериода = НачалоМесяца(ВтораяСтрока.ДатаПолученияДохода);
						КонецЕсли;
						НоваяСтрока.СуммаДохода = -НоваяСтрока.СуммаДохода;
						НоваяСтрока.СуммаВычета = -НоваяСтрока.СуммаВычета;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;			
		КонецЦикла;	
	КонецЕсли;	
	НеучтенныеРанееОснования = ДанныеУчетаДоходов.Скопировать(Новый Структура("ДоходТекущегоРасчета", Истина), "ФизическоеЛицо, ДокументОснование");
	НеучтенныеРанееОснования.Свернуть("ФизическоеЛицо, ДокументОснование");
	НеучтенныеРанееОснования.Индексы.Добавить("ФизическоеЛицо");
	ДанныеУчетаДоходов.Сортировать("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода", Новый СравнениеЗначений);
	
	// 4.	Определим минимальные и максимальные месяцы налогового периода по физическим лицам. Результат работы метода - таблица значений (ПериодыРасчетаПоФизическимЛицам)
	ПериодыРасчетаПоФизическимЛицам = Новый ТаблицаЗначений;
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("НачалоГодаНалоговогоПериода", Новый ОписаниеТипов("Дата"));
	ПериодыРасчетаПоФизическимЛицам.Колонки.Добавить("ПоследнийМесяцНалоговогоПериода", Новый ОписаниеТипов("Дата"));
	Если ЭтоРасчетПоДоходамТекущегоМесяца Тогда
		//	Среди записей о доходах, полученных на предыдущем шаге, отбираем строки к осмотру по условиям (ранее рассчитано в поле УчитыватьПериодПриРасчете):  
		//	- запись зарегистрирована между началом года месяца расчета и концом месяца расчета
		//	- если выполняется промежуточный расчет, доход зарегистрирован раньше месяца расчета, а в месяце расчета только промежуточного расчета (ДоходМежрасчетногоПериода = Истина)
		//	Минимальная дата (НачалоГодаНалоговогоПериода): если запись зарегистрирована в месяце расчета, возьмем начало года месяца налогового периода этой записи, 
		//		если зарегистрирована в предыдущих месяцах, возьмем начало года от месяца расчета.
		//	Максимальная дата (ПоследнийМесяцНалоговогоПериода): максимальный месяц налогового периода 
		ТекущееФизическоеЛицо = Неопределено;
		Для Каждого СтрокаТаблицыДоходов Из ДанныеУчетаДоходов Цикл
			Если СтрокаТаблицыДоходов.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда  
				СтрокаПериодовПоФизическомуЛицу = ПериодыРасчетаПоФизическимЛицам.Добавить();
				СтрокаПериодовПоФизическомуЛицу.ФизическоеЛицо = СтрокаТаблицыДоходов.ФизическоеЛицо;
				СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода = МаксимальнаяДата;
				
				ТекущееФизическоеЛицо = СтрокаПериодовПоФизическомуЛицу.ФизическоеЛицо; 
			КонецЕсли;
			Если СтрокаТаблицыДоходов.УчитыватьПериодПриРасчете Тогда
				СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода = Мин(?(НачалоМесяца(СтрокаТаблицыДоходов.Период) = НачалоМесяцаРасчета, СтрокаТаблицыДоходов.НалоговыйПериод, НачалоГодаРасчета), СтрокаПериодовПоФизическомуЛицу.НачалоГодаНалоговогоПериода);
				СтрокаПериодовПоФизическомуЛицу.ПоследнийМесяцНалоговогоПериода = Макс(СтрокаТаблицыДоходов.МесяцНалоговогоПериода, СтрокаПериодовПоФизическомуЛицу.ПоследнийМесяцНалоговогоПериода);
			КонецЕсли;	
		КонецЦикла;	
	Иначе
		// В случае если расчет выполняется не по доходам текущего месяца, в качестве НачалоГодаНалоговогоПериода будем
		// использовать начала года первого месяца периода, переданного на вход алгоритма расчета, в качестве
		// ПоследнийМесяцНалоговогоПериода - первый день месяца окончания периода, переданного на вход алгоритма расчета
		НачалоПоследнегоМесяцаНалоговогоПериода = НачалоМесяца(ПоследнийМесяцНалоговогоПериода);
		Для Каждого ТекущееФизическоеЛицо Из СписокФизическихЛиц Цикл
			СтрокаТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.Добавить();
			СтрокаТаблицыПериодов.ФизическоеЛицо = ТекущееФизическоеЛицо;
			СтрокаТаблицыПериодов.НачалоГодаНалоговогоПериода = НачалоГодаПериодаРасчета;
			СтрокаТаблицыПериодов.ПоследнийМесяцНалоговогоПериода = НачалоПоследнегоМесяцаНалоговогоПериода;
		КонецЦикла;	
	КонецЕсли;	
	ПериодыРасчетаПоФизическимЛицам.Индексы.Добавить("ФизическоеЛицо");

	// 5.	Получим данные о статусе налогоплательщиков физических лиц (ТЗ СтатусыФизическихЛиц) из регистра сведений СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.
	//	Вход: список физических лиц,  ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода
	//	Выход: таблица значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, Статус, РезидентРФНаКонецМесяца, ПрименяетсяСтавкаПункта1Статьи224НК, РезидентРФНаКонецГода, СтатусНаКонецГода
	//			таблица индексирована по колонке ФизическоеЛицо 
	//	Описание алгоритма: 
	//		Читаем записи регистра СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный с отбором по списку физических лиц, действующие на начало года минимального месяца расчета, а также зарегистрированные между началом года минимального месяца расчета и концом максимального месяца расчета
	//		Применим отбор по списку физических лиц 
	СтатусыФизическихЛиц = СтатусыФизическихЛиц(СписокФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода);	

	// 5.	Для каждой строки полученных ранее данных учета доходов определим 
	//	- Ставку налогообложения (СтавкаЧислом)
	//	- Рассчитывать ли доход нарастающим итогом (ИсчислятьНалогНарастающимИтогом)
	//	- Сумму дохода за минусом вычета (ДоходыБезВычетов)
	//	- Сумму, используемую как коэффициент при распределении результатов расчета по подразделениям и категориям доходов (БазаРаспределения)
	//		... равна сумме дохода без вычета, для всех строк, если выполняется окончательный расчет, или для строк доходов, зарегистрированных для промежуточного расчета, и для всех строк, зарегистрированных раньше месяца расчета.
	ДополнитьДанныеУчетаСтавками(ДанныеУчетаДоходов, "УчитыватьИзмененияСтатусаДляРасчета", , СтатусыФизическихЛиц, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода);		
	ДанныеУчетаДоходов.Колонки.Добавить("ДоходыБезВычетов", Новый ОписаниеТипов("Число"));
	ДанныеУчетаДоходов.Колонки.Добавить("БазаРаспределения", Новый ОписаниеТипов("Число"));
	СтрокиКУдалению = Новый Соответствие;
	Для Каждого СтрокаТаблицыДоходов Из ДанныеУчетаДоходов Цикл
		Если СтрокаТаблицыДоходов.РезидентРФвНалоговомПериоде Или Не СтрокаТаблицыДоходов.ИсточникДоходаЗаПределамиРФ Тогда
			Если СтрокаТаблицыДоходов.ИсточникДоходаЗаПределамиРФ Тогда
				УчитыватьВычет = СтрокаТаблицыДоходов.УчитыватьВычетыКДоходамОтИсточникаВнеРФ;
			Иначе 
				УчитыватьВычет = СтрокаТаблицыДоходов.УчитыватьВсеВычетыКДоходамОтИсточникаРФ Или Не СтрокаТаблицыДоходов.НеПредоставляетсяНерезидентам 
			КонецЕсли;
			СтрокаТаблицыДоходов.ДоходыБезВычетов = СтрокаТаблицыДоходов.СуммаДохода - ?(УчитыватьВычет, СтрокаТаблицыДоходов.СуммаВычета, 0);
			Если СтрокаТаблицыДоходов.ИспользоватьДляРаспределения Тогда
				СтрокаТаблицыДоходов.БазаРаспределения = СтрокаТаблицыДоходов.ДоходыБезВычетов;
			КонецЕсли;				
		Иначе
			СтрокиКУдалению.Вставить(СтрокаТаблицыДоходов)
		КонецЕсли;
	КонецЦикла;
	Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
		ДанныеУчетаДоходов.Удалить(УдаляемаяСтрока.Ключ);		
	КонецЦикла;	
	ДанныеУчетаДоходов.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КодДохода, Подразделение, СтавкаЧислом, ИсчислятьНалогНарастающимИтогом, ДоходМежрасчетногоПериода, КатегорияДохода, ДоходТекущегоРасчета", "ДоходыБезВычетов, СуммаДохода, БазаРаспределения");
 	ДанныеУчетаДоходов.Колонки.СуммаДохода.Имя = "ВсеДоходы";
	
	// 7.	Поделим доходы на две части: для расчета налога нарастающим итогом и по каждой сумме дохода отдельно (абзацы первый и второй пункта 3 статьи 226 НК РФ)

	//	Для выделения доходов с расчетом налога по каждой сумме дохода отдельно из таблицы значений с данными учета доходов (где ранее рассчитана ставка налогообложения и признак расчета налога нарастающим итогом) 
	//	скопируем все строки с ИсчислятьНалогНарастающимИтогом = Ложь
	ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно = ДанныеУчетаДоходов.Скопировать(Новый Структура("ИсчислятьНалогНарастающимИтогом", Ложь));	
	//	Под "каждой суммой", для которой будем исчислять налог, понимаем сумму доходов физ.лица в одну дату получения дохода, по одному коду дохода, подразделению, категории, начисленную по отдельному основанию.
	ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, Подразделение, КатегорияДохода, СтавкаЧислом, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", "ДоходыБезВычетов");

	// В основной таблице оставим только доходы, по которым налог исчисляется нарастающим итогом.
	ПоляПоиска = "ФизическоеЛицо, МесяцНалоговогоПериода";
	СоответствиеНерезидентов = Новый Соответствие;
	СтрокОтдельныхСумм = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Количество();
	Если СтрокОтдельныхСумм > 0 Тогда
		
		ДанныеУчетаДоходов = ДанныеУчетаДоходов.Скопировать(Новый Структура("ИсчислятьНалогНарастающимИтогом", Истина));
		
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Индексы.Добавить(ПоляПоиска);
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Сортировать(ПоляПоиска, Новый СравнениеЗначений);
		
		СтрокиКУдалению = Новый Соответствие;
		ТекущееФизическоеЛицо = Неопределено; 
		ИндексОбрабатываемойСтроки = 0;
		Пока ИндексОбрабатываемойСтроки <= СтрокОтдельныхСумм - 1 Цикл
			
			ТекущаяСтрока = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно[ИндексОбрабатываемойСтроки];
			ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
			Если ТекущаяСтрока.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда // Начало обработки очередного физлица.
				ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо; 
				МесяцНачала = '00010101'; МесяцОкончания = '00010101';
				СтрокиТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.НайтиСтроки(Новый Структура("ФизическоеЛицо", ТекущееФизическоеЛицо));
				Если СтрокиТаблицыПериодов.Количество() > 0 Тогда
					МесяцНачала = СтрокиТаблицыПериодов[0].НачалоГодаНалоговогоПериода;
					МесяцОкончания = СтрокиТаблицыПериодов[0].ПоследнийМесяцНалоговогоПериода;
				КонецЕсли;
			КонецЕсли;	
			Если Не (ТекущаяСтрока.МесяцНалоговогоПериода >= МесяцНачала И ТекущаяСтрока.МесяцНалоговогоПериода <= МесяцОкончания) Тогда
				СтрокиКУдалению.Вставить(ТекущаяСтрока);
			КонецЕсли;	
			
		КонецЦикла;
		Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
			ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Удалить(УдаляемаяСтрока.Ключ);		
		КонецЦикла;	
		
		ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Индексы.Добавить("ФизическоеЛицо, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода");
		СоответствиеНерезидентов = ОбщегоНазначенияБЗККлиентСервер.МассивВСоответствие(ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.ВыгрузитьКолонку("ФизическоеЛицо"));
		
	КонецЕсли;
	
	РассчитыватьНалогНарастающимИтогом = ДанныеУчетаДоходов.Количество() > 0;
	
	// данные о праве на вычеты будем читать только при наличии резидентов
	Если РассчитыватьНалогНарастающимИтогом Тогда 
		
		// Прочитаем учетную политику.
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	УчетнаяПолитикаПоНДФЛ.ОсобенностиИсчисленияНДФЛ КАК ОсобенностиИсчисленияНДФЛ
		|ИЗ
		|	РегистрСведений.УчетнаяПолитикаПоНДФЛ КАК УчетнаяПолитикаПоНДФЛ
		|ГДЕ
		|	УчетнаяПолитикаПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация";
		Выборка = Запрос.Выполнить().Выбрать();
		// Признак, определяющий порядок накопления сумм стандартных вычетов. 
		ПрименятьСтандартныеВычетыНарастающимИтогом = Истина;
		Если Выборка.Следующий() Тогда
			ПрименятьСтандартныеВычетыНарастающимИтогом = Выборка.ОсобенностиИсчисленияНДФЛ = Перечисления.ОсобенностиИсчисленияНДФЛ.СтандартныеВычетыНарастающимИтогом;
		КонецЕсли;
	
		// 8.	Получим таблицу с данными для распределения результатов расчета по подразделениям и категориям
		//	Из таблицы значений с данными учета доходов с дополнительно рассчитанной на предыдущем шаге колонкой БазаРаспределения
		//	копированием получаем новую таблицу значений, данные которой сгруппированы по полям 
		//	ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета
		ДоходыПоПодразделениямИКатегориям = ДанныеУчетаДоходов.Скопировать(, "ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета, ДоходыБезВычетов, БазаРаспределения");
		ДоходыПоПодразделениямИКатегориям.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, КатегорияДохода, Подразделение, ДоходМежрасчетногоПериода, ДоходТекущегоРасчета", "ДоходыБезВычетов, БазаРаспределения");
		ДоходыПоПодразделениямИКатегориям.Колонки.ДоходыБезВычетов.Имя = "СуммаДоходаТекущегоРасчета"; 
		ДоходыПоПодразделениямИКатегориям.Колонки.БазаРаспределения.Имя = "СуммаДохода"; 
		ДоходыПоПодразделениямИКатегориям.Индексы.Добавить("ФизическоеЛицо");
		
		// 9.	Дополним таблицу значений с данными учета доходов итогами по месяцам и датам получения дохода, в том числе нарастающим итогом с начала года. 
		//		В результате в таблице должно получиться как минимум по одной строке на каждый месяц, по которому выполняется расчет по физическому лицу. 
		//	В таблице данных учета оставляем колонки ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода, ДоходыБезВычетов, ВсеДоходы, БазаРаспределения
		//	и добавляем:
		//	- ОблагаемыйДоход - облагаемый доход нарастающим итогом с начала месяца этой даты по дату получения дохода из строки таблицы, причем строка с ДоходМежрасчетногоПериода = Истина предшествует строке "окончательного расчета" той же даты и не включает доход "окончательного расчета".
		//	- ОблагаемыйДоходНарастающимИтогом - облагаемый доход на конец месяца нарастающим итогом с начала года, заполняется только для первой строки за месяц.
		//	- ОблагаемыйДоходЗаМесяц - облагаемый доход месяца (доход - вычеты к доходам), заполняется только для первой строки за месяц.
		//	- ВсеДоходыЗаМесяц - сумма доходов месяца (без учета вычетов), служит флажком наличия доходов, заполняется только для первой строки за месяц.
		//	- СтаршийМесяцПолученияДохода - наибольший месяц налогового периода, за который имеется положительный доход (без учета вычетов), служит ограничением для расчета вычетов, заполняется только для первой строки за месяц.
		//	Для последующего удобства обхода таблицы добавляем признаки первой и последней строки по физическому лицу, налоговому периоду, месяцу налогового периода и дате получения дохода.
		ДанныеУчетаДоходов.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода", "ДоходыБезВычетов, ВсеДоходы");	
		ДанныеУчетаДоходов.Сортировать("ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода УБЫВ", Новый СравнениеЗначений);
		
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоход", Новый ОписаниеТипов("Число")); 
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоходНарастающимИтогом", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("ОблагаемыйДоходЗаМесяц", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("ВсеДоходыЗаМесяц", Новый ОписаниеТипов("Число"));
		ДанныеУчетаДоходов.Колонки.Добавить("СтаршийМесяцПолученияДохода", Новый ОписаниеТипов("Дата"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаДату", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаМесяц", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаЗаГод", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПоследняяСтрокаПоФизическомуЛицу", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаДату", Новый ОписаниеТипов("Булево"));
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаМесяц", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаЗаГод", Новый ОписаниеТипов("Булево"));	
		ДанныеУчетаДоходов.Колонки.Добавить("ЭтоПерваяСтрокаПоФизическомуЛицу", Новый ОписаниеТипов("Булево"));
		
		//	Описание алгоритма:
		//	В результирующей таблице (для экономии памяти, модифицируем входную таблицу с доходами) будут строки на каждую дату получения дохода, причем если на дату зарегистрирован 
		//	доход для промежуточного и для окончательно расчета, на дату будет две строки с разными значениями ДоходМежрасчетногоПериода. 
		//	Если облагаемый доход нарастающим итогом с начала месяца по дату получения дохода равен 0 и эта строка не является последней за месяц, то не будем оставлять ее в таблице.
		//	Если за месяц, входящий в период расчета по физическому лицу, вообще не было зарегистрировано доходов, то добавим строку с датой получения дохода, равной концу месяца.
		//	При расчете поля ОблагаемыйДоход (доход нарастающим итогом с начала месяца этой даты по дату получения дохода):
		//		если в строке отражен доход межрасчетного периода (ДоходМежрасчетногоПериода = Истина), возьмем все доходы за предыдущие даты месяца и доход текущей строки
		//		если в строке отражен доход окончательного расчета (ДоходМежрасчетногоПериода = Ложь), возьмем все доходы за предыдущие даты месяца и все доходы за текущую дату
		//	Алгоритм реализуется оптимальным образом за счет сортировки предварительно свернутой таблицы с данными учета доходов  по полям ФизическоеЛицо, МесяцНалоговогоПериода, ДатаПолученияДохода, ДоходМежрасчетногоПериода (по убыванию)  
		СтрокиКУдалению = Новый Соответствие;
		ИндексОбрабатываемойСтроки = 0;
		Пока ИндексОбрабатываемойСтроки <= ДанныеУчетаДоходов.Количество() - 1 Цикл
			
			СтрокиПоФизическомуЛицу = Новый Массив;
			ПервыеСтрокиМесяцев = Новый Массив;
			ТекущаяСтрока = ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки];
			ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо;
			
			МесяцНачала = '00010101';
			МесяцОкончания = '00010101';
			СтрокиТаблицыПериодов = ПериодыРасчетаПоФизическимЛицам.НайтиСтроки(Новый Структура("ФизическоеЛицо", ТекущееФизическоеЛицо));
			Если СтрокиТаблицыПериодов.Количество() > 0 Тогда
				МесяцНачала = СтрокиТаблицыПериодов[0].НачалоГодаНалоговогоПериода;
				МесяцОкончания = СтрокиТаблицыПериодов[0].ПоследнийМесяцНалоговогоПериода;
			КонецЕсли;
			
			ПоследнийОбработанныйМесяц = ТекущаяСтрока.МесяцНалоговогоПериода;
			ПоследнийМесяцДополнения = Мин(НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода), МесяцОкончания);
			ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, МесяцНачала, ПоследнийМесяцДополнения, ИндексОбрабатываемойСтроки);	
			
			ПредыдущаяСтрока = Неопределено;
			ПредыдущийНалоговыйПериод = Неопределено;
			Пока ИндексОбрабатываемойСтроки <= ДанныеУчетаДоходов.Количество() - 1 И ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки].ФизическоеЛицо = ТекущееФизическоеЛицо Цикл
				
				ТекущаяСтрока = ДанныеУчетаДоходов[ИндексОбрабатываемойСтроки];
				ТекущийМесяцНалоговогоПериода = ТекущаяСтрока.МесяцНалоговогоПериода;
				
				Если Не (ТекущийМесяцНалоговогоПериода >= МесяцНачала И ТекущийМесяцНалоговогоПериода <= МесяцОкончания) Тогда
					ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
					СтрокиКУдалению.Вставить(ТекущаяСтрока);
					Продолжить;
				КонецЕсли;	
				
				УдалятьТекущуюСтроку = Ложь;
				ТекущийНалоговыйПериод = НачалоГода(ТекущийМесяцНалоговогоПериода);
				
				Если ТекущийНалоговыйПериод <> ПредыдущийНалоговыйПериод Или ПредыдущаяСтрока = Неопределено Тогда	
					
					Если ПредыдущаяСтрока <> Неопределено Тогда
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаГод = Истина;
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаМесяц = Истина;
						ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
						РассчитатьСтаршийМесяцПолученияДохода(ПервыеСтрокиМесяцев);
					КонецЕсли;	
					
					ПоследнийМесяцДополнения = Мин(ТекущийМесяцНалоговогоПериода, МесяцОкончания);
					ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод, ПоследнийМесяцДополнения, ИндексОбрабатываемойСтроки);			
					
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаГод = Месяц(ТекущийМесяцНалоговогоПериода) = 1;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаМесяц = Истина;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
					
					ОблагаемыйДоход = 0;
					ОблагаемыйДоходНарастающимИтогомЗаГод = 0;
					ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
					ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
					ПредыдущийНалоговыйПериод = ТекущийНалоговыйПериод;
					
				ИначеЕсли ТекущийМесяцНалоговогоПериода <> ПредыдущаяСтрока.МесяцНалоговогоПериода Тогда 			
					
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаМесяц = Истина;
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
					
					ПоследнийМесяцДополнения = Мин(ТекущийМесяцНалоговогоПериода, МесяцОкончания);
					ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ТекущееФизическоеЛицо, ДобавитьМесяц(ПредыдущаяСтрока.МесяцНалоговогоПериода, 1), ТекущийМесяцНалоговогоПериода, ИндексОбрабатываемойСтроки, ОблагаемыйДоходНарастающимИтогомЗаГод);
					
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаМесяц = Истина;
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
					
					ОблагаемыйДоход = 0;		
					ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
					ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
					
				ИначеЕсли ТекущаяСтрока.ДатаПолученияДохода <> ПредыдущаяСтрока.ДатаПолученияДохода Тогда
					ПредыдущаяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
					// Если на предыдущую дату доход нарастающим итогом с начала месяца равен 0, то соответствующая строка не нужна: в
					// месяце есть еще строки
					Если ПредыдущаяСтрока.ОблагаемыйДоход = 0 Тогда
						ЗаполнитьЗначенияСвойств(ТекущаяСтрока, ПредыдущаяСтрока, "ЭтоПерваяСтрокаПоФизическомуЛицу, ЭтоПерваяСтрокаЗаГод, ЭтоПерваяСтрокаЗаМесяц, ОблагаемыйДоходЗаМесяц, ВсеДоходыЗаМесяц");								
						СтрокиКУдалению.Вставить(ПредыдущаяСтрока);	
						СтрокиПоФизическомуЛицу.Удалить(СтрокиПоФизическомуЛицу.Количество() - 1);
						Если ПредыдущаяСтрока.ЭтоПерваяСтрокаЗаМесяц Тогда
							ПерваяСтрокаЗаМесяц = ТекущаяСтрока;
							ПервыеСтрокиМесяцев.Добавить(ПерваяСтрокаЗаМесяц);
						КонецЕсли;	
					КонецЕсли;		
					ТекущаяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
				ИначеЕсли ОблагаемыйДоход + ТекущаяСтрока.ДоходыБезВычетов = 0 Тогда 
					УдалятьТекущуюСтроку = Истина;
				КонецЕсли;	
				
				ОблагаемыйДоход = ОблагаемыйДоход + ТекущаяСтрока.ДоходыБезВычетов;
				ОблагаемыйДоходНарастающимИтогомЗаГод = ОблагаемыйДоходНарастающимИтогомЗаГод + ТекущаяСтрока.ДоходыБезВычетов;
				ТекущаяСтрока.ОблагаемыйДоход = ОблагаемыйДоход;	
				ПерваяСтрокаЗаМесяц.ОблагаемыйДоходЗаМесяц = ПерваяСтрокаЗаМесяц.ОблагаемыйДоходЗаМесяц + ТекущаяСтрока.ДоходыБезВычетов;
				ПерваяСтрокаЗаМесяц.ВсеДоходыЗаМесяц = ПерваяСтрокаЗаМесяц.ВсеДоходыЗаМесяц + ТекущаяСтрока.ВсеДоходы;
				ПерваяСтрокаЗаМесяц.ОблагаемыйДоходНарастающимИтогом = ОблагаемыйДоходНарастающимИтогомЗаГод;
				
				ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
				
				Если УдалятьТекущуюСтроку Тогда
					СтрокиКУдалению.Вставить(ТекущаяСтрока);
				Иначе	
					ПредыдущаяСтрока = ТекущаяСтрока;
					СтрокиПоФизическомуЛицу.Добавить(ТекущаяСтрока);
				КонецЕсли;	
			КонецЦикла;	// по физ.лицу                        
			
			Если СтрокиПоФизическомуЛицу.Количество() > 0 Тогда
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаПоФизическомуЛицу = Истина;	
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаГод = Истина;
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаМесяц = Истина;
				СтрокиПоФизическомуЛицу[СтрокиПоФизическомуЛицу.Количество() - 1].ЭтоПоследняяСтрокаЗаДату = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаПоФизическомуЛицу = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаГод = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаМесяц = Истина;
				СтрокиПоФизическомуЛицу[0].ЭтоПерваяСтрокаЗаДату = Истина;
				РассчитатьСтаршийМесяцПолученияДохода(ПервыеСтрокиМесяцев);
			КонецЕсли;	
			
		КонецЦикла;		
		Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
			ДанныеУчетаДоходов.Удалить(УдаляемаяСтрока.Ключ);		
		КонецЦикла;	
		
		// 10.	Получим доходы с предыдущего места работы
		//	Читаем регистр ДоходыПредыдущегоМестаРаботыНДФЛ с отбором по списку физических лиц, головной организации для всех месяцев периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, Размер
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.ФизическоеЛицо,
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.МесяцНалоговогоПериода,
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.Размер
		|ИЗ
		|	РегистрСведений.ДоходыПредыдущегоМестаРаботыНДФЛ КАК ДоходыПредыдущегоМестаРаботыНДФЛ
		|ГДЕ
		|	ДоходыПредыдущегоМестаРаботыНДФЛ.ФизическоеЛицо В (&СписокФизическихЛиц)
		|	И ДоходыПредыдущегоМестаРаботыНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ДоходыПредыдущегоМестаРаботыНДФЛ.МесяцНалоговогоПериода
		|		МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета";
		ДоходыСПредыдущегоМестаРаботы = Запрос.Выполнить().Выгрузить();
		ДоходыСПредыдущегоМестаРаботы.Индексы.Добавить(ПоляПоиска);
		
		// 11.	Информация о правах на стандартные вычеты
		//	Читаем из регистра СтандартныеВычетыПоНДФЛВторичный записи с отбором по списку физических лиц, действующие (определяем по ДатаНачала) на начало года первого месяца 
		//	налогового периода расчета или зарегистрированные между началом года первого месяца налогового периода расчета и последним месяцем налогового периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, ПериодРегистрацииНачало, ПериодРегистрацииОкончание, КодВычета, ЛичныйВычет, Количество.
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ВычетыНаДетей.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ВычетыНаДетей.ДатаНачала КАК ДатаНачала,
		|	ВычетыНаДетей.ДатаОкончания КАК ДатаОкончания,
		|	ВычетыНаДетей.ПериодРегистрацииНачало КАК ПериодРегистрацииНачало,
		|	ВычетыНаДетей.ПериодРегистрацииОкончание КАК ПериодРегистрацииОкончание,
		|	ВычетыНаДетей.КодВычета КАК КодВычета,
		|	ВычетыНаДетей.ЛичныйВычет КАК ЛичныйВычет,
		|	ВычетыНаДетей.Количество КАК Количество
		|ИЗ
		|	РегистрСведений.СтандартныеВычетыПоНДФЛВторичный КАК ВычетыНаДетей
		|ГДЕ
		|	ВычетыНаДетей.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И (&НачалоГодаПериодаРасчета МЕЖДУ ВычетыНаДетей.ДатаНачала И ВычетыНаДетей.ДатаОкончания
		|			ИЛИ ВычетыНаДетей.ДатаНачала МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
		|	И (НЕ ВычетыНаДетей.ЛичныйВычет
		|			ИЛИ ВычетыНаДетей.КодВычета <> ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка))";
		ВычетыНаДетейИЛичные = Запрос.Выполнить().Выгрузить();
		ВычетыНаДетейИЛичные.Индексы.Добавить("ФизическоеЛицо"); 
		
		// 12.	Получим информацию о применении вычетов по физическим лицам в организации, для которой ведется расчет налога.
		//	Читаем записи регистра ПрименениеСтандартныхВычетовПоНДФЛВторичный по списку физических лиц и головной организации, действующие (определяем по ДатаНачала) на начало года первого месяца 
		//	налогового периода расчета или зарегистрированные между началом года первого месяца налогового периода расчета и последним месяцем налогового периода расчета.
		//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, ДатаНачала, ДатаОкончания, ПрименятьВычеты
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала КАК ДатаНачала,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаОкончания КАК ДатаОкончания,
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ПрименятьВычеты КАК ПрименятьВычеты
		|ИЗ
		|	РегистрСведений.ПрименениеСтандартныхВычетовПоНДФЛВторичный КАК ПрименениеСтандартныхВычетовПоНДФЛВторичный
		|ГДЕ
		|	ПрименениеСтандартныхВычетовПоНДФЛВторичный.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И ПрименениеСтандартныхВычетовПоНДФЛВторичный.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И (&НачалоГодаПериодаРасчета МЕЖДУ ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала И ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаОкончания
		|			ИЛИ ПрименениеСтандартныхВычетовПоНДФЛВторичный.ДатаНачала МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)";
		ПрименениеСтандартныхВычетов = Запрос.Выполнить().Выгрузить();
		ПрименениеСтандартныхВычетов.Индексы.Добавить("ФизическоеЛицо");
		
		// Прочитаем размеры вычетов за каждый год периода расчета.
		// В качестве результата получаем соответствие, в котором по годам лежат соответствия, в которых каждому вычету
		// сопоставлена структура с полями Размер и ОграничениеПоДоходам.
		РазмерыВычетов = УчетНДФЛПовтИсп.РазмерыВычетов(НачалоГода(ПервыйМесяцНалоговогоПериода), НачалоГода(ПоследнийМесяцНалоговогоПериода));
		
	КонецЕсли;
	
	// 13.	Получим данные об имущественных вычетах (как ранее предоставленные, так и о праве на вычет)
	//	Читаем записи регистра накопления ИмущественныеВычетыНДФЛ по списку физических лиц и головной организации, зарегистрированные за весь период расчетов.
	//	Для записей прихода (права на вычеты) период дополнительно ограничиваем сверху окончанием месяца расчета (весь период расчетов может заканчиваться позже), а также учитываем только те записи, у которых год поля период совпадает со значением измерения Год.
	//	Для записей расхода (использованные вычеты) дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Полученный результат дополняем данными текущего регистратора о праве на вычеты и группируем.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, КодВычета, ВидДвижения, Подразделение, Сумма.
	ДатаЧтенияОстаточныхДанных = Макс(КонецПериодаРасчета, КонецМесяцаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаИмущественныхВычетов", ДатаЧтенияОстаточныхДанных);
	
	Если ОкончательныйРасчет Тогда
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	ИмущественныеВычеты.КодВычета КАК КодВычета,
		|	ИмущественныеВычеты.ВидДвижения КАК ВидДвижения,
		|	ВЫБОР
		|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			ТОГДА ИмущественныеВычеты.Подразделение
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК Подразделение,
		|	СУММА(ИмущественныеВычеты.Сумма) КАК Сумма
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычеты
		|ГДЕ
		|	ИмущественныеВычеты.Регистратор <> &ИсключаемыйРегистратор
		|	И ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаИмущественныхВычетов
		|	И ИмущественныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычеты.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И ВЫБОР
		|			КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				ТОГДА ИмущественныеВычеты.Год = ГОД(ИмущественныеВычеты.Период)
		|						И ИмущественныеВычеты.Период <= &КонецМесяцаРасчета
		|			ИНАЧЕ ИмущественныеВычеты.Период <= &КонецПериодаРасчета
		|		КОНЕЦ
		|	И &УсловиеНаНачисленноеВАванс
		|
		|СГРУППИРОВАТЬ ПО
		|	ИмущественныеВычеты.ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ),
		|	ИмущественныеВычеты.КодВычета,
		|	ИмущественныеВычеты.ВидДвижения,
		|	ВЫБОР
		|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			ТОГДА ИмущественныеВычеты.Подразделение
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ";	
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеНаНачисленноеВАванс", 
			?(ЭтоРасчетПоДоходамТекущегоМесяца, 
				"НЕ(ИмущественныеВычеты.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
				|		И ИмущественныеВычеты.ЗарегистрированоПриНачисленииАванса = &НачалоМесяцаРасчета
				|		И (ИмущественныеВычеты.МесяцРегистрации МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))",
				"Истина"));
	Иначе
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ИмущественныеВычеты.ФизическоеЛицо КАК ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	ИмущественныеВычеты.КодВычета КАК КодВычета,
		|	ИмущественныеВычеты.ВидДвижения КАК ВидДвижения,
		|	ВЫБОР
		|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			ТОГДА ИмущественныеВычеты.Подразделение
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК Подразделение,
		|	СУММА(ИмущественныеВычеты.Сумма) КАК Сумма
		|ИЗ
		|	РегистрНакопления.ИмущественныеВычетыНДФЛ КАК ИмущественныеВычеты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСОкончательнымРасчетом КАК ФизическиеЛицаСОкончательнымРасчетом
		|		ПО ИмущественныеВычеты.ФизическоеЛицо = ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо
		|ГДЕ
		|	ИмущественныеВычеты.Регистратор <> &ИсключаемыйРегистратор
		|	И ИмущественныеВычеты.Период МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаИмущественныхВычетов
		|	И ИмущественныеВычеты.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ИмущественныеВычеты.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И ВЫБОР
		|			КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					И ИмущественныеВычеты.КодВычета.ГруппаВычета <> ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|				ТОГДА ИмущественныеВычеты.Год = ГОД(ИмущественныеВычеты.Период)
		|						И ИмущественныеВычеты.Период <= &КонецМесяцаРасчета
		|			КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|					И ИмущественныеВычеты.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|				ТОГДА ИмущественныеВычеты.Год = ГОД(ИмущественныеВычеты.Период)
		|			ИНАЧЕ ИмущественныеВычеты.Период <= &КонецПериодаРасчета
		|					И (ИмущественныеВычеты.МесяцРегистрации < &НачалоМесяцаРасчета
		|						ИЛИ ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|						ИЛИ ИмущественныеВычеты.ВычетМежрасчетногоПериода
		|						ИЛИ ИмущественныеВычеты.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0))
		|		КОНЕЦ
		|
		|СГРУППИРОВАТЬ ПО
		|	ИмущественныеВычеты.ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(ИмущественныеВычеты.Период, МЕСЯЦ),
		|	ИмущественныеВычеты.КодВычета,
		|	ИмущественныеВычеты.ВидДвижения,
		|	ВЫБОР
		|		КОГДА ИмущественныеВычеты.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			ТОГДА ИмущественныеВычеты.Подразделение
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ";	
	КонецЕсли;
	
	ИмущественныеВычеты = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ИмущественныеВычетыНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		НеДобавлятьДанныеАвансов = Не УчетНДФЛ.ДоходыУчитываютсяТолькоПоДатеВыплаты(МесяцРасчета, -1);
		Для Каждого СтрокаВычетовТекущегоРегистратора Из ДвиженияТекущегоРегистратора.ИмущественныеВычетыНДФЛ Цикл
			Если ЗначениеЗаполнено(СтрокаВычетовТекущегоРегистратора.ЗарегистрированоПриНачисленииАванса) Тогда
				Если НеДобавлятьДанныеАвансов Тогда
					Продолжить;
				КонецЕсли;
				Если СтрокаВычетовТекущегоРегистратора.Период < НачалоМесяцаРасчета Тогда
					// пропускаем движения авансов прошлых месяцев
					Продолжить;
				КонецЕсли;
				Если СтрокаВычетовТекущегоРегистратора.ВидДвижения = ВидДвиженияНакопления.Расход Тогда
					Продолжить;
				КонецЕсли;
			КонецЕсли;
			Если СоответствиеФизическихЛиц[СтрокаВычетовТекущегоРегистратора.ФизическоеЛицо] = Неопределено Тогда
				Продолжить;
			КонецЕсли;
			
			НоваяСтрока = ИмущественныеВычеты.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаВычетовТекущегоРегистратора);
			НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(СтрокаВычетовТекущегоРегистратора.Период);
			НоваяСтрока.Подразделение = Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
			ЕстьНовыеЗаписи = Истина;
			
			Если ОкончательныйРасчет И ЗначениеЗаполнено(СтрокаВычетовТекущегоРегистратора.ЗарегистрированоПриНачисленииАванса) Тогда
				// Зачтем выплаченное в аванс в счет начисленного в окончательном расчете с сохранением фактической даты получения дохода по выплаченному авансу.
				Если СтрокаВычетовТекущегоРегистратора.Период < ПервыйМесяцТекущегоАлгоритма Тогда
					НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(ДатаУдержанияИсчисленногоНалога);
				Иначе
					ДатаПолученияДоходаКомпенсационнойСтроки = ДатаУдержанияИсчисленногоНалога;
					МаксимальнаяДатаДоходов = ДатыПредыдущейОплатыТруда[СтрокаВычетовТекущегоРегистратора.ФизическоеЛицо]; 
					Если МаксимальнаяДатаДоходов <> Неопределено Тогда
						Если НачалоМесяца(МаксимальнаяДатаДоходов) = НачалоМесяцаРасчета Тогда
							ДатаПолученияДоходаКомпенсационнойСтроки = МаксимальнаяДатаДоходов	
						КонецЕсли;
					КонецЕсли;
					ВтораяСтрока = ИмущественныеВычеты.Добавить();
					ЗаполнитьЗначенияСвойств(ВтораяСтрока, НоваяСтрока);
					НоваяСтрока.Сумма = -НоваяСтрока.Сумма;
					ВтораяСтрока.МесяцНалоговогоПериода = НачалоМесяца(ДатаПолученияДоходаКомпенсационнойСтроки);
				КонецЕсли;
			КонецЕсли;
			
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Новые права и сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ИмущественныеВычеты.Свернуть("ФизическоеЛицо, Подразделение, МесяцНалоговогоПериода, ВидДвижения, КодВычета", "Сумма");
		КонецЕсли;
	КонецЕсли;	
	ИмущественныеВычеты.Индексы.Добавить("ФизическоеЛицо, МесяцНалоговогоПериода, ВидДвижения");
	
	// 14.	Получим информацию о предоставленных стандартных и социальных вычетах.
	//	Читаем записи регистра накопления ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛс по списку физических лиц и головной организации, зарегистрированные за 
	//	период между началом года первого месяца налогового периода и концом последнего месяца налогового периода.
	//	Дополнительно проверяем условие на "межрасчетность" записей при выполнении промежуточного расчета.
	//	Для стандартных вычетов заполняем поля Подразделение и КодВычета (для социальных вычетов берем пустые ссылки). 
	//	Рассчитываем поле ЭтоСоциальныйВычет (булево) исходя из группы вычета.
	//	Полученный результат дополняем данными текущего регистратора о праве на социальные вычеты и группируем.
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, МесяцНалоговогоПериода, КодВычета, ЭтоСоциальныйВычет, Подразделение, Сумма.
	Если ОкончательныйРасчет Тогда
		Запрос.УстановитьПараметр("ДатаУдержанияИсчисленногоНалога", ?(ЗначениеЗаполнено(ДатаУдержанияИсчисленногоНалога), НачалоМесяца(ДатаУдержанияИсчисленногоНалога), НачалоМесяцаРасчета));
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ВычетыБД.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.КодВычета
		|	КОНЕЦ КАК КодВычета,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЭтоСоциальныйВычет,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.Подразделение
		|	КОНЕЦ КАК Подразделение,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА &УсловиеИспользованияНачисленногоВАванс
		|				ТОГДА &ДатаУдержанияИсчисленногоНалога
		|			ИНАЧЕ ВычетыБД.МесяцНалоговогоПериода
		|		КОНЕЦ, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА &УсловиеИспользованияНачисленногоВАванс
		|				ТОГДА &ДатаУдержанияИсчисленногоНалога
		|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
		|		КОНЕЦ, МЕСЯЦ) КАК МесяцПериодаПредоставленияВычета,
		|	СУММА(ВЫБОР
		|			КОГДА &УсловиеИспользованияНачисленногоВАванс
		|				ТОГДА -ВычетыБД.Сумма
		|			ИНАЧЕ ВычетыБД.Сумма
		|		КОНЕЦ) КАК Сумма
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ВычетыБД
		|ГДЕ
		|	ВычетыБД.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
		|	И ВычетыБД.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ВычетыБД.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И (ВЫБОР
		|				КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|				КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|				ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
		|			КОНЕЦ МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
		|			ИЛИ ВычетыБД.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
		|	И ВычетыБД.Регистратор <> &ИсключаемыйРегистратор
		|	И &УсловиеНаНачисленноеВАванс
		|
		|СГРУППИРОВАТЬ ПО
		|	ВычетыБД.ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.Подразделение
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.КодВычета
		|	КОНЕЦ,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА &УсловиеИспользованияНачисленногоВАванс
		|				ТОГДА &ДатаУдержанияИсчисленногоНалога
		|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
		|		КОНЕЦ, МЕСЯЦ),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА &УсловиеИспользованияНачисленногоВАванс
		|				ТОГДА &ДатаУдержанияИсчисленногоНалога
		|			ИНАЧЕ ВычетыБД.МесяцНалоговогоПериода
		|		КОНЕЦ, МЕСЯЦ)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВычетыБД.ФизическоеЛицо,
		|	ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка),
		|	ИСТИНА,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка),
		|	НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ),
		|	НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ),
		|	СУММА(ВычетыБД.Сумма)
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ВычетыБД
		|ГДЕ
		|	ВычетыБД.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ВычетыБД.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И ВычетыБД.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
		|	И ВычетыБД.Регистратор <> &ИсключаемыйРегистратор
		|	И &УсловиеИспользованияНачисленногоВАванс
		|
		|СГРУППИРОВАТЬ ПО
		|	ВычетыБД.ФизическоеЛицо,
		|	НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ),
		|	НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ)";
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеНаНачисленноеВАванс", 
			?(ЭтоРасчетПоДоходамТекущегоМесяца, 
				"НЕ(ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
				|		И ВычетыБД.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
				|		И ВычетыБД.ЗарегистрированоПриНачисленииАванса <> &НачалоМесяцаРасчета
				|		И (ВычетыБД.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета))",
				"Истина"));
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеИспользованияНачисленногоВАванс", 
			?(ЭтоРасчетПоДоходамТекущегоМесяца, 
				"ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
				|		И ВычетыБД.ЗарегистрированоПриНачисленииАванса = &НачалоМесяцаРасчета
				|		И (ВычетыБД.Период МЕЖДУ &НачалоМесяцаРасчета И &КонецМесяцаРасчета)",
				"ЛОЖЬ"));
	Иначе
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ВычетыБД.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.КодВычета
		|	КОНЕЦ КАК КодВычета,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЭтоСоциальныйВычет,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.Подразделение
		|	КОНЕЦ КАК Подразделение,
		|	НАЧАЛОПЕРИОДА(ВычетыБД.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
		|		КОНЕЦ, МЕСЯЦ) КАК МесяцПериодаПредоставленияВычета,
		|	СУММА(ВычетыБД.Сумма) КАК Сумма
		|ИЗ
		|	РегистрНакопления.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ КАК ВычетыБД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТФизическиеЛицаСОкончательнымРасчетом КАК ФизическиеЛицаСОкончательнымРасчетом
		|		ПО ВычетыБД.ФизическоеЛицо = ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо
		|ГДЕ
		|	ВычетыБД.Период МЕЖДУ &НачалоПредшествующегоГода И &КонецМесяцаРасчета
		|	И ВычетыБД.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И ВычетыБД.ФизическоеЛицо В(&СписокФизическихЛиц)
		|	И (ВЫБОР
		|				КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|				КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|					ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|				ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
		|			КОНЕЦ МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета
		|			ИЛИ ВычетыБД.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецПериодаРасчета)
		|	И ВычетыБД.Регистратор <> &ИсключаемыйРегистратор
		|	И (ВычетыБД.Период < &НачалоМесяцаРасчета
		|			ИЛИ ВычетыБД.МесяцНалоговогоПериода <= &ДатаПолученияМежрасчетногоДохода
		|				И (ФизическиеЛицаСОкончательнымРасчетом.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|					ИЛИ ВычетыБД.ВычетМежрасчетногоПериода
		|					ИЛИ ВычетыБД.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)))
		|
		|СГРУППИРОВАТЬ ПО
		|	ВычетыБД.ФизическоеЛицо,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.Подразделение
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыВычетовНДФЛ.ПустаяСсылка)
		|		ИНАЧЕ ВычетыБД.КодВычета
		|	КОНЕЦ,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ВычетыБД.КодВычета.ГруппаВычета = ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.Социальные)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			КОГДА ВычетыБД.МесяцПериодаПредоставленияВычета = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				ТОГДА ВычетыБД.МесяцНалоговогоПериода
		|			ИНАЧЕ ВычетыБД.МесяцПериодаПредоставленияВычета
		|		КОНЕЦ, МЕСЯЦ),
		|	ВычетыБД.МесяцНалоговогоПериода";
	КонецЕсли;
	Запрос.Текст = ТекстЗапроса;
	ПредоставленныеСтандартныеИСоциальныеВычеты = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ") Тогда
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого ТекущаяСтрока Из ДвиженияТекущегоРегистратора.ПредоставленныеСтандартныеИСоциальныеВычетыНДФЛ Цикл
			Если СоответствиеФизическихЛиц[ТекущаяСтрока.ФизическоеЛицо] = Неопределено Тогда
				Продолжить;	
			КонецЕсли;			
			
			ЭтоСоциальныйВычет = ТекущаяСтрока.КодВычета.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные;	
			Если ЭтоСоциальныйВычет И ОкончательныйРасчет И ЭтоРасчетПоДоходамТекущегоМесяца И ЗначениеЗаполнено(ТекущаяСтрока.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;	
			КонецЕсли;
			
			НоваяСтрока = ПредоставленныеСтандартныеИСоциальныеВычеты.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
			НоваяСтрока.ЭтоСоциальныйВычет = ЭтоСоциальныйВычет;	
			Если ЭтоСоциальныйВычет Тогда
				НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(?(ТекущаяСтрока.МесяцНалоговогоПериода = МесяцРасчета И ЗначениеЗаполнено(ДатаУдержанияИсчисленногоНалога), ДатаУдержанияИсчисленногоНалога, ТекущаяСтрока.МесяцНалоговогоПериода));
				НоваяСтрока.МесяцПериодаПредоставленияВычета = НоваяСтрока.МесяцНалоговогоПериода;
				НоваяСтрока.Подразделение = Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
				НоваяСтрока.КодВычета = Справочники.ВидыВычетовНДФЛ.ПустаяСсылка();
			ИначеЕсли Не ЗначениеЗаполнено(НоваяСтрока.МесяцПериодаПредоставленияВычета) Тогда	
				НоваяСтрока.МесяцПериодаПредоставленияВычета = НоваяСтрока.МесяцНалоговогоПериода;
			КонецЕсли;
			НоваяСтрока.МесяцНалоговогоПериода = НачалоМесяца(НоваяСтрока.МесяцНалоговогоПериода);
			НоваяСтрока.МесяцПериодаПредоставленияВычета = НачалоМесяца(НоваяСтрока.МесяцПериодаПредоставленияВычета);
		КонецЦикла;
	КонецЕсли;	
	ПредоставленныеСтандартныеИСоциальныеВычеты.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, КодВычета, Подразделение, ЭтоСоциальныйВычет", "Сумма");
	ПредоставленныеСтандартныеИСоциальныеВычеты.Индексы.Добавить("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, ЭтоСоциальныйВычет");
		
	// 15.	Получим информацию об остатках авансовых платежей в бюджет
	//	Читаем остатки из регистра АвансовыеПлатежиИностранцевПоНДФЛ по списку физических лиц на конец месяца расчета за годы периода расчета.
	//	Отнимем движения исключаемого регистратора (удовлетворяющих тем же условиям что и данные остатков)
	//	В качестве результата получаем таблицу значений с полями ФизическоеЛицо, НалоговыйПериод (число, год), Остаток
	Запрос.УстановитьПараметр("МинимальныйГод", Год(ПервыйМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("МаксимальныйГод", Год(ПоследнийМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("КонецМесяцаРасчета", ДатаЧтенияОстаточныхДанных);
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Авансы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Авансы.НалоговыйПериод КАК НалоговыйПериод,
	|	СУММА(Авансы.Остаток) КАК Остаток
	|ИЗ
	|	(ВЫБРАТЬ
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.Год КАК НалоговыйПериод,
	|		АвансовыеПлатежиИностранцевПоНДФЛОбороты.СуммаОстаток КАК Остаток
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ.Остатки(
	|				&КонецМесяцаРасчета,
	|				ФизическоеЛицо В (&СписокФизическихЛиц)
	|					И (Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод)
	|					И ГоловнаяОрганизация = &ГоловнаяОрганизация) КАК АвансовыеПлатежиИностранцевПоНДФЛОбороты
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДвиженияРегистратора.ФизическоеЛицо,
	|		ДвиженияРегистратора.Год,
	|		ВЫБОР
	|			КОГДА ДвиженияРегистратора.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА ДвиженияРегистратора.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ КАК ДвиженияРегистратора
	|	ГДЕ
	|		ДвиженияРегистратора.Регистратор = &ИсключаемыйРегистратор
	|		И ДвиженияРегистратора.ФизическоеЛицо В(&СписокФизическихЛиц)
	|		И ДвиженияРегистратора.Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод
	|		И ДвиженияРегистратора.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДвиженияРегистратора.ФизическоеЛицо,
	|		ДвиженияРегистратора.Год,
	|		ВЫБОР
	|			КОГДА ДвиженияРегистратора.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				ТОГДА ДвиженияРегистратора.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ
	|	ИЗ
	|		РегистрНакопления.АвансовыеПлатежиИностранцевПоНДФЛ КАК ДвиженияРегистратора
	|	ГДЕ
	|		ДвиженияРегистратора.Регистратор <> &ИсключаемыйРегистратор
	|		И &УсловиеНаНачисленноеВАванс
	|		И ДвиженияРегистратора.ФизическоеЛицо В(&СписокФизическихЛиц)
	|		И ДвиженияРегистратора.Год МЕЖДУ &МинимальныйГод И &МаксимальныйГод
	|		И ДвиженияРегистратора.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|		И ДвиженияРегистратора.Период < &КонецМесяцаРасчета
	|		И ДвиженияРегистратора.Период >= &НачалоМесяцаРасчета) КАК Авансы
	|
	|СГРУППИРОВАТЬ ПО
	|	Авансы.ФизическоеЛицо,
	|	Авансы.НалоговыйПериод";
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеНаНачисленноеВАванс", ?(ОкончательныйРасчет И ЭтоРасчетПоДоходамТекущегоМесяца, "ДвиженияРегистратора.ЗарегистрированоПриНачисленииАванса <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)", "Ложь"));
	ОстаткиПоАвансовымПлатежам = Запрос.Выполнить().Выгрузить();
	Если ДвиженияТекущегоРегистратора <> Неопределено И ПроведениеСервер.ЕстьДвижения(ДвиженияТекущегоРегистратора, "АвансовыеПлатежиИностранцевПоНДФЛ") Тогда 
		ЕстьНовыеЗаписи = Ложь;
		Для Каждого СтрокаНабора Из ДвиженияТекущегоРегистратора.АвансовыеПлатежиИностранцевПоНДФЛ Цикл
			Если СоответствиеФизическихЛиц[СтрокаНабора.ФизическоеЛицо] = Неопределено Или СтрокаНабора.ВидДвижения = ВидДвиженияНакопления.Приход Тогда
				Продолжить;	
			КонецЕсли;
			Если ОкончательныйРасчет И ЭтоРасчетПоДоходамТекущегоМесяца И ЗначениеЗаполнено(СтрокаНабора.ЗарегистрированоПриНачисленииАванса) Тогда
				Продолжить;	
			КонецЕсли;
			СтрокаРезультат = ОстаткиПоАвансовымПлатежам.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРезультат, СтрокаНабора);
			СтрокаРезультат.НалоговыйПериод = СтрокаНабора.Год;
			СтрокаРезультат.Остаток = - СтрокаНабора.Сумма;
			ЕстьНовыеЗаписи = Истина;
		КонецЦикла;	
		Если ЕстьНовыеЗаписи Тогда // Сторно-записи регистрируются достаточно редко, поэтому проверим, надо ли сворачивать таблицу.
			ОстаткиПоАвансовымПлатежам.Свернуть("ФизическоеЛицо, НалоговыйПериод", "Остаток");
		КонецЕсли;	
	КонецЕсли;	
	ОстаткиПоАвансовымПлатежам.Индексы.Добавить("ФизическоеЛицо, НалоговыйПериод");
	
	РезультатРасчета = ТаблицаНДФЛ();
	
	СтруктураПоискаПоФизическомуЛицу = Новый Структура("ФизическоеЛицо");
	СтруктураПоискаТекущихДоходов = Новый Структура("ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", Истина, Не ОкончательныйРасчет);
	СтруктураПоискаТекущихДоходовНерезидентов = Новый Структура("ФизическоеЛицо, ДоходТекущегоРасчета, ДоходМежрасчетногоПериода", , Истина, Не ОкончательныйРасчет);
	СтруктураПоискаИсчисленного = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериодаДляПоиска");
	СтруктураПоискаСтандартныхВычетов = Новый Структура("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, ЭтоСоциальныйВычет");
	СтруктураПоискаИмущественныхВычетов = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериода, ВидДвижения");
	ОписаниеВычетов = УчетНДФЛПовтИсп.ОписаниеВычетов();
	
	// инициализируем общие вспомогательные объекты
	РезультатРасчетаВспомогательный = РезультатРасчета;
	ВспомогательнаяТаблицаМесяца = РезультатРасчета.СкопироватьКолонки("ФизическоеЛицо, МесяцПериодаПредоставленияВычета, МесяцНалоговогоПериода, Подразделение, КатегорияДохода, НалогПоСтавке13, ЗачтеноАвансовыхПлатежейПоСтавке13, НалогСПревышения, ЗачтеноАвансовыхПлатежейСПревышения");
	ВспомогательнаяТаблицаМесяца.Колонки.Добавить("КоличествоВычетов", Новый ОписаниеТипов("Число"));
	ВспомогательнаяТаблицаФизическогоЛица = ВспомогательнаяТаблицаМесяца.СкопироватьКолонки();
	ВспомогательнаяТаблицаПоДоходамПревышения = ВспомогательнаяТаблицаМесяца.СкопироватьКолонки();
	
	ВспомогательнаяТаблицаВычетовМесяца = Новый ТаблицаЗначений;
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("МесяцПериодаПредоставленияВычета", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("Подразделение", Метаданные.ОпределяемыеТипы.ТерриторияВыполненияРаботВОрганизации.Тип);
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("КатегорияДохода", Новый ОписаниеТипов("ПеречислениеСсылка.КатегорииДоходовНДФЛ"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("КодВычета", Новый ОписаниеТипов("СправочникСсылка.ВидыВычетовНДФЛ"));
	ВспомогательнаяТаблицаВычетовМесяца.Колонки.Добавить("РазмерВычета", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15,2)));
	
	// Начнем с расчета по резидентам и приравненным к ним.
	Если РассчитыватьНалогНарастающимИтогом Тогда
		
		ВспомогательныеДатыПодразделенияКатегории = Новый ТаблицаЗначений;
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов("Дата",,,,, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("Подразделение", Метаданные.ОпределяемыеТипы.ТерриторияВыполненияРаботВОрганизации.Тип);
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("КатегорияДохода", Новый ОписаниеТипов("ПеречислениеСсылка.КатегорииДоходовНДФЛ"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("Распределение", Новый ОписаниеТипов("ТаблицаЗначений"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьДатуПолученияДохода", Новый ОписаниеТипов("Булево"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьПодразделение", Новый ОписаниеТипов("Булево"));
		ВспомогательныеДатыПодразделенияКатегории.Колонки.Добавить("ЗаменятьКатегориюДохода", Новый ОписаниеТипов("Булево"));
		
		ВычетыЗаМесяц = Новый ТаблицаЗначений;
		ВычетыЗаМесяц.Колонки.Добавить("КодВычета");
		ВычетыЗаМесяц.Колонки.Добавить("РазмерВычета", Новый ОписаниеТипов("Число"));
		
		СтавкаДляРезидента = 0.13; // Пункт 1 статьи 224 НК РФ.
		СтавкаСПревышения = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом;
		ПределПрогрессивнойШкалы = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Предел;
		
		ОсобыеКатегорииДохода = Новый Соответствие; // Эти категории дохода определяют собственные ставки налога, поэтому их нельзя заменять текущими даже при перерасчете.
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.Дивиденды, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.ДивидендыПоСтавке12, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке03, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПоСтавке06, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке05, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке07, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке10, Истина);
		ОсобыеКатегорииДохода.Вставить(Перечисления.КатегорииДоходовНДФЛ.АвторскиеРоялтиПроцентыПоСтавке15, Истина);
		
		ПериодСрезаПравНаВычеты = НачалоМесяца(Макс(МесяцРасчета, ПоследнийМесяцНалоговогоПериода));
		
		// Инициализируем вспомогательные объекты.
		СтруктураПоиска = Новый Структура(ПоляПоиска);
		ПоляПоискаПоДатам = "ДатаПолученияДохода, ДоходМежрасчетногоПериода";
		СтруктураПоискаПоДатам = Новый Структура(ПоляПоискаПоДатам);
		СтруктураПоискаТолькоПоДатам = Новый Структура("ДатаПолученияДохода");
		СтруктураПоискаПоДатамИПодразделениям = Новый Структура("ДатаПолученияДохода,Подразделение");
		
		// Структуру описания остатков создаем однократно, в дальнейшем для каждого сочетания ФЛ+Налоговый период очищаем ее коллекции.
		ОстаткиВычетов = НовыйОстаткиВычетов();
		ТекущиеОстаткиВычетов = ОстаткиВычетов.Остатки; 
		
		ПараметрыЗаполненияРесурсаНалогПоСтавке13 = НовыйПараметрыЗаполненияРесурса("НалогПоСтавке13", "СуммаДохода", 0, "Подразделение, КатегорияДохода", , "НалогСПревышения");
		ПараметрыЗаполненияРесурсаНалогСПревышения = НовыйПараметрыЗаполненияРесурса("НалогСПревышения", "СуммаДохода", 0, "Подразделение, КатегорияДохода", , "НалогПоСтавке13");
		ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению = НовыйПараметрыЗаполненияРесурса("РазмерВычета", "СуммаДохода", , , "КодВычета");
		ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории = НовыйПараметрыЗаполненияРесурса("РазмерВычета", "СуммаДохода", ,"Подразделение, КатегорияДохода", "КодВычета,МесяцПериодаПредоставленияВычета");
		
		// Однократный обход таблицы ДанныеУчетаДоходов организован двумя вложенными циклами; внутренний цикл выполняет расчет
		// налога за один налоговый период по одному физлицу. В качестве промежуточной структуры данных для результатов
		// расчета за месяц используем две таблицы: в одной оставляем только ресурсы НалогПоСтавке13, НалогСПревышения,
		// ЗачтеноАвансовыхПлатежейПоСтавке13, ЗачтеноАвансовыхПлатежейСПревышения, во второй таблице храним результат расчета вычетов (измерение КодВычета и ресурс РазмерВычета).
		ИндексТекущейСтрокиТаблицыДоходов = 0;
		Пока ИндексТекущейСтрокиТаблицыДоходов <= ДанныеУчетаДоходов.Количество() - 1 Цикл
			
			// будет инициализирована только в том случае, если она понадобится
			ТаблицаРаспределенияМесяцаРасчета = Неопределено;	
			
			ТекущаяСтрокаТаблицыДоходов = ДанныеУчетаДоходов[ИндексТекущейСтрокиТаблицыДоходов];
			// получим физическое лицо, по которому выполняется расчет
			ТекущееФизическоеЛицо = ТекущаяСтрокаТаблицыДоходов.ФизическоеЛицо;
			
			// получим налоговый период, по которому далее будет выполняться расчет.
			ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрокаТаблицыДоходов.МесяцНалоговогоПериода);
			РазмерыВычетовНаГод = РазмерыВычетов[ТекущийНалоговыйПериод];
			
			// обнулим остатки вычетов
			ТекущиеОстаткиВычетов.Очистить();
			ОстаткиВычетов.ТаблицаВычетов.Очистить();	
			ВычетыПредыдущихМесяцев = Новый Соответствие;
			ОтложенныеПраваНаВычеты = Новый Соответствие;
			ВспомогательнаяТаблицаМесяца.Очистить();
			
			ДействующаяИнформацияОСтандартныхВычетах = Неопределено;
			ДействующаяИнформацияОСтатусе = Неопределено;
			                                                                         	
			// инициализируем переменные, хранящие итоги за год
			СтрокиНДФЛЗаГод = Новый Массив;
			ОблагаемыйДоходНаНачалоМесяца = 0;  
			ОблагаемыйДоходНаКонецМесяца = 0;
			
			ДоходЗаМесяцОстаток = 0;	
			НалогИсчисленный = 0;
			НалогСПревышенияИсчисленный = 0;
			ВычетСоциальныйОстаток = 0;
			ИсчисленоНДФЛЗаГод = 0;
			ОблагаемыйДоход = 0;
			ВсегоДоходовТекущегоРасчета = 0;
			
			Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаПоФизическомуЛицу Тогда // Начало обработки очередного физ.лица.
				
				ОкончательныйРасчетДляТекущегоФизическогоЛица = СоответствиеФизическихЛиц[ТекущаяСтрокаТаблицыДоходов.ФизическоеЛицо];
				ПереноситьДоходДляПримененияВычетовВМесяцРасчета = Не ОкончательныйРасчетДляТекущегоФизическогоЛица И Год(МесяцРасчета) = Год(ДатаУдержанияИсчисленногоНалога) И МесяцРасчета < НачалоМесяца(ДатаУдержанияИсчисленногоНалога);
				
				СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
				СтруктураПоискаТекущихДоходовНерезидентов.ФизическоеЛицо = ТекущееФизическоеЛицо;
				
				// Получим данные, необходимые для определения прав на вычеты.
				СтрокиТаблицыСтатусов = СтатусыФизическихЛиц.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				СтрокиТаблицыПримененияВычетов = ПрименениеСтандартныхВычетов.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				СтрокиТаблицыПравНаВычеты = ВычетыНаДетейИЛичные.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
				
				// Если выполняется окончательный расчет, будем вписывать результат расчета сразу в таблицы результата.
				// В случае с промежуточным расчетом будем использовать промежуточную таблицу, а потом переносить в результирующую с
				// учетом ограничений.
				Если Не ОкончательныйРасчет Тогда
					РезультатРасчетаВспомогательный = РезультатРасчета.СкопироватьКолонки();
				КонецЕсли;
				
				РаспределениеДоходовФизлица = ДоходыПоПодразделениямИКатегориям.Скопировать(СтруктураПоискаПоФизическомуЛицу);
				РаспределениеДоходовФизлица.Индексы.Добавить(ПоляПоискаПоДатам);
				ДоходыТекущегоРасчета = РаспределениеДоходовФизлица.Скопировать(СтруктураПоискаТекущихДоходов);
				Если Не ОкончательныйРасчет Тогда
					ВсегоДоходовТекущегоРасчета = ДоходыТекущегоРасчета.Итог("СуммаДоходаТекущегоРасчета");
					ДоходыТекущегоРасчетаНерезидента = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Скопировать(СтруктураПоискаТекущихДоходовНерезидентов);
				КонецЕсли;
				
			КонецЕсли;
				                                                                             				
			// Характеристики доходов "текущего" расчета за очередной налоговый период.
			ВсеДатыТекущегоРасчета = Новый Соответствие;
			ВсеКатегорииТекущегоРасчета = Новый Соответствие;
			ДатыТекущегоРасчетаПоМесяцам = Новый Соответствие;
			ТекущийГод = Год(ТекущийНалоговыйПериод);
			Для СчМесяцев = 1 По 12 Цикл
				ДатыТекущегоРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
			КонецЦикла;
			Для каждого СтрокаТЗ Из ДоходыТекущегоРасчета Цикл
				Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
					Продолжить;
				КонецЕсли;
				ВсеДатыТекущегоРасчета.Вставить(СтрокаТЗ.ДатаПолученияДохода, Истина);
				ВсеКатегорииТекущегоРасчета.Вставить(СтрокаТЗ.КатегорияДохода, Истина);
				МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
				ДатыТекущегоРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыТекущегоРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
			КонецЦикла;
			Если ОкончательныйРасчетДляТекущегоФизическогоЛица Тогда
				ДатыРасчетаПоМесяцам = Новый Соответствие;
				ДатаНалоговогоПериода = '00010101';
				Для СчМесяцев = 1 По 12 Цикл
					ДатыРасчетаПоМесяцам.Вставить(СчМесяцев,'00010101');
				КонецЦикла;
				Для каждого СтрокаТЗ Из РаспределениеДоходовФизлица Цикл
					Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
						Продолжить;
					КонецЕсли;
					ДатаНалоговогоПериода = Макс(ДатаНалоговогоПериода, СтрокаТЗ.ДатаПолученияДохода); 
					МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
					ДатыРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
				КонецЦикла;
				
				ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцРасчета)];
				ОсновнаяДатаМесяцаРасчета = ?(Год(МесяцРасчета) = ТекущийГод, ДатыРасчетаПоМесяцам[Месяц(МесяцРасчета)], '00010101');
				
				ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам = Новый Массив;
				ТаблицаРаспределенияКонцаМесяцаРасчета = Новый Массив;
				ТаблицаРаспределенияНалоговогоПериода = Новый Массив;
				Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
					ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				КонецЕсли;
				Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаМесяцаРасчета;
					ТаблицаРаспределенияКонцаМесяцаРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				КонецЕсли;
				Если ЗначениеЗаполнено(ДатаНалоговогоПериода) Тогда
					СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ДатаНалоговогоПериода;
					ТаблицаРаспределенияНалоговогоПериода = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
				Иначе
					ДатаНалоговогоПериода = НачалоДня(КонецМесяца(МесяцРасчета))
				КонецЕсли;
			Иначе
				ОсновнаяДатаТекущегоРасчета = ДатаУдержанияИсчисленногоНалога;
				Если ВсеДатыТекущегоРасчета[ОсновнаяДатаТекущегоРасчета] = Неопределено Тогда
					Для СчМесяцев = 1 По 12 Цикл
						Если ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев]) Тогда
							ОсновнаяДатаТекущегоРасчета = ДатыТекущегоРасчетаПоМесяцам[13 - СчМесяцев];
							Прервать;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				ДатыТекущегоРасчетаНерезидента = Новый Соответствие;
				Для каждого СтрокаТЗ Из ДоходыТекущегоРасчетаНерезидента Цикл
					Если Год(СтрокаТЗ.ДатаПолученияДохода) <> ТекущийГод Тогда
						Продолжить;
					КонецЕсли;
					ДатыТекущегоРасчетаНерезидента.Вставить(Месяц(СтрокаТЗ.ДатаПолученияДохода), СтрокаТЗ.ДатаПолученияДохода);
				КонецЦикла;
			КонецЕсли;
			
			ПродолжатьРасчет = Истина;
			Пока ПродолжатьРасчет Цикл
				
				ТекущаяСтрокаТаблицыДоходов = ДанныеУчетаДоходов[ИндексТекущейСтрокиТаблицыДоходов]; 
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаЗаМесяц Тогда
					
					МесяцНалоговогоПериода = ТекущаяСтрокаТаблицыДоходов.МесяцНалоговогоПериода;
					ПроводитьРасчетЗаОчереднойМесяц = ТекущаяСтрокаТаблицыДоходов.ВсеДоходыЗаМесяц <> 0 Или Не ЭтоРасчетПоДоходамТекущегоМесяца;
					
					// Получаем информацию о статусе налогоплательщика на начало месяца.
					Если ДействующаяИнформацияОСтатусе = Неопределено
						Или Не (МесяцНалоговогоПериода >= ДействующаяИнформацияОСтатусе.ДатаНачала И МесяцНалоговогоПериода <= ДействующаяИнформацияОСтатусе.ДатаОкончания) Тогда
						ДействующаяИнформацияОСтатусе = ИнформацияОСтатусеНалогоплательщика(МесяцНалоговогоПериода, СтрокиТаблицыСтатусов);
					КонецЕсли;	
					
					// Получаем информацию об имеющихся правах на стандартные вычеты.
					Если ДействующаяИнформацияОСтандартныхВычетах = Неопределено 
						Или Не (МесяцНалоговогоПериода >= ДействующаяИнформацияОСтандартныхВычетах.ДатаНачала И МесяцНалоговогоПериода <= ДействующаяИнформацияОСтандартныхВычетах.ДатаОкончания) Тогда
						ДействующаяИнформацияОСтандартныхВычетах = ИнформацияОСтандартныхВычетахДействующихНаДату(МесяцНалоговогоПериода, ПериодСрезаПравНаВычеты, СтрокиТаблицыПравНаВычеты, СтрокиТаблицыПримененияВычетов, ДействующаяИнформацияОСтатусе);	
					КонецЕсли;
					
					ВспомогательнаяТаблицаВычетовМесяца.Очистить();
					ЗаполнитьЗначенияСвойств(СтруктураПоиска,ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаСтандартныхВычетов, ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаИмущественныхВычетов, ТекущаяСтрокаТаблицыДоходов);
					ЗаполнитьЗначенияСвойств(СтруктураПоискаИсчисленного, ТекущаяСтрокаТаблицыДоходов);
					СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = МесяцНалоговогоПериода;
					СтруктураПоискаСтандартныхВычетов.МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода;
								
					// Вписываем во вспомогательную таблицу месяца исчисленные ранее налоги.
					СтрокиНалога = ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного);
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, СтрокиНалога, "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиНалога, ИсчисленныйРанееНалог);					
					
					// Получаем использованный в месяце социальный вычет.
					СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Истина;
					СтрокиПравНаСоциальныеВычеты = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
					ВычетСоциальныйОстаток = ВычетСоциальныйОстаток + ?(СтрокиПравНаСоциальныеВычеты.Количество() > 0 И ДействующаяИнформацияОСтатусе.ПрименяетсяСтавкаПункта1Статьи224НК, СтрокиПравНаСоциальныеВычеты[0].Сумма, 0);
					
					// Создадим набор сумм вычетов, которые могут уменьшить облагаемый доход, начнем с имущественных вычетов.
					СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Приход;
					СтрокиПравНаИмущественныеВычеты = ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаИмущественныхВычетов);
					Для Каждого СтрокаПрав Из СтрокиПравНаИмущественныеВычеты Цикл
						ДобавитьОстатокВычетов(ОстаткиВычетов, СтрокаПрав.КодВычета, СтрокаПрав.Сумма);		
					КонецЦикла;					
					
					// Добавим стандартные вычеты очередного месяца.
					ОблагаемыйДоходНарастающимИтогом = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоходНарастающимИтогом;
					ДоходСПредыдущегоМестаРаботы = 0;
					СтрокиДоходаСПредыдущегоМестаРаботы = ДоходыСПредыдущегоМестаРаботы.НайтиСтроки(СтруктураПоиска);
					Если СтрокиДоходаСПредыдущегоМестаРаботы.Количество() > 0 Тогда
						ДоходСПредыдущегоМестаРаботы = СтрокиДоходаСПредыдущегоМестаРаботы[0].Размер;
					КонецЕсли;	
					ОблагаемыйДоходДляВычетов = ОблагаемыйДоходНарастающимИтогом + ДоходСПредыдущегоМестаРаботы;	
					Для Каждого ТекущийВычет Из ДействующаяИнформацияОСтандартныхВычетах.Вычеты Цикл
						ОписаниеРазмераВычета = РазмерыВычетовНаГод[ТекущийВычет.Ключ];
						Если ОписаниеРазмераВычета = Неопределено Тогда
							Продолжить;
						КонецЕсли;	
						Если ОписаниеРазмераВычета.ОграничениеПоДоходам <> 0 И ОблагаемыйДоходДляВычетов > ОписаниеРазмераВычета.ОграничениеПоДоходам Тогда
							Продолжить;
						КонецЕсли;	
						ДобавитьОстатокВычетов(ОстаткиВычетов, ТекущийВычет.Ключ, ТекущийВычет.Значение * ОписаниеРазмераВычета.Размер, ПрименятьСтандартныеВычетыНарастающимИтогом);	
					КонецЦикла;		
					
					СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Ложь;
					СтрокиСтандартныхВычетов = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
						
					// Перенесем ранее предоставленные при исчислении налога для будущих дат получения дохода вычеты 
					// текущего месяца на тот месяц, когда их предоставили на самом деле.
					// Манипуляции производим с правами на стандартные вычеты и со строками зарегистрированных вычетов.
					Для каждого Элемент Из ОтложенныеПраваНаВычеты Цикл
						ТекущийВычет = Элемент.Ключ;
						Если ТекущийВычет.МесяцНалоговогоПериода = МесяцНалоговогоПериода Тогда
							ДобавитьОстатокВычетов(ОстаткиВычетов, ТекущийВычет.КодВычета, Элемент.Значение, Истина);
							ОтложенныеПраваНаВычеты.Удалить(ТекущийВычет);
						КонецЕсли;
					КонецЦикла;
					Для каждого СтрокаТЗ Из СтрокиСтандартныхВычетов Цикл
						Если СтрокаТЗ.МесяцНалоговогоПериода <= МесяцНалоговогоПериода Тогда
							Продолжить;	
						КонецЕсли;
						Если СтрокаТЗ.Сумма > 0 Тогда
							ОстатокВычета = ТекущиеОстаткиВычетов[СтрокаТЗ.КодВычета];
							Если ОстатокВычета <> Неопределено  Тогда
								ВычетКЗачету = Мин(СтрокаТЗ.Сумма, ОстатокВычета);
								ТекущиеОстаткиВычетов.Вставить(СтрокаТЗ.КодВычета, ОстатокВычета - ВычетКЗачету);
								СтрокаТЗ.МесяцПериодаПредоставленияВычета = СтрокаТЗ.МесяцНалоговогоПериода;
								ОтложенныеПраваНаВычеты.Вставить(СтрокаТЗ, ВычетКЗачету);
							КонецЕсли;
						КонецЕсли;
					КонецЦикла;
					// Если вычеты перенесли, надо обновить зарегистрированные вычеты текущего месяца.
					Если ОтложенныеПраваНаВычеты.Количество() > 0 Тогда
						СтрокиСтандартныхВычетов = ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов);
					КонецЕсли;
					
					// Определим доход, который могут уменьшать вычеты.
					ЗапоминатьВычетыНаБудущее = Ложь;
					ОблагаемыйДоходЗаМесяц = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоходЗаМесяц;
					Если ПрименятьСтандартныеВычетыНарастающимИтогом Тогда
						Если ПереноситьДоходДляПримененияВычетовВМесяцРасчета И МесяцНалоговогоПериода = НачалоМесяца(МесяцРасчета) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц + ВсегоДоходовТекущегоРасчета;
							ЗапоминатьВычетыНаБудущее = Истина;
						ИначеЕсли ПереноситьДоходДляПримененияВычетовВМесяцРасчета И МесяцНалоговогоПериода = НачалоМесяца(ДатаУдержанияИсчисленногоНалога) Тогда
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц - ВсегоДоходовТекущегоРасчета;
						Иначе
							ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток + ОблагаемыйДоходЗаМесяц;
						КонецЕсли;
					Иначе
						ДоходЗаМесяцОстаток = ОблагаемыйДоходЗаМесяц;		
					КонецЕсли;	                                                     
					// Имущественные вычеты не могут уменьшать доходы месяцев, предшествующих месяцу начала применения.
					ДоходЗаМесяцДляИмущественныхВычетов = ОблагаемыйДоходЗаМесяц; 
					
					// Рассчитываем примененные за месяц вычеты.
					ВсегоВычетовЗаМесяц = 0;
					ЕстьВычетыЗаМесяц = Ложь;
					ВычетыЗаМесяц.Очистить();	
					Если ДоходЗаМесяцОстаток > 0 И МесяцНалоговогоПериода <= ТекущаяСтрокаТаблицыДоходов.СтаршийМесяцПолученияДохода Тогда
						
						ВычетСоциальныйЗаМесяц = Мин(ДоходЗаМесяцОстаток, ВычетСоциальныйОстаток);
						ВычетСоциальныйОстаток = ВычетСоциальныйОстаток - ВычетСоциальныйЗаМесяц;
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + ВычетСоциальныйЗаМесяц;
						ЕстьВычетыЗаМесяц = ВычетСоциальныйЗаМесяц <> 0;
						
						ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетСоциальныйЗаМесяц;
						ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - ВычетСоциальныйЗаМесяц;
						// Для расчета имущественных вычетов учтем ранее не учтенные из-за отсутствия дохода в предшествующих месяцах
						// налогового периода вычеты.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < МесяцНалоговогоПериода Тогда
								ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - Мин(ДоходЗаМесяцДляИмущественныхВычетов, Элемент.Значение);
								Если ДоходЗаМесяцДляИмущественныхВычетов = 0 Тогда
									Прервать;
								КонецЕсли;	
							КонецЕсли;
						КонецЦикла;
						
						Если ДоходЗаМесяцОстаток > 0 Тогда
							// Заполняем таблицу значений ВычетыЗаМесяц (с колонками КодВычета, Сумма) суммами вычетов, которые будут
							// применены в текущем месяце. Строки в таблицу помещаем в соответствии с наиболее выгодным для сотрудника
							// приоритетом применения вычетов (описанным непосредственно в справочнике вычетов), для чего. отсортируем
							// таблицу ТаблицаВычетов по полю ПорядокСписания. Применяемые суммы вычетов переписываем из таблицы Остатки,
							// содержащей права на вычеты, в пределах доходов, которые могут быть уменьшены на стандартные, имущественные
							// вычеты. Если положенных физ.лицу вычетов оказывается больше, чем начисленного дохода, в таблице Остатки
							// оказываются суммы неиспользованных в этом месяце вычетов для предоставления их в будущем.
							ОстаткиВычетов.ТаблицаВычетов.Сортировать("ПорядокСписания");
							Для Каждого ВычетКСписанию Из ОстаткиВычетов.ТаблицаВычетов Цикл
								
								Если ДоходЗаМесяцОстаток = 0 И ДоходЗаМесяцДляИмущественныхВычетов = 0 Тогда
									Прервать;
								КонецЕсли;
								Если ВычетКСписанию.ИмущественныйВычет И Не ПроводитьРасчетЗаОчереднойМесяц Тогда 
									Прервать;
								КонецЕсли;
								
								ВычетЗаМесяц = 0;
								ОстатокВычета = ТекущиеОстаткиВычетов[ВычетКСписанию.КодВычета];
								Если ВычетКСписанию.ИмущественныйВычет Тогда 
									Если ДоходЗаМесяцДляИмущественныхВычетов > 0 Тогда
										ВычетЗаМесяц = Мин(ДоходЗаМесяцДляИмущественныхВычетов, ОстатокВычета);	
										ТекущиеОстаткиВычетов.Вставить(ВычетКСписанию.КодВычета, ОстатокВычета - ВычетЗаМесяц);
									КонецЕсли;	
								Иначе	
									ВычетЗаМесяц = Мин(ДоходЗаМесяцОстаток, ОстатокВычета);
									ТекущиеОстаткиВычетов.Вставить(ВычетКСписанию.КодВычета, ОстатокВычета - ВычетЗаМесяц);
								КонецЕсли;	
								Если ВычетЗаМесяц <> 0 Тогда
									СтрокаТаблицыРезультата = ВычетыЗаМесяц.Добавить();	
									СтрокаТаблицыРезультата.КодВычета = ВычетКСписанию.КодВычета;
									СтрокаТаблицыРезультата.РазмерВычета = ВычетЗаМесяц;
									
									ЕстьВычетыЗаМесяц = Истина;
									ДоходЗаМесяцОстаток = ДоходЗаМесяцОстаток - ВычетЗаМесяц;
									ДоходЗаМесяцДляИмущественныхВычетов = ДоходЗаМесяцДляИмущественныхВычетов - Мин(ДоходЗаМесяцДляИмущественныхВычетов, ВычетЗаМесяц);
								КонецЕсли;
								
							КонецЦикла;	
						КонецЕсли;
						
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + ВычетыЗаМесяц.Итог("РазмерВычета");
					КонецЕсли;
					
					// Перенесем некоторые суммы вычетов из других месяцев.
					Если ПроводитьРасчетЗаОчереднойМесяц Тогда 
						// Учтем ранее не учтенные вычеты из-за отсутствия дохода в предшествующих месяцах налогового периода.
						Для каждого Элемент Из ВычетыПредыдущихМесяцев Цикл
							Если Элемент.Ключ < МесяцНалоговогоПериода Тогда
								ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц + Элемент.Значение;
								ВычетыПредыдущихМесяцев.Вставить(Элемент.Ключ, 0);
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;	
					Если ЗапоминатьВычетыНаБудущее Или ЕстьВычетыЗаМесяц И Не ПроводитьРасчетЗаОчереднойМесяц Тогда // Запомним вычеты на будущее.
						ОтложеноВычетовНаБудущее = Макс(ВсегоВычетовЗаМесяц - Макс(ОблагаемыйДоходЗаМесяц, 0), 0);
						ВычетыПредыдущихМесяцев.Вставить(МесяцНалоговогоПериода, ?(ЗначениеЗаполнено(ВычетыПредыдущихМесяцев[МесяцНалоговогоПериода]), ВычетыПредыдущихМесяцев[МесяцНалоговогоПериода], 0) + ОтложеноВычетовНаБудущее);
						ВсегоВычетовЗаМесяц = ВсегоВычетовЗаМесяц - ОтложеноВычетовНаБудущее;
					КонецЕсли;	
					
					ТаблицаРаспределенияВычетов = РаспределениеДоходовФизлица.СкопироватьКолонки();

					НачисленныйДоходЗаДату = 0;
					ИспользованоВычетовЗаМесяц = 0;

					// Начнем расчет с вычитания уже зарегистрированных в учете вычетов, затем по мере расчета вычеты будут
					// "применяться" к конкретным доходам.
					
					// Строки примененных ранее стандартных вычетов отобрали ранее
					ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВспомогательнаяТаблицаВычетовМесяца, СтрокиСтандартныхВычетов);
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиСтандартныхВычетов, ПредоставленныеСтандартныеИСоциальныеВычеты);					
					// Строки примененных ранее имущественных вычетов отберем сейчас.
					СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;
					СтрокиВычетов = ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаИмущественныхВычетов);
					ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВспомогательнаяТаблицаВычетовМесяца, СтрокиВычетов);
					УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, СтрокиВычетов, ИмущественныеВычеты);					
					
				КонецЕсли;	
				
				Если ПроводитьРасчетЗаОчереднойМесяц Тогда
					
					Если ТекущаяСтрокаТаблицыДоходов.ЭтоПерваяСтрокаЗаДату Тогда
						
						ОблагаемыйДоходНаНачалоМесяца = ОблагаемыйДоход;
						ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = 0;
						ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = 0;
						ЕстьДоходыПромежуточногоРасчета = Ложь;
						ЕстьДоходыОкончательногоРасчета = Ложь;
						
						СтруктураПоискаПоДатам.ДатаПолученияДохода = ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода;
						СтруктураПоискаПоДатам.ДоходМежрасчетногоПериода = Истина;
						ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаПоДатам)); 
						СтруктураПоискаПоДатам.ДоходМежрасчетногоПериода = Ложь;
						ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаПоДатам)); 
						
						ТаблицаРаспределенияНаДату = ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода.Скопировать();
						ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета, ТаблицаРаспределенияНаДату);
						Если ТаблицаРаспределенияНаДату.Итог("СуммаДохода") = 0 Тогда
							// если доходов за прошлый месяц нет - будем использовать текущее распределение
							Если ТаблицаРаспределенияМесяцаРасчета = Неопределено Тогда
								ТекущийГод = Год(МесяцРасчета);
								СтруктураПоискаРаспределения = Новый Структура("МесяцНалоговогоПериода");
								БазаРаспределения = 0;
								МесяцПоиска = НачалоМесяца(МесяцРасчета);                                             
								Пока БазаРаспределения = 0 И Год(МесяцПоиска) = ТекущийГод Цикл
									СтруктураПоискаРаспределения.МесяцНалоговогоПериода = МесяцПоиска;
									ТаблицаРаспределенияМесяцаРасчета = РаспределениеДоходовФизлица.Скопировать(РаспределениеДоходовФизлица.НайтиСтроки(СтруктураПоискаРаспределения));
									БазаРаспределения = ТаблицаРаспределенияМесяцаРасчета.Итог("СуммаДохода");
									МесяцПоиска = ДобавитьМесяц(МесяцПоиска, -1);
								КонецЦикла;
							КонецЕсли;
							ТаблицаРаспределенияНаДату = ТаблицаРаспределенияМесяцаРасчета;
						КонецЕсли;
						ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДату, ТаблицаРаспределенияВычетов);
						
					КонецЕсли;	
					
					НачисленныйДоходЗаДату = ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход;
					Если ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода Тогда 
						Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаДату Тогда
							ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
							ЕстьДоходыПромежуточногоРасчета = Истина;
						ИначеЕсли ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход >= ВсегоВычетовЗаМесяц Тогда
							ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
							ЕстьДоходыПромежуточногоРасчета = Истина;
						Иначе
							ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
							ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода.Очистить();
						КонецЕсли;
					Иначе
						ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета = Мин(ОблагаемыйДоходНарастающимИтогом, Макс(0, ОблагаемыйДоходНаНачалоМесяца + ТекущаяСтрокаТаблицыДоходов.ОблагаемыйДоход - ВсегоВычетовЗаМесяц));
						ЕстьДоходыОкончательногоРасчета = Истина;
					КонецЕсли;

					Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаДату Тогда
						
						// Расчет сумм налога
						Если Не ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаМесяц Тогда					
							Если ЕстьДоходыПромежуточногоРасчета Тогда
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
								НалогСДохода = Макс(Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный, 0);
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Макс(Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный, 0);
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
							КонецЕсли;
							Если ЕстьДоходыОкончательногоРасчета Тогда
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный;
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
							КонецЕсли;
						Иначе
							Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета);
								НалогСДохода = Макс(Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный, 0);
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Макс(Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный, 0);
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода);
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный;
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета);
								
								ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
								
							Иначе
								
								ОблагаемыйДоходДляИсчисленияНалога = Макс(0, ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета);
								НалогСДохода = Окр(Мин(ОблагаемыйДоходДляИсчисленияНалога, ПределПрогрессивнойШкалы) * СтавкаДляРезидента) - НалогИсчисленный;
								НалогИсчисленный = НалогИсчисленный + НалогСДохода;
								НалогСПревышения = Окр(Макс(ОблагаемыйДоходДляИсчисленияНалога - ПределПрогрессивнойШкалы, 0) * СтавкаСПревышения) - НалогСПревышенияИсчисленный;
								НалогСПревышенияИсчисленный = НалогСПревышенияИсчисленный + НалогСПревышения;
								
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСДохода, ТекущаяСтрокаТаблицыДоходов, ?(ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета));
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогСПревышения, ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода, НалогСПревышения, ТекущаяСтрокаТаблицыДоходов, ?(ТекущаяСтрокаТаблицыДоходов.ДоходМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамМежрасчетногоПериода, ТаблицаРаспределенияНаДатуПоДоходамОкончательногоРасчета));
								
								ОблагаемыйДоход = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;	
							КонецЕсли;
						КонецЕсли;
						Если ВсеДатыТекущегоРасчета[ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода] = Неопределено Тогда
							СтрокиКУдалению.Очистить();
							РассчитаноНалогаЗаДату = 0;
							РассчитаноНалогаСПревышенияЗаДату = 0;
							Для каждого СтрокаНалога Из ВспомогательнаяТаблицаМесяца Цикл
								Если СтрокаНалога.МесяцНалоговогоПериода = ТекущаяСтрокаТаблицыДоходов.ДатаПолученияДохода Тогда
									РассчитаноНалогаЗаДату = РассчитаноНалогаЗаДату + СтрокаНалога.НалогПоСтавке13;
									РассчитаноНалогаСПревышенияЗаДату = РассчитаноНалогаСПревышенияЗаДату + СтрокаНалога.НалогСПревышения;
									СтрокиКУдалению.Вставить(СтрокаНалога);
								КонецЕсли;
							КонецЦикла;
							Если РассчитаноНалогаЗаДату * РассчитаноНалогаЗаДату + РассчитаноНалогаСПревышенияЗаДату * РассчитаноНалогаСПревышенияЗаДату = 0 Тогда
								Для Каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
									ВспомогательнаяТаблицаМесяца.Удалить(УдаляемаяСтрока.Ключ);		
								КонецЦикла;	
							КонецЕсли;
						КонецЕсли;
						
						Если ЕстьДоходыПромежуточногоРасчета И ЕстьДоходыОкончательногоРасчета Тогда
							ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
						Иначе
							ОблагаемыйДоходЗаДату = ОблагаемыйДоходНаКонецМесяцаПромежуточногоРасчета + ОблагаемыйДоходНаКонецМесяцаОкончательногоРасчета;
						КонецЕсли;
						ВсегоВычетовЗаДату = НачисленныйДоходЗаДату - (ОблагаемыйДоходЗаДату - ОблагаемыйДоходНаНачалоМесяца) - ИспользованоВычетовЗаМесяц;
						ИспользованоВычетовЗаМесяц = ИспользованоВычетовЗаМесяц + ВсегоВычетовЗаДату;
						
						Если ВсегоВычетовЗаДату <> 0 Тогда
								
							// Таблица ВычетыЗаМесяц содержит строки с располагаемыми суммами вычетов, упорядоченные в соответствии с
							// наиболее выгодным для сотрудника приоритетом применения вычетов. Переписываем вычеты из таблицы ВычетыЗаМесяц
							// в таблицу ВспомогательнаяТаблицаВычетовМесяца (распределяя суммы по подразделениям из доходов этой даты
							// получения дохода) в пределах рассчитанного ранее примененного за дату вычета (если сумма вычета и остаток
							// вычета на дату одного знака, берем минимальное по модулю). Если располагаемая сумма вычета полностью исчерпана
							// (стала равна 0), удаляем строку из таблицы ВычетыЗаМесяц.
							ИндексПоследнейСтрокиТаблицыВычетов = ВычетыЗаМесяц.Количество() - 1;
							Индекс = 0;
							Пока Индекс <= ИндексПоследнейСтрокиТаблицыВычетов Цикл		
								ТекущийВычет = ВычетыЗаМесяц[Индекс];
								ЗначениеВычетаЗаМесяц = ТекущийВычет.РазмерВычета;
								Если ВсегоВычетовЗаДату * ЗначениеВычетаЗаМесяц > 0 Тогда		
									Учтено = ?(ВсегоВычетовЗаДату > 0, Мин(ЗначениеВычетаЗаМесяц, ВсегоВычетовЗаДату), Макс(ЗначениеВычетаЗаМесяц, ВсегоВычетовЗаДату));
									ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаВычетовМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению, '00010101', Учтено, ТекущаяСтрокаТаблицыДоходов, ТаблицаРаспределенияНаДату, ТекущийВычет);
									ВсегоВычетовЗаДату = ВсегоВычетовЗаДату - Учтено;
									ТекущийВычет.РазмерВычета = ЗначениеВычетаЗаМесяц - Учтено;
									Если ТекущийВычет.РазмерВычета = 0 Тогда
										ВычетыЗаМесяц.Удалить(Индекс);
										ИндексПоследнейСтрокиТаблицыВычетов = ИндексПоследнейСтрокиТаблицыВычетов - 1;
										Индекс = Индекс - 1;
									КонецЕсли;
									Если ВсегоВычетовЗаДату = 0 Тогда
										Прервать;
									КонецЕсли;
								КонецЕсли;	
								Индекс = Индекс + 1;
							КонецЦикла;
							
							// Проверим не были ли ранее зарегистрированы в учете предоставленные сейчас вычеты;
							// если были, то при нулевом итоге таблицу очистим, а со следующей даты начнем накапливать вычеты "с чистого листа".
							Если ВспомогательнаяТаблицаВычетовМесяца.Итог("РазмерВычета") = 0 Тогда
								ИтогиПоВычетам = Новый Соответствие;
								Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									Значение = ИтогиПоВычетам[СтрокаТЗ.КодВычета];
									ИтогиПоВычетам.Вставить(СтрокаТЗ.КодВычета, ?(Значение = Неопределено, 0, Значение) + СтрокаТЗ.РазмерВычета)
								КонецЦикла;
								Если ИтогиПоВычетам.Количество() = 1 Тогда
									ВспомогательнаяТаблицаВычетовМесяца.Очистить();
								Иначе
									СтрокиКУдалению.Очистить();
									Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
										Если Не ЗначениеЗаполнено(ИтогиПоВычетам[СтрокаТЗ.КодВычета]) Тогда
											СтрокиКУдалению.Вставить(СтрокаТЗ, Истина)
										КонецЕсли;	
									КонецЦикла;
									Для каждого Элемент Из СтрокиКУдалению Цикл
										ВспомогательнаяТаблицаВычетовМесяца.Удалить(Элемент.Ключ)
									КонецЦикла;
								КонецЕсли;
							КонецЕсли;
						КонецЕсли;
						
					КонецЕсли;	
					
				КонецЕсли;	
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаМесяц Тогда				
					
					// Окончательный сбор вычетов в собственной таблице значений.
					
					Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
						Если Не ОписаниеВычетов[СтрокаТЗ.КодВычета].ИмущественныйВычет Тогда
							СтрокаТЗ.МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода
						КонецЕсли;
					КонецЦикла; 
					
					// Определяем дату получения дохода, к строке которой будут приписаны вычеты этого месяца.
					Если ОкончательныйРасчетДляТекущегоФизическогоЛица Тогда
						Если ПроводитьРасчетЗаОчереднойМесяц Тогда
							ДатаУчетаВычетов = КонецМесяца(МесяцНалоговогоПериода)
						Иначе
							ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)];
							Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаПолученияДохода;
							ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
							ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
								ДатаУчетаВычетов = ОсновнаяДатаМесяцаРасчета;
							Иначе
								ДатаУчетаВычетов = ДатаНалоговогоПериода;
							КонецЕсли;
						КонецЕсли;
					Иначе
						ДатаУчетаВычетов = ОсновнаяДатаТекущегоРасчета;
					КонецЕсли;
					
					Если ЕстьВычетыЗаМесяц Тогда // Перераспределим итоговые суммы предоставленных вычетов по категориям, сохраняя подразделения.
						
						// Доходов в месяце может не быть, но вычеты приходится предоставлять, распределим их по доходам текущего расчета.
						Если Не ЗначениеЗаполнено(ТаблицаРаспределенияВычетов) Тогда
							Если ОкончательныйРасчетДляТекущегоФизическогоЛица Тогда
								Если ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам;
								ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчета) Тогда
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияКонцаМесяцаРасчета;
								Иначе
									ТаблицаРаспределенияВычетов = ТаблицаРаспределенияНалоговогоПериода;
								КонецЕсли;
							Иначе
								СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаТекущегоРасчета;
								ТаблицаРаспределенияВычетов = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							КонецЕсли;
						КонецЕсли;
						Если ЗначениеЗаполнено(ВычетыЗаМесяц) Тогда
							БылоСтрокВычетов = ВспомогательнаяТаблицаВычетовМесяца.Количество();
							Для Каждого ТекущийВычет Из ВычетыЗаМесяц Цикл
								ВписатьРесурсВРезультатыРасчетов(ВспомогательнаяТаблицаВычетовМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоПодразделению, '00010101', ТекущийВычет.РазмерВычета, СтруктураПоиска, ТаблицаРаспределенияВычетов, ТекущийВычет);
							КонецЦикла;	
							Для Сч = БылоСтрокВычетов + 1 По ВспомогательнаяТаблицаВычетовМесяца.Количество() Цикл
								ВспомогательнаяТаблицаВычетовМесяца[Сч - 1].МесяцПериодаПредоставленияВычета = МесяцНалоговогоПериода
							КонецЦикла;
						КонецЕсли;
						
						ВычетыМесяца = ВспомогательнаяТаблицаВычетовМесяца.СкопироватьКолонки();
						
						ВспомогательнаяТаблицаВычетовМесяца.ЗаполнитьЗначения(ДатаУчетаВычетов, "МесяцНалоговогоПериода");
						ВспомогательнаяТаблицаВычетовМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода, КодВычета", "РазмерВычета");
						Если ВспомогательнаяТаблицаВычетовМесяца.Количество() > 0 Тогда
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица = ВспомогательнаяТаблицаВычетовМесяца.Скопировать( ,"Подразделение");
							ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Свернуть("Подразделение");
							Если ВспомогательнаяТаблицаВычетовМесяцаФизическогоЛица.Количество() = 1 Тогда
								Для каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									Если СтрокаТЗ.РазмерВычета <> 0 Тогда
										ВписатьРесурсВРезультатыРасчетов(ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатаУчетаВычетов, СтрокаТЗ.РазмерВычета, СтруктураПоиска, ТаблицаРаспределенияВычетов, СтрокаТЗ);
									КонецЕсли;
								КонецЦикла;
							Иначе 	
								ТаблицаДляРаспределенияПоПодразделению = ТаблицаРаспределенияВычетов.СкопироватьКолонки();
								СтрокиРаспределенияПоПодразделениям = Новый Соответствие;
								Для Каждого СтрокаТаблицыРаспределения Из ТаблицаРаспределенияВычетов Цикл
									СтрокиРаспределения = СтрокиРаспределенияПоПодразделениям[СтрокаТаблицыРаспределения.Подразделение];
									Если СтрокиРаспределения = Неопределено Тогда
										СтрокиРаспределения = Новый Массив;
										СтрокиРаспределенияПоПодразделениям.Вставить(СтрокаТаблицыРаспределения.Подразделение, СтрокиРаспределения);
									КонецЕсли;	
									СтрокиРаспределения.Добавить(СтрокаТаблицыРаспределения);
								КонецЦикла;	
								Для Каждого СтрокаТЗ Из ВспомогательнаяТаблицаВычетовМесяца Цикл
									СтрокиРаспределения = СтрокиРаспределенияПоПодразделениям[СтрокаТЗ.Подразделение];
									Если СтрокиРаспределения = Неопределено Тогда
										ТаблицаРаспределения = ТаблицаРаспределенияВычетов.СкопироватьКолонки();
									Иначе
										ТаблицаРаспределения = ТаблицаРаспределенияВычетов.Скопировать(СтрокиРаспределения);
									КонецЕсли;	
									ВписатьРесурсВРезультатыРасчетов(ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатаУчетаВычетов, СтрокаТЗ.РазмерВычета, СтруктураПоиска, ТаблицаРаспределения, СтрокаТЗ);
								КонецЦикла;
							КонецЕсли;
						КонецЕсли;
						
					Иначе // У сторно-строк вычетов оставим имевшиеся ранее подразделения и категории.
						ВычетыМесяца = ВспомогательнаяТаблицаВычетовМесяца.Скопировать();
						Если ВспомогательнаяТаблицаВычетовМесяца.Количество() > 0 Тогда 
							ВычетыМесяца.ЗаполнитьЗначения(ДатаУчетаВычетов, "МесяцНалоговогоПериода");
						КонецЕсли;
					КонецЕсли;
					
					ВычетыМесяца.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода, КодВычета", "РазмерВычета");
					
					// Если у физ.лица также есть доходы, облагаемые не нарастающим итогом, - добавим и их тоже.
					ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельноПоФизическомуЛицу = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.НайтиСтроки(СтруктураПоиска);
					ДописыватьОсновнуюДатуПолученияДохода = Не ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)]);
					Для Каждого СтрокаТЗ Из ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельноПоФизическомуЛицу Цикл
						НалогСДохода = Окр(СтрокаТЗ.ДоходыБезВычетов * СтрокаТЗ.СтавкаЧислом);
						СтрокаНалога = ВспомогательнаяТаблицаМесяца.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаНалога, СтрокаТЗ, "ФизическоеЛицо, Подразделение, КатегорияДохода");
						СтрокаНалога.НалогПоСтавке13 = НалогСДохода;
						СтрокаНалога.МесяцНалоговогоПериода = СтрокаТЗ.ДатаПолученияДохода;
						ВсеКатегорииТекущегоРасчета.Вставить(СтрокаТЗ.КатегорияДохода, Истина);
						ВсеДатыТекущегоРасчета.Вставить(СтрокаТЗ.ДатаПолученияДохода, Истина);
						Если ДописыватьОсновнуюДатуПолученияДохода И СтрокаТЗ.ДоходТекущегоРасчета Тогда
							МесяцДаты = Месяц(СтрокаТЗ.ДатаПолученияДохода);
							ДатыТекущегоРасчетаПоМесяцам.Вставить(МесяцДаты, Макс(ДатыТекущегоРасчетаПоМесяцам[МесяцДаты], СтрокаТЗ.ДатаПолученияДохода));
						КонецЕсли;
						ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Удалить(СтрокаТЗ);
					КонецЦикла;	
					
					// В "межрасчетном" варианте оставляем только те результаты, которые соответствуют месяцу (-ам) получения дохода
					// текущего акта расчета.
					Если Не ОкончательныйРасчетДляТекущегоФизическогоЛица И Не ЗначениеЗаполнено(ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)]) И Не ЗначениеЗаполнено(ДатыТекущегоРасчетаНерезидента[Месяц(МесяцНалоговогоПериода)]) Тогда
						
						// В итоговую таблицу запишем только вычеты.
						ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
						
						Если МесяцНалоговогоПериода < КонецМесяца(МесяцРасчета) И ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") + ВспомогательнаяТаблицаМесяца.Итог("НалогСПревышения") = 0 Тогда
							Для каждого СтрокаВычета Из ВычетыМесяца Цикл
								ДобавлятьРезультатМесяцаВИтогиФизлица = СтрокаВычета.РазмерВычета <> 0;
								Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
									Прервать;
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
						
						// Минимизируем появление отсутствующих в текущих доходах категорий дохода.
						Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
							
							ДатаМесяца = ОсновнаяДатаТекущегоРасчета;
							СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаТекущегоРасчета;
							ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							
							ДатыПодразделенияКатегории = ВспомогательныеДатыПодразделенияКатегории.СкопироватьКолонки();
							НаборИзмерений = ВычетыМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							НаборИзмерений.Свернуть("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НаборИзмерений, ДатыПодразделенияКатегории);
							Для каждого СтрокаТЗ Из ДатыПодразделенияКатегории Цикл
								СтрокаТЗ.ЗаменятьДатуПолученияДохода = Истина;
								СтрокаТЗ.ЗаменятьКатегориюДохода = ВсеКатегорииТекущегоРасчета[СтрокаТЗ.КатегорияДохода] = Неопределено;
								СтрокаТЗ.ЗаменятьПодразделение = МесяцНалоговогоПериода >= НачалоМесяца(МесяцРасчета) И НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода) = НачалоМесяца(ДатаМесяца);
								СтрокаТЗ.Распределение = ТаблицаРаспределенияТекущегоМесяца;
								Если ОсобыеКатегорииДохода[СтрокаТЗ.КатегорияДохода] = Истина Тогда
									СтрокаТЗ.ЗаменятьПодразделение = Ложь;
									СтрокаТЗ.ЗаменятьКатегориюДохода = Ложь;
								ИначеЕсли СтрокаТЗ.ЗаменятьПодразделение Тогда 	
									СтруктураПоискаПоДатамИПодразделениям.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
									СтруктураПоискаПоДатамИПодразделениям.Подразделение = СтрокаТЗ.Подразделение;
									СтрокаТЗ.ЗаменятьПодразделение = ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаПоДатамИПодразделениям).Количество() = 0;
								КонецЕсли;
							КонецЦикла;
							Если ДатыПодразделенияКатегории.Количество() > 2 Тогда
								ДатыПодразделенияКатегории.Индексы.Добавить("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
							КонецЕсли;
							
							ВспомогательнаяТаблицаВычетовМесяца.Очистить();
							ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаВычетовМесяца, ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатыПодразделенияКатегории, ДатаМесяца, "МесяцПериодаПредоставленияВычета, КодВычета");
							
							// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
							ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаМесяца.СкопироватьКолонки(), ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов);
						КонецЕсли;
						
						ВспомогательнаяТаблицаМесяца.Очистить();
						
					Иначе 
					
						ИсчисленоНДФЛЗаГод = ИсчисленоНДФЛЗаГод + ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") + ВспомогательнаяТаблицаМесяца.Итог("НалогСПревышения");
						
						Если ПроводитьРасчетЗаОчереднойМесяц Тогда
							
							// Вычеркнем из результата строки по переброске некоторой суммы с одной категории на другую.
							ТаблицаМесяцаБезКатегорийДохода = ВспомогательнаяТаблицаМесяца.Скопировать();
							ТаблицаМесяцаБезКатегорийДохода.Свернуть("МесяцНалоговогоПериода, Подразделение", "НалогПоСтавке13, НалогСПревышения");
							Для каждого СтрокаТЗ Из ТаблицаМесяцаБезКатегорийДохода Цикл
								Если СтрокаТЗ.НалогПоСтавке13 = 0 Или СтрокаТЗ.НалогСПревышения = 0 Тогда
									СтрокиКОбнулению = ВспомогательнаяТаблицаМесяца.НайтиСтроки(Новый Структура("МесяцНалоговогоПериода, Подразделение", СтрокаТЗ.МесяцНалоговогоПериода, СтрокаТЗ.Подразделение));
									Если СтрокаТЗ.НалогПоСтавке13 = 0 И СтрокаТЗ.НалогСПревышения = 0 Тогда
										Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
											ВспомогательнаяТаблицаМесяца.Удалить(СтрокаКОбнулению);
										КонецЦикла; 	
									ИначеЕсли СтрокаТЗ.НалогПоСтавке13 = 0 Тогда
										Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
											 СтрокаКОбнулению.НалогПоСтавке13 = 0
										КонецЦикла; 	
									Иначе	
										Для каждого СтрокаКОбнулению Из СтрокиКОбнулению Цикл
											 СтрокаКОбнулению.НалогСПревышения = 0
										КонецЦикла; 	
									КонецЕсли;
								КонецЕсли;
							КонецЦикла;
							
							// Минимизируем появление отсутствующих в текущих доходах дат получения и категорий дохода:
							// 1. Определяем подходящую дату получения дохода и соответствующее ей распределение
							// при этом некоторые результаты расчетов могут быть проигнорированы совсем.
							ДобавлятьРезультатМесяцаВИтогиФизлица = Истина;
							ОсновнаяДатаПолученияДохода = ДатыТекущегоРасчетаПоМесяцам[Месяц(МесяцНалоговогоПериода)];
							Если ОкончательныйРасчетДляТекущегоФизическогоЛица Тогда
								Если Не ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда // перерасчет налога при отсутствии дохода текущего акта расчета
									Если МесяцРасчета < УчетНДФЛ.ДатаЗакона263ФЗ() И МесяцНалоговогоПериода > КонецМесяца(МесяцРасчета) Тогда // перерасчет по будущим доходам не производим
										ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
									ИначеЕсли МесяцРасчета >= УчетНДФЛ.ДатаЗакона263ФЗ() И МесяцНалоговогоПериода > ?(ЗначениеЗаполнено(ДатаУдержанияИсчисленногоНалога), КонецМесяца(ДатаУдержанияИсчисленногоНалога), ПоследнийМесяцНалоговогоПериода) Тогда // перерасчет по будущим доходам не производим
										ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
									ИначеЕсли ВспомогательнаяТаблицаМесяца.Итог("НалогПоСтавке13") = 0 И ВспомогательнаяТаблицаМесяца.Итог("НалогСПревышения") = 0 И МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Тогда // нашли предшествующий месяц с нулевым налогом
										ВычетыДляПроверки = ВычетыМесяца.Скопировать(, "КодВычета, РазмерВычета");
										ВычетыДляПроверки.Свернуть("КодВычета", "РазмерВычета");
										ЕстьДанныеМесяца = Ложь;
										Для каждого СтрокаТЗ Из ВычетыДляПроверки Цикл
											ЕстьДанныеМесяца = СтрокаТЗ.РазмерВычета <> 0;
											Если ЕстьДанныеМесяца Тогда
												Прервать;
											КонецЕсли;
										КонецЦикла;
										Если Не ЕстьДанныеМесяца Тогда // игнорируем различные переброски сумм одного вычета, но не между вычетами 
											ДобавлятьРезультатМесяцаВИтогиФизлица = Ложь;
											ВспомогательнаяТаблицаМесяца.Очистить();
										КонецЕсли;
									КонецЕсли;
								КонецЕсли;
								Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
									Если МесяцНалоговогоПериода < НачалоМесяца(?(ЭтоРасчетПоДоходамТекущегоМесяца, ДатаУдержанияИсчисленногоНалога, МесяцРасчета)) Тогда
										Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
											ДатаМесяца = ОсновнаяДатаПолученияДохода;
											СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
											ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
										ИначеЕсли ЗначениеЗаполнено(ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам) Тогда
											ДатаМесяца = ОсновнаяДатаМесяцаРасчетаПоТекущимДоходам;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияМесяцаРасчетаПоТекущимДоходам;
										Иначе
											ДатаМесяца = ДатаНалоговогоПериода;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияНалоговогоПериода;
										КонецЕсли;
									Иначе
										Если ЗначениеЗаполнено(ОсновнаяДатаПолученияДохода) Тогда
											ДатаМесяца = ОсновнаяДатаПолученияДохода;
											СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
											ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
										Иначе
											ДатаМесяца = ДатаНалоговогоПериода;
											ТаблицаРаспределенияТекущегоМесяца = ТаблицаРаспределенияНалоговогоПериода;
										КонецЕсли;
									КонецЕсли;
								КонецЕсли;
							Иначе	
								ДатаМесяца = ОсновнаяДатаПолученияДохода;
								СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = ОсновнаяДатаПолученияДохода;
								ТаблицаРаспределенияТекущегоМесяца = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
							КонецЕсли;
							Если ДобавлятьРезультатМесяцаВИтогиФизлица Тогда
								
								// 2. Заменяем даты получения дохода на подходящую и пересматриваем категорию дохода
								ДатыПодразделенияКатегории = ВспомогательныеДатыПодразделенияКатегории.СкопироватьКолонки();
								НаборИзмерений = ВспомогательнаяТаблицаМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВычетыМесяца.Скопировать(, "МесяцНалоговогоПериода, КатегорияДохода, Подразделение"), НаборИзмерений);
								НаборИзмерений.Свернуть("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НаборИзмерений, ДатыПодразделенияКатегории);
								Для каждого СтрокаТЗ Из ДатыПодразделенияКатегории Цикл
									СтрокаТЗ.ЗаменятьДатуПолученияДохода = ВсеДатыТекущегоРасчета[СтрокаТЗ.МесяцНалоговогоПериода] = Неопределено;
									СтрокаТЗ.ЗаменятьКатегориюДохода = ВсеКатегорииТекущегоРасчета[СтрокаТЗ.КатегорияДохода] = Неопределено;
									СтрокаТЗ.ЗаменятьПодразделение = МесяцНалоговогоПериода < НачалоМесяца(МесяцРасчета) Или МесяцНалоговогоПериода >= НачалоМесяца(МесяцРасчета) И НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода) = НачалоМесяца(ДатаМесяца);
									Если ОсобыеКатегорииДохода[СтрокаТЗ.КатегорияДохода] = Истина Тогда
										СтрокаТЗ.ЗаменятьПодразделение = Ложь;
										СтрокаТЗ.ЗаменятьКатегориюДохода = Ложь;
									ИначеЕсли СтрокаТЗ.ЗаменятьПодразделение Тогда 	
										СтруктураПоискаПоДатамИПодразделениям.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
										СтруктураПоискаПоДатамИПодразделениям.Подразделение = СтрокаТЗ.Подразделение;
										СтрокаТЗ.ЗаменятьПодразделение = ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаПоДатамИПодразделениям).Количество() = 0;
									КонецЕсли;
									Если СтрокаТЗ.ЗаменятьДатуПолученияДохода Тогда
										СтрокаТЗ.Распределение = ТаблицаРаспределенияТекущегоМесяца;
									Иначе
										СтруктураПоискаТолькоПоДатам.ДатаПолученияДохода = СтрокаТЗ.МесяцНалоговогоПериода;
										СтрокаТЗ.Распределение = ДоходыТекущегоРасчета.Скопировать(ДоходыТекущегоРасчета.НайтиСтроки(СтруктураПоискаТолькоПоДатам)); 
									КонецЕсли;
								КонецЦикла;
								Если ДатыПодразделенияКатегории.Количество() > 2 Тогда
									ДатыПодразделенияКатегории.Индексы.Добавить("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
								КонецЕсли;
								
								ВспомогательнаяТаблицаФизическогоЛица.Очистить();
								ВспомогательнаяТаблицаПоДоходамПревышения.Очистить();
								ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаПоДоходамПревышения);
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаМесяца, ПараметрыЗаполненияРесурсаНалогПоСтавке13, ДатыПодразделенияКатегории, ДатаМесяца);
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаПоДоходамПревышения, ПараметрыЗаполненияРесурсаНалогСПревышения, ДатыПодразделенияКатегории, ДатаМесяца);
								ВспомогательнаяТаблицаМесяца.Очистить();
								ВспомогательнаяТаблицаВычетовМесяца.Очистить();
								ЗаменитьДатыПодразделенияКатегории(ВспомогательнаяТаблицаВычетовМесяца, ВычетыМесяца, ПараметрыЗаполненияРесурсаСуммаВычетаПоКатегории, ДатыПодразделенияКатегории, ДатаМесяца, "МесяцПериодаПредоставленияВычета, КодВычета");
								
								// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
								ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаФизическогоЛица, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов);
							КонецЕсли;
							
						Иначе
							
							// Перенесем результат расчета месяца в основную таблицу с результатом расчета.
							ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, СтрокиНДФЛЗаГод, ВспомогательнаяТаблицаМесяца, ВычетыМесяца, ОписаниеВычетов);
							ВспомогательнаяТаблицаМесяца.Очистить();
							
						КонецЕсли;
						
					КонецЕсли;
					
				КонецЕсли;		
				
				Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаЗаГод Тогда
					Если ИсчисленоНДФЛЗаГод <> 0 Тогда
						// вписываем зачтенные авансовые платежи иностранцев
						ВписатьАвансовыеПлатежиВРезультатРасчета2024(СтрокиНДФЛЗаГод, ОстаткиПоАвансовымПлатежам, ИсчисленоНДФЛЗаГод, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
					Иначе // игнорируем различные переброски сумм одного вычета, но не между вычетами
						НетДанных = Истина;
						Для каждого ЭлементОписания Из ОписаниеВычетов Цикл
							ИмяКолонки = ЭлементОписания.Значение.ИмяКолонки;
							СуммаВычета = 0; ЕстьЗначенияВКолонке = Ложь;
							Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
								СуммаВычета = СуммаВычета + СтрокаРезультата[ИмяКолонки];
								ЕстьЗначенияВКолонке = ЕстьЗначенияВКолонке Или СтрокаРезультата[ИмяКолонки] <> 0
							КонецЦикла;
							Если ЕстьЗначенияВКолонке И СуммаВычета = 0 Тогда
								Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
									Если ИмяКолонки = "ПримененныйВычетЛичный" Тогда
										СтрокаРезультата.КодВычетаЛичный = ""	
									КонецЕсли;
									СтрокаРезультата[ИмяКолонки] = 0
								КонецЦикла;
							КонецЕсли;
							НетДанных = НетДанных И СуммаВычета = 0;
						КонецЦикла;
						Если НетДанных Тогда // удаляем незначащие строки за год из результата
							Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
								РезультатРасчетаВспомогательный.Удалить(СтрокаРезультата)
							КонецЦикла;
						КонецЕсли;
					КонецЕсли;
					ПродолжатьРасчет = Ложь;
				Иначе
					ИндексТекущейСтрокиТаблицыДоходов = ИндексТекущейСтрокиТаблицыДоходов + 1;
				КонецЕсли;	
				
			КонецЦикла;  // по налоговым периодам физ.лиц
			
			Если ТекущаяСтрокаТаблицыДоходов.ЭтоПоследняяСтрокаПоФизическомуЛицу Тогда // заканчиваем обработку физ.лица
				Если ОкончательныйРасчет Тогда
					// Допишем учтенные в расчете документы-основания.
					ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
					СоответствиеФизическихЛиц.Удалить(ТекущееФизическоеЛицо);
				Иначе
					// Перенесем результаты расчета в основную таблицу с учетом ограничений.
					ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета, ВсегоДоходовТекущегоРасчета + ДоходыТекущегоРасчетаНерезидента.Итог("ДоходыБезВычетов"));	
				КонецЕсли;
			КонецЕсли;	
			
			ИндексТекущейСтрокиТаблицыДоходов = ИндексТекущейСтрокиТаблицыДоходов + 1;
			
		КонецЦикла;	
		
	КонецЕсли;
	
	// Продолжим расчет по нерезидентам.
	СтрокОтдельныхСумм = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно.Количество();
	Если СтрокОтдельныхСумм > 0 Тогда

		ИндексОбрабатываемойСтроки = 0;
		ТекущееФизическоеЛицо = Неопределено;
		ТекущийНалоговыйПериод = '00010101';
		МесяцНалоговогоПериодаПредыдущейСтроки = '00010101';
		СтруктураПоискаСтандартныхВычетов.ЭтоСоциальныйВычет = Ложь;
		СтруктураПоискаИмущественныхВычетов.ВидДвижения = ВидДвиженияНакопления.Расход;
		// Если выполняется окончательный расчет, будем вписывать результат расчета сразу в таблицы результата.
		// В случае с промежуточным расчетом будем использовать промежуточную таблицу, а потом переносить в результирующую с
		// учетом ограничений.
		Если Не ОкончательныйРасчет Тогда
			РезультатРасчетаВспомогательный = РезультатРасчета.СкопироватьКолонки();
		КонецЕсли;	
		
		Пока ИндексОбрабатываемойСтроки <= СтрокОтдельныхСумм - 1 Цикл
			
			ТекущаяСтрока = ДоходыДляРасчетаНалогаПоКаждойСуммеОтдельно[ИндексОбрабатываемойСтроки];
			
			Если ТекущаяСтрока.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда 
				
				Если ТекущееФизическоеЛицо <> Неопределено Тогда  // Завершение обработки предыдущего физлица.
					
					// вычтем ранее исчисленное
					СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
					Для СчМесяцев = 1 По Месяц(МесяцНалоговогоПериодаПредыдущейСтроки) Цикл
						СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев - 1);
						ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
					КонецЦикла;
					
					// впишем засчитываемые авансовые платежи
					ВписатьАвансовыеПлатежиВРезультатРасчета2024(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
					
					// перепишем результаты за последний налоговый период
					ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов, Месяц(МесяцНалоговогоПериодаПредыдущейСтроки));
					
					// окончательно доработаем результаты
					Если ОкончательныйРасчет Тогда
						Если СоответствиеФизическихЛиц[ТекущееФизическоеЛицо] <> Неопределено Тогда // Допишем учтенные в расчете документы-основания.
							СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
							ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
						КонецЕсли;
					Иначе
						ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета);	
					КонецЕсли;
					
				КонецЕсли;
				
				ТекущееФизическоеЛицо = ТекущаяСтрока.ФизическоеЛицо; // Начало обработки очередного физлица.
				ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода);
				ВспомогательнаяТаблицаМесяца.Очистить();
				Если Не ОкончательныйРасчет Тогда
					РезультатРасчетаВспомогательный.Очистить();
				КонецЕсли;	
				ЗаполнитьЗначенияСвойств(СтруктураПоискаСтандартныхВычетов, ТекущаяСтрока);
				ЗаполнитьЗначенияСвойств(СтруктураПоискаИмущественныхВычетов, ТекущаяСтрока);
			
			КонецЕсли;
			
			Если ТекущийНалоговыйПериод <> НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода) Тогда
				
				// Завершение обработки предыдущего налогового периода.
				
				// вычтем ранее исчисленное
				СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
				Для СчМесяцев = 0 По 11 Цикл
					СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев);
					ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
				КонецЦикла;
				
				// впишем засчитываемые авансовые платежи
				ВписатьАвансовыеПлатежиВРезультатРасчета2024(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
				
				// перепишем результаты за налоговый период
				ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов);
				
				// Начало обработки очередного налогового периода.
				
				ТекущийНалоговыйПериод = НачалоГода(ТекущаяСтрока.МесяцНалоговогоПериода); 
				ВспомогательнаяТаблицаМесяца.Очистить();
				
			КонецЕсли;
			
			// Расчет налога по очередной строке дохода.
			
			СтрокаНалога = ВспомогательнаяТаблицаМесяца.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНалога, ТекущаяСтрока, "ФизическоеЛицо, Подразделение, КатегорияДохода");
			СтрокаНалога.НалогПоСтавке13 = Окр(ТекущаяСтрока.ДоходыБезВычетов * ТекущаяСтрока.СтавкаЧислом);
			СтрокаНалога.МесяцНалоговогоПериода = ТекущаяСтрока.ДатаПолученияДохода;
			
			МесяцНалоговогоПериодаПредыдущейСтроки = ТекущаяСтрока.МесяцНалоговогоПериода;
			ИндексОбрабатываемойСтроки = ИндексОбрабатываемойСтроки + 1;
			
		КонецЦикла;
		
		Если ТекущееФизическоеЛицо <> Неопределено Тогда  // Завершение обработки последнего по порядку физлица.
			
			// вычтем ранее исчисленное
			СтруктураПоискаИсчисленного.ФизическоеЛицо = ТекущееФизическоеЛицо;
			Для СчМесяцев = 1 По Месяц(ТекущаяСтрока.МесяцНалоговогоПериода) Цикл
				СтруктураПоискаИсчисленного.МесяцНалоговогоПериодаДляПоиска = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев - 1);
				ВписатьВРезультатЗарегистрированныеВУчетеДанные(ВспомогательнаяТаблицаМесяца, ИсчисленныйРанееНалог.НайтиСтроки(СтруктураПоискаИсчисленного), "КатегорияДохода, НалогПоСтавке13, НалогСПревышения");	
			КонецЦикла;
			
			// впишем засчитываемые авансовые платежи
			ВписатьАвансовыеПлатежиВРезультатРасчета2024(ВспомогательнаяТаблицаМесяца, ОстаткиПоАвансовымПлатежам, Неопределено, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод);
			
			// перепишем результаты за последний налоговый период
			ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаВспомогательный, Неопределено, ВспомогательнаяТаблицаМесяца, ВспомогательнаяТаблицаВычетовМесяца, ОписаниеВычетов, ТекущийНалоговыйПериод, ПредоставленныеСтандартныеИСоциальныеВычеты, СтруктураПоискаСтандартныхВычетов, ИмущественныеВычеты, СтруктураПоискаИмущественныхВычетов, Месяц(ТекущаяСтрока.МесяцНалоговогоПериода));
					
			// окончательно доработаем результаты
			Если ОкончательныйРасчет Тогда
				Если СоответствиеФизическихЛиц[ТекущееФизическоеЛицо] <> Неопределено Тогда // Допишем учтенные в расчете документы-основания.
					СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо = ТекущееФизическоеЛицо;
					ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчетаВспомогательный, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор);
				КонецЕсли;
			Иначе
				ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатРасчета, РезультатРасчетаВспомогательный, ДатаУдержанияИсчисленногоНалога, МесяцРасчета);	
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
	// Оставим в конечном результате только те подразделения, что относятся к организации документа.
	Если РезультатРасчета.Количество() > 0 Тогда
		Запрос.Текст = 
		"ВЫБРАТЬ 
		|	ПодразделенияОрганизаций.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.ПодразделенияОрганизаций КАК ПодразделенияОрганизаций
		|ГДЕ
		|	ПодразделенияОрганизаций.Ссылка В(&Ссылка)
		|	И ПодразделенияОрганизаций.Владелец <> &Владелец";
		Запрос.УстановитьПараметр("Ссылка", РезультатРасчета.ВыгрузитьКолонку("Подразделение"));
		Запрос.УстановитьПараметр("Владелец", Организация);
		Результат = Запрос.Выполнить();
		Если Не Результат.Пустой() Тогда
			РезультатРасчета.Индексы.Добавить("Подразделение");
			СтруктураПоиска = Новый Структура("Подразделение");
			УдаляемыеСтроки = Новый Массив;
			ЛишниеПодразделения = Результат.Выгрузить().ВыгрузитьКолонку("Ссылка");
			Для каждого УдаляемоеПодразделение Из ЛишниеПодразделения Цикл
				СтруктураПоиска.Подразделение = УдаляемоеПодразделение;
				ОбщегоНазначенияКлиентСервер.ДополнитьМассив(УдаляемыеСтроки, РезультатРасчета.НайтиСтроки(СтруктураПоиска));
			КонецЦикла;
			Для каждого УдаляемаяСтрока Из УдаляемыеСтроки Цикл
				РезультатРасчета.Удалить(УдаляемаяСтрока);
			КонецЦикла;	
		КонецЕсли;
	КонецЕсли;
	
	// Дозаполним категорию дохода значением по умолчанию.
	Для Каждого СтрокаРезультат Из РезультатРасчета Цикл
		Если Не ЗначениеЗаполнено(СтрокаРезультат.КатегорияДохода) Тогда
			СтрокаРезультат.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.ОплатаТруда;
		КонецЕсли;
	КонецЦикла;

	// Допишем полученные ранее результаты расчета прошлых лет
	Для каждого СтрокаРезультат Из РезультатыПрошлыхЛет Цикл
		Если СтрокаРезультат.МесяцНалоговогоПериода < ПервыйМесяцТекущегоАлгоритма Тогда
			ЗаполнитьЗначенияСвойств(РезультатРасчета.Добавить(), СтрокаРезультат);
		КонецЕсли;
	КонецЦикла;
	
	Возврат РезультатРасчета;
	
КонецФункции

Функция ДанныеОПерерасчетеНДФЛпоПлоскимСтавкам(Организация, МесяцПерерасчета, НачалоПериода, ОкончаниеПериода, ФизическиеЛица = Неопределено, ДокументСсылка = Неопределено) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ДатаАктуальности", КонецМесяца(МесяцПерерасчета));
	Запрос.УстановитьПараметр("НачалоГодаПериодаРасчета", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("КонецМесяцаРасчета", КонецМесяца(ОкончаниеПериода));
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	СоздатьВТРегистрацииВНалоговомОрганеОрганизацииОКАТОКПП(Организация, Запрос.МенеджерВременныхТаблиц);	
	
    ТекстЗапроса =
	"ВЫБРАТЬ
	|	Обороты.СуммаДохода КАК СуммаДохода,
	|	Обороты.СуммаВычета КАК СуммаВычета,
	|	Обороты.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Обороты.ДатаПолученияДохода КАК Период,
	|	Обороты.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	Обороты.КатегорияДохода КАК КатегорияДохода,
	|	Обороты.КодДохода КАК КодДохода,
	|	Обороты.КодДохода.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	Обороты.Подразделение КАК Подразделение,
	|	Обороты.ДатаПолученияДохода КАК ДатаПолученияДохода
	|ПОМЕСТИТЬ ВТДоходы
	|ИЗ
	|	РегистрНакопления.СведенияОДоходахНДФЛ КАК Обороты
	|ГДЕ
	|	Обороты.Период <= &ДатаАктуальности
	|	И Обороты.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И НЕ Обороты.КодДохода.НеОблагаетсяУНалоговогоАгента
	|	И Обороты.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета
	|	И &УсловиеДляФизлиц
	|	И Обороты.РегистрацияВНалоговомОргане В
	|			(ВЫБРАТЬ
	|				РегистрацииВНалоговомОрганеОрганизацииОКАТОКПП.РегистрацияВНалоговомОргане
	|			ИЗ
	|				ВТРегистрацииВНалоговомОрганеОрганизацииОКАТОКПП КАК РегистрацииВНалоговомОрганеОрганизацииОКАТОКПП)";
	
	Если ЗначениеЗаполнено(ФизическиеЛица) Тогда
		Запрос.УстановитьПараметр("ФизическиеЛица", ФизическиеЛица);
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеДляФизлиц", "ФизическоеЛицо В(&ФизическиеЛица)");
		Запрос.Выполнить();
	Иначе
		Запрос.Текст = СтрЗаменить(ТекстЗапроса, "&УсловиеДляФизлиц", "Истина") + ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов() + 
		"////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Обороты.ФизическоеЛицо КАК ФизическоеЛицо
		|ИЗ
		|	ВТДоходы КАК Обороты
		|ГДЕ
		|	Обороты.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)";
		ФизическиеЛица = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизическоеЛицо");
	КонецЕсли;
	
	РезультатРасчетаНДФЛ = РассчитатьНалогПоПлоскойСтавке(ДокументСсылка, Организация, МесяцПерерасчета, ФизическиеЛица, НачалоПериода, ОкончаниеПериода, Истина, Неопределено, Неопределено);
	
	РезультатРасчетаНДФЛ.Колонки.Добавить("НалогПоСтавке09", Новый ОписаниеТипов("Число"));
	РезультатРасчетаНДФЛ.Колонки.Добавить("НалогПоСтавке35", Новый ОписаниеТипов("Число"));
	РезультатРасчетаНДФЛ.Колонки.Добавить("ЗачтеноАвансовыхПлатежейПоСтавке35", Новый ОписаниеТипов("Число"));
	
	СоздатьВТСтавкаНДФЛПоСтавкеРезидента(Запрос.МенеджерВременныхТаблиц, "ВТДоходы", "УчитыватьИзмененияСтатусаДляРасчета");
	
	Запрос.УстановитьПараметр("Регистратор", ДокументСсылка);
	Запрос.УстановитьПараметр("ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев", УчетНДФЛ.ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев());
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо
	|ПОМЕСТИТЬ ВТСписокФизЛиц
	|ИЗ
	|	ВТДоходы КАК Доходы
	|ГДЕ
	|	Доходы.СтавкаНалогообложенияРезидента <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасчетыСБюджетом.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(ВЫБОР
	|			КОГДА РасчетыСБюджетом.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09)
	|				ТОГДА РасчетыСБюджетом.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК НалогПоСтавке09,
	|	СУММА(ВЫБОР
	|			КОГДА РасчетыСБюджетом.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка35)
	|				ТОГДА РасчетыСБюджетом.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК НалогПоСтавке35,
	|	РасчетыСБюджетом.Подразделение КАК Подразделение,
	|	РасчетыСБюджетом.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыСБюджетом.КатегорияДохода КАК КатегорияДохода
	|ПОМЕСТИТЬ ВТРанееНачисленныеНалоги
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыСБюджетом
	|ГДЕ
	|	РасчетыСБюджетом.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И РасчетыСБюджетом.ФизическоеЛицо В
	|			(ВЫБРАТЬ
	|				СписокФизЛиц.ФизическоеЛицо
	|			ИЗ
	|				ВТСписокФизЛиц КАК СписокФизЛиц)
	|	И РасчетыСБюджетом.Период <= &ДатаАктуальности
	|	И РасчетыСБюджетом.МесяцНалоговогоПериода МЕЖДУ &НачалоГодаПериодаРасчета И &КонецМесяцаРасчета
	|	И РасчетыСБюджетом.Регистратор <> &Регистратор
	|	И РасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И РасчетыСБюджетом.СтавкаНалогообложенияРезидента <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|	И РасчетыСБюджетом.РегистрацияВНалоговомОргане В
	|			(ВЫБРАТЬ
	|				РегистрацииВНалоговомОрганеОрганизацииОКАТОКПП.РегистрацияВНалоговомОргане
	|			ИЗ
	|				ВТРегистрацииВНалоговомОрганеОрганизацииОКАТОКПП КАК РегистрацииВНалоговомОрганеОрганизацииОКАТОКПП)
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыСБюджетом.ФизическоеЛицо,
	|	РасчетыСБюджетом.Подразделение,
	|	РасчетыСБюджетом.МесяцНалоговогоПериода,
	|	РасчетыСБюджетом.КатегорияДохода
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Доходы.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Доходы.Подразделение КАК Подразделение,
	|	Доходы.КатегорияДохода КАК КатегорияДохода,
	|	ВЫБОР
	|		КОГДА Доходы.ДатаПолученияДохода < &ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев
	|			ТОГДА Доходы.МесяцНалоговогоПериода
	|		ИНАЧЕ Доходы.ДатаПолученияДохода
	|	КОНЕЦ КАК МесяцНалоговогоПериода,
	|	ВЫРАЗИТЬ((Доходы.СуммаДохода - Доходы.СуммаВычета) * ВЫБОР
	|			КОГДА Доходы.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка09)
	|				ТОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом
	|			ИНАЧЕ 0
	|		КОНЕЦ КАК ЧИСЛО(10, 0)) КАК НалогПоСтавке09,
	|	ВЫРАЗИТЬ((Доходы.СуммаДохода - Доходы.СуммаВычета) * ВЫБОР
	|			КОГДА Доходы.СтавкаНалогообложенияРезидента = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка35)
	|				ТОГДА СтавкаНДФЛПоСтавкеРезидента.СтавкаЧислом
	|			ИНАЧЕ 0
	|		КОНЕЦ КАК ЧИСЛО(10, 0)) КАК НалогПоСтавке35
	|ПОМЕСТИТЬ ВТНалоги
	|ИЗ
	|	ВТДоходы КАК Доходы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтавкаНДФЛПоСтавкеРезидента КАК СтавкаНДФЛПоСтавкеРезидента
	|		ПО Доходы.ФизическоеЛицо = СтавкаНДФЛПоСтавкеРезидента.ФизическоеЛицо
	|			И Доходы.Период = СтавкаНДФЛПоСтавкеРезидента.Период
	|			И Доходы.СтавкаНалогообложенияРезидента = СтавкаНДФЛПоСтавкеРезидента.СтавкаНалогообложенияРезидента
	|			И Доходы.КатегорияДохода = СтавкаНДФЛПоСтавкеРезидента.КатегорияДохода
	|ГДЕ
	|	Доходы.СтавкаНалогообложенияРезидента <> ЗНАЧЕНИЕ(Перечисление.НДФЛСтавкиНалогообложенияРезидента.Ставка13)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	РанееНачисленныеНалоги.ФизическоеЛицо,
	|	РанееНачисленныеНалоги.Подразделение,
	|	РанееНачисленныеНалоги.КатегорияДохода,
	|	РанееНачисленныеНалоги.МесяцНалоговогоПериода,
	|	-РанееНачисленныеНалоги.НалогПоСтавке09,
	|	-РанееНачисленныеНалоги.НалогПоСтавке35
	|ИЗ
	|	ВТРанееНачисленныеНалоги КАК РанееНачисленныеНалоги
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Налоги.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Налоги.Подразделение КАК Подразделение,
	|	Налоги.КатегорияДохода КАК КатегорияДохода,
	|	Налоги.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	СУММА(Налоги.НалогПоСтавке09) КАК НалогПоСтавке09,
	|	СУММА(Налоги.НалогПоСтавке35) КАК НалогПоСтавке35,
	|	0 КАК ЗачтеноАвансовыхПлатежейПоСтавке35
	|ИЗ
	|	ВТНалоги КАК Налоги
	|
	|СГРУППИРОВАТЬ ПО
	|	Налоги.ФизическоеЛицо,
	|	Налоги.Подразделение,
	|	Налоги.МесяцНалоговогоПериода,
	|	Налоги.КатегорияДохода
	|
	|ИМЕЮЩИЕ
	|	(СУММА(Налоги.НалогПоСтавке09) <> 0
	|		ИЛИ СУММА(Налоги.НалогПоСтавке35) <> 0)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ФизическоеЛицо,
	|	МесяцНалоговогоПериода,
	|	Подразделение";
	
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда
		Возврат РезультатРасчетаНДФЛ
	КонецЕсли;
	
	НалогПоСтавкам09и35 = Результат.Выгрузить();
	
	ВписатьВРезультатЗачтенныеАвансы(ДокументСсылка, Организация, МесяцПерерасчета, НалогПоСтавкам09и35, Перечисления.НДФЛСтавкиНалогообложенияРезидента.Ставка35, "НалогПоСтавке35", "ЗачтеноАвансовыхПлатежейПоСтавке35");
	
	ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НалогПоСтавкам09и35, РезультатРасчетаНДФЛ);
	
	Возврат РезультатРасчетаНДФЛ
	
КонецФункции 

Функция РассчитатьУдержанныеНалоги(Ссылка, Организация, ДатаОперации, МенеджерТаблиц, ПериодРегистрации = Неопределено, ОкончательныйРасчет = Истина, ТаблицаВыплат = Неопределено) Экспорт
	
	// до 1 января 2016 года
	
	УточненнаяДатаОперации = ?(ОкончательныйРасчет И ЗначениеЗаполнено(ПериодРегистрации), Макс(КонецМесяца(ПериодРегистрации), КонецДня(ДатаОперации)), КонецДня(ДатаОперации));
	
	РезультатыРасчетов = Новый ТаблицаЗначений;
	РезультатыРасчетов.Колонки.Добавить("ФизическоеЛицо",Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	РезультатыРасчетов.Колонки.Добавить("СтавкаНалогообложенияРезидента",Новый ОписаниеТипов("ПеречислениеСсылка.НДФЛСтавкиНалогообложенияРезидента"));
	РезультатыРасчетов.Колонки.Добавить("КодДохода",Новый ОписаниеТипов("СправочникСсылка.ВидыДоходовНДФЛ"));               
	РезультатыРасчетов.Колонки.Добавить("КатегорияДохода", Новый ОписаниеТипов("ПеречислениеСсылка.КатегорииДоходовНДФЛ"));
	РезультатыРасчетов.Колонки.Добавить("МесяцНалоговогоПериода",Новый ОписаниеТипов("Дата",,,Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	РезультатыРасчетов.Колонки.Добавить("РегистрацияВНалоговомОргане",Новый ОписаниеТипов("СправочникСсылка.РегистрацииВНалоговомОргане"));
	РезультатыРасчетов.Колонки.Добавить("Подразделение", Метаданные.ОпределяемыеТипы.ТерриторияВыполненияРаботВОрганизации.Тип);
	РезультатыРасчетов.Колонки.Добавить("Сумма",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(13,0)));
	РезультатыРасчетов.Колонки.Добавить("СуммаСПревышения",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(13,0)));
	РезультатыРасчетов.Колонки.Добавить("НачисленоНалога",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(13,0)));
	РезультатыРасчетов.Колонки.Добавить("ВключатьВДекларациюПоНалогуНаПрибыль",Новый ОписаниеТипов("Булево"));
	РезультатыРасчетов.Колонки.Добавить("ДокументОснование", Метаданные.ОпределяемыеТипы.ДокументыОснованияНДФЛ.Тип);
	
	ТаблицыКУдалению = Новый Массив;
	
	Запрос = Новый Запрос();
	Запрос.МенеджерВременныхТаблиц = МенеджерТаблиц;
	КолонкиРезультата = МенеджерТаблиц.Таблицы["ВТСписокСотрудников"].Колонки;
	ИмяТаблицыСписокСотрудников = "ВТСписокСотрудников";
	Если КолонкиРезультата.Найти("ДокументОснование") = Неопределено Тогда
		Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1 * ИЗ ВТСписокСотрудников КАК СписокСотрудников";
		Если Запрос.Выполнить().Пустой() Тогда
			Возврат РезультатыРасчетов
		КонецЕсли;
	ИначеЕсли Не ОкончательныйРасчет Тогда
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	СписокСотрудников.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СписокСотрудников.ДокументОснование КАК ДокументОснование, *
		|ПОМЕСТИТЬ ВТУточненныйСписокСотрудников
		|ИЗ
		|	ВТСписокСотрудников КАК СписокСотрудников
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДокументыУчтенныеПриРасчетеНДФЛ КАК ДокументыУчтенныеПриРасчетеНДФЛ
		|		ПО СписокСотрудников.ФизическоеЛицо = ДокументыУчтенныеПриРасчетеНДФЛ.ФизическоеЛицо
		|			И СписокСотрудников.ДокументОснование = ДокументыУчтенныеПриРасчетеНДФЛ.ДокументОснование
		|ГДЕ
		|	НЕ ЕСТЬNULL(ДокументыУчтенныеПриРасчетеНДФЛ.УдержатьНалогПриВыплатеЗарплаты, ЛОЖЬ)";
		ИмяТаблицыСписокСотрудников = "ВТУточненныйСписокСотрудников";
		ТаблицыКУдалению.Добавить(ИмяТаблицыСписокСотрудников);
		Если Запрос.Выполнить().Выгрузить()[0].Количество = 0 Тогда
			Возврат РезультатыРасчетов
		КонецЕсли;
	ИначеЕсли ЗначениеЗаполнено(ТаблицаВыплат) Тогда
		УчетНДФЛВнутренний.ДописатьДокументыОплаченныеБезУдержанияНДФЛ(Ссылка, Организация, ДатаОперации, ПериодРегистрации, МенеджерТаблиц, ТаблицаВыплат, ИмяТаблицыСписокСотрудников);
		Если ИмяТаблицыСписокСотрудников <> "ВТСписокСотрудников" Тогда
			ТаблицыКУдалению.Добавить(ИмяТаблицыСписокСотрудников);
		КонецЕсли;
	КонецЕсли;
	
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("Регистратор", Ссылка);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("ДатаОперации", КонецДня(УточненнаяДатаОперации));
	Запрос.УстановитьПараметр("КонецМесяца", КонецМесяца(УточненнаяДатаОперации));
	Запрос.УстановитьПараметр("ОкончательныйРасчет", ОкончательныйРасчет);
	Запрос.УстановитьПараметр("ДоляПолнойВыплаты", УчетНДФЛ.ДоляПолнойВыплаты());
	Запрос.УстановитьПараметр("ОсобыеРегистраторы", ЗарплатаКадры.РегистраторыПереносаДанных());
	
	ТекстЗапроса =  
	"ВЫБРАТЬ
	|	СписокСотрудников.ФизическоеЛицо,
	|	НЕОПРЕДЕЛЕНО КАК ДокументОснование,
	|	0 КАК СуммаНачисленная,
	|	0 КАК СуммаВыплаченная,
	|	СУММА(СписокСотрудников.СуммаВыплаты) КАК СуммаВыплаты
	|ПОМЕСТИТЬ ВТСуммыНДФЛПоСотрудникамИДокументам
	|ИЗ
	|	ВТСписокСотрудников КАК СписокСотрудников
	|
	|СГРУППИРОВАТЬ ПО
	|	СписокСотрудников.ФизическоеЛицо";
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "ВТСписокСотрудников", ИмяТаблицыСписокСотрудников); 
	Запрос.Выполнить();
	
	ТаблицыКУдалению.Добавить("ВТСуммыНДФЛПоСотрудникамИДокументам");
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СписокСотрудников.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(СписокСотрудников.СуммаНачисленная) КАК СуммаНачисленная,
	|	СУММА(СписокСотрудников.СуммаВыплаченная) КАК СуммаВыплаченная,
	|	МАКСИМУМ(СписокСотрудников.СуммаВыплаты) КАК СуммаВыплаты
	|ПОМЕСТИТЬ ВТСуммыВыплатыБезОснований
	|ИЗ
	|	ВТСуммыНДФЛПоСотрудникамИДокументам КАК СписокСотрудников
	|ГДЕ
	|	СписокСотрудников.ДокументОснование = НЕОПРЕДЕЛЕНО
	|
	|СГРУППИРОВАТЬ ПО
	|	СписокСотрудников.ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СписокСотрудников.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(СписокСотрудников.СуммаВыплаты) КАК СуммаВыплаты
	|ПОМЕСТИТЬ ВТСуммыНДФЛПоСотрудникам
	|ИЗ
	|	ВТСуммыНДФЛПоСотрудникамИДокументам КАК СписокСотрудников
	|
	|СГРУППИРОВАТЬ ПО
	|	СписокСотрудников.ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК Период,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КодДохода КАК КодДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения КАК ВидДвижения,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДатаПолученияДоходаФиксирована КАК ДатаПолученияДоходаФиксирована,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор
	|ПОМЕСТИТЬ ВТСтрокиРегистра
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСуммыНДФЛПоСотрудникам КАК СуммыНДФЛПоСотрудникам
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = СуммыНДФЛПоСотрудникам.ФизическоеЛицо
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &Регистратор
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период <= &ДатаОперации
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументОснование
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(ДанныеДокументаОснования.Период, СтрокиДанных.Период) КАК Период,
	|	ЕСТЬNULL(НАЧАЛОПЕРИОДА(ДанныеДокументаОснования.МесяцНалоговогоПериода, ДЕНЬ), СтрокиДанных.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СтрокиДанных.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СтрокиДанных.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	СтрокиДанных.КатегорияДохода КАК КатегорияДохода,
	|	СтрокиДанных.КодДохода КАК КодДохода,
	|	СтрокиДанных.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	СтрокиДанных.Организация КАК Организация,
	|	СтрокиДанных.Подразделение КАК Подразделение,
	|	СтрокиДанных.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	СтрокиДанных.ДокументОснование КАК ДокументОснование,
	|	СтрокиДанных.ВариантУдержания КАК ВариантУдержания,
	|	СУММА(СтрокиДанных.Сумма) КАК Сумма,
	|	СтрокиДанных.ВидДвижения КАК ВидДвижения
	|ПОМЕСТИТЬ ВТДанныеРегистра
	|ИЗ
	|	ВТСтрокиРегистра КАК СтрокиДанных
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			МИНИМУМ(СтрокиДанных.Период) КАК Период,
	|			МИНИМУМ(СтрокиДанных.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|			СтрокиДанных.ДокументОснование КАК ДокументОснование,
	|			СтрокиДанных.ФизическоеЛицо КАК ФизическоеЛицо
	|		ИЗ
	|			ВТСтрокиРегистра КАК СтрокиДанных
	|		ГДЕ
	|			СтрокиДанных.Регистратор = СтрокиДанных.ДокументОснование
	|			И НЕ СтрокиДанных.ДатаПолученияДоходаФиксирована
	|			И СтрокиДанных.ДокументОснование <> НЕОПРЕДЕЛЕНО
	|			И НЕ ТИПЗНАЧЕНИЯ(СтрокиДанных.ДокументОснование) В (&ОсобыеРегистраторы)
	|		
	|		СГРУППИРОВАТЬ ПО
	|			СтрокиДанных.ДокументОснование,
	|			СтрокиДанных.ФизическоеЛицо) КАК ДанныеДокументаОснования
	|		ПО СтрокиДанных.ДокументОснование = ДанныеДокументаОснования.ДокументОснование
	|			И (НЕ СтрокиДанных.ДатаПолученияДоходаФиксирована)
	|			И СтрокиДанных.ФизическоеЛицо = ДанныеДокументаОснования.ФизическоеЛицо
	|
	|СГРУППИРОВАТЬ ПО
	|	СтрокиДанных.ФизическоеЛицо,
	|	СтрокиДанных.СтавкаНалогообложенияРезидента,
	|	СтрокиДанных.КатегорияДохода,
	|	СтрокиДанных.КодДохода,
	|	СтрокиДанных.РегистрацияВНалоговомОргане,
	|	СтрокиДанных.Организация,
	|	СтрокиДанных.Подразделение,
	|	СтрокиДанных.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	СтрокиДанных.ДокументОснование,
	|	СтрокиДанных.ВариантУдержания,
	|	СтрокиДанных.ВидДвижения,
	|	ЕСТЬNULL(НАЧАЛОПЕРИОДА(ДанныеДокументаОснования.МесяцНалоговогоПериода, ДЕНЬ), СтрокиДанных.МесяцНалоговогоПериода),
	|	ЕСТЬNULL(ДанныеДокументаОснования.Период, СтрокиДанных.Период)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МИНИМУМ(НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период, ДЕНЬ)) КАК ДатаНачисления,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК Период,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КодДохода КАК КодДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование) В (&ОсобыеРегистраторы)
	|			ТОГДА ""ОсобыйРегистратор""
	|		ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование
	|	КОНЕЦ КАК ДокументОснование,
	|	СУММА(ВЫБОР
	|			КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма
	|			КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
	|				ТОГДА -РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК НачисленоНалога,
	|	СУММА(ВЫБОР
	|			КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА 0
	|			КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ЗачетАвансовыхПлатежей)
	|				ТОГДА 0
	|			ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма
	|		КОНЕЦ) КАК УдержаноНалога,
	|	СУММА(ВЫБОР
	|			КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма
	|			ИНАЧЕ -РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма
	|		КОНЕЦ) КАК СуммаОстаток,
	|	ЕСТЬNULL(МАКСИМУМ(ВЫБОР
	|				КОГДА СуммыНДФЛПоСотрудникамИДокументам.СуммаНачисленная = 0
	|					ТОГДА 1
	|				КОГДА СуммыНДФЛПоСотрудникамИДокументам.СуммаВыплаченная + СуммыНДФЛПоСотрудникамИДокументам.СуммаВыплаты > СуммыНДФЛПоСотрудникамИДокументам.СуммаНачисленная * &ДоляПолнойВыплаты
	|					ТОГДА 1
	|				КОГДА СуммыНДФЛПоСотрудникамИДокументам.СуммаВыплаченная ЕСТЬ НЕ NULL 
	|					ТОГДА (СуммыНДФЛПоСотрудникамИДокументам.СуммаВыплаченная + СуммыНДФЛПоСотрудникамИДокументам.СуммаВыплаты) / СуммыНДФЛПоСотрудникамИДокументам.СуммаНачисленная
	|				КОГДА СуммыВыплатыБезОснований.СуммаНачисленная = 0
	|					ТОГДА 1
	|				КОГДА СуммыВыплатыБезОснований.СуммаВыплаченная + СуммыВыплатыБезОснований.СуммаВыплаты > СуммыВыплатыБезОснований.СуммаНачисленная * &ДоляПолнойВыплаты
	|					ТОГДА 1
	|				ИНАЧЕ (СуммыВыплатыБезОснований.СуммаВыплаченная + СуммыВыплатыБезОснований.СуммаВыплаты) / СуммыВыплатыБезОснований.СуммаНачисленная
	|			КОНЕЦ), 1) КАК Доля,
	|	МАКСИМУМ(СуммыНДФЛПоСотрудникам.СуммаВыплаты) КАК СуммаВыплаты
	|ПОМЕСТИТЬ ВТДанныеУчета
	|ИЗ
	|	ВТСуммыНДФЛПоСотрудникам КАК СуммыНДФЛПоСотрудникам
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеРегистра КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСуммыНДФЛПоСотрудникамИДокументам КАК СуммыНДФЛПоСотрудникамИДокументам
	|			ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = СуммыНДФЛПоСотрудникамИДокументам.ФизическоеЛицо
	|				И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование = СуммыНДФЛПоСотрудникамИДокументам.ДокументОснование
	|				И (СуммыНДФЛПоСотрудникамИДокументам.СуммаВыплаты > 0)
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТСуммыВыплатыБезОснований КАК СуммыВыплатыБезОснований
	|			ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = СуммыВыплатыБезОснований.ФизическоеЛицо
	|				И (СуммыВыплатыБезОснований.СуммаВыплаты > 0)
	|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КодДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование) В (&ОсобыеРегистраторы)
	|			ТОГДА ""ОсобыйРегистратор""
	|		ИНАЧЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование
	|	КОНЕЦ,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВЫБОР
	|			КОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма
	|			ИНАЧЕ -РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма
	|		КОНЕЦ) <> 0";
	
	ТаблицыКУдалению.Добавить("ВТСуммыВыплатыБезОснований");
	ТаблицыКУдалению.Добавить("ВТСуммыНДФЛПоСотрудникам");
	ТаблицыКУдалению.Добавить("ВТДанныеРегистра");
	ТаблицыКУдалению.Добавить("ВТДанныеУчета");
	ТаблицыКУдалению.Добавить("ВТСтрокиРегистра");
	Если Запрос.Выполнить().Выгрузить()[0].Количество = 0 Тогда
		ЗарплатаКадры.УничтожитьВТ(МенеджерТаблиц, ТаблицыКУдалению);
		Возврат РезультатыРасчетов
	КонецЕсли;
	
	Запрос.Текст =  
	"ВЫБРАТЬ
	|	ДанныеУчета.ДатаНачисления КАК ДатаНачисления,
	|	ДанныеУчета.Период КАК Период,
	|	ДанныеУчета.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ДанныеУчета.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ДанныеУчета.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	ДанныеУчета.КатегорияДохода КАК КатегорияДохода,
	|	ДанныеУчета.КодДохода КАК КодДохода,
	|	ДанныеУчета.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	ДанныеУчета.Организация КАК Организация,
	|	ДанныеУчета.Подразделение КАК Подразделение,
	|	ДанныеУчета.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ДанныеУчета.ДокументОснование КАК ДокументОснование,
	|	ВЫБОР
	|		КОГДА ДанныеУчета.СуммаОстаток < 0
	|			ТОГДА ДанныеУчета.СуммаОстаток
	|		КОГДА ДанныеУчета.Доля = 1
	|			ТОГДА ДанныеУчета.СуммаОстаток
	|		КОГДА ДанныеУчета.СуммаОстаток <= ВЫБОР
	|				КОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога > 0
	|					ТОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога
	|				ИНАЧЕ 0
	|			КОНЕЦ
	|			ТОГДА ДанныеУчета.СуммаОстаток
	|		ИНАЧЕ ВЫБОР
	|				КОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога > 0
	|					ТОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога
	|				ИНАЧЕ 0
	|			КОНЕЦ
	|	КОНЕЦ КАК СуммаОстаток,
	|	ДанныеУчета.СуммаВыплаты КАК СуммаВыплаты,
	|	ДанныеУчета.НачисленоНалога КАК НачисленоНалога
	|ПОМЕСТИТЬ ВТПодробно
	|ИЗ
	|	ВТДанныеУчета КАК ДанныеУчета
	|ГДЕ
	|	ВЫБОР
	|			КОГДА ДанныеУчета.СуммаОстаток < 0
	|				ТОГДА ДанныеУчета.СуммаОстаток
	|			КОГДА ДанныеУчета.Доля = 1
	|				ТОГДА ДанныеУчета.СуммаОстаток
	|			КОГДА ДанныеУчета.СуммаОстаток <= ВЫБОР
	|					КОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога > 0
	|						ТОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|				ТОГДА ДанныеУчета.СуммаОстаток
	|			ИНАЧЕ ВЫБОР
	|					КОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога > 0
	|						ТОГДА (ВЫРАЗИТЬ(ДанныеУчета.НачисленоНалога * ДанныеУчета.Доля КАК ЧИСЛО(15, 0))) - ДанныеУчета.УдержаноНалога
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		КОНЕЦ <> 0
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ФизическоеЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СУММА(ПодробныеДанные.СуммаОстаток) КАК СуммаОстаток,
	|	ПодробныеДанные.ДокументОснование КАК ДокументОснование
	|ПОМЕСТИТЬ ВТПоФизическомуЛицуОснованию
	|ИЗ
	|	ВТПодробно КАК ПодробныеДанные
	|
	|СГРУППИРОВАТЬ ПО
	|	ПодробныеДанные.ФизическоеЛицо,
	|	ПодробныеДанные.ДокументОснование
	|
	|ИМЕЮЩИЕ
	|	СУММА(ПодробныеДанные.СуммаОстаток) <> 0";
	
	ТаблицыКУдалению.Добавить("ВТПодробно");
	ТаблицыКУдалению.Добавить("ВТПоФизическомуЛицуОснованию");
	Если Запрос.Выполнить().Выгрузить()[0].Количество = 0 Тогда
		ЗарплатаКадры.УничтожитьВТ(МенеджерТаблиц, ТаблицыКУдалению);
		Возврат РезультатыРасчетов
	КонецЕсли;
	
	Запрос.Текст =  
	"ВЫБРАТЬ
	|	ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПодробныеДанные.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	НАЧАЛОПЕРИОДА(ПодробныеДанные.МесяцНалоговогоПериода, ДЕНЬ) КАК ДатаПолученияДохода,
	|	СУММА(ПодробныеДанные.СуммаОстаток) КАК СуммаОстаток
	|ПОМЕСТИТЬ ВТПоФизическомуЛицуНаДатуПолученияДохода
	|ИЗ
	|	ВТПодробно КАК ПодробныеДанные
	|
	|СГРУППИРОВАТЬ ПО
	|	ПодробныеДанные.ФизическоеЛицо,
	|	ПодробныеДанные.СтавкаНалогообложенияРезидента,
	|	НАЧАЛОПЕРИОДА(ПодробныеДанные.МесяцНалоговогоПериода, ДЕНЬ)
	|
	|ИМЕЮЩИЕ
	|	СУММА(ПодробныеДанные.СуммаОстаток) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеРегистра.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ДанныеРегистра.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ДанныеРегистра.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	ДанныеРегистра.КатегорияДохода КАК КатегорияДохода,
	|	ДанныеРегистра.КодДохода КАК КодДохода,
	|	ДанныеРегистра.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	ДанныеРегистра.Организация КАК Организация,
	|	ДанныеРегистра.Подразделение КАК Подразделение,
	|	ДанныеРегистра.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	МАКСИМУМ(ДанныеРегистра.ДокументОснование) КАК ДокументОснование
	|ПОМЕСТИТЬ ВТДанныеОсобыхРегистраторов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ПодробныеДанные.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|		ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
	|		ПодробныеДанные.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|		ПодробныеДанные.КатегорияДохода КАК КатегорияДохода,
	|		ПодробныеДанные.КодДохода КАК КодДохода,
	|		ПодробныеДанные.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|		ПодробныеДанные.Организация КАК Организация,
	|		ПодробныеДанные.Подразделение КАК Подразделение,
	|		ПодробныеДанные.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|		ПодробныеДанные.ДокументОснование КАК ДокументОснование
	|	ИЗ
	|		ВТДанныеРегистра КАК ПодробныеДанные
	|	ГДЕ
	|		ТИПЗНАЧЕНИЯ(ПодробныеДанные.ДокументОснование) В (&ОсобыеРегистраторы)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПодробныеДанные.Период,
	|		ПодробныеДанные.ДокументОснование,
	|		ПодробныеДанные.МесяцНалоговогоПериода,
	|		ПодробныеДанные.ФизическоеЛицо,
	|		ПодробныеДанные.СтавкаНалогообложенияРезидента,
	|		ПодробныеДанные.КатегорияДохода,
	|		ПодробныеДанные.КодДохода,
	|		ПодробныеДанные.РегистрацияВНалоговомОргане,
	|		ПодробныеДанные.Организация,
	|		ПодробныеДанные.Подразделение,
	|		ПодробныеДанные.ВключатьВДекларациюПоНалогуНаПрибыль
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(ВЫБОР
	|				КОГДА ПодробныеДанные.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					ТОГДА ПодробныеДанные.Сумма
	|				ИНАЧЕ -ПодробныеДанные.Сумма
	|			КОНЕЦ) > 0) КАК ДанныеРегистра
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеРегистра.МесяцНалоговогоПериода,
	|	ДанныеРегистра.ФизическоеЛицо,
	|	ДанныеРегистра.СтавкаНалогообложенияРезидента,
	|	ДанныеРегистра.КатегорияДохода,
	|	ДанныеРегистра.КодДохода,
	|	ДанныеРегистра.РегистрацияВНалоговомОргане,
	|	ДанныеРегистра.Организация,
	|	ДанныеРегистра.Подразделение,
	|	ДанныеРегистра.ВключатьВДекларациюПоНалогуНаПрибыль
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПодробныеДанные.ДатаНачисления КАК ДатаНачисления,
	|	ПодробныеДанные.Период КАК Период,
	|	ПодробныеДанные.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПодробныеДанные.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	ПодробныеДанные.КатегорияДохода КАК КатегорияДохода,
	|	ПодробныеДанные.КодДохода КАК КодДохода,
	|	ПодробныеДанные.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	ПодробныеДанные.Организация КАК Организация,
	|	ПодробныеДанные.Подразделение КАК Подразделение,
	|	ПодробныеДанные.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	ВЫБОР
	|		КОГДА ПодробныеДанные.ДокументОснование = ""ОсобыйРегистратор""
	|			ТОГДА ЕСТЬNULL(ДанныеОсобыхРегистраторов.ДокументОснование, НЕОПРЕДЕЛЕНО)
	|		ИНАЧЕ ПодробныеДанные.ДокументОснование
	|	КОНЕЦ КАК ДокументОснование,
	|	ПодробныеДанные.СуммаОстаток КАК СуммаОстаток,
	|	ПодробныеДанные.СуммаВыплаты КАК СуммаВыплаты,
	|	ПодробныеДанные.НачисленоНалога КАК НачисленоНалога
	|ПОМЕСТИТЬ ВТПодробноБезНулевыхОснований
	|ИЗ
	|	ВТПодробно КАК ПодробныеДанные
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоФизическомуЛицуОснованию КАК ПоФизическомуЛицуОснованию
	|		ПО ПодробныеДанные.ФизическоеЛицо = ПоФизическомуЛицуОснованию.ФизическоеЛицо
	|			И ПодробныеДанные.ДокументОснование = ПоФизическомуЛицуОснованию.ДокументОснование
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоФизическомуЛицуНаДатуПолученияДохода КАК НаДатуПолученияДохода
	|		ПО ПодробныеДанные.ФизическоеЛицо = НаДатуПолученияДохода.ФизическоеЛицо
	|			И (НАЧАЛОПЕРИОДА(ПодробныеДанные.МесяцНалоговогоПериода, ДЕНЬ) = НаДатуПолученияДохода.ДатаПолученияДохода)
	|			И ПодробныеДанные.СтавкаНалогообложенияРезидента = НаДатуПолученияДохода.СтавкаНалогообложенияРезидента
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеОсобыхРегистраторов КАК ДанныеОсобыхРегистраторов
	|		ПО ПодробныеДанные.ФизическоеЛицо = ДанныеОсобыхРегистраторов.ФизическоеЛицо
	|			И ПодробныеДанные.МесяцНалоговогоПериода = ДанныеОсобыхРегистраторов.МесяцНалоговогоПериода
	|			И ПодробныеДанные.СтавкаНалогообложенияРезидента = ДанныеОсобыхРегистраторов.СтавкаНалогообложенияРезидента
	|			И ПодробныеДанные.КатегорияДохода = ДанныеОсобыхРегистраторов.КатегорияДохода
	|			И ПодробныеДанные.КодДохода = ДанныеОсобыхРегистраторов.КодДохода
	|			И ПодробныеДанные.РегистрацияВНалоговомОргане = ДанныеОсобыхРегистраторов.РегистрацияВНалоговомОргане
	|			И ПодробныеДанные.Организация = ДанныеОсобыхРегистраторов.Организация
	|			И ПодробныеДанные.Подразделение = ДанныеОсобыхРегистраторов.Подразделение
	|			И ПодробныеДанные.ВключатьВДекларациюПоНалогуНаПрибыль = ДанныеОсобыхРегистраторов.ВключатьВДекларациюПоНалогуНаПрибыль
	|			И (ПодробныеДанные.ДокументОснование = ""ОсобыйРегистратор"")
	|ГДЕ
	|	ПоФизическомуЛицуОснованию.ДокументОснование ЕСТЬ НЕ NULL 
	|	И НаДатуПолученияДохода.ФизическоеЛицо ЕСТЬ НЕ NULL ";
	Запрос.Выполнить();
	
	ТаблицыКУдалению.Добавить("ВТПоФизическомуЛицуНаДатуПолученияДохода");
	ТаблицыКУдалению.Добавить("ВТДанныеОсобыхРегистраторов");
	ТаблицыКУдалению.Добавить("ВТПодробноБезНулевыхОснований");
	ТаблицыКУдалению.Добавить("ВТВсегоПоФизическомуЛицу");
	
	Запрос.Текст =  
	"ВЫБРАТЬ
	|	ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
	|	ПодробныеДанные.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
	|	НАЧАЛОПЕРИОДА(ПодробныеДанные.МесяцНалоговогоПериода, МЕСЯЦ) КАК МесяцНалоговогоПериода,
	|	СУММА(ПодробныеДанные.СуммаОстаток) КАК СуммаОстаток
	|ПОМЕСТИТЬ ВТПоФизическомуЛицуЗаМесяц
	|ИЗ
	|	ВТПодробноБезНулевыхОснований КАК ПодробныеДанные
	|
	|СГРУППИРОВАТЬ ПО
	|	ПодробныеДанные.ФизическоеЛицо,
	|	ПодробныеДанные.СтавкаНалогообложенияРезидента,
	|	НАЧАЛОПЕРИОДА(ПодробныеДанные.МесяцНалоговогоПериода, МЕСЯЦ)";
	Запрос.Выполнить();
	ТаблицыКУдалению.Добавить("ВТПоФизическомуЛицуЗаМесяц");
	
	Если ЗначениеЗаполнено(ПериодРегистрации) Тогда
		
		Запрос.УстановитьПараметр("НачалоГода", НачалоГода(ПериодРегистрации));
		Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(ПериодРегистрации));
		Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(ПериодРегистрации));
		Запрос.Текст =  
		"ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	ГОД(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода) КАК НалоговыйПериод
		|ПОМЕСТИТЬ ВТПерерасчетыПрошлыхПериодов
		|ИЗ
		|	ВТСуммыНДФЛПоСотрудникам КАК СписокСотрудников
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|		ПО СписокСотрудников.ФизическоеЛицо = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор <> &Регистратор
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода < &НачалоГода
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация
		|
		|СГРУППИРОВАТЬ ПО
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтавкаНалогообложенияРезидента,
		|	ГОД(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода)
		|
		|ИМЕЮЩИЕ
		|	СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) < 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПодробныеДанные.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	ГОД(ПодробныеДанные.МесяцНалоговогоПериода) КАК НалоговыйПериод,
		|	СУММА(ПодробныеДанные.СуммаОстаток) КАК СуммаОстаток,
		|	МАКСИМУМ(ПодробныеДанные.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода
		|ПОМЕСТИТЬ ВТВсегоПоФизическомуЛицуЗаНалоговыйПериод
		|ИЗ
		|	ВТПоФизическомуЛицуЗаМесяц КАК ПодробныеДанные
		|
		|СГРУППИРОВАТЬ ПО
		|	ПодробныеДанные.ФизическоеЛицо,
		|	ПодробныеДанные.СтавкаНалогообложенияРезидента,
		|	ГОД(ПодробныеДанные.МесяцНалоговогоПериода)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПодробныеДанные.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СУММА(ПодробныеДанные.СуммаОстаток) КАК СуммаОстаток,
		|	СУММА(ВЫБОР
		|			КОГДА ПерерасчетыПрошлыхПериодов.ФизическоеЛицо ЕСТЬ НЕ NULL 
		|					И ПодробныеДанные.СуммаОстаток < 0
		|				ТОГДА ПодробныеДанные.СуммаОстаток
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ВозвратПрошлыхПериодов
		|ПОМЕСТИТЬ ВТВсегоПоФизическомуЛицу
		|ИЗ
		|	ВТВсегоПоФизическомуЛицуЗаНалоговыйПериод КАК ПодробныеДанные
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПерерасчетыПрошлыхПериодов КАК ПерерасчетыПрошлыхПериодов
		|		ПО ПодробныеДанные.ФизическоеЛицо = ПерерасчетыПрошлыхПериодов.ФизическоеЛицо
		|			И ПодробныеДанные.СтавкаНалогообложенияРезидента = ПерерасчетыПрошлыхПериодов.СтавкаНалогообложенияРезидента
		|			И ПодробныеДанные.НалоговыйПериод = ПерерасчетыПрошлыхПериодов.НалоговыйПериод
		|ГДЕ
		|	(ПодробныеДанные.СуммаОстаток > 0
		|			ИЛИ ПерерасчетыПрошлыхПериодов.ФизическоеЛицо ЕСТЬ НЕ NULL )
		|
		|СГРУППИРОВАТЬ ПО
		|	ПодробныеДанные.ФизическоеЛицо,
		|	ПодробныеДанные.СтавкаНалогообложенияРезидента
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СуммыНДФЛПоСотрудникам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	ВсегоПоФизическомуЛицуЗаНалоговыйПериод.НалоговыйПериод КАК НалоговыйПериод,
		|	ВсегоПоФизическомуЛицуЗаНалоговыйПериод.СуммаОстаток КАК ОстатокЗаНалоговыйПериод,
		|	ВсегоПоФизическомуЛицуЗаНалоговыйПериод.МесяцНалоговогоПериода КАК ПоследнийМесяцНалоговогоПериода,
		|	СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	НАЧАЛОПЕРИОДА(СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяцаНалоговогоПериода,
		|	СуммыНДФЛПоСотрудникам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	СуммыНДФЛПоСотрудникам.КатегорияДохода КАК КатегорияДохода,
		|	СуммыНДФЛПоСотрудникам.КодДохода КАК КодДохода,
		|	СуммыНДФЛПоСотрудникам.ДокументОснование КАК ДокументОснование,
		|	СуммыНДФЛПоСотрудникам.СуммаОстаток КАК СуммаОстаток,
		|	СуммыНДФЛПоСотрудникам.НачисленоНалога КАК НачисленоНалога,
		|	СуммыНДФЛПоСотрудникам.Организация КАК Организация,
		|	СуммыНДФЛПоСотрудникам.Подразделение КАК Подразделение,
		|	СуммыНДФЛПоСотрудникам.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СуммыНДФЛПоСотрудникам.СуммаВыплаты - ВсегоПоФизическомуЛицу.ВозвратПрошлыхПериодов КАК СуммаВыплаты,
		|	ПоФизическомуЛицуЗаМесяц.СуммаОстаток КАК СуммаЗаМесяц
		|ИЗ
		|	ВТПодробноБезНулевыхОснований КАК СуммыНДФЛПоСотрудникам
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВсегоПоФизическомуЛицуЗаНалоговыйПериод КАК ВсегоПоФизическомуЛицуЗаНалоговыйПериод
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТПерерасчетыПрошлыхПериодов КАК ПерерасчетыПрошлыхПериодов
		|			ПО ВсегоПоФизическомуЛицуЗаНалоговыйПериод.ФизическоеЛицо = ПерерасчетыПрошлыхПериодов.ФизическоеЛицо
		|				И ВсегоПоФизическомуЛицуЗаНалоговыйПериод.СтавкаНалогообложенияРезидента = ПерерасчетыПрошлыхПериодов.СтавкаНалогообложенияРезидента
		|				И ВсегоПоФизическомуЛицуЗаНалоговыйПериод.НалоговыйПериод = ПерерасчетыПрошлыхПериодов.НалоговыйПериод
		|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = ВсегоПоФизическомуЛицуЗаНалоговыйПериод.ФизическоеЛицо
		|			И СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента = ВсегоПоФизическомуЛицуЗаНалоговыйПериод.СтавкаНалогообложенияРезидента
		|			И (ГОД(СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода) = ВсегоПоФизическомуЛицуЗаНалоговыйПериод.НалоговыйПериод)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВсегоПоФизическомуЛицу КАК ВсегоПоФизическомуЛицу
		|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = ВсегоПоФизическомуЛицу.ФизическоеЛицо
		|			И СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента = ВсегоПоФизическомуЛицу.СтавкаНалогообложенияРезидента
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоФизическомуЛицуЗаМесяц КАК ПоФизическомуЛицуЗаМесяц
		|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = ПоФизическомуЛицуЗаМесяц.ФизическоеЛицо
		|			И СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента = ПоФизическомуЛицуЗаМесяц.СтавкаНалогообложенияРезидента
		|			И (НАЧАЛОПЕРИОДА(СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода, МЕСЯЦ) = ПоФизическомуЛицуЗаМесяц.МесяцНалоговогоПериода)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоФизическомуЛицуНаДатуПолученияДохода КАК ПоФизическомуЛицуНаДатуПолученияДохода
		|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = ПоФизическомуЛицуНаДатуПолученияДохода.ФизическоеЛицо
		|			И СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента = ПоФизическомуЛицуНаДатуПолученияДохода.СтавкаНалогообложенияРезидента
		|			И СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода = ПоФизическомуЛицуНаДатуПолученияДохода.ДатаПолученияДохода
		|ГДЕ
		|	ВсегоПоФизическомуЛицу.СуммаОстаток > 0
		|	И ПоФизическомуЛицуНаДатуПолученияДохода.СуммаОстаток <> 0
		|	И (ВсегоПоФизическомуЛицуЗаНалоговыйПериод.СуммаОстаток > 0
		|			ИЛИ ПерерасчетыПрошлыхПериодов.ФизическоеЛицо ЕСТЬ НЕ NULL )
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	НалоговыйПериод,
		|	НачалоМесяцаНалоговогоПериода,
		|	МесяцНалоговогоПериода,
		|	СуммыНДФЛПоСотрудникам.ДатаНачисления,
		|	ДокументОснование,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	СуммыНДФЛПоСотрудникам.КатегорияДохода,
		|	ВключатьВДекларациюПоНалогуНаПрибыль";
		
		Выборка = Запрос.ВыполнитьПакет()[3].Выбрать();
		
		ТаблицыКУдалению.Добавить("ВТПерерасчетыПрошлыхПериодов");
		ТаблицыКУдалению.Добавить("ВТВсегоПоФизическомуЛицуЗаНалоговыйПериод");
		
	Иначе
		
		Запрос.Текст =  
		"ВЫБРАТЬ 
		|	ПодробныеДанные.ФизическоеЛицо КАК ФизическоеЛицо,
		|	ПодробныеДанные.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	СУММА(ПодробныеДанные.СуммаОстаток) КАК СуммаОстаток,
		|	ГОД(ПодробныеДанные.МесяцНалоговогоПериода) КАК НалоговыйПериод
		|ПОМЕСТИТЬ ВТВсегоПоФизическомуЛицу
		|ИЗ
		|	ВТПодробноБезНулевыхОснований КАК ПодробныеДанные
		|
		|СГРУППИРОВАТЬ ПО
		|	ПодробныеДанные.ФизическоеЛицо,
		|	ПодробныеДанные.СтавкаНалогообложенияРезидента,
		|	ГОД(ПодробныеДанные.МесяцНалоговогоПериода)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СуммыНДФЛПоСотрудникам.ФизическоеЛицо КАК ФизическоеЛицо,
		|	СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента КАК СтавкаНалогообложенияРезидента,
		|	ВсегоПоФизическомуЛицу.НалоговыйПериод КАК НалоговыйПериод,
		|	ВсегоПоФизическомуЛицу.СуммаОстаток КАК ОстатокЗаНалоговыйПериод,
		|	НАЧАЛОПЕРИОДА(СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода, МЕСЯЦ) КАК НачалоМесяцаНалоговогоПериода,
		|	СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	СуммыНДФЛПоСотрудникам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
		|	СуммыНДФЛПоСотрудникам.КодДохода КАК КодДохода,
		|	СуммыНДФЛПоСотрудникам.КатегорияДохода КАК КатегорияДохода,
		|	СуммыНДФЛПоСотрудникам.ДокументОснование КАК ДокументОснование,
		|	СуммыНДФЛПоСотрудникам.СуммаОстаток КАК СуммаОстаток,
		|	СуммыНДФЛПоСотрудникам.НачисленоНалога КАК НачисленоНалога,
		|	СуммыНДФЛПоСотрудникам.Организация КАК Организация,
		|	СуммыНДФЛПоСотрудникам.Подразделение КАК Подразделение,
		|	СуммыНДФЛПоСотрудникам.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
		|	СуммыНДФЛПоСотрудникам.СуммаВыплаты КАК СуммаВыплаты,
		|	ПоФизическомуЛицуЗаМесяц.СуммаОстаток КАК СуммаЗаМесяц
		|ИЗ
		|	ВТПодробноБезНулевыхОснований КАК СуммыНДФЛПоСотрудникам
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВсегоПоФизическомуЛицу КАК ВсегоПоФизическомуЛицу
		|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = ВсегоПоФизическомуЛицу.ФизическоеЛицо
		|			И СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента = ВсегоПоФизическомуЛицу.СтавкаНалогообложенияРезидента
		|			И (ГОД(СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода) = ВсегоПоФизическомуЛицу.НалоговыйПериод)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоФизическомуЛицуЗаМесяц КАК ПоФизическомуЛицуЗаМесяц
		|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = ПоФизическомуЛицуЗаМесяц.ФизическоеЛицо
		|			И СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента = ПоФизическомуЛицуЗаМесяц.СтавкаНалогообложенияРезидента
		|			И (НАЧАЛОПЕРИОДА(СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода, МЕСЯЦ) = ПоФизическомуЛицуЗаМесяц.МесяцНалоговогоПериода)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоФизическомуЛицуНаДатуПолученияДохода КАК ПоФизическомуЛицуНаДатуПолученияДохода
		|		ПО СуммыНДФЛПоСотрудникам.ФизическоеЛицо = ПоФизическомуЛицуНаДатуПолученияДохода.ФизическоеЛицо
		|			И СуммыНДФЛПоСотрудникам.СтавкаНалогообложенияРезидента = ПоФизическомуЛицуНаДатуПолученияДохода.СтавкаНалогообложенияРезидента
		|			И СуммыНДФЛПоСотрудникам.МесяцНалоговогоПериода = ПоФизическомуЛицуНаДатуПолученияДохода.ДатаПолученияДохода
		|ГДЕ
		|	ВсегоПоФизическомуЛицу.СуммаОстаток > 0
		|	И ПоФизическомуЛицуНаДатуПолученияДохода.СуммаОстаток <> 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ФизическоеЛицо,
		|	СтавкаНалогообложенияРезидента,
		|	НалоговыйПериод,
		|	НачалоМесяцаНалоговогоПериода,
		|	МесяцНалоговогоПериода,
		|	СуммыНДФЛПоСотрудникам.ДатаНачисления,
		|	ДокументОснование,
		|	РегистрацияВНалоговомОргане,
		|	Подразделение,
		|	КатегорияДохода,
		|	ВключатьВДекларациюПоНалогуНаПрибыль";
		
		Выборка = Запрос.ВыполнитьПакет()[1].Выбрать();
		
	КонецЕсли;
	
	Пока Выборка.СледующийПоЗначениюПоля("ФизическоеЛицо") Цикл 
		
		СуммаКРаспределению = Выборка.СуммаВыплаты;
		Пока Выборка.СледующийПоЗначениюПоля("СтавкаНалогообложенияРезидента") И СуммаКРаспределению >= 0 Цикл 
			Пока Выборка.СледующийПоЗначениюПоля("НалоговыйПериод") И СуммаКРаспределению >= 0 Цикл 
				Если Выборка.ОстатокЗаНалоговыйПериод >= 0 Тогда
					ОстатокКУдержанию = 0;
					Пока Выборка.СледующийПоЗначениюПоля("НачалоМесяцаНалоговогоПериода") И СуммаКРаспределению > 0 Цикл 
						ОстатокКУдержанию = ОстатокКУдержанию + Выборка.СуммаЗаМесяц;
						Если ОстатокКУдержанию > 0 И Выборка.СуммаЗаМесяц > 0 Тогда
							Пока Выборка.Следующий() И СуммаКРаспределению > 0 И ОстатокКУдержанию > 0 Цикл
								Если Выборка.СуммаОстаток > 0 Тогда
									
									СписываемаяСумма = Мин(Выборка.СуммаОстаток, СуммаКРаспределению, ОстатокКУдержанию);
									СуммаКРаспределению = СуммаКРаспределению - СписываемаяСумма;
									ОстатокКУдержанию = ОстатокКУдержанию - СписываемаяСумма;
									
									СтрокаТаблицыРезультатов = РезультатыРасчетов.Добавить();
									ЗаполнитьЗначенияСвойств(СтрокаТаблицыРезультатов, Выборка);
									СтрокаТаблицыРезультатов.Сумма = СписываемаяСумма;			
									
								КонецЕсли;
							КонецЦикла;			
						КонецЕсли;
					КонецЦикла;			
				Иначе
					СуммаКРаспределению = СуммаКРаспределению - Выборка.ОстатокЗаНалоговыйПериод;
					СтрокаТаблицыРезультатов = РезультатыРасчетов.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаТаблицыРезультатов, Выборка);
					СтрокаТаблицыРезультатов.Сумма = Выборка.ОстатокЗаНалоговыйПериод;			
					СтрокаТаблицыРезультатов.МесяцНалоговогоПериода = Выборка.ПоследнийМесяцНалоговогоПериода;			
				КонецЕсли;
			КонецЦикла;	
		КонецЦикла;	
		
	КонецЦикла;	
	
	ЗарплатаКадры.УничтожитьВТ(МенеджерТаблиц, ТаблицыКУдалению);
	
	Возврат РезультатыРасчетов;
	
КонецФункции

#КонецОбласти

// Вызовы экспортных методов

Процедура ВписатьВРезультатЗачтенныеАвансы(Регистратор, Организация, МесяцРасчета, РезультатыРасчетов, СтавкаНалога, ИмяКолонкиНалогаИсчисленного, ИмяКолонкиАвансаЗачтенного, ИсключатьДвиженияРегистратора = Истина, МенеджерВременныхТаблиц = Неопределено) 
	
	УчетНДФЛ.ВписатьВРезультатЗачтенныеАвансы(Регистратор, Организация, МесяцРасчета, РезультатыРасчетов, СтавкаНалога, ИмяКолонкиНалогаИсчисленного, ИмяКолонкиАвансаЗачтенного, ИсключатьДвиженияРегистратора, МенеджерВременныхТаблиц) 

КонецПроцедуры 

Процедура ВписатьТекстПолученияЗначенияСтавкиНДФЛЧислом(ТекстЗапроса, Знач ПодстрокаПоиска, Знач СинонимТаблицы, Знач ИмяПоляСтавки)
	
	УчетНДФЛ.ВписатьТекстПолученияЗначенияСтавкиНДФЛЧислом(ТекстЗапроса, ПодстрокаПоиска, СинонимТаблицы, ИмяПоляСтавки)	
	
КонецПроцедуры

Процедура СоздатьВТРегистрацииВНалоговомОрганеОрганизацииОКАТОКПП(Организация, МенеджерВременныхТаблиц)

	УчетНДФЛ.СоздатьВТРегистрацииВНалоговомОрганеОрганизацииОКАТОКПП(Организация, МенеджерВременныхТаблиц)
	
КонецПроцедуры 

Процедура СоздатьВТСтавкиНалогаЧислом(МенеджерВременныхТаблиц) 
	
	УчетНДФЛ.СоздатьВТСтавкиНалогаЧислом(МенеджерВременныхТаблиц)

КонецПроцедуры

Процедура СформироватьВТФизическиеЛицаСУчетомПереездаВИнойНО(КППОтправки, МенеджерВременныхТаблиц, ИмяТаблицыПодразделений, ПолеДаты)  
	
	УчетНДФЛ.СформироватьВТФизическиеЛицаСУчетомПереездаВИнойНО(КППОтправки, МенеджерВременныхТаблиц, ИмяТаблицыПодразделений, ПолеДаты)
	
КонецПроцедуры

Функция ТаблицаНДФЛ()
	
	Возврат УчетНДФЛ.ТаблицаНДФЛ();
	
КонецФункции

// Копии неэкспортных методов

Функция ПараметрыРасчетаНДФЛПоПрогрессивнойШкале() 

	Параметры = Новый Структура();
	Параметры.Вставить("Предел", 5000000);
	Параметры.Вставить("НалогСПредела", 650000);
	Параметры.Вставить("НачалоРасчетаНДФЛПоПрогрессивнойШкале", '20210101');
	Параметры.Вставить("ДатаОбъединенияНалоговыхБаз", '20240101');
	Параметры.Вставить("ГодОбъединенияНалоговыхБаз", 2024);
	Параметры.Вставить("Ставка", Перечисления.НДФЛСтавки.Ставка15);
	Параметры.Вставить("СтавкаЧислом", 0.15);

	Возврат Параметры
	
КонецФункции // Параметры()

Функция РассчитываемыеРесурсыПоОсновнойСтавке()

	Возврат "НалогПоСтавке13,НалогСПревышения,ПримененныйВычетЛичный," + РассчитываемыеРесурсыВычетовНаДетей() + "," + РассчитываемыеРесурсыИмущественныхВычетов();

КонецФункции 

Функция РассчитываемыеРесурсыВычетовНаДетей()

	Возврат "ПримененныйВычетНаДетей,ПримененныйВычетНаДетейДвойной,ПримененныйВычетНаДетейДвойнойВторой,ПримененныйВычетНаВторогоРебенка,ПримененныйВычетНаВторогоРебенкаДвойной,ПримененныйВычетНаВторогоРебенкаДвойнойВторой,ПримененныйВычетНаТретьегоРебенка,ПримененныйВычетНаТретьегоРебенкаДвойной,ПримененныйВычетНаТретьегоРебенкаДвойнойВторой,ПримененныйВычетНаДетейИнвалидов,ПримененныйВычетНаДетейИнвалидовДвойной,ПримененныйВычетНаДетейИнвалидовДвойнойВторой" +
			",ПримененныйВычетНаДетейОпекунов,ПримененныйВычетНаДетейДвойнойОпекунов,ПримененныйВычетНаДетейДвойнойВторойОпекунов,ПримененныйВычетНаВторогоРебенкаОпекунов,ПримененныйВычетНаВторогоРебенкаДвойнойОпекунов,ПримененныйВычетНаВторогоРебенкаДвойнойВторойОпекунов,ПримененныйВычетНаТретьегоРебенкаОпекунов,ПримененныйВычетНаТретьегоРебенкаДвойнойОпекунов,ПримененныйВычетНаТретьегоРебенкаДвойнойВторойОпекунов,ПримененныйВычетНаДетейИнвалидовОпекунов,ПримененныйВычетНаДетейИнвалидовДвойнойОпекунов,ПримененныйВычетНаДетейИнвалидовДвойнойВторойОпекунов";

КонецФункции 

Функция РассчитываемыеРесурсыИмущественныхВычетов()

	Возврат "ПримененныйВычетРасходыНаДорогостоящееЛечение,ПримененныйВычетВзносыНаДобровольноеСтрахованиеЖизни,ПримененныйВычетСтраховыеВзносыНаМедУслуги,ПримененныйВычетРасходыНаЛечение,ПримененныйВычетРасходыНаОбучениеДетей,ПримененныйВычетРасходыНаСвоеОбучение,ПримененныйВычетИмущественныйПроцентыПоКредитам,ПримененныйВычетИмущественныйПроцентыПриПерекредитовании,ПримененныйВычетИмущественныйРасходы";

КонецФункции 

Процедура ВписатьВРезультатЗарегистрированныеВУчетеДанные(РезультатыРасчетов, ЗарегистрированныеВУчетеДанные, ИменаКолонок)
	
	Для каждого СтрокаТЗ Из ЗарегистрированныеВУчетеДанные Цикл
		ЗаполнитьЗначенияСвойств(РезультатыРасчетов.Добавить(), СтрокаТЗ, "ФизическоеЛицо, МесяцНалоговогоПериода, Подразделение," + ИменаКолонок);
	КонецЦикла;
	
КонецПроцедуры

Процедура ВписатьРесурсВРезультатыРасчетовБО(РезультатыРасчетов, МесяцНалоговогоПериода, Сумма, ИмяРесурса, СтруктураКлючей, СтрокиРаспределения, КоэффициентыРаспределения, ТочностьВеличины = 2, ПоляЗаполнения = "Подразделение")
	
	Если Сумма = 0 Тогда
		Возврат
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(КоэффициентыРаспределения) Тогда
		НоваяСтрока = РезультатыРасчетов.Добавить();
		НоваяСтрока[ИмяРесурса] = Сумма; 
		НоваяСтрока.МесяцНалоговогоПериода = МесяцНалоговогоПериода; 
		ЗаполнитьЗначенияСвойств(НоваяСтрока, СтруктураКлючей, "ФизическоеЛицо");
	ИначеЕсли КоэффициентыРаспределения.Количество() = 1 Тогда
		НоваяСтрока = РезультатыРасчетов.Добавить();
		НоваяСтрока[ИмяРесурса] = Сумма; 
		НоваяСтрока.МесяцНалоговогоПериода = МесяцНалоговогоПериода; 
		ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокиРаспределения[0], "ФизическоеЛицо, " + ПоляЗаполнения);
	Иначе
		РаспределениеРесурса = ЗарплатаКадрыКлиентСервер.РаспределитьПропорциональноКоэффициентам(Сумма, КоэффициентыРаспределения, ТочностьВеличины);
		Если РаспределениеРесурса = Неопределено Тогда
			НоваяСтрока = РезультатыРасчетов.Добавить();
			НоваяСтрока[ИмяРесурса] = Сумма; 
			НоваяСтрока.МесяцНалоговогоПериода = МесяцНалоговогоПериода; 
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтруктураКлючей, "ФизическоеЛицо");
		Иначе
			Индекс = 0;
			Для каждого СтрокаТЗ Из СтрокиРаспределения Цикл
				НоваяСтрока = РезультатыРасчетов.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЗ, "ФизическоеЛицо, " + ПоляЗаполнения);
				НоваяСтрока[ИмяРесурса] = РаспределениеРесурса[Индекс];
				НоваяСтрока.МесяцНалоговогоПериода = МесяцНалоговогоПериода; 
				Индекс = Индекс + 1;
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультатБО(РезультатыРасчетов, МежрасчетныйНДФЛ, ДатаУдержанияИсчисленногоНалога, МесяцРасчета, Знач ВсегоДоходов = 0) 
	
	Если МежрасчетныйНДФЛ.Итог("НалогПоСтавке13") >= 0 Тогда
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(МежрасчетныйНДФЛ, РезультатыРасчетов);
	Иначе
		
		ТекущийПериод = НачалоМесяца(?(ЗначениеЗаполнено(ДатаУдержанияИсчисленногоНалога), ДатаУдержанияИсчисленногоНалога, МесяцРасчета));
		СтруктураПоискаТекущегоНДФЛ = Новый Структура("МесяцНалоговогоПериодаДляПоиска", ТекущийПериод);
		
		Если МежрасчетныйНДФЛ.Колонки.Найти("МесяцНалоговогоПериодаДляПоиска") = Неопределено Тогда
			МежрасчетныйНДФЛ.Колонки.Добавить("МесяцНалоговогоПериодаДляПоиска", Новый ОписаниеТипов("Дата"));
		КонецЕсли;
		Для каждого СтрокаДанных Из МежрасчетныйНДФЛ Цикл
			Если ЗначениеЗаполнено(СтрокаДанных.МесяцНалоговогоПериода) Тогда
				СтрокаДанных.МесяцНалоговогоПериодаДляПоиска = НачалоМесяца(СтрокаДанных.МесяцНалоговогоПериода)
			КонецЕсли;
		КонецЦикла;
		
		НДФЛТекущегоПериода = МежрасчетныйНДФЛ.Скопировать(СтруктураПоискаТекущегоНДФЛ);
		НДФЛТекущегоПериодаВсего = НДФЛТекущегоПериода.Итог("НалогПоСтавке13");
		Если НДФЛТекущегоПериодаВсего < 0 Тогда // произошел перерасчет обязательств текущего периода из-за изменения данных "задним" числом
			
			Если ВсегоДоходов <= 0 Тогда // оказалось, что располагаемых доходов нет
				Возврат
			КонецЕсли;
			
			НДФЛТекущегоПериода.Сортировать("МесяцНалоговогоПериода");
			МассивРесурсов = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(РассчитываемыеРесурсыПоОсновнойСтавке());
			Для каждого СтрокаДанных Из НДФЛТекущегоПериода Цикл
				ЕстьДанныеВСтроке = Ложь;
				Для каждого ИмяРесурса Из МассивРесурсов Цикл
					Если ИмяРесурса = "НалогПоСтавке13" Тогда
						СтрокаДанных[ИмяРесурса] = 0
					ИначеЕсли ВсегоДоходов > 0 Тогда
						Учтено = Мин(СтрокаДанных[ИмяРесурса], ВсегоДоходов);
						СтрокаДанных[ИмяРесурса] = Учтено;
						ВсегоДоходов = ВсегоДоходов - Учтено;
					Иначе
						СтрокаДанных[ИмяРесурса] = 0
					КонецЕсли;
					Если Не ЕстьДанныеВСтроке Тогда
						ЕстьДанныеВСтроке = СтрокаДанных[ИмяРесурса] <> 0;
					КонецЕсли;
				КонецЦикла;
				Если ЕстьДанныеВСтроке Тогда
					ЗаполнитьЗначенияСвойств(РезультатыРасчетов.Добавить(),СтрокаДанных);
				КонецЕсли;
				Если ВсегоДоходов = 0 Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла; 
			
		Иначе
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(НДФЛТекущегоПериода, РезультатыРасчетов);
			МежрасчетныйНДФЛ.Сортировать("МесяцНалоговогоПериода Убыв");
			// Налоги предыдущих периодов добавляем в пределах положительного налога текущего периода,
			// не допуская возврата налога.
			Для каждого СтрокаДанных Из МежрасчетныйНДФЛ Цикл
				Если СтрокаДанных.МесяцНалоговогоПериодаДляПоиска = ТекущийПериод Тогда
					Продолжить;
				КонецЕсли;
				Если НДФЛТекущегоПериодаВсего + СтрокаДанных.НалогПоСтавке13 >= 0 Тогда
					ЗаполнитьЗначенияСвойств(РезультатыРасчетов.Добавить(), СтрокаДанных);
					НДФЛТекущегоПериодаВсего = НДФЛТекущегоПериодаВсего + СтрокаДанных.НалогПоСтавке13;
				ИначеЕсли НДФЛТекущегоПериодаВсего > 0 Тогда
					НоваяСтрока = РезультатыРасчетов.Добавить();
					ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаДанных);
					НоваяСтрока.НалогПоСтавке13 = - НДФЛТекущегоПериодаВсего;
					НДФЛТекущегоПериодаВсего = 0
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ВыделитьРаспределениеДоходов(РаспределениеДоходовПоПодразделениям, СтруктураПоискаПоДатам, Доходы, КоэффициентыПодразделений, ДоходыМесяцаРасчета, КоэффициентыПодразделенийМесяцаРасчета)
	
	Доходы = РаспределениеДоходовПоПодразделениям.НайтиСтроки(СтруктураПоискаПоДатам);
	БазаРаспределения = 0;
	Для каждого СтрокаРаспределения Из Доходы Цикл
		БазаРаспределения = БазаРаспределения + СтрокаРаспределения.СуммаДохода;
	КонецЦикла; 
	Если БазаРаспределения = 0 Тогда
		// если доходов за прошлый месяц нет - будем использовать текущее распределение
		Доходы = ДоходыМесяцаРасчета;
		КоэффициентыПодразделений = КоэффициентыПодразделенийМесяцаРасчета;
	Иначе
		КоэффициентыПодразделений = ОбщегоНазначения.ВыгрузитьКолонку(Доходы, "СуммаДохода");
	КонецЕсли;
	
КонецПроцедуры

Функция ЕстьДанныеВСтроке(СтрокаКоллекции, ИменаРесурсов)
	Для каждого ИмяРесурса Из ИменаРесурсов Цикл
		Если ЗначениеЗаполнено(СтрокаКоллекции[ИмяРесурса]) Тогда
			Возврат Истина	
		КонецЕсли;
	КонецЦикла;
	Возврат Ложь	
КонецФункции

Функция ЕстьДанныеВТаблицеФизическогоЛица(ТаблицаДанных, ИменаРесурсов)
	
	КоличествоСтрок = ТаблицаДанных.Количество();
	Если КоличествоСтрок = 0 Тогда
		Возврат Ложь                            
	ИначеЕсли КоличествоСтрок = 1 Тогда
		Возврат ЕстьДанныеВСтроке(ТаблицаДанных[0], ИменаРесурсов) 	
	КонецЕсли;
	
	Для каждого ИмяРесурса Из ИменаРесурсов Цикл
		Если ЗначениеЗаполнено(ТаблицаДанных.Итог(ИмяРесурса)) Тогда
			Возврат Истина	
		КонецЕсли;
	КонецЦикла;
	
	ТаблицаИзмерений = ТаблицаДанных.Скопировать(,"Подразделение, КатегорияДохода");
	ТаблицаИзмерений.Свернуть("Подразделение, КатегорияДохода",);
	
	Возврат ТаблицаИзмерений.Количество() > 1   

КонецФункции

Функция УдалитьПоляРасшифровкиИзЗапроса(Знач ТекстЗапроса, МассивПолей, ИмяТаблицы = "СведенияОДоходах")
	
	Для каждого ПолеРасшифровки Из МассивПолей Цикл
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,ИмяТаблицы + "." + ПолеРасшифровки,"Неопределено");
	КонецЦикла;
	
	Возврат ТекстЗапроса
	
КонецФункции	


// Предназначена для дополнения рассчитанных сумм НДФЛ информацией о суммах подлежащих зачету авансовых платежей.
// Имеет дополнительный эффект: если в параметр ИсчисленоНДФЛЗаГод передано Неопределено, а итог по колонкам 
// НалогПоСтавке13, НалогСПревышения в таблице СтрокиНДФЛЗаГод нулевой - эта таблица очищается. 
//
// Параметры:
//      СтрокиНДФЛЗаГод - Массив, ТаблицаЗначений - массив содержит строки таблицы значений, в обоих случаях обязательны
//                                                  колонки НалогПоСтавке13, НалогСПревышения и ЗачтеноАвансовыхПлатежейПоСтавке13, ЗачтеноАвансовыхПлатежейСПревышения
//		ОстаткиПоАвансовымПлатежам - ТаблицаЗначений -
//		ИсчисленоНДФЛЗаГод - Число, Неопределено - если передано Неопределено, вычисляется как итог по колонке НалогПоСтавке13 таблицы значений СтрокиНДФЛЗаГод
//      ТекущееФизическоеЛицо - СправочникСсылка.ФизическиеЛица - 
//      ТекущийНалоговыйПериод - Дата -
//
Процедура ВписатьАвансовыеПлатежиВРезультатРасчета(СтрокиНДФЛЗаГод, ОстаткиПоАвансовымПлатежам, ИсчисленоНДФЛЗаГод, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод)
	
	Если ИсчисленоНДФЛЗаГод = Неопределено Тогда  // вызов из расчета нерезидента, СтрокиНДФЛЗаГод являются таблицей значений
		ИсчисленоНДФЛЗаГод = СтрокиНДФЛЗаГод.Итог("НалогПоСтавке13") + СтрокиНДФЛЗаГод.Итог("НалогСПревышения");
		Если ИсчисленоНДФЛЗаГод = 0 Тогда
			СтрокиНДФЛЗаГод.Очистить();
			Возврат;
		Иначе
			СтрокиНДФЛЗаГод.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода", "НалогПоСтавке13, НалогСПревышения, КоличествоВычетов, ЗачтеноАвансовыхПлатежейПоСтавке13, ЗачтеноАвансовыхПлатежейСПревышения");
		КонецЕсли;
	ИначеЕсли ИсчисленоНДФЛЗаГод = 0 Тогда
		Возврат;
	КонецЕсли;
		
	НайденныеСтрокиАвансовыхПлатежей = ОстаткиПоАвансовымПлатежам.НайтиСтроки(Новый Структура("ФизическоеЛицо, НалоговыйПериод", ТекущееФизическоеЛицо, Год(ТекущийНалоговыйПериод)));
	Если НайденныеСтрокиАвансовыхПлатежей.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;	
	ОстатокАвансовыхПлатежей = НайденныеСтрокиАвансовыхПлатежей[0].Остаток;
	
	СуммаКЗачету = Мин(ИсчисленоНДФЛЗаГод, ОстатокАвансовыхПлатежей);
	Для Каждого СтрокаНДФЛ Из СтрокиНДФЛЗаГод Цикл
		Если (СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения) * СуммаКЗачету > 0 Тогда
			Если СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения > 0 Тогда
				КЗачетуПоСтроке = Мин(СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения, СуммаКЗачету);
				СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейПоСтавке13 = Мин(СтрокаНДФЛ.НалогПоСтавке13, КЗачетуПоСтроке);
			Иначе
				КЗачетуПоСтроке = Макс(СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения, СуммаКЗачету);
				СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейПоСтавке13 = Макс(СтрокаНДФЛ.НалогПоСтавке13, КЗачетуПоСтроке);
			КонецЕсли;
			СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейСПревышения = КЗачетуПоСтроке - СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейПоСтавке13;
			СуммаКЗачету = СуммаКЗачету - КЗачетуПоСтроке;
			Если СуммаКЗачету = 0 Тогда
				Возврат;
			КонецЕсли;
		КонецЕсли;	
	КонецЦикла;
	
КонецПроцедуры	

// Предназначена для дополнения рассчитанных сумм НДФЛ информацией о суммах подлежащих зачету авансовых платежей.
// Имеет дополнительный эффект: если в параметр ИсчисленоНДФЛЗаГод передано Неопределено, а итог по колонкам 
// НалогПоСтавке13, НалогСПревышения в таблице СтрокиНДФЛЗаГод нулевой - эта таблица очищается. 
//
// Параметры:
//      СтрокиНДФЛЗаГод - Массив, ТаблицаЗначений - массив содержит строки таблицы значений, в обоих случаях обязательны
//                                                  колонки НалогПоСтавке13, НалогСПревышения и ЗачтеноАвансовыхПлатежейПоСтавке13, ЗачтеноАвансовыхПлатежейСПревышения
//		ОстаткиПоАвансовымПлатежам - ТаблицаЗначений -
//		ИсчисленоНДФЛЗаГод - Число, Неопределено - если передано Неопределено, вычисляется как итог по колонке НалогПоСтавке13 таблицы значений СтрокиНДФЛЗаГод
//      ТекущееФизическоеЛицо - СправочникСсылка.ФизическиеЛица - 
//      ТекущийНалоговыйПериод - Дата -
//
Процедура ВписатьАвансовыеПлатежиВРезультатРасчета2024(СтрокиНДФЛЗаГод, ОстаткиПоАвансовымПлатежам, Знач ИсчисленоНДФЛЗаГод, ТекущееФизическоеЛицо, ТекущийНалоговыйПериод)
	
	Если ИсчисленоНДФЛЗаГод = Неопределено Тогда  // вызов из расчета нерезидента, СтрокиНДФЛЗаГод являются таблицей значений
		СтрокиНДФЛЗаГод.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода", "НалогПоСтавке13, НалогСПревышения, КоличествоВычетов, ЗачтеноАвансовыхПлатежейПоСтавке13, ЗачтеноАвансовыхПлатежейСПревышения");
	КонецЕсли;
	НайденныеСтрокиАвансовыхПлатежей = ОстаткиПоАвансовымПлатежам.НайтиСтроки(Новый Структура("ФизическоеЛицо, НалоговыйПериод", ТекущееФизическоеЛицо, Год(ТекущийНалоговыйПериод)));
	Если НайденныеСтрокиАвансовыхПлатежей.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;	
	
	ИсчисленоНДФЛЗаГод = 0;
	ОстатокАвансовыхПлатежей = Цел(НайденныеСтрокиАвансовыхПлатежей[0].Остаток); // Копейки зачесть не можем
	КатегорииТрудовойДеятельности = ОбщегоНазначенияБЗККлиентСервер.МассивВСоответствие(Перечисления.КатегорииДоходовНДФЛ.ДоходыОтТрудовойДеятельности());
	СтрокиКОбработке = Новый Массив;
	Для каждого СтрокаРезультата Из СтрокиНДФЛЗаГод Цикл
		Если ЗначениеЗаполнено(КатегорииТрудовойДеятельности[СтрокаРезультата.КатегорияДохода]) Тогда
			СтрокиКОбработке.Добавить(СтрокаРезультата);
			ИсчисленоНДФЛЗаГод = ИсчисленоНДФЛЗаГод + СтрокаРезультата.НалогПоСтавке13 + СтрокаРезультата.НалогСПревышения;
		КонецЕсли;
	КонецЦикла; 
	Если ИсчисленоНДФЛЗаГод = 0 Тогда
		Возврат;
	КонецЕсли;
	
	СуммаКЗачету = Мин(ИсчисленоНДФЛЗаГод, ОстатокАвансовыхПлатежей);
	Для Каждого СтрокаНДФЛ Из СтрокиКОбработке Цикл
		Если (СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения) * СуммаКЗачету > 0 Тогда
			Если СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения > 0 Тогда
				КЗачетуПоСтроке = Мин(СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения, СуммаКЗачету);
				СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейПоСтавке13 = Мин(СтрокаНДФЛ.НалогПоСтавке13, КЗачетуПоСтроке);
			Иначе
				КЗачетуПоСтроке = Макс(СтрокаНДФЛ.НалогПоСтавке13 + СтрокаНДФЛ.НалогСПревышения, СуммаКЗачету);
				СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейПоСтавке13 = Макс(СтрокаНДФЛ.НалогПоСтавке13, КЗачетуПоСтроке);
			КонецЕсли;
			СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейСПревышения = КЗачетуПоСтроке - СтрокаНДФЛ.ЗачтеноАвансовыхПлатежейПоСтавке13;
			СуммаКЗачету = СуммаКЗачету - КЗачетуПоСтроке;
			Если СуммаКЗачету = 0 Тогда
				Возврат;
			КонецЕсли;
		КонецЕсли;	
	КонецЦикла;
	
КонецПроцедуры	

Процедура ВписатьПредоставленныеРанееВычетыВДанныеУчета(ДанныеУчета, ПредоставленныеРанееВычеты)
	Для Каждого СтрокаВычета Из ПредоставленныеРанееВычеты Цикл
		Если СтрокаВычета.Сумма = 0 Тогда
			Продолжить;
		КонецЕсли;
		СтрокаУчета = ДанныеУчета.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаУчета, СтрокаВычета);
		СтрокаУчета.РазмерВычета = - СтрокаВычета.Сумма;
	КонецЦикла;	
КонецПроцедуры

// Аналог метод распределения пропорционально коэффициентам ЗарплатаКадрыКлиентСервер.РаспределитьПропорциональноКоэффициентам(), 
//	оптимальным образом использующий свойства таблицы значений.
Процедура ВписатьРесурсВРезультатыРасчетов(РезультатыРасчетов, ПараметрыЗаполненияРесурса, МесяцНалоговогоПериода, РаспределяемаяСумма, СтруктураКлючей, ТаблицаРаспределения, СтруктураДополнительныхПолей = Неопределено)
	
	МаксимальныйКоэффициент = 0;
	РаспределеннаяСумма = 0;
	СуммаКоэффициентов  = ТаблицаРаспределения.Итог(ПараметрыЗаполненияРесурса.ИмяПоляКоэффициент);
	
	КоличествоСтрокВТаблицеРезультат = РезультатыРасчетов.Количество();
	Если РаспределяемаяСумма <> 0 Тогда
		Если ТаблицаРаспределения.Количество() = 0 Или СуммаКоэффициентов = 0 Тогда
			НоваяСтрока = РезультатыРасчетов.Добавить();
			НоваяСтрока[ПараметрыЗаполненияРесурса.ИмяРесурса] = РаспределяемаяСумма; 
			НоваяСтрока.МесяцНалоговогоПериода = МесяцНалоговогоПериода; 
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтруктураКлючей, "ФизическоеЛицо");
			Если СтруктураДополнительныхПолей <> Неопределено Тогда
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтруктураДополнительныхПолей, ПараметрыЗаполненияРесурса.ДополнительныеПоляЗаполнения);
			КонецЕсли;	
		ИначеЕсли ТаблицаРаспределения.Количество() = 1 Тогда
			НоваяСтрока = РезультатыРасчетов.Добавить();
			НоваяСтрока[ПараметрыЗаполненияРесурса.ИмяРесурса] = РаспределяемаяСумма; 
			НоваяСтрока.МесяцНалоговогоПериода = МесяцНалоговогоПериода; 
			Если СтруктураДополнительныхПолей <> Неопределено Тогда
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтруктураДополнительныхПолей, ПараметрыЗаполненияРесурса.ДополнительныеПоляЗаполнения);
			КонецЕсли;	
			ЗаполнитьЗначенияСвойств(НоваяСтрока, ТаблицаРаспределения[0], "ФизическоеЛицо, " + ПараметрыЗаполненияРесурса.ПоляЗаполнения);	
		Иначе
			Индекс = 0;
			Для Каждого СтрокаТЗ Из ТаблицаРаспределения Цикл
				АбсолютноеЗначениеКоэффициента = Макс(СтрокаТЗ.СуммаДохода, -СтрокаТЗ.СуммаДохода);
				Если МаксимальныйКоэффициент < АбсолютноеЗначениеКоэффициента Тогда
					МаксимальныйКоэффициент = АбсолютноеЗначениеКоэффициента;
					ИндексМаксимальногоКоэффициента = КоличествоСтрокВТаблицеРезультат + ТаблицаРаспределения.Индекс(СтрокаТЗ);
				КонецЕсли;
				
				НоваяСтрока = РезультатыРасчетов.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЗ, "ФизическоеЛицо, " + ПараметрыЗаполненияРесурса.ПоляЗаполнения);
				НоваяСтрока.МесяцНалоговогоПериода = МесяцНалоговогоПериода; 
				
				НоваяСтрока[ПараметрыЗаполненияРесурса.ИмяРесурса] = Окр(РаспределяемаяСумма * СтрокаТЗ[ПараметрыЗаполненияРесурса.ИмяПоляКоэффициент] / СуммаКоэффициентов, ПараметрыЗаполненияРесурса.ТочностьВеличины, 1);
				Если СтруктураДополнительныхПолей <> Неопределено Тогда
					ЗаполнитьЗначенияСвойств(НоваяСтрока, СтруктураДополнительныхПолей, ПараметрыЗаполненияРесурса.ДополнительныеПоляЗаполнения);
				КонецЕсли;	
	
				РаспределеннаяСумма = РаспределеннаяСумма + НоваяСтрока[ПараметрыЗаполненияРесурса.ИмяРесурса];
			КонецЦикла;
			
			Если Не РаспределеннаяСумма = РаспределяемаяСумма Тогда
				РезультатыРасчетов[ИндексМаксимальногоКоэффициента][ПараметрыЗаполненияРесурса.ИмяРесурса] = РезультатыРасчетов[ИндексМаксимальногоКоэффициента][ПараметрыЗаполненияРесурса.ИмяРесурса] + РаспределяемаяСумма - РаспределеннаяСумма;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;	
	
КонецПроцедуры

Процедура ВписатьУчтенныеОснованияВРезультатРасчета(РезультатРасчета, НеучтенныеРанееОснования, СтруктураПоискаПоФизическомуЛицу, ИсключаемыйРегистратор)
	
	КоличествоСтрок = РезультатРасчета.Количество();
	Если КоличествоСтрок > 0 И РезультатРасчета[КоличествоСтрок - 1].ФизическоеЛицо = СтруктураПоискаПоФизическомуЛицу.ФизическоеЛицо Тогда
		УчтенныеОснования = Новый Массив();
		СтрокиОснований = НеучтенныеРанееОснования.НайтиСтроки(СтруктураПоискаПоФизическомуЛицу);
		Для каждого СтрокаОснований Из СтрокиОснований Цикл
			Если СтрокаОснований.ДокументОснование = ИсключаемыйРегистратор Или Не ЗначениеЗаполнено(СтрокаОснований.ДокументОснование) Тогда
				Продолжить;
			КонецЕсли;
			УчтенныеОснования.Добавить(СтрокаОснований.ДокументОснование)
		КонецЦикла; 
		РезультатРасчета[КоличествоСтрок - 1].УчтенныеОснования = УчтенныеОснования;
	КонецЕсли;
	
КонецПроцедуры

// Вписывает переданную сумму вычета в соответствие ОстаткиВычетов.Остатки, добавляя к существующему значению или
// создавая новое описание вычета.
//	В таблицу ОстаткиВычетов.ТаблицаВычетов добавляется строка, описывающая свойства текущего вычета (если ранее такого вычета не было).
//
// Параметры:
//  ОстаткиВычетов - структура - с полями ОписаниеВычетов, Остатки и ТаблицаВычетов.
//  КодВычета - СправочникСсылка.ВидыВычетовНДФЛ -
//  СуммаВычета - Число - 
//  РассчитыватьНарастающимИтогом - булево - 
//
Процедура ДобавитьОстатокВычетов(ОстаткиВычетов, КодВычета, СуммаВычета, РассчитыватьНарастающимИтогом = Истина)
	
	ОписаниеВычета = ОстаткиВычетов.ОписаниеВычетов[КодВычета];
	Если ОписаниеВычета = Неопределено Тогда
		Возврат
	КонецЕсли;	
	
	ТекущееЗначение = ОстаткиВычетов.Остатки[КодВычета];
	Если ТекущееЗначение = Неопределено Тогда
		ОстаткиВычетов.Остатки.Вставить(КодВычета, СуммаВычета);
		
		СтрокаТаблицыВычетов = ОстаткиВычетов.ТаблицаВычетов.Добавить();
		СтрокаТаблицыВычетов.КодВычета = КодВычета;
		ЗаполнитьЗначенияСвойств(СтрокаТаблицыВычетов, ОписаниеВычета);
	Иначе
		Если РассчитыватьНарастающимИтогом Тогда
			ОстаткиВычетов.Остатки.Вставить(КодВычета, ТекущееЗначение + СуммаВычета);
		Иначе
			ОстаткиВычетов.Остатки.Вставить(КодВычета, СуммаВычета);
		КонецЕсли;	
	КонецЕсли;	
	
КонецПроцедуры	

// Дополняет данные о ставке налогообложения, используемой для резидентов РФ, 
// сведениями о реальной ставке обложения с учетом налогового статуса физического лица и других параметров.
// В переданную таблицу значений ДанныеУчета добавляются колонки:
//		Статус, тип СправочникСсылка.СтатусыНалогоплательщиковПоНДФЛ
//		СтавкаНДФЛ, тип ПеречислениеСсылка.НДФЛСтавки
//		СтавкаЧислом, тип Число, например, 0.13
//      ИсчислятьНалогНарастающимИтогом, тип Булево
//      УчитыватьВсеВычетыКДоходамОтИсточникаРФ, тип Булево
//      УчитыватьВычетыКДоходамОтИсточникаВнеРФ, тип Булево
//      РезидентРФвНалоговомПериоде, тип Булево.
//
// Параметры:
//	ДанныеУчета - ТаблицаЗначений - таблица с колонками (допустимы и другие колонки):
//		ФизическоеЛицо
//		ДатаПолученияДохода, дата на которую будет определен статус налогоплательщика
//    	КатегорияДохода, тип ПеречислениеСсылка.КатегорииДоходовНДФЛ: должно быть непустым
//		СтавкаНалогообложенияРезидента, тип ПеречислениеСсылка.НДФЛСтавкиНалогообложенияРезидента.
//	ПорядокУчетаСтатусаНаКонецГода - строка - необязательный, описание того, как следует учитывать изменение 
//		статуса на конец налогового (отчетного) периода, возможные значения:
//			"НеУчитыватьИзмененияСтатуса" (значение по умолчанию)
//			"УчитыватьИзмененияСтатусаДляРасчета"
//			"УчитыватьИзмененияСтатусаДляОтчетности".
//	ОкончаниеОтчетногоПериода - Дата - необязательный, на эту дату будет определен статус налогоплательщика, если необходимо учитывать изменение статуса.
//	СтатусыФизическихЛиц - ТаблицаЗначений - необязательный, имеет тот же состав колонок, что и регистр СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный; 
//												если не задан, данные будут считаны из ИБ.
//	ПервыйМесяцНалоговогоПериода - Дата - 
//	ПоследнийМесяцНалоговогоПериода - Дата - 
//
Процедура ДополнитьДанныеУчетаСтавками(ДанныеУчета, ПорядокУчетаСтатусаНаКонецГода = "НеУчитыватьИзмененияСтатуса", ОкончаниеОтчетногоПериода = '00010101', СтатусыФизическихЛиц = Неопределено, Знач ПервыйМесяцНалоговогоПериода = '00010101', Знач ПоследнийМесяцНалоговогоПериода = '00010101') 
	
	Если ТипЗнч(ДанныеУчета) <> Тип("ТаблицаЗначений") Тогда
		Возврат;	
	КонецЕсли;
		
	ДанныеУчета.Колонки.Добавить("СтавкаЧислом", Новый ОписаниеТипов("Число"));
	ДанныеУчета.Колонки.Добавить("СтавкаНДФЛ", Новый ОписаниеТипов("ПеречислениеСсылка.НДФЛСтавки"));
	ДанныеУчета.Колонки.Добавить("Статус", Новый ОписаниеТипов("СправочникСсылка.СтатусыНалогоплательщиковПоНДФЛ"));
	ДанныеУчета.Колонки.Добавить("ИсчислятьНалогНарастающимИтогом", Новый ОписаниеТипов("Булево"));
	ДанныеУчета.Колонки.Добавить("УчитыватьВсеВычетыКДоходамОтИсточникаРФ", Новый ОписаниеТипов("Булево"));
	ДанныеУчета.Колонки.Добавить("УчитыватьВычетыКДоходамОтИсточникаВнеРФ", Новый ОписаниеТипов("Булево"));
	ДанныеУчета.Колонки.Добавить("РезидентРФвНалоговомПериоде", Новый ОписаниеТипов("Булево"));

	Если ДанныеУчета.Количество() = 0 Тогда
		Возврат
	КонецЕсли;
	
	ПроверятьКодДохода = ДанныеУчета.Колонки.Найти("КодДохода") <> Неопределено;
	Доход3010 = УчетНДФЛПовтИсп.Доход3010();
	
	Если СтатусыФизическихЛиц = Неопределено Тогда
		Если Не ЗначениеЗаполнено(ПервыйМесяцНалоговогоПериода) Или Не ЗначениеЗаполнено(ПоследнийМесяцНалоговогоПериода) Тогда
			ДанныеУчета.Сортировать("ДатаПолученияДохода");
			ПервыйМесяцНалоговогоПериода = НачалоМесяца(ДанныеУчета[0].ДатаПолученияДохода);
			ПоследнийМесяцНалоговогоПериода = КонецМесяца(ДанныеУчета[ДанныеУчета.Количество() - 1].ДатаПолученияДохода);
		КонецЕсли;
		СтатусыФизическихЛиц = СтатусыФизическихЛиц(ДанныеУчета.ВыгрузитьКолонку("ФизическоеЛицо"), ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода);		
	КонецЕсли;
	
	// Т.к. ставка налогообложения, необходимость учитывать доход нарастающим итогом и необходимость учитывать вычет к
	// доходу (если он есть), зависит от небольшого количества параметров (статус налогоплательщика, категория дохода,
	// налоговый период, к которому относится дата дохода и т.д), различных комбинаций значений, которых на практике при
	// расчете встречается не так уже и много, будем использовать готовую таблицу соответствий.
	ТаблицаОписаний = УчетНДФЛПовтИсп.ТаблицаОписанийДоходов();
	СтруктураПоиска = Новый Структура("ФизическоеЛицо");
	СтруктураПоискаСтавок = Новый Структура("СтатусФизическогоЛица, КатегорияДохода, СтавкаНалогообложенияРезидента, РасчетПоПрогрессивнойШкале");
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
	ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.НачалоРасчетаНДФЛПоПрогрессивнойШкале;
	ДатаОбъединенияНалоговыхБаз = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.НачалоРасчетаНДФЛПоПрогрессивнойШкале;
	
	ТекущееФизическоеЛицо = Неопределено;	
	Для Каждого СтрокаДанныхУчета Из ДанныеУчета Цикл
		Если СтрокаДанныхУчета.ФизическоеЛицо <> ТекущееФизическоеЛицо Тогда
			ТекущееФизическоеЛицо = СтрокаДанныхУчета.ФизическоеЛицо;
			СтруктураПоиска.ФизическоеЛицо = ТекущееФизическоеЛицо;
			СтрокиТаблицыСтатусов = СтатусыФизическихЛиц.НайтиСтроки(СтруктураПоиска);
			
			ИнформацияОСтатусеНалогоплательщика = ИнформацияОСтатусеНалогоплательщика(СтрокаДанныхУчета.ДатаПолученияДохода, СтрокиТаблицыСтатусов, ПорядокУчетаСтатусаНаКонецГода, ОкончаниеОтчетногоПериода);
		КонецЕсли;	
		
		// Проверим, актуальна ли на текущую дату полученная ранее информация о статусе налогоплательщика
		Если Не (СтрокаДанныхУчета.ДатаПолученияДохода >= ИнформацияОСтатусеНалогоплательщика.ДатаНачала И СтрокаДанныхУчета.ДатаПолученияДохода <= ИнформацияОСтатусеНалогоплательщика.ДатаОкончания) Тогда
			ИнформацияОСтатусеНалогоплательщика = ИнформацияОСтатусеНалогоплательщика(СтрокаДанныхУчета.ДатаПолученияДохода, СтрокиТаблицыСтатусов, ПорядокУчетаСтатусаНаКонецГода, ОкончаниеОтчетногоПериода);
		КонецЕсли;	
		
		ЗаполнитьЗначенияСвойств(СтруктураПоискаСтавок, СтрокаДанныхУчета, "СтавкаНалогообложенияРезидента, КатегорияДохода");
		СтруктураПоискаСтавок.СтатусФизическогоЛица = ИнформацияОСтатусеНалогоплательщика.СтатусДляОпределенияСтавки;
		СтруктураПоискаСтавок.РасчетПоПрогрессивнойШкале = СтрокаДанныхУчета.ДатаПолученияДохода >= ПервыйМесяцРасчетаНДФЛПоПрогрессивнойШкале;
		СтрокаДанныхУчета.Статус = ИнформацияОСтатусеНалогоплательщика.СтатусДляОпределенияСтавки;
		СтрокаДанныхУчета.РезидентРФвНалоговомПериоде = ?(ПорядокУчетаСтатусаНаКонецГода = "УчитыватьИзмененияСтатусаДляРасчета", ИнформацияОСтатусеНалогоплательщика.РезидентРФНаКонецГода Или ИнформацияОСтатусеНалогоплательщика.РезидентРФНаКонецМесяца, ИнформацияОСтатусеНалогоплательщика.РезидентРФНаКонецГода);
		
		СтрокиОписания = ТаблицаОписаний.НайтиСтроки(СтруктураПоискаСтавок); 
		
		Если СтрокиОписания.Количество() > 0 Тогда
			
			Описание = СтрокиОписания[0];
			ЗаполнитьЗначенияСвойств(СтрокаДанныхУчета, Описание, "ИсчислятьНалогНарастающимИтогом, УчитыватьВсеВычетыКДоходамОтИсточникаРФ,УчитыватьВычетыКДоходамОтИсточникаВнеРФ");
			
			ПостфиксНалоговогоПериода = ?(СтрокаДанныхУчета.ДатаПолученияДохода < '20150101', "2014", ?(СтрокаДанныхУчета.ДатаПолученияДохода < '20180101', "2015", "2018"));
			СтрокаДанныхУчета.СтавкаЧислом = Описание["СтавкаЧислом" + ПостфиксНалоговогоПериода];
			СтрокаДанныхУчета.СтавкаНДФЛ = Описание["СтавкаНДФЛ" + ПостфиксНалоговогоПериода];
			
	 		Если СтрокаДанныхУчета.Статус = Справочники.СтатусыНалогоплательщиковПоНДФЛ.ДистанционныйРаботник Тогда
				Если СтрокаДанныхУчета.ДатаПолученияДохода < '20240101' Тогда
					СтрокаДанныхУчета.РезидентРФвНалоговомПериоде = Ложь
				ИначеЕсли  СтрокаДанныхУчета.СтавкаНДФЛ <> Перечисления.НДФЛСтавки.Ставка13 Тогда
					СтрокаДанныхУчета.РезидентРФвНалоговомПериоде = Ложь
				КонецЕсли;
			КонецЕсли;

			Если ПроверятьКодДохода И СтрокаДанныхУчета.КодДохода = Доход3010 Тогда
				СтрокаДанныхУчета.ИсчислятьНалогНарастающимИтогом = Ложь
			ИначеЕсли СтрокаДанныхУчета.ДатаПолученияДохода >= ДатаОбъединенияНалоговыхБаз И СтрокаДанныхУчета.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.Дивиденды Тогда 	
				СтрокаДанныхУчета.ИсчислятьНалогНарастающимИтогом = Истина
			ИначеЕсли СтрокаДанныхУчета.ИсчислятьНалогНарастающимИтогом И СтрокаДанныхУчета.СтавкаНДФЛ <> Перечисления.НДФЛСтавки.Ставка13 Тогда 	
				СтрокаДанныхУчета.ИсчислятьНалогНарастающимИтогом = Ложь
			ИначеЕсли СтрокаДанныхУчета.ИсчислятьНалогНарастающимИтогом И СтрокаДанныхУчета.КатегорияДохода = Перечисления.КатегорииДоходовНДФЛ.ПрочиеДоходыПоСтавкеПункта11Статьи224НКРФ Тогда	
				СтрокаДанныхУчета.ИсчислятьНалогНарастающимИтогом = Ложь
			КонецЕсли;
			
		КонецЕсли;	
		
	КонецЦикла;	
	
КонецПроцедуры

// Вставляет в таблицу доходов перед текущей строкой нулевые строки за пропущенные после предыдущей строки месяцы.
Процедура ДополнитьСтрокамиМесяцевБезДоходов(ДанныеУчетаДоходов, СтрокиПоФизическомуЛицу, ПервыеСтрокиМесяцев, ФизическоеЛицо, МесяцС, МесяцПо, ИндексТекущейСтроки, ОблагаемыйДоходНарастающимИтогомЗаГод = 0)
	ТекущийМесяц = МесяцС;
	Пока ТекущийМесяц < МесяцПо Цикл
		
		НоваяСтрока = ДанныеУчетаДоходов.Вставить(ИндексТекущейСтроки);
		СтрокиПоФизическомуЛицу.Добавить(НоваяСтрока);
		ПервыеСтрокиМесяцев.Добавить(НоваяСтрока);
		ИндексТекущейСтроки = ИндексТекущейСтроки + 1;
		
		НоваяСтрока.ФизическоеЛицо = ФизическоеЛицо;
		НоваяСтрока.МесяцНалоговогоПериода = ТекущийМесяц;
		НоваяСтрока.ДатаПолученияДохода = НачалоДня(КонецМесяца(ТекущийМесяц));
		НоваяСтрока.ОблагаемыйДоходНарастающимИтогом = ОблагаемыйДоходНарастающимИтогомЗаГод;
		НоваяСтрока.ДоходМежрасчетногоПериода = Ложь;
		
		НоваяСтрока.ЭтоПоследняяСтрокаЗаДату = Истина;
		НоваяСтрока.ЭтоПоследняяСтрокаЗаМесяц = Истина;
		НоваяСтрока.ЭтоПерваяСтрокаЗаДату = Истина;
		НоваяСтрока.ЭтоПерваяСтрокаЗаМесяц = Истина;
		Если Месяц(ТекущийМесяц) = 1 Тогда
			НоваяСтрока.ЭтоПерваяСтрокаЗаГод = Истина;
		ИначеЕсли  Месяц(ТекущийМесяц) = 12 Тогда
			НоваяСтрока.ЭтоПоследняяСтрокаЗаГод = Истина;
		КонецЕсли;	
		
		ТекущийМесяц  = ДобавитьМесяц(ТекущийМесяц, 1);
		
	КонецЦикла;	
КонецПроцедуры	

// Переписываем данные о результатах расчета НДФЛ из ТаблицаИсточник в ТаблицаПриемник, 
//	заменяя несоответствующие текущему расчету даты получения и категории дохода.
//	В процессе замены некоторые суммы могут быть перераспределены по доходам текущего расчета.
//
// Параметры:
//  ТаблицаПриемник - ТаблицаЗначений - 
//  ТаблицаИсточник - ТаблицаЗначений -
//  ПараметрыЗаполненияРесурса - структура - описывает особенности распределения строки по базе доходов.
//  ДатыПодразделенияКатегории - ТаблицаЗначений -
//  ОсновнаяДатаПолученияДохода - Дата - определяется по доходам текущего расчета.
//  ДополнительныеПоляЗаполнения - строка - перечень полей для копирования при распределении строки по базе доходов.
//
Процедура ЗаменитьДатыПодразделенияКатегории(ТаблицаПриемник, ТаблицаИсточник, ПараметрыЗаполненияРесурса, ДатыПодразделенияКатегории, ОсновнаяДатаПолученияДохода, ДополнительныеПоляЗаполнения = "")
	
	СтруктураПоискаЗаменыИзмерений = Новый Структура("МесяцНалоговогоПериода, КатегорияДохода, Подразделение");
	ИтогЗаМесяц = ТаблицаИсточник.Итог(ПараметрыЗаполненияРесурса.ИмяРесурса);
	Для каждого СтрокаТЗ Из ТаблицаИсточник Цикл
		Если СтрокаТЗ[ПараметрыЗаполненияРесурса.ИмяРесурса] <> 0 Тогда
			ЗаполнитьЗначенияСвойств(СтруктураПоискаЗаменыИзмерений, СтрокаТЗ);
			СтрокиПараметровЗамены = ДатыПодразделенияКатегории.НайтиСтроки(СтруктураПоискаЗаменыИзмерений);
			Если СтрокиПараметровЗамены.Количество() = 0 Тогда
				Продолжить;
			КонецЕсли;
			СтрокаПараметровЗамены = СтрокиПараметровЗамены[0]; 
			ЗаменятьДатуПолученияДохода = СтрокаПараметровЗамены.ЗаменятьДатуПолученияДохода Или ИтогЗаМесяц = -1 Или ИтогЗаМесяц = 1;
			ЗаменятьКатегориюДохода = СтрокаПараметровЗамены.ЗаменятьКатегориюДохода;
			ЗаменятьПодразделение = СтрокаПараметровЗамены.ЗаменятьПодразделение;
			Если Не ЗаменятьДатуПолученияДохода И Не ЗаменятьПодразделение И Не ЗаменятьКатегориюДохода Тогда
				Если ЗначениеЗаполнено(ПараметрыЗаполненияРесурса.ПоляДляОчистки) Тогда
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ, , ПараметрыЗаполненияРесурса.ПоляДляОчистки);
				Иначе
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ);
				КонецЕсли;
				Продолжить;
			КонецЕсли;
			Если ЗаменятьДатуПолученияДохода Тогда
				СтрокаТЗ.МесяцНалоговогоПериода = ОсновнаяДатаПолученияДохода;
			КонецЕсли;
			Если Не ЗаменятьПодразделение И Не ЗаменятьКатегориюДохода Тогда
				Если ЗначениеЗаполнено(ПараметрыЗаполненияРесурса.ПоляДляОчистки) Тогда
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ, , ПараметрыЗаполненияРесурса.ПоляДляОчистки);
				Иначе
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ);
				КонецЕсли;
				Продолжить;
			КонецЕсли;
			ТаблицаРаспределения = СтрокаПараметровЗамены.Распределение;
			Если Не ЗначениеЗаполнено(ТаблицаРаспределения) Тогда
				Если ЗначениеЗаполнено(ПараметрыЗаполненияРесурса.ПоляДляОчистки) Тогда
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ, , ПараметрыЗаполненияРесурса.ПоляДляОчистки);
				Иначе
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ);
				КонецЕсли;
			ИначеЕсли ТаблицаРаспределения.Количество() = 1 Тогда
				Если ЗаменятьПодразделение Тогда
					СтрокаТЗ.Подразделение = ТаблицаРаспределения[0].Подразделение;
				КонецЕсли;
				Если ЗаменятьКатегориюДохода Тогда
					СтрокаТЗ.КатегорияДохода = ТаблицаРаспределения[0].КатегорияДохода;
				КонецЕсли;
				Если ЗначениеЗаполнено(ПараметрыЗаполненияРесурса.ПоляДляОчистки) Тогда
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ, , ПараметрыЗаполненияРесурса.ПоляДляОчистки);
				Иначе
					ЗаполнитьЗначенияСвойств(ТаблицаПриемник.Добавить(), СтрокаТЗ);
				КонецЕсли;
			Иначе
				СтрокДоРаспределения = ТаблицаПриемник.Количество();
				Если ЗначениеЗаполнено(ДополнительныеПоляЗаполнения) Тогда
					ВписатьРесурсВРезультатыРасчетов(ТаблицаПриемник, ПараметрыЗаполненияРесурса, СтрокаТЗ.МесяцНалоговогоПериода, СтрокаТЗ[ПараметрыЗаполненияРесурса.ИмяРесурса], СтрокаТЗ, ТаблицаРаспределения, СтрокаТЗ);
				Иначе
					ВписатьРесурсВРезультатыРасчетов(ТаблицаПриемник, ПараметрыЗаполненияРесурса, СтрокаТЗ.МесяцНалоговогоПериода, СтрокаТЗ[ПараметрыЗаполненияРесурса.ИмяРесурса], СтрокаТЗ, ТаблицаРаспределения);
				КонецЕсли;
				Если СтрокДоРаспределения < ТаблицаПриемник.Количество() И ЗаменятьДатуПолученияДохода Тогда
					// восстановим подразделение или категорию, если ранее это была чужая строка налога
					Для Сч = СтрокДоРаспределения + 1 По ТаблицаПриемник.Количество() Цикл
						Если Не ЗаменятьПодразделение Тогда
							ТаблицаПриемник[Сч-1].Подразделение = СтрокаТЗ.Подразделение
						КонецЕсли;
						Если Не ЗаменятьКатегориюДохода Тогда
							ТаблицаПриемник[Сч-1].КатегорияДохода = СтрокаТЗ.КатегорияДохода
						КонецЕсли;
						Если ЗначениеЗаполнено(ДополнительныеПоляЗаполнения) Тогда
							ЗаполнитьЗначенияСвойств(ТаблицаПриемник[Сч-1], СтрокаТЗ, ДополнительныеПоляЗаполнения);
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Для расчета налога в "межрасчетном" варианте обеспечивает "соответствие" налога, вписываемого в документ, доходам документа.
// Вписываемый налог должен иметь тот же знак, что и доход. Если в результате расчета налога нарастающим итогом за год
// получилось иначе, вписывается нулевая сумма налога (возможно из строк за несколько месяцев) и сумма вычетов в
// пределам суммы доходов документа.
//
// Параметры:
//      РезультатыРасчетов - ТаблицаЗначений - таблица значений, содержащая будущий результат работы метода РассчитатьНалогПоОсновнойСтавке().
//		МежрасчетныйНДФЛ - ТаблицаЗначений - таблица значений, содержащая посчитанный налог по физическому лицу с учетом всех перерасчетов.
//		ДатаУдержанияИсчисленногоНалога - дата - дата предполагаемого удержания налога, который был исчислен.
//		МесяцРасчета - дата -
//		ВсегоДоходов - число - сумма дохода по межрасчетному документу для ограничения предоставленных вычетов
//
Процедура ПереписатьМежрасчетныйНДФЛФизическогоЛицаВРезультат(РезультатыРасчетов, МежрасчетныйНДФЛ, ДатаУдержанияИсчисленногоНалога, МесяцРасчета, Знач ВсегоДоходов = 0)
	
	Если (МежрасчетныйНДФЛ.Итог("НалогПоСтавке13") + МежрасчетныйНДФЛ.Итог("НалогСПревышения")) * ВсегоДоходов >= 0 Тогда
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(МежрасчетныйНДФЛ, РезультатыРасчетов);
	Иначе 
		
		// Произошел перерасчет обязательств из-за изменения данных "задним" числом, т.е. 
		// сумма налога по знаку (+ или -) не соответствует доходам документа.
		// Налоги предыдущих периодов добавляем в пределах налога текущего периода с тем, 
		// чтобы общая сумма налога в документе оказалось нулевой.
		
		МежрасчетныйНДФЛ.Сортировать("МесяцНалоговогоПериода Убыв");
		
		ТекущийПериод = НачалоМесяца(?(ЗначениеЗаполнено(ДатаУдержанияИсчисленногоНалога), ДатаУдержанияИсчисленногоНалога, МесяцРасчета));
		НДФЛТекущегоПериодаВсего = 0;
		НДФЛТекущегоПериода = Новый Массив;
		СтрокиРезультатаДляТекущегоПериода = Новый Массив;
		Для каждого СтрокаДанных Из МежрасчетныйНДФЛ Цикл
			Если НачалоМесяца(СтрокаДанных.МесяцНалоговогоПериода) = ТекущийПериод Тогда
				НДФЛТекущегоПериодаВсего = НДФЛТекущегоПериодаВсего + СтрокаДанных.НалогПоСтавке13 + СтрокаДанных.НалогСПревышения;
				НоваяСтрокаНДФЛ = РезультатыРасчетов.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрокаНДФЛ, СтрокаДанных);
				СтрокиРезультатаДляТекущегоПериода.Добавить(НоваяСтрокаНДФЛ);
				НДФЛТекущегоПериода.Добавить(СтрокаДанных);
			ИначеЕсли СтрокаДанных.МесяцНалоговогоПериода < ТекущийПериод Тогда
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
		Если НДФЛТекущегоПериодаВсего * ВсегоДоходов > 0 Тогда
			Если НДФЛТекущегоПериодаВсего > 0 Тогда
				Для каждого СтрокаДанных Из МежрасчетныйНДФЛ Цикл
					Если НачалоМесяца(СтрокаДанных.МесяцНалоговогоПериода) = ТекущийПериод Тогда
						Продолжить;
					КонецЕсли;
					Если НДФЛТекущегоПериодаВсего + СтрокаДанных.НалогПоСтавке13 + СтрокаДанных.НалогСПревышения >= 0 Тогда
						ЗаполнитьЗначенияСвойств(РезультатыРасчетов.Добавить(), СтрокаДанных);
						НДФЛТекущегоПериодаВсего = НДФЛТекущегоПериодаВсего + СтрокаДанных.НалогПоСтавке13 + СтрокаДанных.НалогСПревышения;
					ИначеЕсли НДФЛТекущегоПериодаВсего > 0 Тогда
						НоваяСтрока = РезультатыРасчетов.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаДанных);
						Если НоваяСтрока.НалогСПревышения >= 0 Тогда
							НоваяСтрока.НалогПоСтавке13 = -НДФЛТекущегоПериодаВсего;
						ИначеЕсли НоваяСтрока.НалогПоСтавке13 >= 0 Тогда	
							НоваяСтрока.НалогСПревышения = -НДФЛТекущегоПериодаВсего;
						Иначе	
							НоваяСтрока.НалогСПревышения = Макс(-НДФЛТекущегоПериодаВсего, НоваяСтрока.НалогСПревышения);
							НДФЛТекущегоПериодаВсего = НДФЛТекущегоПериодаВсего - НоваяСтрока.НалогСПревышения;
							НоваяСтрока.НалогПоСтавке13 = -НДФЛТекущегоПериодаВсего;
						КонецЕсли;
						НДФЛТекущегоПериодаВсего = 0
					КонецЕсли;
				КонецЦикла;
			Иначе
				Для каждого СтрокаДанных Из МежрасчетныйНДФЛ Цикл
					Если НачалоМесяца(СтрокаДанных.МесяцНалоговогоПериода) = ТекущийПериод Тогда
						Продолжить;
					КонецЕсли;
					Если НДФЛТекущегоПериодаВсего + СтрокаДанных.НалогПоСтавке13 + СтрокаДанных.НалогСПревышения <= 0 Тогда
						ЗаполнитьЗначенияСвойств(РезультатыРасчетов.Добавить(), СтрокаДанных);
						НДФЛТекущегоПериодаВсего = НДФЛТекущегоПериодаВсего + СтрокаДанных.НалогПоСтавке13 + СтрокаДанных.НалогСПревышения;
					ИначеЕсли НДФЛТекущегоПериодаВсего < 0 Тогда
						НоваяСтрока = РезультатыРасчетов.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаДанных);
						Если НоваяСтрока.НалогСПревышения <= 0 Тогда
							НоваяСтрока.НалогПоСтавке13 = -НДФЛТекущегоПериодаВсего;
						ИначеЕсли НоваяСтрока.НалогПоСтавке13 <= 0 Тогда	
							НоваяСтрока.НалогСПревышения = -НДФЛТекущегоПериодаВсего;
						Иначе	
							НоваяСтрока.НалогСПревышения = Мин(-НДФЛТекущегоПериодаВсего, НоваяСтрока.НалогСПревышения);
							НДФЛТекущегоПериодаВсего = НДФЛТекущегоПериодаВсего - НоваяСтрока.НалогСПревышения;
							НоваяСтрока.НалогПоСтавке13 = -НДФЛТекущегоПериодаВсего;
						КонецЕсли;
						НДФЛТекущегоПериодаВсего = 0
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
		Иначе 	
			
			// Впишем вычеты, которые обнулили налог.
			// Вписанные ранее строки налога текущего месяца заменим другими - с нулевым доходом, но ненулевыми вычетами.
			
			Для Каждого УдаляемаяСтрока Из СтрокиРезультатаДляТекущегоПериода Цикл
				РезультатыРасчетов.Удалить(УдаляемаяСтрока);
			КонецЦикла;
			
			Если ВсегоДоходов <= 0 Тогда // оказалось, что располагаемых доходов нет
				Возврат
			КонецЕсли;
			
			ВсегоСтрокТекущегоПериода = НДФЛТекущегоПериода.Количество();
			МассивРесурсов = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(РассчитываемыеРесурсыПоОсновнойСтавке());
			Для Сч = 1 По ВсегоСтрокТекущегоПериода Цикл
				СтрокаДанных = НДФЛТекущегоПериода [ВсегоСтрокТекущегоПериода - Сч];
				ЕстьДанныеВСтроке = Ложь;
				Для каждого ИмяРесурса Из МассивРесурсов Цикл
					Если ИмяРесурса = "НалогПоСтавке13" Или ИмяРесурса = "НалогСПревышения" Тогда
						СтрокаДанных[ИмяРесурса] = 0
					ИначеЕсли ВсегоДоходов > 0 Тогда
						Учтено = Мин(СтрокаДанных[ИмяРесурса], ВсегоДоходов);
						СтрокаДанных[ИмяРесурса] = Учтено;
						ВсегоДоходов = ВсегоДоходов - Учтено;
					Иначе
						СтрокаДанных[ИмяРесурса] = 0
					КонецЕсли;
					Если Не ЕстьДанныеВСтроке Тогда
						ЕстьДанныеВСтроке = СтрокаДанных[ИмяРесурса] <> 0;
					КонецЕсли;
				КонецЦикла;
				Если ЕстьДанныеВСтроке Тогда
					ЗаполнитьЗначенияСвойств(РезультатыРасчетов.Добавить(),СтрокаДанных);
				КонецЕсли;
				Если ВсегоДоходов = 0 Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла; 
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПереписатьЧастичныйРезультатРасчетаВРезультатПоФизическомуЛицу(РезультатРасчетаПоФизическомуЛицу, СтрокиНДФЛЗаГод, НДФЛПорцииРасчета, ВычетыПорцииРасчета, ОписаниеВычетов, ТекущийНалоговыйПериод = Неопределено, ПредоставленныеСтандартныеИСоциальныеВычеты = Неопределено, СтруктураПоискаСтандартныхВычетов = Неопределено, ИмущественныеВычеты = Неопределено, СтруктураПоискаИмущественныхВычетов = Неопределено, ПоследнийМесяцПериода = 12)
	
	Если СтрокиНДФЛЗаГод = Неопределено Тогда // вызов из расчета для нерезидента
		
		// отменяем ранее предоставленные вычеты
		ВычетыПорцииРасчета.Очистить();
		Для СчМесяцев = 0 По ПоследнийМесяцПериода - 1 Цикл
			СтруктураПоискаСтандартныхВычетов.МесяцПериодаПредоставленияВычета = ДобавитьМесяц(ТекущийНалоговыйПериод, СчМесяцев);
			СтруктураПоискаИмущественныхВычетов.МесяцНалоговогоПериода = СтруктураПоискаСтандартныхВычетов.МесяцПериодаПредоставленияВычета;
			ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВычетыПорцииРасчета, ПредоставленныеСтандартныеИСоциальныеВычеты.НайтиСтроки(СтруктураПоискаСтандартныхВычетов));
			ВписатьПредоставленныеРанееВычетыВДанныеУчета(ВычетыПорцииРасчета, ИмущественныеВычеты.НайтиСтроки(СтруктураПоискаИмущественныхВычетов));
		КонецЦикла;
		
		// Переписываем результаты очередной порции расчета в таблицу физ.лица
		Если ВычетыПорцииРасчета.Количество() = 0 Тогда
			Для Каждого СтрокаТЗ Из НДФЛПорцииРасчета Цикл
				Если СтрокаТЗ.НалогПоСтавке13 <> 0 Или СтрокаТЗ.НалогСПревышения <> 0 Тогда
					ЗаполнитьЗначенияСвойств(РезультатРасчетаПоФизическомуЛицу.Добавить(), СтрокаТЗ);
				КонецЕсли;
			КонецЦикла;
			Возврат
		КонецЕсли;
			
	КонецЕсли;
	
	СтруктураПоискаВычетов = Новый Структура("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода");
	
	Для Каждого СтрокаТЗ Из НДФЛПорцииРасчета Цикл
		СтрокаТЗ.МесяцПериодаПредоставленияВычета = НачалоМесяца(СтрокаТЗ.МесяцНалоговогоПериода);
	КонецЦикла;				
	
	// Вписываем наличие вычетов в таблицу результатов расчета.
	Для Каждого СтрокаТаблицыВычетов Из ВычетыПорцииРасчета Цикл
		ОписаниеВычета = ОписаниеВычетов[СтрокаТаблицыВычетов.КодВычета];
		Если ОписаниеВычета <> Неопределено И СтрокаТаблицыВычетов.РазмерВычета <> 0 Тогда
			СтрокаРезультат = НДФЛПорцииРасчета.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРезультат, СтрокаТаблицыВычетов);
			СтрокаРезультат.КоличествоВычетов = 1;	
		КонецЕсли;
	КонецЦикла;				
	
	НДФЛПорцииРасчета.Свернуть("ФизическоеЛицо, МесяцНалоговогоПериода, МесяцПериодаПредоставленияВычета, Подразделение, КатегорияДохода", "НалогПоСтавке13, НалогСПревышения, КоличествоВычетов, ЗачтеноАвансовыхПлатежейПоСтавке13, ЗачтеноАвансовыхПлатежейСПревышения");
	
	// Переписываем результаты очередной порции расчета в таблицу физ.лица
	Для Каждого СтрокаТЗ Из НДФЛПорцииРасчета Цикл
		Если СтрокаТЗ.НалогПоСтавке13 + СтрокаТЗ.НалогСПревышения <> 0 Или СтрокаТЗ.КоличествоВычетов > 0 Тогда
			СтрокаРезультат = РезультатРасчетаПоФизическомуЛицу.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРезультат, СтрокаТЗ);
			Если СтрокиНДФЛЗаГод <> Неопределено Тогда
				СтрокиНДФЛЗаГод.Добавить(СтрокаРезультат);
			КонецЕсли;
			
			ЗаполнитьЗначенияСвойств(СтруктураПоискаВычетов, СтрокаТЗ);
			СтрокиВычетов = ВычетыПорцииРасчета.НайтиСтроки(СтруктураПоискаВычетов);
			
			Для Каждого ТекущаяСтрокаВычета Из СтрокиВычетов Цикл
				ОписаниеТекущегоВычета = ОписаниеВычетов[ТекущаяСтрокаВычета.КодВычета];
				Если ТекущаяСтрокаВычета.РазмерВычета <> 0 И ОписаниеТекущегоВычета <> Неопределено Тогда
					СтрокаРезультат[ОписаниеТекущегоВычета.ИмяКолонки] = СтрокаРезультат[ОписаниеТекущегоВычета.ИмяКолонки] + ТекущаяСтрокаВычета.РазмерВычета;
					Если ОписаниеТекущегоВычета.ИмяКолонки = "ПримененныйВычетЛичный" Тогда
						СтрокаРезультат.КодВычетаЛичный	= ТекущаяСтрокаВычета.КодВычета;
					КонецЕсли;	
				КонецЕсли;	
			КонецЦикла;	
		КонецЕсли;
	КонецЦикла;		
	
КонецПроцедуры	

Процедура РассчитатьСтаршийМесяцПолученияДохода(ПервыеСтрокиМесяцев)
	
	Если ПервыеСтрокиМесяцев.Количество() = 0 Тогда
		Возврат
	КонецЕсли;
	
	СтаршийМесяцПолученияДохода = ПервыеСтрокиМесяцев[0].МесяцНалоговогоПериода;
	Для каждого СтрокаМесяца Из ПервыеСтрокиМесяцев Цикл
		Если СтрокаМесяца.ВсеДоходыЗаМесяц > 0 Тогда
			СтаршийМесяцПолученияДохода = Макс(СтрокаМесяца.МесяцНалоговогоПериода, СтаршийМесяцПолученияДохода)
		КонецЕсли;
	КонецЦикла;
	Для каждого СтрокаМесяца Из ПервыеСтрокиМесяцев Цикл
		СтрокаМесяца.СтаршийМесяцПолученияДохода = СтаршийМесяцПолученияДохода
	КонецЦикла;
	
	ПервыеСтрокиМесяцев.Очистить();
	
КонецПроцедуры

Процедура УдалитьУчтенныеСтрокиНерезидентов(СоответствиеНерезидентов, УчтенныеСтроки, ТаблицаДанныхУчета)
	
	Если Не ЗначениеЗаполнено(УчтенныеСтроки) Тогда
		Возврат
	КонецЕсли;
	
	Если СоответствиеНерезидентов[УчтенныеСтроки[0].ФизическоеЛицо] = Неопределено Тогда
		Возврат
	КонецЕсли;
	
	Для Каждого СтрокаТаблицы Из УчтенныеСтроки Цикл
		ТаблицаДанныхУчета.Удалить(СтрокаТаблицы);
	КонецЦикла;
	
КонецПроцедуры

// Возвращает описание стандартных вычетов, на которые имеет право физическое лицо в месяце МесяцНалоговогоПериода.
//
// Параметры:
//	МесяцНалоговогоПериода - Дата - месяц права на вычет 
//	ПериодСрезаПравНаВычеты - Дата - дата, по состоянию на которую читаются периодические сведения
//	СтрокиПравНаВычеты - ТаблицаЗначений или массив строк таблицы значений - строки соответствующей таблицы по физическому лицу
//	СтрокиТаблицыПримененияВычетов - ТаблицаЗначений или массив строк таблицы значений - строки соответствующей таблицы по физическому лицу
//	ИнформацияОНалоговомСтатусе - Структура - данные, возвращаемые методом ИнформацияОСтатусеНалогоплательщика()
//
// Возвращаемое значение:
//	Структура с полями: Вычеты, ДатаНачала, ДатаОкончания.
//
Функция ИнформацияОСтандартныхВычетахДействующихНаДату(МесяцНалоговогоПериода, ПериодСрезаПравНаВычеты, СтрокиПравНаВычеты, СтрокиТаблицыПримененияВычетов, ИнформацияОНалоговомСтатусе)
	
// Описание алгоритма: 
//	1. Проверяем статус сотрудника: для нерезидента описываем период без вычетов и больше никуда не смотрим.
//	2. Среди строк таблицы применения вычетов по физическому лицу, ищем строку (если есть - она будет единственной), для которой выполняется условие
//	МесяцНалоговогоПериода лежит между датой начала и датой окончания, указанными в строке. Если не найдем - определяем дату окончания периода без вычетов, в права на вычеты не заглядываем.
//	3. Если в текущем месяце у физ.лица зарегистрировано право на применение вычетов, выбираем те вычеты, что действуют в периоде этого права.
//	Прежде чем в очередной раз обращаться к этой функции, проверяем что предыдущей результат этой функции потерял актуальность (по датам начала и окончания и физическому лицу)
	
	Вычеты = Новый Соответствие;	
	ИнформацияОПримененииВычетов = Новый Структура("Вычеты, ДатаНачала, ДатаОкончания", Вычеты, МесяцНалоговогоПериода, ЗарплатаКадрыПериодическиеРегистры.МаксимальнаяДата());
	
	Если СтрокиПравНаВычеты.Количество() = 0 Или СтрокиТаблицыПримененияВычетов.Количество() = 0 Тогда
		Возврат ИнформацияОПримененииВычетов;	
	КонецЕсли;	                                
	
	Если Не ИнформацияОНалоговомСтатусе.ПрименяетсяСтавкаПункта1Статьи224НК Тогда
		ИнформацияОПримененииВычетов.ДатаОкончания = ИнформацияОНалоговомСтатусе.ДатаОкончания;
		Возврат ИнформацияОПримененииВычетов;
	КонецЕсли;
	
	// получим действующую строку с данными о применении вычетов
	СтрокаТаблицыПримененияВычетов = Неопределено;
	Если СтрокиТаблицыПримененияВычетов.Количество() = 1 Тогда
		СтрокаТаблицыПримененияВычетов = СтрокиТаблицыПримененияВычетов[0];
		Если МесяцНалоговогоПериода < СтрокаТаблицыПримененияВычетов.ДатаНачала Или МесяцНалоговогоПериода > СтрокаТаблицыПримененияВычетов.ДатаОкончания Тогда
			Если СтрокаТаблицыПримененияВычетов.ДатаНачала > МесяцНалоговогоПериода Тогда
				ИнформацияОПримененииВычетов.ДатаОкончания = Мин(ИнформацияОПримененииВычетов.ДатаОкончания, СтрокаТаблицыПримененияВычетов.ДатаНачала - 1);
			КонецЕсли;
			СтрокаТаблицыПримененияВычетов = Неопределено;
		КонецЕсли;
	Иначе	
		Для Каждого ТекущаяСтрокаПримененияВычетов Из СтрокиТаблицыПримененияВычетов Цикл
			Если МесяцНалоговогоПериода >= ТекущаяСтрокаПримененияВычетов.ДатаНачала И МесяцНалоговогоПериода <= ТекущаяСтрокаПримененияВычетов.ДатаОкончания Тогда
				СтрокаТаблицыПримененияВычетов = ТекущаяСтрокаПримененияВычетов;
				Прервать;
			КонецЕсли;
		КонецЦикла;
		Если СтрокаТаблицыПримененияВычетов = Неопределено Тогда
			Для Каждого ТекущаяСтрокаПримененияВычетов Из СтрокиТаблицыПримененияВычетов Цикл
				Если ТекущаяСтрокаПримененияВычетов.ДатаНачала > МесяцНалоговогоПериода Тогда
					ИнформацияОПримененииВычетов.ДатаОкончания = Мин(ИнформацияОПримененииВычетов.ДатаОкончания, ТекущаяСтрокаПримененияВычетов.ДатаНачала - 1);
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;
	
	Если СтрокаТаблицыПримененияВычетов = Неопределено Тогда
		Возврат ИнформацияОПримененииВычетов;
	ИначеЕсли Не СтрокаТаблицыПримененияВычетов.ПрименятьВычеты Тогда
		ИнформацияОПримененииВычетов.ДатаОкончания = СтрокаТаблицыПримененияВычетов.ДатаОкончания;
		Возврат ИнформацияОПримененииВычетов;
	КонецЕсли;

	ДатаОкончания = Мин(ИнформацияОПримененииВычетов.ДатаОкончания, ИнформацияОНалоговомСтатусе.ДатаОкончания, КонецГода(МесяцНалоговогоПериода));
	
	ПериодСрезаВычетов = ?(МесяцНалоговогоПериода > ПериодСрезаПравНаВычеты, ПериодСрезаПравНаВычеты,  МесяцНалоговогоПериода);
	Для Каждого СтрокаТаблицыВычетов Из СтрокиПравНаВычеты Цикл
		Если МесяцНалоговогоПериода >= СтрокаТаблицыВычетов.ДатаНачала
			И МесяцНалоговогоПериода <= СтрокаТаблицыВычетов.ДатаОкончания
			И ПериодСрезаВычетов >= СтрокаТаблицыВычетов.ПериодРегистрацииНачало
			И ПериодСрезаВычетов <= СтрокаТаблицыВычетов.ПериодРегистрацииОкончание Тогда
		
			ДатаОкончания = Мин(ДатаОкончания, СтрокаТаблицыВычетов.ДатаОкончания - 1, СтрокаТаблицыВычетов.ПериодРегистрацииОкончание - 1);
												
			Если (СтрокаТаблицыВычетов.Количество <> 0 Или СтрокаТаблицыВычетов.ЛичныйВычет)
				И (Не СтрокаТаблицыВычетов.ЛичныйВычет Или СтрокаТаблицыВычетов.КодВычета <> Справочники.ВидыВычетовНДФЛ.ПустаяСсылка()) Тогда
			
				Вычеты.Вставить(СтрокаТаблицыВычетов.КодВычета, СтрокаТаблицыВычетов.Количество);
			КонецЕсли;	
		Иначе
			Если СтрокаТаблицыВычетов.ДатаНачала > МесяцНалоговогоПериода Тогда
				ДатаОкончания = Мин(ДатаОкончания, СтрокаТаблицыВычетов.ДатаНачала - 1);
			КонецЕсли;
			Если СтрокаТаблицыВычетов.ПериодРегистрацииНачало > ПериодСрезаВычетов Тогда
				ДатаОкончания = Мин(ДатаОкончания, СтрокаТаблицыВычетов.ПериодРегистрацииНачало - 1);
			КонецЕсли;					
		КонецЕсли;		
	КонецЦикла;		
	
	ИнформацияОПримененииВычетов.ДатаОкончания = ДатаОкончания;
	
	Возврат ИнформацияОПримененииВычетов;
КонецФункции	

// Возвращает описание текущего статуса физического лица с точки зрения налогового резидентства.
//
// Параметры:
//	ДатаСреза - Дата - 
//	СтрокиТаблицыСтатусов - ТаблицаЗначений или массив строк таблицы значений - строки таблицы статусов по физическому лицу
//	ПорядокУчетаСтатусаНаКонецГода - строка - необязательный, описание того, как следует учитывать изменение 
//		статуса на конец налогового периода, возможные значения:
//			"НеУчитыватьИзмененияСтатуса" (значение по умолчанию)
//			"УчитыватьИзмененияСтатусаДляРасчета"
//			"УчитыватьИзмененияСтатусаДляОтчетности".
//	ОкончаниеОтчетногоПериода - Дата - необязательный, значение будет учитываться в определение периода на которую будет определен статус налогоплательщика если необходимо учитывать изменение статуса.
//
// Возвращаемое значение:
//	Структура с полями: ДатаНачала, ДатаОкончания, Резидент, ПрименяетсяСтавкаПункта1Статьи224НК, СтатусДляОпределенияСтавки, РезидентРФНаКонецГода, РезидентРФНаКонецМесяца.
//
Функция ИнформацияОСтатусеНалогоплательщика(Знач ДатаСреза, СтрокиТаблицыСтатусов, ПорядокУчетаСтатусаНаКонецГода = "НеУчитыватьИзмененияСтатуса", ОкончаниеОтчетногоПериода = '00010101')
	
	// Описание алгоритма: 
	//	Среди строк таблицы статусов по физическому лицу, найдем строку (она будет единственной), для которой выполняется условие
	//	Дата среза (с учетом уточнения для 2014 и более ранних лет) лежит между датой начала и датой окончания, указанными в строке
	//	На основе этой строки рассчитаем поля структуры
	//	Прежде чем в очередной раз обращаться к этой функции, проверяем что предыдущей результат этой функции потерял актуальность (по датам начала и окончания и физическому лицу)

	ИнформацияОСтатусе = Новый Структура("ДатаНачала, ДатаОкончания, ПрименяетсяСтавкаПункта1Статьи224НК, СтатусДляОпределенияСтавки, РезидентРФНаКонецГода, РезидентРФНаКонецМесяца", ДатаСреза, ДатаСреза, Истина, Справочники.СтатусыНалогоплательщиковПоНДФЛ.Резидент, Истина, Истина);

	Если СтрокиТаблицыСтатусов.Количество() = 0 Тогда
		ИнформацияОСтатусе.ДатаОкончания = КонецГода(ДатаСреза);
		Возврат ИнформацияОСтатусе;
	КонецЕсли;	
	Если Не ЗначениеЗаполнено(ДатаСреза) Тогда
		ДатаСреза = КонецМесяца(ТекущаяДатаСеанса())
	КонецЕсли;

	УчитыватьИзмененияСтатусаДляРасчета = ПорядокУчетаСтатусаНаКонецГода = "УчитыватьИзмененияСтатусаДляРасчета";
	НеУчитыватьИзмененияСтатуса = ПорядокУчетаСтатусаНаКонецГода <> "УчитыватьИзмененияСтатусаДляРасчета" И ПорядокУчетаСтатусаНаКонецГода <> "УчитыватьИзмененияСтатусаДляОтчетности";
	ГодОтчетногоПериода = НачалоГода(ОкончаниеОтчетногоПериода);
	ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев = УчетНДФЛ.ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев();
	УточненнаяДатаСреза = ?(ДатаСреза < ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев, КонецМесяца(ДатаСреза), ДатаСреза);
	ИмяКолонкиСтатуса = "СтатусНаКонецКвартала" + ?(ОкончаниеОтчетногоПериода = '00010101', 4, Цел((Месяц(ОкончаниеОтчетногоПериода) + 2)/3));
	Резидент = Справочники.СтатусыНалогоплательщиковПоНДФЛ.Резидент;
	НеРезидент = Справочники.СтатусыНалогоплательщиковПоНДФЛ.Нерезидент;	
	
	Для Каждого СтрокаТаблицыСтатусов Из СтрокиТаблицыСтатусов Цикл
		Если УточненнаяДатаСреза >= СтрокаТаблицыСтатусов.ДатаНачала И УточненнаяДатаСреза <= СтрокаТаблицыСтатусов.ДатаОкончания Тогда
			
			ЗаполнитьЗначенияСвойств(ИнформацияОСтатусе, СтрокаТаблицыСтатусов);
			Если НеУчитыватьИзмененияСтатуса Тогда
				ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
			ИначеЕсли СтрокаТаблицыСтатусов.Год < ГодОтчетногоПериода Тогда
				Если СтрокаТаблицыСтатусов.Статус = СтрокаТаблицыСтатусов.СтатусНаКонецГода Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
				ИначеЕсли СтрокаТаблицыСтатусов.СтатусНаКонецГода = Резидент Тогда 	
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.СтатусНаКонецГода;
				ИначеЕсли УчитыватьИзмененияСтатусаДляРасчета Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
				ИначеЕсли ДатаСреза < ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.СтатусНаКонецГода;
				ИначеЕсли СтрокаТаблицыСтатусов.СтатусНаКонецГода = НеРезидент Тогда
					Если СтрокаТаблицыСтатусов.Статус = Резидент Тогда
						ИнформацияОСтатусе.СтатусДляОпределенияСтавки = НеРезидент
					Иначе
						ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
					КонецЕсли; 
				ИначеЕсли СтрокаТаблицыСтатусов.Статус = Резидент Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = НеРезидент
				Иначе
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
				КонецЕсли;		
			Иначе
				Если СтрокаТаблицыСтатусов.Статус = СтрокаТаблицыСтатусов[ИмяКолонкиСтатуса] Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
				ИначеЕсли СтрокаТаблицыСтатусов[ИмяКолонкиСтатуса] = Резидент Тогда 	
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов[ИмяКолонкиСтатуса];
				ИначеЕсли УчитыватьИзмененияСтатусаДляРасчета Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
				ИначеЕсли ДатаСреза < ДатаИзмененияПорядкаИсчисленияНалогаДляИностранцев Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов[ИмяКолонкиСтатуса];
				ИначеЕсли СтрокаТаблицыСтатусов[ИмяКолонкиСтатуса] = НеРезидент Тогда
					Если СтрокаТаблицыСтатусов.Статус = Резидент Тогда
						ИнформацияОСтатусе.СтатусДляОпределенияСтавки = НеРезидент
					Иначе
						ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
					КонецЕсли; 
				ИначеЕсли СтрокаТаблицыСтатусов.Статус = Резидент Тогда
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = НеРезидент
				Иначе
					ИнформацияОСтатусе.СтатусДляОпределенияСтавки = СтрокаТаблицыСтатусов.Статус;
				КонецЕсли;		
			КонецЕсли;
			
			Возврат ИнформацияОСтатусе;
			
		КонецЕсли;	
	КонецЦикла;	

	Возврат ИнформацияОСтатусе;	
	
КонецФункции

Функция НовыйПараметрыЗаполненияРесурса(ИмяРесурса, ИмяПоляКоэффициент, ТочностьВеличины = 2, ПоляЗаполнения = "Подразделение", ДополнительныеПоляЗаполнения = Неопределено, ПоляДляОчистки = "")
	
	ПараметрыЗаполненияРесурса = Новый Структура();
	ПараметрыЗаполненияРесурса.Вставить("ИмяРесурса", ИмяРесурса);
	ПараметрыЗаполненияРесурса.Вставить("ИмяПоляКоэффициент", ИмяПоляКоэффициент);
	ПараметрыЗаполненияРесурса.Вставить("ТочностьВеличины", ТочностьВеличины);
	ПараметрыЗаполненияРесурса.Вставить("ПоляЗаполнения", ПоляЗаполнения);
	ПараметрыЗаполненияРесурса.Вставить("ДополнительныеПоляЗаполнения", ДополнительныеПоляЗаполнения);
	ПараметрыЗаполненияРесурса.Вставить("ПоляДляОчистки", ПоляДляОчистки);
	
	Возврат ПараметрыЗаполненияРесурса;	
КонецФункции	

// Чтобы обеспечить применение вычетов в нужном порядке, создадим специальную структуру данных со свойствами
//		ОписаниеВычетов - соответствие, где для каждого вычета содержится информация о том, является ли он имущественным, а также определяющий очередность применения порядковый номер
//		ОстаткиВычетов - соответствие, где ключом выступает код вычета, значение - остающаяся пока не примененной сумма вычета
//		ТаблицаВычетов - таблица значений с полями КодВычета, ПорядокСписания, ИмущественныйВычет
//
// Параметры:
//	Нет.
//
// Возвращаемое значение:
//	Структура.
//
Функция НовыйОстаткиВычетов()
	
	ОстаткиВычетов = Новый Структура;	
	ОстаткиВычетов.Вставить("ОписаниеВычетов", УчетНДФЛПовтИсп.ОписаниеВычетов());
			
	//	Нужен счетчик остатков - это соответствие, где в качестве ключа выступает имя вычета, в качестве значения число;
	// элементы соответствия будем добавлять по мере появления прав на вычеты.
	ОстаткиВычетов.Вставить("Остатки", Новый Соответствие); 	
		
	//	Также нужна упорядоченная (впоследствии) таблица значений, где соответствующие вычетам строки будут находится в том порядке, 
	// в котором они будут списываться
	ТаблицаВычетов = Новый ТаблицаЗначений();
	ОстаткиВычетов.Вставить("ТаблицаВычетов", ТаблицаВычетов);
	
	ТаблицаВычетов.Колонки.Добавить("КодВычета");
	ТаблицаВычетов.Колонки.Добавить("ПорядокСписания", Новый ОписаниеТипов("Число"));
	ТаблицаВычетов.Колонки.Добавить("ИмущественныйВычет", Новый ОписаниеТипов("Булево"));
		
	Возврат ОстаткиВычетов;
		
КонецФункции

// Возвращает данные из ИБ о статусах переданных физических лиц с точки зрения налогового резидентства.
//
// Параметры:
//	ФизическиеЛица - Массив - 
//	ПервыйМесяцНалоговогоПериода - Дата - 
//	ПоследнийМесяцНалоговогоПериода - Дата - 
//
// Возвращаемое значение:
//	Таблица значений, имеет тот же состав колонок, что и регистр СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный;
//  	проиндексирована по полю ФизическоеЛицо
//
Функция СтатусыФизическихЛиц(ФизическиеЛица, ПервыйМесяцНалоговогоПериода, ПоследнийМесяцНалоговогоПериода) 
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ФизическиеЛица", ФизическиеЛица);
	Запрос.УстановитьПараметр("НачалоГодаПериодаРасчета", НачалоГода(ПервыйМесяцНалоговогоПериода));
	Запрос.УстановитьПараметр("КонецПоследнегоМесяцаРасчета", КонецМесяца(ПоследнийМесяцНалоговогоПериода));
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ФизическоеЛицо КАК ФизическоеЛицо,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ДатаНачала КАК ДатаНачала,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ДатаОкончания КАК ДатаОкончания,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.Статус КАК Статус,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.РезидентРФНаКонецМесяца КАК РезидентРФНаКонецМесяца,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ПрименяетсяСтавкаПункта1Статьи224НК КАК ПрименяетсяСтавкаПункта1Статьи224НК,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.Год КАК Год,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.РезидентРФНаКонецКвартала1 КАК РезидентРФНаКонецКвартала1,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.РезидентРФНаКонецКвартала2 КАК РезидентРФНаКонецКвартала2,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.РезидентРФНаКонецКвартала3 КАК РезидентРФНаКонецКвартала3,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.РезидентРФНаКонецГода КАК РезидентРФНаКонецГода,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.СтатусНаКонецКвартала1 КАК СтатусНаКонецКвартала1,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.СтатусНаКонецКвартала2 КАК СтатусНаКонецКвартала2,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.СтатусНаКонецКвартала3 КАК СтатусНаКонецКвартала3,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.СтатусНаКонецГода КАК СтатусНаКонецКвартала4,
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.СтатусНаКонецГода КАК СтатусНаКонецГода
	|ИЗ
	|	РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный
	|ГДЕ
	|	СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ФизическоеЛицо В(&ФизическиеЛица)
	|	И (&НачалоГодаПериодаРасчета МЕЖДУ СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ДатаНачала И СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ДатаОкончания
	|			ИЛИ СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ДатаНачала > &НачалоГодаПериодаРасчета
	|				И СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный.ДатаНачала <= &КонецПоследнегоМесяцаРасчета)";
	СтатусыФизическихЛиц = Запрос.Выполнить().Выгрузить();		
	СтатусыФизическихЛиц.Индексы.Добавить("ФизическоеЛицо");
	Возврат СтатусыФизическихЛиц
	
КонецФункции

// Отчетность.

Процедура ПолучитьПереданныеДанныеОтчета2021(Организация, ОКТМО, КПП, ДатаОкончания, МенеджерВременныхТаблиц, НомерКорректировки, ИмяФормы)
	
	НачалоПериода = НачалоГода(ДатаОкончания);
	Данные = ИнтерфейсыВзаимодействияБРО.СправкиОДоходахИСуммахНалогаФизическихЛицИзОтчетов6_НДФЛ(Новый Структура("Организация, ДатаОкончания, ИмяФормыОтчета", Организация, ДатаОкончания, ИмяФормы));
	Если Данные.Количество() > 0 Тогда
		
		Физлица = Новый ТаблицаЗначений;
		Физлица.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("ИНН", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(12)));
		Физлица.Колонки.Добавить("Фамилия", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Имя", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Отчество", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("ДатаРождения", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Физлица.Колонки.Добавить("КодФНС", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1)));
		Физлица.Колонки.Добавить("КодСтраныДляОтчетности", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(3)));
		Физлица.Колонки.Добавить("КодМВД", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(2)));
		Физлица.Колонки.Добавить("СерияДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("НомерДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Итоги = Новый ТаблицаЗначений;
		Итоги.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100009", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Итоги.Колонки.Добавить("П000П1М100001", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100002", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100003", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100004", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100005", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100006", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100007", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100008", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100010", Новый ОписаниеТипов("Число"));
		Вычеты = Новый ТаблицаЗначений;
		Вычеты.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Вычеты.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("П000П1М200001", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Вычеты.Колонки.Добавить("П000П1М200002", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах = Новый ТаблицаЗначений;
		УведомленияОВычетах.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300003", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы = Новый ТаблицаЗначений;
		Доходы.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Доходы.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("Период", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Доходы.Колонки.Добавить("П000П1М500002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М500003", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("П000П1М600004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М600005", Новый ОписаниеТипов("Число"));
		
		НомерСведения = 0;
		Для каждого ДанныеОтчета Из Данные Цикл
			
			Если ДанныеОтчета.НомерКорректировки >= НомерКорректировки Тогда
				Продолжить;;
			КонецЕсли;
			
			// АПК:1036-выкл 
			ОКТМОизДанных = Неопределено; КППизДанных = Неопределено;
			ПроверятьОКТМОиКПП = ДанныеОтчета.Свойство("ОКТМО", ОКТМОизДанных) И ДанныеОтчета.Свойство("КПП", КППизДанных);
			Если ПроверятьОКТМОиКПП И (ОКТМОизДанных <> Лев(ОКТМО, СтрДлина(ОКТМОизДанных)) Или КППизДанных <> КПП) Тогда
				Продолжить;
			КонецЕсли;
			// АПК:1036-вкл 
			
			Для каждого СтрокаСправки Из ДанныеОтчета.СправкиОДоходахИСуммахНалогаФизическихЛиц.Строки Цикл
				
				ДанныеСправки = СтрокаСправки.Данные;
				Если Не ЗначениеЗаполнено(ДанныеСправки.П000П10000001) Тогда // пустую пропустим
					Продолжить;
				КонецЕсли;
				Если ДанныеСправки.П000П10000002 = "99" Тогда // отменяющую пропустим
					Продолжить;
				КонецЕсли;
				 
				НомерСправки = ДанныеСправки.П000П10000001;
				НомерКорректировкиСправки = Число(ДанныеСправки.П000П10000002);
				
				СтрокаДанных = Физлица.Добавить();
				СтрокаДанных.НомерСправки = НомерСправки;
				СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
				СтрокаДанных.ИНН = ДанныеСправки.П000П10000003;
				СтрокаДанных.Фамилия = ДанныеСправки.П000П10000004;
				СтрокаДанных.Имя = ДанныеСправки.П000П10000005;
				СтрокаДанных.Отчество = ДанныеСправки.П000П10000006;
				СтрокаДанных.КодФНС = ДанныеСправки.П000П10000007;
				СтрокаДанных.ДатаРождения = ДанныеСправки.П000П10000008;
				Если ТипЗнч(ДанныеСправки.П000П10000008) <> Тип("Дата") Тогда
					Если ЗначениеЗаполнено(ДанныеСправки.П000П10000008) И ДанныеСправки.П000П10000008 <> "0" Тогда
						СтрокаДанных.ДатаРождения = Дата(ДанныеСправки.П000П10000008);
					Иначе
						СтрокаДанных.ДатаРождения = '00010101'
					КонецЕсли;
				КонецЕсли;
				СтрокаДанных.КодСтраныДляОтчетности = ДанныеСправки.П000П10000009;
				СтрокаДанных.КодМВД = ДанныеСправки.П000П10000010;
				СтрокаДанных.СерияДокумента = ДанныеСправки.П000П10000011;
				СтрокаДанных.НомерДокумента = ДанныеСправки.П000П10000012;
				
				Для каждого СтрокаСтавкиКБК Из СтрокаСправки.ДанныеМногострочныхЧастей.П000П1М1.Строки Цикл
					
					Ставка = СтрокаСтавкиКБК.Данные.П000П1М100001;
					КБК = СтрокаСтавкиКБК.Данные.П000П1М100009;
					Если Не ЗначениеЗаполнено(Ставка) Или Не ЗначениеЗаполнено(КБК) Тогда
						Продолжить;	
					КонецЕсли;
					
					СтрокаДанных = Итоги.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаСтавкиКБК.Данные);
					СтрокаДанных.НомерСправки = НомерСправки;
					СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
					Для каждого СтрокаВычетов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М2.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаВычетов.Данные.П000П1М200002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Вычеты.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
					КонецЦикла;
					Для каждого СтрокаУведомленийОВычетах Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М3.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаУведомленийОВычетах.Данные.П000П1М300002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = УведомленияОВычетах.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаУведомленийОВычетах.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						КодУведомления = СтрокаУведомленийОВычетах.Данные.П000П1М300001;
						Если КодУведомления = "1" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
						ИначеЕсли КодУведомления = "2" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные
						КонецЕсли;
					КонецЦикла;
					Для каждого СтрокаДоходов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М5.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаДоходов.Данные.П000П1М500001) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Доходы.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаДоходов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
		 				СтрокаДанных.Период = ДобавитьМесяц(НачалоПериода, Число(СтрокаДоходов.Данные.П000П1М500001) - 1);
						СтрокиВычетов = СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки;
						Если СтрокиВычетов.Количество() = 1 Тогда
							ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокиВычетов[0].Данные);
						ИначеЕсли СтрокиВычетов.Количество() > 1 Тогда
							Для каждого СтрокаВычетов Из СтрокиВычетов Цикл
								Если СтрокиВычетов.Индекс(СтрокаВычетов) = 0 Тогда
									ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
								Иначе
									ДопСтрокаДанных = Доходы.Добавить();
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаДанных, , "П000П1М500003");
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаВычетов.Данные);
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
					КонецЦикла;
					
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЦикла;
		
		Если Физлица.Количество() > 0 Тогда
			
			Запрос = Новый Запрос;
			Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Физлица, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	МАКСИМУМ(ВременнаяТаблица.НомерКорректировки) КАК НомерКорректировки
			|ПОМЕСТИТЬ ВТПоследниеКорректировки
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД";
			Запрос.Выполнить(); 
			
			// Для отменяющей формы нужен только перечень переданных справок.
			Если НомерКорректировки = 99 Тогда 
				Запрос.Текст = 
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
				|	ВременнаяТаблица.ИНН КАК ИНН,
				|	ВременнаяТаблица.Фамилия КАК Фамилия,
				|	ВременнаяТаблица.Имя КАК Имя,
				|	ВременнаяТаблица.Отчество КАК Отчество,
				|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
				|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
				|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
				|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
				|	ВременнаяТаблица.КодМВД КАК КодМВД,
				|	ВременнаяТаблица.КодФНС КАК КодФНС
				|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
				|ИЗ
				|	ВТВременнаяТаблица КАК ВременнаяТаблица
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
				|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
				|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
				|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
				|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
				|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
				|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
				|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
				|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
				|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
				|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
				|ГДЕ
				|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL ";
				Запрос.Выполнить(); 
				Возврат	
			КонецЕсли;
			
			// Для корректирующей формы нужны все переданные данные.
			
			СтруктураПараметров = КадровыйУчет.ПараметрыПолученияВсехСотрудниковОрганизацийПоСпискуФизическихЛиц();
			СтруктураПараметров.КадровыеДанные = "ФизическоеЛицо, ИНН, Фамилия, Имя, Отчество, ДатаРождения, ДокументВид, ДокументСерия, ДокументНомер, ДокументСтранаВыдачи, Страна";
			СтруктураПараметров.Организация = Организация;
			СтруктураПараметров.НачалоПериода = НачалоПериода;
			СтруктураПараметров.ОкончаниеПериода = КонецМесяца(ДатаОкончания);
			КадровыйУчет.СоздатьВТСотрудникиОрганизации(МенеджерВременныхТаблиц, Ложь, СтруктураПараметров, "ВТСотрудники");
			
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаИзИБ
			|ИЗ
			|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Сотрудники.ФизическоеЛицо
			|ИЗ
			|	ВТСотрудники КАК Сотрудники
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Физлица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ИНН
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ИНН
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК ИНН,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Фамилия
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Фамилия
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Фамилия,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Имя
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Имя
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Имя,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Отчество
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Отчество
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Отчество,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ДатаРождения
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ДатаРождения
			|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			|	КОНЕЦ КАК ДатаРождения,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументСерия, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК СерияДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументНомер, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК НомерДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
			|							КОНЕЦ
			|					ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
			|				КОНЕЦ
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА Сотрудники.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА Сотрудники.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ ЕСТЬNULL(Сотрудники.ДокументСтранаВыдачи.Код, """")
			|							КОНЕЦ
			|					ИНАЧЕ Сотрудники.Страна.Код
			|				КОНЕЦ
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодСтраныДляОтчетности,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовСотрудников.КодМВД, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеФизлицИзИБ
			|ИЗ
			|	ВТФизлицаИзИБ КАК Физлица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
			|			ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
			|		ПО Физлица.ФизическоеЛицо = КадровыеДанныеФизЛиц.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовСотрудников
			|			ПО Сотрудники.ДокументВид = ВидыДокументовСотрудников.Ссылка
			|		ПО Физлица.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МАКСИМУМ(ЕСТЬNULL(ЕСТЬNULL(ФизическиеЛица.Ссылка, ДанныеФизлицИзИБ.ФизическоеЛицо), ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка))) КАК ФизическоеЛицо,
			|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки КАК НомерКорректировки,
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	ВременнаяТаблица.КодФНС КАК КодФНС
			|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.ИНН = ФизическиеЛица.ИНН
			|			И (ВременнаяТаблица.ИНН <> """")
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеФизлицИзИБ КАК ДанныеФизлицИзИБ
			|		ПО ВременнаяТаблица.Фамилия = ДанныеФизлицИзИБ.Фамилия
			|			И ВременнаяТаблица.Имя = ДанныеФизлицИзИБ.Имя
			|			И ВременнаяТаблица.Отчество = ДанныеФизлицИзИБ.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ДанныеФизлицИзИБ.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ДанныеФизлицИзИБ.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ДанныеФизлицИзИБ.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ДанныеФизлицИзИБ.КодМВД
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
			|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
			|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
			|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
			|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
			|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
			|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
			|ГДЕ
			|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки,
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД,
			|	ВременнаяТаблица.КодФНС";
			Запрос.Выполнить(); 
			// АПК:96-вкл
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Итоги, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.П000П1М100001 КАК П000П1М100001,
			|	ВременнаяТаблица.П000П1М100002 КАК П000П1М100002,
			|	ВременнаяТаблица.П000П1М100003 КАК П000П1М100003,
			|	ВременнаяТаблица.П000П1М100004 КАК П000П1М100004,
			|	ВременнаяТаблица.П000П1М100005 КАК П000П1М100005,
			|	ВременнаяТаблица.П000П1М100006 КАК П000П1М100006,
			|	ВременнаяТаблица.П000П1М100007 КАК П000П1М100007,
			|	ВременнаяТаблица.П000П1М100008 КАК П000П1М100008,
			|	ВременнаяТаблица.П000П1М100009 КАК П000П1М100009,
			|	ВременнаяТаблица.П000П1М100010 КАК П000П1М100010
			|ПОМЕСТИТЬ ВТИтогиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Вычеты, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.П000П1М200001 КАК П000П1М200001,
			|	ВременнаяТаблица.П000П1М200002 КАК П000П1М200002
			|ПОМЕСТИТЬ ВТВычетыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, УведомленияОВычетах, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.П000П1М300002 КАК П000П1М300002,
			|	ВременнаяТаблица.П000П1М300003 КАК П000П1М300003,
			|	ВременнаяТаблица.П000П1М300004 КАК П000П1М300004
			|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Доходы, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	СУММА(ВременнаяТаблица.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТДоходыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004 КАК П000П1М600004,
			|	СУММА(ВременнаяТаблица.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВременнаяТаблица.П000П1М600005) <> 0";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
		Иначе
			СоздатьПустыеВТПереданныхДанныхОтчета2021(МенеджерВременныхТаблиц)
		КонецЕсли;
		
	Иначе
		СоздатьПустыеВТПереданныхДанныхОтчета2021(МенеджерВременныхТаблиц)
	КонецЕсли;
	
КонецПроцедуры

Процедура СоздатьПустыеВТПереданныхДанныхОтчета2021(МенеджерВременныхТаблиц)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК НомерСправки,
	|	0 КАК НомерКорректировки,
	|	"""" КАК ИНН,
	|	"""" КАК Фамилия,
	|	"""" КАК Имя,
	|	"""" КАК Отчество,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК ДатаРождения,
	|	"""" КАК КодФНС,
	|	"""" КАК КодСтраныДляОтчетности,
	|	"""" КАК КодМВД,
	|	"""" КАК СерияДокумента,
	|	"""" КАК НомерДокумента
	|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК П000П1М100001,
	|	0 КАК П000П1М100002,
	|	0 КАК П000П1М100003,
	|	0 КАК П000П1М100004,
	|	0 КАК П000П1М100005,
	|	0 КАК П000П1М100006,
	|	0 КАК П000П1М100007,
	|	0 КАК П000П1М100008,
	|	"""" КАК П000П1М100009,
	|	0 КАК П000П1М100010
	|ПОМЕСТИТЬ ВТИтогиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	"""" КАК П000П1М200001,
	|	0 КАК П000П1М200002
	|ПОМЕСТИТЬ ВТВычетыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка) КАК ГруппаВычета,
	|	"""" КАК П000П1М300002,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК П000П1М300003,
	|	"""" КАК П000П1М300004
	|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	0 КАК П000П1М500003
	|ПОМЕСТИТЬ ВТДоходыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	"""" КАК П000П1М600004,
	|	0 КАК П000П1М600005
	|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
	|ГДЕ
	|	ЛОЖЬ";
	Запрос.Выполнить(); 
	
КонецПроцедуры

Процедура ПолучитьПереданныеДанныеОтчета2024Кв1(Организация, ОКТМО, КПП, ДатаОкончания, МенеджерВременныхТаблиц, НомерКорректировки, ИмяФормы)
	
	НачалоПериода = НачалоГода(ДатаОкончания);
	Данные = ИнтерфейсыВзаимодействияБРО.СправкиОДоходахИСуммахНалогаФизическихЛицИзОтчетов6_НДФЛ(Новый Структура("Организация, ДатаОкончания, ИмяФормыОтчета", Организация, ДатаОкончания, ИмяФормы));
	Если Данные.Количество() > 0 Тогда
		
		Физлица = Новый ТаблицаЗначений;
		Физлица.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("ИНН", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(12)));
		Физлица.Колонки.Добавить("Фамилия", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Имя", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Отчество", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("ДатаРождения", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Физлица.Колонки.Добавить("КодФНС", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1)));
		Физлица.Колонки.Добавить("КодСтраныДляОтчетности", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(3)));
		Физлица.Колонки.Добавить("КодМВД", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(2)));
		Физлица.Колонки.Добавить("СерияДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("НомерДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Итоги = Новый ТаблицаЗначений;
		Итоги.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100009", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Итоги.Колонки.Добавить("П000П1М100001", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100002", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100003", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100004", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100005", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100006", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100008", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100010", Новый ОписаниеТипов("Число"));
		Вычеты = Новый ТаблицаЗначений;
		Вычеты.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Вычеты.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("П000П1М200001", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Вычеты.Колонки.Добавить("П000П1М200002", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах = Новый ТаблицаЗначений;
		УведомленияОВычетах.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300003", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы = Новый ТаблицаЗначений;
		Доходы.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Доходы.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("Период", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Доходы.Колонки.Добавить("П000П1М500002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М500003", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("П000П1М600004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М600005", Новый ОписаниеТипов("Число"));
		
		НомерСведения = 0;
		Для каждого ДанныеОтчета Из Данные Цикл
			
			Если ДанныеОтчета.НомерКорректировки >= НомерКорректировки Тогда
				Продолжить;;
			КонецЕсли;
			
			// АПК:1036-выкл 
			ОКТМОизДанных = Неопределено; КППизДанных = Неопределено;
			ПроверятьОКТМОиКПП = ДанныеОтчета.Свойство("ОКТМО", ОКТМОизДанных) И ДанныеОтчета.Свойство("КПП", КППизДанных);
			Если ПроверятьОКТМОиКПП И (ОКТМОизДанных <> Лев(ОКТМО, СтрДлина(ОКТМОизДанных)) Или КППизДанных <> КПП) Тогда
				Продолжить;
			КонецЕсли;
			// АПК:1036-вкл 
			
			Для каждого СтрокаСправки Из ДанныеОтчета.СправкиОДоходахИСуммахНалогаФизическихЛиц.Строки Цикл
				
				ДанныеСправки = СтрокаСправки.Данные;
				Если Не ЗначениеЗаполнено(ДанныеСправки.П000П10000001) Тогда // пустую пропустим
					Продолжить;
				КонецЕсли;
				Если ДанныеСправки.П000П10000002 = "99" Тогда // отменяющую пропустим
					Продолжить;
				КонецЕсли;
				 
				НомерСправки = ДанныеСправки.П000П10000001;
				НомерКорректировкиСправки = Число(ДанныеСправки.П000П10000002);
				
				СтрокаДанных = Физлица.Добавить();
				СтрокаДанных.НомерСправки = НомерСправки;
				СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
				СтрокаДанных.ИНН = ДанныеСправки.П000П10000003;
				СтрокаДанных.Фамилия = ДанныеСправки.П000П10000004;
				СтрокаДанных.Имя = ДанныеСправки.П000П10000005;
				СтрокаДанных.Отчество = ДанныеСправки.П000П10000006;
				СтрокаДанных.КодФНС = ДанныеСправки.П000П10000007;
				СтрокаДанных.ДатаРождения = ДанныеСправки.П000П10000008;
				Если ТипЗнч(ДанныеСправки.П000П10000008) <> Тип("Дата") Тогда
					Если ЗначениеЗаполнено(ДанныеСправки.П000П10000008) И ДанныеСправки.П000П10000008 <> "0" Тогда
						СтрокаДанных.ДатаРождения = Дата(ДанныеСправки.П000П10000008);
					Иначе
						СтрокаДанных.ДатаРождения = '00010101'
					КонецЕсли;
				КонецЕсли;
				СтрокаДанных.КодСтраныДляОтчетности = ДанныеСправки.П000П10000009;
				СтрокаДанных.КодМВД = ДанныеСправки.П000П10000010;
				СтрокаДанных.СерияДокумента = ДанныеСправки.П000П10000011;
				СтрокаДанных.НомерДокумента = ДанныеСправки.П000П10000012;
				
				Для каждого СтрокаСтавкиКБК Из СтрокаСправки.ДанныеМногострочныхЧастей.П000П1М1.Строки Цикл
					
					Ставка = СтрокаСтавкиКБК.Данные.П000П1М100001;
					КБК = СтрокаСтавкиКБК.Данные.П000П1М100009;
					Если Не ЗначениеЗаполнено(Ставка) Или Не ЗначениеЗаполнено(КБК) Тогда
						Продолжить;	
					КонецЕсли;
					
					СтрокаДанных = Итоги.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаСтавкиКБК.Данные);
					СтрокаДанных.НомерСправки = НомерСправки;
					СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
					Для каждого СтрокаВычетов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М2.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаВычетов.Данные.П000П1М200002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Вычеты.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
					КонецЦикла;
					Для каждого СтрокаУведомленийОВычетах Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М3.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаУведомленийОВычетах.Данные.П000П1М300002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = УведомленияОВычетах.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаУведомленийОВычетах.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						КодУведомления = СтрокаУведомленийОВычетах.Данные.П000П1М300001;
						Если КодУведомления = "1" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
						ИначеЕсли КодУведомления = "2" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные
						КонецЕсли;
					КонецЦикла;
					Для каждого СтрокаДоходов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М5.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаДоходов.Данные.П000П1М500001) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Доходы.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаДоходов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
		 				СтрокаДанных.Период = ДобавитьМесяц(НачалоПериода, Число(СтрокаДоходов.Данные.П000П1М500001) - 1);
						СтрокиВычетов = СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки;
						Если СтрокиВычетов.Количество() = 1 Тогда
							ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокиВычетов[0].Данные);
						ИначеЕсли СтрокиВычетов.Количество() > 1 Тогда
							Для каждого СтрокаВычетов Из СтрокиВычетов Цикл
								Если СтрокиВычетов.Индекс(СтрокаВычетов) = 0 Тогда
									ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
								Иначе
									ДопСтрокаДанных = Доходы.Добавить();
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаДанных, , "П000П1М500003");
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаВычетов.Данные);
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
					КонецЦикла;
					
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЦикла;
		
		Если Физлица.Количество() > 0 Тогда
			
			Запрос = Новый Запрос;
			Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Физлица, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	МАКСИМУМ(ВременнаяТаблица.НомерКорректировки) КАК НомерКорректировки
			|ПОМЕСТИТЬ ВТПоследниеКорректировки
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД";
			Запрос.Выполнить(); 
			
			// Для отменяющей формы нужен только перечень переданных справок.
			Если НомерКорректировки = 99 Тогда 
				Запрос.Текст = 
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
				|	ВременнаяТаблица.ИНН КАК ИНН,
				|	ВременнаяТаблица.Фамилия КАК Фамилия,
				|	ВременнаяТаблица.Имя КАК Имя,
				|	ВременнаяТаблица.Отчество КАК Отчество,
				|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
				|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
				|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
				|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
				|	ВременнаяТаблица.КодМВД КАК КодМВД,
				|	ВременнаяТаблица.КодФНС КАК КодФНС
				|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
				|ИЗ
				|	ВТВременнаяТаблица КАК ВременнаяТаблица
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
				|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
				|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
				|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
				|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
				|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
				|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
				|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
				|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
				|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
				|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
				|ГДЕ
				|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL ";
				Запрос.Выполнить(); 
				Возврат	
			КонецЕсли;
			
			// Для корректирующей формы нужны все переданные данные.
			
			СтруктураПараметров = КадровыйУчет.ПараметрыПолученияВсехСотрудниковОрганизацийПоСпискуФизическихЛиц();
			СтруктураПараметров.КадровыеДанные = "ФизическоеЛицо, ИНН, Фамилия, Имя, Отчество, ДатаРождения, ДокументВид, ДокументСерия, ДокументНомер, ДокументСтранаВыдачи, Страна";
			СтруктураПараметров.Организация = Организация;
			СтруктураПараметров.НачалоПериода = НачалоПериода;
			СтруктураПараметров.ОкончаниеПериода = КонецМесяца(ДатаОкончания);
			КадровыйУчет.СоздатьВТСотрудникиОрганизации(МенеджерВременныхТаблиц, Ложь, СтруктураПараметров, "ВТСотрудники");
			
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаИзИБ
			|ИЗ
			|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Сотрудники.ФизическоеЛицо
			|ИЗ
			|	ВТСотрудники КАК Сотрудники
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Физлица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ИНН
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ИНН
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК ИНН,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Фамилия
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Фамилия
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Фамилия,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Имя
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Имя
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Имя,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Отчество
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Отчество
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Отчество,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ДатаРождения
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ДатаРождения
			|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			|	КОНЕЦ КАК ДатаРождения,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументСерия, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК СерияДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументНомер, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК НомерДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
			|							КОНЕЦ
			|					ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
			|				КОНЕЦ
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА Сотрудники.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА Сотрудники.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ ЕСТЬNULL(Сотрудники.ДокументСтранаВыдачи.Код, """")
			|							КОНЕЦ
			|					ИНАЧЕ Сотрудники.Страна.Код
			|				КОНЕЦ
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодСтраныДляОтчетности,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовСотрудников.КодМВД, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеФизлицИзИБ
			|ИЗ
			|	ВТФизлицаИзИБ КАК Физлица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
			|			ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
			|		ПО Физлица.ФизическоеЛицо = КадровыеДанныеФизЛиц.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовСотрудников
			|			ПО Сотрудники.ДокументВид = ВидыДокументовСотрудников.Ссылка
			|		ПО Физлица.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МАКСИМУМ(ЕСТЬNULL(ЕСТЬNULL(ФизическиеЛица.Ссылка, ДанныеФизлицИзИБ.ФизическоеЛицо), ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка))) КАК ФизическоеЛицо,
			|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки КАК НомерКорректировки,
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	ВременнаяТаблица.КодФНС КАК КодФНС
			|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.ИНН = ФизическиеЛица.ИНН
			|			И (ВременнаяТаблица.ИНН <> """")
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеФизлицИзИБ КАК ДанныеФизлицИзИБ
			|		ПО ВременнаяТаблица.Фамилия = ДанныеФизлицИзИБ.Фамилия
			|			И ВременнаяТаблица.Имя = ДанныеФизлицИзИБ.Имя
			|			И ВременнаяТаблица.Отчество = ДанныеФизлицИзИБ.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ДанныеФизлицИзИБ.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ДанныеФизлицИзИБ.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ДанныеФизлицИзИБ.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ДанныеФизлицИзИБ.КодМВД
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
			|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
			|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
			|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
			|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
			|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
			|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
			|ГДЕ
			|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки,
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД,
			|	ВременнаяТаблица.КодФНС";
			Запрос.Выполнить(); 
			// АПК:96-вкл
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Итоги, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.П000П1М100001 КАК П000П1М100001,
			|	ВременнаяТаблица.П000П1М100002 КАК П000П1М100002,
			|	ВременнаяТаблица.П000П1М100003 КАК П000П1М100003,
			|	ВременнаяТаблица.П000П1М100004 КАК П000П1М100004,
			|	ВременнаяТаблица.П000П1М100005 КАК П000П1М100005,
			|	ВременнаяТаблица.П000П1М100006 КАК П000П1М100006,
			|	ВременнаяТаблица.П000П1М100008 КАК П000П1М100008,
			|	ВременнаяТаблица.П000П1М100009 КАК П000П1М100009,
			|	ВременнаяТаблица.П000П1М100010 КАК П000П1М100010
			|ПОМЕСТИТЬ ВТИтогиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Вычеты, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.П000П1М200001 КАК П000П1М200001,
			|	ВременнаяТаблица.П000П1М200002 КАК П000П1М200002
			|ПОМЕСТИТЬ ВТВычетыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, УведомленияОВычетах, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.П000П1М300002 КАК П000П1М300002,
			|	ВременнаяТаблица.П000П1М300003 КАК П000П1М300003,
			|	ВременнаяТаблица.П000П1М300004 КАК П000П1М300004
			|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Доходы, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	СУММА(ВременнаяТаблица.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТДоходыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004 КАК П000П1М600004,
			|	СУММА(ВременнаяТаблица.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВременнаяТаблица.П000П1М600005) <> 0";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
		Иначе
			СоздатьПустыеВТПереданныхДанныхОтчета2024Кв1(МенеджерВременныхТаблиц)
		КонецЕсли;
		
	Иначе
		СоздатьПустыеВТПереданныхДанныхОтчета2024Кв1(МенеджерВременныхТаблиц)
	КонецЕсли;
	
КонецПроцедуры

Процедура СоздатьПустыеВТПереданныхДанныхОтчета2024Кв1(МенеджерВременныхТаблиц)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК НомерСправки,
	|	0 КАК НомерКорректировки,
	|	"""" КАК ИНН,
	|	"""" КАК Фамилия,
	|	"""" КАК Имя,
	|	"""" КАК Отчество,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК ДатаРождения,
	|	"""" КАК КодФНС,
	|	"""" КАК КодСтраныДляОтчетности,
	|	"""" КАК КодМВД,
	|	"""" КАК СерияДокумента,
	|	"""" КАК НомерДокумента
	|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК П000П1М100001,
	|	0 КАК П000П1М100002,
	|	0 КАК П000П1М100003,
	|	0 КАК П000П1М100004,
	|	0 КАК П000П1М100005,
	|	0 КАК П000П1М100006,
	|	0 КАК П000П1М100008,
	|	"""" КАК П000П1М100009,
	|	0 КАК П000П1М100010
	|ПОМЕСТИТЬ ВТИтогиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	"""" КАК П000П1М200001,
	|	0 КАК П000П1М200002
	|ПОМЕСТИТЬ ВТВычетыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка) КАК ГруппаВычета,
	|	"""" КАК П000П1М300002,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК П000П1М300003,
	|	"""" КАК П000П1М300004
	|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	0 КАК П000П1М500003
	|ПОМЕСТИТЬ ВТДоходыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	"""" КАК П000П1М600004,
	|	0 КАК П000П1М600005
	|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
	|ГДЕ
	|	ЛОЖЬ";
	Запрос.Выполнить(); 
	
КонецПроцедуры

Процедура ПолучитьПереданныеДанныеОтчета2023(Организация, ОКТМО, КПП, ДатаОкончания, МенеджерВременныхТаблиц, НомерКорректировки, ИмяФормы)
	
	НачалоПериода = НачалоГода(ДатаОкончания);
	Данные = ИнтерфейсыВзаимодействияБРО.СправкиОДоходахИСуммахНалогаФизическихЛицИзОтчетов6_НДФЛ(Новый Структура("Организация, ДатаОкончания, ИмяФормыОтчета", Организация, ДатаОкончания, ИмяФормы));
	Если Данные.Количество() > 0 Тогда
		
		Физлица = Новый ТаблицаЗначений;
		Физлица.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("ИНН", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(12)));
		Физлица.Колонки.Добавить("Фамилия", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Имя", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Отчество", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("ДатаРождения", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Физлица.Колонки.Добавить("КодФНС", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1)));
		Физлица.Колонки.Добавить("КодСтраныДляОтчетности", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(3)));
		Физлица.Колонки.Добавить("КодМВД", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(2)));
		Физлица.Колонки.Добавить("СерияДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("НомерДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Итоги = Новый ТаблицаЗначений;
		Итоги.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100009", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Итоги.Колонки.Добавить("П000П1М100001", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100002", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100003", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100004", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100005", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100006", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100007", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100008", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100010", Новый ОписаниеТипов("Число"));
		Вычеты = Новый ТаблицаЗначений;
		Вычеты.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Вычеты.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("П000П1М200001", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Вычеты.Колонки.Добавить("П000П1М200002", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах = Новый ТаблицаЗначений;
		УведомленияОВычетах.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300003", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы = Новый ТаблицаЗначений;
		Доходы.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Доходы.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("Период", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Доходы.Колонки.Добавить("П000П1М500002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М500003", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("П000П1М600004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М600005", Новый ОписаниеТипов("Число"));
		
		НомерСведения = 0;
		Для каждого ДанныеОтчета Из Данные Цикл
			
			Если ДанныеОтчета.НомерКорректировки >= НомерКорректировки Тогда
				Продолжить;;
			КонецЕсли;
			
			// АПК:1036-выкл 
			ОКТМОизДанных = Неопределено; КППизДанных = Неопределено;
			ПроверятьОКТМОиКПП = ДанныеОтчета.Свойство("ОКТМО", ОКТМОизДанных) И ДанныеОтчета.Свойство("КПП", КППизДанных);
			Если ПроверятьОКТМОиКПП И (ОКТМОизДанных <> Лев(ОКТМО, СтрДлина(ОКТМОизДанных)) Или КППизДанных <> КПП) Тогда
				Продолжить;
			КонецЕсли;
			// АПК:1036-вкл 
			
			Для каждого СтрокаСправки Из ДанныеОтчета.СправкиОДоходахИСуммахНалогаФизическихЛиц.Строки Цикл
				
				ДанныеСправки = СтрокаСправки.Данные;
				Если Не ЗначениеЗаполнено(ДанныеСправки.П000П10000001) Тогда // пустую пропустим
					Продолжить;
				КонецЕсли;
				Если ДанныеСправки.П000П10000002 = "99" Тогда // отменяющую пропустим
					Продолжить;
				КонецЕсли;
				 
				НомерСправки = ДанныеСправки.П000П10000001;
				НомерКорректировкиСправки = Число(ДанныеСправки.П000П10000002);
				
				СтрокаДанных = Физлица.Добавить();
				СтрокаДанных.НомерСправки = НомерСправки;
				СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
				СтрокаДанных.ИНН = ДанныеСправки.П000П10000003;
				СтрокаДанных.Фамилия = ДанныеСправки.П000П10000004;
				СтрокаДанных.Имя = ДанныеСправки.П000П10000005;
				СтрокаДанных.Отчество = ДанныеСправки.П000П10000006;
				СтрокаДанных.КодФНС = ДанныеСправки.П000П10000007;
				СтрокаДанных.ДатаРождения = ДанныеСправки.П000П10000008;
				Если ТипЗнч(ДанныеСправки.П000П10000008) <> Тип("Дата") Тогда
					Если ЗначениеЗаполнено(ДанныеСправки.П000П10000008) И ДанныеСправки.П000П10000008 <> "0" Тогда
						СтрокаДанных.ДатаРождения = Дата(ДанныеСправки.П000П10000008);
					Иначе
						СтрокаДанных.ДатаРождения = '00010101'
					КонецЕсли;
				КонецЕсли;
				СтрокаДанных.КодСтраныДляОтчетности = ДанныеСправки.П000П10000009;
				СтрокаДанных.КодМВД = ДанныеСправки.П000П10000010;
				СтрокаДанных.СерияДокумента = ДанныеСправки.П000П10000011;
				СтрокаДанных.НомерДокумента = ДанныеСправки.П000П10000012;
				
				Для каждого СтрокаСтавкиКБК Из СтрокаСправки.ДанныеМногострочныхЧастей.П000П1М1.Строки Цикл
					
					Ставка = СтрокаСтавкиКБК.Данные.П000П1М100001;
					КБК = СтрокаСтавкиКБК.Данные.П000П1М100009;
					Если Не ЗначениеЗаполнено(Ставка) Или Не ЗначениеЗаполнено(КБК) Тогда
						Продолжить;	
					КонецЕсли;
					
					СтрокаДанных = Итоги.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаСтавкиКБК.Данные);
					СтрокаДанных.НомерСправки = НомерСправки;
					СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
					Для каждого СтрокаВычетов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М2.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаВычетов.Данные.П000П1М200002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Вычеты.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
					КонецЦикла;
					Для каждого СтрокаУведомленийОВычетах Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М3.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаУведомленийОВычетах.Данные.П000П1М300002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = УведомленияОВычетах.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаУведомленийОВычетах.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						КодУведомления = СтрокаУведомленийОВычетах.Данные.П000П1М300001;
						Если КодУведомления = "1" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
						ИначеЕсли КодУведомления = "2" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные
						КонецЕсли;
					КонецЦикла;
					Для каждого СтрокаДоходов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М5.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаДоходов.Данные.П000П1М500001) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Доходы.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаДоходов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
		 				СтрокаДанных.Период = ДобавитьМесяц(НачалоПериода, Число(СтрокаДоходов.Данные.П000П1М500001) - 1);
						СтрокиВычетов = СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки;
						Если СтрокиВычетов.Количество() = 1 Тогда
							ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокиВычетов[0].Данные);
						ИначеЕсли СтрокиВычетов.Количество() > 1 Тогда
							Для каждого СтрокаВычетов Из СтрокиВычетов Цикл
								Если СтрокиВычетов.Индекс(СтрокаВычетов) = 0 Тогда
									ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
								Иначе
									ДопСтрокаДанных = Доходы.Добавить();
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаДанных, , "П000П1М500003");
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаВычетов.Данные);
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
					КонецЦикла;
					
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЦикла;
		
		Если Физлица.Количество() > 0 Тогда
			
			Запрос = Новый Запрос;
			Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Физлица, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	МАКСИМУМ(ВременнаяТаблица.НомерКорректировки) КАК НомерКорректировки
			|ПОМЕСТИТЬ ВТПоследниеКорректировки
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД";
			Запрос.Выполнить(); 
			
			// Для отменяющей формы нужен только перечень переданных справок.
			Если НомерКорректировки = 99 Тогда 
				Запрос.Текст = 
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
				|	ВременнаяТаблица.ИНН КАК ИНН,
				|	ВременнаяТаблица.Фамилия КАК Фамилия,
				|	ВременнаяТаблица.Имя КАК Имя,
				|	ВременнаяТаблица.Отчество КАК Отчество,
				|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
				|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
				|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
				|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
				|	ВременнаяТаблица.КодМВД КАК КодМВД,
				|	ВременнаяТаблица.КодФНС КАК КодФНС
				|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
				|ИЗ
				|	ВТВременнаяТаблица КАК ВременнаяТаблица
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
				|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
				|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
				|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
				|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
				|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
				|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
				|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
				|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
				|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
				|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
				|ГДЕ
				|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL ";
				Запрос.Выполнить(); 
				Возврат	
			КонецЕсли;
			
			// Для корректирующей формы нужны все переданные данные.
			
			СтруктураПараметров = КадровыйУчет.ПараметрыПолученияВсехСотрудниковОрганизацийПоСпискуФизическихЛиц();
			СтруктураПараметров.КадровыеДанные = "ФизическоеЛицо, ИНН, Фамилия, Имя, Отчество, ДатаРождения, ДокументВид, ДокументСерия, ДокументНомер, ДокументСтранаВыдачи, Страна";
			СтруктураПараметров.Организация = Организация;
			СтруктураПараметров.НачалоПериода = НачалоПериода;
			СтруктураПараметров.ОкончаниеПериода = КонецМесяца(ДатаОкончания);
			КадровыйУчет.СоздатьВТСотрудникиОрганизации(МенеджерВременныхТаблиц, Ложь, СтруктураПараметров, "ВТСотрудники");
			
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаИзИБ
			|ИЗ
			|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Сотрудники.ФизическоеЛицо
			|ИЗ
			|	ВТСотрудники КАК Сотрудники
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Физлица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ИНН
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ИНН
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК ИНН,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Фамилия
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Фамилия
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Фамилия,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Имя
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Имя
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Имя,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Отчество
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Отчество
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Отчество,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ДатаРождения
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ДатаРождения
			|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			|	КОНЕЦ КАК ДатаРождения,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументСерия, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК СерияДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументНомер, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК НомерДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
			|							КОНЕЦ
			|					ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
			|				КОНЕЦ
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА Сотрудники.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА Сотрудники.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ ЕСТЬNULL(Сотрудники.ДокументСтранаВыдачи.Код, """")
			|							КОНЕЦ
			|					ИНАЧЕ Сотрудники.Страна.Код
			|				КОНЕЦ
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодСтраныДляОтчетности,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовСотрудников.КодМВД, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеФизлицИзИБ
			|ИЗ
			|	ВТФизлицаИзИБ КАК Физлица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
			|			ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
			|		ПО Физлица.ФизическоеЛицо = КадровыеДанныеФизЛиц.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовСотрудников
			|			ПО Сотрудники.ДокументВид = ВидыДокументовСотрудников.Ссылка
			|		ПО Физлица.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МАКСИМУМ(ЕСТЬNULL(ЕСТЬNULL(ФизическиеЛица.Ссылка, ДанныеФизлицИзИБ.ФизическоеЛицо), ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка))) КАК ФизическоеЛицо,
			|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки КАК НомерКорректировки,
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	ВременнаяТаблица.КодФНС КАК КодФНС
			|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.ИНН = ФизическиеЛица.ИНН
			|			И (ВременнаяТаблица.ИНН <> """")
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеФизлицИзИБ КАК ДанныеФизлицИзИБ
			|		ПО ВременнаяТаблица.Фамилия = ДанныеФизлицИзИБ.Фамилия
			|			И ВременнаяТаблица.Имя = ДанныеФизлицИзИБ.Имя
			|			И ВременнаяТаблица.Отчество = ДанныеФизлицИзИБ.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ДанныеФизлицИзИБ.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ДанныеФизлицИзИБ.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ДанныеФизлицИзИБ.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ДанныеФизлицИзИБ.КодМВД
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
			|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
			|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
			|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
			|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
			|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
			|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
			|ГДЕ
			|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки,
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД,
			|	ВременнаяТаблица.КодФНС";
			Запрос.Выполнить(); 
			// АПК:96-вкл
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Итоги, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.П000П1М100001 КАК П000П1М100001,
			|	ВременнаяТаблица.П000П1М100002 КАК П000П1М100002,
			|	ВременнаяТаблица.П000П1М100003 КАК П000П1М100003,
			|	ВременнаяТаблица.П000П1М100004 КАК П000П1М100004,
			|	ВременнаяТаблица.П000П1М100005 КАК П000П1М100005,
			|	ВременнаяТаблица.П000П1М100006 КАК П000П1М100006,
			|	ВременнаяТаблица.П000П1М100007 КАК П000П1М100007,
			|	ВременнаяТаблица.П000П1М100008 КАК П000П1М100008,
			|	ВременнаяТаблица.П000П1М100009 КАК П000П1М100009,
			|	ВременнаяТаблица.П000П1М100010 КАК П000П1М100010
			|ПОМЕСТИТЬ ВТИтогиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Вычеты, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.П000П1М200001 КАК П000П1М200001,
			|	ВременнаяТаблица.П000П1М200002 КАК П000П1М200002
			|ПОМЕСТИТЬ ВТВычетыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, УведомленияОВычетах, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.П000П1М300002 КАК П000П1М300002,
			|	ВременнаяТаблица.П000П1М300003 КАК П000П1М300003,
			|	ВременнаяТаблица.П000П1М300004 КАК П000П1М300004
			|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Доходы, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	СУММА(ВременнаяТаблица.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТДоходыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004 КАК П000П1М600004,
			|	СУММА(ВременнаяТаблица.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВременнаяТаблица.П000П1М600005) <> 0";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
		Иначе
			СоздатьПустыеВТПереданныхДанныхОтчета2023(МенеджерВременныхТаблиц)
		КонецЕсли;
		
	Иначе
		СоздатьПустыеВТПереданныхДанныхОтчета2023(МенеджерВременныхТаблиц)
	КонецЕсли;
	
КонецПроцедуры

Процедура СоздатьПустыеВТПереданныхДанныхОтчета2023(МенеджерВременныхТаблиц)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК НомерСправки,
	|	0 КАК НомерКорректировки,
	|	"""" КАК ИНН,
	|	"""" КАК Фамилия,
	|	"""" КАК Имя,
	|	"""" КАК Отчество,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК ДатаРождения,
	|	"""" КАК КодФНС,
	|	"""" КАК КодСтраныДляОтчетности,
	|	"""" КАК КодМВД,
	|	"""" КАК СерияДокумента,
	|	"""" КАК НомерДокумента
	|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК П000П1М100001,
	|	0 КАК П000П1М100002,
	|	0 КАК П000П1М100003,
	|	0 КАК П000П1М100004,
	|	0 КАК П000П1М100005,
	|	0 КАК П000П1М100006,
	|	0 КАК П000П1М100007,
	|	0 КАК П000П1М100008,
	|	"""" КАК П000П1М100009,
	|	0 КАК П000П1М100010
	|ПОМЕСТИТЬ ВТИтогиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	"""" КАК П000П1М200001,
	|	0 КАК П000П1М200002
	|ПОМЕСТИТЬ ВТВычетыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка) КАК ГруппаВычета,
	|	"""" КАК П000П1М300002,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК П000П1М300003,
	|	"""" КАК П000П1М300004
	|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	0 КАК П000П1М500003
	|ПОМЕСТИТЬ ВТДоходыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	"""" КАК П000П1М600004,
	|	0 КАК П000П1М600005
	|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
	|ГДЕ
	|	ЛОЖЬ";
	Запрос.Выполнить(); 
	
КонецПроцедуры

Процедура ПолучитьПереданныеДанныеОтчета2024(Организация, ОКТМО, КПП, ДатаОкончания, МенеджерВременныхТаблиц, НомерКорректировки, ИмяФормы)
	
	НачалоПериода = НачалоГода(ДатаОкончания);
	Данные = ИнтерфейсыВзаимодействияБРО.СправкиОДоходахИСуммахНалогаФизическихЛицИзОтчетов6_НДФЛ(Новый Структура("Организация, ДатаОкончания, ИмяФормыОтчета", Организация, ДатаОкончания, ИмяФормы));
	Если Данные.Количество() > 0 Тогда
		
		Физлица = Новый ТаблицаЗначений;
		Физлица.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Физлица.Колонки.Добавить("ИНН", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(12)));
		Физлица.Колонки.Добавить("Фамилия", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Имя", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("Отчество", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("ДатаРождения", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Физлица.Колонки.Добавить("КодФНС", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1)));
		Физлица.Колонки.Добавить("КодСтраныДляОтчетности", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(3)));
		Физлица.Колонки.Добавить("КодМВД", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(2)));
		Физлица.Колонки.Добавить("СерияДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Физлица.Колонки.Добавить("НомерДокумента", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(1000)));
		Итоги = Новый ТаблицаЗначений;
		Итоги.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100009", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Итоги.Колонки.Добавить("П000П1М100001", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100002", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100003", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100004", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100005", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100006", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100008", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100010", Новый ОписаниеТипов("Число"));
		Итоги.Колонки.Добавить("П000П1М100011", Новый ОписаниеТипов("Число"));
		Вычеты = Новый ТаблицаЗначений;
		Вычеты.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Вычеты.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Вычеты.Колонки.Добавить("П000П1М200001", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Вычеты.Колонки.Добавить("П000П1М200002", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах = Новый ТаблицаЗначений;
		УведомленияОВычетах.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		УведомленияОВычетах.Колонки.Добавить("ГруппаВычета", Новый ОписаниеТипов("ПеречислениеСсылка.ГруппыВычетовПоНДФЛ"));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300003", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		УведомленияОВычетах.Колонки.Добавить("П000П1М300004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы = Новый ТаблицаЗначений;
		Доходы.Колонки.Добавить("НомерСправки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("НомерКорректировки", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("КБК", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(20)));
		Доходы.Колонки.Добавить("Ставка", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("Период", Новый ОписаниеТипов("Дата,Строка", , Новый КвалификаторыСтроки(100)));
		Доходы.Колонки.Добавить("П000П1М500002", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М500003", Новый ОписаниеТипов("Число"));
		Доходы.Колонки.Добавить("П000П1М600004", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(4)));
		Доходы.Колонки.Добавить("П000П1М600005", Новый ОписаниеТипов("Число"));
		
		НомерСведения = 0;
		Для каждого ДанныеОтчета Из Данные Цикл
			
			Если ДанныеОтчета.НомерКорректировки >= НомерКорректировки Тогда
				Продолжить;;
			КонецЕсли;
			
			// АПК:1036-выкл 
			ОКТМОизДанных = Неопределено; КППизДанных = Неопределено;
			ПроверятьОКТМОиКПП = ДанныеОтчета.Свойство("ОКТМО", ОКТМОизДанных) И ДанныеОтчета.Свойство("КПП", КППизДанных);
			Если ПроверятьОКТМОиКПП И (ОКТМОизДанных <> Лев(ОКТМО, СтрДлина(ОКТМОизДанных)) Или КППизДанных <> КПП) Тогда
				Продолжить;
			КонецЕсли;
			// АПК:1036-вкл 
			
			Для каждого СтрокаСправки Из ДанныеОтчета.СправкиОДоходахИСуммахНалогаФизическихЛиц.Строки Цикл
				
				ДанныеСправки = СтрокаСправки.Данные;
				Если Не ЗначениеЗаполнено(ДанныеСправки.П000П10000001) Тогда // пустую пропустим
					Продолжить;
				КонецЕсли;
				Если ДанныеСправки.П000П10000002 = "99" Тогда // отменяющую пропустим
					Продолжить;
				КонецЕсли;
				 
				НомерСправки = ДанныеСправки.П000П10000001;
				НомерКорректировкиСправки = Число(ДанныеСправки.П000П10000002);
				
				СтрокаДанных = Физлица.Добавить();
				СтрокаДанных.НомерСправки = НомерСправки;
				СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
				СтрокаДанных.ИНН = ДанныеСправки.П000П10000003;
				СтрокаДанных.Фамилия = ДанныеСправки.П000П10000004;
				СтрокаДанных.Имя = ДанныеСправки.П000П10000005;
				СтрокаДанных.Отчество = ДанныеСправки.П000П10000006;
				СтрокаДанных.КодФНС = ДанныеСправки.П000П10000007;
				СтрокаДанных.ДатаРождения = ДанныеСправки.П000П10000008;
				Если ТипЗнч(ДанныеСправки.П000П10000008) <> Тип("Дата") Тогда
					Если ЗначениеЗаполнено(ДанныеСправки.П000П10000008) И ДанныеСправки.П000П10000008 <> "0" Тогда
						СтрокаДанных.ДатаРождения = Дата(ДанныеСправки.П000П10000008);
					Иначе
						СтрокаДанных.ДатаРождения = '00010101'
					КонецЕсли;
				КонецЕсли;
				СтрокаДанных.КодСтраныДляОтчетности = ДанныеСправки.П000П10000009;
				СтрокаДанных.КодМВД = ДанныеСправки.П000П10000010;
				СтрокаДанных.СерияДокумента = ДанныеСправки.П000П10000011;
				СтрокаДанных.НомерДокумента = ДанныеСправки.П000П10000012;
				
				Для каждого СтрокаСтавкиКБК Из СтрокаСправки.ДанныеМногострочныхЧастей.П000П1М1.Строки Цикл
					
					Ставка = СтрокаСтавкиКБК.Данные.П000П1М100001;
					КБК = СтрокаСтавкиКБК.Данные.П000П1М100009;
					Если Не ЗначениеЗаполнено(Ставка) Или Не ЗначениеЗаполнено(КБК) Тогда
						Продолжить;	
					КонецЕсли;
					
					СтрокаДанных = Итоги.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаСтавкиКБК.Данные);
					СтрокаДанных.НомерСправки = НомерСправки;
					СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
					Для каждого СтрокаВычетов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М2.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаВычетов.Данные.П000П1М200002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Вычеты.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
					КонецЦикла;
					Для каждого СтрокаУведомленийОВычетах Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М3.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаУведомленийОВычетах.Данные.П000П1М300002) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = УведомленияОВычетах.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаУведомленийОВычетах.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						КодУведомления = СтрокаУведомленийОВычетах.Данные.П000П1М300001;
						Если КодУведомления = "1" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Имущественные
						ИначеЕсли КодУведомления = "2" Тогда
							СтрокаДанных.ГруппаВычета = Перечисления.ГруппыВычетовПоНДФЛ.Социальные
						КонецЕсли;
					КонецЦикла;
					Для каждого СтрокаДоходов Из СтрокаСтавкиКБК.ДанныеМногострочныхЧастей.П000П1М5.Строки Цикл
						Если Не ЗначениеЗаполнено(СтрокаДоходов.Данные.П000П1М500001) Тогда
							Продолжить;
						КонецЕсли;
						СтрокаДанных = Доходы.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаДоходов.Данные);
						СтрокаДанных.НомерСправки = НомерСправки;
						СтрокаДанных.НомерКорректировки = НомерКорректировкиСправки;
						СтрокаДанных.КБК = КБК;
						СтрокаДанных.Ставка = Ставка;
		 				СтрокаДанных.Период = ДобавитьМесяц(НачалоПериода, Число(СтрокаДоходов.Данные.П000П1М500001) - 1);
						СтрокиВычетов = СтрокаДоходов.ДанныеМногострочныхЧастей.П000П1М6.Строки;
						Если СтрокиВычетов.Количество() = 1 Тогда
							ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокиВычетов[0].Данные);
						ИначеЕсли СтрокиВычетов.Количество() > 1 Тогда
							Для каждого СтрокаВычетов Из СтрокиВычетов Цикл
								Если СтрокиВычетов.Индекс(СтрокаВычетов) = 0 Тогда
									ЗаполнитьЗначенияСвойств(СтрокаДанных, СтрокаВычетов.Данные);
								Иначе
									ДопСтрокаДанных = Доходы.Добавить();
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаДанных, , "П000П1М500003");
									ЗаполнитьЗначенияСвойств(ДопСтрокаДанных, СтрокаВычетов.Данные);
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
					КонецЦикла;
					
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЦикла;
		
		Если Физлица.Количество() > 0 Тогда
			
			Запрос = Новый Запрос;
			Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Физлица, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	МАКСИМУМ(ВременнаяТаблица.НомерКорректировки) КАК НомерКорректировки
			|ПОМЕСТИТЬ ВТПоследниеКорректировки
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД";
			Запрос.Выполнить(); 
			
			// Для отменяющей формы нужен только перечень переданных справок.
			Если НомерКорректировки = 99 Тогда 
				Запрос.Текст = 
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
				|	ВременнаяТаблица.ИНН КАК ИНН,
				|	ВременнаяТаблица.Фамилия КАК Фамилия,
				|	ВременнаяТаблица.Имя КАК Имя,
				|	ВременнаяТаблица.Отчество КАК Отчество,
				|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
				|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
				|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
				|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
				|	ВременнаяТаблица.КодМВД КАК КодМВД,
				|	ВременнаяТаблица.КодФНС КАК КодФНС
				|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
				|ИЗ
				|	ВТВременнаяТаблица КАК ВременнаяТаблица
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
				|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
				|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
				|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
				|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
				|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
				|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
				|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
				|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
				|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
				|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
				|ГДЕ
				|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL ";
				Запрос.Выполнить(); 
				Возврат	
			КонецЕсли;
			
			// Для корректирующей формы нужны все переданные данные.
			
			СтруктураПараметров = КадровыйУчет.ПараметрыПолученияВсехСотрудниковОрганизацийПоСпискуФизическихЛиц();
			СтруктураПараметров.КадровыеДанные = "ФизическоеЛицо, ИНН, Фамилия, Имя, Отчество, ДатаРождения, ДокументВид, ДокументСерия, ДокументНомер, ДокументСтранаВыдачи, Страна";
			СтруктураПараметров.Организация = Организация;
			СтруктураПараметров.НачалоПериода = НачалоПериода;
			СтруктураПараметров.ОкончаниеПериода = КонецМесяца(ДатаОкончания);
			КадровыйУчет.СоздатьВТСотрудникиОрганизации(МенеджерВременныхТаблиц, Ложь, СтруктураПараметров, "ВТСотрудники");
			
			// АПК:96-выкл Использование ОБЪЕДИНИТЬ оправдано
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	КадровыеДанныеФизЛиц.ФизическоеЛицо КАК ФизическоеЛицо
			|ПОМЕСТИТЬ ВТФизлицаИзИБ
			|ИЗ
			|	ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|
			|ОБЪЕДИНИТЬ
			|
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Сотрудники.ФизическоеЛицо
			|ИЗ
			|	ВТСотрудники КАК Сотрудники
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Физлица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ИНН
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ИНН
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК ИНН,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Фамилия
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Фамилия
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Фамилия,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Имя
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Имя
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Имя,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.Отчество
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.Отчество
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК Отчество,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА КадровыеДанныеФизЛиц.ДатаРождения
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА Сотрудники.ДатаРождения
			|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			|	КОНЕЦ КАК ДатаРождения,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументСерия, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументСерия, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК СерияДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(КадровыеДанныеФизЛиц.ДокументНомер, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(Сотрудники.ДокументНомер, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК НомерДокумента,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА КадровыеДанныеФизЛиц.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА КадровыеДанныеФизЛиц.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ КадровыеДанныеФизЛиц.ДокументСтранаВыдачи.Код
			|							КОНЕЦ
			|					ИНАЧЕ ЕСТЬNULL(КадровыеДанныеФизЛиц.Страна.Код, """")
			|				КОНЕЦ
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ВЫБОР
			|					КОГДА Сотрудники.Страна = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|						ТОГДА ВЫБОР
			|								КОГДА Сотрудники.ДокументСтранаВыдачи = ЗНАЧЕНИЕ(Справочник.СтраныМира.ПустаяСсылка)
			|									ТОГДА ""643""
			|								ИНАЧЕ ЕСТЬNULL(Сотрудники.ДокументСтранаВыдачи.Код, """")
			|							КОНЕЦ
			|					ИНАЧЕ Сотрудники.Страна.Код
			|				КОНЕЦ
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодСтраныДляОтчетности,
			|	ВЫБОР
			|		КОГДА КадровыеДанныеФизЛиц.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовФизическихЛиц.КодМВД, """")
			|		КОГДА Сотрудники.ФизическоеЛицо ЕСТЬ НЕ NULL 
			|			ТОГДА ЕСТЬNULL(ВидыДокументовСотрудников.КодМВД, """")
			|		ИНАЧЕ """"
			|	КОНЕЦ КАК КодМВД
			|ПОМЕСТИТЬ ВТДанныеФизлицИзИБ
			|ИЗ
			|	ВТФизлицаИзИБ КАК Физлица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТКадровыеДанныеФизическихЛиц КАК КадровыеДанныеФизЛиц
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовФизическихЛиц
			|			ПО КадровыеДанныеФизЛиц.ДокументВид = ВидыДокументовФизическихЛиц.Ссылка
			|		ПО Физлица.ФизическоеЛицо = КадровыеДанныеФизЛиц.ФизическоеЛицо
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСотрудники КАК Сотрудники
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыДокументовФизическихЛиц КАК ВидыДокументовСотрудников
			|			ПО Сотрудники.ДокументВид = ВидыДокументовСотрудников.Ссылка
			|		ПО Физлица.ФизическоеЛицо = Сотрудники.ФизическоеЛицо
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	МАКСИМУМ(ЕСТЬNULL(ЕСТЬNULL(ФизическиеЛица.Ссылка, ДанныеФизлицИзИБ.ФизическоеЛицо), ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка))) КАК ФизическоеЛицо,
			|	ВременнаяТаблица.НомерСправки КАК НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки КАК НомерКорректировки,
			|	ВременнаяТаблица.ИНН КАК ИНН,
			|	ВременнаяТаблица.Фамилия КАК Фамилия,
			|	ВременнаяТаблица.Имя КАК Имя,
			|	ВременнаяТаблица.Отчество КАК Отчество,
			|	ВременнаяТаблица.ДатаРождения КАК ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента КАК СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента КАК НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности КАК КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД КАК КодМВД,
			|	ВременнаяТаблица.КодФНС КАК КодФНС
			|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.ИНН = ФизическиеЛица.ИНН
			|			И (ВременнаяТаблица.ИНН <> """")
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеФизлицИзИБ КАК ДанныеФизлицИзИБ
			|		ПО ВременнаяТаблица.Фамилия = ДанныеФизлицИзИБ.Фамилия
			|			И ВременнаяТаблица.Имя = ДанныеФизлицИзИБ.Имя
			|			И ВременнаяТаблица.Отчество = ДанныеФизлицИзИБ.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ДанныеФизлицИзИБ.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ДанныеФизлицИзИБ.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ДанныеФизлицИзИБ.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ДанныеФизлицИзИБ.КодМВД
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследниеКорректировки КАК ПоследниеКорректировки
			|		ПО ВременнаяТаблица.НомерКорректировки = ПоследниеКорректировки.НомерКорректировки
			|			И ВременнаяТаблица.ИНН = ПоследниеКорректировки.ИНН
			|			И ВременнаяТаблица.Фамилия = ПоследниеКорректировки.Фамилия
			|			И ВременнаяТаблица.Имя = ПоследниеКорректировки.Имя
			|			И ВременнаяТаблица.Отчество = ПоследниеКорректировки.Отчество
			|			И ВременнаяТаблица.ДатаРождения = ПоследниеКорректировки.ДатаРождения
			|			И ВременнаяТаблица.СерияДокумента = ПоследниеКорректировки.СерияДокумента
			|			И ВременнаяТаблица.НомерДокумента = ПоследниеКорректировки.НомерДокумента
			|			И ВременнаяТаблица.КодМВД = ПоследниеКорректировки.КодМВД
			|			И ВременнаяТаблица.КодСтраныДляОтчетности = ПоследниеКорректировки.КодСтраныДляОтчетности
			|ГДЕ
			|	ПоследниеКорректировки.НомерКорректировки ЕСТЬ НЕ NULL 
			|
			|СГРУППИРОВАТЬ ПО
			|	ВременнаяТаблица.НомерСправки,
			|	ВременнаяТаблица.НомерКорректировки,
			|	ВременнаяТаблица.ИНН,
			|	ВременнаяТаблица.Фамилия,
			|	ВременнаяТаблица.Имя,
			|	ВременнаяТаблица.Отчество,
			|	ВременнаяТаблица.ДатаРождения,
			|	ВременнаяТаблица.СерияДокумента,
			|	ВременнаяТаблица.НомерДокумента,
			|	ВременнаяТаблица.КодСтраныДляОтчетности,
			|	ВременнаяТаблица.КодМВД,
			|	ВременнаяТаблица.КодФНС";
			Запрос.Выполнить(); 
			// АПК:96-вкл
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Итоги, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.П000П1М100001 КАК П000П1М100001,
			|	ВременнаяТаблица.П000П1М100002 КАК П000П1М100002,
			|	ВременнаяТаблица.П000П1М100003 КАК П000П1М100003,
			|	ВременнаяТаблица.П000П1М100004 КАК П000П1М100004,
			|	ВременнаяТаблица.П000П1М100005 КАК П000П1М100005,
			|	ВременнаяТаблица.П000П1М100006 КАК П000П1М100006,
			|	ВременнаяТаблица.П000П1М100008 КАК П000П1М100008,
			|	ВременнаяТаблица.П000П1М100009 КАК П000П1М100009,
			|	ВременнаяТаблица.П000П1М100010 КАК П000П1М100010,
			|	ВременнаяТаблица.П000П1М100011 КАК П000П1М100011
			|ПОМЕСТИТЬ ВТИтогиПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Вычеты, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.П000П1М200001 КАК П000П1М200001,
			|	ВременнаяТаблица.П000П1М200002 КАК П000П1М200002
			|ПОМЕСТИТЬ ВТВычетыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, УведомленияОВычетах, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.ГруппаВычета КАК ГруппаВычета,
			|	ВременнаяТаблица.П000П1М300002 КАК П000П1М300002,
			|	ВременнаяТаблица.П000П1М300003 КАК П000П1М300003,
			|	ВременнаяТаблица.П000П1М300004 КАК П000П1М300004
			|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
			ЗарплатаКадры.СоздатьВТПоТаблицеЗначений(МенеджерВременныхТаблиц, Доходы, "ВТВременнаяТаблица");
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	СУММА(ВременнаяТаблица.П000П1М500003) КАК П000П1М500003
			|ПОМЕСТИТЬ ВТДоходыПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ФизическиеЛица.ФизическоеЛицо КАК ФизическоеЛицо,
			|	ВременнаяТаблица.КБК КАК КБК,
			|	ВременнаяТаблица.Ставка КАК Ставка,
			|	ВременнаяТаблица.Период КАК Период,
			|	ВременнаяТаблица.П000П1М500002 КАК П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004 КАК П000П1М600004,
			|	СУММА(ВременнаяТаблица.П000П1М600005) КАК П000П1М600005
			|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
			|ИЗ
			|	ВТВременнаяТаблица КАК ВременнаяТаблица
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНалогоплательщикиПереданные КАК ФизическиеЛица
			|		ПО ВременнаяТаблица.НомерСправки = ФизическиеЛица.НомерСправки
			|			И ВременнаяТаблица.НомерКорректировки = ФизическиеЛица.НомерКорректировки
			|
			|СГРУППИРОВАТЬ ПО
			|	ФизическиеЛица.ФизическоеЛицо,
			|	ВременнаяТаблица.КБК,
			|	ВременнаяТаблица.Ставка,
			|	ВременнаяТаблица.Период,
			|	ВременнаяТаблица.П000П1М500002,
			|	ВременнаяТаблица.П000П1М600004
			|
			|ИМЕЮЩИЕ
			|	СУММА(ВременнаяТаблица.П000П1М600005) <> 0";
			Запрос.Выполнить(); 
			ЗарплатаКадры.УничтожитьВТ(МенеджерВременныхТаблиц, "ВТВременнаяТаблица");
			
		Иначе
			СоздатьПустыеВТПереданныхДанныхОтчета2024(МенеджерВременныхТаблиц)
		КонецЕсли;
		
	Иначе
		СоздатьПустыеВТПереданныхДанныхОтчета2024(МенеджерВременныхТаблиц)
	КонецЕсли;
	
КонецПроцедуры

Процедура СоздатьПустыеВТПереданныхДанныхОтчета2024(МенеджерВременныхТаблиц)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК НомерСправки,
	|	0 КАК НомерКорректировки,
	|	"""" КАК ИНН,
	|	"""" КАК Фамилия,
	|	"""" КАК Имя,
	|	"""" КАК Отчество,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК ДатаРождения,
	|	"""" КАК КодФНС,
	|	"""" КАК КодСтраныДляОтчетности,
	|	"""" КАК КодМВД,
	|	"""" КАК СерияДокумента,
	|	"""" КАК НомерДокумента
	|ПОМЕСТИТЬ ВТНалогоплательщикиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК П000П1М100001,
	|	0 КАК П000П1М100002,
	|	0 КАК П000П1М100003,
	|	0 КАК П000П1М100004,
	|	0 КАК П000П1М100005,
	|	0 КАК П000П1М100006,
	|	0 КАК П000П1М100008,
	|	"""" КАК П000П1М100009,
	|	0 КАК П000П1М100010,
	|	0 КАК П000П1М100011
	|ПОМЕСТИТЬ ВТИтогиПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	"""" КАК П000П1М200001,
	|	0 КАК П000П1М200002
	|ПОМЕСТИТЬ ВТВычетыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	ЗНАЧЕНИЕ(Перечисление.ГруппыВычетовПоНДФЛ.ПустаяСсылка) КАК ГруппаВычета,
	|	"""" КАК П000П1М300002,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК П000П1М300003,
	|	"""" КАК П000П1М300004
	|ПОМЕСТИТЬ ВТУведомленияОВычетахПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	0 КАК П000П1М500003
	|ПОМЕСТИТЬ ВТДоходыПереданные
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
	|	0 КАК Ставка,
	|	"""" КАК КБК,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
	|	"""" КАК П000П1М500002,
	|	"""" КАК П000П1М600004,
	|	0 КАК П000П1М600005
	|ПОМЕСТИТЬ ВТВычетыКДоходамПереданные
	|ГДЕ
	|	ЛОЖЬ";
	Запрос.Выполнить(); 
	
КонецПроцедуры

Процедура ВыделитьСуммыПревышенияПредела2024(Знач ОблагаемыйДоходДоПредела, СтрокиРаспределения, СтрокиДоходовПревышающихПредел) 

	Если ОблагаемыйДоходДоПредела = 0 Или СтрокиРаспределения.Количество() = 0 Тогда
		Возврат
	КонецЕсли;
	
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Вставить("СтавкаНалога", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом * 100);
	
	ОблагаемыйДоходЗаДень = СтрокиРаспределения[0].ОблагаемыйДоходЗаДень;
	
	СтрокиДляРаспределения = Новый Массив;
	Для Каждого СтрокаТаблицы Из СтрокиРаспределения Цикл
		Если СтрокаТаблицы.ОписаниеДокументаСПревышением = 1 Тогда
			ОблагаемыйДоходЗаДень = ОблагаемыйДоходЗаДень - СтрокаТаблицы.СуммаДохода + СтрокаТаблицы.СуммаВычета;
			ОблагаемыйДоходДоПредела = ОблагаемыйДоходДоПредела - СтрокаТаблицы.СуммаДохода + СтрокаТаблицы.СуммаВычета;
		ИначеЕсли СтрокаТаблицы.ОписаниеДокументаСПревышением = 2 Тогда
			ОблагаемыйДоходЗаДень = ОблагаемыйДоходЗаДень - СтрокаТаблицы.СуммаДохода + СтрокаТаблицы.СуммаВычета;
		Иначе
			СтрокиДляРаспределения.Добавить(СтрокаТаблицы)
		КонецЕсли;
	КонецЦикла;
	
	Если ОблагаемыйДоходДоПредела = 0 Или ОблагаемыйДоходЗаДень = 0 Или СтрокиДляРаспределения.Количество() = 0 Тогда
		Возврат
	КонецЕсли;
	
	Если СтрокиДляРаспределения.Количество() = 1 Тогда
		СтрокаТаблицы = СтрокиДляРаспределения[0];
		СтрокаПревышения = СтрокиДоходовПревышающихПредел.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаПревышения, СтрокаТаблицы);
		СтрокаТаблицы.СуммаДохода = ОблагаемыйДоходДоПредела;
		Если СтрокаТаблицы.СуммаВычета <> 0 Тогда
			СтрокаТаблицы.СуммаВычета = Окр(СтрокаТаблицы.СуммаВычета * ОблагаемыйДоходДоПредела / ОблагаемыйДоходЗаДень, 2);
			СтрокаТаблицы.СуммаДохода = СтрокаТаблицы.СуммаДохода + СтрокаТаблицы.СуммаВычета;
		КонецЕсли;
		ЗаполнитьЗначенияСвойств(СтрокаПревышения, ПараметрыРасчетаНДФЛПоПрогрессивнойШкале);
		СтрокаПревышения.СуммаДохода = СтрокаПревышения.СуммаДохода - СтрокаТаблицы.СуммаДохода;
		Если СтрокаПревышения.СуммаВычета <> 0 Тогда
			СтрокаПревышения.СуммаВычета = СтрокаПревышения.СуммаВычета - СтрокаТаблицы.СуммаВычета;
		КонецЕсли;
	Иначе
		
		МаксимальныйКоэффициент = 0;
		РаспределеннаяСумма = 0;
		РаспределенныеДоходы = Новый Соответствие;
		Для Каждого СтрокаТаблицы Из СтрокиДляРаспределения Цикл
			АбсолютноеЗначениеКоэффициента = (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета) * (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета);
			Если МаксимальныйКоэффициент < АбсолютноеЗначениеКоэффициента Тогда
				МаксимальныйКоэффициент = АбсолютноеЗначениеКоэффициента;
				СтрокаМаксимальногоКоэффициента = СтрокаТаблицы;
			КонецЕсли;
			СуммаСтроки = Окр(ОблагаемыйДоходДоПредела * (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета) / ОблагаемыйДоходЗаДень, 2, 1);
			РаспределенныеДоходы.Вставить(СтрокаТаблицы, СуммаСтроки);
			РаспределеннаяСумма = РаспределеннаяСумма + СуммаСтроки;
		КонецЦикла;
		Если Не РаспределеннаяСумма = ОблагаемыйДоходДоПредела Тогда
			РаспределенныеДоходы.Вставить(СтрокаМаксимальногоКоэффициента, РаспределенныеДоходы[СтрокаМаксимальногоКоэффициента] + ОблагаемыйДоходДоПредела - РаспределеннаяСумма)
		КонецЕсли;
		Для Каждого СтрокаТаблицы Из СтрокиДляРаспределения Цикл
			Если СтрокаТаблицы.СуммаДохода = СтрокаТаблицы.СуммаВычета Тогда
				 Продолжить;
			КонецЕсли;
			СтрокаПревышения = СтрокиДоходовПревышающихПредел.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаПревышения, СтрокаТаблицы);
			Если СтрокаТаблицы.СуммаВычета <> 0 И СтрокаТаблицы.СуммаДохода <> 0 Тогда
				СтрокаТаблицы.СуммаВычета = Окр(СтрокаТаблицы.СуммаВычета * РаспределенныеДоходы[СтрокаТаблицы] / (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета), 2);
			КонецЕсли;
			СтрокаТаблицы.СуммаДохода = РаспределенныеДоходы[СтрокаТаблицы];
			Если СтрокаТаблицы.СуммаВычета <> 0 И СтрокаТаблицы.СуммаДохода <> 0 Тогда
				СтрокаТаблицы.СуммаДохода = СтрокаТаблицы.СуммаДохода + СтрокаТаблицы.СуммаВычета;
			КонецЕсли;
			ЗаполнитьЗначенияСвойств(СтрокаПревышения, ПараметрыРасчетаНДФЛПоПрогрессивнойШкале);
			СтрокаПревышения.СуммаДохода = СтрокаПревышения.СуммаДохода - СтрокаТаблицы.СуммаДохода;
			Если СтрокаПревышения.СуммаВычета <> 0 Тогда
				СтрокаПревышения.СуммаВычета = СтрокаПревышения.СуммаВычета - СтрокаТаблицы.СуммаВычета;
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;
	
	
КонецПроцедуры

Процедура ВыделитьСуммыПревышенияПредела(ОблагаемыйДоходДоПредела, СтрокиРаспределения, СтрокиДоходовПревышающихПредел) 

	Если ОблагаемыйДоходДоПредела = 0 Тогда
		Возврат
	КонецЕсли;
	
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале = ПараметрыРасчетаНДФЛПоПрогрессивнойШкале();
	ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.Вставить("СтавкаНалога", ПараметрыРасчетаНДФЛПоПрогрессивнойШкале.СтавкаЧислом * 100);
	
	Если СтрокиРаспределения.Количество() = 1 Тогда
		СтрокаТаблицы = СтрокиРаспределения[0];
		СтрокаПревышения = СтрокиДоходовПревышающихПредел.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаПревышения, СтрокаТаблицы);
		СтрокаТаблицы.СуммаДохода = ОблагаемыйДоходДоПредела;
		Если СтрокаТаблицы.СуммаВычета <> 0 Тогда
			СтрокаТаблицы.СуммаВычета = Окр(СтрокаТаблицы.СуммаВычета * ОблагаемыйДоходДоПредела / СтрокаТаблицы.ОблагаемыйДоходЗаДень, 2);
			СтрокаТаблицы.СуммаДохода = СтрокаТаблицы.СуммаДохода + СтрокаТаблицы.СуммаВычета;
		КонецЕсли;
		ЗаполнитьЗначенияСвойств(СтрокаПревышения, ПараметрыРасчетаНДФЛПоПрогрессивнойШкале);
		СтрокаПревышения.СуммаДохода = СтрокаПревышения.СуммаДохода - СтрокаТаблицы.СуммаДохода;
		Если СтрокаПревышения.СуммаВычета <> 0 Тогда
			СтрокаПревышения.СуммаВычета = СтрокаПревышения.СуммаВычета - СтрокаТаблицы.СуммаВычета;
		КонецЕсли;
	Иначе
		
		МаксимальныйКоэффициент = 0;
		РаспределеннаяСумма = 0;
		РаспределенныеДоходы = Новый Соответствие;
		Для Каждого СтрокаТаблицы Из СтрокиРаспределения Цикл
			АбсолютноеЗначениеКоэффициента = (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета) * (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета);
			Если МаксимальныйКоэффициент < АбсолютноеЗначениеКоэффициента Тогда
				МаксимальныйКоэффициент = АбсолютноеЗначениеКоэффициента;
				СтрокаМаксимальногоКоэффициента = СтрокаТаблицы;
			КонецЕсли;
			СуммаСтроки = Окр(ОблагаемыйДоходДоПредела * (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета) / СтрокаТаблицы.ОблагаемыйДоходЗаДень, 2, 1);
			РаспределенныеДоходы.Вставить(СтрокаТаблицы, СуммаСтроки);
			РаспределеннаяСумма = РаспределеннаяСумма + СуммаСтроки;
		КонецЦикла;
		Если Не РаспределеннаяСумма = ОблагаемыйДоходДоПредела Тогда
			РаспределенныеДоходы.Вставить(СтрокаМаксимальногоКоэффициента, РаспределенныеДоходы[СтрокаМаксимальногоКоэффициента] + ОблагаемыйДоходДоПредела - РаспределеннаяСумма)
		КонецЕсли;
		Для Каждого СтрокаТаблицы Из СтрокиРаспределения Цикл
			Если СтрокаТаблицы.СуммаДохода = СтрокаТаблицы.СуммаВычета Тогда
				 Продолжить;
			КонецЕсли;
			СтрокаПревышения = СтрокиДоходовПревышающихПредел.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаПревышения, СтрокаТаблицы);
			Если СтрокаТаблицы.СуммаВычета <> 0 И СтрокаТаблицы.СуммаДохода <> 0 Тогда
				СтрокаТаблицы.СуммаВычета = Окр(СтрокаТаблицы.СуммаВычета * РаспределенныеДоходы[СтрокаТаблицы] / (СтрокаТаблицы.СуммаДохода - СтрокаТаблицы.СуммаВычета), 2);
			КонецЕсли;
			СтрокаТаблицы.СуммаДохода = РаспределенныеДоходы[СтрокаТаблицы];
			Если СтрокаТаблицы.СуммаВычета <> 0 И СтрокаТаблицы.СуммаДохода <> 0 Тогда
				СтрокаТаблицы.СуммаДохода = СтрокаТаблицы.СуммаДохода + СтрокаТаблицы.СуммаВычета;
			КонецЕсли;
			ЗаполнитьЗначенияСвойств(СтрокаПревышения, ПараметрыРасчетаНДФЛПоПрогрессивнойШкале);
			СтрокаПревышения.СуммаДохода = СтрокаПревышения.СуммаДохода - СтрокаТаблицы.СуммаДохода;
			Если СтрокаПревышения.СуммаВычета <> 0 Тогда
				СтрокаПревышения.СуммаВычета = СтрокаПревышения.СуммаВычета - СтрокаТаблицы.СуммаВычета;
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;
	
	
КонецПроцедуры

Процедура ОчиститьПоляСтруктурыПоказателей(ПоказателиОтчета, СтруктураПолей)

	Значение = Неопределено;
	
	Для каждого КлючИЗначение Из СтруктураПолей Цикл
		Если ПоказателиОтчета.Свойство(КлючИЗначение.Ключ, Значение) Тогда
			ТипПоля = ТипЗнч(СтруктураПолей[КлючИЗначение.Ключ]);
			Если ТипПоля = Тип("Строка") Тогда
				СтруктураПолей[КлючИЗначение.Ключ] = ""
			ИначеЕсли ТипПоля = Тип("Дата") Тогда
				СтруктураПолей[КлючИЗначение.Ключ] = '00010101'
			Иначе
				СтруктураПолей[КлючИЗначение.Ключ] = 0
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Функция ЗапросБезПолейРасшифровки(Знач ТекстЗапроса, МассивПолей, ИмяТаблицы = "СведенияОДоходах")
	
	Для каждого ПолеРасшифровки Из МассивПолей Цикл
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,ИмяТаблицы + "." + ПолеРасшифровки,"Неопределено");
	КонецЦикла;
	
	Возврат ТекстЗапроса
	
КонецФункции	

Функция НовоеПустоеДеревоДляОтчета()
	
	ПустоеДерево = Новый ДеревоЗначений;
	ПустоеДерево.Колонки.Добавить("Данные", Новый ОписаниеТипов("Структура"));
	ПустоеДерево.Колонки.Добавить("ДанныеМногострочныхЧастей", Новый ОписаниеТипов("Структура"));
	
	Возврат ПустоеДерево
	
КонецФункции

Функция НовыеПустыеДанныеМногострочныхЧастей(ИменаМногострочныхЧастей)
	
	ПустыеДанные = Новый Структура();
	Ключи = СтрРазделить(ИменаМногострочныхЧастей, ",", Ложь);
	Для каждого Имя Из Ключи Цикл
		ПустыеДанные.Вставить(Имя, НовоеПустоеДеревоДляОтчета())
	КонецЦикла;
	
	Возврат ПустыеДанные
	
КонецФункции

// Чтение удержанного налога.

// Формирует таблицу сумм удержанного налога в разрезе КБК, сроков перечисления и регистраций в ИФНС.
//
// Параметры:
//		Организация - СправочникСсылка.Организации - должно быть непустым значением.
//		НачалоПериода - дата - 
//		ОкончаниеПериода - дата - 
//		ПолучатьДанныеПоВсемуЮрлицу - булево - 
//		ДляЕНП - булево - если равно Истина, используются особый отбор данных и расчет срока перечисления налога;
//                        если равно Ложь, данные об удержанном налоге без затей читаются из данных учета.
//
//  Возвращаемое значение: 
//		таблица значений с колонками
//			Организация - СправочникСсылка.Организации - может быть как головной, так и ОП
//			РегистрацияВНалоговомОргане - СправочникСсылка.РегистрацииВНалоговомОргане
//			СрокПеречисленияНалога - дата
//			КБК - строка
//			Сумма
//			
Функция УдержаноНалогаЗаПериодДо2025(Организация, НачалоПериода, ОкончаниеПериода, ПолучатьДанныеПоВсемуЮрлицу = Ложь, ДляЕНП = Истина) Экспорт 

	Если НачалоПериода < '20240101' Тогда
		Возврат УдержаноНалогаЗаПериодДо2024(Организация, НачалоПериода, ОкончаниеПериода, ПолучатьДанныеПоВсемуЮрлицу, ДляЕНП)	
	КонецЕсли;
	
	Если ДляЕНП Тогда
		Возврат УдержаноНалогаДляЕНПдо2025(Организация, НачалоПериода, ОкончаниеПериода)
	КонецЕсли;
	
	СтруктураКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ДоНачалаПериода", НачалоПериода - 1);
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("КБКсПревышения", СтруктураКБК.СПревышения);
	Запрос.УстановитьПараметр("ДивидендыСПревышения", СтруктураКБК.ДивидендыСПревышения);
	Запрос.УстановитьПараметр("СоответствиеКатегорийКБК", УчетНДФЛ.КБККатегорийДохода(НачалоПериода));
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
	|	СоответствиеКатегорийКБК.Статус КАК Статус,
	|	СоответствиеКатегорийКБК.КБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|ИЗ
	|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода КАК СуммаВыплаченногоДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК Период,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
	|	СоответствиеКатегорийКБК.КБК КАК КБК,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период, ДЕНЬ) КАК ДатаВозврата,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТНалоги
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
	|			И (&НачалоПериода МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
	|			И (ЕСТЬNULL(РезидентствоФизлиц.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = СоответствиеКатегорийКБК.Статус)
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериода И &ОкончаниеПериода
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И &УсловиеНаОрганизацию
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания В (ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано), ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
	|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
	|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";
	
	Если ПолучатьДанныеПоВсемуЮрлицу Тогда
		Запрос.УстановитьПараметр("УсловиеНаОрганизацию", Истина);
	Иначе
		Запрос.УстановитьПараметр("Организация", Организация);
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеНаОрганизацию", "РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация");
	КонецЕсли;
	
	ОсновнойТекст = 
	"ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК Сумма,
	|	СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) КАК СуммаСПревышения,
	|	СоответствиеКатегорийКБК.КБК КАК КБК,
	|	&НачалоПериода КАК ДатаВозврата,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТОстаткиВозвратов
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
	|			И (&НачалоПериода МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
	|			И (ЕСТЬNULL(РезидентствоФизлиц.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = СоответствиеКатегорийКБК.Статус)
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоГода И &ДоНачалаПериода
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И &УсловиеНаОрганизацию
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания В (ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано), ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода,
	|	СоответствиеКатегорийКБК.КБК,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане
	|
	|ИМЕЮЩИЕ
	|	(СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) < 0
	|		ИЛИ СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) < 0)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоФизическимЛицам.КБК КАК КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога КАК СрокПеречисленияНалога,
	|	СУММА(ДанныеПоФизическимЛицам.Сумма) КАК Сумма,
	|	ДанныеПоФизическимЛицам.Организация КАК Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.ДатаУдержания КАК ДатаУдержания
	|ИЗ
	|	(ВЫБРАТЬ
	|		НалогиПоДатам.КБК КАК КБК,
	|		НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисленияНалога,
	|		НалогиПоДатам.ДатаУдержания КАК ДатаУдержания,
	|		СУММА(НалогиПоДатам.Сумма) КАК Сумма,
	|		НалогиПоДатам.Организация КАК Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.Сумма) > 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|		И НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) > 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|		И НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) > 0) КАК ДанныеПоФизическимЛицам
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога,
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.ДатаУдержания
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога УБЫВ,
	|	ДатаУдержания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоФизическимЛицам.КБК КАК КБК,
	|	ДанныеПоФизическимЛицам.ДатаВозврата КАК ДатаВозврата,
	|	СУММА(ДанныеПоФизическимЛицам.Сумма) КАК Сумма,
	|	ДанныеПоФизическимЛицам.Организация КАК Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ИЗ
	|	(ВЫБРАТЬ
	|		НалогиПоДатам.КБК КАК КБК,
	|		НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата КАК ДатаВозврата,
	|		-СУММА(НалогиПоДатам.Сумма) КАК Сумма,
	|		НалогиПоДатам.Организация КАК Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.Сумма) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|		И НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|		И НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.Сумма,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.Сумма < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.СуммаСПревышения,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|		И НалогиПоДатам.СуммаСПревышения < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.СуммаСПревышения,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|		И НалогиПоДатам.СуммаСПревышения < 0) КАК ДанныеПоФизическимЛицам
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.ДатаВозврата,
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДанныеПоФизическимЛицам.ДатаВозврата";
	Если Не ПолучатьДанныеПоВсемуЮрлицу Тогда
		ОсновнойТекст = СтрЗаменить(ОсновнойТекст, "&УсловиеНаОрганизацию", "РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация");
	КонецЕсли;
	
	ЧастиЗапроса = Новый Массив;
	ЧастиЗапроса.Добавить(ТекстЗапроса);
	ЧастиЗапроса.Добавить(ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов());
	ЧастиЗапроса.Добавить(ОсновнойТекст);
	Запрос.Текст = СтрСоединить(ЧастиЗапроса, Символы.ПС);
	
	Результаты = Запрос.ВыполнитьПакет();
	ВсеУдержания = Результаты[3].Выгрузить();
	Возвраты = Результаты[4];
	Если Не Возвраты.Пустой() Тогда
		
		ВсеВозвраты = Возвраты.Выгрузить();
		
		Измерения = "КБК,Организация,РегистрацияВНалоговомОргане";
		СтруктураПоиска = Новый Структура(Измерения);
		ВсеВозвраты.Индексы.Добавить(Измерения);
		
		ТекущийКБК = "";
		ТекущаяОрганизация = Неопределено;
		ТекущаяРегистрацияВНалоговомОргане = Неопределено;
		Для каждого СтрокаУдержания Из ВсеУдержания Цикл
			Если ТекущийКБК <> СтрокаУдержания.КБК
				Или ТекущаяОрганизация <> СтрокаУдержания.Организация
				Или ТекущаяРегистрацияВНалоговомОргане <> СтрокаУдержания.РегистрацияВНалоговомОргане Тогда
				
				ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаУдержания);
				СтрокиВозвратов = ВсеВозвраты.НайтиСтроки(СтруктураПоиска);
				ПропуститьНаборИзмерений = СтрокиВозвратов.Количество() = 0;
				
				СтрокиВозвратов = ВсеВозвраты.Скопировать(СтрокиВозвратов);
				Если СтрокиВозвратов.Количество() > 1 Тогда
					СтрокиВозвратов.Сортировать("ДатаВозврата Убыв");
				КонецЕсли;
				
				ТекущийКБК = СтрокаУдержания.КБК;
				ТекущаяОрганизация = СтрокаУдержания.Организация;
				ТекущаяРегистрацияВНалоговомОргане = СтрокаУдержания.РегистрацияВНалоговомОргане;
				
			КонецЕсли;
			Если ПропуститьНаборИзмерений Тогда
				Продолжить;
			КонецЕсли;
			Для каждого СтрокаВозврата Из СтрокиВозвратов Цикл
				
				Если СтрокаВозврата.ДатаВозврата > СтрокаУдержания.СрокПеречисленияНалога Или СтрокаУдержания.Сумма = 0 Тогда
					Прервать;
				КонецЕсли;
				СуммаКЗачету = Мин(СтрокаУдержания.Сумма, СтрокаВозврата.Сумма);
				СтрокаУдержания.Сумма = СтрокаУдержания.Сумма - СуммаКЗачету;
				СтрокаВозврата.Сумма = СтрокаВозврата.Сумма - СуммаКЗачету;
				
			КонецЦикла;
		КонецЦикла;
		
	КонецЕсли;
	
	ВсеУдержания.Свернуть("КБК,Организация,РегистрацияВНалоговомОргане,СрокПеречисленияНалога,ДатаУдержания", "Сумма");
	
	СтрокиКУдалению = ВсеУдержания.НайтиСтроки(Новый Структура("Сумма", 0));
	Для каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
		ВсеУдержания.Удалить(УдаляемаяСтрока);
	КонецЦикла;	
	
	Возврат ВсеУдержания
	
КонецФункции

Функция УдержаноНалогаДляЕНПдо2025(Организация, НачалоПериода, ОкончаниеПериода) Экспорт

	СтруктураКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	
	ДетализироватьПоСтатьям  = Ложь;
	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыРасширеннаяПодсистемы") Тогда
		ИмяОпции = "ИспользоватьСтатьиФинансированияЗарплатаРасширенный";
		ДетализироватьПоСтатьям = ПолучитьФункциональнуюОпцию(ИмяОпции);
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ДоНачалаПериода", НачалоПериода - 1);
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("КБКсПревышения", СтруктураКБК.СПревышения);
	Запрос.УстановитьПараметр("ДивидендыСПревышения", СтруктураКБК.ДивидендыСПревышения);
	Запрос.УстановитьПараметр("СоответствиеКатегорийКБК", УчетНДФЛ.КБККатегорийДохода(НачалоПериода));
	Запрос.УстановитьПараметр("Организация", Организация);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
	|	СоответствиеКатегорийКБК.Статус КАК Статус,
	|	СоответствиеКатегорийКБК.КБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|ИЗ
	|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК Период,
	|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КрайнийСрокУплаты,
	|	ЗНАЧЕНИЕ(Справочник.СтатьиФинансированияЗарплата.ПустаяСсылка) КАК СтатьяФинансирования,
	|	ЗНАЧЕНИЕ(Справочник.СтатьиРасходовЗарплата.ПустаяСсылка) КАК СтатьяРасходов,
	|	СоответствиеКатегорийКБК.КБК КАК КБК,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период, ДЕНЬ) КАК ДатаВозврата,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
	|			И (&НачалоПериода МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
	|			И (ЕСТЬNULL(РезидентствоФизлиц.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = СоответствиеКатегорийКБК.Статус)
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериода И &ОкончаниеПериода
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания В (ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано), ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
	|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
	|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";
	
	Если ДетализироватьПоСтатьям Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ","РегистрНакопления.НДФЛКПеречислению");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,	"ЗНАЧЕНИЕ(Справочник.СтатьиФинансированияЗарплата.ПустаяСсылка)",
													"РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтатьяФинансирования");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,	"ЗНАЧЕНИЕ(Справочник.СтатьиРасходовЗарплата.ПустаяСсылка)",
													"РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтатьяРасходов");
	КонецЕсли;
	
	ВременнаяТаблица = Запрос.Выполнить().Выгрузить();
	
	// Рассчитаем крайний срок уплаты заново - без переноса на рабочие дни.
	УчетНДФЛ.ПроставитьКрайнийСрокУплаты(ВременнаяТаблица, , Ложь);
	
	Запрос.УстановитьПараметр("РасчетыНалогоплательщиковСБюджетомПоНДФЛ", ВременнаяТаблица);
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
	|	СоответствиеКатегорийКБК.Статус КАК Статус,
	|	СоответствиеКатегорийКБК.КБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|ИЗ
	|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период, ДЕНЬ) КАК ДатаВозврата,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтатьяФинансирования КАК СтатьяФинансирования,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СтатьяРасходов КАК СтатьяРасходов,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КБК КАК КБК,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТНалоги
	|ИЗ
	|	&РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ";
	
	ОсновнойТекст = 
	"ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК Сумма,
	|	СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) КАК СуммаСПревышения,
	|	СоответствиеКатегорийКБК.КБК КАК КБК,
	|	&НачалоПериода КАК ДатаВозврата,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТОстаткиВозвратов
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатусФизическихЛицКакНалогоплательщиковНДФЛВторичный КАК РезидентствоФизлиц
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо = РезидентствоФизлиц.ФизическоеЛицо
	|			И (&НачалоПериода МЕЖДУ РезидентствоФизлиц.ДатаНачала И РезидентствоФизлиц.ДатаОкончания)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
	|			И (ЕСТЬNULL(РезидентствоФизлиц.Статус, ЗНАЧЕНИЕ(Справочник.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) = СоответствиеКатегорийКБК.Статус)
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоГода И &ДоНачалаПериода
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания В (ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано), ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода,
	|	СоответствиеКатегорийКБК.КБК,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане
	|
	|ИМЕЮЩИЕ
	|	(СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) < 0
	|		ИЛИ СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) < 0)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоФизическимЛицам.КБК КАК КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога КАК СрокПеречисленияНалога,
	|	ДанныеПоФизическимЛицам.СтатьяФинансирования КАК СтатьяФинансирования,
	|	ДанныеПоФизическимЛицам.СтатьяРасходов КАК СтатьяРасходов,
	|	СУММА(ДанныеПоФизическимЛицам.Сумма) КАК Сумма,
	|	ДанныеПоФизическимЛицам.Организация КАК Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.ДатаУдержания КАК ДатаУдержания
	|ИЗ
	|	(ВЫБРАТЬ
	|		НалогиПоДатам.КБК КАК КБК,
	|		НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисленияНалога,
	|		НалогиПоДатам.СтатьяФинансирования КАК СтатьяФинансирования,
	|		НалогиПоДатам.СтатьяРасходов КАК СтатьяРасходов,
	|		НалогиПоДатам.ДатаУдержания КАК ДатаУдержания,
	|		СУММА(НалогиПоДатам.Сумма) КАК Сумма,
	|		НалогиПоДатам.Организация КАК Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.СтатьяФинансирования,
	|		НалогиПоДатам.СтатьяРасходов,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.Сумма) > 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.СтатьяФинансирования,
	|		НалогиПоДатам.СтатьяРасходов,
	|		НалогиПоДатам.ДатаУдержания,
	|		СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|		И НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.СтатьяФинансирования,
	|		НалогиПоДатам.СтатьяРасходов,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) > 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.СтатьяФинансирования,
	|		НалогиПоДатам.СтатьяРасходов,
	|		НалогиПоДатам.ДатаУдержания,
	|		СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|		И НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.СтатьяФинансирования,
	|		НалогиПоДатам.СтатьяРасходов,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) > 0) КАК ДанныеПоФизическимЛицам
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.СтатьяФинансирования,
	|	ДанныеПоФизическимЛицам.СтатьяРасходов,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога,
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.ДатаУдержания
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога УБЫВ,
	|	ДатаУдержания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоФизическимЛицам.КБК КАК КБК,
	|	ДанныеПоФизическимЛицам.ДатаВозврата КАК ДатаВозврата,
	|	СУММА(ДанныеПоФизическимЛицам.Сумма) КАК Сумма,
	|	ДанныеПоФизическимЛицам.Организация КАК Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ИЗ
	|	(ВЫБРАТЬ
	|		НалогиПоДатам.КБК КАК КБК,
	|		НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата КАК ДатаВозврата,
	|		-СУММА(НалогиПоДатам.Сумма) КАК Сумма,
	|		НалогиПоДатам.Организация КАК Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.Сумма) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|		И НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|		И НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.Сумма,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.Сумма < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.СуммаСПревышения,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|		И НалогиПоДатам.СуммаСПревышения < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.СуммаСПревышения,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|		И НалогиПоДатам.СуммаСПревышения < 0) КАК ДанныеПоФизическимЛицам
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.ДатаВозврата,
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДанныеПоФизическимЛицам.ДатаВозврата";
	
	Если ДетализироватьПоСтатьям Тогда
		ОсновнойТекст = СтрЗаменить(ОсновнойТекст,"РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ","РегистрНакопления.НДФЛКПеречислению");
	КонецЕсли;
	
	ЧастиЗапроса = Новый Массив;
	ЧастиЗапроса.Добавить(ТекстЗапроса);
	ЧастиЗапроса.Добавить(ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов());
	ЧастиЗапроса.Добавить(ОсновнойТекст);
	Запрос.Текст = СтрСоединить(ЧастиЗапроса, Символы.ПС);
	
	Результаты = Запрос.ВыполнитьПакет();
	ВсеУдержания = Результаты[3].Выгрузить();
	Возвраты = Результаты[4];
	Если Не Возвраты.Пустой() Тогда
		
		ВсеВозвраты = Возвраты.Выгрузить();
		
		Измерения = "КБК,Организация,РегистрацияВНалоговомОргане";
		СтруктураПоиска = Новый Структура(Измерения);
		ВсеВозвраты.Индексы.Добавить(Измерения);
		
		ТекущийКБК = "";
		ТекущаяОрганизация = Неопределено;
		ТекущаяРегистрацияВНалоговомОргане = Неопределено;
		Для каждого СтрокаУдержания Из ВсеУдержания Цикл
			Если ТекущийКБК <> СтрокаУдержания.КБК
				Или ТекущаяОрганизация <> СтрокаУдержания.Организация
				Или ТекущаяРегистрацияВНалоговомОргане <> СтрокаУдержания.РегистрацияВНалоговомОргане Тогда
				
				ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаУдержания);
				СтрокиВозвратов = ВсеВозвраты.НайтиСтроки(СтруктураПоиска);
				ПропуститьНаборИзмерений = СтрокиВозвратов.Количество() = 0;
				
				СтрокиВозвратов = ВсеВозвраты.Скопировать(СтрокиВозвратов);
				Если СтрокиВозвратов.Количество() > 1 Тогда
					СтрокиВозвратов.Сортировать("ДатаВозврата Убыв");
				КонецЕсли;
				
				ТекущийКБК = СтрокаУдержания.КБК;
				ТекущаяОрганизация = СтрокаУдержания.Организация;
				ТекущаяРегистрацияВНалоговомОргане = СтрокаУдержания.РегистрацияВНалоговомОргане;
				
			КонецЕсли;
			Если ПропуститьНаборИзмерений Тогда
				Продолжить;
			КонецЕсли;
			Для каждого СтрокаВозврата Из СтрокиВозвратов Цикл
				
				Если СтрокаВозврата.ДатаВозврата > СтрокаУдержания.СрокПеречисленияНалога Или СтрокаУдержания.Сумма = 0 Тогда
					Прервать;
				КонецЕсли;
				СуммаКЗачету = Мин(СтрокаУдержания.Сумма, СтрокаВозврата.Сумма);
				СтрокаУдержания.Сумма = СтрокаУдержания.Сумма - СуммаКЗачету;
				СтрокаВозврата.Сумма = СтрокаВозврата.Сумма - СуммаКЗачету;
				
			КонецЦикла;
		КонецЦикла;
		
	КонецЕсли;
	
	ВсеУдержания.Свернуть("КБК,Организация,РегистрацияВНалоговомОргане,СрокПеречисленияНалога,ДатаУдержания,СтатьяФинансирования,СтатьяРасходов", "Сумма");
	
	СтрокиКУдалению = ВсеУдержания.НайтиСтроки(Новый Структура("Сумма", 0));
	Для каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
		ВсеУдержания.Удалить(УдаляемаяСтрока);
	КонецЦикла;	
	
	Возврат ВсеУдержания
	
КонецФункции

Функция УдержаноНалогаЗаПериодДо2024(Организация, НачалоПериода, ОкончаниеПериода, ПолучатьДанныеПоВсемуЮрлицу, ДляЕНП)

	СтруктураКБК = УчетНДФЛ.КБКпоНДФЛ(НачалоПериода);
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ЗарплатаКадры.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(НачалоПериода));
	Запрос.УстановитьПараметр("ДоНачалаПериода", НачалоПериода - 1);
	Запрос.УстановитьПараметр("ОкончаниеПериода", ОкончаниеПериода);
	Запрос.УстановитьПараметр("КБКсПревышения", СтруктураКБК.СПревышения);
	Запрос.УстановитьПараметр("ДивидендыСПревышения", СтруктураКБК.ДивидендыСПревышения);
	Запрос.УстановитьПараметр("СоответствиеКатегорийКБК", УчетНДФЛ.КБККатегорийДохода(НачалоПериода));
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
	|	СоответствиеКатегорийКБК.КБК КАК КБК
	|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
	|ИЗ
	|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВключатьВДекларациюПоНалогуНаПрибыль КАК ВключатьВДекларациюПоНалогуНаПрибыль,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СрокПеречисления КАК СрокПеречисления,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода КАК СуммаВыплаченногоДохода,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК Период,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
	|	СоответствиеКатегорийКБК.КБК КАК КБК,
	|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период, ДЕНЬ) КАК ДатаВозврата,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТНалоги
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериода И &ОкончаниеПериода
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И &УсловиеНаОрганизацию
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания В (ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано), ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
	|	И (РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма <> 0
	|			ИЛИ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения <> 0)";

	Если ПолучатьДанныеПоВсемуЮрлицу Тогда
		Запрос.УстановитьПараметр("УсловиеНаОрганизацию", Истина);
	Иначе
		Запрос.УстановитьПараметр("Организация", Организация);
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеНаОрганизацию", "РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация");
	КонецЕсли;
	
	Если ДляЕНП Тогда
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты", "ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПОМЕСТИТЬ ВТНалоги", "");
		Запрос.Текст = ТекстЗапроса;
		ВременнаяТаблица = Запрос.Выполнить().Выгрузить();
		
		// Рассчитаем крайний срок уплаты заново - без переноса на рабочие дни.
		УчетНДФЛ.ПроставитьКрайнийСрокУплаты(ВременнаяТаблица, , Ложь);
		
		Запрос.УстановитьПараметр("РасчетыНалогоплательщиковСБюджетомПоНДФЛ", ВременнаяТаблица);
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	СоответствиеКатегорийКБК.КатегорияДохода КАК КатегорияДохода,
		|	СоответствиеКатегорийКБК.КБК КАК КБК
		|ПОМЕСТИТЬ ВТСоответствиеКатегорийКБК
		|ИЗ
		|	&СоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания КАК ВариантУдержания,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК Сумма,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК СуммаСПревышения,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период КАК ДатаУдержания,
		|	НАЧАЛОПЕРИОДА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период, ДЕНЬ) КАК ДатаВозврата,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КрайнийСрокУплаты КАК КрайнийСрокУплаты,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КБК КАК КБК,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
		|ПОМЕСТИТЬ ВТНалоги
		|ИЗ
		|	&РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ";
		
	КонецЕсли;
	
	ОсновнойТекст = 
	"ВЫБРАТЬ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода КАК КатегорияДохода,
	|	СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК Сумма,
	|	СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) КАК СуммаСПревышения,
	|	СоответствиеКатегорийКБК.КБК КАК КБК,
	|	&НачалоПериода КАК ДатаВозврата,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация КАК Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ПОМЕСТИТЬ ВТОстаткиВозвратов
	|ИЗ
	|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСоответствиеКатегорийКБК КАК СоответствиеКатегорийКБК
	|		ПО РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода = СоответствиеКатегорийКБК.КатегорияДохода
	|ГДЕ
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоГода И &ДоНачалаПериода
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И &УсловиеНаОрганизацию
	|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания В (ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано), ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом))
	|
	|СГРУППИРОВАТЬ ПО
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.КатегорияДохода,
	|	СоответствиеКатегорийКБК.КБК,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация,
	|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.РегистрацияВНалоговомОргане
	|
	|ИМЕЮЩИЕ
	|	(СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) < 0
	|		ИЛИ СУММА(РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения) < 0)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоФизическимЛицам.КБК КАК КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога КАК СрокПеречисленияНалога,
	|	СУММА(ДанныеПоФизическимЛицам.Сумма) КАК Сумма,
	|	ДанныеПоФизическимЛицам.Организация КАК Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.ДатаУдержания КАК ДатаУдержания
	|ИЗ
	|	(ВЫБРАТЬ
	|		НалогиПоДатам.КБК КАК КБК,
	|		НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты КАК СрокПеречисленияНалога,
	|		НалогиПоДатам.ДатаУдержания КАК ДатаУдержания,
	|		СУММА(НалогиПоДатам.Сумма) КАК Сумма,
	|		НалогиПоДатам.Организация КАК Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.Сумма) > 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|		И НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) > 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
	|		И НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.КрайнийСрокУплаты,
	|		НалогиПоДатам.ДатаУдержания,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) > 0) КАК ДанныеПоФизическимЛицам
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога,
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.ДатаУдержания
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане,
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.СрокПеречисленияНалога УБЫВ,
	|	ДатаУдержания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоФизическимЛицам.КБК КАК КБК,
	|	ДанныеПоФизическимЛицам.ДатаВозврата КАК ДатаВозврата,
	|	СУММА(ДанныеПоФизическимЛицам.Сумма) КАК Сумма,
	|	ДанныеПоФизическимЛицам.Организация КАК Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|ИЗ
	|	(ВЫБРАТЬ
	|		НалогиПоДатам.КБК КАК КБК,
	|		НалогиПоДатам.ФизическоеЛицо КАК ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата КАК ДатаВозврата,
	|		-СУММА(НалогиПоДатам.Сумма) КАК Сумма,
	|		НалогиПоДатам.Организация КАК Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане КАК РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.Сумма) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|		И НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-СУММА(НалогиПоДатам.СуммаСПревышения),
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТНалоги КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.ВозвращеноНалоговымАгентом)
	|		И НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	
	|	ИМЕЮЩИЕ
	|		СУММА(НалогиПоДатам.СуммаСПревышения) < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НалогиПоДатам.КБК,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.Сумма,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.Сумма < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&КБКсПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.СуммаСПревышения,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.КатегорияДохода <> ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|		И НалогиПоДатам.СуммаСПревышения < 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		&ДивидендыСПревышения,
	|		НалогиПоДатам.ФизическоеЛицо,
	|		НалогиПоДатам.ДатаВозврата,
	|		-НалогиПоДатам.СуммаСПревышения,
	|		НалогиПоДатам.Организация,
	|		НалогиПоДатам.РегистрацияВНалоговомОргане
	|	ИЗ
	|		ВТОстаткиВозвратов КАК НалогиПоДатам
	|	ГДЕ
	|		НалогиПоДатам.КатегорияДохода = ЗНАЧЕНИЕ(Перечисление.КатегорииДоходовНДФЛ.Дивиденды)
	|		И НалогиПоДатам.СуммаСПревышения < 0) КАК ДанныеПоФизическимЛицам
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеПоФизическимЛицам.КБК,
	|	ДанныеПоФизическимЛицам.ДатаВозврата,
	|	ДанныеПоФизическимЛицам.Организация,
	|	ДанныеПоФизическимЛицам.РегистрацияВНалоговомОргане
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДанныеПоФизическимЛицам.ДатаВозврата";
	Если Не ПолучатьДанныеПоВсемуЮрлицу Тогда
		ОсновнойТекст = СтрЗаменить(ОсновнойТекст, "&УсловиеНаОрганизацию", "РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация");
	КонецЕсли;
	
	ЧастиЗапроса = Новый Массив;
	ЧастиЗапроса.Добавить(ТекстЗапроса);
	ЧастиЗапроса.Добавить(ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов());
	ЧастиЗапроса.Добавить(ОсновнойТекст);
	Запрос.Текст = СтрСоединить(ЧастиЗапроса, Символы.ПС);
	
	Результаты = Запрос.ВыполнитьПакет();
	ВсеУдержания = Результаты[3].Выгрузить();
	Возвраты = Результаты[4];
	Если Не Возвраты.Пустой() Тогда
		
		ВсеВозвраты = Возвраты.Выгрузить();
		
		Измерения = "КБК,Организация,РегистрацияВНалоговомОргане";
		СтруктураПоиска = Новый Структура(Измерения);
		ВсеВозвраты.Индексы.Добавить(Измерения);
		
		ТекущийКБК = "";
		ТекущаяОрганизация = Неопределено;
		ТекущаяРегистрацияВНалоговомОргане = Неопределено;
		Для каждого СтрокаУдержания Из ВсеУдержания Цикл
			Если ТекущийКБК <> СтрокаУдержания.КБК
				Или ТекущаяОрганизация <> СтрокаУдержания.Организация
				Или ТекущаяРегистрацияВНалоговомОргане <> СтрокаУдержания.РегистрацияВНалоговомОргане Тогда
				
				ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаУдержания);
				СтрокиВозвратов = ВсеВозвраты.НайтиСтроки(СтруктураПоиска);
				ПропуститьНаборИзмерений = СтрокиВозвратов.Количество() = 0;
				
				СтрокиВозвратов = ВсеВозвраты.Скопировать(СтрокиВозвратов);
				Если СтрокиВозвратов.Количество() > 1 Тогда
					СтрокиВозвратов.Сортировать("ДатаВозврата Убыв");
				КонецЕсли;
				
				ТекущийКБК = СтрокаУдержания.КБК;
				ТекущаяОрганизация = СтрокаУдержания.Организация;
				ТекущаяРегистрацияВНалоговомОргане = СтрокаУдержания.РегистрацияВНалоговомОргане;
				
			КонецЕсли;
			Если ПропуститьНаборИзмерений Тогда
				Продолжить;
			КонецЕсли;
			Для каждого СтрокаВозврата Из СтрокиВозвратов Цикл
				
				Если СтрокаВозврата.ДатаВозврата > СтрокаУдержания.СрокПеречисленияНалога Или СтрокаУдержания.Сумма = 0 Тогда
					Прервать;
				КонецЕсли;
				СуммаКЗачету = Мин(СтрокаУдержания.Сумма, СтрокаВозврата.Сумма);
				СтрокаУдержания.Сумма = СтрокаУдержания.Сумма - СуммаКЗачету;
				СтрокаВозврата.Сумма = СтрокаВозврата.Сумма - СуммаКЗачету;
				
			КонецЦикла;
		КонецЦикла;
		
	КонецЕсли;
	
	ВсеУдержания.Свернуть("КБК,Организация,РегистрацияВНалоговомОргане,СрокПеречисленияНалога,ДатаУдержания", "Сумма");
	
	СтрокиКУдалению = ВсеУдержания.НайтиСтроки(Новый Структура("Сумма", 0));
	Для каждого УдаляемаяСтрока Из СтрокиКУдалению Цикл
		ВсеУдержания.Удалить(УдаляемаяСтрока);
	КонецЦикла;	
	
	Возврат ВсеУдержания
	
КонецФункции


#КонецОбласти

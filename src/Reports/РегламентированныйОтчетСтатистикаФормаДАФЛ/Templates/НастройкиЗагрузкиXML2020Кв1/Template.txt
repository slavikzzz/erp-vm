// Область "Настройки" описывает параметры инициализации механизма загрузки
// регламентированных отчетов из файлов выгрузки. Формат области настроек - JSON.
//
// Описание параметров:
// * Установкой параметра "РазрешитьЗагрузку" в "true" или "false" регулируем видимость
//    кнопки "Загрузить" и возможность загрузки из файла в форме отчета.
// * Параметр "ФорматыСхемВыгрузки" описывает соответствие имен макетов схем выгрузки
//   поддерживаемым форматам загрузки. Если у формы единственная схема выгрузки или
//   нужно всегда использовать схему по умолчанию - указываем значение "null".
// * Параметр "ОбластиОбработчиков" содержит список имен используемых обработчиков
//    загружаемых данных. Имена соответствуют областям макета, в которых можно размещать
//    произвольные алгоритмы на языке "1С:Предприятие" для обработки доступных объектов.
//
// Примечание:
// Сопоставление имен узлов из файла XML и имен показателей отчета выполняется по данным схемы выгрузки,
// поэтому обработчики используются для получения значений показателей, не описанных в схеме выгрузки.
//
#Область Настройки
{
	"РазрешитьЗагрузку"   : true,
	
	"ФорматыСхемВыгрузки" : null,
	"ОбластиОбработчиков" : {
		"ПередЗагрузкой"  : "ПредОбработкаСхемыЗагрузки",
		"ПослеЗагрузки"   : "ПостОбработкаДокументаОтчета",
	}
}
#КонецОбласти

#Область ПредОбработкаСхемыЗагрузки
	
#КонецОбласти

#Область ПостОбработкаДокументаОтчета

	УзлыСекции = УзлыПоXPath(П.ДеревоДляЗагрузки, "//sections");
	
	Для Каждого УзелСекции Из УзлыСекции Цикл
		
		УзлыСекция = УзлыПоXPath(УзелСекции, "section");
		Для Каждого УзелСекция Из УзлыСекция Цикл
			
			КодСекции = СокрЛП(УзлыПоXPath(УзелСекция, "@code")[0].ЗначениеПоУмолчанию);
			
			Если КодСекции = "1" Тогда
				УзлыПризнаков = УзлыПоXPath(УзелСекция, "row/col[@code='3']");
				Если ЗначениеЗаполнено(УзлыПризнаков) Тогда
					УзелПризнак = УзлыПризнаков[0];
					УзелПризнак.Формат = "T";
					Если ЗначениеЗаполнено(УзелПризнак.Значение) Тогда
						УзелПризнак.Значение = "Х";
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
			
			Если КодСекции = "4" Тогда
				УзлыКлючейСтрокР3 = УзлыПоXPath(УзелСекция, "row/@s1");
				Для Каждого УзелКлючаСтрокиР3 Из УзлыКлючейСтрокР3 Цикл
					УзелНовКолонки = СкопированныйУзел(УзелКлючаСтрокиР3.Родитель, УзелКлючаСтрокиР3);
					УзелНовКолонки.Тип  = "С";
					УзелНовКолонки.Код  = "col_s1";
					УзелНовКолонки.Ключ = "П000030100901";
					УзелНовКолонки.Значение = УзелКлючаСтрокиР3.Значение;
				КонецЦикла;
			КонецЕсли;
			
			Если СтрНайти("'1','2','3','4','8'", "'" + КодСекции + "'") > 0 Тогда
				Продолжить;
			КонецЕсли;
			
			УзлыКолонка = УзлыПоXPath(УзелСекция, "row/col");
			Для Каждого УзелКолонка Из УзлыКолонка Цикл
				Если УзелКолонка.Формат = "N" Тогда
					УзелКолонка.Формат = "T";
					Если ЗначениеЗаполнено(УзелКолонка.Значение) Тогда
						УзелКолонка.Значение = "Х";
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
		КонецЦикла;
		
		ЗаполнитьДаннымиСохраненныйДокументИзДереваДляЗагрузки(УзелСекции, П.ДанныеОтчета, П.ПараметрыОтчета);
		
	КонецЦикла;

#КонецОбласти
&НаСервере
Функция ОтброситьНачальныеНули(Стр)
	Если СтрНачинаетсяС(Стр, "0") Тогда 
		Возврат ОтброситьНачальныеНули(Сред(Стр, 2));
	Иначе
		Возврат Стр;
	КонецЕсли;
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ОтборКодыЛьгот = "2012000,2012400,2012500,2010501,2010502,2010503,2010504,2010505,2010506,2010507,2010508";
	ОтборКодыЛьгот0 = "2010501,2010502,2010503,2010504,";
	
	Элементы.КодЛьготы.СписокВыбора.Очистить();
	Для Каждого Стр Из Параметры.СпискиВыбора Цикл
		Если Стр.ИмяПоля = "ДляВводаИзФормы" Тогда 
			Элементы.КодЛьготы.СписокВыбора.Добавить(Стр.Код);
			ЗаполнитьЗначенияСвойств(ТаблицаКодов.Добавить(), Стр);
		КонецЕсли;
	КонецЦикла;
	
	КодЛьготы = Лев(Параметры.РеквизитыДляРедактирования, 7);
	Если ТаблицаКодов.НайтиСтроки(Новый Структура("Код", КодЛьготы)).Количество() = 1 Тогда 
		Элементы.Декорация.Заголовок = ТаблицаКодов.НайтиСтроки(Новый Структура("Код", КодЛьготы))[0].Наименование;
		Если СтрНайти(ОтборКодыЛьгот, КодЛьготы) <> 0 Тогда 
			Статья = ОтброситьНачальныеНули(Сред(Параметры.РеквизитыДляРедактирования, 9, 4));
			Пункт = ОтброситьНачальныеНули(Сред(Параметры.РеквизитыДляРедактирования, 13, 4));
			Подпункт = ОтброситьНачальныеНули(Сред(Параметры.РеквизитыДляРедактирования, 17, 4));
		КонецЕсли;
	Иначе
		КодЛьготы = "";
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура Отмена(Команда)
	Закрыть(Неопределено);
КонецПроцедуры

&НаКлиенте
Процедура Ок(Команда)
	Результат = Новый Структура("КодНалЛьг,КодЛгПНС,КодЛгУмен");
	Если КодЛьготы = "2012400" Тогда 
		Результат["КодЛгПНС"] = КодЛьготы + "/" + Прав("0000" + Статья, 4)
			+ Прав("0000" + Пункт, 4) + Прав("0000" + Подпункт, 4);
	ИначеЕсли КодЛьготы = "2012000" Тогда 
		Результат["КодНалЛьг"] = КодЛьготы + "/" + Прав("0000" + Статья, 4)
			+ Прав("0000" + Пункт, 4) + Прав("0000" + Подпункт, 4);
	ИначеЕсли СтрНайти("2012500,2010505,2010506,2010507,2010508", КодЛьготы) > 0 Тогда 
		Результат["КодЛгУмен"] = КодЛьготы + "/" + Прав("0000" + Статья, 4)
			+ Прав("0000" + Пункт, 4) + Прав("0000" + Подпункт, 4);
	ИначеЕсли СтрНайти("2010501,2010502,2010503,2010504,", КодЛьготы) > 0 Тогда 
		Результат["КодЛгУмен"] = КодЛьготы + "/000000000000";
	Иначе
		Результат["КодНалЛьг"] = КодЛьготы;
	КонецЕсли;
	Закрыть(Результат);
КонецПроцедуры

&НаКлиенте
Процедура КодЛьготыПриИзменении(Элемент)
	Элементы.Декорация.Заголовок = ТаблицаКодов.НайтиСтроки(Новый Структура("Код", КодЛьготы))[0].Наименование;
	Если СтрНайти(ОтборКодыЛьгот, КодЛьготы) = 0 Тогда 
		Статья = Неопределено;
		Пункт = Неопределено;
		Подпункт = Неопределено;
	ИначеЕсли СтрНайти(ОтборКодыЛьгот0, КодЛьготы) <> 0 Тогда
		Статья = "0000";
		Пункт = "0000";
		Подпункт = "0000";
	КонецЕсли;
КонецПроцедуры

// Область "Настройки" описывает параметры инициализации механизма загрузки
// регламентированных отчетов из файлов выгрузки. Формат области настроек - JSON.
//
// Описание параметров:
// * Установкой параметра "РазрешитьЗагрузку" в "true" или "false" регулируем видимость
//    кнопки "Загрузить" и возможность загрузки из файла в форме отчета.
// * Параметр "ФорматыСхемВыгрузки" описывает соответствие имен макетов схем выгрузки
//   поддерживаемым форматам загрузки. Если у формы единственная схема выгрузки или
//   нужно всегда использовать схему по умолчанию - указываем значение "null".
// * Параметр "ОбластиОбработчиков" содержит список имен используемых обработчиков
//    загружаемых данных. Имена соответствуют областям макета, в которых можно размещать
//    произвольные алгоритмы на языке "1С:Предприятие" для обработки доступных объектов.
//
// Примечание:
// Сопоставление имен узлов из файла XML и имен показателей отчета выполняется по данным схемы выгрузки,
// поэтому обработчики используются для получения значений показателей, не описанных в схеме выгрузки.
//
#Область Настройки
{
	"РазрешитьЗагрузку"   : true,
	
	"ФорматыСхемВыгрузки" : null,
	"ОбластиОбработчиков" : {
		"ПередЗагрузкой"  : "ПредОбработкаСхемыЗагрузки",
		"ПослеЗагрузки"   : "ПостОбработкаДокументаОтчета",
	}
}
#КонецОбласти

#Область ПредОбработкаСхемыЗагрузки
	
	НайденныеСтроки = П.ДеревоДляЗагрузки.Строки.НайтиСтроки(Новый Структура("Код,ЗначениеПоУмолчанию", "s1", "01"), Истина);
	Для Каждого СтрокаДерева Из НайденныеСтроки Цикл
		СтрокаДерева.ЗначениеПоУмолчанию = "";
		Если СтрокаДерева.Ключ = "ПД00210210203" Тогда
			СтрокаДерева.Ключ = "П000210210203";
			СтрокаДерева.Формат = "T";
		КонецЕсли;
	КонецЦикла;
	
	НайденныеСтроки = П.ДеревоДляЗагрузки.Строки.НайтиСтроки(Новый Структура("Код,ЗначениеПоУмолчанию", "code", "1320"), Истина);
	Для Каждого СтрокаДерева Из НайденныеСтроки Цикл
		СтрокаДерева.Раздел = "ПолеТабличногоДокументаФормаОтчета";
		СтрокаДерева.Ключ = "П000130132002";
	КонецЦикла;
	
	НайденныеСтроки = П.ДеревоДляЗагрузки.Строки.НайтиСтроки(Новый Структура("Код,ЗначениеПоУмолчанию", "code", "2002"), Истина);
	Для Каждого СтрокаДерева Из НайденныеСтроки Цикл
		СтрокаДерева.Раздел = "ПолеТабличногоДокументаФормаОтчета";
		СтрокаДерева.Ключ = "П000200200202";
	КонецЦикла;
	
	НайденныеСтроки = П.ДеревоДляЗагрузки.Строки.НайтиСтроки(Новый Структура("Код,ЗначениеПоУмолчанию", "code", "2004"), Истина);
	Для Каждого СтрокаДерева Из НайденныеСтроки Цикл
		СтрокаДерева.Раздел = "ПолеТабличногоДокументаФормаОтчета";
		СтрокаДерева.Ключ = "П000200200402";
	КонецЦикла;
	
	НайденныеСтроки = П.ДеревоДляЗагрузки.Строки.НайтиСтроки(Новый Структура("Код,ЗначениеПоУмолчанию", "code", "2301"), Истина);
	Для Каждого СтрокаДерева Из НайденныеСтроки Цикл
		СтрокаДерева.Раздел = "ПолеТабличногоДокументаФормаОтчета";
		СтрокаДерева.Ключ = "П000210210202";
	КонецЦикла;
	
#КонецОбласти

#Область ПостОбработкаДокументаОтчета

	ФормаОтчета = Неопределено;
	
	П.ДанныеОтчета.ПоказателиОтчета.Свойство("ПолеТабличногоДокументаФормаОтчета", ФормаОтчета);
	Если ФормаОтчета <> Неопределено Тогда
		
		Инд = 2;
		Пока Истина Цикл
			СтрИнд = "_" + Формат(Инд, "ЧГ=");
			ЗначениеПоказателя = "";
			Если НЕ ФормаОтчета.Свойство("П000130132002" + СтрИнд, ЗначениеПоказателя) Тогда
				Прервать;
			КонецЕсли;
			Если ЗначениеЗаполнено(ЗначениеПоказателя) Тогда
				ФормаОтчета.Вставить("П000130132002" + СтрИнд, "");
			КонецЕсли;
			Инд = Инд + 1;
		КонецЦикла;
		
	КонецЕсли;

#КонецОбласти
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	СформированныйДокумент = Неопределено;
	Попытка
		МодульМенеджера = ОбщегоНазначения.ОбщийМодуль("Отчеты.ВизуализацияВходящихИзвещенийФНС");
		ДеревоЗагрузки = УведомлениеОСпецрежимахНалогообложения.СформироватьДеревоЗагрузки(Параметры.ПредставлениеXML);
		УзелКНД = УведомлениеОСпецрежимахНалогообложения.НайтиУзелВДеревеПоПути(ДеревоЗагрузки, "Файл/Документ/КНД", "ИмяЭлемента");
		УзелВерсияФормата = УведомлениеОСпецрежимахНалогообложения.НайтиУзелВДеревеПоПути(ДеревоЗагрузки, "Файл/ВерсФорм", "ИмяЭлемента").ЗначениеЭлемента;
		
		Если УзелКНД.ЗначениеЭлемента = "1152006" Тогда
			Если УзелВерсияФормата = "5.01" Или УзелВерсияФормата = "5.02" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СообщениеОбИсчисленнойСуммеТранспортногоНалога501(
					ДеревоЗагрузки, Параметры.Владелец);
			ИначеЕсли УзелВерсияФормата = "5.03" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СообщениеОбИсчисленнойСуммеТранспортногоНалога503(
					ДеревоЗагрузки, Параметры.Владелец);
			КонецЕсли;
		ИначеЕсли УзелКНД.ЗначениеЭлемента = "1153007" Тогда
			Если УзелВерсияФормата = "5.01" Или УзелВерсияФормата = "5.02" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СообщениеОбИсчисленнойСуммеЗемельногоНалога501(
					ДеревоЗагрузки, Параметры.Владелец);
			ИначеЕсли УзелВерсияФормата = "5.03" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СообщениеОбИсчисленнойСуммеЗемельногоНалога503(
					ДеревоЗагрузки, Параметры.Владелец);
			КонецЕсли;
		ИначеЕсли УзелКНД.ЗначениеЭлемента = "1152029" Тогда
 			Если УзелВерсияФормата = "5.01" Или УзелВерсияФормата = "5.02" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СообщениеОбИсчисленныхСуммахНалогов501(
					ДеревоЗагрузки, Параметры.Владелец);
			ИначеЕсли УзелВерсияФормата = "5.03" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СообщениеОбИсчисленныхСуммахНалогов503(
					ДеревоЗагрузки, Параметры.Владелец);
			КонецЕсли;
		ИначеЕсли УзелКНД.ЗначениеЭлемента = "1120502" Тогда
 			Если УзелВерсияФормата = "5.01" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СправкаОПринадлежностиСуммЕНП501(
					ДеревоЗагрузки, Параметры.Владелец);
				КонецЕсли;
		ИначеЕсли УзелКНД.ЗначениеЭлемента = "1120101" Тогда
 			Если УзелВерсияФормата = "5.04" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СправкаОНаличииОбязанностиейПоУплате504(
					ДеревоЗагрузки, Параметры.Владелец);
				КонецЕсли;
		ИначеЕсли УзелКНД.ЗначениеЭлемента = "1120518" Тогда
 			Если УзелВерсияФормата = "5.01" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СведенияПоЗадолженности501(
					ДеревоЗагрузки, Параметры.Владелец);
				КонецЕсли;
		ИначеЕсли УзелКНД.ЗначениеЭлемента = "1120525" Тогда
 			Если УзелВерсияФормата = "5.01" Тогда
				СформированныйДокумент = МодульМенеджера.Сформировать_СправкаОПринадлежностиСуммЕНПАгрегированная501(
					ДеревоЗагрузки, Параметры.Владелец);
				КонецЕсли;
		КонецЕсли;
	Исключение
		ОбщегоНазначения.СообщитьПользователю("Не удалось сформировать представление");
		Отказ = Истина;
		Возврат;
	КонецПопытки;
	
	Если ТипЗнч(СформированныйДокумент) = Тип("ТабличныйДокумент") Тогда 
		СтруктураРеквизитовУведомления = Новый Структура("СписокПечатаемыхЛистов", Новый СписокЗначений);
		УведомлениеОСпецрежимахНалогообложения.ПоложитьПФВСписокЛистов(Неопределено,
			СтруктураРеквизитовУведомления.СписокПечатаемыхЛистов, СформированныйДокумент, 1, Ложь);
	Иначе
		ОбщегоНазначения.СообщитьПользователю("Не удалось сформировать представление");
		Отказ = Истина;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	РегламентированнаяОтчетностьКлиент.ОткрытьФормуПредварительногоПросмотра(
		ВладелецФормы, "Открыть", Ложь, СтруктураРеквизитовУведомления.СписокПечатаемыхЛистов);
	Отказ = Истина;
КонецПроцедуры

#КонецОбласти
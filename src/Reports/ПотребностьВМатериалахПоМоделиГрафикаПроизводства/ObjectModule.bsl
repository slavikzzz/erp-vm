#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ОбработчикиСобытий

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	НастройкиОтчета = КомпоновщикНастроек.ПолучитьНастройки();
	ВнешниеНаборы = Новый Структура;
	
	Отчеты.ПотребностьВМатериалахПоМоделиГрафикаПроизводства.НастроитьНаборыДанных(
		СхемаКомпоновкиДанных, НастройкиОтчета, ВнешниеНаборы);
	
	// Компоновка и вывод.
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, НастройкиОтчета, ДанныеРасшифровки);

	КомпоновкаДанныхСервер.УстановитьЗаголовкиМакетаКомпоновки(ПараметризуемыеЗаголовкиПолей(), МакетКомпоновки);
	
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, ВнешниеНаборы, ДанныеРасшифровки, Истина);
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
	ПроцессорВывода.Вывести(ПроцессорКомпоновки);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПараметризуемыеЗаголовкиПолей()
	
	ЗаголовкиПолей = Новый Соответствие;
	
	ЕдиницаВеса = Строка(Константы.ЕдиницаИзмеренияВеса.Получить());
	ЕдиницаОбъема = Строка(Константы.ЕдиницаИзмеренияОбъема.Получить());
	
	ПараметрЕдиницыКоличества = КомпоновкаДанныхКлиентСервер.ПолучитьПараметр(КомпоновщикНастроек, "ЕдиницыКоличества");
	
	Если ПараметрЕдиницыКоличества <> Неопределено
		И ПараметрЕдиницыКоличества.Значение = 0 Тогда
		ЗаголовокЕдИзм = НСтр("ru = 'Итого материалов в единицах хранения';
								|en = 'Total materials in stock UOM'");
	Иначе
		ЗаголовокЕдИзм = НСтр("ru = 'Итого материалов в единицах для отчетов';
								|en = 'Total materials in units for reports'");
	КонецЕсли;
	
	ЗаголовкиПолей.Вставить("12", ЕдиницаВеса); // ЕдиницаВеса
	ЗаголовкиПолей.Вставить("13", ЕдиницаОбъема); // ЕдиницаОбъема
	ЗаголовкиПолей.Вставить("11", ЗаголовокЕдИзм); // ЗаголовокГруппировкиЕдИзм
	
	Возврат ЗаголовкиПолей;
	
КонецФункции

#КонецОбласти

#КонецЕсли

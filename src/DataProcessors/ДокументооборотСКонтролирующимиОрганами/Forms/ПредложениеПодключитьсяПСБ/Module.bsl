
#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЗакрытьПриСоздании(Отказ);
	УправлениеФормой();
	
КонецПроцедуры

&НаСервереБезКонтекста
Процедура СохранитьЗначениеБольшеНеПоказыватьНаСервере(БольшеНеПоказывать)
	
	ХранилищеОбщихНастроек.Сохранить(
		"Обработка.ОбщиеОбъектыРеглОтчетности", 
		"НеПоказыватьПредложениеОформитьЗаявлениеНаПодключение", 
		БольшеНеПоказывать);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// КОМАНДЫ ФОРМЫ

&НаКлиенте
Процедура Подключить(Команда)
		
	ПерейтиПоНавигационнойСсылке("https://business.psbank.ru/auth/login?goto=bookkeeping/settings");
	
КонецПроцедуры

&НаКлиенте
Процедура ГалкаБольшеНеНапоминатьПриИзменении(Элемент)
	СохранитьЗначениеБольшеНеПоказыватьНаСервере(Истина);
КонецПроцедуры

&НаСервере
Процедура ЗакрытьПриСоздании(Отказ)
	
	Если Параметры.Свойство("ПоказыватьКнопки") И Параметры.ПоказыватьКнопки Тогда
		
		БольшеНеПоказывать 	= ХранилищеОбщихНастроек.Загрузить(
			"Обработка.ОбщиеОбъектыРеглОтчетности", 
			"НеПоказыватьПредложениеОформитьЗаявлениеНаПодключение");
		
		Если БольшеНеПоказывать = Истина Тогда
			Отказ = Истина;
		КонецЕсли;
		
		ВремяПоследнегоНапоминания 	= ХранилищеОбщихНастроек.Загрузить(
			"Обработка.ОбщиеОбъектыРеглОтчетности", 
			"ВремяПоследнегоНапоминания");
		
		Если ВремяПоследнегоНапоминания <> Неопределено 
			И ВремяПоследнегоНапоминания + 4 * 60 * 60 > ТекущаяДатаСеанса() Тогда
			
			Отказ = Истина;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура УправлениеФормой()
	
	Элементы.ГалкаБольшеНеНапоминать.Видимость = 
		Параметры.Свойство("ПоказыватьКнопки") 
		И Параметры.ПоказыватьКнопки;
	
КонецПроцедуры

#КонецОбласти

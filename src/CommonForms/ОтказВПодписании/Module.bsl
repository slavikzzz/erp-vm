
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(Параметры.ФайлыДокументовКЭДО) Тогда
		ФайлыДокументовКЭДО.ЗагрузитьЗначения(Параметры.ФайлыДокументовКЭДО);
	Иначе
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Отказать(Команда)
	
	ЗарегистрироватьОтказ();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ЗарегистрироватьОтказ()
	
	Если ПроверитьЗаполнение() Тогда
		
		ЗарегистрироватьОтказНаСервере();
		Если Открыта() Тогда
			Закрыть();
		КонецЕсли;
		Если ВладелецФормы.Открыта() Тогда
			ВладелецФормы.Закрыть();
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗарегистрироватьОтказНаСервере()
	
	Для Каждого ЭлементКоллекции Из ФайлыДокументовКЭДО Цикл
		РегистрыСведений.КомментарииФайловДокументовКЭДО.ДобавитьКомментарийФайла(
			ЭлементКоллекции.Значение, ПричинаОтказа, Пользователи.ТекущийПользователь());
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Пропускаем инициализацию, чтобы гарантировать получение формы при передаче параметра "АвтоТест".
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	СсылкаНаОтчет = Параметры.СсылкаНаОтчет;
	
	ОтправкаРегОтчетовВСПАРК.ПодтверждениеОтправкиОтчета_ИзменитьОформлениеФормы(ЭтотОбъект, СсылкаНаОтчет);
	ИзменитьОформлениеОтправитьВСПАРК();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура ПодтверждениеКорректностиЗаполненияПриИзменении(Элемент)
	
	Элементы.Отправить.Доступность = ПодтверждениеКорректностиЗаполнения;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Отправить(Команда)
	
	ДействияПередОтправкойНаСервере();
	Закрыть(КодВозвратаДиалога.ОК);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ДействияПередОтправкойНаСервере()
	
	Если ЭтоНужныйВидОтчетаСПАРК Тогда
		
		Если ОтправитьВСПАРК Тогда
			ОтправкаРегОтчетовВСПАРКВызовСервера.ЗаписатьСтатистикуОтправкиБухОтчетностиВСПАРК("СогласилисьСразу");
			ОтправкаРегОтчетовВСПАРК.ЗаписатьОтчетСПАРКВРегистр(
				СсылкаНаОтчет,
				ПредопределенноеЗначение("Перечисление.СтатусыОтправкиВСПАРК.ОтправкаРазрешена"));
		Иначе
			ОтправкаРегОтчетовВСПАРКВызовСервера.ЗаписатьСтатистикуОтправкиБухОтчетностиВСПАРК("ОтказалисьСразу");
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ИзменитьОформлениеОтправитьВСПАРК()
	
	ЭтоНужныйВидОтчетаСПАРК = ОтправкаРегОтчетовВСПАРК.ЭтоНужныйВидОтчетаСПАРК(СсылкаНаОтчет);
	Элементы.ГруппаОтправитьВСПАРК.Видимость = ЭтоНужныйВидОтчетаСПАРК;
	
	ОтправитьВСПАРК = Истина;

КонецПроцедуры

#КонецОбласти
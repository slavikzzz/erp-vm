
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Элементы.ГруппаЗаменитьНаАналоги.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьАналогиМатериалов");

	СписокДействий = Новый СписокЗначений;
	СписокДействий.Добавить("ДЕЙСТВИЕ_ОТГРУЗИТЬ_ПРИОРИТЕТНО_ОБОСОБЛЕННО", ПредопределенноеЗначение("Перечисление.ВариантыОбеспечения.Отгрузить"));
	СписокДействий.Добавить("ДЕЙСТВИЕ_РЕЗЕРВИРОВАТЬ_ПРИОРИТЕТНО_ОБОСОБЛЕННО", ПредопределенноеЗначение("Перечисление.ВариантыОбеспечения.СоСклада"));
	КодДействияПоУмолчанию = "ДЕЙСТВИЕ_ОТГРУЗИТЬ_ПРИОРИТЕТНО_ОБОСОБЛЕННО";

	АвтоЗаголовок = НЕ Параметры.Свойство("ЗаголовокФормы", ЭтаФорма.Заголовок);
	Если Параметры.Свойство("ЗаголовокКнопкиЗаполнить") Тогда
		Элементы.Заполнить.Заголовок = Параметры.ЗаголовокКнопкиЗаполнить;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПриЗагрузкеДанныхИзНастроекНаСервере(Настройки)
	
	ЗаполнитьОбеспечение = Истина;
	
	Если СписокДействий.НайтиПоЗначению(Настройки["КодДействия"]) = Неопределено Тогда
		КодДействия = КодДействияПоУмолчанию;
	КонецЕсли;
	
	НастроитьЗависимыеЭлементыФормы(ЭтаФорма);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы
 
&НаКлиенте
Процедура ЗаполнитьОбеспечениеПриИзменении(Элемент)
	
	Если Не ЗначениеЗаполнено(КодДействия) Тогда
		КодДействия = КодДействияПоУмолчанию;
	КонецЕсли;

	НастроитьЗависимыеЭлементыФормы(ЭтаФорма, "ЗаполнитьОбеспечение");
	
КонецПроцедуры

&НаКлиенте
Асинх Процедура ГиперссылкаТекущееДействиеНажатие(Элемент)
	
	Ответ = Ждать ВыбратьИзСпискаАсинх(СписокДействий, Элементы.ГиперссылкаТекущееДействие);
	
	Если ТипЗнч(Ответ) = Тип("ЭлементСпискаЗначений") Тогда
	 	КодДействия = Ответ.Значение;
		НастроитьЗависимыеЭлементыФормы(ЭтаФорма, "ТекущееДействие"); 
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область КомандыФормы

&НаКлиенте
Процедура ОК(Команда)
	
	Результат = ПараметрыЗаполненияОбеспечения();
	Закрыть(Результат);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции
  
&НаКлиентеНаСервереБезКонтекста
Процедура НастроитьЗависимыеЭлементыФормы(Форма, СписокРеквизитов = "")
	
	Элементы = Форма.Элементы;
	
	Инициализация = ПустаяСтрока(СписокРеквизитов);
	СтруктураРеквизитов = Новый Структура(СписокРеквизитов);
	
	Если СтруктураРеквизитов.Свойство("ТекущееДействие")
		ИЛИ Инициализация Тогда
		Элементы.ГиперссылкаТекущееДействие.Заголовок = Форма.СписокДействий.НайтиПоЗначению(Форма.КодДействия).Представление;
	КонецЕсли;
	
	Если СтруктураРеквизитов.Свойство("ЗаполнитьОбеспечение")
		ИЛИ Инициализация Тогда
		Элементы.ГруппаЗаполнитьОбеспечениеДетали.Доступность = Форма.ЗаполнитьОбеспечение;
		Элементы.ГруппаЗаменитьНаАналоги.Доступность          = Форма.ЗаполнитьОбеспечение;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПараметрыЗаполненияОбеспечения()

	КодДействияАналоги = ?(КодДействия = "ДЕЙСТВИЕ_ОТГРУЗИТЬ_ПРИОРИТЕТНО_ОБОСОБЛЕННО",  "ДЕЙСТВИЕ_АНАЛОГИ_ОТГРУЗИТЬ",
		                 ?(КодДействия = "ДЕЙСТВИЕ_РЕЗЕРВИРОВАТЬ_ПРИОРИТЕТНО_ОБОСОБЛЕННО", "ДЕЙСТВИЕ_АНАЛОГИ_РЕЗЕРВИРОВАТЬ",
		                    							""));
	Результат = Новый Структура();
	
	Результат.Вставить("ЗаполнитьОбеспечение", ЗаполнитьОбеспечение);
	Результат.Вставить("КодДействия",          КодДействия);
	Результат.Вставить("ЗаменитьНаАналоги",    ЗаменитьНаАналоги);
	Результат.Вставить("КодДействияАналоги",   КодДействияАналоги);
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти


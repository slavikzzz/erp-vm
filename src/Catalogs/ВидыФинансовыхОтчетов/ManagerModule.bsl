
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ОбработкаПолученияДанныхВыбора(ДанныеВыбора, Параметры, СтандартнаяОбработка)
	
	Если Параметры.Свойство("ПланыСчетов") Тогда
		
		СтандартнаяОбработка = Ложь;
		ДанныеВыбора = Новый СписокЗначений();
		
		Запрос = Новый Запрос;
		Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ВидыФинансовыхОтчетов.Ссылка КАК Ссылка,
		|	ПРЕДСТАВЛЕНИЕ(ВидыФинансовыхОтчетов.Ссылка) КАК Представление
		|ИЗ
		|	Справочник.ВидыФинансовыхОтчетов КАК ВидыФинансовыхОтчетов
		|ГДЕ
		|	ИСТИНА В (
		|		ВЫБРАТЬ ПЕРВЫЕ 1
		|			ИСТИНА
		|		ИЗ
		|			Справочник.ВидыФинансовыхОтчетов.ПланыСчетов КАК ТаблицаПланыСчетов
		|		ГДЕ
		|			ВидыФинансовыхОтчетов.Ссылка = ТаблицаПланыСчетов.Ссылка
		|			И ТаблицаПланыСчетов.ПланСчетов В (&ПланыСчетов))
		|	И НЕ ИСТИНА В (
		|		ВЫБРАТЬ ПЕРВЫЕ 1
		|			ИСТИНА
		|		ИЗ
		|			Справочник.ВидыФинансовыхОтчетов.ПланыСчетов КАК ТаблицаПланыСчетов
		|		ГДЕ
		|			ВидыФинансовыхОтчетов.Ссылка = ТаблицаПланыСчетов.Ссылка
		|			И НЕ ТаблицаПланыСчетов.ПланСчетов В (&ПланыСчетов))
		|	И &Отбор
		|	И &СтрокаПоиска
		|";
		Запрос.УстановитьПараметр("ПланыСчетов", Параметры.ПланыСчетов);
		
		МассивСтрокиОтбора = Новый Массив;
		МассивСтрокиОтбора.Добавить("ИСТИНА");
		Если Параметры.Свойство("Отбор") Тогда
			Для каждого КлючИЗначение Из Параметры.Отбор Цикл
				МассивСтрокиОтбора.Добавить(СтрШаблон("ТаблицаПланыСчетов.Ссылка.%1 = &%1", КлючИЗначение.Ключ));
				Запрос.УстановитьПараметр(КлючИЗначение.Ключ, КлючИЗначение.Значение);
			КонецЦикла;
		КонецЕсли;
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&Отбор", СтрСоединить(МассивСтрокиОтбора, Символы.ПС + "И" + " "));
		
		Если Параметры.Свойство("СтрокаПоиска") Тогда
			УсловиеСтрокаПоиска = "ВидыФинансовыхОтчетов.Наименование ПОДОБНО &СтрокаПоиска";
			Запрос.УстановитьПараметр("СтрокаПоиска", "%" + Параметры.СтрокаПоиска + "%");
		Иначе
			УсловиеСтрокаПоиска = "ИСТИНА";
		КонецЕсли;
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&СтрокаПоиска", УсловиеСтрокаПоиска);
		
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Следующий() Цикл
			ДанныеВыбора.Добавить(Выборка.Ссылка, Выборка.Представление);
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли
